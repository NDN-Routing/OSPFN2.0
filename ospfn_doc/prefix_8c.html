<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: lib/prefix.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('prefix_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">lib/prefix.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="zebra_8h_source.html">zebra.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="prefix_8h_source.html">prefix.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vty_8h_source.html">vty.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sockunion_8h_source.html">sockunion.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="memory_8h_source.html">memory.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for prefix.c:</div>
<div class="dyncontent">
<div class="center"><img src="prefix_8c__incl.png" border="0" usemap="#lib_2prefix_8c" alt=""/></div>
<map name="lib_2prefix_8c" id="lib_2prefix_8c">
<area shape="rect" id="node3" href="zebra_8h.html" title="zebra.h" alt="" coords="1345,80,1412,107"/><area shape="rect" id="node61" href="prefix_8h.html" title="prefix.h" alt="" coords="2805,80,2872,107"/><area shape="rect" id="node63" href="sockunion_8h.html" title="sockunion.h" alt="" coords="2799,155,2892,181"/><area shape="rect" id="node65" href="vty_8h.html" title="vty.h" alt="" coords="2949,80,3000,107"/><area shape="rect" id="node69" href="log_8h.html" title="log.h" alt="" coords="3013,155,3064,181"/><area shape="rect" id="node73" href="memory_8h.html" title="memory.h" alt="" coords="3091,80,3173,107"/><area shape="rect" id="node57" href="zassert_8h.html" title="zassert.h" alt="" coords="2623,155,2700,181"/><area shape="rect" id="node59" href="str_8h.html" title="str.h" alt="" coords="2725,155,2773,181"/><area shape="rect" id="node67" href="thread_8h.html" title="thread.h" alt="" coords="2916,155,2988,181"/><area shape="rect" id="node75" href="memtypes_8h.html" title="lib/memtypes.h" alt="" coords="3089,155,3204,181"/></map>
</div>
</div>
<p><a href="prefix_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a6f9a32b2fd315bf69360c883843e8699">PNBBY</a>&#160;&#160;&#160;8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#af3fe3362bcbca3196b184d9bd871544b">MASKBIT</a>(offset)&#160;&#160;&#160;((0xff &lt;&lt; (PNBBY - (offset))) &amp; 0xff)</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a6d5ede437568763fc6ef7d9cc772b501">afi2family</a> (int afi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a5d1761cfd89b5e35540ece8fe2573299">family2afi</a> (int family)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a8c5d68665a4b036a361330bee254318e">prefix_match</a> (const struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>, const struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#abaad44d47b408d45484fdd729ab501b2">prefix_copy</a> (struct <a class="el" href="structprefix.html">prefix</a> *dest, const struct <a class="el" href="structprefix.html">prefix</a> *src)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#ac3645297b5669182b5052aa7689712af">prefix_same</a> (const struct <a class="el" href="structprefix.html">prefix</a> *p1, const struct <a class="el" href="structprefix.html">prefix</a> *p2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a203098ec44d398d5c8692082d8cae725">prefix_cmp</a> (const struct <a class="el" href="structprefix.html">prefix</a> *p1, const struct <a class="el" href="structprefix.html">prefix</a> *p2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a857a677dba88a14eab7a4090d0bcd3fe">prefix_family_str</a> (const struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#af674876d8d874e88225f559322d797ac">prefix_ipv4_new</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a226bbb39f0a469263b369d16b58ab62f">prefix_ipv4_free</a> (struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#aae422250092661b36915d1769df957f7">str2prefix_ipv4</a> (const char *<a class="el" href="ripng__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#ac618f277d6ed0ebc56781ec26e508157">masklen2ip</a> (int masklen, struct in_addr *netmask)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">u_char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#ab83ffad6b766ddd0ef87e4da228c322d">ip_masklen</a> (struct in_addr netmask)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a24093dc2a781bf7f05d8a410899de5c0">apply_mask_ipv4</a> (struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a042562296bf8a9715da2d77fb226ab25">prefix_ipv4_any</a> (const struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a99265c5e11b1867552cf784a4cac8252">apply_mask</a> (struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#aec236431a98092b2c21d0ff8501e29ff">sockunion2prefix</a> (const union <a class="el" href="unionsockunion.html">sockunion</a> *dest, const union <a class="el" href="unionsockunion.html">sockunion</a> *mask)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a7e9fdfe551fb280a2e9a149a7f742d87">sockunion2hostprefix</a> (const union <a class="el" href="unionsockunion.html">sockunion</a> *su)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#ad076653f7c139acd0fdedb511542e915">prefix_blen</a> (const struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a35f57d44562d00baaf5d227d03214786">str2prefix</a> (const char *<a class="el" href="ripng__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a8b848557695ae5694bd2282eba23e367">prefix2str</a> (const struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, char *<a class="el" href="ripng__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, int size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a334dfe0b68e0de68379895a8ff3057e7">prefix_new</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a5d8a68bc25fb973c471e61aaeb76a015">prefix_free</a> (struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#abca8c8e6c67ae2442bbdbb028e6b11c8">all_digit</a> (const char *<a class="el" href="ripng__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a00e9cb624cf0d2526fbc5a48b340d046">apply_classful_mask_ipv4</a> (struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">in_addr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#ab4067c206567a0757076aa3fb9f285ce">ipv4_network_addr</a> (in_addr_t hostaddr, int masklen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">in_addr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a0416c71ab42c828a9ee8ee82ddda6a77">ipv4_broadcast_addr</a> (in_addr_t hostaddr, int masklen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#ae0eafe597bd81e87765f0231f1012653">netmask_str2prefix_str</a> (const char *net_str, const char *mask_str, char *prefix_str)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const u_char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="prefix_8c.html#a675cc05c7391c1cd5e88ed25175ad5e1">maskbit</a> []</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="af3fe3362bcbca3196b184d9bd871544b"></a><!-- doxytag: member="prefix.c::MASKBIT" ref="af3fe3362bcbca3196b184d9bd871544b" args="(offset)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MASKBIT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">offset</td><td>)</td>
          <td>&#160;&#160;&#160;((0xff &lt;&lt; (PNBBY - (offset))) &amp; 0xff)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00040">40</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6f9a32b2fd315bf69360c883843e8699"></a><!-- doxytag: member="prefix.c::PNBBY" ref="a6f9a32b2fd315bf69360c883843e8699" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PNBBY&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00037">37</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a6d5ede437568763fc6ef7d9cc772b501"></a><!-- doxytag: member="prefix.c::afi2family" ref="a6d5ede437568763fc6ef7d9cc772b501" args="(int afi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int afi2family </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>afi</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00044">44</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (afi == <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>)
    <span class="keywordflow">return</span> AF_INET;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (afi == <a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a>)
    <span class="keywordflow">return</span> AF_INET6;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abca8c8e6c67ae2442bbdbb028e6b11c8"></a><!-- doxytag: member="prefix.c::all_digit" ref="abca8c8e6c67ae2442bbdbb028e6b11c8" args="(const char *str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int all_digit </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>str</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00640">640</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">for</span> (; *<a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> != <span class="charliteral">&#39;\0&#39;</span>; <a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>++)
    <span class="keywordflow">if</span> (!isdigit ((<span class="keywordtype">int</span>) *<a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>))
      <span class="keywordflow">return</span> 0;
  <span class="keywordflow">return</span> 1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a00e9cb624cf0d2526fbc5a48b340d046"></a><!-- doxytag: member="prefix.c::apply_classful_mask_ipv4" ref="a00e9cb624cf0d2526fbc5a48b340d046" args="(struct prefix_ipv4 *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apply_classful_mask_ipv4 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00649">649</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{

  u_int32_t destination;
  
  destination = ntohl (p-&gt;prefix.s_addr);
  
  <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> == <a class="code" href="prefix_8h.html#ab98d836bf20a06de7a7358ab17832002">IPV4_MAX_PREFIXLEN</a>);
  <span class="comment">/* do nothing for host routes */</span>
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IN_CLASSC (destination)) 
    {
      p-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a>=24;
      <a class="code" href="prefix_8c.html#a24093dc2a781bf7f05d8a410899de5c0">apply_mask_ipv4</a>(p);
    }
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IN_CLASSB(destination)) 
    {
      p-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a>=16;
      <a class="code" href="prefix_8c.html#a24093dc2a781bf7f05d8a410899de5c0">apply_mask_ipv4</a>(p);
    }
  <span class="keywordflow">else</span> 
    {
      p-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a>=8;
      <a class="code" href="prefix_8c.html#a24093dc2a781bf7f05d8a410899de5c0">apply_mask_ipv4</a>(p);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a99265c5e11b1867552cf784a4cac8252"></a><!-- doxytag: member="prefix.c::apply_mask" ref="a99265c5e11b1867552cf784a4cac8252" args="(struct prefix *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apply_mask </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00494">494</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>)
    {
      <span class="keywordflow">case</span> AF_INET:
        <a class="code" href="prefix_8c.html#a24093dc2a781bf7f05d8a410899de5c0">apply_mask_ipv4</a> ((<span class="keyword">struct</span> <a class="code" href="structprefix__ipv4.html">prefix_ipv4</a> *)p);
        <span class="keywordflow">break</span>;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>      <span class="keywordflow">case</span> AF_INET6:
        apply_mask_ipv6 ((<span class="keyword">struct</span> prefix_ipv6 *)p);
        <span class="keywordflow">break</span>;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
      <span class="keywordflow">default</span>:
        <span class="keywordflow">break</span>;
    }
  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a24093dc2a781bf7f05d8a410899de5c0"></a><!-- doxytag: member="prefix.c::apply_mask_ipv4" ref="a24093dc2a781bf7f05d8a410899de5c0" args="(struct prefix_ipv4 *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apply_mask_ipv4 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00318">318</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  u_char *pnt;
  <span class="keywordtype">int</span> index;
  <span class="keywordtype">int</span> offset;

  index = p-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> / 8;

  <span class="keywordflow">if</span> (index &lt; 4)
    {
      pnt = (u_char *) &amp;p-&gt;prefix;
      offset = p-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> % 8;

      pnt[index] &amp;= <a class="code" href="prefix_8c.html#a675cc05c7391c1cd5e88ed25175ad5e1">maskbit</a>[offset];
      index++;

      while (index &lt; 4)
    pnt[index++] = 0;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5d1761cfd89b5e35540ece8fe2573299"></a><!-- doxytag: member="prefix.c::family2afi" ref="a5d1761cfd89b5e35540ece8fe2573299" args="(int family)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int family2afi </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>family</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00056">56</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (family == AF_INET)
    <span class="keywordflow">return</span> <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (family == AF_INET6)
    <span class="keywordflow">return</span> <a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a>;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab83ffad6b766ddd0ef87e4da228c322d"></a><!-- doxytag: member="prefix.c::ip_masklen" ref="ab83ffad6b766ddd0ef87e4da228c322d" args="(struct in_addr netmask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u_char ip_masklen </td>
          <td>(</td>
          <td class="paramtype">struct in_addr&#160;</td>
          <td class="paramname"><em>netmask</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00287">287</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  u_char len;
  u_char *pnt;
  u_char *end;
  u_char <a class="code" href="prefix_8h.html#a43e03366be2dd9176e91229d76541ce9">val</a>;

  len = 0;
  pnt = (u_char *) &amp;netmask;
  end = pnt + 4;

  <span class="keywordflow">while</span> ((pnt &lt; end) &amp;&amp; (*pnt == 0xff))
    {
      len+= 8;
      pnt++;
    } 

  <span class="keywordflow">if</span> (pnt &lt; end)
    {
      val = *pnt;
      <span class="keywordflow">while</span> (val)
    {
      len++;
      val &lt;&lt;= 1;
    }
    }
  <span class="keywordflow">return</span> len;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0416c71ab42c828a9ee8ee82ddda6a77"></a><!-- doxytag: member="prefix.c::ipv4_broadcast_addr" ref="a0416c71ab42c828a9ee8ee82ddda6a77" args="(in_addr_t hostaddr, int masklen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">in_addr_t ipv4_broadcast_addr </td>
          <td>(</td>
          <td class="paramtype">in_addr_t&#160;</td>
          <td class="paramname"><em>hostaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>masklen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00685">685</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span>in_addr mask;

  <a class="code" href="prefix_8c.html#ac618f277d6ed0ebc56781ec26e508157">masklen2ip</a> (masklen, &amp;mask);
  <span class="keywordflow">return</span> (masklen != <a class="code" href="prefix_8h.html#ab98d836bf20a06de7a7358ab17832002">IPV4_MAX_PREFIXLEN</a>-1) ?
     <span class="comment">/* normal case */</span>
         (hostaddr | ~mask.s_addr) :
     <span class="comment">/* special case for /31 */</span>
         (hostaddr ^ ~mask.s_addr);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab4067c206567a0757076aa3fb9f285ce"></a><!-- doxytag: member="prefix.c::ipv4_network_addr" ref="ab4067c206567a0757076aa3fb9f285ce" args="(in_addr_t hostaddr, int masklen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">in_addr_t ipv4_network_addr </td>
          <td>(</td>
          <td class="paramtype">in_addr_t&#160;</td>
          <td class="paramname"><em>hostaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>masklen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00676">676</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span>in_addr mask;

  <a class="code" href="prefix_8c.html#ac618f277d6ed0ebc56781ec26e508157">masklen2ip</a> (masklen, &amp;mask);
  <span class="keywordflow">return</span> hostaddr &amp; mask.s_addr;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac618f277d6ed0ebc56781ec26e508157"></a><!-- doxytag: member="prefix.c::masklen2ip" ref="ac618f277d6ed0ebc56781ec26e508157" args="(int masklen, struct in_addr *netmask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void masklen2ip </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>masklen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr *&#160;</td>
          <td class="paramname"><em>netmask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00265">265</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  u_char *pnt;
  <span class="keywordtype">int</span> bit;
  <span class="keywordtype">int</span> offset;

  memset (netmask, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> in_addr));
  pnt = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) netmask;

  offset = masklen / 8;
  bit = masklen % 8;
  
  <span class="keywordflow">while</span> (offset--)
    *pnt++ = 0xff;

  <span class="keywordflow">if</span> (bit)
    *pnt = <a class="code" href="prefix_8c.html#a675cc05c7391c1cd5e88ed25175ad5e1">maskbit</a>[bit];
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae0eafe597bd81e87765f0231f1012653"></a><!-- doxytag: member="prefix.c::netmask_str2prefix_str" ref="ae0eafe597bd81e87765f0231f1012653" args="(const char *net_str, const char *mask_str, char *prefix_str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int netmask_str2prefix_str </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>net_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>mask_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>prefix_str</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00701">701</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span>in_addr <a class="code" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a>;
  <span class="keyword">struct </span>in_addr mask;
  u_char prefixlen;
  u_int32_t destination;
  <span class="keywordtype">int</span> ret;

  ret = <a class="code" href="sockunion_8c.html#a4203367afaacee3fa5cc1626b2ef63c0">inet_aton</a> (net_str, &amp;<a class="code" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a>);
  <span class="keywordflow">if</span> (! ret)
    <span class="keywordflow">return</span> 0;

  <span class="keywordflow">if</span> (mask_str)
    {
      ret = <a class="code" href="sockunion_8c.html#a4203367afaacee3fa5cc1626b2ef63c0">inet_aton</a> (mask_str, &amp;mask);
      <span class="keywordflow">if</span> (! ret)
        <span class="keywordflow">return</span> 0;

      prefixlen = <a class="code" href="prefix_8c.html#ab83ffad6b766ddd0ef87e4da228c322d">ip_masklen</a> (mask);
    }
  <span class="keywordflow">else</span> 
    {
      destination = ntohl (<a class="code" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a>.s_addr);

      <span class="keywordflow">if</span> (<a class="code" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a>.s_addr == 0)
    prefixlen = 0;
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IN_CLASSC (destination))
    prefixlen = 24;
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IN_CLASSB (destination))
    prefixlen = 16;
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IN_CLASSA (destination))
    prefixlen = 8;
      <span class="keywordflow">else</span>
    <span class="keywordflow">return</span> 0;
    }

  sprintf (prefix_str, <span class="stringliteral">&quot;%s/%d&quot;</span>, net_str, prefixlen);

  <span class="keywordflow">return</span> 1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8b848557695ae5694bd2282eba23e367"></a><!-- doxytag: member="prefix.c::prefix2str" ref="a8b848557695ae5694bd2282eba23e367" args="(const struct prefix *p, char *str, int size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int prefix2str </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00611">611</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">char</span> buf[BUFSIZ];

  <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, BUFSIZ);
  <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (<a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, size, <span class="stringliteral">&quot;%s/%d&quot;</span>, buf, p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad076653f7c139acd0fdedb511542e915"></a><!-- doxytag: member="prefix.c::prefix_blen" ref="ad076653f7c139acd0fdedb511542e915" args="(const struct prefix *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int prefix_blen </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00573">573</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>) 
    {
    <span class="keywordflow">case</span> AF_INET:
      <span class="keywordflow">return</span> <a class="code" href="prefix_8h.html#a013983d7a5267a63023c50ab32a85c24">IPV4_MAX_BYTELEN</a>;
      <span class="keywordflow">break</span>;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>    <span class="keywordflow">case</span> AF_INET6:
      <span class="keywordflow">return</span> <a class="code" href="prefix_8h.html#ac2642af4f4d7a4209ad6261e72c658f9">IPV6_MAX_BYTELEN</a>;
      <span class="keywordflow">break</span>;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
    }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a203098ec44d398d5c8692082d8cae725"></a><!-- doxytag: member="prefix.c::prefix_cmp" ref="a203098ec44d398d5c8692082d8cae725" args="(const struct prefix *p1, const struct prefix *p2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int prefix_cmp </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00157">157</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> offset;
  <span class="keywordtype">int</span> shift;

  <span class="comment">/* Set both prefix&#39;s head pointer. */</span>
  <span class="keyword">const</span> u_char *pp1 = (<span class="keyword">const</span> u_char *)&amp;p1-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>;
  <span class="keyword">const</span> u_char *pp2 = (<span class="keyword">const</span> u_char *)&amp;p2-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>;

  <span class="keywordflow">if</span> (p1-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> != p2-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> || p1-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> != p2-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>)
    <span class="keywordflow">return</span> 1;

  offset = p1-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> / 8;
  shift = p1-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> % 8;

  <span class="keywordflow">if</span> (shift)
    <span class="keywordflow">if</span> (<a class="code" href="prefix_8c.html#a675cc05c7391c1cd5e88ed25175ad5e1">maskbit</a>[shift] &amp; (pp1[offset] ^ pp2[offset]))
      <span class="keywordflow">return</span> 1;

  <span class="keywordflow">while</span> (offset--)
    <span class="keywordflow">if</span> (pp1[offset] != pp2[offset])
      <span class="keywordflow">return</span> 1;

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abaad44d47b408d45484fdd729ab501b2"></a><!-- doxytag: member="prefix.c::prefix_copy" ref="abaad44d47b408d45484fdd729ab501b2" args="(struct prefix *dest, const struct prefix *src)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void prefix_copy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>src</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00097">97</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  dest-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> = src-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>;
  dest-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> = src-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>;

  <span class="keywordflow">if</span> (src-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET)
    dest-&gt;u.<a class="code" href="structprefix.html#ab37b8922554b41b7dc2417d8f37e7829">prefix4</a> = src-&gt;u.<a class="code" href="structprefix.html#ab37b8922554b41b7dc2417d8f37e7829">prefix4</a>;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (src-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6)
    dest-&gt;u.prefix6 = src-&gt;u.prefix6;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (src-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_UNSPEC)
    {
      dest-&gt;u.<a class="code" href="structprefix.html#a416d94ff668bb11283d8e2aee61cca72">lp</a>.id = src-&gt;u.<a class="code" href="structprefix.html#a416d94ff668bb11283d8e2aee61cca72">lp</a>.id;
      dest-&gt;u.<a class="code" href="structprefix.html#a416d94ff668bb11283d8e2aee61cca72">lp</a>.adv_router = src-&gt;u.<a class="code" href="structprefix.html#a416d94ff668bb11283d8e2aee61cca72">lp</a>.adv_router;
    }
  <span class="keywordflow">else</span>
    {
      <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_ERR, <span class="stringliteral">&quot;prefix_copy(): Unknown address family %d&quot;</span>,
          src-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>);
      <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (0);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a857a677dba88a14eab7a4090d0bcd3fe"></a><!-- doxytag: member="prefix.c::prefix_family_str" ref="a857a677dba88a14eab7a4090d0bcd3fe" args="(const struct prefix *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* prefix_family_str </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00185">185</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET)
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;inet&quot;</span>;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6)
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;inet6&quot;</span>;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  <span class="keywordflow">return</span> <span class="stringliteral">&quot;unspec&quot;</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5d8a68bc25fb973c471e61aaeb76a015"></a><!-- doxytag: member="prefix.c::prefix_free" ref="a5d8a68bc25fb973c471e61aaeb76a015" args="(struct prefix *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void prefix_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00631">631</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba00593e6e9d5a4e7185791c7a301cc53a">MTYPE_PREFIX</a>, p);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a042562296bf8a9715da2d77fb226ab25"></a><!-- doxytag: member="prefix.c::prefix_ipv4_any" ref="a042562296bf8a9715da2d77fb226ab25" args="(const struct prefix_ipv4 *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int prefix_ipv4_any </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00341">341</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> (p-&gt;prefix.s_addr == 0 &amp;&amp; p-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> == 0);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a226bbb39f0a469263b369d16b58ab62f"></a><!-- doxytag: member="prefix.c::prefix_ipv4_free" ref="a226bbb39f0a469263b369d16b58ab62f" args="(struct prefix_ipv4 *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void prefix_ipv4_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00212">212</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="prefix_8c.html#a5d8a68bc25fb973c471e61aaeb76a015">prefix_free</a>((<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *)p);
}
</pre></div>
</div>
</div>
<a class="anchor" id="af674876d8d874e88225f559322d797ac"></a><!-- doxytag: member="prefix.c::prefix_ipv4_new" ref="af674876d8d874e88225f559322d797ac" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a>* prefix_ipv4_new </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00198">198</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structprefix__ipv4.html">prefix_ipv4</a> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;

  <span class="comment">/* Call prefix_new to allocate a full-size struct prefix to avoid problems</span>
<span class="comment">     where the struct prefix_ipv4 is cast to struct prefix and unallocated</span>
<span class="comment">     bytes were being referenced (e.g. in structure assignments). */</span>
  p = (<span class="keyword">struct </span><a class="code" href="structprefix__ipv4.html">prefix_ipv4</a> *)<a class="code" href="prefix_8c.html#a334dfe0b68e0de68379895a8ff3057e7">prefix_new</a>();
  p-&gt;<a class="code" href="structprefix__ipv4.html#a3a879ea08458c4807130156f5f23dbc7">family</a> = AF_INET;
  <span class="keywordflow">return</span> <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8c5d68665a4b036a361330bee254318e"></a><!-- doxytag: member="prefix.c::prefix_match" ref="a8c5d68665a4b036a361330bee254318e" args="(const struct prefix *n, const struct prefix *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int prefix_match </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00069">69</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> offset;
  <span class="keywordtype">int</span> shift;

  <span class="comment">/* Set both prefix&#39;s head pointer. */</span>
  <span class="keyword">const</span> u_char *<a class="code" href="spgrid_8c.html#a928495140935d9d6ce0a100550473140">np</a> = (<span class="keyword">const</span> u_char *)&amp;n-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>;
  <span class="keyword">const</span> u_char *pp = (<span class="keyword">const</span> u_char *)&amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>;

  <span class="comment">/* If n&#39;s prefix is longer than p&#39;s one return 0. */</span>
  <span class="keywordflow">if</span> (n-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> &gt; p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>)
    <span class="keywordflow">return</span> 0;

  offset = n-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> / <a class="code" href="prefix_8c.html#a6f9a32b2fd315bf69360c883843e8699">PNBBY</a>;
  shift =  n-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> % <a class="code" href="prefix_8c.html#a6f9a32b2fd315bf69360c883843e8699">PNBBY</a>;

  <span class="keywordflow">if</span> (shift)
    <span class="keywordflow">if</span> (<a class="code" href="prefix_8c.html#a675cc05c7391c1cd5e88ed25175ad5e1">maskbit</a>[shift] &amp; (np[offset] ^ pp[offset]))
      <span class="keywordflow">return</span> 0;
  
  <span class="keywordflow">while</span> (offset--)
    <span class="keywordflow">if</span> (np[offset] != pp[offset])
      <span class="keywordflow">return</span> 0;
  <span class="keywordflow">return</span> 1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a334dfe0b68e0de68379895a8ff3057e7"></a><!-- doxytag: member="prefix.c::prefix_new" ref="a334dfe0b68e0de68379895a8ff3057e7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structprefix.html">prefix</a>* prefix_new </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00621">621</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;

  p = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba00593e6e9d5a4e7185791c7a301cc53a">MTYPE_PREFIX</a>, <span class="keyword">sizeof</span> *p);
  <span class="keywordflow">return</span> <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac3645297b5669182b5052aa7689712af"></a><!-- doxytag: member="prefix.c::prefix_same" ref="ac3645297b5669182b5052aa7689712af" args="(const struct prefix *p1, const struct prefix *p2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int prefix_same </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00130">130</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (p1-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == p2-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> &amp;&amp; p1-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> == p2-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>)
    {
      <span class="keywordflow">if</span> (p1-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET)
    <span class="keywordflow">if</span> (<a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a> (&amp;p1-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, &amp;p2-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>))
      <span class="keywordflow">return</span> 1;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>      <span class="keywordflow">if</span> (p1-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6 )
    <span class="keywordflow">if</span> (<a class="code" href="prefix_8h.html#a5f1eaa85b153050a498dacc958ab8283">IPV6_ADDR_SAME</a> (&amp;p1-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, &amp;p2-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>))
      <span class="keywordflow">return</span> 1;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
    }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7e9fdfe551fb280a2e9a149a7f742d87"></a><!-- doxytag: member="prefix.c::sockunion2hostprefix" ref="a7e9fdfe551fb280a2e9a149a7f742d87" args="(const union sockunion *su)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structprefix.html">prefix</a>* sockunion2hostprefix </td>
          <td>(</td>
          <td class="paramtype">const union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em></td><td>)</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00545">545</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family == AF_INET)
    {
      <span class="keyword">struct </span><a class="code" href="structprefix__ipv4.html">prefix_ipv4</a> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;

      p = <a class="code" href="prefix_8c.html#af674876d8d874e88225f559322d797ac">prefix_ipv4_new</a> ();
      p-&gt;<a class="code" href="structprefix__ipv4.html#a3a879ea08458c4807130156f5f23dbc7">family</a> = AF_INET;
      p-&gt;prefix = su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr;
      p-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> = <a class="code" href="prefix_8h.html#a9bd48f210d9f91d189e70196918f82c6">IPV4_MAX_BITLEN</a>;
      <span class="keywordflow">return</span> (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *) <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
    }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family == AF_INET6)
    {
      <span class="keyword">struct </span>prefix_ipv6 *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;

      p = prefix_ipv6_new ();
      p-&gt;family = AF_INET6;
      p-&gt;prefixlen = <a class="code" href="prefix_8h.html#a05e4b561a81bb5a6f28ac69717d25dbb">IPV6_MAX_BITLEN</a>;
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;p-&gt;prefix, &amp;su-&gt;sin6.sin6_addr, sizeof (<span class="keyword">struct</span> in6_addr));
      <span class="keywordflow">return</span> (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *) <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aec236431a98092b2c21d0ff8501e29ff"></a><!-- doxytag: member="prefix.c::sockunion2prefix" ref="aec236431a98092b2c21d0ff8501e29ff" args="(const union sockunion *dest, const union sockunion *mask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structprefix.html">prefix</a>* sockunion2prefix </td>
          <td>(</td>
          <td class="paramtype">const union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>mask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00515">515</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (dest-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family == AF_INET)
    {
      <span class="keyword">struct </span><a class="code" href="structprefix__ipv4.html">prefix_ipv4</a> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;

      p = <a class="code" href="prefix_8c.html#af674876d8d874e88225f559322d797ac">prefix_ipv4_new</a> ();
      p-&gt;<a class="code" href="structprefix__ipv4.html#a3a879ea08458c4807130156f5f23dbc7">family</a> = AF_INET;
      p-&gt;prefix = dest-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr;
      p-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> = <a class="code" href="prefix_8c.html#ab83ffad6b766ddd0ef87e4da228c322d">ip_masklen</a> (mask-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr);
      <span class="keywordflow">return</span> (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *) <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
    }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (dest-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family == AF_INET6)
    {
      <span class="keyword">struct </span>prefix_ipv6 *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;

      p = prefix_ipv6_new ();
      p-&gt;family = AF_INET6;
      p-&gt;prefixlen = ip6_masklen (mask-&gt;sin6.sin6_addr);
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;p-&gt;prefix, &amp;dest-&gt;sin6.sin6_addr, sizeof (<span class="keyword">struct</span> in6_addr));
      <span class="keywordflow">return</span> (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *) <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a35f57d44562d00baaf5d227d03214786"></a><!-- doxytag: member="prefix.c::str2prefix" ref="a35f57d44562d00baaf5d227d03214786" args="(const char *str, struct prefix *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int str2prefix </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00591">591</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;

  <span class="comment">/* First we try to convert string to struct prefix_ipv4. */</span>
  ret = <a class="code" href="prefix_8c.html#aae422250092661b36915d1769df957f7">str2prefix_ipv4</a> (<a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, (<span class="keyword">struct</span> <a class="code" href="structprefix__ipv4.html">prefix_ipv4</a> *) p);
  <span class="keywordflow">if</span> (ret)
    <span class="keywordflow">return</span> ret;

<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="comment">/* Next we try to convert string to struct prefix_ipv6. */</span>
  ret = str2prefix_ipv6 (<a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, (<span class="keyword">struct</span> prefix_ipv6 *) p);
  <span class="keywordflow">if</span> (ret)
    <span class="keywordflow">return</span> ret;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aae422250092661b36915d1769df957f7"></a><!-- doxytag: member="prefix.c::str2prefix_ipv4" ref="aae422250092661b36915d1769df957f7" args="(const char *str, struct prefix_ipv4 *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int str2prefix_ipv4 </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a> *&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="prefix_8c_source.html#l00219">219</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <span class="keywordtype">int</span> plen;
  <span class="keywordtype">char</span> *pnt;
  <span class="keywordtype">char</span> *cp;

  <span class="comment">/* Find slash inside string. */</span>
  pnt = strchr (<a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, <span class="charliteral">&#39;/&#39;</span>);

  <span class="comment">/* String doesn&#39;t contail slash. */</span>
  <span class="keywordflow">if</span> (pnt == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) 
    {
      <span class="comment">/* Convert string to prefix. */</span>
      ret = <a class="code" href="sockunion_8c.html#a4203367afaacee3fa5cc1626b2ef63c0">inet_aton</a> (<a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, &amp;p-&gt;prefix);
      <span class="keywordflow">if</span> (ret == 0)
    <span class="keywordflow">return</span> 0;

      <span class="comment">/* If address doesn&#39;t contain slash we assume it host address. */</span>
      p-&gt;<a class="code" href="structprefix__ipv4.html#a3a879ea08458c4807130156f5f23dbc7">family</a> = AF_INET;
      p-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> = <a class="code" href="prefix_8h.html#a9bd48f210d9f91d189e70196918f82c6">IPV4_MAX_BITLEN</a>;

      <span class="keywordflow">return</span> ret;
    }
  <span class="keywordflow">else</span>
    {
      cp = <a class="code" href="memory_8h.html#a6491adf46c1d769b529a8f2f7d75f2fe">XMALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba563963518edb70d4cd7492b06f48106e">MTYPE_TMP</a>, (pnt - <a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>) + 1);
      strncpy (cp, <a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, pnt - <a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>);
      *(cp + (pnt - <a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>)) = <span class="charliteral">&#39;\0&#39;</span>;
      ret = <a class="code" href="sockunion_8c.html#a4203367afaacee3fa5cc1626b2ef63c0">inet_aton</a> (cp, &amp;p-&gt;prefix);
      <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba563963518edb70d4cd7492b06f48106e">MTYPE_TMP</a>, cp);

      <span class="comment">/* Get prefix length. */</span>
      plen = (u_char) atoi (++pnt);
      <span class="keywordflow">if</span> (plen &gt; <a class="code" href="prefix_8h.html#ab98d836bf20a06de7a7358ab17832002">IPV4_MAX_PREFIXLEN</a>)
    <span class="keywordflow">return</span> 0;

      p-&gt;<a class="code" href="structprefix__ipv4.html#a3a879ea08458c4807130156f5f23dbc7">family</a> = AF_INET;
      p-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> = plen;
    }

  <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a675cc05c7391c1cd5e88ed25175ad5e1"></a><!-- doxytag: member="prefix.c::maskbit" ref="a675cc05c7391c1cd5e88ed25175ad5e1" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const u_char <a class="el" href="table_8c.html#a675cc05c7391c1cd5e88ed25175ad5e1">maskbit</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {0x00, 0x80, 0xc0, 0xe0, 0xf0,
                     0xf8, 0xfc, 0xfe, 0xff}
</pre></div>
<p>Definition at line <a class="el" href="prefix_8c_source.html#l00032">32</a> of file <a class="el" href="prefix_8c_source.html">prefix.c</a>.</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="prefix_8c.html">prefix.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:23 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
