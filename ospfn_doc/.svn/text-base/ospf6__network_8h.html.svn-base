<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: ospf6d/ospf6_network.h File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ospf6__network_8h.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">ospf6d/ospf6_network.h File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="ospf6__network_8h__dep__incl.png" border="0" usemap="#ospf6d_2ospf6__network_8hdep" alt=""/></div>
<map name="ospf6d_2ospf6__network_8hdep" id="ospf6d_2ospf6__network_8hdep">
<area shape="rect" id="node3" href="ospf6__interface_8c.html" title="ospf6d/ospf6_interface.c" alt="" coords="5,80,176,107"/><area shape="rect" id="node5" href="ospf6__message_8c.html" title="ospf6d/ospf6_message.c" alt="" coords="201,80,375,107"/><area shape="rect" id="node7" href="ospf6__network_8c.html" title="ospf6d/ospf6_network.c" alt="" coords="400,80,568,107"/><area shape="rect" id="node9" href="ospf6d_8c.html" title="ospf6d/ospf6d.c" alt="" coords="592,80,712,107"/></map>
</div>
</div>
<p><a href="ospf6__network_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#a6edb22d7e2f7613fb293a89dec93f7dc">ospf6_set_reuseaddr</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#ad32db346b0a1e4b5e40e194023535265">ospf6_reset_mcastloop</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#a7e6dc2b84bc15d8f8ca3fc83687119a5">ospf6_set_pktinfo</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#a44911f08e04b9e4fb1505243feb6cea3">ospf6_set_checksum</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#ab0ec5bd2c4077a4e9bb175a9a500d2ce">ospf6_serv_sock</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#ac8a2a2c77e161182a6735e01951456e7">ospf6_join_allspfrouters</a> (u_int)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#a9a5e8a092f42d80e83b5006709734d1b">ospf6_leave_allspfrouters</a> (u_int)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#ac0c4a61ef3c8a9ef87aa7bb748f47063">ospf6_join_alldrouters</a> (u_int)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#a7cc80406f5ef503a7bd24b36ff3e67d5">ospf6_leave_alldrouters</a> (u_int)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#adb64eac85305fbf12c019dad2d2ef8d5">ospf6_sendmsg</a> (struct in6_addr *, struct in6_addr *, unsigned int *, struct iovec *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#aa98b7a22e0da67cc82337b6afd524593">ospf6_recvmsg</a> (struct in6_addr *, struct in6_addr *, unsigned int *, struct iovec *)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct in6_addr&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#a8f18d0317b172f8e2b317e4583a16933">allspfrouters6</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct in6_addr&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf6__network_8h.html#a09927a6bc76695ca91bbd7a8e3e1beae">alldrouters6</a></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ac0c4a61ef3c8a9ef87aa7bb748f47063"></a><!-- doxytag: member="ospf6_network.h::ospf6_join_alldrouters" ref="ac0c4a61ef3c8a9ef87aa7bb748f47063" args="(u_int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf6_join_alldrouters </td>
          <td>(</td>
          <td class="paramtype">u_int&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00158">158</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span>ipv6_mreq mreq6;

  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (ifindex);
  mreq6.ipv6mr_interface = ifindex;
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;mreq6.ipv6mr_multiaddr, &amp;<a class="code" href="ospf6__network_8c.html#a09927a6bc76695ca91bbd7a8e3e1beae">alldrouters6</a>,
          sizeof (<span class="keyword">struct</span> in6_addr));

  <span class="keywordflow">if</span> (setsockopt (<a class="code" href="ospf6__network_8c.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a>, IPPROTO_IPV6, <a class="code" href="ripng__interface_8c.html#a4ff6253432e91b991fc9f52243508724">IPV6_JOIN_GROUP</a>,
                  &amp;mreq6, <span class="keyword">sizeof</span> (mreq6)) &lt; 0)
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Network: Join AllDRouters on ifindex %d Failed: %s&quot;</span>,
               ifindex, <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno));
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>  <span class="keywordflow">else</span>
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Network: Join AllDRouters on ifindex %d&quot;</span>, ifindex);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="ac8a2a2c77e161182a6735e01951456e7"></a><!-- doxytag: member="ospf6_network.h::ospf6_join_allspfrouters" ref="ac8a2a2c77e161182a6735e01951456e7" args="(u_int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf6_join_allspfrouters </td>
          <td>(</td>
          <td class="paramtype">u_int&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00115">115</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span>ipv6_mreq mreq6;
  <span class="keywordtype">int</span> retval;

  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (ifindex);
  mreq6.ipv6mr_interface = ifindex;
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;mreq6.ipv6mr_multiaddr, &amp;<a class="code" href="ospf6__network_8c.html#a8f18d0317b172f8e2b317e4583a16933">allspfrouters6</a>,
          sizeof (<span class="keyword">struct</span> in6_addr));

  retval = setsockopt (<a class="code" href="ospf6__network_8c.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a>, IPPROTO_IPV6, <a class="code" href="ripng__interface_8c.html#a4ff6253432e91b991fc9f52243508724">IPV6_JOIN_GROUP</a>,
                       &amp;mreq6, <span class="keyword">sizeof</span> (mreq6));

  <span class="keywordflow">if</span> (retval &lt; 0)
    <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;Network: Join AllSPFRouters on ifindex %d failed: %s&quot;</span>,
              ifindex, <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno));
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>  <span class="keywordflow">else</span>
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Network: Join AllSPFRouters on ifindex %d&quot;</span>, ifindex);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="a7cc80406f5ef503a7bd24b36ff3e67d5"></a><!-- doxytag: member="ospf6_network.h::ospf6_leave_alldrouters" ref="a7cc80406f5ef503a7bd24b36ff3e67d5" args="(u_int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf6_leave_alldrouters </td>
          <td>(</td>
          <td class="paramtype">u_int&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00178">178</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span>ipv6_mreq mreq6;

  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (ifindex);
  mreq6.ipv6mr_interface = ifindex;
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;mreq6.ipv6mr_multiaddr, &amp;<a class="code" href="ospf6__network_8c.html#a09927a6bc76695ca91bbd7a8e3e1beae">alldrouters6</a>,
          sizeof (<span class="keyword">struct</span> in6_addr));

  <span class="keywordflow">if</span> (setsockopt (<a class="code" href="ospf6__network_8c.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a>, IPPROTO_IPV6, <a class="code" href="ripng__interface_8c.html#a646d950859a748ed739ab6677682ba01">IPV6_LEAVE_GROUP</a>,
                  &amp;mreq6, <span class="keyword">sizeof</span> (mreq6)) &lt; 0)
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Network: Leave AllDRouters on ifindex %d Failed&quot;</span>, ifindex);
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>  <span class="keywordflow">else</span>
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Network: Leave AllDRouters on ifindex %d&quot;</span>, ifindex);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="a9a5e8a092f42d80e83b5006709734d1b"></a><!-- doxytag: member="ospf6_network.h::ospf6_leave_allspfrouters" ref="a9a5e8a092f42d80e83b5006709734d1b" args="(u_int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf6_leave_allspfrouters </td>
          <td>(</td>
          <td class="paramtype">u_int&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00138">138</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span>ipv6_mreq mreq6;

  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (ifindex);
  mreq6.ipv6mr_interface = ifindex;
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;mreq6.ipv6mr_multiaddr, &amp;<a class="code" href="ospf6__network_8c.html#a8f18d0317b172f8e2b317e4583a16933">allspfrouters6</a>,
          sizeof (<span class="keyword">struct</span> in6_addr));

  <span class="keywordflow">if</span> (setsockopt (<a class="code" href="ospf6__network_8c.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a>, IPPROTO_IPV6, <a class="code" href="ripng__interface_8c.html#a646d950859a748ed739ab6677682ba01">IPV6_LEAVE_GROUP</a>,
                  &amp;mreq6, <span class="keyword">sizeof</span> (mreq6)) &lt; 0)
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Network: Leave AllSPFRouters on ifindex %d Failed: %s&quot;</span>,
               ifindex, <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno));
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>  <span class="keywordflow">else</span>
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Network: Leave AllSPFRouters on ifindex %d&quot;</span>, ifindex);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="aa98b7a22e0da67cc82337b6afd524593"></a><!-- doxytag: member="ospf6_network.h::ospf6_recvmsg" ref="aa98b7a22e0da67cc82337b6afd524593" args="(struct in6_addr *, struct in6_addr *, unsigned int *, struct iovec *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ospf6_recvmsg </td>
          <td>(</td>
          <td class="paramtype">struct in6_addr *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in6_addr *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct iovec *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00274">274</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> retval;
  <span class="keyword">struct </span>msghdr rmsghdr;
  <span class="keyword">struct </span>cmsghdr *rcmsgp;
  u_char cmsgbuf[<a class="code" href="zebra_8h.html#a0769bfc51cb1ffd3fe7f79fe3bf527f3">CMSG_SPACE</a>(<span class="keyword">sizeof</span> (<span class="keyword">struct</span> in6_pktinfo))];
  <span class="keyword">struct </span>in6_pktinfo *pktinfo;
  <span class="keyword">struct </span>sockaddr_in6 src_sin6;

  rcmsgp = (<span class="keyword">struct </span>cmsghdr *)cmsgbuf;
  pktinfo = (<span class="keyword">struct </span>in6_pktinfo *)(CMSG_DATA(rcmsgp));
  memset (&amp;src_sin6, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> sockaddr_in6));

  <span class="comment">/* receive control msg */</span>
  rcmsgp-&gt;cmsg_level = IPPROTO_IPV6;
  rcmsgp-&gt;cmsg_type = IPV6_PKTINFO;
  rcmsgp-&gt;cmsg_len = <a class="code" href="zebra_8h.html#a0a270c323a1b54a4bfca7c3485e0b6bf">CMSG_LEN</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> in6_pktinfo));
  <span class="comment">/* rcmsgp = CMSG_NXTHDR (&amp;rmsghdr, rcmsgp); */</span>

  <span class="comment">/* receive msg hdr */</span>
  memset (&amp;rmsghdr, 0, <span class="keyword">sizeof</span> (rmsghdr));
  rmsghdr.msg_iov = <a class="code" href="structmessage.html">message</a>;
  rmsghdr.msg_iovlen = <a class="code" href="ospf6__network_8c.html#a92802d477cb25da36f2c6e0d02c7fb77">iov_count</a> (<a class="code" href="structmessage.html">message</a>);
  rmsghdr.msg_name = (caddr_t) &amp;src_sin6;
  rmsghdr.msg_namelen = <span class="keyword">sizeof</span> (<span class="keyword">struct </span>sockaddr_in6);
  rmsghdr.msg_control = (caddr_t) cmsgbuf;
  rmsghdr.msg_controllen = <span class="keyword">sizeof</span> (cmsgbuf);

  retval = recvmsg (<a class="code" href="ospf6__network_8c.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a>, &amp;rmsghdr, 0);
  <span class="keywordflow">if</span> (retval &lt; 0)
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;recvmsg failed: %s&quot;</span>, <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno));
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (retval == <a class="code" href="ospf6__network_8c.html#ab80e9a19de745387e5d28dcabd144c73">iov_totallen</a> (<a class="code" href="structmessage.html">message</a>))
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;recvmsg read full buffer size: %d&quot;</span>, retval);

  <span class="comment">/* source address */</span>
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (src);
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (src, &amp;src_sin6.sin6_addr, sizeof (<span class="keyword">struct</span> in6_addr));

  <span class="comment">/* destination address */</span>
  <span class="keywordflow">if</span> (ifindex)
    *ifindex = pktinfo-&gt;ipi6_ifindex;
  <span class="keywordflow">if</span> (dst)
    <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (dst, &amp;pktinfo-&gt;ipi6_addr, sizeof (<span class="keyword">struct</span> in6_addr));

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad32db346b0a1e4b5e40e194023535265"></a><!-- doxytag: member="ospf6_network.h::ospf6_reset_mcastloop" ref="ad32db346b0a1e4b5e40e194023535265" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf6_reset_mcastloop </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00051">51</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  u_int off = 0;
  <span class="keywordflow">if</span> (setsockopt (<a class="code" href="ospf6__network_8c.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a>, IPPROTO_IPV6, IPV6_MULTICAST_LOOP,
                  &amp;off, <span class="keyword">sizeof</span> (u_int)) &lt; 0)
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Network: reset IPV6_MULTICAST_LOOP failed: %s&quot;</span>,
               <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno));
}
</pre></div>
</div>
</div>
<a class="anchor" id="adb64eac85305fbf12c019dad2d2ef8d5"></a><!-- doxytag: member="ospf6_network.h::ospf6_sendmsg" ref="adb64eac85305fbf12c019dad2d2ef8d5" args="(struct in6_addr *, struct in6_addr *, unsigned int *, struct iovec *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ospf6_sendmsg </td>
          <td>(</td>
          <td class="paramtype">struct in6_addr *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in6_addr *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct iovec *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00216">216</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> retval;
  <span class="keyword">struct </span>msghdr smsghdr;
  <span class="keyword">struct </span>cmsghdr *scmsgp;
  u_char cmsgbuf[<a class="code" href="zebra_8h.html#a0769bfc51cb1ffd3fe7f79fe3bf527f3">CMSG_SPACE</a>(<span class="keyword">sizeof</span> (<span class="keyword">struct</span> in6_pktinfo))];
  <span class="keyword">struct </span>in6_pktinfo *pktinfo;
  <span class="keyword">struct </span>sockaddr_in6 dst_sin6;

  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (dst);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (*ifindex);

  scmsgp = (<span class="keyword">struct </span>cmsghdr *)cmsgbuf;
  pktinfo = (<span class="keyword">struct </span>in6_pktinfo *)(CMSG_DATA(scmsgp));
  memset (&amp;dst_sin6, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> sockaddr_in6));

  <span class="comment">/* source address */</span>
  pktinfo-&gt;ipi6_ifindex = *ifindex;
  <span class="keywordflow">if</span> (src)
    <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;pktinfo-&gt;ipi6_addr, src, sizeof (<span class="keyword">struct</span> in6_addr));
  <span class="keywordflow">else</span>
    memset (&amp;pktinfo-&gt;ipi6_addr, 0, sizeof (<span class="keyword">struct</span> in6_addr));

  <span class="comment">/* destination address */</span>
  dst_sin6.sin6_family = AF_INET6;
<span class="preprocessor">#ifdef SIN6_LEN</span>
<span class="preprocessor"></span>  dst_sin6.sin6_len = <span class="keyword">sizeof</span> (<span class="keyword">struct </span>sockaddr_in6);
<span class="preprocessor">#endif </span><span class="comment">/*SIN6_LEN*/</span>
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;dst_sin6.sin6_addr, dst, sizeof (<span class="keyword">struct</span> in6_addr));
<span class="preprocessor">#ifdef HAVE_SIN6_SCOPE_ID</span>
<span class="preprocessor"></span>  dst_sin6.sin6_scope_id = *ifindex;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="comment">/* send control msg */</span>
  scmsgp-&gt;cmsg_level = IPPROTO_IPV6;
  scmsgp-&gt;cmsg_type = IPV6_PKTINFO;
  scmsgp-&gt;cmsg_len = <a class="code" href="zebra_8h.html#a0a270c323a1b54a4bfca7c3485e0b6bf">CMSG_LEN</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> in6_pktinfo));
  <span class="comment">/* scmsgp = CMSG_NXTHDR (&amp;smsghdr, scmsgp); */</span>

  <span class="comment">/* send msg hdr */</span>
  memset (&amp;smsghdr, 0, <span class="keyword">sizeof</span> (smsghdr));
  smsghdr.msg_iov = <a class="code" href="structmessage.html">message</a>;
  smsghdr.msg_iovlen = <a class="code" href="ospf6__network_8c.html#a92802d477cb25da36f2c6e0d02c7fb77">iov_count</a> (<a class="code" href="structmessage.html">message</a>);
  smsghdr.msg_name = (caddr_t) &amp;dst_sin6;
  smsghdr.msg_namelen = <span class="keyword">sizeof</span> (<span class="keyword">struct </span>sockaddr_in6);
  smsghdr.msg_control = (caddr_t) cmsgbuf;
  smsghdr.msg_controllen = <span class="keyword">sizeof</span> (cmsgbuf);

  retval = sendmsg (<a class="code" href="ospf6__network_8c.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a>, &amp;smsghdr, 0);
  <span class="keywordflow">if</span> (retval != <a class="code" href="ospf6__network_8c.html#ab80e9a19de745387e5d28dcabd144c73">iov_totallen</a> (<a class="code" href="structmessage.html">message</a>))
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;sendmsg failed: ifindex: %d: %s (%d)&quot;</span>,
               *ifindex, <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno), errno);

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab0ec5bd2c4077a4e9bb175a9a500d2ce"></a><!-- doxytag: member="ospf6_network.h::ospf6_serv_sock" ref="ab0ec5bd2c4077a4e9bb175a9a500d2ce" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ospf6_serv_sock </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00081">81</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (<a class="code" href="ospf6__main_8c.html#ab26f7059dc392a4f713867aadf4cacb3">ospf6d_privs</a>.<a class="code" href="structzebra__privs__t.html#a0c59dbc0ec6187b60a824ec421cc34c1">change</a> (<a class="code" href="privs_8h.html#aae029fe88e2d02bee4d46a2f458bd3e5a5395269196ee9bd07257f8b2b35c25fa">ZPRIVS_RAISE</a>))
    <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;ospf6_serv_sock: could not raise privs&quot;</span>);

  <a class="code" href="ospf6__network_8c.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a> = socket (AF_INET6, SOCK_RAW, <a class="code" href="ospf6__proto_8h.html#ade45b7018bfdffd626877565c14318e2">IPPROTO_OSPFIGP</a>);
  <span class="keywordflow">if</span> (<a class="code" href="ospf6__network_8c.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a> &lt; 0)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Network: can&#39;t create OSPF6 socket.&quot;</span>);
      <span class="keywordflow">if</span> (<a class="code" href="ospf6__main_8c.html#ab26f7059dc392a4f713867aadf4cacb3">ospf6d_privs</a>.<a class="code" href="structzebra__privs__t.html#a0c59dbc0ec6187b60a824ec421cc34c1">change</a> (<a class="code" href="privs_8h.html#aae029fe88e2d02bee4d46a2f458bd3e5a7da2c6956cf712f8adc04ff2b0f072c5">ZPRIVS_LOWER</a>))
        <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;ospf_sock_init: could not lower privs&quot;</span>);
      <span class="keywordflow">return</span> -1;
    }
  <span class="keywordflow">if</span> (<a class="code" href="ospf6__main_8c.html#ab26f7059dc392a4f713867aadf4cacb3">ospf6d_privs</a>.<a class="code" href="structzebra__privs__t.html#a0c59dbc0ec6187b60a824ec421cc34c1">change</a> (<a class="code" href="privs_8h.html#aae029fe88e2d02bee4d46a2f458bd3e5a7da2c6956cf712f8adc04ff2b0f072c5">ZPRIVS_LOWER</a>))
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;ospf_sock_init: could not lower privs&quot;</span>);

  <span class="comment">/* set socket options */</span>
<span class="preprocessor">#if 1</span>
<span class="preprocessor"></span>  <a class="code" href="sockunion_8c.html#aa177c0a1e91bd7ac7af8d703768a56bc">sockopt_reuseaddr</a> (<a class="code" href="ospf6__network_8c.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a>);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>  <a class="code" href="ospf6__network_8c.html#a6edb22d7e2f7613fb293a89dec93f7dc">ospf6_set_reuseaddr</a> ();
<span class="preprocessor">#endif </span><span class="comment">/*1*/</span>
  <a class="code" href="ospf6__network_8c.html#ad32db346b0a1e4b5e40e194023535265">ospf6_reset_mcastloop</a> ();
  <a class="code" href="ospf6__network_8c.html#a7e6dc2b84bc15d8f8ca3fc83687119a5">ospf6_set_pktinfo</a> ();
  <a class="code" href="ospf6__network_8c.html#a44911f08e04b9e4fb1505243feb6cea3">ospf6_set_checksum</a> ();

  <span class="comment">/* setup global in6_addr, allspf6 and alldr6 for later use */</span>
  <a class="code" href="sockunion_8c.html#ac13c2042641ea5031bc7e244e8061b84">inet_pton</a> (AF_INET6, <a class="code" href="ospf6__proto_8h.html#a77af8bc39e9660ad44d362e0431d5e13">ALLSPFROUTERS6</a>, &amp;<a class="code" href="ospf6__network_8c.html#a8f18d0317b172f8e2b317e4583a16933">allspfrouters6</a>);
  <a class="code" href="sockunion_8c.html#ac13c2042641ea5031bc7e244e8061b84">inet_pton</a> (AF_INET6, <a class="code" href="ospf6__proto_8h.html#ade55daa000a3e5fdec5f63d253036358">ALLDROUTERS6</a>, &amp;<a class="code" href="ospf6__network_8c.html#a09927a6bc76695ca91bbd7a8e3e1beae">alldrouters6</a>);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a44911f08e04b9e4fb1505243feb6cea3"></a><!-- doxytag: member="ospf6_network.h::ospf6_set_checksum" ref="a44911f08e04b9e4fb1505243feb6cea3" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf6_set_checksum </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00067">67</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> offset = 12;
<span class="preprocessor">#ifndef DISABLE_IPV6_CHECKSUM</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (setsockopt (<a class="code" href="ospf6__network_8c.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a>, IPPROTO_IPV6, IPV6_CHECKSUM,
                  &amp;offset, <span class="keyword">sizeof</span> (offset)) &lt; 0)
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Network: set IPV6_CHECKSUM failed: %s&quot;</span>, <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno));
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>  <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Network: Don&#39;t set IPV6_CHECKSUM&quot;</span>);
<span class="preprocessor">#endif </span><span class="comment">/* DISABLE_IPV6_CHECKSUM */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7e6dc2b84bc15d8f8ca3fc83687119a5"></a><!-- doxytag: member="ospf6_network.h::ospf6_set_pktinfo" ref="a7e6dc2b84bc15d8f8ca3fc83687119a5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf6_set_pktinfo </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00061">61</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  setsockopt_ipv6_pktinfo (<a class="code" href="ospf6__network_8c.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a>, 1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6edb22d7e2f7613fb293a89dec93f7dc"></a><!-- doxytag: member="ospf6_network.h::ospf6_set_reuseaddr" ref="a6edb22d7e2f7613fb293a89dec93f7dc" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf6_set_reuseaddr </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00041">41</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  u_int on = 0;
  <span class="keywordflow">if</span> (setsockopt (<a class="code" href="ospf6__network_8c.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a>, SOL_SOCKET, SO_REUSEADDR, &amp;on,
                  <span class="keyword">sizeof</span> (u_int)) &lt; 0)
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Network: set SO_REUSEADDR failed: %s&quot;</span>, <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno));
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a09927a6bc76695ca91bbd7a8e3e1beae"></a><!-- doxytag: member="ospf6_network.h::alldrouters6" ref="a09927a6bc76695ca91bbd7a8e3e1beae" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct in6_addr <a class="el" href="ospf6__network_8h.html#a09927a6bc76695ca91bbd7a8e3e1beae">alldrouters6</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00037">37</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8f18d0317b172f8e2b317e4583a16933"></a><!-- doxytag: member="ospf6_network.h::allspfrouters6" ref="a8f18d0317b172f8e2b317e4583a16933" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct in6_addr <a class="el" href="ospf6__network_8h.html#a8f18d0317b172f8e2b317e4583a16933">allspfrouters6</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00036">36</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5188bca9449297b73b0f117ccf46ca9f"></a><!-- doxytag: member="ospf6_network.h::ospf6_sock" ref="a5188bca9449297b73b0f117ccf46ca9f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ospf6__network_8h.html#a5188bca9449297b73b0f117ccf46ca9f">ospf6_sock</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf6__network_8c_source.html#l00035">35</a> of file <a class="el" href="ospf6__network_8c_source.html">ospf6_network.c</a>.</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ospf6__network_8h.html">ospf6_network.h</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:27 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
