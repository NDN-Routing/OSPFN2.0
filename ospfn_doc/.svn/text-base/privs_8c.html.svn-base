<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: lib/privs.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('privs_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">lib/privs.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="zebra_8h_source.html">zebra.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="privs_8h_source.html">privs.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="memory_8h_source.html">memory.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for privs.c:</div>
<div class="dyncontent">
<div class="center"><img src="privs_8c__incl.png" border="0" usemap="#lib_2privs_8c" alt=""/></div>
<map name="lib_2privs_8c" id="lib_2privs_8c">
<area shape="rect" id="node3" href="zebra_8h.html" title="zebra.h" alt="" coords="1345,80,1412,107"/><area shape="rect" id="node61" href="log_8h.html" title="log.h" alt="" coords="2727,80,2779,107"/><area shape="rect" id="node64" href="privs_8h.html" title="privs.h" alt="" coords="2803,80,2865,107"/><area shape="rect" id="node66" href="memory_8h.html" title="memory.h" alt="" coords="2891,80,2973,107"/><area shape="rect" id="node57" href="zassert_8h.html" title="zassert.h" alt="" coords="2572,155,2649,181"/><area shape="rect" id="node59" href="str_8h.html" title="str.h" alt="" coords="2674,155,2723,181"/><area shape="rect" id="node68" href="memtypes_8h.html" title="lib/memtypes.h" alt="" coords="2875,155,2989,181"/></map>
</div>
</div>
<p><a href="privs_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__zprivs__t.html">_zprivs_t</a></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="privs_8c.html#ac47d37201065f60c4daa0086756f4530">zprivs_change_uid</a> (<a class="el" href="privs_8h.html#aae029fe88e2d02bee4d46a2f458bd3e5">zebra_privs_ops_t</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="privs_8h.html#ad679f4706ab2998d9538148c4412b177">zebra_privs_current_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="privs_8c.html#a38d592d604ed1af09fcb8e16317727bc">zprivs_state_uid</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="privs_8c.html#ae9417e5de027e7ac2b71854645ffd5ab">zprivs_change_null</a> (<a class="el" href="privs_8h.html#aae029fe88e2d02bee4d46a2f458bd3e5">zebra_privs_ops_t</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="privs_8h.html#ad679f4706ab2998d9538148c4412b177">zebra_privs_current_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="privs_8c.html#a46fae5e02d0b0308954dcb8c356d0e15">zprivs_state_null</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="privs_8c.html#ac6082c5377fb94942a842809eb508682">zprivs_init</a> (struct <a class="el" href="structzebra__privs__t.html">zebra_privs_t</a> *zprivs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="privs_8c.html#a298744ec7593170da015843cc0e26863">zprivs_terminate</a> (struct <a class="el" href="structzebra__privs__t.html">zebra_privs_t</a> *zprivs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="privs_8c.html#a46943152a1298eca5f10ead2743e284f">zprivs_get_ids</a> (struct <a class="el" href="structzprivs__ids__t.html">zprivs_ids_t</a> *ids)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="privs_8h.html#ad679f4706ab2998d9538148c4412b177">zebra_privs_current_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="privs_8c.html#a3071763e378a708d1669f934abd192e1">zprivs_null_state</a> = ZPRIVS_RAISED</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="struct__zprivs__t.html">_zprivs_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ae9417e5de027e7ac2b71854645ffd5ab"></a><!-- doxytag: member="privs.c::zprivs_change_null" ref="ae9417e5de027e7ac2b71854645ffd5ab" args="(zebra_privs_ops_t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int zprivs_change_null </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="privs_8h.html#aae029fe88e2d02bee4d46a2f458bd3e5">zebra_privs_ops_t</a>&#160;</td>
          <td class="paramname"><em>op</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="privs_8c_source.html#l00579">579</a> of file <a class="el" href="privs_8c_source.html">privs.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac47d37201065f60c4daa0086756f4530"></a><!-- doxytag: member="privs.c::zprivs_change_uid" ref="ac47d37201065f60c4daa0086756f4530" args="(zebra_privs_ops_t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int zprivs_change_uid </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="privs_8h.html#aae029fe88e2d02bee4d46a2f458bd3e5">zebra_privs_ops_t</a>&#160;</td>
          <td class="paramname"><em>op</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="privs_8c_source.html#l00561">561</a> of file <a class="el" href="privs_8c_source.html">privs.c</a>.</p>
<div class="fragment"><pre class="fragment">{

  <span class="keywordflow">if</span> (op == <a class="code" href="privs_8h.html#aae029fe88e2d02bee4d46a2f458bd3e5a5395269196ee9bd07257f8b2b35c25fa">ZPRIVS_RAISE</a>)
    <span class="keywordflow">return</span> seteuid (<a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a9a6e4b114c49dc1febd9f08946d7a301">zsuid</a>);
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (op == <a class="code" href="privs_8h.html#aae029fe88e2d02bee4d46a2f458bd3e5a7da2c6956cf712f8adc04ff2b0f072c5">ZPRIVS_LOWER</a>)
    <span class="keywordflow">return</span> seteuid (<a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a5cc3455f44f87bdbc45539853e62b204">zuid</a>);
  <span class="keywordflow">else</span>
    <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a46943152a1298eca5f10ead2743e284f"></a><!-- doxytag: member="privs.c::zprivs_get_ids" ref="a46943152a1298eca5f10ead2743e284f" args="(struct zprivs_ids_t *ids)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void zprivs_get_ids </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structzprivs__ids__t.html">zprivs_ids_t</a> *&#160;</td>
          <td class="paramname"><em>ids</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="privs_8c_source.html#l00725">725</a> of file <a class="el" href="privs_8c_source.html">privs.c</a>.</p>
<div class="fragment"><pre class="fragment">{

   ids-&gt;<a class="code" href="structzprivs__ids__t.html#a4aa7bf43bbbf930d414e8fa51db65f4f">uid_priv</a> = getuid();
   (<a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a5cc3455f44f87bdbc45539853e62b204">zuid</a>) ? (ids-&gt;<a class="code" href="structzprivs__ids__t.html#aac7500b2d4d3d1d2d71a94a7a2861ae1">uid_normal</a> = <a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a5cc3455f44f87bdbc45539853e62b204">zuid</a>)
                     : (ids-&gt;<a class="code" href="structzprivs__ids__t.html#aac7500b2d4d3d1d2d71a94a7a2861ae1">uid_normal</a> = -1);
   (<a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#adae43dc05bbac5b9c53ab3dfa93a4eee">zgid</a>) ? (ids-&gt;<a class="code" href="structzprivs__ids__t.html#a9e641275f51ae0f69714521361b88896">gid_normal</a> = <a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#adae43dc05bbac5b9c53ab3dfa93a4eee">zgid</a>)
                     : (ids-&gt;<a class="code" href="structzprivs__ids__t.html#a9e641275f51ae0f69714521361b88896">gid_normal</a> = -1);
   (<a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a95c04b6ee093a2024ad19316953d701a">vtygrp</a>) ? (ids-&gt;<a class="code" href="structzprivs__ids__t.html#a2574e70e5ac38be9c725cc2421c7e5b8">gid_vty</a> = <a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a95c04b6ee093a2024ad19316953d701a">vtygrp</a>)
                       : (ids-&gt;<a class="code" href="structzprivs__ids__t.html#a2574e70e5ac38be9c725cc2421c7e5b8">gid_vty</a> = -1);
   
   <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac6082c5377fb94942a842809eb508682"></a><!-- doxytag: member="privs.c::zprivs_init" ref="ac6082c5377fb94942a842809eb508682" args="(struct zebra_privs_t *zprivs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void zprivs_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structzebra__privs__t.html">zebra_privs_t</a> *&#160;</td>
          <td class="paramname"><em>zprivs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="privs_8c_source.html#l00591">591</a> of file <a class="el" href="privs_8c_source.html">privs.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span>passwd *pwentry = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keyword">struct </span>group *grentry = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (!zprivs)
    {
      fprintf (stderr, <span class="stringliteral">&quot;zprivs_init: called with NULL arg!\n&quot;</span>);
      <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a> (1);
    }

  <span class="comment">/* NULL privs */</span>
  <span class="keywordflow">if</span> (! (zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a62e6101b1d966f24692ae650a331fb95">user</a> || zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a5b11e63c267759ec4dd64022e6046b80">group</a> 
         || zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a8410e950e551f1fc77b3004fdd7655d4">cap_num_p</a> || zprivs-&gt;<a class="code" href="structzebra__privs__t.html#aad6985760cb42951efae67e30eb2c463">cap_num_i</a>) )
    {
      zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a0c59dbc0ec6187b60a824ec421cc34c1">change</a> = <a class="code" href="privs_8c.html#ae9417e5de027e7ac2b71854645ffd5ab">zprivs_change_null</a>;
      zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a87875be16a946ab35489aec62a76b315">current_state</a> = <a class="code" href="privs_8c.html#a46fae5e02d0b0308954dcb8c356d0e15">zprivs_state_null</a>;
      <span class="keywordflow">return</span>;
    }

  <span class="keywordflow">if</span> (zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a62e6101b1d966f24692ae650a331fb95">user</a>)
    {
      <span class="keywordflow">if</span> ( (pwentry = getpwnam (zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a62e6101b1d966f24692ae650a331fb95">user</a>)) )
        {
          <a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a5cc3455f44f87bdbc45539853e62b204">zuid</a> = pwentry-&gt;pw_uid;
        }
      <span class="keywordflow">else</span>
        {
          <span class="comment">/* cant use log.h here as it depends on vty */</span>
          fprintf (stderr, <span class="stringliteral">&quot;privs_init: could not lookup user %s\n&quot;</span>,
                   zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a62e6101b1d966f24692ae650a331fb95">user</a>);
          <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a> (1);
        }
    }

  grentry = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a5d73d1b006f1e22ea2c6faea606fd977">vty_group</a>)
    <span class="comment">/* Add the vty_group to the supplementary groups so it can be chowned to */</span>
    {
      <span class="keywordflow">if</span> ( (grentry = getgrnam (zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a5d73d1b006f1e22ea2c6faea606fd977">vty_group</a>)) )
        {
          <a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a95c04b6ee093a2024ad19316953d701a">vtygrp</a> = grentry-&gt;gr_gid;
          <span class="keywordflow">if</span> ( setgroups (1, &amp;<a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a95c04b6ee093a2024ad19316953d701a">vtygrp</a>) )
            {
              fprintf (stderr, <span class="stringliteral">&quot;privs_init: could not setgroups, %s\n&quot;</span>,
                         <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno) );
              <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a> (1);
            }       
        }
      <span class="keywordflow">else</span>
        {
          fprintf (stderr, <span class="stringliteral">&quot;privs_init: could not lookup vty group %s\n&quot;</span>,
                   zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a5d73d1b006f1e22ea2c6faea606fd977">vty_group</a>);
          <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a> (1);
        }
    }
  
  <span class="keywordflow">if</span> (zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a5b11e63c267759ec4dd64022e6046b80">group</a>)
    {
      <span class="keywordflow">if</span> ( (grentry = getgrnam (zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a5b11e63c267759ec4dd64022e6046b80">group</a>)) )
        {
          <a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#adae43dc05bbac5b9c53ab3dfa93a4eee">zgid</a> = grentry-&gt;gr_gid;
        }
      <span class="keywordflow">else</span>
        {
          fprintf (stderr, <span class="stringliteral">&quot;privs_init: could not lookup group %s\n&quot;</span>,
                   zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a5b11e63c267759ec4dd64022e6046b80">group</a>);
          <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a> (1);
        }
      <span class="comment">/* change group now, forever. uid we do later */</span>
      <span class="keywordflow">if</span> ( setregid (<a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#adae43dc05bbac5b9c53ab3dfa93a4eee">zgid</a>, <a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#adae43dc05bbac5b9c53ab3dfa93a4eee">zgid</a>) )
        {
          fprintf (stderr, <span class="stringliteral">&quot;zprivs_init: could not setregid, %s\n&quot;</span>,
                    <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno) );
          <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a> (1);
        }
    }
  
<span class="preprocessor">#ifdef HAVE_CAPABILITIES</span>
<span class="preprocessor"></span>  zprivs_caps_init (zprivs);
<span class="preprocessor">#else </span><span class="comment">/* !HAVE_CAPABILITIES */</span>
  <span class="comment">/* we dont have caps. we&#39;ll need to maintain rid and saved uid</span>
<span class="comment">   * and change euid back to saved uid (who we presume has all neccessary</span>
<span class="comment">   * privileges) whenever we are asked to raise our privileges.</span>
<span class="comment">   *</span>
<span class="comment">   * This is not worth that much security wise, but all we can do.</span>
<span class="comment">   */</span>
  <a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a9a6e4b114c49dc1febd9f08946d7a301">zsuid</a> = geteuid();  
  <span class="keywordflow">if</span> ( <a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a5cc3455f44f87bdbc45539853e62b204">zuid</a> )
    {
      <span class="keywordflow">if</span> ( setreuid (-1, <a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a5cc3455f44f87bdbc45539853e62b204">zuid</a>) )
        {
          fprintf (stderr, <span class="stringliteral">&quot;privs_init (uid): could not setreuid, %s\n&quot;</span>, 
                   <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno));
          <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a> (1);
        }
    }
  
  zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a0c59dbc0ec6187b60a824ec421cc34c1">change</a> = <a class="code" href="privs_8c.html#ac47d37201065f60c4daa0086756f4530">zprivs_change_uid</a>;
  zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a87875be16a946ab35489aec62a76b315">current_state</a> = <a class="code" href="privs_8c.html#a38d592d604ed1af09fcb8e16317727bc">zprivs_state_uid</a>;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_CAPABILITIES */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a46fae5e02d0b0308954dcb8c356d0e15"></a><!-- doxytag: member="privs.c::zprivs_state_null" ref="a46fae5e02d0b0308954dcb8c356d0e15" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="privs_8h.html#ad679f4706ab2998d9538148c4412b177">zebra_privs_current_t</a> zprivs_state_null </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="privs_8c_source.html#l00585">585</a> of file <a class="el" href="privs_8c_source.html">privs.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> <a class="code" href="privs_8c.html#a3071763e378a708d1669f934abd192e1">zprivs_null_state</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a38d592d604ed1af09fcb8e16317727bc"></a><!-- doxytag: member="privs.c::zprivs_state_uid" ref="a38d592d604ed1af09fcb8e16317727bc" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="privs_8h.html#ad679f4706ab2998d9538148c4412b177">zebra_privs_current_t</a> zprivs_state_uid </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="privs_8c_source.html#l00573">573</a> of file <a class="el" href="privs_8c_source.html">privs.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> ( (<a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a5cc3455f44f87bdbc45539853e62b204">zuid</a> == geteuid()) ? <a class="code" href="privs_8h.html#ad679f4706ab2998d9538148c4412b177a6ea35041269b5c56a6a52c52cd67c731">ZPRIVS_LOWERED</a> : <a class="code" href="privs_8h.html#ad679f4706ab2998d9538148c4412b177a9cf73835d075c42d714ce2d97e5a49d1">ZPRIVS_RAISED</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a298744ec7593170da015843cc0e26863"></a><!-- doxytag: member="privs.c::zprivs_terminate" ref="a298744ec7593170da015843cc0e26863" args="(struct zebra_privs_t *zprivs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void zprivs_terminate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structzebra__privs__t.html">zebra_privs_t</a> *&#160;</td>
          <td class="paramname"><em>zprivs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="privs_8c_source.html#l00696">696</a> of file <a class="el" href="privs_8c_source.html">privs.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (!zprivs)
    {
      fprintf (stderr, <span class="stringliteral">&quot;%s: no privs struct given, terminating&quot;</span>, __func__);
      <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a> (0);
    }
  
<span class="preprocessor">#ifdef HAVE_CAPABILITIES</span>
<span class="preprocessor"></span>  zprivs_caps_terminate();
<span class="preprocessor">#else </span><span class="comment">/* !HAVE_CAPABILITIES */</span>
  <span class="keywordflow">if</span> (<a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a5cc3455f44f87bdbc45539853e62b204">zuid</a>)
    {
      <span class="keywordflow">if</span> ( setreuid (<a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a5cc3455f44f87bdbc45539853e62b204">zuid</a>, <a class="code" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a>.<a class="code" href="struct__zprivs__t.html#a5cc3455f44f87bdbc45539853e62b204">zuid</a>) )
        {
          fprintf (stderr, <span class="stringliteral">&quot;privs_terminate: could not setreuid, %s&quot;</span>, 
                     <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno) );
          <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a> (1);
        }
     }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_LCAPS */</span>

  zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a0c59dbc0ec6187b60a824ec421cc34c1">change</a> = <a class="code" href="privs_8c.html#ae9417e5de027e7ac2b71854645ffd5ab">zprivs_change_null</a>;
  zprivs-&gt;<a class="code" href="structzebra__privs__t.html#a87875be16a946ab35489aec62a76b315">current_state</a> = <a class="code" href="privs_8c.html#a46fae5e02d0b0308954dcb8c356d0e15">zprivs_state_null</a>;
  <a class="code" href="privs_8c.html#a3071763e378a708d1669f934abd192e1">zprivs_null_state</a> = <a class="code" href="privs_8h.html#ad679f4706ab2998d9538148c4412b177a6ea35041269b5c56a6a52c52cd67c731">ZPRIVS_LOWERED</a>;
  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a3071763e378a708d1669f934abd192e1"></a><!-- doxytag: member="privs.c::zprivs_null_state" ref="a3071763e378a708d1669f934abd192e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="privs_8h.html#ad679f4706ab2998d9538148c4412b177">zebra_privs_current_t</a> <a class="el" href="privs_8c.html#a3071763e378a708d1669f934abd192e1">zprivs_null_state</a> = ZPRIVS_RAISED<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="privs_8c_source.html#l00063">63</a> of file <a class="el" href="privs_8c_source.html">privs.c</a>.</p>

</div>
</div>
<a class="anchor" id="afc62605e76ca349d8f53012268538ecd"></a><!-- doxytag: member="privs.c::zprivs_state" ref="afc62605e76ca349d8f53012268538ecd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="struct__zprivs__t.html">_zprivs_t</a>  <a class="el" href="privs_8c.html#afc62605e76ca349d8f53012268538ecd">zprivs_state</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="privs_8c.html">privs.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:23 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
