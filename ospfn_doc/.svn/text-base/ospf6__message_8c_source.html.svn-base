<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: ospf6d/ospf6_message.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ospf6__message_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">ospf6d/ospf6_message.c</div>  </div>
</div>
<div class="contents">
<a href="ospf6__message_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2003 Yasuhiro Ohara</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This file is part of GNU Zebra.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * GNU Zebra is free software; you can redistribute it and/or modify it</span>
<a name="l00007"></a>00007 <span class="comment"> * under the terms of the GNU General Public License as published by the</span>
<a name="l00008"></a>00008 <span class="comment"> * Free Software Foundation; either version 2, or (at your option) any</span>
<a name="l00009"></a>00009 <span class="comment"> * later version.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * GNU Zebra is distributed in the hope that it will be useful, but</span>
<a name="l00012"></a>00012 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00014"></a>00014 <span class="comment"> * General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * along with GNU Zebra; see the file COPYING.  If not, write to the </span>
<a name="l00018"></a>00018 <span class="comment"> * Free Software Foundation, Inc., 59 Temple Place - Suite 330, </span>
<a name="l00019"></a>00019 <span class="comment"> * Boston, MA 02111-1307, USA.  </span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="zebra_8h.html">zebra.h</a>&gt;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="memory_8h.html">memory.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="log_8h.html">log.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="vty_8h.html">vty.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="command_8h.html">command.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="thread_8h.html">thread.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="linklist_8h.html">linklist.h</a>&quot;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__proto_8h.html">ospf6_proto.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__lsa_8h.html">ospf6_lsa.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__lsdb_8h.html">ospf6_lsdb.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__network_8h.html">ospf6_network.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__message_8h.html">ospf6_message.h</a>&quot;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__top_8h.html">ospf6_top.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__area_8h.html">ospf6_area.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__neighbor_8h.html">ospf6_neighbor.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__interface_8h.html">ospf6_interface.h</a>&quot;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__flood_8h.html">ospf6_flood.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="ospf6d_8h.html">ospf6d.h</a>&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="ospf6__message_8h.html#a2248d2fb08366bd1206fa320f5de8c68">00045</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="ospf6__message_8c.html#a421d44952d11523ff61b0dbddd86ce25">conf_debug_ospf6_message</a>[6] = {0x03, 0, 0, 0, 0, 0};
<a name="l00046"></a><a class="code" href="ospf6__message_8h.html#a64115ee539859d9f278938a96e2ce9b5">00046</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ospf6__message_8c.html#a64115ee539859d9f278938a96e2ce9b5">ospf6_message_type_str</a>[] =
<a name="l00047"></a>00047   { <span class="stringliteral">&quot;Unknown&quot;</span>, <span class="stringliteral">&quot;Hello&quot;</span>, <span class="stringliteral">&quot;DbDesc&quot;</span>, <span class="stringliteral">&quot;LSReq&quot;</span>, <span class="stringliteral">&quot;LSUpdate&quot;</span>, <span class="stringliteral">&quot;LSAck&quot;</span> };
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="comment">/* print functions */</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00052"></a><a class="code" href="ospf6__message_8c.html#a5b32ec41cd8e3534ecc2e602fef72589">00052</a> <a class="code" href="ospf6__message_8c.html#a5b32ec41cd8e3534ecc2e602fef72589">ospf6_header_print</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh)
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054   <span class="keywordtype">char</span> router_id[16], area_id[16];
<a name="l00055"></a>00055   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;oh-&gt;<a class="code" href="structospf6__header.html#a53d5dbfa8cc8c72d2e4681d78258b6a7">router_id</a>, router_id, sizeof (router_id));
<a name="l00056"></a>00056   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;oh-&gt;<a class="code" href="structospf6__header.html#abc55595860947bb51724aae44da001cc">area_id</a>, area_id, sizeof (area_id));
<a name="l00057"></a>00057 
<a name="l00058"></a>00058   <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    OSPFv%d Type:%d Len:%hu Router-ID:%s&quot;</span>,
<a name="l00059"></a>00059              oh-&gt;<a class="code" href="structospf6__header.html#a71abe555831003b4e41b0a623690ac93">version</a>, oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, ntohs (oh-&gt;<a class="code" href="structospf6__header.html#aef7496dd76d0c2eca889f7a9d01936ff">length</a>), router_id);
<a name="l00060"></a>00060   <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    Area-ID:%s Cksum:%hx Instance-ID:%d&quot;</span>,
<a name="l00061"></a>00061              area_id, ntohs (oh-&gt;<a class="code" href="structospf6__header.html#a399ac69f8f07f9dc898a20039d3ca47b">checksum</a>), oh-&gt;<a class="code" href="structospf6__header.html#a098c822a8032afb65b8e7d41339c9dc1">instance_id</a>);
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="keywordtype">void</span>
<a name="l00065"></a><a class="code" href="ospf6__message_8h.html#ab2ae44ae88443ee610b610c8bda325ef">00065</a> <a class="code" href="ospf6__message_8c.html#adfbd2808619eaf4b4a9f264083b1ae2e">ospf6_hello_print</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh)
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067   <span class="keyword">struct </span><a class="code" href="structospf6__hello.html">ospf6_hello</a> *hello;
<a name="l00068"></a>00068   <span class="keywordtype">char</span> <a class="code" href="structospf6__hello.html#a565763d170eba38a2152a567aadbbf6f">options</a>[16];
<a name="l00069"></a>00069   <span class="keywordtype">char</span> <a class="code" href="structospf6__hello.html#afb3b0ce9544783eb334693ff084e3e53">drouter</a>[16], <a class="code" href="structospf6__hello.html#a8f28e7af24bc5ec67f8e93ae10888f4f">bdrouter</a>[16], neighbor[16];
<a name="l00070"></a>00070   <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072   <a class="code" href="ospf6__message_8c.html#a5b32ec41cd8e3534ecc2e602fef72589">ospf6_header_print</a> (oh);
<a name="l00073"></a>00073   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a> == <a class="code" href="ospf6__message_8h.html#a2bf7c8dd972224d5a8255986e52ea771">OSPF6_MESSAGE_TYPE_HELLO</a>);
<a name="l00074"></a>00074 
<a name="l00075"></a>00075   hello = (<span class="keyword">struct </span><a class="code" href="structospf6__hello.html">ospf6_hello</a> *)
<a name="l00076"></a>00076     ((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l00077"></a>00077 
<a name="l00078"></a>00078   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;hello-&gt;<a class="code" href="structospf6__hello.html#afb3b0ce9544783eb334693ff084e3e53">drouter</a>, drouter, sizeof (drouter));
<a name="l00079"></a>00079   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;hello-&gt;<a class="code" href="structospf6__hello.html#a8f28e7af24bc5ec67f8e93ae10888f4f">bdrouter</a>, bdrouter, sizeof (bdrouter));
<a name="l00080"></a>00080   <a class="code" href="ospf6__proto_8c.html#a70fba8cd2453bf33405c98ff2ff14a38">ospf6_options_printbuf</a> (hello-&gt;<a class="code" href="structospf6__hello.html#a565763d170eba38a2152a567aadbbf6f">options</a>, options, sizeof (options));
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    I/F-Id:%ld Priority:%d Option:%s&quot;</span>,
<a name="l00083"></a>00083              (u_long) ntohl (hello-&gt;<a class="code" href="structospf6__hello.html#a2f7c26913d42af645dc312d90b771430">interface_id</a>), hello-&gt;<a class="code" href="structospf6__hello.html#a27d677bd81ca4bb5e3da0adcdc46616c">priority</a>, options);
<a name="l00084"></a>00084   <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    HelloInterval:%hu DeadInterval:%hu&quot;</span>,
<a name="l00085"></a>00085              ntohs (hello-&gt;<a class="code" href="structospf6__hello.html#a061d5f19e3c9307df71c0294807e3ff9">hello_interval</a>), ntohs (hello-&gt;<a class="code" href="structospf6__hello.html#a1429ca752f62050f89d9c61f9052ad6d">dead_interval</a>));
<a name="l00086"></a>00086   <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    DR:%s BDR:%s&quot;</span>, drouter, bdrouter);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088   <span class="keywordflow">for</span> (p = (<span class="keywordtype">char</span> *) ((caddr_t) hello + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__hello.html">ospf6_hello</a>));
<a name="l00089"></a>00089        p + <span class="keyword">sizeof</span> (u_int32_t) &lt;= <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh);
<a name="l00090"></a>00090        p += <span class="keyword">sizeof</span> (u_int32_t))
<a name="l00091"></a>00091     {
<a name="l00092"></a>00092       <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, (<span class="keywordtype">void</span> *) p, neighbor, <span class="keyword">sizeof</span> (neighbor));
<a name="l00093"></a>00093       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    Neighbor: %s&quot;</span>, neighbor);
<a name="l00094"></a>00094     }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096   <span class="keywordflow">if</span> (p != <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh))
<a name="l00097"></a>00097     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Trailing garbage exists&quot;</span>);
<a name="l00098"></a>00098 }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="keywordtype">void</span>
<a name="l00101"></a><a class="code" href="ospf6__message_8h.html#a911d48d59a1903ced496a3f4225bbd9b">00101</a> <a class="code" href="ospf6__message_8c.html#a4c3079cef10f2def25c83cc3cdf0c00f">ospf6_dbdesc_print</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh)
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103   <span class="keyword">struct </span><a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a> *dbdesc;
<a name="l00104"></a>00104   <span class="keywordtype">char</span> <a class="code" href="structospf6__dbdesc.html#af1290ef8a9bc29c30daa8568df7556e3">options</a>[16];
<a name="l00105"></a>00105   <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <a class="code" href="ospf6__message_8c.html#a5b32ec41cd8e3534ecc2e602fef72589">ospf6_header_print</a> (oh);
<a name="l00108"></a>00108   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a> == <a class="code" href="ospf6__message_8h.html#a2bd43bbd6161d38b8361ae6d377b736a">OSPF6_MESSAGE_TYPE_DBDESC</a>);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110   dbdesc = (<span class="keyword">struct </span><a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a> *)
<a name="l00111"></a>00111     ((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l00112"></a>00112 
<a name="l00113"></a>00113   <a class="code" href="ospf6__proto_8c.html#a70fba8cd2453bf33405c98ff2ff14a38">ospf6_options_printbuf</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#af1290ef8a9bc29c30daa8568df7556e3">options</a>, options, sizeof (options));
<a name="l00114"></a>00114 
<a name="l00115"></a>00115   <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    MBZ: %#x Option: %s IfMTU: %hu&quot;</span>,
<a name="l00116"></a>00116              dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#ae44ba120f5bb73e841410bf9c395eb44">reserved1</a>, options, ntohs (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a354af018af795ae987a64381168e6272">ifmtu</a>));
<a name="l00117"></a>00117   <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    MBZ: %#x Bits: %s%s%s SeqNum: %#lx&quot;</span>,
<a name="l00118"></a>00118              dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a051d6a8be42e57dfbf8119ee7411b27f">reserved2</a>,
<a name="l00119"></a>00119              (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#a1de1fec9c59c8037fa5f6cb5f8bf35cb">OSPF6_DBDESC_IBIT</a>) ? <span class="stringliteral">&quot;I&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>),
<a name="l00120"></a>00120              (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#a6b4ff9c565893a42ee04d66d477b0802">OSPF6_DBDESC_MBIT</a>) ? <span class="stringliteral">&quot;M&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>),
<a name="l00121"></a>00121              (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#aca7fe538d9edb962ca47fbeec7e4bf6b">OSPF6_DBDESC_MSBIT</a>) ? <span class="stringliteral">&quot;m&quot;</span> : <span class="stringliteral">&quot;s&quot;</span>),
<a name="l00122"></a>00122              (u_long) ntohl (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#ad7bdcd6eb854254824f0932e67834f16">seqnum</a>));
<a name="l00123"></a>00123 
<a name="l00124"></a>00124   <span class="keywordflow">for</span> (p = (<span class="keywordtype">char</span> *) ((caddr_t) dbdesc + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a>));
<a name="l00125"></a>00125        p + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>) &lt;= <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh);
<a name="l00126"></a>00126        p += <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>))
<a name="l00127"></a>00127     ospf6_lsa_header_print_raw ((struct ospf6_lsa_header *) p);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129   <span class="keywordflow">if</span> (p != <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh))
<a name="l00130"></a>00130     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Trailing garbage exists&quot;</span>);
<a name="l00131"></a>00131 }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="keywordtype">void</span>
<a name="l00134"></a><a class="code" href="ospf6__message_8h.html#ac482f8e61bcf27540c78817ca51657e4">00134</a> <a class="code" href="ospf6__message_8c.html#ac0a6a0ccb7a4c9ab4e1c5ddef8f64882">ospf6_lsreq_print</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh)
<a name="l00135"></a>00135 {
<a name="l00136"></a>00136   <span class="keywordtype">char</span> <span class="keywordtype">id</span>[16], <a class="code" href="prefix_8h.html#aa4419784611184c74a36162ffcf0123d">adv_router</a>[16];
<a name="l00137"></a>00137   <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   <a class="code" href="ospf6__message_8c.html#a5b32ec41cd8e3534ecc2e602fef72589">ospf6_header_print</a> (oh);
<a name="l00140"></a>00140   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a> == <a class="code" href="ospf6__message_8h.html#a685011318dd28abf2279e718803d4daa">OSPF6_MESSAGE_TYPE_LSREQ</a>);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142   <span class="keywordflow">for</span> (p = (<span class="keywordtype">char</span> *) ((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l00143"></a>00143        p + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsreq__entry.html">ospf6_lsreq_entry</a>) &lt;= <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh);
<a name="l00144"></a>00144        p += <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsreq__entry.html">ospf6_lsreq_entry</a>))
<a name="l00145"></a>00145     {
<a name="l00146"></a>00146       <span class="keyword">struct </span><a class="code" href="structospf6__lsreq__entry.html">ospf6_lsreq_entry</a> *e = (<span class="keyword">struct </span><a class="code" href="structospf6__lsreq__entry.html">ospf6_lsreq_entry</a> *) p;
<a name="l00147"></a>00147       <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;e-&gt;adv_router, adv_router, sizeof (adv_router));
<a name="l00148"></a>00148       <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;e-&gt;id, <span class="keywordtype">id</span>, sizeof (<span class="keywordtype">id</span>));
<a name="l00149"></a>00149       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    [%s Id:%s Adv:%s]&quot;</span>,
<a name="l00150"></a>00150                  <a class="code" href="ospf6__lsa_8c.html#aef56342b1e39d23bf9977353c1c2deb1">ospf6_lstype_name</a> (e-&gt;type), <span class="keywordtype">id</span>, adv_router);
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153   <span class="keywordflow">if</span> (p != <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh))
<a name="l00154"></a>00154     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Trailing garbage exists&quot;</span>);
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 <span class="keywordtype">void</span>
<a name="l00158"></a><a class="code" href="ospf6__message_8h.html#ad6cc14a199d748b13d3aceaee598ad04">00158</a> <a class="code" href="ospf6__message_8c.html#a2e75752b675b33464d036ca1c53e598e">ospf6_lsupdate_print</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh)
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160   <span class="keyword">struct </span><a class="code" href="structospf6__lsupdate.html">ospf6_lsupdate</a> *lsupdate;
<a name="l00161"></a>00161   u_long <a class="code" href="bgp__open_8h.html#ab4570498c4316aa5f7b4852c778b3320">num</a>;
<a name="l00162"></a>00162   <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164   <a class="code" href="ospf6__message_8c.html#a5b32ec41cd8e3534ecc2e602fef72589">ospf6_header_print</a> (oh);
<a name="l00165"></a>00165   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a> == <a class="code" href="ospf6__message_8h.html#ac6f61e0ff8bcf71f99c6edc50ab9ca97">OSPF6_MESSAGE_TYPE_LSUPDATE</a>);
<a name="l00166"></a>00166 
<a name="l00167"></a>00167   lsupdate = (<span class="keyword">struct </span><a class="code" href="structospf6__lsupdate.html">ospf6_lsupdate</a> *)
<a name="l00168"></a>00168     ((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   num = ntohl (lsupdate-&gt;<a class="code" href="structospf6__lsupdate.html#ad78c6309d7425390af712e6bba8ce78f">lsa_number</a>);
<a name="l00171"></a>00171   <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    Number of LSA: %ld&quot;</span>, num);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <span class="keywordflow">for</span> (p = (<span class="keywordtype">char</span> *) ((caddr_t) lsupdate + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsupdate.html">ospf6_lsupdate</a>));
<a name="l00174"></a>00174        p &lt; <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh) &amp;&amp;
<a name="l00175"></a>00175        p + <a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (p) &lt;= <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh);
<a name="l00176"></a>00176        p += <a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (p))
<a name="l00177"></a>00177     {
<a name="l00178"></a>00178       <a class="code" href="ospf6__lsa_8c.html#a2b62fc9a6c54cec82d621993b4c83e82">ospf6_lsa_header_print_raw</a> ((<span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a> *) p);
<a name="l00179"></a>00179       <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (p) &lt; <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>))
<a name="l00180"></a>00180         {
<a name="l00181"></a>00181           <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    Malformed LSA length, quit printing&quot;</span>);
<a name="l00182"></a>00182           <span class="keywordflow">break</span>;
<a name="l00183"></a>00183         }
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   <span class="keywordflow">if</span> (p != <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh))
<a name="l00187"></a>00187     {
<a name="l00188"></a>00188       <span class="keywordtype">char</span> buf[32];
<a name="l00189"></a>00189 
<a name="l00190"></a>00190       <span class="keywordtype">int</span> num = 0;
<a name="l00191"></a>00191       memset (buf, 0, <span class="keyword">sizeof</span> (buf));
<a name="l00192"></a>00192 
<a name="l00193"></a>00193       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    Trailing garbage exists&quot;</span>);
<a name="l00194"></a>00194       <span class="keywordflow">while</span> (p &lt; <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh))
<a name="l00195"></a>00195         {
<a name="l00196"></a>00196           <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (buf, <span class="keyword">sizeof</span> (buf), <span class="stringliteral">&quot;%s %2x&quot;</span>, buf, *p++);
<a name="l00197"></a>00197           num++;
<a name="l00198"></a>00198           <span class="keywordflow">if</span> (num == 8)
<a name="l00199"></a>00199             {
<a name="l00200"></a>00200               <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    %s&quot;</span>, buf);
<a name="l00201"></a>00201               memset (buf, 0, <span class="keyword">sizeof</span> (buf));
<a name="l00202"></a>00202               num = 0;
<a name="l00203"></a>00203             }
<a name="l00204"></a>00204         }
<a name="l00205"></a>00205       <span class="keywordflow">if</span> (num)
<a name="l00206"></a>00206         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    %s&quot;</span>, buf);
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208 }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 <span class="keywordtype">void</span>
<a name="l00211"></a><a class="code" href="ospf6__message_8h.html#aa9c7522326cefb9b94473e3c435d061c">00211</a> <a class="code" href="ospf6__message_8c.html#a1868994aede5b9077bf9c7231f4f458d">ospf6_lsack_print</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh)
<a name="l00212"></a>00212 {
<a name="l00213"></a>00213   <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215   <a class="code" href="ospf6__message_8c.html#a5b32ec41cd8e3534ecc2e602fef72589">ospf6_header_print</a> (oh);
<a name="l00216"></a>00216   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a> == <a class="code" href="ospf6__message_8h.html#a19fd0641f70b0878b9ce5e7966c7ae73">OSPF6_MESSAGE_TYPE_LSACK</a>);
<a name="l00217"></a>00217 
<a name="l00218"></a>00218   <span class="keywordflow">for</span> (p = (<span class="keywordtype">char</span> *) ((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l00219"></a>00219        p + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>) &lt;= <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh);
<a name="l00220"></a>00220        p += <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>))
<a name="l00221"></a>00221     ospf6_lsa_header_print_raw ((struct ospf6_lsa_header *) p);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223   <span class="keywordflow">if</span> (p != <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh))
<a name="l00224"></a>00224     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Trailing garbage exists&quot;</span>);
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 <span class="comment">/* Receive function */</span>
<a name="l00228"></a><a class="code" href="ospf6__message_8c.html#a4ff2533d4f42b5b10b6caf648a4619b4">00228</a> <span class="preprocessor">#define MSG_OK    0</span>
<a name="l00229"></a><a class="code" href="ospf6__message_8c.html#a3869fecc5c8db19d92902c7200b46498">00229</a> <span class="preprocessor"></span><span class="preprocessor">#define MSG_NG    1</span>
<a name="l00230"></a>00230 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00231"></a><a class="code" href="ospf6__message_8c.html#a6993c2708cb37ca3e9d2da08393a68a3">00231</a> <a class="code" href="ospf6__message_8c.html#a6993c2708cb37ca3e9d2da08393a68a3">ospf6_header_examin</a> (<span class="keyword">struct</span> in6_addr *src, <span class="keyword">struct</span> in6_addr *dst,
<a name="l00232"></a>00232                      <span class="keyword">struct</span> <a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi, <span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh)
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234   u_char <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a>;
<a name="l00235"></a>00235   type = <a class="code" href="ospf6__message_8h.html#a634c01ceae5ec0e2116bae9b19ddfed5">OSPF6_MESSAGE_TYPE_CANONICAL</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237   <span class="comment">/* version check */</span>
<a name="l00238"></a>00238   <span class="keywordflow">if</span> (oh-&gt;<a class="code" href="structospf6__header.html#a71abe555831003b4e41b0a623690ac93">version</a> != <a class="code" href="ospf6__proto_8h.html#ac71efe16d061e39ea5c0d9d74def4fa4">OSPFV3_VERSION</a>)
<a name="l00239"></a>00239     {
<a name="l00240"></a>00240       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (type, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00241"></a>00241         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Message with unknown version&quot;</span>);
<a name="l00242"></a>00242       <span class="keywordflow">return</span> <a class="code" href="ospf6__message_8c.html#a3869fecc5c8db19d92902c7200b46498">MSG_NG</a>;
<a name="l00243"></a>00243     }
<a name="l00244"></a>00244 
<a name="l00245"></a>00245   <span class="comment">/* Area-ID check */</span>
<a name="l00246"></a>00246   <span class="keywordflow">if</span> (oh-&gt;<a class="code" href="structospf6__header.html#abc55595860947bb51724aae44da001cc">area_id</a> != oi-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#aec3bacc0c813ff937b5675595a3aefa6">area_id</a>)
<a name="l00247"></a>00247     {
<a name="l00248"></a>00248       <span class="keywordflow">if</span> (oh-&gt;<a class="code" href="structospf6__header.html#abc55595860947bb51724aae44da001cc">area_id</a> == <a class="code" href="ospf6__area_8h.html#a461d77074eb1f62868ee90de5a168446">BACKBONE_AREA_ID</a>)
<a name="l00249"></a>00249         {
<a name="l00250"></a>00250           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (type, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00251"></a>00251             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Message may be via Virtual Link: not supported&quot;</span>);
<a name="l00252"></a>00252           <span class="keywordflow">return</span> <a class="code" href="ospf6__message_8c.html#a3869fecc5c8db19d92902c7200b46498">MSG_NG</a>;
<a name="l00253"></a>00253         }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (type, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00256"></a>00256         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Area-ID mismatch&quot;</span>);
<a name="l00257"></a>00257       <span class="keywordflow">return</span> <a class="code" href="ospf6__message_8c.html#a3869fecc5c8db19d92902c7200b46498">MSG_NG</a>;
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   <span class="comment">/* Instance-ID check */</span>
<a name="l00261"></a>00261   <span class="keywordflow">if</span> (oh-&gt;<a class="code" href="structospf6__header.html#a098c822a8032afb65b8e7d41339c9dc1">instance_id</a> != oi-&gt;<a class="code" href="structospf6__interface.html#aa29c61e3e5509e7c844bdf19efce0268">instance_id</a>)
<a name="l00262"></a>00262     {
<a name="l00263"></a>00263       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (type, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00264"></a>00264         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Instance-ID mismatch&quot;</span>);
<a name="l00265"></a>00265       <span class="keywordflow">return</span> <a class="code" href="ospf6__message_8c.html#a3869fecc5c8db19d92902c7200b46498">MSG_NG</a>;
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268   <span class="comment">/* Router-ID check */</span>
<a name="l00269"></a>00269   <span class="keywordflow">if</span> (oh-&gt;<a class="code" href="structospf6__header.html#a53d5dbfa8cc8c72d2e4681d78258b6a7">router_id</a> == oi-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a86562db489ba46500cda50f4fa646c69">ospf6</a>-&gt;<a class="code" href="structospf6.html#a4dc92a648ae2190f7cf5b383c475d2aa">router_id</a>)
<a name="l00270"></a>00270     <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Detect duplicate Router-ID&quot;</span>);
<a name="l00271"></a>00271 
<a name="l00272"></a>00272   <span class="keywordflow">return</span> <a class="code" href="ospf6__message_8c.html#a4ff2533d4f42b5b10b6caf648a4619b4">MSG_OK</a>;
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00276"></a><a class="code" href="ospf6__message_8c.html#a5c0be22f247d1d1d8b030955e4261636">00276</a> <a class="code" href="ospf6__message_8c.html#a5c0be22f247d1d1d8b030955e4261636">ospf6_hello_recv</a> (<span class="keyword">struct</span> in6_addr *src, <span class="keyword">struct</span> in6_addr *dst,
<a name="l00277"></a>00277                   <span class="keyword">struct</span> <a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi, <span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh)
<a name="l00278"></a>00278 {
<a name="l00279"></a>00279   <span class="keyword">struct </span><a class="code" href="structospf6__hello.html">ospf6_hello</a> *hello;
<a name="l00280"></a>00280   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l00281"></a>00281   <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l00282"></a>00282   <span class="keywordtype">int</span> twoway = 0;
<a name="l00283"></a>00283   <span class="keywordtype">int</span> neighborchange = 0;
<a name="l00284"></a>00284   <span class="keywordtype">int</span> backupseen = 0;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286   <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8c.html#a6993c2708cb37ca3e9d2da08393a68a3">ospf6_header_examin</a> (src, dst, oi, oh) != <a class="code" href="ospf6__message_8c.html#a4ff2533d4f42b5b10b6caf648a4619b4">MSG_OK</a>)
<a name="l00287"></a>00287     <span class="keywordflow">return</span>;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289   hello = (<span class="keyword">struct </span><a class="code" href="structospf6__hello.html">ospf6_hello</a> *)
<a name="l00290"></a>00290     ((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l00291"></a>00291 
<a name="l00292"></a>00292   <span class="comment">/* HelloInterval check */</span>
<a name="l00293"></a>00293   <span class="keywordflow">if</span> (ntohs (hello-&gt;<a class="code" href="structospf6__hello.html#a061d5f19e3c9307df71c0294807e3ff9">hello_interval</a>) != oi-&gt;<a class="code" href="structospf6__interface.html#a361e7c155d93d4b4082a22d43f6da499">hello_interval</a>)
<a name="l00294"></a>00294     {
<a name="l00295"></a>00295       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00296"></a>00296         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;HelloInterval mismatch&quot;</span>);
<a name="l00297"></a>00297       <span class="keywordflow">return</span>;
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <span class="comment">/* RouterDeadInterval check */</span>
<a name="l00301"></a>00301   <span class="keywordflow">if</span> (ntohs (hello-&gt;<a class="code" href="structospf6__hello.html#a1429ca752f62050f89d9c61f9052ad6d">dead_interval</a>) != oi-&gt;<a class="code" href="structospf6__interface.html#abcdd28a392cf138d80f052c651e9236b">dead_interval</a>)
<a name="l00302"></a>00302     {
<a name="l00303"></a>00303       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00304"></a>00304         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;RouterDeadInterval mismatch&quot;</span>);
<a name="l00305"></a>00305       <span class="keywordflow">return</span>;
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   <span class="comment">/* E-bit check */</span>
<a name="l00309"></a>00309   <span class="keywordflow">if</span> (<a class="code" href="ospf6__proto_8h.html#afe698280bea2b90a4d625d25cb639c6a">OSPF6_OPT_ISSET</a> (hello-&gt;<a class="code" href="structospf6__hello.html#a565763d170eba38a2152a567aadbbf6f">options</a>, <a class="code" href="ospf6__proto_8h.html#af4dc4ae32aacf5b0758f247de720234e">OSPF6_OPT_E</a>) !=
<a name="l00310"></a>00310       <a class="code" href="ospf6__proto_8h.html#afe698280bea2b90a4d625d25cb639c6a">OSPF6_OPT_ISSET</a> (oi-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a4ddb7d4da05f99266462914a8935c976">options</a>, <a class="code" href="ospf6__proto_8h.html#af4dc4ae32aacf5b0758f247de720234e">OSPF6_OPT_E</a>))
<a name="l00311"></a>00311     {
<a name="l00312"></a>00312       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00313"></a>00313         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;E-bit mismatch&quot;</span>);
<a name="l00314"></a>00314       <span class="keywordflow">return</span>;
<a name="l00315"></a>00315     }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317   <span class="comment">/* Find neighbor, create if not exist */</span>
<a name="l00318"></a>00318   on = <a class="code" href="ospf6__neighbor_8c.html#a4b081b7bf89453a1d197bd4ccd21fb14">ospf6_neighbor_lookup</a> (oh-&gt;<a class="code" href="structospf6__header.html#a53d5dbfa8cc8c72d2e4681d78258b6a7">router_id</a>, oi);
<a name="l00319"></a>00319   <span class="keywordflow">if</span> (on == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00320"></a>00320     {
<a name="l00321"></a>00321       on = <a class="code" href="ospf6__neighbor_8c.html#a855919070d304e94e357f2ad349a4d93">ospf6_neighbor_create</a> (oh-&gt;<a class="code" href="structospf6__header.html#a53d5dbfa8cc8c72d2e4681d78258b6a7">router_id</a>, oi);
<a name="l00322"></a>00322       on-&gt;<a class="code" href="structospf6__neighbor.html#aa7aa920cd50d36c888eba22cef7741b4">prev_drouter</a> = on-&gt;<a class="code" href="structospf6__neighbor.html#a71a9a7c78bf284d3b6ccf019d5724bc4">drouter</a> = hello-&gt;<a class="code" href="structospf6__hello.html#afb3b0ce9544783eb334693ff084e3e53">drouter</a>;
<a name="l00323"></a>00323       on-&gt;<a class="code" href="structospf6__neighbor.html#ab63cabfde3bd2bd93c0857d2aa446400">prev_bdrouter</a> = on-&gt;<a class="code" href="structospf6__neighbor.html#a51bfd494bc8b93c40f6645d8e0fb4223">bdrouter</a> = hello-&gt;<a class="code" href="structospf6__hello.html#a8f28e7af24bc5ec67f8e93ae10888f4f">bdrouter</a>;
<a name="l00324"></a>00324       on-&gt;<a class="code" href="structospf6__neighbor.html#a9035e4443ced9c02caef273c1375c1a7">priority</a> = hello-&gt;<a class="code" href="structospf6__hello.html#a27d677bd81ca4bb5e3da0adcdc46616c">priority</a>;
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327   <span class="comment">/* always override neighbor&#39;s source address and ifindex */</span>
<a name="l00328"></a>00328   on-&gt;<a class="code" href="structospf6__neighbor.html#a730cf0c52d900626513c59975ff6dd0b">ifindex</a> = ntohl (hello-&gt;<a class="code" href="structospf6__hello.html#a2f7c26913d42af645dc312d90b771430">interface_id</a>);
<a name="l00329"></a>00329   <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;on-&gt;<a class="code" href="structospf6__neighbor.html#a2b28434ae3a26d2a1e10fc30d4384920">linklocal_addr</a>, src, sizeof (<span class="keyword">struct</span> in6_addr));
<a name="l00330"></a>00330 
<a name="l00331"></a>00331   <span class="comment">/* TwoWay check */</span>
<a name="l00332"></a>00332   <span class="keywordflow">for</span> (p = (<span class="keywordtype">char</span> *) ((caddr_t) hello + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__hello.html">ospf6_hello</a>));
<a name="l00333"></a>00333        p + <span class="keyword">sizeof</span> (u_int32_t) &lt;= <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh);
<a name="l00334"></a>00334        p += <span class="keyword">sizeof</span> (u_int32_t))
<a name="l00335"></a>00335     {
<a name="l00336"></a>00336       u_int32_t *<a class="code" href="structospf6__header.html#a53d5dbfa8cc8c72d2e4681d78258b6a7">router_id</a> = (u_int32_t *) p;
<a name="l00337"></a>00337 
<a name="l00338"></a>00338       <span class="keywordflow">if</span> (*router_id == oi-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a86562db489ba46500cda50f4fa646c69">ospf6</a>-&gt;<a class="code" href="structospf6.html#a4dc92a648ae2190f7cf5b383c475d2aa">router_id</a>)
<a name="l00339"></a>00339         twoway++;
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341 
<a name="l00342"></a>00342   <span class="keywordflow">if</span> (p != <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh))
<a name="l00343"></a>00343     {
<a name="l00344"></a>00344       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00345"></a>00345         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Trailing garbage ignored&quot;</span>);
<a name="l00346"></a>00346     }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348   <span class="comment">/* RouterPriority check */</span>
<a name="l00349"></a>00349   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a9035e4443ced9c02caef273c1375c1a7">priority</a> != hello-&gt;<a class="code" href="structospf6__hello.html#a27d677bd81ca4bb5e3da0adcdc46616c">priority</a>)
<a name="l00350"></a>00350     {
<a name="l00351"></a>00351       on-&gt;<a class="code" href="structospf6__neighbor.html#a9035e4443ced9c02caef273c1375c1a7">priority</a> = hello-&gt;<a class="code" href="structospf6__hello.html#a27d677bd81ca4bb5e3da0adcdc46616c">priority</a>;
<a name="l00352"></a>00352       neighborchange++;
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355   <span class="comment">/* DR check */</span>
<a name="l00356"></a>00356   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a71a9a7c78bf284d3b6ccf019d5724bc4">drouter</a> != hello-&gt;<a class="code" href="structospf6__hello.html#afb3b0ce9544783eb334693ff084e3e53">drouter</a>)
<a name="l00357"></a>00357     {
<a name="l00358"></a>00358       on-&gt;<a class="code" href="structospf6__neighbor.html#aa7aa920cd50d36c888eba22cef7741b4">prev_drouter</a> = on-&gt;<a class="code" href="structospf6__neighbor.html#a71a9a7c78bf284d3b6ccf019d5724bc4">drouter</a>;
<a name="l00359"></a>00359       on-&gt;<a class="code" href="structospf6__neighbor.html#a71a9a7c78bf284d3b6ccf019d5724bc4">drouter</a> = hello-&gt;<a class="code" href="structospf6__hello.html#afb3b0ce9544783eb334693ff084e3e53">drouter</a>;
<a name="l00360"></a>00360       <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#aa7aa920cd50d36c888eba22cef7741b4">prev_drouter</a> == on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e3045fcc29c1083d1b638fd64e07e0">router_id</a> || on-&gt;<a class="code" href="structospf6__neighbor.html#a71a9a7c78bf284d3b6ccf019d5724bc4">drouter</a> == on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e3045fcc29c1083d1b638fd64e07e0">router_id</a>)
<a name="l00361"></a>00361         neighborchange++;
<a name="l00362"></a>00362     }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364   <span class="comment">/* BDR check */</span>
<a name="l00365"></a>00365   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a51bfd494bc8b93c40f6645d8e0fb4223">bdrouter</a> != hello-&gt;<a class="code" href="structospf6__hello.html#a8f28e7af24bc5ec67f8e93ae10888f4f">bdrouter</a>)
<a name="l00366"></a>00366     {
<a name="l00367"></a>00367       on-&gt;<a class="code" href="structospf6__neighbor.html#ab63cabfde3bd2bd93c0857d2aa446400">prev_bdrouter</a> = on-&gt;<a class="code" href="structospf6__neighbor.html#a51bfd494bc8b93c40f6645d8e0fb4223">bdrouter</a>;
<a name="l00368"></a>00368       on-&gt;<a class="code" href="structospf6__neighbor.html#a51bfd494bc8b93c40f6645d8e0fb4223">bdrouter</a> = hello-&gt;<a class="code" href="structospf6__hello.html#a8f28e7af24bc5ec67f8e93ae10888f4f">bdrouter</a>;
<a name="l00369"></a>00369       <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#ab63cabfde3bd2bd93c0857d2aa446400">prev_bdrouter</a> == on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e3045fcc29c1083d1b638fd64e07e0">router_id</a> || on-&gt;<a class="code" href="structospf6__neighbor.html#a51bfd494bc8b93c40f6645d8e0fb4223">bdrouter</a> == on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e3045fcc29c1083d1b638fd64e07e0">router_id</a>)
<a name="l00370"></a>00370         neighborchange++;
<a name="l00371"></a>00371     }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373   <span class="comment">/* BackupSeen check */</span>
<a name="l00374"></a>00374   <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#aafdfe7c67c1ff540201718b688e0a15b">state</a> == <a class="code" href="ospf6__interface_8h.html#a7af1b8c38ed1a44f1b883d25f8c851e2">OSPF6_INTERFACE_WAITING</a>)
<a name="l00375"></a>00375     {
<a name="l00376"></a>00376       <span class="keywordflow">if</span> (hello-&gt;<a class="code" href="structospf6__hello.html#a8f28e7af24bc5ec67f8e93ae10888f4f">bdrouter</a> == on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e3045fcc29c1083d1b638fd64e07e0">router_id</a>)
<a name="l00377"></a>00377         backupseen++;
<a name="l00378"></a>00378       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hello-&gt;<a class="code" href="structospf6__hello.html#afb3b0ce9544783eb334693ff084e3e53">drouter</a> == on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e3045fcc29c1083d1b638fd64e07e0">router_id</a> &amp;&amp; hello-&gt;<a class="code" href="structospf6__hello.html#a8f28e7af24bc5ec67f8e93ae10888f4f">bdrouter</a> == htonl (0))
<a name="l00379"></a>00379         backupseen++;
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382   <span class="comment">/* Execute neighbor events */</span>
<a name="l00383"></a>00383   <a class="code" href="thread_8h.html#adfc9185c89375a240b90ab50241c497d">thread_execute</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#ad4c742a29bb4b2eadd7d823c47027941">hello_received</a>, on, 0);
<a name="l00384"></a>00384   <span class="keywordflow">if</span> (twoway)
<a name="l00385"></a>00385     <a class="code" href="thread_8h.html#adfc9185c89375a240b90ab50241c497d">thread_execute</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a1a46499f13697058c4433ef7e3d12645">twoway_received</a>, on, 0);
<a name="l00386"></a>00386   <span class="keywordflow">else</span>
<a name="l00387"></a>00387     <a class="code" href="thread_8h.html#adfc9185c89375a240b90ab50241c497d">thread_execute</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a1fb6360380d66c19f93eeac4b9486a6b">oneway_received</a>, on, 0);
<a name="l00388"></a>00388 
<a name="l00389"></a>00389   <span class="comment">/* Schedule interface events */</span>
<a name="l00390"></a>00390   <span class="keywordflow">if</span> (backupseen)
<a name="l00391"></a>00391     <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__interface_8c.html#a3b694ccf3a531f3cf4d582828a0fe4af">backup_seen</a>, oi, 0);
<a name="l00392"></a>00392   <span class="keywordflow">if</span> (neighborchange)
<a name="l00393"></a>00393     <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__interface_8c.html#afe0e883750ee5ad5f90ba39754467407">neighbor_change</a>, oi, 0);
<a name="l00394"></a>00394 }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00397"></a><a class="code" href="ospf6__message_8c.html#a3cad29367ca6573220adabcba49514bf">00397</a> <a class="code" href="ospf6__message_8c.html#a3cad29367ca6573220adabcba49514bf">ospf6_dbdesc_recv_master</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh,
<a name="l00398"></a>00398                           <span class="keyword">struct</span> <a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on)
<a name="l00399"></a>00399 {
<a name="l00400"></a>00400   <span class="keyword">struct </span><a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a> *dbdesc;
<a name="l00401"></a>00401   <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l00402"></a>00402 
<a name="l00403"></a>00403   dbdesc = (<span class="keyword">struct </span><a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a> *)
<a name="l00404"></a>00404     ((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l00405"></a>00405 
<a name="l00406"></a>00406   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> &lt; <a class="code" href="ospf6__neighbor_8h.html#aafc5ff11ba1a9aafe6a27792d1137a7e">OSPF6_NEIGHBOR_INIT</a>)
<a name="l00407"></a>00407     {
<a name="l00408"></a>00408       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00409"></a>00409         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor state less than Init, ignore&quot;</span>);
<a name="l00410"></a>00410       <span class="keywordflow">return</span>;
<a name="l00411"></a>00411     }
<a name="l00412"></a>00412 
<a name="l00413"></a>00413   <span class="keywordflow">switch</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a>)
<a name="l00414"></a>00414     {
<a name="l00415"></a>00415     <span class="keywordflow">case</span> <a class="code" href="ospf6__neighbor_8h.html#afc191d3ebf67c52c9c2a8bb13979f915">OSPF6_NEIGHBOR_TWOWAY</a>:
<a name="l00416"></a>00416       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00417"></a>00417         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor state is 2-Way, ignore&quot;</span>);
<a name="l00418"></a>00418       <span class="keywordflow">return</span>;
<a name="l00419"></a>00419 
<a name="l00420"></a>00420     <span class="keywordflow">case</span> <a class="code" href="ospf6__neighbor_8h.html#aafc5ff11ba1a9aafe6a27792d1137a7e">OSPF6_NEIGHBOR_INIT</a>:
<a name="l00421"></a>00421       <a class="code" href="thread_8h.html#adfc9185c89375a240b90ab50241c497d">thread_execute</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a1a46499f13697058c4433ef7e3d12645">twoway_received</a>, on, 0);
<a name="l00422"></a>00422       <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#a127b580f45ab0c59d908b0a07c8b4574">OSPF6_NEIGHBOR_EXSTART</a>)
<a name="l00423"></a>00423         {
<a name="l00424"></a>00424           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00425"></a>00425             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor state is not ExStart, ignore&quot;</span>);
<a name="l00426"></a>00426           <span class="keywordflow">return</span>;
<a name="l00427"></a>00427         }
<a name="l00428"></a>00428       <span class="comment">/* else fall through to ExStart */</span>
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="keywordflow">case</span> <a class="code" href="ospf6__neighbor_8h.html#a127b580f45ab0c59d908b0a07c8b4574">OSPF6_NEIGHBOR_EXSTART</a>:
<a name="l00431"></a>00431       <span class="comment">/* if neighbor obeys us as our slave, schedule negotiation_done</span>
<a name="l00432"></a>00432 <span class="comment">         and process LSA Headers. Otherwise, ignore this message */</span>
<a name="l00433"></a>00433       <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#aca7fe538d9edb962ca47fbeec7e4bf6b">OSPF6_DBDESC_MSBIT</a>) &amp;&amp;
<a name="l00434"></a>00434           ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#a1de1fec9c59c8037fa5f6cb5f8bf35cb">OSPF6_DBDESC_IBIT</a>) &amp;&amp;
<a name="l00435"></a>00435           ntohl (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#ad7bdcd6eb854254824f0932e67834f16">seqnum</a>) == on-&gt;<a class="code" href="structospf6__neighbor.html#ac1d6bfb88eaad876f48cbda9787f617b">dbdesc_seqnum</a>)
<a name="l00436"></a>00436         {
<a name="l00437"></a>00437           <span class="comment">/* execute NegotiationDone */</span>
<a name="l00438"></a>00438           <a class="code" href="thread_8h.html#adfc9185c89375a240b90ab50241c497d">thread_execute</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a919ab367c8cea6cb6ca56decc5dceef1">negotiation_done</a>, on, 0);
<a name="l00439"></a>00439 
<a name="l00440"></a>00440           <span class="comment">/* Record neighbor options */</span>
<a name="l00441"></a>00441           <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a3992951f3f0c1be6d845e8ad6e732617">options</a>, dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#af1290ef8a9bc29c30daa8568df7556e3">options</a>, sizeof (on-&gt;<a class="code" href="structospf6__neighbor.html#a3992951f3f0c1be6d845e8ad6e732617">options</a>));
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443       <span class="keywordflow">else</span>
<a name="l00444"></a>00444         {
<a name="l00445"></a>00445           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00446"></a>00446             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Negotiation failed&quot;</span>);
<a name="l00447"></a>00447           <span class="keywordflow">return</span>;
<a name="l00448"></a>00448         }
<a name="l00449"></a>00449       <span class="comment">/* fall through to exchange */</span>
<a name="l00450"></a>00450 
<a name="l00451"></a>00451     <span class="keywordflow">case</span> <a class="code" href="ospf6__neighbor_8h.html#afa0419c15460d1d703d2b3cfa7859984">OSPF6_NEIGHBOR_EXCHANGE</a>:
<a name="l00452"></a>00452       <span class="keywordflow">if</span> (! <a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (dbdesc, &amp;on-&gt;<a class="code" href="structospf6__neighbor.html#a78fd4919e6c9e3d142210f5732696816">dbdesc_last</a>, sizeof (<span class="keyword">struct</span> <a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a>)))
<a name="l00453"></a>00453         {
<a name="l00454"></a>00454           <span class="comment">/* Duplicated DatabaseDescription is dropped by master */</span>
<a name="l00455"></a>00455           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00456"></a>00456             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Duplicated dbdesc discarded by Master, ignore&quot;</span>);
<a name="l00457"></a>00457           <span class="keywordflow">return</span>;
<a name="l00458"></a>00458         }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460       <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#aca7fe538d9edb962ca47fbeec7e4bf6b">OSPF6_DBDESC_MSBIT</a>))
<a name="l00461"></a>00461         {
<a name="l00462"></a>00462           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00463"></a>00463             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Master/Slave bit mismatch&quot;</span>);
<a name="l00464"></a>00464           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a8e494687f908a9f68e057d004d988490">seqnumber_mismatch</a>, on, 0);
<a name="l00465"></a>00465           <span class="keywordflow">return</span>;
<a name="l00466"></a>00466         }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468       <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#a1de1fec9c59c8037fa5f6cb5f8bf35cb">OSPF6_DBDESC_IBIT</a>))
<a name="l00469"></a>00469         {
<a name="l00470"></a>00470           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00471"></a>00471             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Initialize bit mismatch&quot;</span>);
<a name="l00472"></a>00472           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a8e494687f908a9f68e057d004d988490">seqnumber_mismatch</a>, on, 0);
<a name="l00473"></a>00473           <span class="keywordflow">return</span>;
<a name="l00474"></a>00474         }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476       <span class="keywordflow">if</span> (<a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a3992951f3f0c1be6d845e8ad6e732617">options</a>, dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#af1290ef8a9bc29c30daa8568df7556e3">options</a>, sizeof (on-&gt;<a class="code" href="structospf6__neighbor.html#a3992951f3f0c1be6d845e8ad6e732617">options</a>)))
<a name="l00477"></a>00477         {
<a name="l00478"></a>00478           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00479"></a>00479             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Option field mismatch&quot;</span>);
<a name="l00480"></a>00480           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a8e494687f908a9f68e057d004d988490">seqnumber_mismatch</a>, on, 0);
<a name="l00481"></a>00481           <span class="keywordflow">return</span>;
<a name="l00482"></a>00482         }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484       <span class="keywordflow">if</span> (ntohl (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#ad7bdcd6eb854254824f0932e67834f16">seqnum</a>) != on-&gt;<a class="code" href="structospf6__neighbor.html#ac1d6bfb88eaad876f48cbda9787f617b">dbdesc_seqnum</a>)
<a name="l00485"></a>00485         {
<a name="l00486"></a>00486           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00487"></a>00487             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Sequence number mismatch (%#lx expected)&quot;</span>,
<a name="l00488"></a>00488                        (u_long) on-&gt;<a class="code" href="structospf6__neighbor.html#ac1d6bfb88eaad876f48cbda9787f617b">dbdesc_seqnum</a>);
<a name="l00489"></a>00489           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a8e494687f908a9f68e057d004d988490">seqnumber_mismatch</a>, on, 0);
<a name="l00490"></a>00490           <span class="keywordflow">return</span>;
<a name="l00491"></a>00491         }
<a name="l00492"></a>00492       <span class="keywordflow">break</span>;
<a name="l00493"></a>00493 
<a name="l00494"></a>00494     <span class="keywordflow">case</span> <a class="code" href="ospf6__neighbor_8h.html#aa50b6edd6d1268220ae4e13b2fef14e8">OSPF6_NEIGHBOR_LOADING</a>:
<a name="l00495"></a>00495     <span class="keywordflow">case</span> <a class="code" href="ospf6__neighbor_8h.html#aae1490b2e9d8ca36df8b2127dcc289c1">OSPF6_NEIGHBOR_FULL</a>:
<a name="l00496"></a>00496       <span class="keywordflow">if</span> (! <a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (dbdesc, &amp;on-&gt;<a class="code" href="structospf6__neighbor.html#a78fd4919e6c9e3d142210f5732696816">dbdesc_last</a>, sizeof (<span class="keyword">struct</span> <a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a>)))
<a name="l00497"></a>00497         {
<a name="l00498"></a>00498           <span class="comment">/* Duplicated DatabaseDescription is dropped by master */</span>
<a name="l00499"></a>00499           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00500"></a>00500             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Duplicated dbdesc discarded by Master, ignore&quot;</span>);
<a name="l00501"></a>00501           <span class="keywordflow">return</span>;
<a name="l00502"></a>00502         }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00505"></a>00505         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Not duplicate dbdesc in state %s&quot;</span>,
<a name="l00506"></a>00506             <a class="code" href="ospf6__neighbor_8c.html#aee78e9afc46a9acd2c77382df5760c03">ospf6_neighbor_state_str</a>[on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a>]);
<a name="l00507"></a>00507       <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a8e494687f908a9f68e057d004d988490">seqnumber_mismatch</a>, on, 0);
<a name="l00508"></a>00508       <span class="keywordflow">return</span>;
<a name="l00509"></a>00509 
<a name="l00510"></a>00510     <span class="keywordflow">default</span>:
<a name="l00511"></a>00511       <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (0);
<a name="l00512"></a>00512       <span class="keywordflow">break</span>;
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515   <span class="comment">/* Process LSA headers */</span>
<a name="l00516"></a>00516   <span class="keywordflow">for</span> (p = (<span class="keywordtype">char</span> *) ((caddr_t) dbdesc + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a>));
<a name="l00517"></a>00517        p + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>) &lt;= <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh);
<a name="l00518"></a>00518        p += <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>))
<a name="l00519"></a>00519     {
<a name="l00520"></a>00520       <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *his, *mine;
<a name="l00521"></a>00521       <span class="keyword">struct </span><a class="code" href="structospf6__lsdb.html">ospf6_lsdb</a> *lsdb = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00522"></a>00522 
<a name="l00523"></a>00523       his = <a class="code" href="ospf6__lsa_8c.html#a8bf58d5701076e46ec5317268c83eea2">ospf6_lsa_create_headeronly</a> ((<span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a> *) p);
<a name="l00524"></a>00524 
<a name="l00525"></a>00525       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00526"></a>00526         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s&quot;</span>, his-&gt;name);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528       <span class="keywordflow">switch</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (his-&gt;header-&gt;type))
<a name="l00529"></a>00529         {
<a name="l00530"></a>00530         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#ab41aaca88cc27f951f7dbf46b5a6fb5c">OSPF6_SCOPE_LINKLOCAL</a>:
<a name="l00531"></a>00531           lsdb = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#ab033cb877fe417705f424d1bd2f411de">lsdb</a>;
<a name="l00532"></a>00532           <span class="keywordflow">break</span>;
<a name="l00533"></a>00533         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0634f2bb73a043f5782d28e4e3a1ad95">OSPF6_SCOPE_AREA</a>:
<a name="l00534"></a>00534           lsdb = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a9e658e62c2d59151531bc03b95b600bb">lsdb</a>;
<a name="l00535"></a>00535           <span class="keywordflow">break</span>;
<a name="l00536"></a>00536         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0701d1d9c961cfb8d6da273382ea508a">OSPF6_SCOPE_AS</a>:
<a name="l00537"></a>00537           lsdb = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a86562db489ba46500cda50f4fa646c69">ospf6</a>-&gt;<a class="code" href="structospf6.html#ac8cf84e34e8461f5aea2737fc2bf8fcb">lsdb</a>;
<a name="l00538"></a>00538           <span class="keywordflow">break</span>;
<a name="l00539"></a>00539         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0fde4f629d4c21c3cfb402a91e1205a9">OSPF6_SCOPE_RESERVED</a>:
<a name="l00540"></a>00540           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00541"></a>00541             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Ignoring LSA of reserved scope&quot;</span>);
<a name="l00542"></a>00542           <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (his);
<a name="l00543"></a>00543           <span class="keywordflow">continue</span>;
<a name="l00544"></a>00544           <span class="keywordflow">break</span>;
<a name="l00545"></a>00545         }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547       <span class="keywordflow">if</span> (ntohs (his-&gt;header-&gt;type) == <a class="code" href="ospf6__lsa_8h.html#a4cba002872c9f1e86a8d3fcede9fe4dc">OSPF6_LSTYPE_AS_EXTERNAL</a> &amp;&amp;
<a name="l00548"></a>00548           <a class="code" href="ospf6__area_8h.html#af08848f9c3f603caf4af634755a5f3c4">IS_AREA_STUB</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>))
<a name="l00549"></a>00549         {
<a name="l00550"></a>00550           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00551"></a>00551             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;SeqNumMismatch (E-bit mismatch), discard&quot;</span>);
<a name="l00552"></a>00552           <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (his);
<a name="l00553"></a>00553           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a8e494687f908a9f68e057d004d988490">seqnumber_mismatch</a>, on, 0);
<a name="l00554"></a>00554           <span class="keywordflow">return</span>;
<a name="l00555"></a>00555         }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557       mine = <a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (his-&gt;header-&gt;type, his-&gt;header-&gt;id,
<a name="l00558"></a>00558                                 his-&gt;header-&gt;adv_router, lsdb);
<a name="l00559"></a>00559       <span class="keywordflow">if</span> (mine == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00560"></a>00560         {
<a name="l00561"></a>00561           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00562"></a>00562             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Add request (No database copy)&quot;</span>);
<a name="l00563"></a>00563           <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (his, on-&gt;<a class="code" href="structospf6__neighbor.html#a1e0692790f663381e86374ed0e829f95">request_list</a>);
<a name="l00564"></a>00564         }
<a name="l00565"></a>00565       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8c.html#af1665de6eac6dab108363c1bf6320c69">ospf6_lsa_compare</a> (his, mine) &lt; 0)
<a name="l00566"></a>00566         {
<a name="l00567"></a>00567           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00568"></a>00568             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Add request (Received MoreRecent)&quot;</span>);
<a name="l00569"></a>00569           <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (his, on-&gt;<a class="code" href="structospf6__neighbor.html#a1e0692790f663381e86374ed0e829f95">request_list</a>);
<a name="l00570"></a>00570         }
<a name="l00571"></a>00571       <span class="keywordflow">else</span>
<a name="l00572"></a>00572         {
<a name="l00573"></a>00573           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00574"></a>00574             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Discard (Existing MoreRecent)&quot;</span>);
<a name="l00575"></a>00575           <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (his);
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577     }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579   <span class="keywordflow">if</span> (p != <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh))
<a name="l00580"></a>00580     {
<a name="l00581"></a>00581       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00582"></a>00582         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Trailing garbage ignored&quot;</span>);
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585   <span class="comment">/* Increment sequence number */</span>
<a name="l00586"></a>00586   on-&gt;<a class="code" href="structospf6__neighbor.html#ac1d6bfb88eaad876f48cbda9787f617b">dbdesc_seqnum</a> ++;
<a name="l00587"></a>00587 
<a name="l00588"></a>00588   <span class="comment">/* schedule send lsreq */</span>
<a name="l00589"></a>00589   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a645f58ca5b6b428ae7ae616bc4781f51">thread_send_lsreq</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00590"></a>00590     on-&gt;<a class="code" href="structospf6__neighbor.html#a645f58ca5b6b428ae7ae616bc4781f51">thread_send_lsreq</a> =
<a name="l00591"></a>00591       <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#af83f5687852b02777d049247cc518e8e">ospf6_lsreq_send</a>, on, 0);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593   <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a1a4c0c39a774eea8cd35f2f4d96f77b6">thread_send_dbdesc</a>);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595   <span class="comment">/* More bit check */</span>
<a name="l00596"></a>00596   <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#a6b4ff9c565893a42ee04d66d477b0802">OSPF6_DBDESC_MBIT</a>) &amp;&amp;
<a name="l00597"></a>00597       ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac15b90e0b312bdbd6fe1c95b1008b52a">dbdesc_bits</a>, <a class="code" href="ospf6__message_8h.html#a6b4ff9c565893a42ee04d66d477b0802">OSPF6_DBDESC_MBIT</a>))
<a name="l00598"></a>00598     <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a74fd583c4b2b26c3ec3c39b30ab2c54d">exchange_done</a>, on, 0);
<a name="l00599"></a>00599   <span class="keywordflow">else</span>
<a name="l00600"></a>00600     on-&gt;<a class="code" href="structospf6__neighbor.html#a1a4c0c39a774eea8cd35f2f4d96f77b6">thread_send_dbdesc</a> =
<a name="l00601"></a>00601       <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a695acafa16585e5fc57cd8c563b54c5e">ospf6_dbdesc_send_newone</a>, on, 0);
<a name="l00602"></a>00602 
<a name="l00603"></a>00603   <span class="comment">/* save last received dbdesc */</span>
<a name="l00604"></a>00604   <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;on-&gt;<a class="code" href="structospf6__neighbor.html#a78fd4919e6c9e3d142210f5732696816">dbdesc_last</a>, dbdesc, sizeof (<span class="keyword">struct</span> <a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a>));
<a name="l00605"></a>00605 }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00608"></a><a class="code" href="ospf6__message_8c.html#a0e6dc40c4e2eb4ac7b9414b02c09a63d">00608</a> <a class="code" href="ospf6__message_8c.html#a0e6dc40c4e2eb4ac7b9414b02c09a63d">ospf6_dbdesc_recv_slave</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh,
<a name="l00609"></a>00609                          <span class="keyword">struct</span> <a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on)
<a name="l00610"></a>00610 {
<a name="l00611"></a>00611   <span class="keyword">struct </span><a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a> *dbdesc;
<a name="l00612"></a>00612   <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l00613"></a>00613 
<a name="l00614"></a>00614   dbdesc = (<span class="keyword">struct </span><a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a> *)
<a name="l00615"></a>00615     ((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l00616"></a>00616 
<a name="l00617"></a>00617   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> &lt; <a class="code" href="ospf6__neighbor_8h.html#aafc5ff11ba1a9aafe6a27792d1137a7e">OSPF6_NEIGHBOR_INIT</a>)
<a name="l00618"></a>00618     {
<a name="l00619"></a>00619       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00620"></a>00620         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor state less than Init, ignore&quot;</span>);
<a name="l00621"></a>00621       <span class="keywordflow">return</span>;
<a name="l00622"></a>00622     }
<a name="l00623"></a>00623 
<a name="l00624"></a>00624   <span class="keywordflow">switch</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a>)
<a name="l00625"></a>00625     {
<a name="l00626"></a>00626     <span class="keywordflow">case</span> <a class="code" href="ospf6__neighbor_8h.html#afc191d3ebf67c52c9c2a8bb13979f915">OSPF6_NEIGHBOR_TWOWAY</a>:
<a name="l00627"></a>00627       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00628"></a>00628         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor state is 2-Way, ignore&quot;</span>);
<a name="l00629"></a>00629       <span class="keywordflow">return</span>;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     <span class="keywordflow">case</span> <a class="code" href="ospf6__neighbor_8h.html#aafc5ff11ba1a9aafe6a27792d1137a7e">OSPF6_NEIGHBOR_INIT</a>:
<a name="l00632"></a>00632       <a class="code" href="thread_8h.html#adfc9185c89375a240b90ab50241c497d">thread_execute</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a1a46499f13697058c4433ef7e3d12645">twoway_received</a>, on, 0);
<a name="l00633"></a>00633       <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#a127b580f45ab0c59d908b0a07c8b4574">OSPF6_NEIGHBOR_EXSTART</a>)
<a name="l00634"></a>00634         {
<a name="l00635"></a>00635           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00636"></a>00636             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor state is not ExStart, ignore&quot;</span>);
<a name="l00637"></a>00637           <span class="keywordflow">return</span>;
<a name="l00638"></a>00638         }
<a name="l00639"></a>00639       <span class="comment">/* else fall through to ExStart */</span>
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     <span class="keywordflow">case</span> <a class="code" href="ospf6__neighbor_8h.html#a127b580f45ab0c59d908b0a07c8b4574">OSPF6_NEIGHBOR_EXSTART</a>:
<a name="l00642"></a>00642       <span class="comment">/* If the neighbor is Master, act as Slave. Schedule negotiation_done</span>
<a name="l00643"></a>00643 <span class="comment">         and process LSA Headers. Otherwise, ignore this message */</span>
<a name="l00644"></a>00644       <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#a1de1fec9c59c8037fa5f6cb5f8bf35cb">OSPF6_DBDESC_IBIT</a>) &amp;&amp;
<a name="l00645"></a>00645           <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#a6b4ff9c565893a42ee04d66d477b0802">OSPF6_DBDESC_MBIT</a>) &amp;&amp;
<a name="l00646"></a>00646           <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#aca7fe538d9edb962ca47fbeec7e4bf6b">OSPF6_DBDESC_MSBIT</a>) &amp;&amp;
<a name="l00647"></a>00647           ntohs (oh-&gt;<a class="code" href="structospf6__header.html#aef7496dd76d0c2eca889f7a9d01936ff">length</a>) == sizeof (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a>) +
<a name="l00648"></a>00648                                 <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a>))
<a name="l00649"></a>00649         {
<a name="l00650"></a>00650           <span class="comment">/* set the master/slave bit to slave */</span>
<a name="l00651"></a>00651           <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac15b90e0b312bdbd6fe1c95b1008b52a">dbdesc_bits</a>, <a class="code" href="ospf6__message_8h.html#aca7fe538d9edb962ca47fbeec7e4bf6b">OSPF6_DBDESC_MSBIT</a>);
<a name="l00652"></a>00652 
<a name="l00653"></a>00653           <span class="comment">/* set the DD sequence number to one specified by master */</span>
<a name="l00654"></a>00654           on-&gt;<a class="code" href="structospf6__neighbor.html#ac1d6bfb88eaad876f48cbda9787f617b">dbdesc_seqnum</a> = ntohl (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#ad7bdcd6eb854254824f0932e67834f16">seqnum</a>);
<a name="l00655"></a>00655 
<a name="l00656"></a>00656           <span class="comment">/* schedule NegotiationDone */</span>
<a name="l00657"></a>00657           <a class="code" href="thread_8h.html#adfc9185c89375a240b90ab50241c497d">thread_execute</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a919ab367c8cea6cb6ca56decc5dceef1">negotiation_done</a>, on, 0);
<a name="l00658"></a>00658 
<a name="l00659"></a>00659           <span class="comment">/* Record neighbor options */</span>
<a name="l00660"></a>00660           <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a3992951f3f0c1be6d845e8ad6e732617">options</a>, dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#af1290ef8a9bc29c30daa8568df7556e3">options</a>, sizeof (on-&gt;<a class="code" href="structospf6__neighbor.html#a3992951f3f0c1be6d845e8ad6e732617">options</a>));
<a name="l00661"></a>00661         }
<a name="l00662"></a>00662       <span class="keywordflow">else</span>
<a name="l00663"></a>00663         {
<a name="l00664"></a>00664           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00665"></a>00665             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Negotiation failed&quot;</span>);
<a name="l00666"></a>00666           <span class="keywordflow">return</span>;
<a name="l00667"></a>00667         }
<a name="l00668"></a>00668       <span class="keywordflow">break</span>;
<a name="l00669"></a>00669 
<a name="l00670"></a>00670     <span class="keywordflow">case</span> <a class="code" href="ospf6__neighbor_8h.html#afa0419c15460d1d703d2b3cfa7859984">OSPF6_NEIGHBOR_EXCHANGE</a>:
<a name="l00671"></a>00671       <span class="keywordflow">if</span> (! <a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (dbdesc, &amp;on-&gt;<a class="code" href="structospf6__neighbor.html#a78fd4919e6c9e3d142210f5732696816">dbdesc_last</a>, sizeof (<span class="keyword">struct</span> <a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a>)))
<a name="l00672"></a>00672         {
<a name="l00673"></a>00673           <span class="comment">/* Duplicated DatabaseDescription causes slave to retransmit */</span>
<a name="l00674"></a>00674           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00675"></a>00675             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Duplicated dbdesc causes retransmit&quot;</span>);
<a name="l00676"></a>00676           <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a1a4c0c39a774eea8cd35f2f4d96f77b6">thread_send_dbdesc</a>);
<a name="l00677"></a>00677           on-&gt;<a class="code" href="structospf6__neighbor.html#a1a4c0c39a774eea8cd35f2f4d96f77b6">thread_send_dbdesc</a> =
<a name="l00678"></a>00678             <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a42f57245d02e4581ca30fd1e5fc9a533">ospf6_dbdesc_send</a>, on, 0);
<a name="l00679"></a>00679           <span class="keywordflow">return</span>;
<a name="l00680"></a>00680         }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682       <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#aca7fe538d9edb962ca47fbeec7e4bf6b">OSPF6_DBDESC_MSBIT</a>))
<a name="l00683"></a>00683         {
<a name="l00684"></a>00684           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00685"></a>00685             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Master/Slave bit mismatch&quot;</span>);
<a name="l00686"></a>00686           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a8e494687f908a9f68e057d004d988490">seqnumber_mismatch</a>, on, 0);
<a name="l00687"></a>00687           <span class="keywordflow">return</span>;
<a name="l00688"></a>00688         }
<a name="l00689"></a>00689 
<a name="l00690"></a>00690       <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#a1de1fec9c59c8037fa5f6cb5f8bf35cb">OSPF6_DBDESC_IBIT</a>))
<a name="l00691"></a>00691         {
<a name="l00692"></a>00692           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00693"></a>00693             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Initialize bit mismatch&quot;</span>);
<a name="l00694"></a>00694           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a8e494687f908a9f68e057d004d988490">seqnumber_mismatch</a>, on, 0);
<a name="l00695"></a>00695           <span class="keywordflow">return</span>;
<a name="l00696"></a>00696         }
<a name="l00697"></a>00697 
<a name="l00698"></a>00698       <span class="keywordflow">if</span> (<a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a3992951f3f0c1be6d845e8ad6e732617">options</a>, dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#af1290ef8a9bc29c30daa8568df7556e3">options</a>, sizeof (on-&gt;<a class="code" href="structospf6__neighbor.html#a3992951f3f0c1be6d845e8ad6e732617">options</a>)))
<a name="l00699"></a>00699         {
<a name="l00700"></a>00700           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00701"></a>00701             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Option field mismatch&quot;</span>);
<a name="l00702"></a>00702           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a8e494687f908a9f68e057d004d988490">seqnumber_mismatch</a>, on, 0);
<a name="l00703"></a>00703           <span class="keywordflow">return</span>;
<a name="l00704"></a>00704         }
<a name="l00705"></a>00705 
<a name="l00706"></a>00706       <span class="keywordflow">if</span> (ntohl (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#ad7bdcd6eb854254824f0932e67834f16">seqnum</a>) != on-&gt;<a class="code" href="structospf6__neighbor.html#ac1d6bfb88eaad876f48cbda9787f617b">dbdesc_seqnum</a> + 1)
<a name="l00707"></a>00707         {
<a name="l00708"></a>00708           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00709"></a>00709             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Sequence number mismatch (%#lx expected)&quot;</span>,
<a name="l00710"></a>00710             (u_long) on-&gt;<a class="code" href="structospf6__neighbor.html#ac1d6bfb88eaad876f48cbda9787f617b">dbdesc_seqnum</a> + 1);
<a name="l00711"></a>00711           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a8e494687f908a9f68e057d004d988490">seqnumber_mismatch</a>, on, 0);
<a name="l00712"></a>00712           <span class="keywordflow">return</span>;
<a name="l00713"></a>00713         }
<a name="l00714"></a>00714       <span class="keywordflow">break</span>;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     <span class="keywordflow">case</span> <a class="code" href="ospf6__neighbor_8h.html#aa50b6edd6d1268220ae4e13b2fef14e8">OSPF6_NEIGHBOR_LOADING</a>:
<a name="l00717"></a>00717     <span class="keywordflow">case</span> <a class="code" href="ospf6__neighbor_8h.html#aae1490b2e9d8ca36df8b2127dcc289c1">OSPF6_NEIGHBOR_FULL</a>:
<a name="l00718"></a>00718       <span class="keywordflow">if</span> (! <a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (dbdesc, &amp;on-&gt;<a class="code" href="structospf6__neighbor.html#a78fd4919e6c9e3d142210f5732696816">dbdesc_last</a>, sizeof (<span class="keyword">struct</span> <a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a>)))
<a name="l00719"></a>00719         {
<a name="l00720"></a>00720           <span class="comment">/* Duplicated DatabaseDescription causes slave to retransmit */</span>
<a name="l00721"></a>00721           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00722"></a>00722             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Duplicated dbdesc causes retransmit&quot;</span>);
<a name="l00723"></a>00723           <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a1a4c0c39a774eea8cd35f2f4d96f77b6">thread_send_dbdesc</a>);
<a name="l00724"></a>00724           on-&gt;<a class="code" href="structospf6__neighbor.html#a1a4c0c39a774eea8cd35f2f4d96f77b6">thread_send_dbdesc</a> =
<a name="l00725"></a>00725             <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a42f57245d02e4581ca30fd1e5fc9a533">ospf6_dbdesc_send</a>, on, 0);
<a name="l00726"></a>00726           <span class="keywordflow">return</span>;
<a name="l00727"></a>00727         }
<a name="l00728"></a>00728 
<a name="l00729"></a>00729       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00730"></a>00730         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Not duplicate dbdesc in state %s&quot;</span>,
<a name="l00731"></a>00731             <a class="code" href="ospf6__neighbor_8c.html#aee78e9afc46a9acd2c77382df5760c03">ospf6_neighbor_state_str</a>[on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a>]);
<a name="l00732"></a>00732       <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a8e494687f908a9f68e057d004d988490">seqnumber_mismatch</a>, on, 0);
<a name="l00733"></a>00733       <span class="keywordflow">return</span>;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     <span class="keywordflow">default</span>:
<a name="l00736"></a>00736       <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (0);
<a name="l00737"></a>00737       <span class="keywordflow">break</span>;
<a name="l00738"></a>00738     }
<a name="l00739"></a>00739 
<a name="l00740"></a>00740   <span class="comment">/* Process LSA headers */</span>
<a name="l00741"></a>00741   <span class="keywordflow">for</span> (p = (<span class="keywordtype">char</span> *) ((caddr_t) dbdesc + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a>));
<a name="l00742"></a>00742        p + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>) &lt;= <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh);
<a name="l00743"></a>00743        p += <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>))
<a name="l00744"></a>00744     {
<a name="l00745"></a>00745       <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *his, *mine;
<a name="l00746"></a>00746       <span class="keyword">struct </span><a class="code" href="structospf6__lsdb.html">ospf6_lsdb</a> *lsdb = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00747"></a>00747 
<a name="l00748"></a>00748       his = <a class="code" href="ospf6__lsa_8c.html#a8bf58d5701076e46ec5317268c83eea2">ospf6_lsa_create_headeronly</a> ((<span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a> *) p);
<a name="l00749"></a>00749 
<a name="l00750"></a>00750       <span class="keywordflow">switch</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (his-&gt;header-&gt;type))
<a name="l00751"></a>00751         {
<a name="l00752"></a>00752         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#ab41aaca88cc27f951f7dbf46b5a6fb5c">OSPF6_SCOPE_LINKLOCAL</a>:
<a name="l00753"></a>00753           lsdb = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#ab033cb877fe417705f424d1bd2f411de">lsdb</a>;
<a name="l00754"></a>00754           <span class="keywordflow">break</span>;
<a name="l00755"></a>00755         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0634f2bb73a043f5782d28e4e3a1ad95">OSPF6_SCOPE_AREA</a>:
<a name="l00756"></a>00756           lsdb = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a9e658e62c2d59151531bc03b95b600bb">lsdb</a>;
<a name="l00757"></a>00757           <span class="keywordflow">break</span>;
<a name="l00758"></a>00758         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0701d1d9c961cfb8d6da273382ea508a">OSPF6_SCOPE_AS</a>:
<a name="l00759"></a>00759           lsdb = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a86562db489ba46500cda50f4fa646c69">ospf6</a>-&gt;<a class="code" href="structospf6.html#ac8cf84e34e8461f5aea2737fc2bf8fcb">lsdb</a>;
<a name="l00760"></a>00760           <span class="keywordflow">break</span>;
<a name="l00761"></a>00761         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0fde4f629d4c21c3cfb402a91e1205a9">OSPF6_SCOPE_RESERVED</a>:
<a name="l00762"></a>00762           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00763"></a>00763             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Ignoring LSA of reserved scope&quot;</span>);
<a name="l00764"></a>00764           <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (his);
<a name="l00765"></a>00765           <span class="keywordflow">continue</span>;
<a name="l00766"></a>00766           <span class="keywordflow">break</span>;
<a name="l00767"></a>00767         }
<a name="l00768"></a>00768 
<a name="l00769"></a>00769       <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (his-&gt;header-&gt;type) == <a class="code" href="ospf6__lsa_8h.html#a0701d1d9c961cfb8d6da273382ea508a">OSPF6_SCOPE_AS</a> &amp;&amp;
<a name="l00770"></a>00770           <a class="code" href="ospf6__area_8h.html#af08848f9c3f603caf4af634755a5f3c4">IS_AREA_STUB</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>))
<a name="l00771"></a>00771         {
<a name="l00772"></a>00772           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00773"></a>00773             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;E-bit mismatch with LSA Headers&quot;</span>);
<a name="l00774"></a>00774           <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (his);
<a name="l00775"></a>00775           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a8e494687f908a9f68e057d004d988490">seqnumber_mismatch</a>, on, 0);
<a name="l00776"></a>00776           <span class="keywordflow">return</span>;
<a name="l00777"></a>00777         }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779       mine = <a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (his-&gt;header-&gt;type, his-&gt;header-&gt;id,
<a name="l00780"></a>00780                                 his-&gt;header-&gt;adv_router, lsdb);
<a name="l00781"></a>00781       <span class="keywordflow">if</span> (mine == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || <a class="code" href="ospf6__lsa_8c.html#af1665de6eac6dab108363c1bf6320c69">ospf6_lsa_compare</a> (his, mine) &lt; 0)
<a name="l00782"></a>00782         {
<a name="l00783"></a>00783           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00784"></a>00784             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Add request-list: %s&quot;</span>, his-&gt;name);
<a name="l00785"></a>00785           <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (his, on-&gt;<a class="code" href="structospf6__neighbor.html#a1e0692790f663381e86374ed0e829f95">request_list</a>);
<a name="l00786"></a>00786         }
<a name="l00787"></a>00787       <span class="keywordflow">else</span>
<a name="l00788"></a>00788         <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (his);
<a name="l00789"></a>00789     }
<a name="l00790"></a>00790 
<a name="l00791"></a>00791   <span class="keywordflow">if</span> (p != <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh))
<a name="l00792"></a>00792     {
<a name="l00793"></a>00793       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00794"></a>00794         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Trailing garbage ignored&quot;</span>);
<a name="l00795"></a>00795     }
<a name="l00796"></a>00796 
<a name="l00797"></a>00797   <span class="comment">/* Set sequence number to Master&#39;s */</span>
<a name="l00798"></a>00798   on-&gt;<a class="code" href="structospf6__neighbor.html#ac1d6bfb88eaad876f48cbda9787f617b">dbdesc_seqnum</a> = ntohl (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#ad7bdcd6eb854254824f0932e67834f16">seqnum</a>);
<a name="l00799"></a>00799 
<a name="l00800"></a>00800   <span class="comment">/* schedule send lsreq */</span>
<a name="l00801"></a>00801   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a645f58ca5b6b428ae7ae616bc4781f51">thread_send_lsreq</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00802"></a>00802     on-&gt;<a class="code" href="structospf6__neighbor.html#a645f58ca5b6b428ae7ae616bc4781f51">thread_send_lsreq</a> =
<a name="l00803"></a>00803       <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#af83f5687852b02777d049247cc518e8e">ospf6_lsreq_send</a>, on, 0);
<a name="l00804"></a>00804 
<a name="l00805"></a>00805   <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a1a4c0c39a774eea8cd35f2f4d96f77b6">thread_send_dbdesc</a>);
<a name="l00806"></a>00806   on-&gt;<a class="code" href="structospf6__neighbor.html#a1a4c0c39a774eea8cd35f2f4d96f77b6">thread_send_dbdesc</a> =
<a name="l00807"></a>00807     <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a695acafa16585e5fc57cd8c563b54c5e">ospf6_dbdesc_send_newone</a>, on, 0);
<a name="l00808"></a>00808 
<a name="l00809"></a>00809   <span class="comment">/* save last received dbdesc */</span>
<a name="l00810"></a>00810   <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;on-&gt;<a class="code" href="structospf6__neighbor.html#a78fd4919e6c9e3d142210f5732696816">dbdesc_last</a>, dbdesc, sizeof (<span class="keyword">struct</span> <a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a>));
<a name="l00811"></a>00811 }
<a name="l00812"></a>00812 
<a name="l00813"></a>00813 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00814"></a><a class="code" href="ospf6__message_8c.html#aa40c2de125d4e0b32180d9f9e383f83e">00814</a> <a class="code" href="ospf6__message_8c.html#aa40c2de125d4e0b32180d9f9e383f83e">ospf6_dbdesc_recv</a> (<span class="keyword">struct</span> in6_addr *src, <span class="keyword">struct</span> in6_addr *dst,
<a name="l00815"></a>00815                    <span class="keyword">struct</span> <a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi, <span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh)
<a name="l00816"></a>00816 {
<a name="l00817"></a>00817   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l00818"></a>00818   <span class="keyword">struct </span><a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a> *dbdesc;
<a name="l00819"></a>00819 
<a name="l00820"></a>00820   <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8c.html#a6993c2708cb37ca3e9d2da08393a68a3">ospf6_header_examin</a> (src, dst, oi, oh) != <a class="code" href="ospf6__message_8c.html#a4ff2533d4f42b5b10b6caf648a4619b4">MSG_OK</a>)
<a name="l00821"></a>00821     <span class="keywordflow">return</span>;
<a name="l00822"></a>00822 
<a name="l00823"></a>00823   on = <a class="code" href="ospf6__neighbor_8c.html#a4b081b7bf89453a1d197bd4ccd21fb14">ospf6_neighbor_lookup</a> (oh-&gt;<a class="code" href="structospf6__header.html#a53d5dbfa8cc8c72d2e4681d78258b6a7">router_id</a>, oi);
<a name="l00824"></a>00824   <span class="keywordflow">if</span> (on == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00825"></a>00825     {
<a name="l00826"></a>00826       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00827"></a>00827         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor not found, ignore&quot;</span>);
<a name="l00828"></a>00828       <span class="keywordflow">return</span>;
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831   dbdesc = (<span class="keyword">struct </span><a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a> *)
<a name="l00832"></a>00832     ((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l00833"></a>00833 
<a name="l00834"></a>00834   <span class="comment">/* Interface MTU check */</span>
<a name="l00835"></a>00835   <span class="keywordflow">if</span> (ntohs (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a354af018af795ae987a64381168e6272">ifmtu</a>) != oi-&gt;<a class="code" href="structospf6__interface.html#a88579a4c38c3458d12425986c1a43893">ifmtu</a>)
<a name="l00836"></a>00836     {
<a name="l00837"></a>00837       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00838"></a>00838         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;I/F MTU mismatch&quot;</span>);
<a name="l00839"></a>00839       <span class="keywordflow">return</span>;
<a name="l00840"></a>00840     }
<a name="l00841"></a>00841 
<a name="l00842"></a>00842   <span class="keywordflow">if</span> (dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#ae44ba120f5bb73e841410bf9c395eb44">reserved1</a> || dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a051d6a8be42e57dfbf8119ee7411b27f">reserved2</a>)
<a name="l00843"></a>00843     {
<a name="l00844"></a>00844       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00845"></a>00845         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Non-0 reserved field in %s&#39;s DbDesc, correct&quot;</span>,
<a name="l00846"></a>00846             on-&gt;<a class="code" href="structospf6__neighbor.html#aa0ccec2f7b9c56628ce2e4a0bc37d463">name</a>);
<a name="l00847"></a>00847       dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#ae44ba120f5bb73e841410bf9c395eb44">reserved1</a> = 0;
<a name="l00848"></a>00848       dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a051d6a8be42e57dfbf8119ee7411b27f">reserved2</a> = 0;
<a name="l00849"></a>00849     }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851   <span class="keywordflow">if</span> (ntohl (oh-&gt;<a class="code" href="structospf6__header.html#a53d5dbfa8cc8c72d2e4681d78258b6a7">router_id</a>) &lt; ntohl (<a class="code" href="structospf6.html">ospf6</a>-&gt;<a class="code" href="structospf6.html#a4dc92a648ae2190f7cf5b383c475d2aa">router_id</a>))
<a name="l00852"></a>00852     <a class="code" href="ospf6__message_8c.html#a3cad29367ca6573220adabcba49514bf">ospf6_dbdesc_recv_master</a> (oh, on);
<a name="l00853"></a>00853   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ntohl (<a class="code" href="structospf6.html">ospf6</a>-&gt;<a class="code" href="structospf6.html#a4dc92a648ae2190f7cf5b383c475d2aa">router_id</a>) &lt; ntohl (oh-&gt;<a class="code" href="structospf6__header.html#a53d5dbfa8cc8c72d2e4681d78258b6a7">router_id</a>))
<a name="l00854"></a>00854     <a class="code" href="ospf6__message_8c.html#a0e6dc40c4e2eb4ac7b9414b02c09a63d">ospf6_dbdesc_recv_slave</a> (oh, on);
<a name="l00855"></a>00855   <span class="keywordflow">else</span>
<a name="l00856"></a>00856     {
<a name="l00857"></a>00857       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00858"></a>00858         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Can&#39;t decide which is master, ignore&quot;</span>);
<a name="l00859"></a>00859     }
<a name="l00860"></a>00860 }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00863"></a><a class="code" href="ospf6__message_8c.html#a1b8b158280907094de85c2192c17f6a3">00863</a> <a class="code" href="ospf6__message_8c.html#a1b8b158280907094de85c2192c17f6a3">ospf6_lsreq_recv</a> (<span class="keyword">struct</span> in6_addr *src, <span class="keyword">struct</span> in6_addr *dst,
<a name="l00864"></a>00864                   <span class="keyword">struct</span> <a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi, <span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh)
<a name="l00865"></a>00865 {
<a name="l00866"></a>00866   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l00867"></a>00867   <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l00868"></a>00868   <span class="keyword">struct </span><a class="code" href="structospf6__lsreq__entry.html">ospf6_lsreq_entry</a> *e;
<a name="l00869"></a>00869   <span class="keyword">struct </span><a class="code" href="structospf6__lsdb.html">ospf6_lsdb</a> *lsdb = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00870"></a>00870   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa;
<a name="l00871"></a>00871 
<a name="l00872"></a>00872   <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8c.html#a6993c2708cb37ca3e9d2da08393a68a3">ospf6_header_examin</a> (src, dst, oi, oh) != <a class="code" href="ospf6__message_8c.html#a4ff2533d4f42b5b10b6caf648a4619b4">MSG_OK</a>)
<a name="l00873"></a>00873     <span class="keywordflow">return</span>;
<a name="l00874"></a>00874 
<a name="l00875"></a>00875   on = <a class="code" href="ospf6__neighbor_8c.html#a4b081b7bf89453a1d197bd4ccd21fb14">ospf6_neighbor_lookup</a> (oh-&gt;<a class="code" href="structospf6__header.html#a53d5dbfa8cc8c72d2e4681d78258b6a7">router_id</a>, oi);
<a name="l00876"></a>00876   <span class="keywordflow">if</span> (on == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00877"></a>00877     {
<a name="l00878"></a>00878       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00879"></a>00879         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor not found, ignore&quot;</span>);
<a name="l00880"></a>00880       <span class="keywordflow">return</span>;
<a name="l00881"></a>00881     }
<a name="l00882"></a>00882 
<a name="l00883"></a>00883   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#afa0419c15460d1d703d2b3cfa7859984">OSPF6_NEIGHBOR_EXCHANGE</a> &amp;&amp;
<a name="l00884"></a>00884       on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#aa50b6edd6d1268220ae4e13b2fef14e8">OSPF6_NEIGHBOR_LOADING</a> &amp;&amp;
<a name="l00885"></a>00885       on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#aae1490b2e9d8ca36df8b2127dcc289c1">OSPF6_NEIGHBOR_FULL</a>)
<a name="l00886"></a>00886     {
<a name="l00887"></a>00887       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00888"></a>00888         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor state less than Exchange, ignore&quot;</span>);
<a name="l00889"></a>00889       <span class="keywordflow">return</span>;
<a name="l00890"></a>00890     }
<a name="l00891"></a>00891 
<a name="l00892"></a>00892   <span class="comment">/* Process each request */</span>
<a name="l00893"></a>00893   <span class="keywordflow">for</span> (p = (<span class="keywordtype">char</span> *) ((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l00894"></a>00894        p + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsreq__entry.html">ospf6_lsreq_entry</a>) &lt;= <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh);
<a name="l00895"></a>00895        p += <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsreq__entry.html">ospf6_lsreq_entry</a>))
<a name="l00896"></a>00896     {
<a name="l00897"></a>00897       e = (<span class="keyword">struct </span><a class="code" href="structospf6__lsreq__entry.html">ospf6_lsreq_entry</a> *) p;
<a name="l00898"></a>00898 
<a name="l00899"></a>00899       <span class="keywordflow">switch</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (e-&gt;<a class="code" href="structospf6__lsreq__entry.html#a09dbf8da910d21427e70dc809ecdbdee">type</a>))
<a name="l00900"></a>00900         {
<a name="l00901"></a>00901         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#ab41aaca88cc27f951f7dbf46b5a6fb5c">OSPF6_SCOPE_LINKLOCAL</a>:
<a name="l00902"></a>00902           lsdb = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#ab033cb877fe417705f424d1bd2f411de">lsdb</a>;
<a name="l00903"></a>00903           <span class="keywordflow">break</span>;
<a name="l00904"></a>00904         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0634f2bb73a043f5782d28e4e3a1ad95">OSPF6_SCOPE_AREA</a>:
<a name="l00905"></a>00905           lsdb = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a9e658e62c2d59151531bc03b95b600bb">lsdb</a>;
<a name="l00906"></a>00906           <span class="keywordflow">break</span>;
<a name="l00907"></a>00907         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0701d1d9c961cfb8d6da273382ea508a">OSPF6_SCOPE_AS</a>:
<a name="l00908"></a>00908           lsdb = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a86562db489ba46500cda50f4fa646c69">ospf6</a>-&gt;<a class="code" href="structospf6.html#ac8cf84e34e8461f5aea2737fc2bf8fcb">lsdb</a>;
<a name="l00909"></a>00909           <span class="keywordflow">break</span>;
<a name="l00910"></a>00910         <span class="keywordflow">default</span>:
<a name="l00911"></a>00911           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00912"></a>00912             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Ignoring LSA of reserved scope&quot;</span>);
<a name="l00913"></a>00913           <span class="keywordflow">continue</span>;
<a name="l00914"></a>00914           <span class="keywordflow">break</span>;
<a name="l00915"></a>00915         }
<a name="l00916"></a>00916 
<a name="l00917"></a>00917       <span class="comment">/* Find database copy */</span>
<a name="l00918"></a>00918       lsa = <a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (e-&gt;<a class="code" href="structospf6__lsreq__entry.html#a09dbf8da910d21427e70dc809ecdbdee">type</a>, e-&gt;<a class="code" href="structospf6__lsreq__entry.html#aba0c6eedec677748c8e48ddd6d6e3924">id</a>, e-&gt;<a class="code" href="structospf6__lsreq__entry.html#a61084665841c7716a614d48361de8b4f">adv_router</a>, lsdb);
<a name="l00919"></a>00919       <span class="keywordflow">if</span> (lsa == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00920"></a>00920         {
<a name="l00921"></a>00921           <span class="keywordtype">char</span> <span class="keywordtype">id</span>[16], <a class="code" href="structospf6__lsreq__entry.html#a61084665841c7716a614d48361de8b4f">adv_router</a>[16];
<a name="l00922"></a>00922           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00923"></a>00923             {
<a name="l00924"></a>00924               <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;e-&gt;<a class="code" href="structospf6__lsreq__entry.html#aba0c6eedec677748c8e48ddd6d6e3924">id</a>, <span class="keywordtype">id</span>, sizeof (<span class="keywordtype">id</span>));
<a name="l00925"></a>00925               <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;e-&gt;<a class="code" href="structospf6__lsreq__entry.html#a61084665841c7716a614d48361de8b4f">adv_router</a>, adv_router,
<a name="l00926"></a>00926                      sizeof (adv_router));
<a name="l00927"></a>00927               <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Can&#39;t find requested [%s Id:%s Adv:%s]&quot;</span>,
<a name="l00928"></a>00928               <a class="code" href="ospf6__lsa_8c.html#aef56342b1e39d23bf9977353c1c2deb1">ospf6_lstype_name</a> (e-&gt;<a class="code" href="structospf6__lsreq__entry.html#a09dbf8da910d21427e70dc809ecdbdee">type</a>), <span class="keywordtype">id</span>, adv_router);
<a name="l00929"></a>00929             }
<a name="l00930"></a>00930           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#ab25760cef92f7e894cdcf23ecad3833f">bad_lsreq</a>, on, 0);
<a name="l00931"></a>00931           <span class="keywordflow">return</span>;
<a name="l00932"></a>00932         }
<a name="l00933"></a>00933 
<a name="l00934"></a>00934       <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (<a class="code" href="ospf6__lsa_8c.html#a98dc000e578715b010159ca0c5b38a07">ospf6_lsa_copy</a> (lsa), on-&gt;<a class="code" href="structospf6__neighbor.html#ac3f142375bf4e9e7c8e54daed55b4ca4">lsupdate_list</a>);
<a name="l00935"></a>00935     }
<a name="l00936"></a>00936 
<a name="l00937"></a>00937   <span class="keywordflow">if</span> (p != <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh))
<a name="l00938"></a>00938     {
<a name="l00939"></a>00939       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00940"></a>00940         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Trailing garbage ignored&quot;</span>);
<a name="l00941"></a>00941     }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943   <span class="comment">/* schedule send lsupdate */</span>
<a name="l00944"></a>00944   <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e6540e3ce6bd90bc1603a529648a86">thread_send_lsupdate</a>);
<a name="l00945"></a>00945   on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e6540e3ce6bd90bc1603a529648a86">thread_send_lsupdate</a> =
<a name="l00946"></a>00946     <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a50608f7c51e0c039c4735781d1f66690">ospf6_lsupdate_send_neighbor</a>, on, 0);
<a name="l00947"></a>00947 }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00950"></a><a class="code" href="ospf6__message_8c.html#a07373ca9b500e004a857c4d3e20551cd">00950</a> <a class="code" href="ospf6__message_8c.html#a07373ca9b500e004a857c4d3e20551cd">ospf6_lsupdate_recv</a> (<span class="keyword">struct</span> in6_addr *src, <span class="keyword">struct</span> in6_addr *dst,
<a name="l00951"></a>00951                      <span class="keyword">struct</span> <a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi, <span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh)
<a name="l00952"></a>00952 {
<a name="l00953"></a>00953   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l00954"></a>00954   <span class="keyword">struct </span><a class="code" href="structospf6__lsupdate.html">ospf6_lsupdate</a> *lsupdate;
<a name="l00955"></a>00955   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="bgp__open_8h.html#ab4570498c4316aa5f7b4852c778b3320">num</a>;
<a name="l00956"></a>00956   <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l00957"></a>00957 
<a name="l00958"></a>00958   <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8c.html#a6993c2708cb37ca3e9d2da08393a68a3">ospf6_header_examin</a> (src, dst, oi, oh) != <a class="code" href="ospf6__message_8c.html#a4ff2533d4f42b5b10b6caf648a4619b4">MSG_OK</a>)
<a name="l00959"></a>00959     <span class="keywordflow">return</span>;
<a name="l00960"></a>00960 
<a name="l00961"></a>00961   on = <a class="code" href="ospf6__neighbor_8c.html#a4b081b7bf89453a1d197bd4ccd21fb14">ospf6_neighbor_lookup</a> (oh-&gt;<a class="code" href="structospf6__header.html#a53d5dbfa8cc8c72d2e4681d78258b6a7">router_id</a>, oi);
<a name="l00962"></a>00962   <span class="keywordflow">if</span> (on == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00963"></a>00963     {
<a name="l00964"></a>00964       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00965"></a>00965         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor not found, ignore&quot;</span>);
<a name="l00966"></a>00966       <span class="keywordflow">return</span>;
<a name="l00967"></a>00967     }
<a name="l00968"></a>00968 
<a name="l00969"></a>00969   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#afa0419c15460d1d703d2b3cfa7859984">OSPF6_NEIGHBOR_EXCHANGE</a> &amp;&amp;
<a name="l00970"></a>00970       on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#aa50b6edd6d1268220ae4e13b2fef14e8">OSPF6_NEIGHBOR_LOADING</a> &amp;&amp;
<a name="l00971"></a>00971       on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#aae1490b2e9d8ca36df8b2127dcc289c1">OSPF6_NEIGHBOR_FULL</a>)
<a name="l00972"></a>00972     {
<a name="l00973"></a>00973       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00974"></a>00974         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor state less than Exchange, ignore&quot;</span>);
<a name="l00975"></a>00975       <span class="keywordflow">return</span>;
<a name="l00976"></a>00976     }
<a name="l00977"></a>00977 
<a name="l00978"></a>00978   lsupdate = (<span class="keyword">struct </span><a class="code" href="structospf6__lsupdate.html">ospf6_lsupdate</a> *)
<a name="l00979"></a>00979     ((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l00980"></a>00980 
<a name="l00981"></a>00981   num = ntohl (lsupdate-&gt;<a class="code" href="structospf6__lsupdate.html#ad78c6309d7425390af712e6bba8ce78f">lsa_number</a>);
<a name="l00982"></a>00982 
<a name="l00983"></a>00983   <span class="comment">/* Process LSAs */</span>
<a name="l00984"></a>00984   <span class="keywordflow">for</span> (p = (<span class="keywordtype">char</span> *) ((caddr_t) lsupdate + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsupdate.html">ospf6_lsupdate</a>));
<a name="l00985"></a>00985        p &lt; <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh) &amp;&amp;
<a name="l00986"></a>00986        p + <a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (p) &lt;= <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh);
<a name="l00987"></a>00987        p += <a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (p))
<a name="l00988"></a>00988     {
<a name="l00989"></a>00989       <span class="keywordflow">if</span> (num == 0)
<a name="l00990"></a>00990         <span class="keywordflow">break</span>;
<a name="l00991"></a>00991       <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (p) &lt; <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>))
<a name="l00992"></a>00992         {
<a name="l00993"></a>00993           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l00994"></a>00994             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Malformed LSA length, quit processing&quot;</span>);
<a name="l00995"></a>00995           <span class="keywordflow">break</span>;
<a name="l00996"></a>00996         }
<a name="l00997"></a>00997 
<a name="l00998"></a>00998       <a class="code" href="ospf6__flood_8c.html#a79be22d7f281fba1e60f53c49752bcb9">ospf6_receive_lsa</a> (on, (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a> *) p);
<a name="l00999"></a>00999       num--;
<a name="l01000"></a>01000     }
<a name="l01001"></a>01001 
<a name="l01002"></a>01002   <span class="keywordflow">if</span> (num != 0)
<a name="l01003"></a>01003     {
<a name="l01004"></a>01004       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01005"></a>01005         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Malformed LSA number or LSA length&quot;</span>);
<a name="l01006"></a>01006     }
<a name="l01007"></a>01007   <span class="keywordflow">if</span> (p != <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh))
<a name="l01008"></a>01008     {
<a name="l01009"></a>01009       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01010"></a>01010         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Trailing garbage ignored&quot;</span>);
<a name="l01011"></a>01011     }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013   <span class="comment">/* RFC2328 Section 10.9: When the neighbor responds to these requests</span>
<a name="l01014"></a>01014 <span class="comment">     with the proper Link State Update packet(s), the Link state request</span>
<a name="l01015"></a>01015 <span class="comment">     list is truncated and a new Link State Request packet is sent. */</span>
<a name="l01016"></a>01016   <span class="comment">/* send new Link State Request packet if this LS Update packet</span>
<a name="l01017"></a>01017 <span class="comment">     can be recognized as a response to our previous LS Request */</span>
<a name="l01018"></a>01018   <span class="keywordflow">if</span> (! IN6_IS_ADDR_MULTICAST (dst) &amp;&amp;
<a name="l01019"></a>01019       (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> == <a class="code" href="ospf6__neighbor_8h.html#afa0419c15460d1d703d2b3cfa7859984">OSPF6_NEIGHBOR_EXCHANGE</a> ||
<a name="l01020"></a>01020        on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> == <a class="code" href="ospf6__neighbor_8h.html#aa50b6edd6d1268220ae4e13b2fef14e8">OSPF6_NEIGHBOR_LOADING</a>))
<a name="l01021"></a>01021     {
<a name="l01022"></a>01022       <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a645f58ca5b6b428ae7ae616bc4781f51">thread_send_lsreq</a>);
<a name="l01023"></a>01023       on-&gt;<a class="code" href="structospf6__neighbor.html#a645f58ca5b6b428ae7ae616bc4781f51">thread_send_lsreq</a> =
<a name="l01024"></a>01024         <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#af83f5687852b02777d049247cc518e8e">ospf6_lsreq_send</a>, on, 0);
<a name="l01025"></a>01025     }
<a name="l01026"></a>01026 }
<a name="l01027"></a>01027 
<a name="l01028"></a>01028 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01029"></a><a class="code" href="ospf6__message_8c.html#a02c40333d763f545c0e65f76592b3868">01029</a> <a class="code" href="ospf6__message_8c.html#a02c40333d763f545c0e65f76592b3868">ospf6_lsack_recv</a> (<span class="keyword">struct</span> in6_addr *src, <span class="keyword">struct</span> in6_addr *dst,
<a name="l01030"></a>01030                   <span class="keyword">struct</span> <a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi, <span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh)
<a name="l01031"></a>01031 {
<a name="l01032"></a>01032   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l01033"></a>01033   <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l01034"></a>01034   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *his, *mine;
<a name="l01035"></a>01035   <span class="keyword">struct </span><a class="code" href="structospf6__lsdb.html">ospf6_lsdb</a> *lsdb = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01036"></a>01036 
<a name="l01037"></a>01037   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a> == <a class="code" href="ospf6__message_8h.html#a19fd0641f70b0878b9ce5e7966c7ae73">OSPF6_MESSAGE_TYPE_LSACK</a>);
<a name="l01038"></a>01038   <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8c.html#a6993c2708cb37ca3e9d2da08393a68a3">ospf6_header_examin</a> (src, dst, oi, oh) != <a class="code" href="ospf6__message_8c.html#a4ff2533d4f42b5b10b6caf648a4619b4">MSG_OK</a>)
<a name="l01039"></a>01039     <span class="keywordflow">return</span>;
<a name="l01040"></a>01040 
<a name="l01041"></a>01041   on = <a class="code" href="ospf6__neighbor_8c.html#a4b081b7bf89453a1d197bd4ccd21fb14">ospf6_neighbor_lookup</a> (oh-&gt;<a class="code" href="structospf6__header.html#a53d5dbfa8cc8c72d2e4681d78258b6a7">router_id</a>, oi);
<a name="l01042"></a>01042   <span class="keywordflow">if</span> (on == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01043"></a>01043     {
<a name="l01044"></a>01044       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01045"></a>01045         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor not found, ignore&quot;</span>);
<a name="l01046"></a>01046       <span class="keywordflow">return</span>;
<a name="l01047"></a>01047     }
<a name="l01048"></a>01048 
<a name="l01049"></a>01049   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#afa0419c15460d1d703d2b3cfa7859984">OSPF6_NEIGHBOR_EXCHANGE</a> &amp;&amp;
<a name="l01050"></a>01050       on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#aa50b6edd6d1268220ae4e13b2fef14e8">OSPF6_NEIGHBOR_LOADING</a> &amp;&amp;
<a name="l01051"></a>01051       on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#aae1490b2e9d8ca36df8b2127dcc289c1">OSPF6_NEIGHBOR_FULL</a>)
<a name="l01052"></a>01052     {
<a name="l01053"></a>01053       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01054"></a>01054         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor state less than Exchange, ignore&quot;</span>);
<a name="l01055"></a>01055       <span class="keywordflow">return</span>;
<a name="l01056"></a>01056     }
<a name="l01057"></a>01057 
<a name="l01058"></a>01058   <span class="keywordflow">for</span> (p = (<span class="keywordtype">char</span> *) ((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l01059"></a>01059        p + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>) &lt;= <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh);
<a name="l01060"></a>01060        p += <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>))
<a name="l01061"></a>01061     {
<a name="l01062"></a>01062       his = <a class="code" href="ospf6__lsa_8c.html#a8bf58d5701076e46ec5317268c83eea2">ospf6_lsa_create_headeronly</a> ((<span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a> *) p);
<a name="l01063"></a>01063 
<a name="l01064"></a>01064       <span class="keywordflow">switch</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (his-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>))
<a name="l01065"></a>01065         {
<a name="l01066"></a>01066         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#ab41aaca88cc27f951f7dbf46b5a6fb5c">OSPF6_SCOPE_LINKLOCAL</a>:
<a name="l01067"></a>01067           lsdb = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#ab033cb877fe417705f424d1bd2f411de">lsdb</a>;
<a name="l01068"></a>01068           <span class="keywordflow">break</span>;
<a name="l01069"></a>01069         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0634f2bb73a043f5782d28e4e3a1ad95">OSPF6_SCOPE_AREA</a>:
<a name="l01070"></a>01070           lsdb = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a9e658e62c2d59151531bc03b95b600bb">lsdb</a>;
<a name="l01071"></a>01071           <span class="keywordflow">break</span>;
<a name="l01072"></a>01072         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0701d1d9c961cfb8d6da273382ea508a">OSPF6_SCOPE_AS</a>:
<a name="l01073"></a>01073           lsdb = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a86562db489ba46500cda50f4fa646c69">ospf6</a>-&gt;<a class="code" href="structospf6.html#ac8cf84e34e8461f5aea2737fc2bf8fcb">lsdb</a>;
<a name="l01074"></a>01074           <span class="keywordflow">break</span>;
<a name="l01075"></a>01075         <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0fde4f629d4c21c3cfb402a91e1205a9">OSPF6_SCOPE_RESERVED</a>:
<a name="l01076"></a>01076           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01077"></a>01077             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Ignoring LSA of reserved scope&quot;</span>);
<a name="l01078"></a>01078           <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (his);
<a name="l01079"></a>01079           <span class="keywordflow">continue</span>;
<a name="l01080"></a>01080           <span class="keywordflow">break</span>;
<a name="l01081"></a>01081         }
<a name="l01082"></a>01082 
<a name="l01083"></a>01083       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01084"></a>01084         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s acknowledged by %s&quot;</span>, his-&gt;<a class="code" href="structospf6__lsa.html#a979d21e1c4d2e1753e7d45641b0819ce">name</a>, on-&gt;<a class="code" href="structospf6__neighbor.html#aa0ccec2f7b9c56628ce2e4a0bc37d463">name</a>);
<a name="l01085"></a>01085 
<a name="l01086"></a>01086       <span class="comment">/* Find database copy */</span>
<a name="l01087"></a>01087       mine = <a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (his-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>, his-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a663d9c2afc1cdc7a124a2c9d1199e394">id</a>,
<a name="l01088"></a>01088                                 his-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a756706ceafd6ffab88f8ee481fcc3619">adv_router</a>, lsdb);
<a name="l01089"></a>01089       <span class="keywordflow">if</span> (mine == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01090"></a>01090         {
<a name="l01091"></a>01091           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01092"></a>01092             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;No database copy&quot;</span>);
<a name="l01093"></a>01093           <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (his);
<a name="l01094"></a>01094           <span class="keywordflow">continue</span>;
<a name="l01095"></a>01095         }
<a name="l01096"></a>01096 
<a name="l01097"></a>01097       <span class="comment">/* Check if the LSA is on his retrans-list */</span>
<a name="l01098"></a>01098       mine = <a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (his-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>, his-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a663d9c2afc1cdc7a124a2c9d1199e394">id</a>,
<a name="l01099"></a>01099                                 his-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a756706ceafd6ffab88f8ee481fcc3619">adv_router</a>, on-&gt;<a class="code" href="structospf6__neighbor.html#a6e96ad2f82d2741e769bc179d35e583f">retrans_list</a>);
<a name="l01100"></a>01100       <span class="keywordflow">if</span> (mine == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01101"></a>01101         {
<a name="l01102"></a>01102           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01103"></a>01103             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Not on %s&#39;s retrans-list&quot;</span>, on-&gt;<a class="code" href="structospf6__neighbor.html#aa0ccec2f7b9c56628ce2e4a0bc37d463">name</a>);
<a name="l01104"></a>01104           <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (his);
<a name="l01105"></a>01105           <span class="keywordflow">continue</span>;
<a name="l01106"></a>01106         }
<a name="l01107"></a>01107 
<a name="l01108"></a>01108       <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8c.html#af1665de6eac6dab108363c1bf6320c69">ospf6_lsa_compare</a> (his, mine) != 0)
<a name="l01109"></a>01109         {
<a name="l01110"></a>01110           <span class="comment">/* Log this questionable acknowledgement,</span>
<a name="l01111"></a>01111 <span class="comment">             and examine the next one. */</span>
<a name="l01112"></a>01112           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01113"></a>01113             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Questionable acknowledgement&quot;</span>);
<a name="l01114"></a>01114           <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (his);
<a name="l01115"></a>01115           <span class="keywordflow">continue</span>;
<a name="l01116"></a>01116         }
<a name="l01117"></a>01117 
<a name="l01118"></a>01118       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01119"></a>01119         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Acknowledged, remove from %s&#39;s retrans-list&quot;</span>,
<a name="l01120"></a>01120             on-&gt;<a class="code" href="structospf6__neighbor.html#aa0ccec2f7b9c56628ce2e4a0bc37d463">name</a>);
<a name="l01121"></a>01121 
<a name="l01122"></a>01122       <a class="code" href="ospf6__flood_8c.html#a6bee3a2ba460b276a55915e4f96dae62">ospf6_decrement_retrans_count</a> (mine);
<a name="l01123"></a>01123       <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#acde3ad184b10ca14f3eef7b2ab655ce6">OSPF6_LSA_IS_MAXAGE</a> (mine))
<a name="l01124"></a>01124         <a class="code" href="ospf6__top_8c.html#a0f863937b01896d48b1756f169fb0e19">ospf6_maxage_remove</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a86562db489ba46500cda50f4fa646c69">ospf6</a>);
<a name="l01125"></a>01125       <a class="code" href="ospf6__lsdb_8c.html#a57848d384aafd619bd84c654fb9ed146">ospf6_lsdb_remove</a> (mine, on-&gt;<a class="code" href="structospf6__neighbor.html#a6e96ad2f82d2741e769bc179d35e583f">retrans_list</a>);
<a name="l01126"></a>01126       <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (his);
<a name="l01127"></a>01127     }
<a name="l01128"></a>01128 
<a name="l01129"></a>01129   <span class="keywordflow">if</span> (p != <a class="code" href="ospf6__message_8h.html#a9c7f1cee44fb445c00c5549e03b462e4">OSPF6_MESSAGE_END</a> (oh))
<a name="l01130"></a>01130     {
<a name="l01131"></a>01131       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01132"></a>01132         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Trailing garbage ignored&quot;</span>);
<a name="l01133"></a>01133     }
<a name="l01134"></a>01134 }
<a name="l01135"></a>01135 
<a name="l01136"></a><a class="code" href="ospf6__message_8c.html#ab56560205eb1af494b28ca1bfd6af093">01136</a> <span class="keyword">static</span> u_char *<a class="code" href="ospf6__message_8c.html#ab56560205eb1af494b28ca1bfd6af093">recvbuf</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01137"></a><a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">01137</a> <span class="keyword">static</span> u_char *<a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01138"></a><a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">01138</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a> = 0;
<a name="l01139"></a>01139 
<a name="l01140"></a>01140 <span class="keywordtype">int</span>
<a name="l01141"></a><a class="code" href="ospf6__message_8h.html#aaa8179b6bdd70e5cf3addee60df7aa80">01141</a> <a class="code" href="ospf6__message_8c.html#aaa8179b6bdd70e5cf3addee60df7aa80">ospf6_iobuf_size</a> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size)
<a name="l01142"></a>01142 {
<a name="l01143"></a>01143   u_char *recvnew, *sendnew;
<a name="l01144"></a>01144 
<a name="l01145"></a>01145   <span class="keywordflow">if</span> (size &lt;= <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>)
<a name="l01146"></a>01146     <span class="keywordflow">return</span> <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>;
<a name="l01147"></a>01147 
<a name="l01148"></a>01148   recvnew = <a class="code" href="memory_8h.html#a6491adf46c1d769b529a8f2f7d75f2fe">XMALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167babff91bcdac097452fdd222cc509ce39c">MTYPE_OSPF6_MESSAGE</a>, size);
<a name="l01149"></a>01149   sendnew = <a class="code" href="memory_8h.html#a6491adf46c1d769b529a8f2f7d75f2fe">XMALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167babff91bcdac097452fdd222cc509ce39c">MTYPE_OSPF6_MESSAGE</a>, size);
<a name="l01150"></a>01150   <span class="keywordflow">if</span> (recvnew == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || sendnew == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01151"></a>01151     {
<a name="l01152"></a>01152       <span class="keywordflow">if</span> (recvnew)
<a name="l01153"></a>01153         <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167babff91bcdac097452fdd222cc509ce39c">MTYPE_OSPF6_MESSAGE</a>, recvnew);
<a name="l01154"></a>01154       <span class="keywordflow">if</span> (sendnew)
<a name="l01155"></a>01155         <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167babff91bcdac097452fdd222cc509ce39c">MTYPE_OSPF6_MESSAGE</a>, sendnew);
<a name="l01156"></a>01156       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Could not allocate I/O buffer of size %d.&quot;</span>, size);
<a name="l01157"></a>01157       <span class="keywordflow">return</span> <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>;
<a name="l01158"></a>01158     }
<a name="l01159"></a>01159 
<a name="l01160"></a>01160   <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8c.html#ab56560205eb1af494b28ca1bfd6af093">recvbuf</a>)
<a name="l01161"></a>01161     <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167babff91bcdac097452fdd222cc509ce39c">MTYPE_OSPF6_MESSAGE</a>, <a class="code" href="ospf6__message_8c.html#ab56560205eb1af494b28ca1bfd6af093">recvbuf</a>);
<a name="l01162"></a>01162   <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>)
<a name="l01163"></a>01163     <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167babff91bcdac097452fdd222cc509ce39c">MTYPE_OSPF6_MESSAGE</a>, <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>);
<a name="l01164"></a>01164   <a class="code" href="ospf6__message_8c.html#ab56560205eb1af494b28ca1bfd6af093">recvbuf</a> = recvnew;
<a name="l01165"></a>01165   <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a> = sendnew;
<a name="l01166"></a>01166   <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a> = size;
<a name="l01167"></a>01167 
<a name="l01168"></a>01168   <span class="keywordflow">return</span> <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>;
<a name="l01169"></a>01169 }
<a name="l01170"></a>01170 
<a name="l01171"></a>01171 <span class="keywordtype">int</span>
<a name="l01172"></a><a class="code" href="ospf6__message_8h.html#a0e2dffe886aebfa4df64eb5ed857cca2">01172</a> <a class="code" href="ospf6__message_8c.html#a0e2dffe886aebfa4df64eb5ed857cca2">ospf6_receive</a> (<span class="keyword">struct</span> <a class="code" href="structthread.html">thread</a> *<a class="code" href="structthread.html">thread</a>)
<a name="l01173"></a>01173 {
<a name="l01174"></a>01174   <span class="keywordtype">int</span> sockfd;
<a name="l01175"></a>01175   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len;
<a name="l01176"></a>01176   <span class="keywordtype">char</span> srcname[64], dstname[64];
<a name="l01177"></a>01177   <span class="keyword">struct </span>in6_addr src, dst;
<a name="l01178"></a>01178   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ifindex;
<a name="l01179"></a>01179   <span class="keyword">struct </span>iovec iovector[2];
<a name="l01180"></a>01180   <span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi;
<a name="l01181"></a>01181   <span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *oh;
<a name="l01182"></a>01182 
<a name="l01183"></a>01183   <span class="comment">/* add next read thread */</span>
<a name="l01184"></a>01184   sockfd = <a class="code" href="thread_8h.html#a89bd56f991717646441f9dffc010d4f5">THREAD_FD</a> (thread);
<a name="l01185"></a>01185   <a class="code" href="thread_8h.html#abd1714f11834a150c84b040c0c69b620">thread_add_read</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a0e2dffe886aebfa4df64eb5ed857cca2">ospf6_receive</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, sockfd);
<a name="l01186"></a>01186 
<a name="l01187"></a>01187   <span class="comment">/* initialize */</span>
<a name="l01188"></a>01188   memset (&amp;src, 0, <span class="keyword">sizeof</span> (src));
<a name="l01189"></a>01189   memset (&amp;dst, 0, <span class="keyword">sizeof</span> (dst));
<a name="l01190"></a>01190   ifindex = 0;
<a name="l01191"></a>01191   memset (<a class="code" href="ospf6__message_8c.html#ab56560205eb1af494b28ca1bfd6af093">recvbuf</a>, 0, <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>);
<a name="l01192"></a>01192   iovector[0].iov_base = <a class="code" href="ospf6__message_8c.html#ab56560205eb1af494b28ca1bfd6af093">recvbuf</a>;
<a name="l01193"></a>01193   iovector[0].iov_len = <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>;
<a name="l01194"></a>01194   iovector[1].iov_base = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01195"></a>01195   iovector[1].iov_len = 0;
<a name="l01196"></a>01196 
<a name="l01197"></a>01197   <span class="comment">/* receive message */</span>
<a name="l01198"></a>01198   len = <a class="code" href="ospf6__network_8c.html#a357f81a31d3a457d3b841de3d778d089">ospf6_recvmsg</a> (&amp;src, &amp;dst, &amp;ifindex, iovector);
<a name="l01199"></a>01199   <span class="keywordflow">if</span> (len &gt; <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>)
<a name="l01200"></a>01200     {
<a name="l01201"></a>01201       <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;Excess message read&quot;</span>);
<a name="l01202"></a>01202       <span class="keywordflow">return</span> 0;
<a name="l01203"></a>01203     }
<a name="l01204"></a>01204   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt; <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a>))
<a name="l01205"></a>01205     {
<a name="l01206"></a>01206       <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;Deficient message read&quot;</span>);
<a name="l01207"></a>01207       <span class="keywordflow">return</span> 0;
<a name="l01208"></a>01208     }
<a name="l01209"></a>01209 
<a name="l01210"></a>01210   oi = <a class="code" href="ospf6__interface_8c.html#a10eb67c1323348e19f16ea82827d284f">ospf6_interface_lookup_by_ifindex</a> (ifindex);
<a name="l01211"></a>01211   <span class="keywordflow">if</span> (oi == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || oi-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01212"></a>01212     {
<a name="l01213"></a>01213       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Message received on disabled interface&quot;</span>);
<a name="l01214"></a>01214       <span class="keywordflow">return</span> 0;
<a name="l01215"></a>01215     }
<a name="l01216"></a>01216 
<a name="l01217"></a>01217   oh = (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *) <a class="code" href="ospf6__message_8c.html#ab56560205eb1af494b28ca1bfd6af093">recvbuf</a>;
<a name="l01218"></a>01218 
<a name="l01219"></a>01219   <span class="comment">/* Log */</span>
<a name="l01220"></a>01220   <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01221"></a>01221     {
<a name="l01222"></a>01222       <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, &amp;src, srcname, <span class="keyword">sizeof</span> (srcname));
<a name="l01223"></a>01223       <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, &amp;dst, dstname, <span class="keyword">sizeof</span> (dstname));
<a name="l01224"></a>01224       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s received on %s&quot;</span>,
<a name="l01225"></a>01225                  <a class="code" href="ospf6__message_8h.html#a44665a9343d836ac8be80df1b0bcca14">OSPF6_MESSAGE_TYPE_NAME</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>), oi-&gt;<a class="code" href="structospf6__interface.html#ab77617d3c7c82e25b6c035d9e1856c22">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);
<a name="l01226"></a>01226       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    src: %s&quot;</span>, srcname);
<a name="l01227"></a>01227       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    dst: %s&quot;</span>, dstname);
<a name="l01228"></a>01228       <span class="keywordflow">if</span> (len != ntohs (oh-&gt;<a class="code" href="structospf6__header.html#aef7496dd76d0c2eca889f7a9d01936ff">length</a>))
<a name="l01229"></a>01229         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Message length does not match actually received: %d&quot;</span>, len);
<a name="l01230"></a>01230 
<a name="l01231"></a>01231       <span class="keywordflow">switch</span> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>)
<a name="l01232"></a>01232         {
<a name="l01233"></a>01233           <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#a2bf7c8dd972224d5a8255986e52ea771">OSPF6_MESSAGE_TYPE_HELLO</a>:
<a name="l01234"></a>01234             <a class="code" href="ospf6__message_8c.html#adfbd2808619eaf4b4a9f264083b1ae2e">ospf6_hello_print</a> (oh);
<a name="l01235"></a>01235             <span class="keywordflow">break</span>;
<a name="l01236"></a>01236           <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#a2bd43bbd6161d38b8361ae6d377b736a">OSPF6_MESSAGE_TYPE_DBDESC</a>:
<a name="l01237"></a>01237             <a class="code" href="ospf6__message_8c.html#a4c3079cef10f2def25c83cc3cdf0c00f">ospf6_dbdesc_print</a> (oh);
<a name="l01238"></a>01238             <span class="keywordflow">break</span>;
<a name="l01239"></a>01239           <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#a685011318dd28abf2279e718803d4daa">OSPF6_MESSAGE_TYPE_LSREQ</a>:
<a name="l01240"></a>01240             <a class="code" href="ospf6__message_8c.html#ac0a6a0ccb7a4c9ab4e1c5ddef8f64882">ospf6_lsreq_print</a> (oh);
<a name="l01241"></a>01241             <span class="keywordflow">break</span>;
<a name="l01242"></a>01242           <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#ac6f61e0ff8bcf71f99c6edc50ab9ca97">OSPF6_MESSAGE_TYPE_LSUPDATE</a>:
<a name="l01243"></a>01243             <a class="code" href="ospf6__message_8c.html#a2e75752b675b33464d036ca1c53e598e">ospf6_lsupdate_print</a> (oh);
<a name="l01244"></a>01244             <span class="keywordflow">break</span>;
<a name="l01245"></a>01245           <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#a19fd0641f70b0878b9ce5e7966c7ae73">OSPF6_MESSAGE_TYPE_LSACK</a>:
<a name="l01246"></a>01246             <a class="code" href="ospf6__message_8c.html#a1868994aede5b9077bf9c7231f4f458d">ospf6_lsack_print</a> (oh);
<a name="l01247"></a>01247             <span class="keywordflow">break</span>;
<a name="l01248"></a>01248           <span class="keywordflow">default</span>:
<a name="l01249"></a>01249             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Unknown message&quot;</span>);
<a name="l01250"></a>01250             <span class="keywordflow">break</span>;
<a name="l01251"></a>01251         }
<a name="l01252"></a>01252     }
<a name="l01253"></a>01253 
<a name="l01254"></a>01254   <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (oi-&gt;<a class="code" href="structospf6__interface.html#aa5dbc797ed38482907f57c66458a3e87">flag</a>, <a class="code" href="ospf6__interface_8h.html#aeb4543177500f2d71c28f91a47154e25">OSPF6_INTERFACE_PASSIVE</a>))
<a name="l01255"></a>01255     {
<a name="l01256"></a>01256       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01257"></a>01257         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Ignore message on passive interface %s&quot;</span>,
<a name="l01258"></a>01258                    oi-&gt;<a class="code" href="structospf6__interface.html#ab77617d3c7c82e25b6c035d9e1856c22">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);
<a name="l01259"></a>01259       <span class="keywordflow">return</span> 0;
<a name="l01260"></a>01260     }
<a name="l01261"></a>01261 
<a name="l01262"></a>01262   <span class="keywordflow">switch</span> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>)
<a name="l01263"></a>01263     {
<a name="l01264"></a>01264       <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#a2bf7c8dd972224d5a8255986e52ea771">OSPF6_MESSAGE_TYPE_HELLO</a>:
<a name="l01265"></a>01265         <a class="code" href="ospf6__message_8c.html#a5c0be22f247d1d1d8b030955e4261636">ospf6_hello_recv</a> (&amp;src, &amp;dst, oi, oh);
<a name="l01266"></a>01266         <span class="keywordflow">break</span>;
<a name="l01267"></a>01267 
<a name="l01268"></a>01268       <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#a2bd43bbd6161d38b8361ae6d377b736a">OSPF6_MESSAGE_TYPE_DBDESC</a>:
<a name="l01269"></a>01269         <a class="code" href="ospf6__message_8c.html#aa40c2de125d4e0b32180d9f9e383f83e">ospf6_dbdesc_recv</a> (&amp;src, &amp;dst, oi, oh);
<a name="l01270"></a>01270         <span class="keywordflow">break</span>;
<a name="l01271"></a>01271 
<a name="l01272"></a>01272       <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#a685011318dd28abf2279e718803d4daa">OSPF6_MESSAGE_TYPE_LSREQ</a>:
<a name="l01273"></a>01273         <a class="code" href="ospf6__message_8c.html#a1b8b158280907094de85c2192c17f6a3">ospf6_lsreq_recv</a> (&amp;src, &amp;dst, oi, oh);
<a name="l01274"></a>01274         <span class="keywordflow">break</span>;
<a name="l01275"></a>01275 
<a name="l01276"></a>01276       <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#ac6f61e0ff8bcf71f99c6edc50ab9ca97">OSPF6_MESSAGE_TYPE_LSUPDATE</a>:
<a name="l01277"></a>01277         <a class="code" href="ospf6__message_8c.html#a07373ca9b500e004a857c4d3e20551cd">ospf6_lsupdate_recv</a> (&amp;src, &amp;dst, oi, oh);
<a name="l01278"></a>01278         <span class="keywordflow">break</span>;
<a name="l01279"></a>01279 
<a name="l01280"></a>01280       <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#a19fd0641f70b0878b9ce5e7966c7ae73">OSPF6_MESSAGE_TYPE_LSACK</a>:
<a name="l01281"></a>01281         <a class="code" href="ospf6__message_8c.html#a02c40333d763f545c0e65f76592b3868">ospf6_lsack_recv</a> (&amp;src, &amp;dst, oi, oh);
<a name="l01282"></a>01282         <span class="keywordflow">break</span>;
<a name="l01283"></a>01283 
<a name="l01284"></a>01284       <span class="keywordflow">default</span>:
<a name="l01285"></a>01285         <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#aaec3a97f28d8b7cfcb2e0b6cb7ba06e3">OSPF6_MESSAGE_TYPE_UNKNOWN</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l01286"></a>01286           <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Unknown message&quot;</span>);
<a name="l01287"></a>01287         <span class="keywordflow">break</span>;
<a name="l01288"></a>01288     }
<a name="l01289"></a>01289 
<a name="l01290"></a>01290   <span class="keywordflow">return</span> 0;
<a name="l01291"></a>01291 }
<a name="l01292"></a>01292 
<a name="l01293"></a>01293 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01294"></a><a class="code" href="ospf6__message_8c.html#a872c5c0ebbeea4de643a1dec4b5c7d54">01294</a> <a class="code" href="ospf6__message_8c.html#a872c5c0ebbeea4de643a1dec4b5c7d54">ospf6_send</a> (<span class="keyword">struct</span> in6_addr *src, <span class="keyword">struct</span> in6_addr *dst,
<a name="l01295"></a>01295             <span class="keyword">struct</span> <a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi, <span class="keyword">struct</span> <a class="code" href="structospf6__header.html">ospf6_header</a> *oh)
<a name="l01296"></a>01296 {
<a name="l01297"></a>01297   <span class="keywordtype">int</span> len;
<a name="l01298"></a>01298   <span class="keywordtype">char</span> srcname[64], dstname[64];
<a name="l01299"></a>01299   <span class="keyword">struct </span>iovec iovector[2];
<a name="l01300"></a>01300 
<a name="l01301"></a>01301   <span class="comment">/* initialize */</span>
<a name="l01302"></a>01302   iovector[0].iov_base = (caddr_t) oh;
<a name="l01303"></a>01303   iovector[0].iov_len = ntohs (oh-&gt;<a class="code" href="structospf6__header.html#aef7496dd76d0c2eca889f7a9d01936ff">length</a>);
<a name="l01304"></a>01304   iovector[1].iov_base = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01305"></a>01305   iovector[1].iov_len = 0;
<a name="l01306"></a>01306 
<a name="l01307"></a>01307   <span class="comment">/* fill OSPF header */</span>
<a name="l01308"></a>01308   oh-&gt;<a class="code" href="structospf6__header.html#a71abe555831003b4e41b0a623690ac93">version</a> = <a class="code" href="ospf6__proto_8h.html#ac71efe16d061e39ea5c0d9d74def4fa4">OSPFV3_VERSION</a>;
<a name="l01309"></a>01309   <span class="comment">/* message type must be set before */</span>
<a name="l01310"></a>01310   <span class="comment">/* message length must be set before */</span>
<a name="l01311"></a>01311   oh-&gt;<a class="code" href="structospf6__header.html#a53d5dbfa8cc8c72d2e4681d78258b6a7">router_id</a> = oi-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a86562db489ba46500cda50f4fa646c69">ospf6</a>-&gt;<a class="code" href="structospf6.html#a4dc92a648ae2190f7cf5b383c475d2aa">router_id</a>;
<a name="l01312"></a>01312   oh-&gt;<a class="code" href="structospf6__header.html#abc55595860947bb51724aae44da001cc">area_id</a> = oi-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#aec3bacc0c813ff937b5675595a3aefa6">area_id</a>;
<a name="l01313"></a>01313   <span class="comment">/* checksum is calculated by kernel */</span>
<a name="l01314"></a>01314   oh-&gt;<a class="code" href="structospf6__header.html#a098c822a8032afb65b8e7d41339c9dc1">instance_id</a> = oi-&gt;<a class="code" href="structospf6__interface.html#aa29c61e3e5509e7c844bdf19efce0268">instance_id</a>;
<a name="l01315"></a>01315   oh-&gt;<a class="code" href="structospf6__header.html#a864b2ddabe0a87b85337c7902c984843">reserved</a> = 0;
<a name="l01316"></a>01316 
<a name="l01317"></a>01317   <span class="comment">/* Log */</span>
<a name="l01318"></a>01318   <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l01319"></a>01319     {
<a name="l01320"></a>01320       <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, dst, dstname, <span class="keyword">sizeof</span> (dstname));
<a name="l01321"></a>01321       <span class="keywordflow">if</span> (src)
<a name="l01322"></a>01322         <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, src, srcname, <span class="keyword">sizeof</span> (srcname));
<a name="l01323"></a>01323       <span class="keywordflow">else</span>
<a name="l01324"></a>01324         memset (srcname, 0, <span class="keyword">sizeof</span> (srcname));
<a name="l01325"></a>01325       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s send on %s&quot;</span>,
<a name="l01326"></a>01326                  <a class="code" href="ospf6__message_8h.html#a44665a9343d836ac8be80df1b0bcca14">OSPF6_MESSAGE_TYPE_NAME</a> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>), oi-&gt;<a class="code" href="structospf6__interface.html#ab77617d3c7c82e25b6c035d9e1856c22">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);
<a name="l01327"></a>01327       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    src: %s&quot;</span>, srcname);
<a name="l01328"></a>01328       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;    dst: %s&quot;</span>, dstname);
<a name="l01329"></a>01329 
<a name="l01330"></a>01330       <span class="keywordflow">switch</span> (oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a>)
<a name="l01331"></a>01331         {
<a name="l01332"></a>01332           <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#a2bf7c8dd972224d5a8255986e52ea771">OSPF6_MESSAGE_TYPE_HELLO</a>:
<a name="l01333"></a>01333             <a class="code" href="ospf6__message_8c.html#adfbd2808619eaf4b4a9f264083b1ae2e">ospf6_hello_print</a> (oh);
<a name="l01334"></a>01334             <span class="keywordflow">break</span>;
<a name="l01335"></a>01335           <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#a2bd43bbd6161d38b8361ae6d377b736a">OSPF6_MESSAGE_TYPE_DBDESC</a>:
<a name="l01336"></a>01336             <a class="code" href="ospf6__message_8c.html#a4c3079cef10f2def25c83cc3cdf0c00f">ospf6_dbdesc_print</a> (oh);
<a name="l01337"></a>01337             <span class="keywordflow">break</span>;
<a name="l01338"></a>01338           <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#a685011318dd28abf2279e718803d4daa">OSPF6_MESSAGE_TYPE_LSREQ</a>:
<a name="l01339"></a>01339             <a class="code" href="ospf6__message_8c.html#ac0a6a0ccb7a4c9ab4e1c5ddef8f64882">ospf6_lsreq_print</a> (oh);
<a name="l01340"></a>01340             <span class="keywordflow">break</span>;
<a name="l01341"></a>01341           <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#ac6f61e0ff8bcf71f99c6edc50ab9ca97">OSPF6_MESSAGE_TYPE_LSUPDATE</a>:
<a name="l01342"></a>01342             <a class="code" href="ospf6__message_8c.html#a2e75752b675b33464d036ca1c53e598e">ospf6_lsupdate_print</a> (oh);
<a name="l01343"></a>01343             <span class="keywordflow">break</span>;
<a name="l01344"></a>01344           <span class="keywordflow">case</span> <a class="code" href="ospf6__message_8h.html#a19fd0641f70b0878b9ce5e7966c7ae73">OSPF6_MESSAGE_TYPE_LSACK</a>:
<a name="l01345"></a>01345             <a class="code" href="ospf6__message_8c.html#a1868994aede5b9077bf9c7231f4f458d">ospf6_lsack_print</a> (oh);
<a name="l01346"></a>01346             <span class="keywordflow">break</span>;
<a name="l01347"></a>01347           <span class="keywordflow">default</span>:
<a name="l01348"></a>01348             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Unknown message&quot;</span>);
<a name="l01349"></a>01349             <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (0);
<a name="l01350"></a>01350             <span class="keywordflow">break</span>;
<a name="l01351"></a>01351         }
<a name="l01352"></a>01352     }
<a name="l01353"></a>01353 
<a name="l01354"></a>01354   <span class="comment">/* send message */</span>
<a name="l01355"></a>01355   len = <a class="code" href="ospf6__network_8c.html#a72829dd8925ab435fbc2698f8eb63637">ospf6_sendmsg</a> (src, dst, &amp;oi-&gt;<a class="code" href="structospf6__interface.html#ab77617d3c7c82e25b6c035d9e1856c22">interface</a>-&gt;<a class="code" href="structinterface.html#ae4c4a0eca6642e37e29e1177a39872ea">ifindex</a>, iovector);
<a name="l01356"></a>01356   <span class="keywordflow">if</span> (len != ntohs (oh-&gt;<a class="code" href="structospf6__header.html#aef7496dd76d0c2eca889f7a9d01936ff">length</a>))
<a name="l01357"></a>01357     <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;Could not send entire message&quot;</span>);
<a name="l01358"></a>01358 }
<a name="l01359"></a>01359 
<a name="l01360"></a>01360 <span class="keywordtype">int</span>
<a name="l01361"></a><a class="code" href="ospf6__message_8h.html#a2e117804a7699187ffbbb2558cf3106a">01361</a> <a class="code" href="ospf6__message_8c.html#a2e117804a7699187ffbbb2558cf3106a">ospf6_hello_send</a> (<span class="keyword">struct</span> <a class="code" href="structthread.html">thread</a> *<a class="code" href="structthread.html">thread</a>)
<a name="l01362"></a>01362 {
<a name="l01363"></a>01363   <span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi;
<a name="l01364"></a>01364   <span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *oh;
<a name="l01365"></a>01365   <span class="keyword">struct </span><a class="code" href="structospf6__hello.html">ospf6_hello</a> *hello;
<a name="l01366"></a>01366   u_char *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l01367"></a>01367   <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;
<a name="l01368"></a>01368   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l01369"></a>01369 
<a name="l01370"></a>01370   oi = (<span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *) <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
<a name="l01371"></a>01371   oi-&gt;<a class="code" href="structospf6__interface.html#a2166b82112542d46986c60ef49b36ce0">thread_send_hello</a> = (<span class="keyword">struct </span>thread *) <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01372"></a>01372 
<a name="l01373"></a>01373   <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#aafdfe7c67c1ff540201718b688e0a15b">state</a> &lt;= <a class="code" href="ospf6__interface_8h.html#a49b579760cabb266eb7331686381fc51">OSPF6_INTERFACE_DOWN</a>)
<a name="l01374"></a>01374     {
<a name="l01375"></a>01375       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#a2bf7c8dd972224d5a8255986e52ea771">OSPF6_MESSAGE_TYPE_HELLO</a>, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l01376"></a>01376         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Unable to send Hello on down interface %s&quot;</span>,
<a name="l01377"></a>01377                    oi-&gt;<a class="code" href="structospf6__interface.html#ab77617d3c7c82e25b6c035d9e1856c22">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);
<a name="l01378"></a>01378       <span class="keywordflow">return</span> 0;
<a name="l01379"></a>01379     }
<a name="l01380"></a>01380 
<a name="l01381"></a>01381   <span class="comment">/* set next thread */</span>
<a name="l01382"></a>01382   oi-&gt;<a class="code" href="structospf6__interface.html#a2166b82112542d46986c60ef49b36ce0">thread_send_hello</a> = <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a2e117804a7699187ffbbb2558cf3106a">ospf6_hello_send</a>,
<a name="l01383"></a>01383                                             oi, oi-&gt;<a class="code" href="structospf6__interface.html#a361e7c155d93d4b4082a22d43f6da499">hello_interval</a>);
<a name="l01384"></a>01384 
<a name="l01385"></a>01385   memset (<a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>, 0, <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>);
<a name="l01386"></a>01386   oh = (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *) <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>;
<a name="l01387"></a>01387   hello = (<span class="keyword">struct </span><a class="code" href="structospf6__hello.html">ospf6_hello</a> *)((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l01388"></a>01388 
<a name="l01389"></a>01389   hello-&gt;<a class="code" href="structospf6__hello.html#a2f7c26913d42af645dc312d90b771430">interface_id</a> = htonl (oi-&gt;<a class="code" href="structospf6__interface.html#ab77617d3c7c82e25b6c035d9e1856c22">interface</a>-&gt;<a class="code" href="structinterface.html#ae4c4a0eca6642e37e29e1177a39872ea">ifindex</a>);
<a name="l01390"></a>01390   hello-&gt;<a class="code" href="structospf6__hello.html#a27d677bd81ca4bb5e3da0adcdc46616c">priority</a> = oi-&gt;<a class="code" href="structospf6__interface.html#a91a541af8d7b9a9b224b2dbb768f4822">priority</a>;
<a name="l01391"></a>01391   hello-&gt;<a class="code" href="structospf6__hello.html#a565763d170eba38a2152a567aadbbf6f">options</a>[0] = oi-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a4ddb7d4da05f99266462914a8935c976">options</a>[0];
<a name="l01392"></a>01392   hello-&gt;<a class="code" href="structospf6__hello.html#a565763d170eba38a2152a567aadbbf6f">options</a>[1] = oi-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a4ddb7d4da05f99266462914a8935c976">options</a>[1];
<a name="l01393"></a>01393   hello-&gt;<a class="code" href="structospf6__hello.html#a565763d170eba38a2152a567aadbbf6f">options</a>[2] = oi-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a4ddb7d4da05f99266462914a8935c976">options</a>[2];
<a name="l01394"></a>01394   hello-&gt;<a class="code" href="structospf6__hello.html#a061d5f19e3c9307df71c0294807e3ff9">hello_interval</a> = htons (oi-&gt;<a class="code" href="structospf6__interface.html#a361e7c155d93d4b4082a22d43f6da499">hello_interval</a>);
<a name="l01395"></a>01395   hello-&gt;<a class="code" href="structospf6__hello.html#a1429ca752f62050f89d9c61f9052ad6d">dead_interval</a> = htons (oi-&gt;<a class="code" href="structospf6__interface.html#abcdd28a392cf138d80f052c651e9236b">dead_interval</a>);
<a name="l01396"></a>01396   hello-&gt;<a class="code" href="structospf6__hello.html#afb3b0ce9544783eb334693ff084e3e53">drouter</a> = oi-&gt;<a class="code" href="structospf6__interface.html#a5e0184b714337299cd1fa5ae9cc87eb0">drouter</a>;
<a name="l01397"></a>01397   hello-&gt;<a class="code" href="structospf6__hello.html#a8f28e7af24bc5ec67f8e93ae10888f4f">bdrouter</a> = oi-&gt;<a class="code" href="structospf6__interface.html#a7b1736cd4740da2f26d27caf31983964">bdrouter</a>;
<a name="l01398"></a>01398 
<a name="l01399"></a>01399   p = (u_char *)((caddr_t) hello + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__hello.html">ospf6_hello</a>));
<a name="l01400"></a>01400 
<a name="l01401"></a>01401   <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (oi-&gt;<a class="code" href="structospf6__interface.html#ada404f0a64a2f3783445fdf2c2dccf6d">neighbor_list</a>, node, nnode, on))
<a name="l01402"></a>01402     {
<a name="l01403"></a>01403       <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> &lt; <a class="code" href="ospf6__neighbor_8h.html#aafc5ff11ba1a9aafe6a27792d1137a7e">OSPF6_NEIGHBOR_INIT</a>)
<a name="l01404"></a>01404         <span class="keywordflow">continue</span>;
<a name="l01405"></a>01405 
<a name="l01406"></a>01406       <span class="keywordflow">if</span> (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a> + <span class="keyword">sizeof</span> (u_int32_t) &gt; oi-&gt;<a class="code" href="structospf6__interface.html#a88579a4c38c3458d12425986c1a43893">ifmtu</a>)
<a name="l01407"></a>01407         {
<a name="l01408"></a>01408           <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#a2bf7c8dd972224d5a8255986e52ea771">OSPF6_MESSAGE_TYPE_HELLO</a>, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l01409"></a>01409             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;sending Hello message: exceeds I/F MTU&quot;</span>);
<a name="l01410"></a>01410           <span class="keywordflow">break</span>;
<a name="l01411"></a>01411         }
<a name="l01412"></a>01412 
<a name="l01413"></a>01413       <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (p, &amp;on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e3045fcc29c1083d1b638fd64e07e0">router_id</a>, sizeof (u_int32_t));
<a name="l01414"></a>01414       p += <span class="keyword">sizeof</span> (u_int32_t);
<a name="l01415"></a>01415     }
<a name="l01416"></a>01416 
<a name="l01417"></a>01417   oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a> = <a class="code" href="ospf6__message_8h.html#a2bf7c8dd972224d5a8255986e52ea771">OSPF6_MESSAGE_TYPE_HELLO</a>;
<a name="l01418"></a>01418   oh-&gt;<a class="code" href="structospf6__header.html#aef7496dd76d0c2eca889f7a9d01936ff">length</a> = htons (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>);
<a name="l01419"></a>01419 
<a name="l01420"></a>01420   <a class="code" href="ospf6__message_8c.html#a872c5c0ebbeea4de643a1dec4b5c7d54">ospf6_send</a> (oi-&gt;<a class="code" href="structospf6__interface.html#a8df3591fcba060b5f64e35dfdb338888">linklocal_addr</a>, &amp;<a class="code" href="ospf6__network_8c.html#a8f18d0317b172f8e2b317e4583a16933">allspfrouters6</a>, oi, oh);
<a name="l01421"></a>01421   <span class="keywordflow">return</span> 0;
<a name="l01422"></a>01422 }
<a name="l01423"></a>01423 
<a name="l01424"></a>01424 <span class="keywordtype">int</span>
<a name="l01425"></a><a class="code" href="ospf6__message_8h.html#a42f57245d02e4581ca30fd1e5fc9a533">01425</a> <a class="code" href="ospf6__message_8c.html#a42f57245d02e4581ca30fd1e5fc9a533">ospf6_dbdesc_send</a> (<span class="keyword">struct</span> <a class="code" href="structthread.html">thread</a> *<a class="code" href="structthread.html">thread</a>)
<a name="l01426"></a>01426 {
<a name="l01427"></a>01427   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l01428"></a>01428   <span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *oh;
<a name="l01429"></a>01429   <span class="keyword">struct </span><a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a> *dbdesc;
<a name="l01430"></a>01430   u_char *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l01431"></a>01431   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa;
<a name="l01432"></a>01432 
<a name="l01433"></a>01433   on = (<span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *) <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
<a name="l01434"></a>01434   on-&gt;<a class="code" href="structospf6__neighbor.html#a1a4c0c39a774eea8cd35f2f4d96f77b6">thread_send_dbdesc</a> = (<span class="keyword">struct </span>thread *) <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01435"></a>01435 
<a name="l01436"></a>01436   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> &lt; <a class="code" href="ospf6__neighbor_8h.html#a127b580f45ab0c59d908b0a07c8b4574">OSPF6_NEIGHBOR_EXSTART</a>)
<a name="l01437"></a>01437     {
<a name="l01438"></a>01438       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#a2bd43bbd6161d38b8361ae6d377b736a">OSPF6_MESSAGE_TYPE_DBDESC</a>, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l01439"></a>01439         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Quit to send DbDesc to neighbor %s state %s&quot;</span>,
<a name="l01440"></a>01440             on-&gt;<a class="code" href="structospf6__neighbor.html#aa0ccec2f7b9c56628ce2e4a0bc37d463">name</a>, <a class="code" href="ospf6__neighbor_8c.html#aee78e9afc46a9acd2c77382df5760c03">ospf6_neighbor_state_str</a>[on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a>]);
<a name="l01441"></a>01441       <span class="keywordflow">return</span> 0;
<a name="l01442"></a>01442     }
<a name="l01443"></a>01443 
<a name="l01444"></a>01444   <span class="comment">/* set next thread if master */</span>
<a name="l01445"></a>01445   <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac15b90e0b312bdbd6fe1c95b1008b52a">dbdesc_bits</a>, <a class="code" href="ospf6__message_8h.html#aca7fe538d9edb962ca47fbeec7e4bf6b">OSPF6_DBDESC_MSBIT</a>))
<a name="l01446"></a>01446     on-&gt;<a class="code" href="structospf6__neighbor.html#a1a4c0c39a774eea8cd35f2f4d96f77b6">thread_send_dbdesc</a> =
<a name="l01447"></a>01447       <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a42f57245d02e4581ca30fd1e5fc9a533">ospf6_dbdesc_send</a>, on,
<a name="l01448"></a>01448                         on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a85d5e73751611ee20f1ad041a181cbde">rxmt_interval</a>);
<a name="l01449"></a>01449 
<a name="l01450"></a>01450   memset (<a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>, 0, <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>);
<a name="l01451"></a>01451   oh = (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *) <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>;
<a name="l01452"></a>01452   dbdesc = (<span class="keyword">struct </span><a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a> *)((caddr_t) oh +
<a name="l01453"></a>01453                                    <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l01454"></a>01454 
<a name="l01455"></a>01455   <span class="comment">/* if this is initial one, initialize sequence number for DbDesc */</span>
<a name="l01456"></a>01456   <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac15b90e0b312bdbd6fe1c95b1008b52a">dbdesc_bits</a>, <a class="code" href="ospf6__message_8h.html#a1de1fec9c59c8037fa5f6cb5f8bf35cb">OSPF6_DBDESC_IBIT</a>))
<a name="l01457"></a>01457     {
<a name="l01458"></a>01458       <span class="keyword">struct </span>timeval tv;
<a name="l01459"></a>01459       <span class="keywordflow">if</span> (<a class="code" href="thread_8c.html#abf5861abe71d6f9a1ddd493be0218de1">quagga_gettime</a> (<a class="code" href="thread_8h.html#a64fff521e88ba8b01645c5bb89085b33a7f92aaa461f13c163b13f96085eb3cd9">QUAGGA_CLK_MONOTONIC</a>, &amp;tv) &lt; 0)
<a name="l01460"></a>01460         tv.tv_sec = 1;
<a name="l01461"></a>01461       on-&gt;<a class="code" href="structospf6__neighbor.html#ac1d6bfb88eaad876f48cbda9787f617b">dbdesc_seqnum</a> = tv.tv_sec;
<a name="l01462"></a>01462     }
<a name="l01463"></a>01463 
<a name="l01464"></a>01464   dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#af1290ef8a9bc29c30daa8568df7556e3">options</a>[0] = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a4ddb7d4da05f99266462914a8935c976">options</a>[0];
<a name="l01465"></a>01465   dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#af1290ef8a9bc29c30daa8568df7556e3">options</a>[1] = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a4ddb7d4da05f99266462914a8935c976">options</a>[1];
<a name="l01466"></a>01466   dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#af1290ef8a9bc29c30daa8568df7556e3">options</a>[2] = on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a4ddb7d4da05f99266462914a8935c976">options</a>[2];
<a name="l01467"></a>01467   dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a354af018af795ae987a64381168e6272">ifmtu</a> = htons (on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a88579a4c38c3458d12425986c1a43893">ifmtu</a>);
<a name="l01468"></a>01468   dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a> = on-&gt;<a class="code" href="structospf6__neighbor.html#ac15b90e0b312bdbd6fe1c95b1008b52a">dbdesc_bits</a>;
<a name="l01469"></a>01469   dbdesc-&gt;<a class="code" href="structospf6__dbdesc.html#ad7bdcd6eb854254824f0932e67834f16">seqnum</a> = htonl (on-&gt;<a class="code" href="structospf6__neighbor.html#ac1d6bfb88eaad876f48cbda9787f617b">dbdesc_seqnum</a>);
<a name="l01470"></a>01470 
<a name="l01471"></a>01471   <span class="comment">/* if this is not initial one, set LSA headers in dbdesc */</span>
<a name="l01472"></a>01472   p = (u_char *)((caddr_t) dbdesc + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__dbdesc.html">ospf6_dbdesc</a>));
<a name="l01473"></a>01473   <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac15b90e0b312bdbd6fe1c95b1008b52a">dbdesc_bits</a>, <a class="code" href="ospf6__message_8h.html#a1de1fec9c59c8037fa5f6cb5f8bf35cb">OSPF6_DBDESC_IBIT</a>))
<a name="l01474"></a>01474     {
<a name="l01475"></a>01475       <span class="keywordflow">for</span> (lsa = <a class="code" href="ospf6__lsdb_8c.html#ab9d15a52a7be50c379748fe7ba91251f">ospf6_lsdb_head</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a6f48add846713a088741ffa99ad6b1e6">dbdesc_list</a>); lsa;
<a name="l01476"></a>01476            lsa = <a class="code" href="ospf6__lsdb_8c.html#a7fccfd842f6c1849beb8237ccca195d0">ospf6_lsdb_next</a> (lsa))
<a name="l01477"></a>01477         {
<a name="l01478"></a>01478           <a class="code" href="ospf6__lsa_8c.html#a801d1d70da30cca2f219992a62b0f0bc">ospf6_lsa_age_update_to_send</a> (lsa, on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a8332fa0bef3f650b9ce32c772c028437">transdelay</a>);
<a name="l01479"></a>01479 
<a name="l01480"></a>01480           <span class="comment">/* MTU check */</span>
<a name="l01481"></a>01481           <span class="keywordflow">if</span> (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a> + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>) &gt;
<a name="l01482"></a>01482               on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a88579a4c38c3458d12425986c1a43893">ifmtu</a>)
<a name="l01483"></a>01483             {
<a name="l01484"></a>01484               <a class="code" href="ospf6__lsa_8c.html#ae6a337ae60488897392e2ecaa480ea62">ospf6_lsa_unlock</a> (lsa);
<a name="l01485"></a>01485               <span class="keywordflow">break</span>;
<a name="l01486"></a>01486             }
<a name="l01487"></a>01487           <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (p, lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>, sizeof (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>));
<a name="l01488"></a>01488           p += <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>);
<a name="l01489"></a>01489         }
<a name="l01490"></a>01490     }
<a name="l01491"></a>01491 
<a name="l01492"></a>01492   oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a> = <a class="code" href="ospf6__message_8h.html#a2bd43bbd6161d38b8361ae6d377b736a">OSPF6_MESSAGE_TYPE_DBDESC</a>;
<a name="l01493"></a>01493   oh-&gt;<a class="code" href="structospf6__header.html#aef7496dd76d0c2eca889f7a9d01936ff">length</a> = htons (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>);
<a name="l01494"></a>01494 
<a name="l01495"></a>01495   <a class="code" href="ospf6__message_8c.html#a872c5c0ebbeea4de643a1dec4b5c7d54">ospf6_send</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a8df3591fcba060b5f64e35dfdb338888">linklocal_addr</a>, &amp;on-&gt;<a class="code" href="structospf6__neighbor.html#a2b28434ae3a26d2a1e10fc30d4384920">linklocal_addr</a>,
<a name="l01496"></a>01496               on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>, oh);
<a name="l01497"></a>01497   <span class="keywordflow">return</span> 0;
<a name="l01498"></a>01498 }
<a name="l01499"></a>01499 
<a name="l01500"></a>01500 <span class="keywordtype">int</span>
<a name="l01501"></a><a class="code" href="ospf6__message_8h.html#a695acafa16585e5fc57cd8c563b54c5e">01501</a> <a class="code" href="ospf6__message_8c.html#a695acafa16585e5fc57cd8c563b54c5e">ospf6_dbdesc_send_newone</a> (<span class="keyword">struct</span> <a class="code" href="structthread.html">thread</a> *<a class="code" href="structthread.html">thread</a>)
<a name="l01502"></a>01502 {
<a name="l01503"></a>01503   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l01504"></a>01504   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa;
<a name="l01505"></a>01505   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size = 0;
<a name="l01506"></a>01506 
<a name="l01507"></a>01507   on = (<span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *) <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
<a name="l01508"></a>01508   <a class="code" href="ospf6__lsdb_8c.html#afe227d03e9560c745dd0ba9a901875b0">ospf6_lsdb_remove_all</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a6f48add846713a088741ffa99ad6b1e6">dbdesc_list</a>);
<a name="l01509"></a>01509 
<a name="l01510"></a>01510   <span class="comment">/* move LSAs from summary_list to dbdesc_list (within neighbor structure)</span>
<a name="l01511"></a>01511 <span class="comment">     so that ospf6_send_dbdesc () can send those LSAs */</span>
<a name="l01512"></a>01512   size = <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>) + sizeof (struct ospf6_dbdesc);
<a name="l01513"></a>01513   <span class="keywordflow">for</span> (lsa = <a class="code" href="ospf6__lsdb_8c.html#ab9d15a52a7be50c379748fe7ba91251f">ospf6_lsdb_head</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a10465c504ad56aefb723065acddc0b34">summary_list</a>); lsa;
<a name="l01514"></a>01514        lsa = <a class="code" href="ospf6__lsdb_8c.html#a7fccfd842f6c1849beb8237ccca195d0">ospf6_lsdb_next</a> (lsa))
<a name="l01515"></a>01515     {
<a name="l01516"></a>01516       <span class="keywordflow">if</span> (size + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>) &gt; on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a88579a4c38c3458d12425986c1a43893">ifmtu</a>)
<a name="l01517"></a>01517         {
<a name="l01518"></a>01518           <a class="code" href="ospf6__lsa_8c.html#ae6a337ae60488897392e2ecaa480ea62">ospf6_lsa_unlock</a> (lsa);
<a name="l01519"></a>01519           <span class="keywordflow">break</span>;
<a name="l01520"></a>01520         }
<a name="l01521"></a>01521 
<a name="l01522"></a>01522       <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (<a class="code" href="ospf6__lsa_8c.html#a98dc000e578715b010159ca0c5b38a07">ospf6_lsa_copy</a> (lsa), on-&gt;<a class="code" href="structospf6__neighbor.html#a6f48add846713a088741ffa99ad6b1e6">dbdesc_list</a>);
<a name="l01523"></a>01523       <a class="code" href="ospf6__lsdb_8c.html#a57848d384aafd619bd84c654fb9ed146">ospf6_lsdb_remove</a> (lsa, on-&gt;<a class="code" href="structospf6__neighbor.html#a10465c504ad56aefb723065acddc0b34">summary_list</a>);
<a name="l01524"></a>01524       size += <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>);
<a name="l01525"></a>01525     }
<a name="l01526"></a>01526 
<a name="l01527"></a>01527   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a10465c504ad56aefb723065acddc0b34">summary_list</a>-&gt;<a class="code" href="structospf6__lsdb.html#aa9c852db97e2303379eacb9f82dfe456">count</a> == 0)
<a name="l01528"></a>01528     <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac15b90e0b312bdbd6fe1c95b1008b52a">dbdesc_bits</a>, <a class="code" href="ospf6__message_8h.html#a6b4ff9c565893a42ee04d66d477b0802">OSPF6_DBDESC_MBIT</a>);
<a name="l01529"></a>01529 
<a name="l01530"></a>01530   <span class="comment">/* If slave, More bit check must be done here */</span>
<a name="l01531"></a>01531   <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac15b90e0b312bdbd6fe1c95b1008b52a">dbdesc_bits</a>, <a class="code" href="ospf6__message_8h.html#aca7fe538d9edb962ca47fbeec7e4bf6b">OSPF6_DBDESC_MSBIT</a>) &amp;&amp; <span class="comment">/* Slave */</span>
<a name="l01532"></a>01532       ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a78fd4919e6c9e3d142210f5732696816">dbdesc_last</a>.<a class="code" href="structospf6__dbdesc.html#a873441f016471526c8c3516506de0f60">bits</a>, <a class="code" href="ospf6__message_8h.html#a6b4ff9c565893a42ee04d66d477b0802">OSPF6_DBDESC_MBIT</a>) &amp;&amp;
<a name="l01533"></a>01533       ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac15b90e0b312bdbd6fe1c95b1008b52a">dbdesc_bits</a>, <a class="code" href="ospf6__message_8h.html#a6b4ff9c565893a42ee04d66d477b0802">OSPF6_DBDESC_MBIT</a>))
<a name="l01534"></a>01534     <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#a74fd583c4b2b26c3ec3c39b30ab2c54d">exchange_done</a>, on, 0);
<a name="l01535"></a>01535 
<a name="l01536"></a>01536   <a class="code" href="thread_8h.html#adfc9185c89375a240b90ab50241c497d">thread_execute</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a42f57245d02e4581ca30fd1e5fc9a533">ospf6_dbdesc_send</a>, on, 0);
<a name="l01537"></a>01537   <span class="keywordflow">return</span> 0;
<a name="l01538"></a>01538 }
<a name="l01539"></a>01539 
<a name="l01540"></a>01540 <span class="keywordtype">int</span>
<a name="l01541"></a><a class="code" href="ospf6__message_8h.html#af83f5687852b02777d049247cc518e8e">01541</a> <a class="code" href="ospf6__message_8c.html#af83f5687852b02777d049247cc518e8e">ospf6_lsreq_send</a> (<span class="keyword">struct</span> <a class="code" href="structthread.html">thread</a> *<a class="code" href="structthread.html">thread</a>)
<a name="l01542"></a>01542 {
<a name="l01543"></a>01543   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l01544"></a>01544   <span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *oh;
<a name="l01545"></a>01545   <span class="keyword">struct </span><a class="code" href="structospf6__lsreq__entry.html">ospf6_lsreq_entry</a> *e;
<a name="l01546"></a>01546   u_char *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l01547"></a>01547   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa;
<a name="l01548"></a>01548 
<a name="l01549"></a>01549   on = (<span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *) <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
<a name="l01550"></a>01550   on-&gt;<a class="code" href="structospf6__neighbor.html#a645f58ca5b6b428ae7ae616bc4781f51">thread_send_lsreq</a> = (<span class="keyword">struct </span>thread *) <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01551"></a>01551 
<a name="l01552"></a>01552   <span class="comment">/* LSReq will be sent only in ExStart or Loading */</span>
<a name="l01553"></a>01553   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#afa0419c15460d1d703d2b3cfa7859984">OSPF6_NEIGHBOR_EXCHANGE</a> &amp;&amp;
<a name="l01554"></a>01554       on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#aa50b6edd6d1268220ae4e13b2fef14e8">OSPF6_NEIGHBOR_LOADING</a>)
<a name="l01555"></a>01555     {
<a name="l01556"></a>01556       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#a685011318dd28abf2279e718803d4daa">OSPF6_MESSAGE_TYPE_LSREQ</a>, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l01557"></a>01557         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Quit to send LSReq to neighbor %s state %s&quot;</span>,
<a name="l01558"></a>01558             on-&gt;<a class="code" href="structospf6__neighbor.html#aa0ccec2f7b9c56628ce2e4a0bc37d463">name</a>, <a class="code" href="ospf6__neighbor_8c.html#aee78e9afc46a9acd2c77382df5760c03">ospf6_neighbor_state_str</a>[on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a>]);
<a name="l01559"></a>01559       <span class="keywordflow">return</span> 0;
<a name="l01560"></a>01560     }
<a name="l01561"></a>01561 
<a name="l01562"></a>01562   <span class="comment">/* schedule loading_done if request list is empty */</span>
<a name="l01563"></a>01563   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a1e0692790f663381e86374ed0e829f95">request_list</a>-&gt;<a class="code" href="structospf6__lsdb.html#aa9c852db97e2303379eacb9f82dfe456">count</a> == 0)
<a name="l01564"></a>01564     {
<a name="l01565"></a>01565       <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#affe0ecf0ece70b2d797c3efc0cfe62d8">loading_done</a>, on, 0);
<a name="l01566"></a>01566       <span class="keywordflow">return</span> 0;
<a name="l01567"></a>01567     }
<a name="l01568"></a>01568 
<a name="l01569"></a>01569   <span class="comment">/* set next thread */</span>
<a name="l01570"></a>01570   on-&gt;<a class="code" href="structospf6__neighbor.html#a645f58ca5b6b428ae7ae616bc4781f51">thread_send_lsreq</a> =
<a name="l01571"></a>01571     <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#af83f5687852b02777d049247cc518e8e">ospf6_lsreq_send</a>, on,
<a name="l01572"></a>01572                       on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a85d5e73751611ee20f1ad041a181cbde">rxmt_interval</a>);
<a name="l01573"></a>01573 
<a name="l01574"></a>01574   memset (<a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>, 0, <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>);
<a name="l01575"></a>01575   oh = (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *) <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>;
<a name="l01576"></a>01576 
<a name="l01577"></a>01577   <span class="comment">/* set Request entries in lsreq */</span>
<a name="l01578"></a>01578   p = (u_char *)((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l01579"></a>01579   <span class="keywordflow">for</span> (lsa = <a class="code" href="ospf6__lsdb_8c.html#ab9d15a52a7be50c379748fe7ba91251f">ospf6_lsdb_head</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a1e0692790f663381e86374ed0e829f95">request_list</a>); lsa;
<a name="l01580"></a>01580        lsa = <a class="code" href="ospf6__lsdb_8c.html#a7fccfd842f6c1849beb8237ccca195d0">ospf6_lsdb_next</a> (lsa))
<a name="l01581"></a>01581     {
<a name="l01582"></a>01582       <span class="comment">/* MTU check */</span>
<a name="l01583"></a>01583       <span class="keywordflow">if</span> (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a> + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsreq__entry.html">ospf6_lsreq_entry</a>) &gt; on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a88579a4c38c3458d12425986c1a43893">ifmtu</a>)
<a name="l01584"></a>01584         {
<a name="l01585"></a>01585           <a class="code" href="ospf6__lsa_8c.html#ae6a337ae60488897392e2ecaa480ea62">ospf6_lsa_unlock</a> (lsa);
<a name="l01586"></a>01586           <span class="keywordflow">break</span>;
<a name="l01587"></a>01587         }
<a name="l01588"></a>01588 
<a name="l01589"></a>01589       e = (<span class="keyword">struct </span><a class="code" href="structospf6__lsreq__entry.html">ospf6_lsreq_entry</a> *) p;
<a name="l01590"></a>01590       e-&gt;<a class="code" href="structospf6__lsreq__entry.html#a09dbf8da910d21427e70dc809ecdbdee">type</a> = lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>;
<a name="l01591"></a>01591       e-&gt;<a class="code" href="structospf6__lsreq__entry.html#aba0c6eedec677748c8e48ddd6d6e3924">id</a> = lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a663d9c2afc1cdc7a124a2c9d1199e394">id</a>;
<a name="l01592"></a>01592       e-&gt;<a class="code" href="structospf6__lsreq__entry.html#a61084665841c7716a614d48361de8b4f">adv_router</a> = lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a756706ceafd6ffab88f8ee481fcc3619">adv_router</a>;
<a name="l01593"></a>01593       p += <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsreq__entry.html">ospf6_lsreq_entry</a>);
<a name="l01594"></a>01594     }
<a name="l01595"></a>01595 
<a name="l01596"></a>01596   oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a> = <a class="code" href="ospf6__message_8h.html#a685011318dd28abf2279e718803d4daa">OSPF6_MESSAGE_TYPE_LSREQ</a>;
<a name="l01597"></a>01597   oh-&gt;<a class="code" href="structospf6__header.html#aef7496dd76d0c2eca889f7a9d01936ff">length</a> = htons (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>);
<a name="l01598"></a>01598 
<a name="l01599"></a>01599   <a class="code" href="ospf6__message_8c.html#a872c5c0ebbeea4de643a1dec4b5c7d54">ospf6_send</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a8df3591fcba060b5f64e35dfdb338888">linklocal_addr</a>, &amp;on-&gt;<a class="code" href="structospf6__neighbor.html#a2b28434ae3a26d2a1e10fc30d4384920">linklocal_addr</a>,
<a name="l01600"></a>01600               on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>, oh);
<a name="l01601"></a>01601   <span class="keywordflow">return</span> 0;
<a name="l01602"></a>01602 }
<a name="l01603"></a>01603 
<a name="l01604"></a>01604 <span class="keywordtype">int</span>
<a name="l01605"></a><a class="code" href="ospf6__message_8h.html#a50608f7c51e0c039c4735781d1f66690">01605</a> <a class="code" href="ospf6__message_8c.html#a50608f7c51e0c039c4735781d1f66690">ospf6_lsupdate_send_neighbor</a> (<span class="keyword">struct</span> <a class="code" href="structthread.html">thread</a> *<a class="code" href="structthread.html">thread</a>)
<a name="l01606"></a>01606 {
<a name="l01607"></a>01607   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l01608"></a>01608   <span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *oh;
<a name="l01609"></a>01609   <span class="keyword">struct </span><a class="code" href="structospf6__lsupdate.html">ospf6_lsupdate</a> *lsupdate;
<a name="l01610"></a>01610   u_char *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l01611"></a>01611   <span class="keywordtype">int</span> <a class="code" href="bgp__open_8h.html#ab4570498c4316aa5f7b4852c778b3320">num</a>;
<a name="l01612"></a>01612   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa;
<a name="l01613"></a>01613 
<a name="l01614"></a>01614   on = (<span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *) <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
<a name="l01615"></a>01615   on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e6540e3ce6bd90bc1603a529648a86">thread_send_lsupdate</a> = (<span class="keyword">struct </span>thread *) <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01616"></a>01616 
<a name="l01617"></a>01617   <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#ac6f61e0ff8bcf71f99c6edc50ab9ca97">OSPF6_MESSAGE_TYPE_LSUPDATE</a>, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l01618"></a>01618     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;LSUpdate to neighbor %s&quot;</span>, on-&gt;<a class="code" href="structospf6__neighbor.html#aa0ccec2f7b9c56628ce2e4a0bc37d463">name</a>);
<a name="l01619"></a>01619 
<a name="l01620"></a>01620   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> &lt; <a class="code" href="ospf6__neighbor_8h.html#afa0419c15460d1d703d2b3cfa7859984">OSPF6_NEIGHBOR_EXCHANGE</a>)
<a name="l01621"></a>01621     {
<a name="l01622"></a>01622       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#ac6f61e0ff8bcf71f99c6edc50ab9ca97">OSPF6_MESSAGE_TYPE_LSUPDATE</a>, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l01623"></a>01623         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Quit to send (neighbor state %s)&quot;</span>,
<a name="l01624"></a>01624             <a class="code" href="ospf6__neighbor_8c.html#aee78e9afc46a9acd2c77382df5760c03">ospf6_neighbor_state_str</a>[on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a>]);
<a name="l01625"></a>01625       <span class="keywordflow">return</span> 0;
<a name="l01626"></a>01626     }
<a name="l01627"></a>01627 
<a name="l01628"></a>01628   <span class="comment">/* if we have nothing to send, return */</span>
<a name="l01629"></a>01629   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac3f142375bf4e9e7c8e54daed55b4ca4">lsupdate_list</a>-&gt;<a class="code" href="structospf6__lsdb.html#aa9c852db97e2303379eacb9f82dfe456">count</a> == 0 &amp;&amp;
<a name="l01630"></a>01630       on-&gt;<a class="code" href="structospf6__neighbor.html#a6e96ad2f82d2741e769bc179d35e583f">retrans_list</a>-&gt;<a class="code" href="structospf6__lsdb.html#aa9c852db97e2303379eacb9f82dfe456">count</a> == 0)
<a name="l01631"></a>01631     {
<a name="l01632"></a>01632       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#ac6f61e0ff8bcf71f99c6edc50ab9ca97">OSPF6_MESSAGE_TYPE_LSUPDATE</a>, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l01633"></a>01633         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Quit to send (nothing to send)&quot;</span>);
<a name="l01634"></a>01634       <span class="keywordflow">return</span> 0;
<a name="l01635"></a>01635     }
<a name="l01636"></a>01636 
<a name="l01637"></a>01637   memset (<a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>, 0, <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>);
<a name="l01638"></a>01638   oh = (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *) <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>;
<a name="l01639"></a>01639   lsupdate = (<span class="keyword">struct </span><a class="code" href="structospf6__lsupdate.html">ospf6_lsupdate</a> *)
<a name="l01640"></a>01640     ((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l01641"></a>01641 
<a name="l01642"></a>01642   p = (u_char *)((caddr_t) lsupdate + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsupdate.html">ospf6_lsupdate</a>));
<a name="l01643"></a>01643   num = 0;
<a name="l01644"></a>01644 
<a name="l01645"></a>01645   <span class="comment">/* lsupdate_list lists those LSA which doesn&#39;t need to be</span>
<a name="l01646"></a>01646 <span class="comment">     retransmitted. remove those from the list */</span>
<a name="l01647"></a>01647   <span class="keywordflow">for</span> (lsa = <a class="code" href="ospf6__lsdb_8c.html#ab9d15a52a7be50c379748fe7ba91251f">ospf6_lsdb_head</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac3f142375bf4e9e7c8e54daed55b4ca4">lsupdate_list</a>); lsa;
<a name="l01648"></a>01648        lsa = <a class="code" href="ospf6__lsdb_8c.html#a7fccfd842f6c1849beb8237ccca195d0">ospf6_lsdb_next</a> (lsa))
<a name="l01649"></a>01649     {
<a name="l01650"></a>01650       <span class="comment">/* MTU check */</span>
<a name="l01651"></a>01651       <span class="keywordflow">if</span> ( (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a> + (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>))
<a name="l01652"></a>01652           &gt; on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a88579a4c38c3458d12425986c1a43893">ifmtu</a>)
<a name="l01653"></a>01653         {
<a name="l01654"></a>01654           <a class="code" href="ospf6__lsa_8c.html#ae6a337ae60488897392e2ecaa480ea62">ospf6_lsa_unlock</a> (lsa);
<a name="l01655"></a>01655           <span class="keywordflow">break</span>;
<a name="l01656"></a>01656         }
<a name="l01657"></a>01657 
<a name="l01658"></a>01658       <a class="code" href="ospf6__lsa_8c.html#a801d1d70da30cca2f219992a62b0f0bc">ospf6_lsa_age_update_to_send</a> (lsa, on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a8332fa0bef3f650b9ce32c772c028437">transdelay</a>);
<a name="l01659"></a>01659       <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (p, lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>, <a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>));
<a name="l01660"></a>01660       p += <a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>);
<a name="l01661"></a>01661       num++;
<a name="l01662"></a>01662 
<a name="l01663"></a>01663       <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad5cc6db207dcf7791b2b17f7e3132dc5">lock</a> == 2);
<a name="l01664"></a>01664       <a class="code" href="ospf6__lsdb_8c.html#a57848d384aafd619bd84c654fb9ed146">ospf6_lsdb_remove</a> (lsa, on-&gt;<a class="code" href="structospf6__neighbor.html#ac3f142375bf4e9e7c8e54daed55b4ca4">lsupdate_list</a>);
<a name="l01665"></a>01665     }
<a name="l01666"></a>01666 
<a name="l01667"></a>01667   <span class="keywordflow">for</span> (lsa = <a class="code" href="ospf6__lsdb_8c.html#ab9d15a52a7be50c379748fe7ba91251f">ospf6_lsdb_head</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a6e96ad2f82d2741e769bc179d35e583f">retrans_list</a>); lsa;
<a name="l01668"></a>01668        lsa = <a class="code" href="ospf6__lsdb_8c.html#a7fccfd842f6c1849beb8237ccca195d0">ospf6_lsdb_next</a> (lsa))
<a name="l01669"></a>01669     {
<a name="l01670"></a>01670       <span class="comment">/* MTU check */</span>
<a name="l01671"></a>01671       <span class="keywordflow">if</span> ( (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a> + (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>))
<a name="l01672"></a>01672           &gt; on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a88579a4c38c3458d12425986c1a43893">ifmtu</a>)
<a name="l01673"></a>01673         {
<a name="l01674"></a>01674           <a class="code" href="ospf6__lsa_8c.html#ae6a337ae60488897392e2ecaa480ea62">ospf6_lsa_unlock</a> (lsa);
<a name="l01675"></a>01675           <span class="keywordflow">break</span>;
<a name="l01676"></a>01676         }
<a name="l01677"></a>01677 
<a name="l01678"></a>01678       <a class="code" href="ospf6__lsa_8c.html#a801d1d70da30cca2f219992a62b0f0bc">ospf6_lsa_age_update_to_send</a> (lsa, on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a8332fa0bef3f650b9ce32c772c028437">transdelay</a>);
<a name="l01679"></a>01679       <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (p, lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>, <a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>));
<a name="l01680"></a>01680       p += <a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>);
<a name="l01681"></a>01681       num++;
<a name="l01682"></a>01682     }
<a name="l01683"></a>01683 
<a name="l01684"></a>01684   lsupdate-&gt;<a class="code" href="structospf6__lsupdate.html#ad78c6309d7425390af712e6bba8ce78f">lsa_number</a> = htonl (num);
<a name="l01685"></a>01685 
<a name="l01686"></a>01686   oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a> = <a class="code" href="ospf6__message_8h.html#ac6f61e0ff8bcf71f99c6edc50ab9ca97">OSPF6_MESSAGE_TYPE_LSUPDATE</a>;
<a name="l01687"></a>01687   oh-&gt;<a class="code" href="structospf6__header.html#aef7496dd76d0c2eca889f7a9d01936ff">length</a> = htons (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>);
<a name="l01688"></a>01688 
<a name="l01689"></a>01689   <a class="code" href="ospf6__message_8c.html#a872c5c0ebbeea4de643a1dec4b5c7d54">ospf6_send</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a8df3591fcba060b5f64e35dfdb338888">linklocal_addr</a>, &amp;on-&gt;<a class="code" href="structospf6__neighbor.html#a2b28434ae3a26d2a1e10fc30d4384920">linklocal_addr</a>,
<a name="l01690"></a>01690               on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>, oh);
<a name="l01691"></a>01691 
<a name="l01692"></a>01692   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac3f142375bf4e9e7c8e54daed55b4ca4">lsupdate_list</a>-&gt;<a class="code" href="structospf6__lsdb.html#aa9c852db97e2303379eacb9f82dfe456">count</a> != 0 ||
<a name="l01693"></a>01693       on-&gt;<a class="code" href="structospf6__neighbor.html#a6e96ad2f82d2741e769bc179d35e583f">retrans_list</a>-&gt;<a class="code" href="structospf6__lsdb.html#aa9c852db97e2303379eacb9f82dfe456">count</a> != 0)
<a name="l01694"></a>01694     {
<a name="l01695"></a>01695       <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac3f142375bf4e9e7c8e54daed55b4ca4">lsupdate_list</a>-&gt;<a class="code" href="structospf6__lsdb.html#aa9c852db97e2303379eacb9f82dfe456">count</a> != 0)
<a name="l01696"></a>01696         on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e6540e3ce6bd90bc1603a529648a86">thread_send_lsupdate</a> =
<a name="l01697"></a>01697           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a50608f7c51e0c039c4735781d1f66690">ospf6_lsupdate_send_neighbor</a>, on, 0);
<a name="l01698"></a>01698       <span class="keywordflow">else</span>
<a name="l01699"></a>01699         on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e6540e3ce6bd90bc1603a529648a86">thread_send_lsupdate</a> =
<a name="l01700"></a>01700           <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a50608f7c51e0c039c4735781d1f66690">ospf6_lsupdate_send_neighbor</a>, on,
<a name="l01701"></a>01701                             on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a85d5e73751611ee20f1ad041a181cbde">rxmt_interval</a>);
<a name="l01702"></a>01702     }
<a name="l01703"></a>01703 
<a name="l01704"></a>01704   <span class="keywordflow">return</span> 0;
<a name="l01705"></a>01705 }
<a name="l01706"></a>01706 
<a name="l01707"></a>01707 <span class="keywordtype">int</span>
<a name="l01708"></a><a class="code" href="ospf6__message_8h.html#a06554ad9592dbdbc0986c4de39f0c318">01708</a> <a class="code" href="ospf6__message_8c.html#a06554ad9592dbdbc0986c4de39f0c318">ospf6_lsupdate_send_interface</a> (<span class="keyword">struct</span> <a class="code" href="structthread.html">thread</a> *<a class="code" href="structthread.html">thread</a>)
<a name="l01709"></a>01709 {
<a name="l01710"></a>01710   <span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi;
<a name="l01711"></a>01711   <span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *oh;
<a name="l01712"></a>01712   <span class="keyword">struct </span><a class="code" href="structospf6__lsupdate.html">ospf6_lsupdate</a> *lsupdate;
<a name="l01713"></a>01713   u_char *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l01714"></a>01714   <span class="keywordtype">int</span> <a class="code" href="bgp__open_8h.html#ab4570498c4316aa5f7b4852c778b3320">num</a>;
<a name="l01715"></a>01715   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa;
<a name="l01716"></a>01716 
<a name="l01717"></a>01717   oi = (<span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *) <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
<a name="l01718"></a>01718   oi-&gt;<a class="code" href="structospf6__interface.html#a0f7c7a7f0611d03b12361b0cf0b7cba6">thread_send_lsupdate</a> = (<span class="keyword">struct </span>thread *) <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01719"></a>01719 
<a name="l01720"></a>01720   <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#aafdfe7c67c1ff540201718b688e0a15b">state</a> &lt;= <a class="code" href="ospf6__interface_8h.html#a7af1b8c38ed1a44f1b883d25f8c851e2">OSPF6_INTERFACE_WAITING</a>)
<a name="l01721"></a>01721     {
<a name="l01722"></a>01722       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#ac6f61e0ff8bcf71f99c6edc50ab9ca97">OSPF6_MESSAGE_TYPE_LSUPDATE</a>, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l01723"></a>01723         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Quit to send LSUpdate to interface %s state %s&quot;</span>,
<a name="l01724"></a>01724             oi-&gt;<a class="code" href="structospf6__interface.html#ab77617d3c7c82e25b6c035d9e1856c22">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>, <a class="code" href="ospf6__interface_8c.html#ae87e59ecae5232da2543307cd88795b8">ospf6_interface_state_str</a>[oi-&gt;<a class="code" href="structospf6__interface.html#aafdfe7c67c1ff540201718b688e0a15b">state</a>]);
<a name="l01725"></a>01725       <span class="keywordflow">return</span> 0;
<a name="l01726"></a>01726     }
<a name="l01727"></a>01727 
<a name="l01728"></a>01728   <span class="comment">/* if we have nothing to send, return */</span>
<a name="l01729"></a>01729   <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#a42c393a90f856992c87da5a9d0607f98">lsupdate_list</a>-&gt;<a class="code" href="structospf6__lsdb.html#aa9c852db97e2303379eacb9f82dfe456">count</a> == 0)
<a name="l01730"></a>01730     <span class="keywordflow">return</span> 0;
<a name="l01731"></a>01731 
<a name="l01732"></a>01732   memset (<a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>, 0, <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>);
<a name="l01733"></a>01733   oh = (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *) <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>;
<a name="l01734"></a>01734   lsupdate = (<span class="keyword">struct </span><a class="code" href="structospf6__lsupdate.html">ospf6_lsupdate</a> *)((caddr_t) oh +
<a name="l01735"></a>01735                                        <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l01736"></a>01736 
<a name="l01737"></a>01737   p = (u_char *)((caddr_t) lsupdate + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsupdate.html">ospf6_lsupdate</a>));
<a name="l01738"></a>01738   num = 0;
<a name="l01739"></a>01739 
<a name="l01740"></a>01740   <span class="keywordflow">for</span> (lsa = <a class="code" href="ospf6__lsdb_8c.html#ab9d15a52a7be50c379748fe7ba91251f">ospf6_lsdb_head</a> (oi-&gt;<a class="code" href="structospf6__interface.html#a42c393a90f856992c87da5a9d0607f98">lsupdate_list</a>); lsa;
<a name="l01741"></a>01741        lsa = <a class="code" href="ospf6__lsdb_8c.html#a7fccfd842f6c1849beb8237ccca195d0">ospf6_lsdb_next</a> (lsa))
<a name="l01742"></a>01742     {
<a name="l01743"></a>01743       <span class="comment">/* MTU check */</span>
<a name="l01744"></a>01744       <span class="keywordflow">if</span> ( (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a> + ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>)))
<a name="l01745"></a>01745           &gt; oi-&gt;<a class="code" href="structospf6__interface.html#a88579a4c38c3458d12425986c1a43893">ifmtu</a>)
<a name="l01746"></a>01746         {
<a name="l01747"></a>01747           <a class="code" href="ospf6__lsa_8c.html#ae6a337ae60488897392e2ecaa480ea62">ospf6_lsa_unlock</a> (lsa);
<a name="l01748"></a>01748           <span class="keywordflow">break</span>;
<a name="l01749"></a>01749         }
<a name="l01750"></a>01750 
<a name="l01751"></a>01751       <a class="code" href="ospf6__lsa_8c.html#a801d1d70da30cca2f219992a62b0f0bc">ospf6_lsa_age_update_to_send</a> (lsa, oi-&gt;<a class="code" href="structospf6__interface.html#a8332fa0bef3f650b9ce32c772c028437">transdelay</a>);
<a name="l01752"></a>01752       <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (p, lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>, <a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>));
<a name="l01753"></a>01753       p += <a class="code" href="ospf6__lsa_8h.html#af20378c406bcfdfa9dde9213c2ceb684">OSPF6_LSA_SIZE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>);
<a name="l01754"></a>01754       num++;
<a name="l01755"></a>01755 
<a name="l01756"></a>01756       <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad5cc6db207dcf7791b2b17f7e3132dc5">lock</a> == 2);
<a name="l01757"></a>01757       <a class="code" href="ospf6__lsdb_8c.html#a57848d384aafd619bd84c654fb9ed146">ospf6_lsdb_remove</a> (lsa, oi-&gt;<a class="code" href="structospf6__interface.html#a42c393a90f856992c87da5a9d0607f98">lsupdate_list</a>);
<a name="l01758"></a>01758     }
<a name="l01759"></a>01759 
<a name="l01760"></a>01760   lsupdate-&gt;<a class="code" href="structospf6__lsupdate.html#ad78c6309d7425390af712e6bba8ce78f">lsa_number</a> = htonl (num);
<a name="l01761"></a>01761 
<a name="l01762"></a>01762   oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a> = <a class="code" href="ospf6__message_8h.html#ac6f61e0ff8bcf71f99c6edc50ab9ca97">OSPF6_MESSAGE_TYPE_LSUPDATE</a>;
<a name="l01763"></a>01763   oh-&gt;<a class="code" href="structospf6__header.html#aef7496dd76d0c2eca889f7a9d01936ff">length</a> = htons (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>);
<a name="l01764"></a>01764 
<a name="l01765"></a>01765   <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#aafdfe7c67c1ff540201718b688e0a15b">state</a> == <a class="code" href="ospf6__interface_8h.html#ad83f536f4674c165d7f393d28f087843">OSPF6_INTERFACE_DR</a> ||
<a name="l01766"></a>01766       oi-&gt;<a class="code" href="structospf6__interface.html#aafdfe7c67c1ff540201718b688e0a15b">state</a> == <a class="code" href="ospf6__interface_8h.html#ad0b8da8f1b2db8ec33b43b223b114d51">OSPF6_INTERFACE_BDR</a>)
<a name="l01767"></a>01767     <a class="code" href="ospf6__message_8c.html#a872c5c0ebbeea4de643a1dec4b5c7d54">ospf6_send</a> (oi-&gt;<a class="code" href="structospf6__interface.html#a8df3591fcba060b5f64e35dfdb338888">linklocal_addr</a>, &amp;<a class="code" href="ospf6__network_8c.html#a8f18d0317b172f8e2b317e4583a16933">allspfrouters6</a>, oi, oh);
<a name="l01768"></a>01768   <span class="keywordflow">else</span>
<a name="l01769"></a>01769     <a class="code" href="ospf6__message_8c.html#a872c5c0ebbeea4de643a1dec4b5c7d54">ospf6_send</a> (oi-&gt;<a class="code" href="structospf6__interface.html#a8df3591fcba060b5f64e35dfdb338888">linklocal_addr</a>, &amp;<a class="code" href="ospf6__network_8c.html#a09927a6bc76695ca91bbd7a8e3e1beae">alldrouters6</a>, oi, oh);
<a name="l01770"></a>01770 
<a name="l01771"></a>01771   <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#a42c393a90f856992c87da5a9d0607f98">lsupdate_list</a>-&gt;<a class="code" href="structospf6__lsdb.html#aa9c852db97e2303379eacb9f82dfe456">count</a> &gt; 0)
<a name="l01772"></a>01772     {
<a name="l01773"></a>01773       oi-&gt;<a class="code" href="structospf6__interface.html#a0f7c7a7f0611d03b12361b0cf0b7cba6">thread_send_lsupdate</a> =
<a name="l01774"></a>01774         <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a06554ad9592dbdbc0986c4de39f0c318">ospf6_lsupdate_send_interface</a>, oi, 0);
<a name="l01775"></a>01775     }
<a name="l01776"></a>01776 
<a name="l01777"></a>01777   <span class="keywordflow">return</span> 0;
<a name="l01778"></a>01778 }
<a name="l01779"></a>01779 
<a name="l01780"></a>01780 <span class="keywordtype">int</span>
<a name="l01781"></a><a class="code" href="ospf6__message_8h.html#abaeba7b19d1caad52e507bd228656385">01781</a> <a class="code" href="ospf6__message_8c.html#abaeba7b19d1caad52e507bd228656385">ospf6_lsack_send_neighbor</a> (<span class="keyword">struct</span> <a class="code" href="structthread.html">thread</a> *<a class="code" href="structthread.html">thread</a>)
<a name="l01782"></a>01782 {
<a name="l01783"></a>01783   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l01784"></a>01784   <span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *oh;
<a name="l01785"></a>01785   u_char *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l01786"></a>01786   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa;
<a name="l01787"></a>01787 
<a name="l01788"></a>01788   on = (<span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *) <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
<a name="l01789"></a>01789   on-&gt;<a class="code" href="structospf6__neighbor.html#a3efe4e76725c8138916061f7fbeccd0b">thread_send_lsack</a> = (<span class="keyword">struct </span>thread *) <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01790"></a>01790 
<a name="l01791"></a>01791   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> &lt; <a class="code" href="ospf6__neighbor_8h.html#afa0419c15460d1d703d2b3cfa7859984">OSPF6_NEIGHBOR_EXCHANGE</a>)
<a name="l01792"></a>01792     {
<a name="l01793"></a>01793       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#a19fd0641f70b0878b9ce5e7966c7ae73">OSPF6_MESSAGE_TYPE_LSACK</a>, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l01794"></a>01794         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Quit to send LSAck to neighbor %s state %s&quot;</span>,
<a name="l01795"></a>01795             on-&gt;<a class="code" href="structospf6__neighbor.html#aa0ccec2f7b9c56628ce2e4a0bc37d463">name</a>, <a class="code" href="ospf6__neighbor_8c.html#aee78e9afc46a9acd2c77382df5760c03">ospf6_neighbor_state_str</a>[on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a>]);
<a name="l01796"></a>01796       <span class="keywordflow">return</span> 0;
<a name="l01797"></a>01797     }
<a name="l01798"></a>01798 
<a name="l01799"></a>01799   <span class="comment">/* if we have nothing to send, return */</span>
<a name="l01800"></a>01800   <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#ae027726d4952b94fd753b700bd4b7dee">lsack_list</a>-&gt;<a class="code" href="structospf6__lsdb.html#aa9c852db97e2303379eacb9f82dfe456">count</a> == 0)
<a name="l01801"></a>01801     <span class="keywordflow">return</span> 0;
<a name="l01802"></a>01802 
<a name="l01803"></a>01803   memset (<a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>, 0, <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>);
<a name="l01804"></a>01804   oh = (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *) <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>;
<a name="l01805"></a>01805 
<a name="l01806"></a>01806   p = (u_char *)((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l01807"></a>01807 
<a name="l01808"></a>01808   <span class="keywordflow">for</span> (lsa = <a class="code" href="ospf6__lsdb_8c.html#ab9d15a52a7be50c379748fe7ba91251f">ospf6_lsdb_head</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#ae027726d4952b94fd753b700bd4b7dee">lsack_list</a>); lsa;
<a name="l01809"></a>01809        lsa = <a class="code" href="ospf6__lsdb_8c.html#a7fccfd842f6c1849beb8237ccca195d0">ospf6_lsdb_next</a> (lsa))
<a name="l01810"></a>01810     {
<a name="l01811"></a>01811       <span class="comment">/* MTU check */</span>
<a name="l01812"></a>01812       <span class="keywordflow">if</span> (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a> + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>) &gt; on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a88579a4c38c3458d12425986c1a43893">ifmtu</a>)
<a name="l01813"></a>01813         {
<a name="l01814"></a>01814           <span class="comment">/* if we run out of packet size/space here,</span>
<a name="l01815"></a>01815 <span class="comment">             better to try again soon. */</span>
<a name="l01816"></a>01816           <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#a3efe4e76725c8138916061f7fbeccd0b">thread_send_lsack</a>);
<a name="l01817"></a>01817           on-&gt;<a class="code" href="structospf6__neighbor.html#a3efe4e76725c8138916061f7fbeccd0b">thread_send_lsack</a> =
<a name="l01818"></a>01818             <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#abaeba7b19d1caad52e507bd228656385">ospf6_lsack_send_neighbor</a>, on, 0);
<a name="l01819"></a>01819 
<a name="l01820"></a>01820           <a class="code" href="ospf6__lsa_8c.html#ae6a337ae60488897392e2ecaa480ea62">ospf6_lsa_unlock</a> (lsa);
<a name="l01821"></a>01821           <span class="keywordflow">break</span>;
<a name="l01822"></a>01822         }
<a name="l01823"></a>01823 
<a name="l01824"></a>01824       <a class="code" href="ospf6__lsa_8c.html#a801d1d70da30cca2f219992a62b0f0bc">ospf6_lsa_age_update_to_send</a> (lsa, on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a8332fa0bef3f650b9ce32c772c028437">transdelay</a>);
<a name="l01825"></a>01825       <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (p, lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>, sizeof (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>));
<a name="l01826"></a>01826       p += <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>);
<a name="l01827"></a>01827 
<a name="l01828"></a>01828       <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad5cc6db207dcf7791b2b17f7e3132dc5">lock</a> == 2);
<a name="l01829"></a>01829       <a class="code" href="ospf6__lsdb_8c.html#a57848d384aafd619bd84c654fb9ed146">ospf6_lsdb_remove</a> (lsa, on-&gt;<a class="code" href="structospf6__neighbor.html#ae027726d4952b94fd753b700bd4b7dee">lsack_list</a>);
<a name="l01830"></a>01830     }
<a name="l01831"></a>01831 
<a name="l01832"></a>01832   oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a> = <a class="code" href="ospf6__message_8h.html#a19fd0641f70b0878b9ce5e7966c7ae73">OSPF6_MESSAGE_TYPE_LSACK</a>;
<a name="l01833"></a>01833   oh-&gt;<a class="code" href="structospf6__header.html#aef7496dd76d0c2eca889f7a9d01936ff">length</a> = htons (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>);
<a name="l01834"></a>01834 
<a name="l01835"></a>01835   <a class="code" href="ospf6__message_8c.html#a872c5c0ebbeea4de643a1dec4b5c7d54">ospf6_send</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a8df3591fcba060b5f64e35dfdb338888">linklocal_addr</a>, &amp;on-&gt;<a class="code" href="structospf6__neighbor.html#a2b28434ae3a26d2a1e10fc30d4384920">linklocal_addr</a>,
<a name="l01836"></a>01836               on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>, oh);
<a name="l01837"></a>01837   <span class="keywordflow">return</span> 0;
<a name="l01838"></a>01838 }
<a name="l01839"></a>01839 
<a name="l01840"></a>01840 <span class="keywordtype">int</span>
<a name="l01841"></a><a class="code" href="ospf6__message_8h.html#a785542c289b9e000dac0b01b67630f29">01841</a> <a class="code" href="ospf6__message_8c.html#a785542c289b9e000dac0b01b67630f29">ospf6_lsack_send_interface</a> (<span class="keyword">struct</span> <a class="code" href="structthread.html">thread</a> *<a class="code" href="structthread.html">thread</a>)
<a name="l01842"></a>01842 {
<a name="l01843"></a>01843   <span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi;
<a name="l01844"></a>01844   <span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *oh;
<a name="l01845"></a>01845   u_char *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l01846"></a>01846   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa;
<a name="l01847"></a>01847 
<a name="l01848"></a>01848   oi = (<span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *) <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
<a name="l01849"></a>01849   oi-&gt;<a class="code" href="structospf6__interface.html#ac0eb96a5b6f4d1b1d63aa5c0208a7680">thread_send_lsack</a> = (<span class="keyword">struct </span>thread *) <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01850"></a>01850 
<a name="l01851"></a>01851   <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#aafdfe7c67c1ff540201718b688e0a15b">state</a> &lt;= <a class="code" href="ospf6__interface_8h.html#a7af1b8c38ed1a44f1b883d25f8c851e2">OSPF6_INTERFACE_WAITING</a>)
<a name="l01852"></a>01852     {
<a name="l01853"></a>01853       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#a19fd0641f70b0878b9ce5e7966c7ae73">OSPF6_MESSAGE_TYPE_LSACK</a>, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l01854"></a>01854         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Quit to send LSAck to interface %s state %s&quot;</span>,
<a name="l01855"></a>01855             oi-&gt;<a class="code" href="structospf6__interface.html#ab77617d3c7c82e25b6c035d9e1856c22">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>, <a class="code" href="ospf6__interface_8c.html#ae87e59ecae5232da2543307cd88795b8">ospf6_interface_state_str</a>[oi-&gt;<a class="code" href="structospf6__interface.html#aafdfe7c67c1ff540201718b688e0a15b">state</a>]);
<a name="l01856"></a>01856       <span class="keywordflow">return</span> 0;
<a name="l01857"></a>01857     }
<a name="l01858"></a>01858 
<a name="l01859"></a>01859   <span class="comment">/* if we have nothing to send, return */</span>
<a name="l01860"></a>01860   <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#a3a27876455af04270cf1ff5392f5ced3">lsack_list</a>-&gt;<a class="code" href="structospf6__lsdb.html#aa9c852db97e2303379eacb9f82dfe456">count</a> == 0)
<a name="l01861"></a>01861     <span class="keywordflow">return</span> 0;
<a name="l01862"></a>01862 
<a name="l01863"></a>01863   memset (<a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>, 0, <a class="code" href="ospf6__message_8c.html#a6380f44cc4b2ccf7824f9b60d42e09db">iobuflen</a>);
<a name="l01864"></a>01864   oh = (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a> *) <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>;
<a name="l01865"></a>01865 
<a name="l01866"></a>01866   p = (u_char *)((caddr_t) oh + <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__header.html">ospf6_header</a>));
<a name="l01867"></a>01867 
<a name="l01868"></a>01868   <span class="keywordflow">for</span> (lsa = <a class="code" href="ospf6__lsdb_8c.html#ab9d15a52a7be50c379748fe7ba91251f">ospf6_lsdb_head</a> (oi-&gt;<a class="code" href="structospf6__interface.html#a3a27876455af04270cf1ff5392f5ced3">lsack_list</a>); lsa;
<a name="l01869"></a>01869        lsa = <a class="code" href="ospf6__lsdb_8c.html#a7fccfd842f6c1849beb8237ccca195d0">ospf6_lsdb_next</a> (lsa))
<a name="l01870"></a>01870     {
<a name="l01871"></a>01871       <span class="comment">/* MTU check */</span>
<a name="l01872"></a>01872       <span class="keywordflow">if</span> (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a> + <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>) &gt; oi-&gt;<a class="code" href="structospf6__interface.html#a88579a4c38c3458d12425986c1a43893">ifmtu</a>)
<a name="l01873"></a>01873         {
<a name="l01874"></a>01874           <span class="comment">/* if we run out of packet size/space here,</span>
<a name="l01875"></a>01875 <span class="comment">             better to try again soon. */</span>
<a name="l01876"></a>01876           <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a> (oi-&gt;<a class="code" href="structospf6__interface.html#ac0eb96a5b6f4d1b1d63aa5c0208a7680">thread_send_lsack</a>);
<a name="l01877"></a>01877           oi-&gt;<a class="code" href="structospf6__interface.html#ac0eb96a5b6f4d1b1d63aa5c0208a7680">thread_send_lsack</a> =
<a name="l01878"></a>01878             <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a785542c289b9e000dac0b01b67630f29">ospf6_lsack_send_interface</a>, oi, 0);
<a name="l01879"></a>01879 
<a name="l01880"></a>01880           <a class="code" href="ospf6__lsa_8c.html#ae6a337ae60488897392e2ecaa480ea62">ospf6_lsa_unlock</a> (lsa);
<a name="l01881"></a>01881           <span class="keywordflow">break</span>;
<a name="l01882"></a>01882         }
<a name="l01883"></a>01883 
<a name="l01884"></a>01884       <a class="code" href="ospf6__lsa_8c.html#a801d1d70da30cca2f219992a62b0f0bc">ospf6_lsa_age_update_to_send</a> (lsa, oi-&gt;<a class="code" href="structospf6__interface.html#a8332fa0bef3f650b9ce32c772c028437">transdelay</a>);
<a name="l01885"></a>01885       <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (p, lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>, sizeof (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>));
<a name="l01886"></a>01886       p += <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a>);
<a name="l01887"></a>01887 
<a name="l01888"></a>01888       <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad5cc6db207dcf7791b2b17f7e3132dc5">lock</a> == 2);
<a name="l01889"></a>01889       <a class="code" href="ospf6__lsdb_8c.html#a57848d384aafd619bd84c654fb9ed146">ospf6_lsdb_remove</a> (lsa, oi-&gt;<a class="code" href="structospf6__interface.html#a3a27876455af04270cf1ff5392f5ced3">lsack_list</a>);
<a name="l01890"></a>01890     }
<a name="l01891"></a>01891 
<a name="l01892"></a>01892   oh-&gt;<a class="code" href="structospf6__header.html#a4b423c1b25aafea7dd1e2a5780c57ddb">type</a> = <a class="code" href="ospf6__message_8h.html#a19fd0641f70b0878b9ce5e7966c7ae73">OSPF6_MESSAGE_TYPE_LSACK</a>;
<a name="l01893"></a>01893   oh-&gt;<a class="code" href="structospf6__header.html#aef7496dd76d0c2eca889f7a9d01936ff">length</a> = htons (p - <a class="code" href="ospf6__message_8c.html#a2e27ffe2dae02f181d73b709cf8fcf9f">sendbuf</a>);
<a name="l01894"></a>01894 
<a name="l01895"></a>01895   <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#aafdfe7c67c1ff540201718b688e0a15b">state</a> == <a class="code" href="ospf6__interface_8h.html#ad83f536f4674c165d7f393d28f087843">OSPF6_INTERFACE_DR</a> ||
<a name="l01896"></a>01896       oi-&gt;<a class="code" href="structospf6__interface.html#aafdfe7c67c1ff540201718b688e0a15b">state</a> == <a class="code" href="ospf6__interface_8h.html#ad0b8da8f1b2db8ec33b43b223b114d51">OSPF6_INTERFACE_BDR</a>)
<a name="l01897"></a>01897     <a class="code" href="ospf6__message_8c.html#a872c5c0ebbeea4de643a1dec4b5c7d54">ospf6_send</a> (oi-&gt;<a class="code" href="structospf6__interface.html#a8df3591fcba060b5f64e35dfdb338888">linklocal_addr</a>, &amp;<a class="code" href="ospf6__network_8c.html#a8f18d0317b172f8e2b317e4583a16933">allspfrouters6</a>, oi, oh);
<a name="l01898"></a>01898   <span class="keywordflow">else</span>
<a name="l01899"></a>01899     <a class="code" href="ospf6__message_8c.html#a872c5c0ebbeea4de643a1dec4b5c7d54">ospf6_send</a> (oi-&gt;<a class="code" href="structospf6__interface.html#a8df3591fcba060b5f64e35dfdb338888">linklocal_addr</a>, &amp;<a class="code" href="ospf6__network_8c.html#a09927a6bc76695ca91bbd7a8e3e1beae">alldrouters6</a>, oi, oh);
<a name="l01900"></a>01900 
<a name="l01901"></a>01901   <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#ac0eb96a5b6f4d1b1d63aa5c0208a7680">thread_send_lsack</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; oi-&gt;<a class="code" href="structospf6__interface.html#a3a27876455af04270cf1ff5392f5ced3">lsack_list</a>-&gt;<a class="code" href="structospf6__lsdb.html#aa9c852db97e2303379eacb9f82dfe456">count</a> &gt; 0)
<a name="l01902"></a>01902     {
<a name="l01903"></a>01903       oi-&gt;<a class="code" href="structospf6__interface.html#ac0eb96a5b6f4d1b1d63aa5c0208a7680">thread_send_lsack</a> =
<a name="l01904"></a>01904         <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a785542c289b9e000dac0b01b67630f29">ospf6_lsack_send_interface</a>, oi, 0);
<a name="l01905"></a>01905     }
<a name="l01906"></a>01906 
<a name="l01907"></a>01907   <span class="keywordflow">return</span> 0;
<a name="l01908"></a>01908 }
<a name="l01909"></a>01909 
<a name="l01910"></a>01910 
<a name="l01911"></a>01911 <span class="comment">/* Commands */</span>
<a name="l01912"></a><a class="code" href="ospf6__message_8c.html#a1d9ee8d13a9c1344514093233f09a8e6">01912</a> <a class="code" href="command_8h.html#acc29190d35966eddbcfeceed3aab6d25">DEFUN</a> (debug_ospf6_message,
<a name="l01913"></a>01913        debug_ospf6_message_cmd,
<a name="l01914"></a>01914        <span class="stringliteral">&quot;debug ospf6 message (unknown|hello|dbdesc|lsreq|lsupdate|lsack|all)&quot;</span>,
<a name="l01915"></a>01915        <a class="code" href="command_8h.html#aa32f22e2cc4c90e73981459688712288">DEBUG_STR</a>
<a name="l01916"></a>01916        <a class="code" href="command_8h.html#a46e5b0a7baf38db964a69848c26aa96a">OSPF6_STR</a>
<a name="l01917"></a>01917        <span class="stringliteral">&quot;Debug OSPFv3 message\n&quot;</span>
<a name="l01918"></a>01918        <span class="stringliteral">&quot;Debug Unknown message\n&quot;</span>
<a name="l01919"></a>01919        <span class="stringliteral">&quot;Debug Hello message\n&quot;</span>
<a name="l01920"></a>01920        <span class="stringliteral">&quot;Debug Database Description message\n&quot;</span>
<a name="l01921"></a>01921        <span class="stringliteral">&quot;Debug Link State Request message\n&quot;</span>
<a name="l01922"></a>01922        <span class="stringliteral">&quot;Debug Link State Update message\n&quot;</span>
<a name="l01923"></a>01923        <span class="stringliteral">&quot;Debug Link State Acknowledgement message\n&quot;</span>
<a name="l01924"></a>01924        <span class="stringliteral">&quot;Debug All message\n&quot;</span>
<a name="l01925"></a>01925        )
<a name="l01926"></a>01926 {
<a name="l01927"></a>01927   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> level = 0;
<a name="l01928"></a>01928   <span class="keywordtype">int</span> <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a> = 0;
<a name="l01929"></a>01929   <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
<a name="l01930"></a>01930 
<a name="l01931"></a>01931   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (argc &gt; 0);
<a name="l01932"></a>01932 
<a name="l01933"></a>01933   <span class="comment">/* check type */</span>
<a name="l01934"></a>01934   <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;u&quot;</span>, 1))
<a name="l01935"></a>01935     type = <a class="code" href="ospf6__message_8h.html#aaec3a97f28d8b7cfcb2e0b6cb7ba06e3">OSPF6_MESSAGE_TYPE_UNKNOWN</a>;
<a name="l01936"></a>01936   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;h&quot;</span>, 1))
<a name="l01937"></a>01937     type = <a class="code" href="ospf6__message_8h.html#a2bf7c8dd972224d5a8255986e52ea771">OSPF6_MESSAGE_TYPE_HELLO</a>;
<a name="l01938"></a>01938   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;d&quot;</span>, 1))
<a name="l01939"></a>01939     type = <a class="code" href="ospf6__message_8h.html#a2bd43bbd6161d38b8361ae6d377b736a">OSPF6_MESSAGE_TYPE_DBDESC</a>;
<a name="l01940"></a>01940   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;lsr&quot;</span>, 3))
<a name="l01941"></a>01941     type = <a class="code" href="ospf6__message_8h.html#a685011318dd28abf2279e718803d4daa">OSPF6_MESSAGE_TYPE_LSREQ</a>;
<a name="l01942"></a>01942   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;lsu&quot;</span>, 3))
<a name="l01943"></a>01943     type = <a class="code" href="ospf6__message_8h.html#ac6f61e0ff8bcf71f99c6edc50ab9ca97">OSPF6_MESSAGE_TYPE_LSUPDATE</a>;
<a name="l01944"></a>01944   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;lsa&quot;</span>, 3))
<a name="l01945"></a>01945     type = <a class="code" href="ospf6__message_8h.html#a19fd0641f70b0878b9ce5e7966c7ae73">OSPF6_MESSAGE_TYPE_LSACK</a>;
<a name="l01946"></a>01946   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;a&quot;</span>, 1))
<a name="l01947"></a>01947     type = <a class="code" href="ospf6__message_8h.html#aba04e21c291bce41cba66ddb73661883">OSPF6_MESSAGE_TYPE_ALL</a>;
<a name="l01948"></a>01948 
<a name="l01949"></a>01949   <span class="keywordflow">if</span> (argc == 1)
<a name="l01950"></a>01950     level = <a class="code" href="ospf6__message_8h.html#aa430a64d5e1493095599749d30cd8cab">OSPF6_DEBUG_MESSAGE_SEND</a> | <a class="code" href="ospf6__message_8h.html#a17ac12fc4c8b0d3634c0813ab0d80975">OSPF6_DEBUG_MESSAGE_RECV</a>;
<a name="l01951"></a>01951   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[1], <span class="stringliteral">&quot;s&quot;</span>, 1))
<a name="l01952"></a>01952     level = <a class="code" href="ospf6__message_8h.html#aa430a64d5e1493095599749d30cd8cab">OSPF6_DEBUG_MESSAGE_SEND</a>;
<a name="l01953"></a>01953   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[1], <span class="stringliteral">&quot;r&quot;</span>, 1))
<a name="l01954"></a>01954     level = <a class="code" href="ospf6__message_8h.html#a17ac12fc4c8b0d3634c0813ab0d80975">OSPF6_DEBUG_MESSAGE_RECV</a>;
<a name="l01955"></a>01955 
<a name="l01956"></a>01956   <span class="keywordflow">if</span> (type == <a class="code" href="ospf6__message_8h.html#aba04e21c291bce41cba66ddb73661883">OSPF6_MESSAGE_TYPE_ALL</a>)
<a name="l01957"></a>01957     {
<a name="l01958"></a>01958       <span class="keywordflow">for</span> (i = 0; i &lt; 6; i++)
<a name="l01959"></a>01959         <a class="code" href="ospf6__message_8h.html#a144709f2d4f2c2a9231aef33c08b9f3e">OSPF6_DEBUG_MESSAGE_ON</a> (i, level);
<a name="l01960"></a>01960     }
<a name="l01961"></a>01961   <span class="keywordflow">else</span>
<a name="l01962"></a>01962     <a class="code" href="ospf6__message_8h.html#a144709f2d4f2c2a9231aef33c08b9f3e">OSPF6_DEBUG_MESSAGE_ON</a> (type, level);
<a name="l01963"></a>01963 
<a name="l01964"></a>01964   <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l01965"></a>01965 }
<a name="l01966"></a>01966 
<a name="l01967"></a><a class="code" href="ospf6__message_8c.html#a561fe58e9f0eba23b452db72dea6d16d">01967</a> <a class="code" href="command_8h.html#a7a8f1df2b731617ea7ada9ba5cbdb704">ALIAS</a> (debug_ospf6_message,
<a name="l01968"></a>01968        debug_ospf6_message_sendrecv_cmd,
<a name="l01969"></a>01969        <span class="stringliteral">&quot;debug ospf6 message (unknown|hello|dbdesc|lsreq|lsupdate|lsack|all) (send|recv)&quot;</span>,
<a name="l01970"></a>01970        <a class="code" href="command_8h.html#aa32f22e2cc4c90e73981459688712288">DEBUG_STR</a>
<a name="l01971"></a>01971        <a class="code" href="command_8h.html#a46e5b0a7baf38db964a69848c26aa96a">OSPF6_STR</a>
<a name="l01972"></a>01972        <span class="stringliteral">&quot;Debug OSPFv3 message\n&quot;</span>
<a name="l01973"></a>01973        <span class="stringliteral">&quot;Debug Unknown message\n&quot;</span>
<a name="l01974"></a>01974        <span class="stringliteral">&quot;Debug Hello message\n&quot;</span>
<a name="l01975"></a>01975        <span class="stringliteral">&quot;Debug Database Description message\n&quot;</span>
<a name="l01976"></a>01976        <span class="stringliteral">&quot;Debug Link State Request message\n&quot;</span>
<a name="l01977"></a>01977        <span class="stringliteral">&quot;Debug Link State Update message\n&quot;</span>
<a name="l01978"></a>01978        <span class="stringliteral">&quot;Debug Link State Acknowledgement message\n&quot;</span>
<a name="l01979"></a>01979        <span class="stringliteral">&quot;Debug All message\n&quot;</span>
<a name="l01980"></a>01980        <span class="stringliteral">&quot;Debug only sending message\n&quot;</span>
<a name="l01981"></a>01981        <span class="stringliteral">&quot;Debug only receiving message\n&quot;</span>
<a name="l01982"></a>01982        )
<a name="l01983"></a>01983 
<a name="l01984"></a>01984 
<a name="l01985"></a>01985 <a class="code" href="command_8h.html#acc29190d35966eddbcfeceed3aab6d25">DEFUN</a> (no_debug_ospf6_message,
<a name="l01986"></a>01986        no_debug_ospf6_message_cmd,
<a name="l01987"></a>01987        <span class="stringliteral">&quot;no debug ospf6 message (unknown|hello|dbdesc|lsreq|lsupdate|lsack|all)&quot;</span>,
<a name="l01988"></a>01988        <a class="code" href="command_8h.html#a5b14384572729c1d1b3755d1bea1f17d">NO_STR</a>
<a name="l01989"></a>01989        <a class="code" href="command_8h.html#aa32f22e2cc4c90e73981459688712288">DEBUG_STR</a>
<a name="l01990"></a>01990        <a class="code" href="command_8h.html#a46e5b0a7baf38db964a69848c26aa96a">OSPF6_STR</a>
<a name="l01991"></a>01991        <span class="stringliteral">&quot;Debug OSPFv3 message\n&quot;</span>
<a name="l01992"></a>01992        <span class="stringliteral">&quot;Debug Unknown message\n&quot;</span>
<a name="l01993"></a>01993        <span class="stringliteral">&quot;Debug Hello message\n&quot;</span>
<a name="l01994"></a>01994        <span class="stringliteral">&quot;Debug Database Description message\n&quot;</span>
<a name="l01995"></a>01995        <span class="stringliteral">&quot;Debug Link State Request message\n&quot;</span>
<a name="l01996"></a>01996        <span class="stringliteral">&quot;Debug Link State Update message\n&quot;</span>
<a name="l01997"></a>01997        <span class="stringliteral">&quot;Debug Link State Acknowledgement message\n&quot;</span>
<a name="l01998"></a>01998        <span class="stringliteral">&quot;Debug All message\n&quot;</span>
<a name="l01999"></a>01999        )
<a name="l02000"></a>02000 {
<a name="l02001"></a>02001   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> level = 0;
<a name="l02002"></a>02002   <span class="keywordtype">int</span> <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a> = 0;
<a name="l02003"></a>02003   <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
<a name="l02004"></a>02004 
<a name="l02005"></a>02005   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (argc &gt; 0);
<a name="l02006"></a>02006 
<a name="l02007"></a>02007   <span class="comment">/* check type */</span>
<a name="l02008"></a>02008   <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;u&quot;</span>, 1))
<a name="l02009"></a>02009     type = <a class="code" href="ospf6__message_8h.html#aaec3a97f28d8b7cfcb2e0b6cb7ba06e3">OSPF6_MESSAGE_TYPE_UNKNOWN</a>;
<a name="l02010"></a>02010   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;h&quot;</span>, 1))
<a name="l02011"></a>02011     type = <a class="code" href="ospf6__message_8h.html#a2bf7c8dd972224d5a8255986e52ea771">OSPF6_MESSAGE_TYPE_HELLO</a>;
<a name="l02012"></a>02012   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;d&quot;</span>, 1))
<a name="l02013"></a>02013     type = <a class="code" href="ospf6__message_8h.html#a2bd43bbd6161d38b8361ae6d377b736a">OSPF6_MESSAGE_TYPE_DBDESC</a>;
<a name="l02014"></a>02014   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;lsr&quot;</span>, 3))
<a name="l02015"></a>02015     type = <a class="code" href="ospf6__message_8h.html#a685011318dd28abf2279e718803d4daa">OSPF6_MESSAGE_TYPE_LSREQ</a>;
<a name="l02016"></a>02016   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;lsu&quot;</span>, 3))
<a name="l02017"></a>02017     type = <a class="code" href="ospf6__message_8h.html#ac6f61e0ff8bcf71f99c6edc50ab9ca97">OSPF6_MESSAGE_TYPE_LSUPDATE</a>;
<a name="l02018"></a>02018   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;lsa&quot;</span>, 3))
<a name="l02019"></a>02019     type = <a class="code" href="ospf6__message_8h.html#a19fd0641f70b0878b9ce5e7966c7ae73">OSPF6_MESSAGE_TYPE_LSACK</a>;
<a name="l02020"></a>02020   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;a&quot;</span>, 1))
<a name="l02021"></a>02021     type = <a class="code" href="ospf6__message_8h.html#aba04e21c291bce41cba66ddb73661883">OSPF6_MESSAGE_TYPE_ALL</a>;
<a name="l02022"></a>02022 
<a name="l02023"></a>02023   <span class="keywordflow">if</span> (argc == 1)
<a name="l02024"></a>02024     level = <a class="code" href="ospf6__message_8h.html#aa430a64d5e1493095599749d30cd8cab">OSPF6_DEBUG_MESSAGE_SEND</a> | <a class="code" href="ospf6__message_8h.html#a17ac12fc4c8b0d3634c0813ab0d80975">OSPF6_DEBUG_MESSAGE_RECV</a>;
<a name="l02025"></a>02025   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[1], <span class="stringliteral">&quot;s&quot;</span>, 1))
<a name="l02026"></a>02026     level = <a class="code" href="ospf6__message_8h.html#aa430a64d5e1493095599749d30cd8cab">OSPF6_DEBUG_MESSAGE_SEND</a>;
<a name="l02027"></a>02027   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[1], <span class="stringliteral">&quot;r&quot;</span>, 1))
<a name="l02028"></a>02028     level = <a class="code" href="ospf6__message_8h.html#a17ac12fc4c8b0d3634c0813ab0d80975">OSPF6_DEBUG_MESSAGE_RECV</a>;
<a name="l02029"></a>02029 
<a name="l02030"></a>02030   <span class="keywordflow">if</span> (type == <a class="code" href="ospf6__message_8h.html#aba04e21c291bce41cba66ddb73661883">OSPF6_MESSAGE_TYPE_ALL</a>)
<a name="l02031"></a>02031     {
<a name="l02032"></a>02032       <span class="keywordflow">for</span> (i = 0; i &lt; 6; i++)
<a name="l02033"></a>02033         <a class="code" href="ospf6__message_8h.html#af9e808b191d6b73f7b894853053b107d">OSPF6_DEBUG_MESSAGE_OFF</a> (i, level);
<a name="l02034"></a>02034     }
<a name="l02035"></a>02035   <span class="keywordflow">else</span>
<a name="l02036"></a>02036     <a class="code" href="ospf6__message_8h.html#af9e808b191d6b73f7b894853053b107d">OSPF6_DEBUG_MESSAGE_OFF</a> (type, level);
<a name="l02037"></a>02037 
<a name="l02038"></a>02038   <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l02039"></a>02039 }
<a name="l02040"></a>02040 
<a name="l02041"></a><a class="code" href="ospf6__message_8c.html#ab8516a397e298d14f6bb84ff7a3e4fcc">02041</a> <a class="code" href="command_8h.html#a7a8f1df2b731617ea7ada9ba5cbdb704">ALIAS</a> (no_debug_ospf6_message,
<a name="l02042"></a>02042        no_debug_ospf6_message_sendrecv_cmd,
<a name="l02043"></a>02043        <span class="stringliteral">&quot;no debug ospf6 message &quot;</span>
<a name="l02044"></a>02044        <span class="stringliteral">&quot;(unknown|hello|dbdesc|lsreq|lsupdate|lsack|all) (send|recv)&quot;</span>,
<a name="l02045"></a>02045        <a class="code" href="command_8h.html#a5b14384572729c1d1b3755d1bea1f17d">NO_STR</a>
<a name="l02046"></a>02046        <a class="code" href="command_8h.html#aa32f22e2cc4c90e73981459688712288">DEBUG_STR</a>
<a name="l02047"></a>02047        <a class="code" href="command_8h.html#a46e5b0a7baf38db964a69848c26aa96a">OSPF6_STR</a>
<a name="l02048"></a>02048        <span class="stringliteral">&quot;Debug OSPFv3 message\n&quot;</span>
<a name="l02049"></a>02049        <span class="stringliteral">&quot;Debug Unknown message\n&quot;</span>
<a name="l02050"></a>02050        <span class="stringliteral">&quot;Debug Hello message\n&quot;</span>
<a name="l02051"></a>02051        <span class="stringliteral">&quot;Debug Database Description message\n&quot;</span>
<a name="l02052"></a>02052        <span class="stringliteral">&quot;Debug Link State Request message\n&quot;</span>
<a name="l02053"></a>02053        <span class="stringliteral">&quot;Debug Link State Update message\n&quot;</span>
<a name="l02054"></a>02054        <span class="stringliteral">&quot;Debug Link State Acknowledgement message\n&quot;</span>
<a name="l02055"></a>02055        <span class="stringliteral">&quot;Debug All message\n&quot;</span>
<a name="l02056"></a>02056        <span class="stringliteral">&quot;Debug only sending message\n&quot;</span>
<a name="l02057"></a>02057        <span class="stringliteral">&quot;Debug only receiving message\n&quot;</span>
<a name="l02058"></a>02058        )
<a name="l02059"></a>02059 
<a name="l02060"></a>02060 <span class="keywordtype">int</span>
<a name="l02061"></a>02061 <a class="code" href="ospf6__message_8h.html#a4b3244df9af36f51089b6dedb7058354">config_write_ospf6_debug_message</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>)
<a name="l02062"></a>02062 {
<a name="l02063"></a>02063   <span class="keyword">const</span> <span class="keywordtype">char</span> *type_str[] = {<span class="stringliteral">&quot;unknown&quot;</span>, <span class="stringliteral">&quot;hello&quot;</span>, <span class="stringliteral">&quot;dbdesc&quot;</span>,
<a name="l02064"></a>02064                       <span class="stringliteral">&quot;lsreq&quot;</span>, <span class="stringliteral">&quot;lsupdate&quot;</span>, <span class="stringliteral">&quot;lsack&quot;</span>};
<a name="l02065"></a>02065   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a> = 0, r = 0;
<a name="l02066"></a>02066   <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
<a name="l02067"></a>02067 
<a name="l02068"></a>02068   <span class="keywordflow">for</span> (i = 0; i &lt; 6; i++)
<a name="l02069"></a>02069     {
<a name="l02070"></a>02070       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (i, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l02071"></a>02071         s |= 1 &lt;&lt; <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
<a name="l02072"></a>02072       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (i, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l02073"></a>02073         r |= 1 &lt;&lt; <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
<a name="l02074"></a>02074     }
<a name="l02075"></a>02075 
<a name="l02076"></a>02076   <span class="keywordflow">if</span> (s == 0x3f &amp;&amp; r == 0x3f)
<a name="l02077"></a>02077     {
<a name="l02078"></a>02078       <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;debug ospf6 message all%s&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l02079"></a>02079       <span class="keywordflow">return</span> 0;
<a name="l02080"></a>02080     }
<a name="l02081"></a>02081 
<a name="l02082"></a>02082   <span class="keywordflow">if</span> (s == 0x3f &amp;&amp; r == 0)
<a name="l02083"></a>02083     {
<a name="l02084"></a>02084       <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;debug ospf6 message all send%s&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l02085"></a>02085       <span class="keywordflow">return</span> 0;
<a name="l02086"></a>02086     }
<a name="l02087"></a>02087   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s == 0 &amp;&amp; r == 0x3f)
<a name="l02088"></a>02088     {
<a name="l02089"></a>02089       <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;debug ospf6 message all recv%s&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l02090"></a>02090       <span class="keywordflow">return</span> 0;
<a name="l02091"></a>02091     }
<a name="l02092"></a>02092 
<a name="l02093"></a>02093   <span class="comment">/* Unknown message is logged by default */</span>
<a name="l02094"></a>02094   <span class="keywordflow">if</span> (! <a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#aaec3a97f28d8b7cfcb2e0b6cb7ba06e3">OSPF6_MESSAGE_TYPE_UNKNOWN</a>, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>) &amp;&amp;
<a name="l02095"></a>02095       ! <a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#aaec3a97f28d8b7cfcb2e0b6cb7ba06e3">OSPF6_MESSAGE_TYPE_UNKNOWN</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l02096"></a>02096     <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;no debug ospf6 message unknown%s&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l02097"></a>02097   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! <a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#aaec3a97f28d8b7cfcb2e0b6cb7ba06e3">OSPF6_MESSAGE_TYPE_UNKNOWN</a>, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l02098"></a>02098     <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;no debug ospf6 message unknown send%s&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l02099"></a>02099   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! <a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (<a class="code" href="ospf6__message_8h.html#aaec3a97f28d8b7cfcb2e0b6cb7ba06e3">OSPF6_MESSAGE_TYPE_UNKNOWN</a>, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l02100"></a>02100     <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;no debug ospf6 message unknown recv%s&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l02101"></a>02101 
<a name="l02102"></a>02102   <span class="keywordflow">for</span> (i = 1; i &lt; 6; i++)
<a name="l02103"></a>02103     {
<a name="l02104"></a>02104       <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (i, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>) &amp;&amp;
<a name="l02105"></a>02105           <a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (i, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l02106"></a>02106         <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;debug ospf6 message %s%s&quot;</span>, type_str[i], <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l02107"></a>02107       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (i, <a class="code" href="bgp__debug_8h.html#abc9603445bf79a3793831ee1d0ea8890">SEND</a>))
<a name="l02108"></a>02108         <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;debug ospf6 message %s send%s&quot;</span>, type_str[i],
<a name="l02109"></a>02109                  <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l02110"></a>02110       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ospf6__message_8h.html#af19e08ee4af94e2f413943d6c5145154">IS_OSPF6_DEBUG_MESSAGE</a> (i, <a class="code" href="bgp__debug_8h.html#a5c3976553336476b6fea4108b844ecf2">RECV</a>))
<a name="l02111"></a>02111         <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;debug ospf6 message %s recv%s&quot;</span>, type_str[i],
<a name="l02112"></a>02112                  <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l02113"></a>02113     }
<a name="l02114"></a>02114 
<a name="l02115"></a>02115   <span class="keywordflow">return</span> 0;
<a name="l02116"></a>02116 }
<a name="l02117"></a>02117 
<a name="l02118"></a>02118 <span class="keywordtype">void</span>
<a name="l02119"></a><a class="code" href="ospf6__message_8h.html#a5ca550936dac6d528e96deb2c7ee3037">02119</a> <a class="code" href="ospf6__message_8c.html#a5ca550936dac6d528e96deb2c7ee3037">install_element_ospf6_debug_message</a> (<span class="keywordtype">void</span>)
<a name="l02120"></a>02120 {
<a name="l02121"></a>02121   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a8eeaebd59fec75e66abd261377c21a2d">ENABLE_NODE</a>, &amp;debug_ospf6_message_cmd);
<a name="l02122"></a>02122   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a8eeaebd59fec75e66abd261377c21a2d">ENABLE_NODE</a>, &amp;no_debug_ospf6_message_cmd);
<a name="l02123"></a>02123   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a8eeaebd59fec75e66abd261377c21a2d">ENABLE_NODE</a>, &amp;debug_ospf6_message_sendrecv_cmd);
<a name="l02124"></a>02124   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a8eeaebd59fec75e66abd261377c21a2d">ENABLE_NODE</a>, &amp;no_debug_ospf6_message_sendrecv_cmd);
<a name="l02125"></a>02125   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a50754044f565f7421a152eaa411eebcc">CONFIG_NODE</a>, &amp;debug_ospf6_message_cmd);
<a name="l02126"></a>02126   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a50754044f565f7421a152eaa411eebcc">CONFIG_NODE</a>, &amp;no_debug_ospf6_message_cmd);
<a name="l02127"></a>02127   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a50754044f565f7421a152eaa411eebcc">CONFIG_NODE</a>, &amp;debug_ospf6_message_sendrecv_cmd);
<a name="l02128"></a>02128   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a50754044f565f7421a152eaa411eebcc">CONFIG_NODE</a>, &amp;no_debug_ospf6_message_sendrecv_cmd);
<a name="l02129"></a>02129 }
<a name="l02130"></a>02130 
<a name="l02131"></a>02131 
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ospf6__message_8c.html">ospf6_message.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:06 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
