<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: ospf6d/ospf6_flood.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ospf6__flood_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">ospf6d/ospf6_flood.c</div>  </div>
</div>
<div class="contents">
<a href="ospf6__flood_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2003 Yasuhiro Ohara</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This file is part of GNU Zebra.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * GNU Zebra is free software; you can redistribute it and/or modify it</span>
<a name="l00007"></a>00007 <span class="comment"> * under the terms of the GNU General Public License as published by the</span>
<a name="l00008"></a>00008 <span class="comment"> * Free Software Foundation; either version 2, or (at your option) any</span>
<a name="l00009"></a>00009 <span class="comment"> * later version.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * GNU Zebra is distributed in the hope that it will be useful, but</span>
<a name="l00012"></a>00012 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00014"></a>00014 <span class="comment"> * General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * along with GNU Zebra; see the file COPYING.  If not, write to the </span>
<a name="l00018"></a>00018 <span class="comment"> * Free Software Foundation, Inc., 59 Temple Place - Suite 330, </span>
<a name="l00019"></a>00019 <span class="comment"> * Boston, MA 02111-1307, USA.  </span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="zebra_8h.html">zebra.h</a>&gt;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="log_8h.html">log.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="thread_8h.html">thread.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="linklist_8h.html">linklist.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="vty_8h.html">vty.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="command_8h.html">command.h</a>&quot;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="ospf6d_8h.html">ospf6d.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__proto_8h.html">ospf6_proto.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__lsa_8h.html">ospf6_lsa.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__lsdb_8h.html">ospf6_lsdb.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__message_8h.html">ospf6_message.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__route_8h.html">ospf6_route.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__spf_8h.html">ospf6_spf.h</a>&quot;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__top_8h.html">ospf6_top.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__area_8h.html">ospf6_area.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__interface_8h.html">ospf6_interface.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__neighbor_8h.html">ospf6_neighbor.h</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__flood_8h.html">ospf6_flood.h</a>&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="ospf6__flood_8h.html#ab5ea0cbe048efb63f24cf10f018e8afa">00045</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="ospf6__flood_8c.html#ab5ea0cbe048efb63f24cf10f018e8afa">conf_debug_ospf6_flooding</a>;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="keyword">struct </span><a class="code" href="structospf6__lsdb.html">ospf6_lsdb</a> *
<a name="l00048"></a><a class="code" href="ospf6__flood_8h.html#a9c0285ffbb2ec03d9e8951bbffb05eb6">00048</a> <a class="code" href="ospf6__flood_8c.html#a9c0285ffbb2ec03d9e8951bbffb05eb6">ospf6_get_scoped_lsdb</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa)
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050   <span class="keyword">struct </span><a class="code" href="structospf6__lsdb.html">ospf6_lsdb</a> *lsdb = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00051"></a>00051   <span class="keywordflow">switch</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>))
<a name="l00052"></a>00052     {
<a name="l00053"></a>00053     <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#ab41aaca88cc27f951f7dbf46b5a6fb5c">OSPF6_SCOPE_LINKLOCAL</a>:
<a name="l00054"></a>00054       lsdb = <a class="code" href="ospf6d_8h.html#a2dad4cbf7a1897cb8729c3ac2419703d">OSPF6_INTERFACE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>-&gt;<a class="code" href="structospf6__lsdb.html#a0585a6851b53aafbe83fbaab828f2e21">data</a>)-&gt;lsdb;
<a name="l00055"></a>00055       <span class="keywordflow">break</span>;
<a name="l00056"></a>00056     <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0634f2bb73a043f5782d28e4e3a1ad95">OSPF6_SCOPE_AREA</a>:
<a name="l00057"></a>00057       lsdb = <a class="code" href="ospf6d_8h.html#a57a3d73f87bce959acf483eb7514a29d">OSPF6_AREA</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>-&gt;<a class="code" href="structospf6__lsdb.html#a0585a6851b53aafbe83fbaab828f2e21">data</a>)-&gt;lsdb;
<a name="l00058"></a>00058       <span class="keywordflow">break</span>;
<a name="l00059"></a>00059     <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0701d1d9c961cfb8d6da273382ea508a">OSPF6_SCOPE_AS</a>:
<a name="l00060"></a>00060       lsdb = <a class="code" href="ospf6d_8h.html#a9d917e6159d9c3125a4784bf0d8e18fd">OSPF6_PROCESS</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>-&gt;<a class="code" href="structospf6__lsdb.html#a0585a6851b53aafbe83fbaab828f2e21">data</a>)-&gt;lsdb;
<a name="l00061"></a>00061       <span class="keywordflow">break</span>;
<a name="l00062"></a>00062     <span class="keywordflow">default</span>:
<a name="l00063"></a>00063       <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (0);
<a name="l00064"></a>00064       <span class="keywordflow">break</span>;
<a name="l00065"></a>00065     }
<a name="l00066"></a>00066   <span class="keywordflow">return</span> lsdb;
<a name="l00067"></a>00067 }
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="keyword">struct </span><a class="code" href="structospf6__lsdb.html">ospf6_lsdb</a> *
<a name="l00070"></a><a class="code" href="ospf6__flood_8h.html#a622d03fd6aa40466ef3d3551b118843e">00070</a> <a class="code" href="ospf6__flood_8c.html#a622d03fd6aa40466ef3d3551b118843e">ospf6_get_scoped_lsdb_self</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa)
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072   <span class="keyword">struct </span><a class="code" href="structospf6__lsdb.html">ospf6_lsdb</a> *lsdb_self = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00073"></a>00073   <span class="keywordflow">switch</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>))
<a name="l00074"></a>00074     {
<a name="l00075"></a>00075     <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#ab41aaca88cc27f951f7dbf46b5a6fb5c">OSPF6_SCOPE_LINKLOCAL</a>:
<a name="l00076"></a>00076       lsdb_self = <a class="code" href="ospf6d_8h.html#a2dad4cbf7a1897cb8729c3ac2419703d">OSPF6_INTERFACE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>-&gt;<a class="code" href="structospf6__lsdb.html#a0585a6851b53aafbe83fbaab828f2e21">data</a>)-&gt;lsdb_self;
<a name="l00077"></a>00077       <span class="keywordflow">break</span>;
<a name="l00078"></a>00078     <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0634f2bb73a043f5782d28e4e3a1ad95">OSPF6_SCOPE_AREA</a>:
<a name="l00079"></a>00079       lsdb_self = <a class="code" href="ospf6d_8h.html#a57a3d73f87bce959acf483eb7514a29d">OSPF6_AREA</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>-&gt;<a class="code" href="structospf6__lsdb.html#a0585a6851b53aafbe83fbaab828f2e21">data</a>)-&gt;lsdb_self;
<a name="l00080"></a>00080       <span class="keywordflow">break</span>;
<a name="l00081"></a>00081     <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0701d1d9c961cfb8d6da273382ea508a">OSPF6_SCOPE_AS</a>:
<a name="l00082"></a>00082       lsdb_self = <a class="code" href="ospf6d_8h.html#a9d917e6159d9c3125a4784bf0d8e18fd">OSPF6_PROCESS</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>-&gt;<a class="code" href="structospf6__lsdb.html#a0585a6851b53aafbe83fbaab828f2e21">data</a>)-&gt;lsdb_self;
<a name="l00083"></a>00083       <span class="keywordflow">break</span>;
<a name="l00084"></a>00084     <span class="keywordflow">default</span>:
<a name="l00085"></a>00085       <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (0);
<a name="l00086"></a>00086       <span class="keywordflow">break</span>;
<a name="l00087"></a>00087     }
<a name="l00088"></a>00088   <span class="keywordflow">return</span> lsdb_self;
<a name="l00089"></a>00089 }
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="keywordtype">void</span>
<a name="l00092"></a><a class="code" href="ospf6__flood_8h.html#ae9152cb7cf4c07550397913c02d06e5e">00092</a> <a class="code" href="ospf6__flood_8c.html#ae9152cb7cf4c07550397913c02d06e5e">ospf6_lsa_originate</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa)
<a name="l00093"></a>00093 {
<a name="l00094"></a>00094   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *old;
<a name="l00095"></a>00095   <span class="keyword">struct </span><a class="code" href="structospf6__lsdb.html">ospf6_lsdb</a> *lsdb_self;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097   <span class="comment">/* find previous LSA */</span>
<a name="l00098"></a>00098   old = <a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>, lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a663d9c2afc1cdc7a124a2c9d1199e394">id</a>,
<a name="l00099"></a>00099                            lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a756706ceafd6ffab88f8ee481fcc3619">adv_router</a>, lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101   <span class="comment">/* if the new LSA does not differ from previous,</span>
<a name="l00102"></a>00102 <span class="comment">     suppress this update of the LSA */</span>
<a name="l00103"></a>00103   <span class="keywordflow">if</span> (old &amp;&amp; ! <a class="code" href="ospf6__lsa_8h.html#a4c2aac9a75143fc1972f76e677c24c33">OSPF6_LSA_IS_DIFFER</a> (lsa, old))
<a name="l00104"></a>00104     {
<a name="l00105"></a>00105       <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#a3190b5307da7d9277da288d9fd282b96">IS_OSPF6_DEBUG_ORIGINATE_TYPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>))
<a name="l00106"></a>00106         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Suppress updating LSA: %s&quot;</span>, lsa-&gt;<a class="code" href="structospf6__lsa.html#a979d21e1c4d2e1753e7d45641b0819ce">name</a>);
<a name="l00107"></a>00107       <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (lsa);
<a name="l00108"></a>00108       <span class="keywordflow">return</span>;
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111   <span class="comment">/* store it in the LSDB for self-originated LSAs */</span>
<a name="l00112"></a>00112   lsdb_self = <a class="code" href="ospf6__flood_8c.html#a622d03fd6aa40466ef3d3551b118843e">ospf6_get_scoped_lsdb_self</a> (lsa);
<a name="l00113"></a>00113   <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (<a class="code" href="ospf6__lsa_8c.html#a98dc000e578715b010159ca0c5b38a07">ospf6_lsa_copy</a> (lsa), lsdb_self);
<a name="l00114"></a>00114 
<a name="l00115"></a>00115   lsa-&gt;<a class="code" href="structospf6__lsa.html#a8ea4daae222c63b142c5072764b7233f">refresh</a> = <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__lsa_8c.html#a370c05db1f992a6e7f8657ad937f3a5f">ospf6_lsa_refresh</a>, lsa,
<a name="l00116"></a>00116                                    <a class="code" href="ospf6__proto_8h.html#ab08ddbd72ec04be1ff6959a492fc3795">LS_REFRESH_TIME</a>);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#a3bf7d5a2afba1551fff365aae68acaea">IS_OSPF6_DEBUG_LSA_TYPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>) ||
<a name="l00119"></a>00119       <a class="code" href="ospf6__lsa_8h.html#a3190b5307da7d9277da288d9fd282b96">IS_OSPF6_DEBUG_ORIGINATE_TYPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>))
<a name="l00120"></a>00120     {
<a name="l00121"></a>00121       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;LSA Originate:&quot;</span>);
<a name="l00122"></a>00122       <a class="code" href="ospf6__lsa_8c.html#a6f102ec07a6a8c18ae5567b1fab4e845">ospf6_lsa_header_print</a> (lsa);
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <span class="keywordflow">if</span> (old)
<a name="l00126"></a>00126     <a class="code" href="ospf6__flood_8c.html#adbe9dd92c0ae6afb40021b33ce7d7894">ospf6_flood_clear</a> (old);
<a name="l00127"></a>00127   <a class="code" href="ospf6__flood_8c.html#a075f0016b6d4205102b23b32b79b7da3">ospf6_flood</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, lsa);
<a name="l00128"></a>00128   <a class="code" href="ospf6__flood_8c.html#abb7a5d2b0b4d7595d4fadbf9725ac45f">ospf6_install_lsa</a> (lsa);
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 <span class="keywordtype">void</span>
<a name="l00132"></a><a class="code" href="ospf6__flood_8h.html#ae5276f4d60743b472adbbcd7ba08ada1">00132</a> <a class="code" href="ospf6__flood_8c.html#ae5276f4d60743b472adbbcd7ba08ada1">ospf6_lsa_originate_process</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa,
<a name="l00133"></a>00133                              <span class="keyword">struct</span> <a class="code" href="structospf6.html">ospf6</a> *process)
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135   lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a> = process-&gt;<a class="code" href="structospf6.html#ac8cf84e34e8461f5aea2737fc2bf8fcb">lsdb</a>;
<a name="l00136"></a>00136   <a class="code" href="ospf6__flood_8c.html#ae9152cb7cf4c07550397913c02d06e5e">ospf6_lsa_originate</a> (lsa);
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <span class="keywordtype">void</span>
<a name="l00140"></a><a class="code" href="ospf6__flood_8h.html#a3d16e7d20ecaf3dad0a2459d16133cf0">00140</a> <a class="code" href="ospf6__flood_8c.html#a3d16e7d20ecaf3dad0a2459d16133cf0">ospf6_lsa_originate_area</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa,
<a name="l00141"></a>00141                           <span class="keyword">struct</span> <a class="code" href="structospf6__area.html">ospf6_area</a> *oa)
<a name="l00142"></a>00142 {
<a name="l00143"></a>00143   lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a> = oa-&gt;<a class="code" href="structospf6__area.html#a9e658e62c2d59151531bc03b95b600bb">lsdb</a>;
<a name="l00144"></a>00144   <a class="code" href="ospf6__flood_8c.html#ae9152cb7cf4c07550397913c02d06e5e">ospf6_lsa_originate</a> (lsa);
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="keywordtype">void</span>
<a name="l00148"></a><a class="code" href="ospf6__flood_8h.html#affcf3da8e7d395a0199d1eb07cd23431">00148</a> <a class="code" href="ospf6__flood_8c.html#affcf3da8e7d395a0199d1eb07cd23431">ospf6_lsa_originate_interface</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa,
<a name="l00149"></a>00149                                <span class="keyword">struct</span> <a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi)
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151   lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a> = oi-&gt;<a class="code" href="structospf6__interface.html#ab033cb877fe417705f424d1bd2f411de">lsdb</a>;
<a name="l00152"></a>00152   <a class="code" href="ospf6__flood_8c.html#ae9152cb7cf4c07550397913c02d06e5e">ospf6_lsa_originate</a> (lsa);
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="keywordtype">void</span>
<a name="l00156"></a><a class="code" href="ospf6__flood_8h.html#a249f2b2808a03c8e9998d6bdf209a962">00156</a> <a class="code" href="ospf6__flood_8c.html#a249f2b2808a03c8e9998d6bdf209a962">ospf6_lsa_purge</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa)
<a name="l00157"></a>00157 {
<a name="l00158"></a>00158   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *<span class="keyword">self</span>;
<a name="l00159"></a>00159   <span class="keyword">struct </span><a class="code" href="structospf6__lsdb.html">ospf6_lsdb</a> *lsdb_self;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161   <span class="comment">/* remove it from the LSDB for self-originated LSAs */</span>
<a name="l00162"></a>00162   lsdb_self = <a class="code" href="ospf6__flood_8c.html#a622d03fd6aa40466ef3d3551b118843e">ospf6_get_scoped_lsdb_self</a> (lsa);
<a name="l00163"></a>00163   <span class="keyword">self</span> = <a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>, lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a663d9c2afc1cdc7a124a2c9d1199e394">id</a>,
<a name="l00164"></a>00164                             lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a756706ceafd6ffab88f8ee481fcc3619">adv_router</a>, lsdb_self);
<a name="l00165"></a>00165   <span class="keywordflow">if</span> (<span class="keyword">self</span>)
<a name="l00166"></a>00166     {
<a name="l00167"></a>00167       <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a> (self-&gt;expire);
<a name="l00168"></a>00168       <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a> (self-&gt;refresh);
<a name="l00169"></a>00169       <a class="code" href="ospf6__lsdb_8c.html#a57848d384aafd619bd84c654fb9ed146">ospf6_lsdb_remove</a> (<span class="keyword">self</span>, lsdb_self);
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   <a class="code" href="ospf6__lsa_8c.html#aee63bc21d208725601a588e998ad54a7">ospf6_lsa_premature_aging</a> (lsa);
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="keywordtype">void</span>
<a name="l00177"></a><a class="code" href="ospf6__flood_8h.html#a5e4e2b43f317fbb038100a62d6aa089a">00177</a> <a class="code" href="ospf6__flood_8c.html#a5e4e2b43f317fbb038100a62d6aa089a">ospf6_increment_retrans_count</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa)
<a name="l00178"></a>00178 {
<a name="l00179"></a>00179   <span class="comment">/* The LSA must be the original one (see the description</span>
<a name="l00180"></a>00180 <span class="comment">     in ospf6_decrement_retrans_count () below) */</span>
<a name="l00181"></a>00181   lsa-&gt;<a class="code" href="structospf6__lsa.html#af45db024602c72e968f5aee86157612d">retrans_count</a>++;
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="keywordtype">void</span>
<a name="l00185"></a><a class="code" href="ospf6__flood_8h.html#a6bee3a2ba460b276a55915e4f96dae62">00185</a> <a class="code" href="ospf6__flood_8c.html#a6bee3a2ba460b276a55915e4f96dae62">ospf6_decrement_retrans_count</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa)
<a name="l00186"></a>00186 {
<a name="l00187"></a>00187   <span class="keyword">struct </span><a class="code" href="structospf6__lsdb.html">ospf6_lsdb</a> *lsdb;
<a name="l00188"></a>00188   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *orig;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190   <span class="comment">/* The LSA must be on the retrans-list of a neighbor. It means</span>
<a name="l00191"></a>00191 <span class="comment">     the &quot;lsa&quot; is a copied one, and we have to decrement the</span>
<a name="l00192"></a>00192 <span class="comment">     retransmission count of the original one (instead of this &quot;lsa&quot;&#39;s).</span>
<a name="l00193"></a>00193 <span class="comment">     In order to find the original LSA, first we have to find</span>
<a name="l00194"></a>00194 <span class="comment">     appropriate LSDB that have the original LSA. */</span>
<a name="l00195"></a>00195   lsdb = <a class="code" href="ospf6__flood_8c.html#a9c0285ffbb2ec03d9e8951bbffb05eb6">ospf6_get_scoped_lsdb</a> (lsa);
<a name="l00196"></a>00196 
<a name="l00197"></a>00197   <span class="comment">/* Find the original LSA of which the retrans_count should be decremented */</span>
<a name="l00198"></a>00198   orig = <a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>, lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a663d9c2afc1cdc7a124a2c9d1199e394">id</a>,
<a name="l00199"></a>00199                             lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a756706ceafd6ffab88f8ee481fcc3619">adv_router</a>, lsdb);
<a name="l00200"></a>00200   <span class="keywordflow">if</span> (orig)
<a name="l00201"></a>00201     {
<a name="l00202"></a>00202       orig-&gt;<a class="code" href="structospf6__lsa.html#af45db024602c72e968f5aee86157612d">retrans_count</a>--;
<a name="l00203"></a>00203       <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (orig-&gt;<a class="code" href="structospf6__lsa.html#af45db024602c72e968f5aee86157612d">retrans_count</a> &gt;= 0);
<a name="l00204"></a>00204     }
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="comment">/* RFC2328 section 13.2 Installing LSAs in the database */</span>
<a name="l00208"></a>00208 <span class="keywordtype">void</span>
<a name="l00209"></a><a class="code" href="ospf6__flood_8h.html#abb7a5d2b0b4d7595d4fadbf9725ac45f">00209</a> <a class="code" href="ospf6__flood_8c.html#abb7a5d2b0b4d7595d4fadbf9725ac45f">ospf6_install_lsa</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa)
<a name="l00210"></a>00210 {
<a name="l00211"></a>00211   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *old;
<a name="l00212"></a>00212   <span class="keyword">struct </span>timeval now;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214   <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#a3bf7d5a2afba1551fff365aae68acaea">IS_OSPF6_DEBUG_LSA_TYPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>) ||
<a name="l00215"></a>00215       <a class="code" href="ospf6__lsa_8h.html#aaa2084839044bf56e4a49b3c1a8c72cd">IS_OSPF6_DEBUG_EXAMIN_TYPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>))
<a name="l00216"></a>00216     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Install LSA: %s&quot;</span>, lsa-&gt;<a class="code" href="structospf6__lsa.html#a979d21e1c4d2e1753e7d45641b0819ce">name</a>);
<a name="l00217"></a>00217 
<a name="l00218"></a>00218   <span class="comment">/* Remove the old instance from all neighbors&#39; Link state</span>
<a name="l00219"></a>00219 <span class="comment">     retransmission list (RFC2328 13.2 last paragraph) */</span>
<a name="l00220"></a>00220   old = <a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>, lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a663d9c2afc1cdc7a124a2c9d1199e394">id</a>,
<a name="l00221"></a>00221                            lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a756706ceafd6ffab88f8ee481fcc3619">adv_router</a>, lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>);
<a name="l00222"></a>00222   <span class="keywordflow">if</span> (old)
<a name="l00223"></a>00223     {
<a name="l00224"></a>00224       <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a> (old-&gt;<a class="code" href="structospf6__lsa.html#a6f546aa95ed513d684623f1b65869f85">expire</a>);
<a name="l00225"></a>00225       <a class="code" href="ospf6__flood_8c.html#adbe9dd92c0ae6afb40021b33ce7d7894">ospf6_flood_clear</a> (old);
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228   <a class="code" href="thread_8c.html#abf5861abe71d6f9a1ddd493be0218de1">quagga_gettime</a> (<a class="code" href="thread_8h.html#a64fff521e88ba8b01645c5bb89085b33a7f92aaa461f13c163b13f96085eb3cd9">QUAGGA_CLK_MONOTONIC</a>, &amp;now);
<a name="l00229"></a>00229   <span class="keywordflow">if</span> (! <a class="code" href="ospf6__lsa_8h.html#acde3ad184b10ca14f3eef7b2ab655ce6">OSPF6_LSA_IS_MAXAGE</a> (lsa))
<a name="l00230"></a>00230     lsa-&gt;<a class="code" href="structospf6__lsa.html#a6f546aa95ed513d684623f1b65869f85">expire</a> = <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__lsa_8c.html#aec0a8277db29406323e2f7508b60eebe">ospf6_lsa_expire</a>, lsa,
<a name="l00231"></a>00231                                     <a class="code" href="ospf6__proto_8h.html#a7d8ba9ac46dd686ffb8bd269f903b589">MAXAGE</a> + lsa-&gt;<a class="code" href="structospf6__lsa.html#ac5e609908130620c41247b9dbff58b1a">birth</a>.tv_sec - now.tv_sec);
<a name="l00232"></a>00232   <span class="keywordflow">else</span>
<a name="l00233"></a>00233     lsa-&gt;<a class="code" href="structospf6__lsa.html#a6f546aa95ed513d684623f1b65869f85">expire</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235   <span class="comment">/* actually install */</span>
<a name="l00236"></a>00236   lsa-&gt;<a class="code" href="structospf6__lsa.html#a367291986f9ddaa8157505eca1a31423">installed</a> = now;
<a name="l00237"></a>00237   <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (lsa, lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239   <span class="keywordflow">return</span>;
<a name="l00240"></a>00240 }
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 <span class="comment">/* RFC2740 section 3.5.2. Sending Link State Update packets */</span>
<a name="l00243"></a>00243 <span class="comment">/* RFC2328 section 13.3 Next step in the flooding procedure */</span>
<a name="l00244"></a>00244 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00245"></a><a class="code" href="ospf6__flood_8c.html#a326303137932895a70863563312c9522">00245</a> <a class="code" href="ospf6__flood_8c.html#a326303137932895a70863563312c9522">ospf6_flood_interface</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *from,
<a name="l00246"></a>00246                        <span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa, <span class="keyword">struct</span> <a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi)
<a name="l00247"></a>00247 {
<a name="l00248"></a>00248   <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;
<a name="l00249"></a>00249   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l00250"></a>00250   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *req;
<a name="l00251"></a>00251   <span class="keywordtype">int</span> retrans_added = 0;
<a name="l00252"></a>00252   <span class="keywordtype">int</span> is_debug = 0;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254   <span class="keywordflow">if</span> (<a class="code" href="ospf6__flood_8h.html#ad2c9fd06c28b16f3250f2bf760cb4030">IS_OSPF6_DEBUG_FLOODING</a> ||
<a name="l00255"></a>00255       <a class="code" href="ospf6__lsa_8h.html#a1f3d4f8aab1a6419a23af4d5c72e5e9d">IS_OSPF6_DEBUG_FLOOD_TYPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>))
<a name="l00256"></a>00256     {
<a name="l00257"></a>00257       is_debug++;
<a name="l00258"></a>00258       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Flooding on %s: %s&quot;</span>, oi-&gt;<a class="code" href="structospf6__interface.html#ab77617d3c7c82e25b6c035d9e1856c22">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>, lsa-&gt;<a class="code" href="structospf6__lsa.html#a979d21e1c4d2e1753e7d45641b0819ce">name</a>);
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261   <span class="comment">/* (1) For each neighbor */</span>
<a name="l00262"></a>00262   <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (oi-&gt;<a class="code" href="structospf6__interface.html#ada404f0a64a2f3783445fdf2c2dccf6d">neighbor_list</a>, node, nnode, on))
<a name="l00263"></a>00263     {
<a name="l00264"></a>00264       <span class="keywordflow">if</span> (is_debug)
<a name="l00265"></a>00265         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;To neighbor %s&quot;</span>, on-&gt;<a class="code" href="structospf6__neighbor.html#aa0ccec2f7b9c56628ce2e4a0bc37d463">name</a>);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267       <span class="comment">/* (a) if neighbor state &lt; Exchange, examin next */</span>
<a name="l00268"></a>00268       <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> &lt; <a class="code" href="ospf6__neighbor_8h.html#afa0419c15460d1d703d2b3cfa7859984">OSPF6_NEIGHBOR_EXCHANGE</a>)
<a name="l00269"></a>00269         {
<a name="l00270"></a>00270           <span class="keywordflow">if</span> (is_debug)
<a name="l00271"></a>00271             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor state less than ExChange, next neighbor&quot;</span>);
<a name="l00272"></a>00272           <span class="keywordflow">continue</span>;
<a name="l00273"></a>00273         }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275       <span class="comment">/* (b) if neighbor not yet Full, check request-list */</span>
<a name="l00276"></a>00276       <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> != <a class="code" href="ospf6__neighbor_8h.html#aae1490b2e9d8ca36df8b2127dcc289c1">OSPF6_NEIGHBOR_FULL</a>)
<a name="l00277"></a>00277         {
<a name="l00278"></a>00278           <span class="keywordflow">if</span> (is_debug)
<a name="l00279"></a>00279             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Neighbor not yet Full&quot;</span>);
<a name="l00280"></a>00280 
<a name="l00281"></a>00281           req = <a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>, lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a663d9c2afc1cdc7a124a2c9d1199e394">id</a>,
<a name="l00282"></a>00282                                    lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a756706ceafd6ffab88f8ee481fcc3619">adv_router</a>, on-&gt;<a class="code" href="structospf6__neighbor.html#a1e0692790f663381e86374ed0e829f95">request_list</a>);
<a name="l00283"></a>00283           <span class="keywordflow">if</span> (req == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00284"></a>00284             {
<a name="l00285"></a>00285               <span class="keywordflow">if</span> (is_debug)
<a name="l00286"></a>00286                 <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Not on request-list for this neighbor&quot;</span>);
<a name="l00287"></a>00287               <span class="comment">/* fall through */</span>
<a name="l00288"></a>00288             }
<a name="l00289"></a>00289           <span class="keywordflow">else</span>
<a name="l00290"></a>00290             {
<a name="l00291"></a>00291               <span class="comment">/* If new LSA less recent, examin next neighbor */</span>
<a name="l00292"></a>00292               <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8c.html#af1665de6eac6dab108363c1bf6320c69">ospf6_lsa_compare</a> (lsa, req) &gt; 0)
<a name="l00293"></a>00293                 {
<a name="l00294"></a>00294                   <span class="keywordflow">if</span> (is_debug)
<a name="l00295"></a>00295                     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Requesting is newer, next neighbor&quot;</span>);
<a name="l00296"></a>00296                   <span class="keywordflow">continue</span>;
<a name="l00297"></a>00297                 }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299               <span class="comment">/* If the same instance, delete from request-list and</span>
<a name="l00300"></a>00300 <span class="comment">                 examin next neighbor */</span>
<a name="l00301"></a>00301               <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8c.html#af1665de6eac6dab108363c1bf6320c69">ospf6_lsa_compare</a> (lsa, req) == 0)
<a name="l00302"></a>00302                 {
<a name="l00303"></a>00303                   <span class="keywordflow">if</span> (is_debug)
<a name="l00304"></a>00304                     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Requesting the same, remove it, next neighbor&quot;</span>);
<a name="l00305"></a>00305                   <a class="code" href="ospf6__lsdb_8c.html#a57848d384aafd619bd84c654fb9ed146">ospf6_lsdb_remove</a> (req, on-&gt;<a class="code" href="structospf6__neighbor.html#a1e0692790f663381e86374ed0e829f95">request_list</a>);
<a name="l00306"></a>00306                   <span class="keywordflow">continue</span>;
<a name="l00307"></a>00307                 }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309               <span class="comment">/* If the new LSA is more recent, delete from request-list */</span>
<a name="l00310"></a>00310               <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8c.html#af1665de6eac6dab108363c1bf6320c69">ospf6_lsa_compare</a> (lsa, req) &lt; 0)
<a name="l00311"></a>00311                 {
<a name="l00312"></a>00312                   <span class="keywordflow">if</span> (is_debug)
<a name="l00313"></a>00313                     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Received is newer, remove requesting&quot;</span>);
<a name="l00314"></a>00314                   <a class="code" href="ospf6__lsdb_8c.html#a57848d384aafd619bd84c654fb9ed146">ospf6_lsdb_remove</a> (req, on-&gt;<a class="code" href="structospf6__neighbor.html#a1e0692790f663381e86374ed0e829f95">request_list</a>);
<a name="l00315"></a>00315                   <span class="comment">/* fall through */</span>
<a name="l00316"></a>00316                 }
<a name="l00317"></a>00317             }
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320       <span class="comment">/* (c) If the new LSA was received from this neighbor,</span>
<a name="l00321"></a>00321 <span class="comment">         examin next neighbor */</span>
<a name="l00322"></a>00322       <span class="keywordflow">if</span> (from == on)
<a name="l00323"></a>00323         {
<a name="l00324"></a>00324           <span class="keywordflow">if</span> (is_debug)
<a name="l00325"></a>00325             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Received is from the neighbor, next neighbor&quot;</span>);
<a name="l00326"></a>00326           <span class="keywordflow">continue</span>;
<a name="l00327"></a>00327         }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329       <span class="comment">/* (d) add retrans-list, schedule retransmission */</span>
<a name="l00330"></a>00330       <span class="keywordflow">if</span> (is_debug)
<a name="l00331"></a>00331         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Add retrans-list of this neighbor&quot;</span>);
<a name="l00332"></a>00332       <a class="code" href="ospf6__flood_8c.html#a5e4e2b43f317fbb038100a62d6aa089a">ospf6_increment_retrans_count</a> (lsa);
<a name="l00333"></a>00333       <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (<a class="code" href="ospf6__lsa_8c.html#a98dc000e578715b010159ca0c5b38a07">ospf6_lsa_copy</a> (lsa), on-&gt;<a class="code" href="structospf6__neighbor.html#a6e96ad2f82d2741e769bc179d35e583f">retrans_list</a>);
<a name="l00334"></a>00334       <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e6540e3ce6bd90bc1603a529648a86">thread_send_lsupdate</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00335"></a>00335         on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e6540e3ce6bd90bc1603a529648a86">thread_send_lsupdate</a> =
<a name="l00336"></a>00336           <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a50608f7c51e0c039c4735781d1f66690">ospf6_lsupdate_send_neighbor</a>,
<a name="l00337"></a>00337                             on, on-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a85d5e73751611ee20f1ad041a181cbde">rxmt_interval</a>);
<a name="l00338"></a>00338       retrans_added++;
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341   <span class="comment">/* (2) examin next interface if not added to retrans-list */</span>
<a name="l00342"></a>00342   <span class="keywordflow">if</span> (retrans_added == 0)
<a name="l00343"></a>00343     {
<a name="l00344"></a>00344       <span class="keywordflow">if</span> (is_debug)
<a name="l00345"></a>00345         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;No retransmission scheduled, next interface&quot;</span>);
<a name="l00346"></a>00346       <span class="keywordflow">return</span>;
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349   <span class="comment">/* (3) If the new LSA was received on this interface,</span>
<a name="l00350"></a>00350 <span class="comment">     and it was from DR or BDR, examin next interface */</span>
<a name="l00351"></a>00351   <span class="keywordflow">if</span> (from &amp;&amp; from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a> == oi &amp;&amp;
<a name="l00352"></a>00352       (from-&gt;<a class="code" href="structospf6__neighbor.html#ac7e3045fcc29c1083d1b638fd64e07e0">router_id</a> == oi-&gt;<a class="code" href="structospf6__interface.html#a5e0184b714337299cd1fa5ae9cc87eb0">drouter</a> || from-&gt;<a class="code" href="structospf6__neighbor.html#ac7e3045fcc29c1083d1b638fd64e07e0">router_id</a> == oi-&gt;<a class="code" href="structospf6__interface.html#a7b1736cd4740da2f26d27caf31983964">bdrouter</a>))
<a name="l00353"></a>00353     {
<a name="l00354"></a>00354       <span class="keywordflow">if</span> (is_debug)
<a name="l00355"></a>00355         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Received is from the I/F&#39;s DR or BDR, next interface&quot;</span>);
<a name="l00356"></a>00356       <span class="keywordflow">return</span>;
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359   <span class="comment">/* (4) If the new LSA was received on this interface,</span>
<a name="l00360"></a>00360 <span class="comment">     and the interface state is BDR, examin next interface */</span>
<a name="l00361"></a>00361   <span class="keywordflow">if</span> (from &amp;&amp; from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a> == oi &amp;&amp; oi-&gt;<a class="code" href="structospf6__interface.html#aafdfe7c67c1ff540201718b688e0a15b">state</a> == <a class="code" href="ospf6__interface_8h.html#ad0b8da8f1b2db8ec33b43b223b114d51">OSPF6_INTERFACE_BDR</a>)
<a name="l00362"></a>00362     {
<a name="l00363"></a>00363       <span class="keywordflow">if</span> (is_debug)
<a name="l00364"></a>00364         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Received is from the I/F, itself BDR, next interface&quot;</span>);
<a name="l00365"></a>00365       <span class="keywordflow">return</span>;
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368   <span class="comment">/* (5) flood the LSA out the interface. */</span>
<a name="l00369"></a>00369   <span class="keywordflow">if</span> (is_debug)
<a name="l00370"></a>00370     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Schedule flooding for the interface&quot;</span>);
<a name="l00371"></a>00371   <span class="keywordflow">if</span> (<a class="code" href="if_8c.html#a88f3bd141d217db7e4118a78b1db1b60">if_is_broadcast</a> (oi-&gt;<a class="code" href="structospf6__interface.html#ab77617d3c7c82e25b6c035d9e1856c22">interface</a>))
<a name="l00372"></a>00372     {
<a name="l00373"></a>00373       <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (<a class="code" href="ospf6__lsa_8c.html#a98dc000e578715b010159ca0c5b38a07">ospf6_lsa_copy</a> (lsa), oi-&gt;<a class="code" href="structospf6__interface.html#a42c393a90f856992c87da5a9d0607f98">lsupdate_list</a>);
<a name="l00374"></a>00374       <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#a0f7c7a7f0611d03b12361b0cf0b7cba6">thread_send_lsupdate</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00375"></a>00375         oi-&gt;<a class="code" href="structospf6__interface.html#a0f7c7a7f0611d03b12361b0cf0b7cba6">thread_send_lsupdate</a> =
<a name="l00376"></a>00376           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a06554ad9592dbdbc0986c4de39f0c318">ospf6_lsupdate_send_interface</a>, oi, 0);
<a name="l00377"></a>00377     }
<a name="l00378"></a>00378   <span class="keywordflow">else</span>
<a name="l00379"></a>00379     {
<a name="l00380"></a>00380       <span class="comment">/* reschedule retransmissions to all neighbors */</span>
<a name="l00381"></a>00381       <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (oi-&gt;<a class="code" href="structospf6__interface.html#ada404f0a64a2f3783445fdf2c2dccf6d">neighbor_list</a>, node, nnode, on))
<a name="l00382"></a>00382         {
<a name="l00383"></a>00383           <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a> (on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e6540e3ce6bd90bc1603a529648a86">thread_send_lsupdate</a>);
<a name="l00384"></a>00384           on-&gt;<a class="code" href="structospf6__neighbor.html#ac7e6540e3ce6bd90bc1603a529648a86">thread_send_lsupdate</a> =
<a name="l00385"></a>00385             <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a50608f7c51e0c039c4735781d1f66690">ospf6_lsupdate_send_neighbor</a>, on, 0);
<a name="l00386"></a>00386         }
<a name="l00387"></a>00387     }
<a name="l00388"></a>00388 }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00391"></a><a class="code" href="ospf6__flood_8c.html#a02f529cff1fcc91b198203c58db1ed84">00391</a> <a class="code" href="ospf6__flood_8c.html#a02f529cff1fcc91b198203c58db1ed84">ospf6_flood_area</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *from,
<a name="l00392"></a>00392                   <span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa, <span class="keyword">struct</span> <a class="code" href="structospf6__area.html">ospf6_area</a> *oa)
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394   <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;
<a name="l00395"></a>00395   <span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397   <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (oa-&gt;<a class="code" href="structospf6__area.html#ab06f65e38225287ac3fb4c67cf9dfdcd">if_list</a>, node, nnode, oi))
<a name="l00398"></a>00398     {
<a name="l00399"></a>00399       <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>) == <a class="code" href="ospf6__lsa_8h.html#ab41aaca88cc27f951f7dbf46b5a6fb5c">OSPF6_SCOPE_LINKLOCAL</a> &amp;&amp;
<a name="l00400"></a>00400           oi != <a class="code" href="ospf6d_8h.html#a2dad4cbf7a1897cb8729c3ac2419703d">OSPF6_INTERFACE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>-&gt;<a class="code" href="structospf6__lsdb.html#a0585a6851b53aafbe83fbaab828f2e21">data</a>))
<a name="l00401"></a>00401         <span class="keywordflow">continue</span>;
<a name="l00402"></a>00402 
<a name="l00403"></a>00403 <span class="preprocessor">#if 0</span>
<a name="l00404"></a>00404 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>) == <a class="code" href="ospf6__lsa_8h.html#a0701d1d9c961cfb8d6da273382ea508a">OSPF6_SCOPE_AS</a> &amp;&amp;
<a name="l00405"></a>00405           ospf6_is_interface_virtual_link (oi))
<a name="l00406"></a>00406         <span class="keywordflow">continue</span>;
<a name="l00407"></a>00407 <span class="preprocessor">#endif</span><span class="comment">/*0*/</span>
<a name="l00408"></a>00408 
<a name="l00409"></a>00409       <a class="code" href="ospf6__flood_8c.html#a326303137932895a70863563312c9522">ospf6_flood_interface</a> (from, lsa, oi);
<a name="l00410"></a>00410     }
<a name="l00411"></a>00411 }
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00414"></a><a class="code" href="ospf6__flood_8c.html#aa7b0cba1dacd974db9e8264e0311502c">00414</a> <a class="code" href="ospf6__flood_8c.html#aa7b0cba1dacd974db9e8264e0311502c">ospf6_flood_process</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *from,
<a name="l00415"></a>00415                      <span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa, <span class="keyword">struct</span> <a class="code" href="structospf6.html">ospf6</a> *process)
<a name="l00416"></a>00416 {
<a name="l00417"></a>00417   <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;
<a name="l00418"></a>00418   <span class="keyword">struct </span><a class="code" href="structospf6__area.html">ospf6_area</a> *oa;
<a name="l00419"></a>00419 
<a name="l00420"></a>00420   <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (process-&gt;<a class="code" href="structospf6.html#a6a8e756959f407c36b123ffc040fbe96">area_list</a>, node, nnode, oa))
<a name="l00421"></a>00421     {
<a name="l00422"></a>00422       <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>) == <a class="code" href="ospf6__lsa_8h.html#a0634f2bb73a043f5782d28e4e3a1ad95">OSPF6_SCOPE_AREA</a> &amp;&amp;
<a name="l00423"></a>00423           oa != <a class="code" href="ospf6d_8h.html#a57a3d73f87bce959acf483eb7514a29d">OSPF6_AREA</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>-&gt;<a class="code" href="structospf6__lsdb.html#a0585a6851b53aafbe83fbaab828f2e21">data</a>))
<a name="l00424"></a>00424         <span class="keywordflow">continue</span>;
<a name="l00425"></a>00425       <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>) == <a class="code" href="ospf6__lsa_8h.html#ab41aaca88cc27f951f7dbf46b5a6fb5c">OSPF6_SCOPE_LINKLOCAL</a> &amp;&amp;
<a name="l00426"></a>00426           oa != <a class="code" href="ospf6d_8h.html#a2dad4cbf7a1897cb8729c3ac2419703d">OSPF6_INTERFACE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>-&gt;<a class="code" href="structospf6__lsdb.html#a0585a6851b53aafbe83fbaab828f2e21">data</a>)-&gt;area)
<a name="l00427"></a>00427         <span class="keywordflow">continue</span>;
<a name="l00428"></a>00428 
<a name="l00429"></a>00429       <span class="keywordflow">if</span> (ntohs (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>) == <a class="code" href="ospf6__lsa_8h.html#a4cba002872c9f1e86a8d3fcede9fe4dc">OSPF6_LSTYPE_AS_EXTERNAL</a> &amp;&amp;
<a name="l00430"></a>00430           <a class="code" href="ospf6__area_8h.html#af08848f9c3f603caf4af634755a5f3c4">IS_AREA_STUB</a> (oa))
<a name="l00431"></a>00431         <span class="keywordflow">continue</span>;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433       <a class="code" href="ospf6__flood_8c.html#a02f529cff1fcc91b198203c58db1ed84">ospf6_flood_area</a> (from, lsa, oa);
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 <span class="keywordtype">void</span>
<a name="l00438"></a><a class="code" href="ospf6__flood_8h.html#a075f0016b6d4205102b23b32b79b7da3">00438</a> <a class="code" href="ospf6__flood_8c.html#a075f0016b6d4205102b23b32b79b7da3">ospf6_flood</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *from, <span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa)
<a name="l00439"></a>00439 {
<a name="l00440"></a>00440   <a class="code" href="ospf6__flood_8c.html#aa7b0cba1dacd974db9e8264e0311502c">ospf6_flood_process</a> (from, lsa, <a class="code" href="structospf6.html">ospf6</a>);
<a name="l00441"></a>00441 }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00444"></a><a class="code" href="ospf6__flood_8c.html#a32de774c0aa56f6d40d696d5d9804a40">00444</a> <a class="code" href="ospf6__flood_8c.html#a32de774c0aa56f6d40d696d5d9804a40">ospf6_flood_clear_interface</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa, <span class="keyword">struct</span> <a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi)
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446   <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;
<a name="l00447"></a>00447   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l00448"></a>00448   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *rem;
<a name="l00449"></a>00449 
<a name="l00450"></a>00450   <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (oi-&gt;<a class="code" href="structospf6__interface.html#ada404f0a64a2f3783445fdf2c2dccf6d">neighbor_list</a>, node, nnode, on))
<a name="l00451"></a>00451     {
<a name="l00452"></a>00452       rem = <a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>, lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a663d9c2afc1cdc7a124a2c9d1199e394">id</a>,
<a name="l00453"></a>00453                                lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a756706ceafd6ffab88f8ee481fcc3619">adv_router</a>, on-&gt;<a class="code" href="structospf6__neighbor.html#a6e96ad2f82d2741e769bc179d35e583f">retrans_list</a>);
<a name="l00454"></a>00454       <span class="keywordflow">if</span> (rem &amp;&amp; ! <a class="code" href="ospf6__lsa_8c.html#af1665de6eac6dab108363c1bf6320c69">ospf6_lsa_compare</a> (rem, lsa))
<a name="l00455"></a>00455         {
<a name="l00456"></a>00456           <span class="keywordflow">if</span> (<a class="code" href="ospf6__flood_8h.html#ad2c9fd06c28b16f3250f2bf760cb4030">IS_OSPF6_DEBUG_FLOODING</a> ||
<a name="l00457"></a>00457               <a class="code" href="ospf6__lsa_8h.html#a1f3d4f8aab1a6419a23af4d5c72e5e9d">IS_OSPF6_DEBUG_FLOOD_TYPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>))
<a name="l00458"></a>00458             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Remove %s from retrans_list of %s&quot;</span>,
<a name="l00459"></a>00459                        rem-&gt;<a class="code" href="structospf6__lsa.html#a979d21e1c4d2e1753e7d45641b0819ce">name</a>, on-&gt;<a class="code" href="structospf6__neighbor.html#aa0ccec2f7b9c56628ce2e4a0bc37d463">name</a>);
<a name="l00460"></a>00460           <a class="code" href="ospf6__flood_8c.html#a6bee3a2ba460b276a55915e4f96dae62">ospf6_decrement_retrans_count</a> (rem);
<a name="l00461"></a>00461           <a class="code" href="ospf6__lsdb_8c.html#a57848d384aafd619bd84c654fb9ed146">ospf6_lsdb_remove</a> (rem, on-&gt;<a class="code" href="structospf6__neighbor.html#a6e96ad2f82d2741e769bc179d35e583f">retrans_list</a>);
<a name="l00462"></a>00462         }
<a name="l00463"></a>00463     }
<a name="l00464"></a>00464 }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00467"></a><a class="code" href="ospf6__flood_8c.html#a2b00000c3295dd98f3e402421025534b">00467</a> <a class="code" href="ospf6__flood_8c.html#a2b00000c3295dd98f3e402421025534b">ospf6_flood_clear_area</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa, <span class="keyword">struct</span> <a class="code" href="structospf6__area.html">ospf6_area</a> *oa)
<a name="l00468"></a>00468 {
<a name="l00469"></a>00469   <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;
<a name="l00470"></a>00470   <span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472   <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (oa-&gt;<a class="code" href="structospf6__area.html#ab06f65e38225287ac3fb4c67cf9dfdcd">if_list</a>, node, nnode, oi))
<a name="l00473"></a>00473     {
<a name="l00474"></a>00474       <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>) == <a class="code" href="ospf6__lsa_8h.html#ab41aaca88cc27f951f7dbf46b5a6fb5c">OSPF6_SCOPE_LINKLOCAL</a> &amp;&amp;
<a name="l00475"></a>00475           oi != <a class="code" href="ospf6d_8h.html#a2dad4cbf7a1897cb8729c3ac2419703d">OSPF6_INTERFACE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>-&gt;<a class="code" href="structospf6__lsdb.html#a0585a6851b53aafbe83fbaab828f2e21">data</a>))
<a name="l00476"></a>00476         <span class="keywordflow">continue</span>;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478 <span class="preprocessor">#if 0</span>
<a name="l00479"></a>00479 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>) == <a class="code" href="ospf6__lsa_8h.html#a0701d1d9c961cfb8d6da273382ea508a">OSPF6_SCOPE_AS</a> &amp;&amp;
<a name="l00480"></a>00480           ospf6_is_interface_virtual_link (oi))
<a name="l00481"></a>00481         <span class="keywordflow">continue</span>;
<a name="l00482"></a>00482 <span class="preprocessor">#endif</span><span class="comment">/*0*/</span>
<a name="l00483"></a>00483 
<a name="l00484"></a>00484       <a class="code" href="ospf6__flood_8c.html#a32de774c0aa56f6d40d696d5d9804a40">ospf6_flood_clear_interface</a> (lsa, oi);
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486 }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00489"></a><a class="code" href="ospf6__flood_8c.html#ad9a260dae55c84b5fa43af6d5f49e1f5">00489</a> <a class="code" href="ospf6__flood_8c.html#ad9a260dae55c84b5fa43af6d5f49e1f5">ospf6_flood_clear_process</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa, <span class="keyword">struct</span> <a class="code" href="structospf6.html">ospf6</a> *process)
<a name="l00490"></a>00490 {
<a name="l00491"></a>00491   <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;
<a name="l00492"></a>00492   <span class="keyword">struct </span><a class="code" href="structospf6__area.html">ospf6_area</a> *oa;
<a name="l00493"></a>00493 
<a name="l00494"></a>00494   <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (process-&gt;<a class="code" href="structospf6.html#a6a8e756959f407c36b123ffc040fbe96">area_list</a>, node, nnode, oa))
<a name="l00495"></a>00495     {
<a name="l00496"></a>00496       <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>) == <a class="code" href="ospf6__lsa_8h.html#a0634f2bb73a043f5782d28e4e3a1ad95">OSPF6_SCOPE_AREA</a> &amp;&amp;
<a name="l00497"></a>00497           oa != <a class="code" href="ospf6d_8h.html#a57a3d73f87bce959acf483eb7514a29d">OSPF6_AREA</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>-&gt;<a class="code" href="structospf6__lsdb.html#a0585a6851b53aafbe83fbaab828f2e21">data</a>))
<a name="l00498"></a>00498         <span class="keywordflow">continue</span>;
<a name="l00499"></a>00499       <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>) == <a class="code" href="ospf6__lsa_8h.html#ab41aaca88cc27f951f7dbf46b5a6fb5c">OSPF6_SCOPE_LINKLOCAL</a> &amp;&amp;
<a name="l00500"></a>00500           oa != <a class="code" href="ospf6d_8h.html#a2dad4cbf7a1897cb8729c3ac2419703d">OSPF6_INTERFACE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>-&gt;<a class="code" href="structospf6__lsdb.html#a0585a6851b53aafbe83fbaab828f2e21">data</a>)-&gt;area)
<a name="l00501"></a>00501         <span class="keywordflow">continue</span>;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503       <span class="keywordflow">if</span> (ntohs (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>) == <a class="code" href="ospf6__lsa_8h.html#a4cba002872c9f1e86a8d3fcede9fe4dc">OSPF6_LSTYPE_AS_EXTERNAL</a> &amp;&amp;
<a name="l00504"></a>00504           <a class="code" href="ospf6__area_8h.html#af08848f9c3f603caf4af634755a5f3c4">IS_AREA_STUB</a> (oa))
<a name="l00505"></a>00505         <span class="keywordflow">continue</span>;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507       <a class="code" href="ospf6__flood_8c.html#a2b00000c3295dd98f3e402421025534b">ospf6_flood_clear_area</a> (lsa, oa);
<a name="l00508"></a>00508     }
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 <span class="keywordtype">void</span>
<a name="l00512"></a><a class="code" href="ospf6__flood_8h.html#adbe9dd92c0ae6afb40021b33ce7d7894">00512</a> <a class="code" href="ospf6__flood_8c.html#adbe9dd92c0ae6afb40021b33ce7d7894">ospf6_flood_clear</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa)
<a name="l00513"></a>00513 {
<a name="l00514"></a>00514   <a class="code" href="ospf6__flood_8c.html#ad9a260dae55c84b5fa43af6d5f49e1f5">ospf6_flood_clear_process</a> (lsa, <a class="code" href="structospf6.html">ospf6</a>);
<a name="l00515"></a>00515 }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 <span class="comment">/* RFC2328 13.5 (Table 19): Sending link state acknowledgements. */</span>
<a name="l00519"></a>00519 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00520"></a><a class="code" href="ospf6__flood_8c.html#ac3c08bc483cd2a62d10f9e5263152cbe">00520</a> <a class="code" href="ospf6__flood_8c.html#ac3c08bc483cd2a62d10f9e5263152cbe">ospf6_acknowledge_lsa_bdrouter</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa, <span class="keywordtype">int</span> ismore_recent,
<a name="l00521"></a>00521                                 <span class="keyword">struct</span> <a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *from)
<a name="l00522"></a>00522 {
<a name="l00523"></a>00523   <span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi;
<a name="l00524"></a>00524   <span class="keywordtype">int</span> is_debug = 0;
<a name="l00525"></a>00525 
<a name="l00526"></a>00526   <span class="keywordflow">if</span> (<a class="code" href="ospf6__flood_8h.html#ad2c9fd06c28b16f3250f2bf760cb4030">IS_OSPF6_DEBUG_FLOODING</a> ||
<a name="l00527"></a>00527       <a class="code" href="ospf6__lsa_8h.html#a1f3d4f8aab1a6419a23af4d5c72e5e9d">IS_OSPF6_DEBUG_FLOOD_TYPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>))
<a name="l00528"></a>00528     is_debug++;
<a name="l00529"></a>00529 
<a name="l00530"></a>00530   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (from &amp;&amp; from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>);
<a name="l00531"></a>00531   oi = from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>;
<a name="l00532"></a>00532 
<a name="l00533"></a>00533   <span class="comment">/* LSA has been flood back out receiving interface.</span>
<a name="l00534"></a>00534 <span class="comment">     No acknowledgement sent. */</span>
<a name="l00535"></a>00535   <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a8132d817aaf58410ccfdc18a20020ce1">flag</a>, <a class="code" href="ospf6__lsa_8h.html#a6bb5201a45192e2df9a70c3424ee8b24">OSPF6_LSA_FLOODBACK</a>))
<a name="l00536"></a>00536     {
<a name="l00537"></a>00537       <span class="keywordflow">if</span> (is_debug)
<a name="l00538"></a>00538         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;No acknowledgement (BDR &amp; FloodBack)&quot;</span>);
<a name="l00539"></a>00539       <span class="keywordflow">return</span>;
<a name="l00540"></a>00540     }
<a name="l00541"></a>00541 
<a name="l00542"></a>00542   <span class="comment">/* LSA is more recent than database copy, but was not flooded</span>
<a name="l00543"></a>00543 <span class="comment">     back out receiving interface. Delayed acknowledgement sent</span>
<a name="l00544"></a>00544 <span class="comment">     if advertisement received from Designated Router,</span>
<a name="l00545"></a>00545 <span class="comment">     otherwide do nothing. */</span>
<a name="l00546"></a>00546   <span class="keywordflow">if</span> (ismore_recent &lt; 0)
<a name="l00547"></a>00547     {
<a name="l00548"></a>00548       <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#a5e0184b714337299cd1fa5ae9cc87eb0">drouter</a> == from-&gt;<a class="code" href="structospf6__neighbor.html#ac7e3045fcc29c1083d1b638fd64e07e0">router_id</a>)
<a name="l00549"></a>00549         {
<a name="l00550"></a>00550           <span class="keywordflow">if</span> (is_debug)
<a name="l00551"></a>00551             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Delayed acknowledgement (BDR &amp; MoreRecent &amp; from DR)&quot;</span>);
<a name="l00552"></a>00552           <span class="comment">/* Delayed acknowledgement */</span>
<a name="l00553"></a>00553           <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (<a class="code" href="ospf6__lsa_8c.html#a98dc000e578715b010159ca0c5b38a07">ospf6_lsa_copy</a> (lsa), oi-&gt;<a class="code" href="structospf6__interface.html#a3a27876455af04270cf1ff5392f5ced3">lsack_list</a>);
<a name="l00554"></a>00554           <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#ac0eb96a5b6f4d1b1d63aa5c0208a7680">thread_send_lsack</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00555"></a>00555             oi-&gt;<a class="code" href="structospf6__interface.html#ac0eb96a5b6f4d1b1d63aa5c0208a7680">thread_send_lsack</a> =
<a name="l00556"></a>00556               <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a785542c289b9e000dac0b01b67630f29">ospf6_lsack_send_interface</a>, oi, 3);
<a name="l00557"></a>00557         }
<a name="l00558"></a>00558       <span class="keywordflow">else</span>
<a name="l00559"></a>00559         {
<a name="l00560"></a>00560           <span class="keywordflow">if</span> (is_debug)
<a name="l00561"></a>00561             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;No acknowledgement (BDR &amp; MoreRecent &amp; ! from DR)&quot;</span>);
<a name="l00562"></a>00562         }
<a name="l00563"></a>00563       <span class="keywordflow">return</span>;
<a name="l00564"></a>00564     }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566   <span class="comment">/* LSA is a duplicate, and was treated as an implied acknowledgement.</span>
<a name="l00567"></a>00567 <span class="comment">     Delayed acknowledgement sent if advertisement received from</span>
<a name="l00568"></a>00568 <span class="comment">     Designated Router, otherwise do nothing */</span>
<a name="l00569"></a>00569   <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a8132d817aaf58410ccfdc18a20020ce1">flag</a>, <a class="code" href="ospf6__lsa_8h.html#a7296323566ea7398a6c31babdaa6f45c">OSPF6_LSA_DUPLICATE</a>) &amp;&amp;
<a name="l00570"></a>00570       <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a8132d817aaf58410ccfdc18a20020ce1">flag</a>, <a class="code" href="ospf6__lsa_8h.html#a842647baa54335f1a394d031f824becc">OSPF6_LSA_IMPLIEDACK</a>))
<a name="l00571"></a>00571     {
<a name="l00572"></a>00572       <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#a5e0184b714337299cd1fa5ae9cc87eb0">drouter</a> == from-&gt;<a class="code" href="structospf6__neighbor.html#ac7e3045fcc29c1083d1b638fd64e07e0">router_id</a>)
<a name="l00573"></a>00573         {
<a name="l00574"></a>00574           <span class="keywordflow">if</span> (is_debug)
<a name="l00575"></a>00575             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Delayed acknowledgement (BDR &amp; Duplicate &amp; ImpliedAck &amp; from DR)&quot;</span>);
<a name="l00576"></a>00576           <span class="comment">/* Delayed acknowledgement */</span>
<a name="l00577"></a>00577           <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (<a class="code" href="ospf6__lsa_8c.html#a98dc000e578715b010159ca0c5b38a07">ospf6_lsa_copy</a> (lsa), oi-&gt;<a class="code" href="structospf6__interface.html#a3a27876455af04270cf1ff5392f5ced3">lsack_list</a>);
<a name="l00578"></a>00578           <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#ac0eb96a5b6f4d1b1d63aa5c0208a7680">thread_send_lsack</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00579"></a>00579             oi-&gt;<a class="code" href="structospf6__interface.html#ac0eb96a5b6f4d1b1d63aa5c0208a7680">thread_send_lsack</a> =
<a name="l00580"></a>00580               <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a785542c289b9e000dac0b01b67630f29">ospf6_lsack_send_interface</a>, oi, 3);
<a name="l00581"></a>00581         }
<a name="l00582"></a>00582       <span class="keywordflow">else</span>
<a name="l00583"></a>00583         {
<a name="l00584"></a>00584           <span class="keywordflow">if</span> (is_debug)
<a name="l00585"></a>00585             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;No acknowledgement (BDR &amp; Duplicate &amp; ImpliedAck &amp; ! from DR)&quot;</span>);
<a name="l00586"></a>00586         }
<a name="l00587"></a>00587       <span class="keywordflow">return</span>;
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590   <span class="comment">/* LSA is a duplicate, and was not treated as an implied acknowledgement.</span>
<a name="l00591"></a>00591 <span class="comment">     Direct acknowledgement sent */</span>
<a name="l00592"></a>00592   <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a8132d817aaf58410ccfdc18a20020ce1">flag</a>, <a class="code" href="ospf6__lsa_8h.html#a7296323566ea7398a6c31babdaa6f45c">OSPF6_LSA_DUPLICATE</a>) &amp;&amp;
<a name="l00593"></a>00593       ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a8132d817aaf58410ccfdc18a20020ce1">flag</a>, <a class="code" href="ospf6__lsa_8h.html#a842647baa54335f1a394d031f824becc">OSPF6_LSA_IMPLIEDACK</a>))
<a name="l00594"></a>00594     {
<a name="l00595"></a>00595       <span class="keywordflow">if</span> (is_debug)
<a name="l00596"></a>00596         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Direct acknowledgement (BDR &amp; Duplicate)&quot;</span>);
<a name="l00597"></a>00597       <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (<a class="code" href="ospf6__lsa_8c.html#a98dc000e578715b010159ca0c5b38a07">ospf6_lsa_copy</a> (lsa), from-&gt;<a class="code" href="structospf6__neighbor.html#ae027726d4952b94fd753b700bd4b7dee">lsack_list</a>);
<a name="l00598"></a>00598       <span class="keywordflow">if</span> (from-&gt;<a class="code" href="structospf6__neighbor.html#a3efe4e76725c8138916061f7fbeccd0b">thread_send_lsack</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00599"></a>00599         from-&gt;<a class="code" href="structospf6__neighbor.html#a3efe4e76725c8138916061f7fbeccd0b">thread_send_lsack</a> =
<a name="l00600"></a>00600           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#abaeba7b19d1caad52e507bd228656385">ospf6_lsack_send_neighbor</a>, from, 0);
<a name="l00601"></a>00601       <span class="keywordflow">return</span>;
<a name="l00602"></a>00602     }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604   <span class="comment">/* LSA&#39;s LS age is equal to Maxage, and there is no current instance</span>
<a name="l00605"></a>00605 <span class="comment">     of the LSA in the link state database, and none of router&#39;s</span>
<a name="l00606"></a>00606 <span class="comment">     neighbors are in states Exchange or Loading */</span>
<a name="l00607"></a>00607   <span class="comment">/* Direct acknowledgement sent, but this case is handled in</span>
<a name="l00608"></a>00608 <span class="comment">     early of ospf6_receive_lsa () */</span>
<a name="l00609"></a>00609 }
<a name="l00610"></a>00610 
<a name="l00611"></a>00611 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00612"></a><a class="code" href="ospf6__flood_8c.html#aa671c81431043d4c6e09cd604be1a80c">00612</a> <a class="code" href="ospf6__flood_8c.html#aa671c81431043d4c6e09cd604be1a80c">ospf6_acknowledge_lsa_allother</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa, <span class="keywordtype">int</span> ismore_recent,
<a name="l00613"></a>00613                                 <span class="keyword">struct</span> <a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *from)
<a name="l00614"></a>00614 {
<a name="l00615"></a>00615   <span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi;
<a name="l00616"></a>00616   <span class="keywordtype">int</span> is_debug = 0;
<a name="l00617"></a>00617 
<a name="l00618"></a>00618   <span class="keywordflow">if</span> (<a class="code" href="ospf6__flood_8h.html#ad2c9fd06c28b16f3250f2bf760cb4030">IS_OSPF6_DEBUG_FLOODING</a> ||
<a name="l00619"></a>00619       <a class="code" href="ospf6__lsa_8h.html#a1f3d4f8aab1a6419a23af4d5c72e5e9d">IS_OSPF6_DEBUG_FLOOD_TYPE</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>))
<a name="l00620"></a>00620     is_debug++;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (from &amp;&amp; from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>);
<a name="l00623"></a>00623   oi = from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>;
<a name="l00624"></a>00624 
<a name="l00625"></a>00625   <span class="comment">/* LSA has been flood back out receiving interface.</span>
<a name="l00626"></a>00626 <span class="comment">     No acknowledgement sent. */</span>
<a name="l00627"></a>00627   <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a8132d817aaf58410ccfdc18a20020ce1">flag</a>, <a class="code" href="ospf6__lsa_8h.html#a6bb5201a45192e2df9a70c3424ee8b24">OSPF6_LSA_FLOODBACK</a>))
<a name="l00628"></a>00628     {
<a name="l00629"></a>00629       <span class="keywordflow">if</span> (is_debug)
<a name="l00630"></a>00630         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;No acknowledgement (AllOther &amp; FloodBack)&quot;</span>);
<a name="l00631"></a>00631       <span class="keywordflow">return</span>;
<a name="l00632"></a>00632     }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634   <span class="comment">/* LSA is more recent than database copy, but was not flooded</span>
<a name="l00635"></a>00635 <span class="comment">     back out receiving interface. Delayed acknowledgement sent. */</span>
<a name="l00636"></a>00636   <span class="keywordflow">if</span> (ismore_recent &lt; 0)
<a name="l00637"></a>00637     {
<a name="l00638"></a>00638       <span class="keywordflow">if</span> (is_debug)
<a name="l00639"></a>00639         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Delayed acknowledgement (AllOther &amp; MoreRecent)&quot;</span>);
<a name="l00640"></a>00640       <span class="comment">/* Delayed acknowledgement */</span>
<a name="l00641"></a>00641       <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (<a class="code" href="ospf6__lsa_8c.html#a98dc000e578715b010159ca0c5b38a07">ospf6_lsa_copy</a> (lsa), oi-&gt;<a class="code" href="structospf6__interface.html#a3a27876455af04270cf1ff5392f5ced3">lsack_list</a>);
<a name="l00642"></a>00642       <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#ac0eb96a5b6f4d1b1d63aa5c0208a7680">thread_send_lsack</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00643"></a>00643         oi-&gt;<a class="code" href="structospf6__interface.html#ac0eb96a5b6f4d1b1d63aa5c0208a7680">thread_send_lsack</a> =
<a name="l00644"></a>00644           <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a785542c289b9e000dac0b01b67630f29">ospf6_lsack_send_interface</a>, oi, 3);
<a name="l00645"></a>00645       <span class="keywordflow">return</span>;
<a name="l00646"></a>00646     }
<a name="l00647"></a>00647 
<a name="l00648"></a>00648   <span class="comment">/* LSA is a duplicate, and was treated as an implied acknowledgement.</span>
<a name="l00649"></a>00649 <span class="comment">     No acknowledgement sent. */</span>
<a name="l00650"></a>00650   <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a8132d817aaf58410ccfdc18a20020ce1">flag</a>, <a class="code" href="ospf6__lsa_8h.html#a7296323566ea7398a6c31babdaa6f45c">OSPF6_LSA_DUPLICATE</a>) &amp;&amp;
<a name="l00651"></a>00651       <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a8132d817aaf58410ccfdc18a20020ce1">flag</a>, <a class="code" href="ospf6__lsa_8h.html#a842647baa54335f1a394d031f824becc">OSPF6_LSA_IMPLIEDACK</a>))
<a name="l00652"></a>00652     {
<a name="l00653"></a>00653       <span class="keywordflow">if</span> (is_debug)
<a name="l00654"></a>00654         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;No acknowledgement (AllOther &amp; Duplicate &amp; ImpliedAck)&quot;</span>);
<a name="l00655"></a>00655       <span class="keywordflow">return</span>;
<a name="l00656"></a>00656     }
<a name="l00657"></a>00657 
<a name="l00658"></a>00658   <span class="comment">/* LSA is a duplicate, and was not treated as an implied acknowledgement.</span>
<a name="l00659"></a>00659 <span class="comment">     Direct acknowledgement sent */</span>
<a name="l00660"></a>00660   <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a8132d817aaf58410ccfdc18a20020ce1">flag</a>, <a class="code" href="ospf6__lsa_8h.html#a7296323566ea7398a6c31babdaa6f45c">OSPF6_LSA_DUPLICATE</a>) &amp;&amp;
<a name="l00661"></a>00661       ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#a8132d817aaf58410ccfdc18a20020ce1">flag</a>, <a class="code" href="ospf6__lsa_8h.html#a842647baa54335f1a394d031f824becc">OSPF6_LSA_IMPLIEDACK</a>))
<a name="l00662"></a>00662     {
<a name="l00663"></a>00663       <span class="keywordflow">if</span> (is_debug)
<a name="l00664"></a>00664         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Direct acknowledgement (AllOther &amp; Duplicate)&quot;</span>);
<a name="l00665"></a>00665       <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (<a class="code" href="ospf6__lsa_8c.html#a98dc000e578715b010159ca0c5b38a07">ospf6_lsa_copy</a> (lsa), from-&gt;<a class="code" href="structospf6__neighbor.html#ae027726d4952b94fd753b700bd4b7dee">lsack_list</a>);
<a name="l00666"></a>00666       <span class="keywordflow">if</span> (from-&gt;<a class="code" href="structospf6__neighbor.html#a3efe4e76725c8138916061f7fbeccd0b">thread_send_lsack</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00667"></a>00667         from-&gt;<a class="code" href="structospf6__neighbor.html#a3efe4e76725c8138916061f7fbeccd0b">thread_send_lsack</a> =
<a name="l00668"></a>00668           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#abaeba7b19d1caad52e507bd228656385">ospf6_lsack_send_neighbor</a>, from, 0);
<a name="l00669"></a>00669       <span class="keywordflow">return</span>;
<a name="l00670"></a>00670     }
<a name="l00671"></a>00671 
<a name="l00672"></a>00672   <span class="comment">/* LSA&#39;s LS age is equal to Maxage, and there is no current instance</span>
<a name="l00673"></a>00673 <span class="comment">     of the LSA in the link state database, and none of router&#39;s</span>
<a name="l00674"></a>00674 <span class="comment">     neighbors are in states Exchange or Loading */</span>
<a name="l00675"></a>00675   <span class="comment">/* Direct acknowledgement sent, but this case is handled in</span>
<a name="l00676"></a>00676 <span class="comment">     early of ospf6_receive_lsa () */</span>
<a name="l00677"></a>00677 }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00680"></a><a class="code" href="ospf6__flood_8c.html#a98033432ac67097bcf4c1701a5ed2515">00680</a> <a class="code" href="ospf6__flood_8c.html#a98033432ac67097bcf4c1701a5ed2515">ospf6_acknowledge_lsa</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa, <span class="keywordtype">int</span> ismore_recent,
<a name="l00681"></a>00681                        <span class="keyword">struct</span> <a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *from)
<a name="l00682"></a>00682 {
<a name="l00683"></a>00683   <span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi;
<a name="l00684"></a>00684 
<a name="l00685"></a>00685   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (from &amp;&amp; from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>);
<a name="l00686"></a>00686   oi = from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>;
<a name="l00687"></a>00687 
<a name="l00688"></a>00688   <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf6__interface.html#aafdfe7c67c1ff540201718b688e0a15b">state</a> == <a class="code" href="ospf6__interface_8h.html#ad0b8da8f1b2db8ec33b43b223b114d51">OSPF6_INTERFACE_BDR</a>)
<a name="l00689"></a>00689     <a class="code" href="ospf6__flood_8c.html#ac3c08bc483cd2a62d10f9e5263152cbe">ospf6_acknowledge_lsa_bdrouter</a> (lsa, ismore_recent, from);
<a name="l00690"></a>00690   <span class="keywordflow">else</span>
<a name="l00691"></a>00691     <a class="code" href="ospf6__flood_8c.html#aa671c81431043d4c6e09cd604be1a80c">ospf6_acknowledge_lsa_allother</a> (lsa, ismore_recent, from);
<a name="l00692"></a>00692 }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694 <span class="comment">/* RFC2328 section 13 (4):</span>
<a name="l00695"></a>00695 <span class="comment">   if MaxAge LSA and if we have no instance, and no neighbor</span>
<a name="l00696"></a>00696 <span class="comment">   is in states Exchange or Loading</span>
<a name="l00697"></a>00697 <span class="comment">   returns 1 if match this case, else returns 0 */</span>
<a name="l00698"></a>00698 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00699"></a><a class="code" href="ospf6__flood_8c.html#a477c17a44d4648a12e3b0c6331c6f289">00699</a> <a class="code" href="ospf6__flood_8c.html#a477c17a44d4648a12e3b0c6331c6f289">ospf6_is_maxage_lsa_drop</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *lsa, <span class="keyword">struct</span> <a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *from)
<a name="l00700"></a>00700 {
<a name="l00701"></a>00701   <span class="keyword">struct </span><a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *on;
<a name="l00702"></a>00702   <span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi;
<a name="l00703"></a>00703   <span class="keyword">struct </span><a class="code" href="structospf6__area.html">ospf6_area</a> *oa;
<a name="l00704"></a>00704   <span class="keyword">struct </span><a class="code" href="structospf6.html">ospf6</a> *process = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00705"></a>00705   <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *<a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>, *<a class="code" href="spgrid_8c.html#a7113d77fc628f14d4e7d1262969c613e">j</a>, *<a class="code" href="spgrid_8c.html#a166d56cfd4c4c4d27db0bd3cd0fe81d9">k</a>;
<a name="l00706"></a>00706   <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a66e3fedede6aa372e5196e55e5e8d5c1">count</a> = 0;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708   <span class="keywordflow">if</span> (! <a class="code" href="ospf6__lsa_8h.html#acde3ad184b10ca14f3eef7b2ab655ce6">OSPF6_LSA_IS_MAXAGE</a> (lsa))
<a name="l00709"></a>00709     <span class="keywordflow">return</span> 0;
<a name="l00710"></a>00710 
<a name="l00711"></a>00711   <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#adadc5d3ed71f1b07f56b7692454d2e08">type</a>, lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a663d9c2afc1cdc7a124a2c9d1199e394">id</a>,
<a name="l00712"></a>00712                          lsa-&gt;<a class="code" href="structospf6__lsa.html#ad53bee4fa68445da0f4c82b4b0b81f1c">header</a>-&gt;<a class="code" href="structospf6__lsa__header.html#a756706ceafd6ffab88f8ee481fcc3619">adv_router</a>, lsa-&gt;<a class="code" href="structospf6__lsa.html#a95ec15977abee01addcefa9b91748bf3">lsdb</a>))
<a name="l00713"></a>00713     <span class="keywordflow">return</span> 0;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715   process = from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a86562db489ba46500cda50f4fa646c69">ospf6</a>;
<a name="l00716"></a>00716 
<a name="l00717"></a>00717   <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (process-&gt;<a class="code" href="structospf6.html#a6a8e756959f407c36b123ffc040fbe96">area_list</a>, i, oa))
<a name="l00718"></a>00718     <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (oa-&gt;<a class="code" href="structospf6__area.html#ab06f65e38225287ac3fb4c67cf9dfdcd">if_list</a>, j, oi))
<a name="l00719"></a>00719       <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (oi-&gt;<a class="code" href="structospf6__interface.html#ada404f0a64a2f3783445fdf2c2dccf6d">neighbor_list</a>, k, on))
<a name="l00720"></a>00720         <span class="keywordflow">if</span> (on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> == <a class="code" href="ospf6__neighbor_8h.html#afa0419c15460d1d703d2b3cfa7859984">OSPF6_NEIGHBOR_EXCHANGE</a> ||
<a name="l00721"></a>00721             on-&gt;<a class="code" href="structospf6__neighbor.html#a4c749b4db801c300f6b11b0340a37600">state</a> == <a class="code" href="ospf6__neighbor_8h.html#aa50b6edd6d1268220ae4e13b2fef14e8">OSPF6_NEIGHBOR_LOADING</a>)
<a name="l00722"></a>00722           count++;
<a name="l00723"></a>00723 
<a name="l00724"></a>00724   <span class="keywordflow">if</span> (count == 0)
<a name="l00725"></a>00725     <span class="keywordflow">return</span> 1;
<a name="l00726"></a>00726   <span class="keywordflow">return</span> 0;
<a name="l00727"></a>00727 }
<a name="l00728"></a>00728 
<a name="l00729"></a>00729 <span class="comment">/* RFC2328 section 13 The Flooding Procedure */</span>
<a name="l00730"></a>00730 <span class="keywordtype">void</span>
<a name="l00731"></a><a class="code" href="ospf6__flood_8h.html#a2cb8cc3748f115868ae8cb8a51e1029a">00731</a> <a class="code" href="ospf6__flood_8c.html#a79be22d7f281fba1e60f53c49752bcb9">ospf6_receive_lsa</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__neighbor.html">ospf6_neighbor</a> *from,
<a name="l00732"></a>00732                    <span class="keyword">struct</span> <a class="code" href="structospf6__lsa__header.html">ospf6_lsa_header</a> *<a class="code" href="structlsa__header.html">lsa_header</a>)
<a name="l00733"></a>00733 {
<a name="l00734"></a>00734   <span class="keyword">struct </span><a class="code" href="structospf6__lsa.html">ospf6_lsa</a> *<span class="keyword">new</span> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *old = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *rem = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00735"></a>00735   <span class="keywordtype">int</span> ismore_recent;
<a name="l00736"></a>00736   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cksum;
<a name="l00737"></a>00737   <span class="keywordtype">int</span> is_debug = 0;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739   ismore_recent = 1;
<a name="l00740"></a>00740   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (from);
<a name="l00741"></a>00741 
<a name="l00742"></a>00742   <span class="comment">/* make lsa structure for received lsa */</span>
<a name="l00743"></a>00743   <span class="keyword">new</span> = <a class="code" href="ospf6__lsa_8c.html#ab8a6a2c7b84b7e0c48eb7be6a3a0cf9c">ospf6_lsa_create</a> (lsa_header);
<a name="l00744"></a>00744 
<a name="l00745"></a>00745   <span class="keywordflow">if</span> (<a class="code" href="ospf6__flood_8h.html#ad2c9fd06c28b16f3250f2bf760cb4030">IS_OSPF6_DEBUG_FLOODING</a> ||
<a name="l00746"></a>00746       <a class="code" href="ospf6__lsa_8h.html#a1f3d4f8aab1a6419a23af4d5c72e5e9d">IS_OSPF6_DEBUG_FLOOD_TYPE</a> (new-&gt;header-&gt;type))
<a name="l00747"></a>00747     {
<a name="l00748"></a>00748       is_debug++;
<a name="l00749"></a>00749       <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;LSA Receive from %s&quot;</span>, from-&gt;<a class="code" href="structospf6__neighbor.html#aa0ccec2f7b9c56628ce2e4a0bc37d463">name</a>);
<a name="l00750"></a>00750       <a class="code" href="ospf6__lsa_8c.html#a6f102ec07a6a8c18ae5567b1fab4e845">ospf6_lsa_header_print</a> (<span class="keyword">new</span>);
<a name="l00751"></a>00751     }
<a name="l00752"></a>00752 
<a name="l00753"></a>00753   <span class="comment">/* (1) LSA Checksum */</span>
<a name="l00754"></a>00754   cksum = ntohs (new-&gt;header-&gt;checksum);
<a name="l00755"></a>00755   <span class="keywordflow">if</span> (ntohs (<a class="code" href="ospf6__lsa_8c.html#a033e364d9b61664964b29893c5070c0d">ospf6_lsa_checksum</a> (new-&gt;header)) != cksum)
<a name="l00756"></a>00756     {
<a name="l00757"></a>00757       <span class="keywordflow">if</span> (is_debug)
<a name="l00758"></a>00758         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Wrong LSA Checksum, discard&quot;</span>);
<a name="l00759"></a>00759       <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (<span class="keyword">new</span>);
<a name="l00760"></a>00760       <span class="keywordflow">return</span>;
<a name="l00761"></a>00761     }
<a name="l00762"></a>00762 
<a name="l00763"></a>00763   <span class="comment">/* (2) Examine the LSA&#39;s LS type. </span>
<a name="l00764"></a>00764 <span class="comment">     RFC2470 3.5.1. Receiving Link State Update packets  */</span>
<a name="l00765"></a>00765   <span class="keywordflow">if</span> (<a class="code" href="ospf6__area_8h.html#af08848f9c3f603caf4af634755a5f3c4">IS_AREA_STUB</a> (from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>) &amp;&amp;
<a name="l00766"></a>00766       <a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (new-&gt;header-&gt;type) == <a class="code" href="ospf6__lsa_8h.html#a0701d1d9c961cfb8d6da273382ea508a">OSPF6_SCOPE_AS</a>)
<a name="l00767"></a>00767     {
<a name="l00768"></a>00768       <span class="keywordflow">if</span> (is_debug)
<a name="l00769"></a>00769         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;AS-External-LSA (or AS-scope LSA) in stub area, discard&quot;</span>);
<a name="l00770"></a>00770       <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (<span class="keyword">new</span>);
<a name="l00771"></a>00771       <span class="keywordflow">return</span>;
<a name="l00772"></a>00772     }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774   <span class="comment">/* (3) LSA which have reserved scope is discarded</span>
<a name="l00775"></a>00775 <span class="comment">     RFC2470 3.5.1. Receiving Link State Update packets  */</span>
<a name="l00776"></a>00776   <span class="comment">/* Flooding scope check. LSAs with unknown scope are discarded here.</span>
<a name="l00777"></a>00777 <span class="comment">     Set appropriate LSDB for the LSA */</span>
<a name="l00778"></a>00778   <span class="keywordflow">switch</span> (<a class="code" href="ospf6__lsa_8h.html#a2d9f0d76bb67a578675e6b78bf69604d">OSPF6_LSA_SCOPE</a> (new-&gt;header-&gt;type))
<a name="l00779"></a>00779     {
<a name="l00780"></a>00780     <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#ab41aaca88cc27f951f7dbf46b5a6fb5c">OSPF6_SCOPE_LINKLOCAL</a>:
<a name="l00781"></a>00781       <span class="keyword">new</span>-&gt;lsdb = from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#ab033cb877fe417705f424d1bd2f411de">lsdb</a>;
<a name="l00782"></a>00782       <span class="keywordflow">break</span>;
<a name="l00783"></a>00783     <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0634f2bb73a043f5782d28e4e3a1ad95">OSPF6_SCOPE_AREA</a>:
<a name="l00784"></a>00784       <span class="keyword">new</span>-&gt;lsdb = from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a9e658e62c2d59151531bc03b95b600bb">lsdb</a>;
<a name="l00785"></a>00785       <span class="keywordflow">break</span>;
<a name="l00786"></a>00786     <span class="keywordflow">case</span> <a class="code" href="ospf6__lsa_8h.html#a0701d1d9c961cfb8d6da273382ea508a">OSPF6_SCOPE_AS</a>:
<a name="l00787"></a>00787       <span class="keyword">new</span>-&gt;lsdb = from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a86562db489ba46500cda50f4fa646c69">ospf6</a>-&gt;<a class="code" href="structospf6.html#ac8cf84e34e8461f5aea2737fc2bf8fcb">lsdb</a>;
<a name="l00788"></a>00788       <span class="keywordflow">break</span>;
<a name="l00789"></a>00789     <span class="keywordflow">default</span>:
<a name="l00790"></a>00790       <span class="keywordflow">if</span> (is_debug)
<a name="l00791"></a>00791         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;LSA has reserved scope, discard&quot;</span>);
<a name="l00792"></a>00792       <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (<span class="keyword">new</span>);
<a name="l00793"></a>00793       <span class="keywordflow">return</span>;
<a name="l00794"></a>00794     }
<a name="l00795"></a>00795 
<a name="l00796"></a>00796   <span class="comment">/* (4) if MaxAge LSA and if we have no instance, and no neighbor</span>
<a name="l00797"></a>00797 <span class="comment">         is in states Exchange or Loading */</span>
<a name="l00798"></a>00798   <span class="keywordflow">if</span> (<a class="code" href="ospf6__flood_8c.html#a477c17a44d4648a12e3b0c6331c6f289">ospf6_is_maxage_lsa_drop</a> (<span class="keyword">new</span>, from))
<a name="l00799"></a>00799     {
<a name="l00800"></a>00800       <span class="comment">/* log */</span>
<a name="l00801"></a>00801       <span class="keywordflow">if</span> (is_debug)
<a name="l00802"></a>00802         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Drop MaxAge LSA with direct acknowledgement.&quot;</span>);
<a name="l00803"></a>00803 
<a name="l00804"></a>00804       <span class="comment">/* a) Acknowledge back to neighbor (Direct acknowledgement, 13.5) */</span>
<a name="l00805"></a>00805       <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (<a class="code" href="ospf6__lsa_8c.html#a98dc000e578715b010159ca0c5b38a07">ospf6_lsa_copy</a> (<span class="keyword">new</span>), from-&gt;<a class="code" href="structospf6__neighbor.html#ae027726d4952b94fd753b700bd4b7dee">lsack_list</a>);
<a name="l00806"></a>00806       <span class="keywordflow">if</span> (from-&gt;<a class="code" href="structospf6__neighbor.html#a3efe4e76725c8138916061f7fbeccd0b">thread_send_lsack</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00807"></a>00807         from-&gt;<a class="code" href="structospf6__neighbor.html#a3efe4e76725c8138916061f7fbeccd0b">thread_send_lsack</a> =
<a name="l00808"></a>00808           <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#abaeba7b19d1caad52e507bd228656385">ospf6_lsack_send_neighbor</a>, from, 0);
<a name="l00809"></a>00809 
<a name="l00810"></a>00810       <span class="comment">/* b) Discard */</span>
<a name="l00811"></a>00811       <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (<span class="keyword">new</span>);
<a name="l00812"></a>00812       <span class="keywordflow">return</span>;
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815   <span class="comment">/* (5) */</span>
<a name="l00816"></a>00816   <span class="comment">/* lookup the same database copy in lsdb */</span>
<a name="l00817"></a>00817   old = <a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (new-&gt;header-&gt;type, new-&gt;header-&gt;id,
<a name="l00818"></a>00818                            new-&gt;header-&gt;adv_router, new-&gt;lsdb);
<a name="l00819"></a>00819   <span class="keywordflow">if</span> (old)
<a name="l00820"></a>00820     {
<a name="l00821"></a>00821       ismore_recent = <a class="code" href="ospf6__lsa_8c.html#af1665de6eac6dab108363c1bf6320c69">ospf6_lsa_compare</a> (<span class="keyword">new</span>, old);
<a name="l00822"></a>00822       <span class="keywordflow">if</span> (ntohl (new-&gt;header-&gt;seqnum) == ntohl (old-&gt;header-&gt;seqnum))
<a name="l00823"></a>00823         {
<a name="l00824"></a>00824           <span class="keywordflow">if</span> (is_debug)
<a name="l00825"></a>00825             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Received is duplicated LSA&quot;</span>);
<a name="l00826"></a>00826           <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (new-&gt;flag, <a class="code" href="ospf6__lsa_8h.html#a7296323566ea7398a6c31babdaa6f45c">OSPF6_LSA_DUPLICATE</a>);
<a name="l00827"></a>00827         }
<a name="l00828"></a>00828     }
<a name="l00829"></a>00829 
<a name="l00830"></a>00830   <span class="comment">/* if no database copy or received is more recent */</span>
<a name="l00831"></a>00831   <span class="keywordflow">if</span> (old == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || ismore_recent &lt; 0)
<a name="l00832"></a>00832     {
<a name="l00833"></a>00833       <span class="comment">/* in case we have no database copy */</span>
<a name="l00834"></a>00834       ismore_recent = -1;
<a name="l00835"></a>00835 
<a name="l00836"></a>00836       <span class="comment">/* (a) MinLSArrival check */</span>
<a name="l00837"></a>00837       <span class="keywordflow">if</span> (old)
<a name="l00838"></a>00838         {
<a name="l00839"></a>00839           <span class="keyword">struct </span>timeval now, res;
<a name="l00840"></a>00840           <a class="code" href="thread_8c.html#abf5861abe71d6f9a1ddd493be0218de1">quagga_gettime</a> (<a class="code" href="thread_8h.html#a64fff521e88ba8b01645c5bb89085b33a7f92aaa461f13c163b13f96085eb3cd9">QUAGGA_CLK_MONOTONIC</a>, &amp;now);
<a name="l00841"></a>00841           <a class="code" href="ospf6d_8h.html#ad8549d8029286e53812f5d1aab4439e5">timersub</a> (&amp;now, &amp;old-&gt;installed, &amp;res);
<a name="l00842"></a>00842           <span class="keywordflow">if</span> (res.tv_sec &lt; <a class="code" href="ospf6__proto_8h.html#abb6f097624398b6ea06b773ef7808e04">MIN_LS_ARRIVAL</a>)
<a name="l00843"></a>00843             {
<a name="l00844"></a>00844               <span class="keywordflow">if</span> (is_debug)
<a name="l00845"></a>00845                 <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;LSA can&#39;t be updated within MinLSArrival, discard&quot;</span>);
<a name="l00846"></a>00846               <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (<span class="keyword">new</span>);
<a name="l00847"></a>00847               <span class="keywordflow">return</span>;   <span class="comment">/* examin next lsa */</span>
<a name="l00848"></a>00848             }
<a name="l00849"></a>00849         }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851       <a class="code" href="thread_8c.html#abf5861abe71d6f9a1ddd493be0218de1">quagga_gettime</a> (<a class="code" href="thread_8h.html#a64fff521e88ba8b01645c5bb89085b33a7f92aaa461f13c163b13f96085eb3cd9">QUAGGA_CLK_MONOTONIC</a>, &amp;new-&gt;received);
<a name="l00852"></a>00852 
<a name="l00853"></a>00853       <span class="keywordflow">if</span> (is_debug)
<a name="l00854"></a>00854         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Flood, Install, Possibly acknowledge the received LSA&quot;</span>);
<a name="l00855"></a>00855 
<a name="l00856"></a>00856       <span class="comment">/* (b) immediately flood and (c) remove from all retrans-list */</span>
<a name="l00857"></a>00857       <span class="comment">/* Prevent self-originated LSA to be flooded. this is to make</span>
<a name="l00858"></a>00858 <span class="comment">      reoriginated instance of the LSA not to be rejected by other routers</span>
<a name="l00859"></a>00859 <span class="comment">      due to MinLSArrival. */</span>
<a name="l00860"></a>00860       <span class="keywordflow">if</span> (new-&gt;header-&gt;adv_router != from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a86562db489ba46500cda50f4fa646c69">ospf6</a>-&gt;<a class="code" href="structospf6.html#a4dc92a648ae2190f7cf5b383c475d2aa">router_id</a>)
<a name="l00861"></a>00861         <a class="code" href="ospf6__flood_8c.html#a075f0016b6d4205102b23b32b79b7da3">ospf6_flood</a> (from, <span class="keyword">new</span>);
<a name="l00862"></a>00862 
<a name="l00863"></a>00863       <span class="comment">/* (c) Remove the current database copy from all neighbors&#39; Link</span>
<a name="l00864"></a>00864 <span class="comment">             state retransmission lists. */</span>
<a name="l00865"></a>00865       <span class="comment">/* XXX, flood_clear ? */</span>
<a name="l00866"></a>00866 
<a name="l00867"></a>00867       <span class="comment">/* (d), installing lsdb, which may cause routing</span>
<a name="l00868"></a>00868 <span class="comment">              table calculation (replacing database copy) */</span>
<a name="l00869"></a>00869       <a class="code" href="ospf6__flood_8c.html#abb7a5d2b0b4d7595d4fadbf9725ac45f">ospf6_install_lsa</a> (<span class="keyword">new</span>);
<a name="l00870"></a>00870 
<a name="l00871"></a>00871       <span class="comment">/* (e) possibly acknowledge */</span>
<a name="l00872"></a>00872       <a class="code" href="ospf6__flood_8c.html#a98033432ac67097bcf4c1701a5ed2515">ospf6_acknowledge_lsa</a> (<span class="keyword">new</span>, ismore_recent, from);
<a name="l00873"></a>00873 
<a name="l00874"></a>00874       <span class="comment">/* (f) Self Originated LSA, section 13.4 */</span>
<a name="l00875"></a>00875       <span class="keywordflow">if</span> (new-&gt;header-&gt;adv_router == from-&gt;<a class="code" href="structospf6__neighbor.html#af9f1a59e8aba26ea269d4423980af20b">ospf6_if</a>-&gt;<a class="code" href="structospf6__interface.html#a4f6cfeea2ecb9f163edd02b78f79294d">area</a>-&gt;<a class="code" href="structospf6__area.html#a86562db489ba46500cda50f4fa646c69">ospf6</a>-&gt;<a class="code" href="structospf6.html#a4dc92a648ae2190f7cf5b383c475d2aa">router_id</a>)
<a name="l00876"></a>00876         {
<a name="l00877"></a>00877           <span class="comment">/* Self-originated LSA (newer than ours) is received from</span>
<a name="l00878"></a>00878 <span class="comment">             another router. We have to make a new instance of the LSA</span>
<a name="l00879"></a>00879 <span class="comment">             or have to flush this LSA. */</span>
<a name="l00880"></a>00880           <span class="keywordflow">if</span> (is_debug)
<a name="l00881"></a>00881             {
<a name="l00882"></a>00882               <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Newer instance of the self-originated LSA&quot;</span>);
<a name="l00883"></a>00883               <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Schedule reorigination&quot;</span>);
<a name="l00884"></a>00884             }
<a name="l00885"></a>00885           <span class="keyword">new</span>-&gt;refresh = <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__lsa_8c.html#a370c05db1f992a6e7f8657ad937f3a5f">ospf6_lsa_refresh</a>, <span class="keyword">new</span>, 0);
<a name="l00886"></a>00886         }
<a name="l00887"></a>00887 
<a name="l00888"></a>00888       <span class="keywordflow">return</span>;
<a name="l00889"></a>00889     }
<a name="l00890"></a>00890 
<a name="l00891"></a>00891   <span class="comment">/* (6) if there is instance on sending neighbor&#39;s request list */</span>
<a name="l00892"></a>00892   <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (new-&gt;header-&gt;type, new-&gt;header-&gt;id,
<a name="l00893"></a>00893                          new-&gt;header-&gt;adv_router, from-&gt;<a class="code" href="structospf6__neighbor.html#a1e0692790f663381e86374ed0e829f95">request_list</a>))
<a name="l00894"></a>00894     {
<a name="l00895"></a>00895       <span class="comment">/* if no database copy, should go above state (5) */</span>
<a name="l00896"></a>00896       <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (old);
<a name="l00897"></a>00897 
<a name="l00898"></a>00898       <span class="keywordflow">if</span> (is_debug)
<a name="l00899"></a>00899         {
<a name="l00900"></a>00900           <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Received is not newer, on the neighbor&#39;s request-list&quot;</span>);
<a name="l00901"></a>00901           <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;BadLSReq, discard the received LSA&quot;</span>);
<a name="l00902"></a>00902         }
<a name="l00903"></a>00903 
<a name="l00904"></a>00904       <span class="comment">/* BadLSReq */</span>
<a name="l00905"></a>00905       <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__neighbor_8c.html#ab25760cef92f7e894cdcf23ecad3833f">bad_lsreq</a>, from, 0);
<a name="l00906"></a>00906 
<a name="l00907"></a>00907       <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (<span class="keyword">new</span>);
<a name="l00908"></a>00908       <span class="keywordflow">return</span>;
<a name="l00909"></a>00909     }
<a name="l00910"></a>00910 
<a name="l00911"></a>00911   <span class="comment">/* (7) if neither one is more recent */</span>
<a name="l00912"></a>00912   <span class="keywordflow">if</span> (ismore_recent == 0)
<a name="l00913"></a>00913     {
<a name="l00914"></a>00914       <span class="keywordflow">if</span> (is_debug)
<a name="l00915"></a>00915         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;The same instance as database copy (neither recent)&quot;</span>);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917       <span class="comment">/* (a) if on retrans-list, Treat this LSA as an Ack: Implied Ack */</span>
<a name="l00918"></a>00918       rem = <a class="code" href="ospf6__lsdb_8c.html#aa49ea0d4a8edbec90f266bf3a541a421">ospf6_lsdb_lookup</a> (new-&gt;header-&gt;type, new-&gt;header-&gt;id,
<a name="l00919"></a>00919                                new-&gt;header-&gt;adv_router, from-&gt;<a class="code" href="structospf6__neighbor.html#a6e96ad2f82d2741e769bc179d35e583f">retrans_list</a>);
<a name="l00920"></a>00920       <span class="keywordflow">if</span> (rem)
<a name="l00921"></a>00921         {
<a name="l00922"></a>00922           <span class="keywordflow">if</span> (is_debug)
<a name="l00923"></a>00923             {
<a name="l00924"></a>00924               <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;It is on the neighbor&#39;s retrans-list.&quot;</span>);
<a name="l00925"></a>00925               <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Treat as an Implied acknowledgement&quot;</span>);
<a name="l00926"></a>00926             }
<a name="l00927"></a>00927           <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (new-&gt;flag, <a class="code" href="ospf6__lsa_8h.html#a842647baa54335f1a394d031f824becc">OSPF6_LSA_IMPLIEDACK</a>);
<a name="l00928"></a>00928           <a class="code" href="ospf6__flood_8c.html#a6bee3a2ba460b276a55915e4f96dae62">ospf6_decrement_retrans_count</a> (rem);
<a name="l00929"></a>00929           <a class="code" href="ospf6__lsdb_8c.html#a57848d384aafd619bd84c654fb9ed146">ospf6_lsdb_remove</a> (rem, from-&gt;<a class="code" href="structospf6__neighbor.html#a6e96ad2f82d2741e769bc179d35e583f">retrans_list</a>);
<a name="l00930"></a>00930         }
<a name="l00931"></a>00931 
<a name="l00932"></a>00932       <span class="keywordflow">if</span> (is_debug)
<a name="l00933"></a>00933         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Possibly acknowledge and then discard&quot;</span>);
<a name="l00934"></a>00934 
<a name="l00935"></a>00935       <span class="comment">/* (b) possibly acknowledge */</span>
<a name="l00936"></a>00936       <a class="code" href="ospf6__flood_8c.html#a98033432ac67097bcf4c1701a5ed2515">ospf6_acknowledge_lsa</a> (<span class="keyword">new</span>, ismore_recent, from);
<a name="l00937"></a>00937 
<a name="l00938"></a>00938       <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (<span class="keyword">new</span>);
<a name="l00939"></a>00939       <span class="keywordflow">return</span>;
<a name="l00940"></a>00940     }
<a name="l00941"></a>00941 
<a name="l00942"></a>00942   <span class="comment">/* (8) previous database copy is more recent */</span>
<a name="l00943"></a>00943     {
<a name="l00944"></a>00944       <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (old);
<a name="l00945"></a>00945 
<a name="l00946"></a>00946       <span class="comment">/* If database copy is in &#39;Seqnumber Wrapping&#39;,</span>
<a name="l00947"></a>00947 <span class="comment">         simply discard the received LSA */</span>
<a name="l00948"></a>00948       <span class="keywordflow">if</span> (<a class="code" href="ospf6__lsa_8h.html#acde3ad184b10ca14f3eef7b2ab655ce6">OSPF6_LSA_IS_MAXAGE</a> (old) &amp;&amp;
<a name="l00949"></a>00949           old-&gt;header-&gt;seqnum == htonl (<a class="code" href="ospf6__proto_8h.html#a35f49b34e56993fe20d3a21d144c16d3">MAX_SEQUENCE_NUMBER</a>))
<a name="l00950"></a>00950         {
<a name="l00951"></a>00951           <span class="keywordflow">if</span> (is_debug)
<a name="l00952"></a>00952             {
<a name="l00953"></a>00953               <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;The LSA is in Seqnumber Wrapping&quot;</span>);
<a name="l00954"></a>00954               <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;MaxAge &amp; MaxSeqNum, discard&quot;</span>);
<a name="l00955"></a>00955             }
<a name="l00956"></a>00956           <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (<span class="keyword">new</span>);
<a name="l00957"></a>00957           <span class="keywordflow">return</span>;
<a name="l00958"></a>00958         }
<a name="l00959"></a>00959 
<a name="l00960"></a>00960       <span class="comment">/* Otherwise, Send database copy of this LSA to this neighbor */</span>
<a name="l00961"></a>00961         {
<a name="l00962"></a>00962           <span class="keywordflow">if</span> (is_debug)
<a name="l00963"></a>00963             {
<a name="l00964"></a>00964               <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Database copy is more recent.&quot;</span>);
<a name="l00965"></a>00965               <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Send back directly and then discard&quot;</span>);
<a name="l00966"></a>00966             }
<a name="l00967"></a>00967 
<a name="l00968"></a>00968           <span class="comment">/* XXX, MinLSArrival check !? RFC 2328 13 (8) */</span>
<a name="l00969"></a>00969 
<a name="l00970"></a>00970           <a class="code" href="ospf6__lsdb_8c.html#a0b328a0b2493e0e549d003f50003a199">ospf6_lsdb_add</a> (<a class="code" href="ospf6__lsa_8c.html#a98dc000e578715b010159ca0c5b38a07">ospf6_lsa_copy</a> (old), from-&gt;<a class="code" href="structospf6__neighbor.html#ac3f142375bf4e9e7c8e54daed55b4ca4">lsupdate_list</a>);
<a name="l00971"></a>00971           <span class="keywordflow">if</span> (from-&gt;<a class="code" href="structospf6__neighbor.html#ac7e6540e3ce6bd90bc1603a529648a86">thread_send_lsupdate</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00972"></a>00972             from-&gt;<a class="code" href="structospf6__neighbor.html#ac7e6540e3ce6bd90bc1603a529648a86">thread_send_lsupdate</a> =
<a name="l00973"></a>00973               <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="ospf6__message_8c.html#a50608f7c51e0c039c4735781d1f66690">ospf6_lsupdate_send_neighbor</a>, from, 0);
<a name="l00974"></a>00974           <a class="code" href="ospf6__lsa_8c.html#ab0741562e3873b904b0a77c2071a690f">ospf6_lsa_delete</a> (<span class="keyword">new</span>);
<a name="l00975"></a>00975           <span class="keywordflow">return</span>;
<a name="l00976"></a>00976         }
<a name="l00977"></a>00977       <span class="keywordflow">return</span>;
<a name="l00978"></a>00978     }
<a name="l00979"></a>00979 }
<a name="l00980"></a>00980 
<a name="l00981"></a>00981 
<a name="l00982"></a><a class="code" href="ospf6__flood_8c.html#a82a2cff8798faa58bbdeb56439dd6b1f">00982</a> <a class="code" href="command_8h.html#acc29190d35966eddbcfeceed3aab6d25">DEFUN</a> (debug_ospf6_flooding,
<a name="l00983"></a>00983        debug_ospf6_flooding_cmd,
<a name="l00984"></a>00984        <span class="stringliteral">&quot;debug ospf6 flooding&quot;</span>,
<a name="l00985"></a>00985        <a class="code" href="command_8h.html#aa32f22e2cc4c90e73981459688712288">DEBUG_STR</a>
<a name="l00986"></a>00986        <a class="code" href="command_8h.html#a46e5b0a7baf38db964a69848c26aa96a">OSPF6_STR</a>
<a name="l00987"></a>00987        <span class="stringliteral">&quot;Debug OSPFv3 flooding function\n&quot;</span>
<a name="l00988"></a>00988       )
<a name="l00989"></a>00989 {
<a name="l00990"></a>00990   <a class="code" href="ospf6__flood_8h.html#aeb1a812d68734ace211eefbd27b79b51">OSPF6_DEBUG_FLOODING_ON</a> ();
<a name="l00991"></a>00991   <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l00992"></a>00992 }
<a name="l00993"></a>00993 
<a name="l00994"></a><a class="code" href="ospf6__flood_8c.html#a3e3a922415f35a162ee9d0a145682f0a">00994</a> <a class="code" href="command_8h.html#acc29190d35966eddbcfeceed3aab6d25">DEFUN</a> (no_debug_ospf6_flooding,
<a name="l00995"></a>00995        no_debug_ospf6_flooding_cmd,
<a name="l00996"></a>00996        <span class="stringliteral">&quot;no debug ospf6 flooding&quot;</span>,
<a name="l00997"></a>00997        <a class="code" href="command_8h.html#a5b14384572729c1d1b3755d1bea1f17d">NO_STR</a>
<a name="l00998"></a>00998        <a class="code" href="command_8h.html#aa32f22e2cc4c90e73981459688712288">DEBUG_STR</a>
<a name="l00999"></a>00999        <a class="code" href="command_8h.html#a46e5b0a7baf38db964a69848c26aa96a">OSPF6_STR</a>
<a name="l01000"></a>01000        <span class="stringliteral">&quot;Debug OSPFv3 flooding function\n&quot;</span>
<a name="l01001"></a>01001       )
<a name="l01002"></a>01002 {
<a name="l01003"></a>01003   <a class="code" href="ospf6__flood_8h.html#a6dad1c03a135b6e1dc16366fb09d8211">OSPF6_DEBUG_FLOODING_OFF</a> ();
<a name="l01004"></a>01004   <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l01005"></a>01005 }
<a name="l01006"></a>01006 
<a name="l01007"></a>01007 <span class="keywordtype">int</span>
<a name="l01008"></a><a class="code" href="ospf6__flood_8h.html#a623f7487e66cb1cc908126694d63e7d4">01008</a> <a class="code" href="ospf6__flood_8c.html#a623f7487e66cb1cc908126694d63e7d4">config_write_ospf6_debug_flood</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>)
<a name="l01009"></a>01009 {
<a name="l01010"></a>01010   <span class="keywordflow">if</span> (<a class="code" href="ospf6__flood_8h.html#ad2c9fd06c28b16f3250f2bf760cb4030">IS_OSPF6_DEBUG_FLOODING</a>)
<a name="l01011"></a>01011     <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;debug ospf6 flooding%s&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l01012"></a>01012   <span class="keywordflow">return</span> 0;
<a name="l01013"></a>01013 }
<a name="l01014"></a>01014 
<a name="l01015"></a>01015 <span class="keywordtype">void</span>
<a name="l01016"></a><a class="code" href="ospf6__flood_8h.html#ab7dc3fe2a560e2b23ccda7f7387a99d0">01016</a> <a class="code" href="ospf6__flood_8c.html#ab7dc3fe2a560e2b23ccda7f7387a99d0">install_element_ospf6_debug_flood</a> (<span class="keywordtype">void</span>)
<a name="l01017"></a>01017 {
<a name="l01018"></a>01018   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a8eeaebd59fec75e66abd261377c21a2d">ENABLE_NODE</a>, &amp;debug_ospf6_flooding_cmd);
<a name="l01019"></a>01019   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a8eeaebd59fec75e66abd261377c21a2d">ENABLE_NODE</a>, &amp;no_debug_ospf6_flooding_cmd);
<a name="l01020"></a>01020   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a50754044f565f7421a152eaa411eebcc">CONFIG_NODE</a>, &amp;debug_ospf6_flooding_cmd);
<a name="l01021"></a>01021   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a50754044f565f7421a152eaa411eebcc">CONFIG_NODE</a>, &amp;no_debug_ospf6_flooding_cmd);
<a name="l01022"></a>01022 }
<a name="l01023"></a>01023 
<a name="l01024"></a>01024 
<a name="l01025"></a>01025 
<a name="l01026"></a>01026 
<a name="l01027"></a>01027 
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ospf6__flood_8c.html">ospf6_flood.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:06 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
