<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: ospf6d/ospf6_route.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ospf6__route_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">ospf6d/ospf6_route.c</div>  </div>
</div>
<div class="contents">
<a href="ospf6__route_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2003 Yasuhiro Ohara</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This file is part of GNU Zebra.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * GNU Zebra is free software; you can redistribute it and/or modify it</span>
<a name="l00007"></a>00007 <span class="comment"> * under the terms of the GNU General Public License as published by the</span>
<a name="l00008"></a>00008 <span class="comment"> * Free Software Foundation; either version 2, or (at your option) any</span>
<a name="l00009"></a>00009 <span class="comment"> * later version.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * GNU Zebra is distributed in the hope that it will be useful, but</span>
<a name="l00012"></a>00012 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00014"></a>00014 <span class="comment"> * General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * along with GNU Zebra; see the file COPYING.  If not, write to the </span>
<a name="l00018"></a>00018 <span class="comment"> * Free Software Foundation, Inc., 59 Temple Place - Suite 330, </span>
<a name="l00019"></a>00019 <span class="comment"> * Boston, MA 02111-1307, USA.  </span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="zebra_8h.html">zebra.h</a>&gt;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="log_8h.html">log.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="memory_8h.html">memory.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="prefix_8h.html">prefix.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="table_8h.html">table.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="vty_8h.html">vty.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="command_8h.html">command.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="linklist_8h.html">linklist.h</a>&quot;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__proto_8h.html">ospf6_proto.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__lsa_8h.html">ospf6_lsa.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__lsdb_8h.html">ospf6_lsdb.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__route_8h.html">ospf6_route.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__top_8h.html">ospf6_top.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__area_8h.html">ospf6_area.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="ospf6__interface_8h.html">ospf6_interface.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="ospf6d_8h.html">ospf6d.h</a>&quot;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="ospf6__route_8h.html#ae87e4710056b0ee3edbcaacd44922bc5">00041</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="ospf6__route_8c.html#ae87e4710056b0ee3edbcaacd44922bc5">conf_debug_ospf6_route</a> = 0;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="keyword">static</span> <span class="keywordtype">char</span> *
<a name="l00044"></a><a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">00044</a> <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *table)
<a name="l00045"></a>00045 {
<a name="l00046"></a>00046   <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>[32];
<a name="l00047"></a>00047   <span class="keywordflow">switch</span> (table-&gt;<a class="code" href="structospf6__route__table.html#a0da44e01c335d0f6574fff0d6be70c8c">scope_type</a>)
<a name="l00048"></a>00048     {
<a name="l00049"></a>00049       <span class="keywordflow">case</span> <a class="code" href="ospf6__route_8h.html#aaacac1ab6963e4c1fb1a24cac8a6f058">OSPF6_SCOPE_TYPE_GLOBAL</a>:
<a name="l00050"></a>00050         {
<a name="l00051"></a>00051           <span class="keywordflow">switch</span> (table-&gt;<a class="code" href="structospf6__route__table.html#aeafd4caa78003db24d65c63bdae13383">table_type</a>)
<a name="l00052"></a>00052             {
<a name="l00053"></a>00053               <span class="keywordflow">case</span> <a class="code" href="ospf6__route_8h.html#a5259cb2e271efecffcd2601dcdbc0ae2">OSPF6_TABLE_TYPE_ROUTES</a>:
<a name="l00054"></a>00054                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name), <span class="stringliteral">&quot;global route table&quot;</span>);
<a name="l00055"></a>00055                 <span class="keywordflow">break</span>;
<a name="l00056"></a>00056               <span class="keywordflow">case</span> <a class="code" href="ospf6__route_8h.html#ac6c2d1de447c726976d6df958056f01e">OSPF6_TABLE_TYPE_BORDER_ROUTERS</a>:
<a name="l00057"></a>00057                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name), <span class="stringliteral">&quot;global brouter table&quot;</span>);
<a name="l00058"></a>00058                 <span class="keywordflow">break</span>;
<a name="l00059"></a>00059               <span class="keywordflow">case</span> <a class="code" href="ospf6__route_8h.html#ac743f79910e928e7958ae8a3ba8d5ed3">OSPF6_TABLE_TYPE_EXTERNAL_ROUTES</a>:
<a name="l00060"></a>00060                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name), <span class="stringliteral">&quot;global external table&quot;</span>);
<a name="l00061"></a>00061                 <span class="keywordflow">break</span>;
<a name="l00062"></a>00062               <span class="keywordflow">default</span>:
<a name="l00063"></a>00063                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name), <span class="stringliteral">&quot;global unknown table&quot;</span>);
<a name="l00064"></a>00064                 <span class="keywordflow">break</span>;
<a name="l00065"></a>00065             }
<a name="l00066"></a>00066         }
<a name="l00067"></a>00067         <span class="keywordflow">break</span>;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069       <span class="keywordflow">case</span> <a class="code" href="ospf6__route_8h.html#a2f6995d69f193eec5301b8c647336571">OSPF6_SCOPE_TYPE_AREA</a>:
<a name="l00070"></a>00070         {
<a name="l00071"></a>00071           <span class="keyword">struct </span><a class="code" href="structospf6__area.html">ospf6_area</a> *oa = (<span class="keyword">struct </span><a class="code" href="structospf6__area.html">ospf6_area</a> *) table-&gt;<a class="code" href="structospf6__route__table.html#a3268985f62aa7248ab9ee72fe88d1161">scope</a>;
<a name="l00072"></a>00072           switch (table-&gt;<a class="code" href="structospf6__route__table.html#aeafd4caa78003db24d65c63bdae13383">table_type</a>)
<a name="l00073"></a>00073             {
<a name="l00074"></a>00074               <span class="keywordflow">case</span> <a class="code" href="ospf6__route_8h.html#a5e5972074db40a90fffb4387b78fd1b2">OSPF6_TABLE_TYPE_SPF_RESULTS</a>:
<a name="l00075"></a>00075                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name),
<a name="l00076"></a>00076                           <span class="stringliteral">&quot;area %s spf table&quot;</span>, oa-&gt;<a class="code" href="structospf6__area.html#a24bd4ccc38c4e10de1b66b2d0cf885cf">name</a>);
<a name="l00077"></a>00077                 <span class="keywordflow">break</span>;
<a name="l00078"></a>00078               <span class="keywordflow">case</span> <a class="code" href="ospf6__route_8h.html#a5259cb2e271efecffcd2601dcdbc0ae2">OSPF6_TABLE_TYPE_ROUTES</a>:
<a name="l00079"></a>00079                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name),
<a name="l00080"></a>00080                           <span class="stringliteral">&quot;area %s route table&quot;</span>, oa-&gt;<a class="code" href="structospf6__area.html#a24bd4ccc38c4e10de1b66b2d0cf885cf">name</a>);
<a name="l00081"></a>00081                 <span class="keywordflow">break</span>;
<a name="l00082"></a>00082               <span class="keywordflow">case</span> <a class="code" href="ospf6__route_8h.html#a99f622e590a63abce7596b3dfe659557">OSPF6_TABLE_TYPE_PREFIX_RANGES</a>:
<a name="l00083"></a>00083                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name),
<a name="l00084"></a>00084                           <span class="stringliteral">&quot;area %s range table&quot;</span>, oa-&gt;<a class="code" href="structospf6__area.html#a24bd4ccc38c4e10de1b66b2d0cf885cf">name</a>);
<a name="l00085"></a>00085                 <span class="keywordflow">break</span>;
<a name="l00086"></a>00086               <span class="keywordflow">case</span> <a class="code" href="ospf6__route_8h.html#a4aff1855724b5f239452855f3ac4ca22">OSPF6_TABLE_TYPE_SUMMARY_PREFIXES</a>:
<a name="l00087"></a>00087                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name),
<a name="l00088"></a>00088                           <span class="stringliteral">&quot;area %s summary prefix table&quot;</span>, oa-&gt;<a class="code" href="structospf6__area.html#a24bd4ccc38c4e10de1b66b2d0cf885cf">name</a>);
<a name="l00089"></a>00089                 <span class="keywordflow">break</span>;
<a name="l00090"></a>00090               <span class="keywordflow">case</span> <a class="code" href="ospf6__route_8h.html#a4b18a9ed06660f24ed209c0d66c7c319">OSPF6_TABLE_TYPE_SUMMARY_ROUTERS</a>:
<a name="l00091"></a>00091                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name),
<a name="l00092"></a>00092                           <span class="stringliteral">&quot;area %s summary router table&quot;</span>, oa-&gt;<a class="code" href="structospf6__area.html#a24bd4ccc38c4e10de1b66b2d0cf885cf">name</a>);
<a name="l00093"></a>00093                 <span class="keywordflow">break</span>;
<a name="l00094"></a>00094               <span class="keywordflow">default</span>:
<a name="l00095"></a>00095                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name),
<a name="l00096"></a>00096                           <span class="stringliteral">&quot;area %s unknown table&quot;</span>, oa-&gt;<a class="code" href="structospf6__area.html#a24bd4ccc38c4e10de1b66b2d0cf885cf">name</a>);
<a name="l00097"></a>00097                 <span class="keywordflow">break</span>;
<a name="l00098"></a>00098             }
<a name="l00099"></a>00099         }
<a name="l00100"></a>00100         <span class="keywordflow">break</span>;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102       <span class="keywordflow">case</span> <a class="code" href="ospf6__route_8h.html#aba3861546d5e9c43c3b76cdee1cc04e6">OSPF6_SCOPE_TYPE_INTERFACE</a>:
<a name="l00103"></a>00103         {
<a name="l00104"></a>00104           <span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *oi = (<span class="keyword">struct </span><a class="code" href="structospf6__interface.html">ospf6_interface</a> *) table-&gt;<a class="code" href="structospf6__route__table.html#a3268985f62aa7248ab9ee72fe88d1161">scope</a>;
<a name="l00105"></a>00105           switch (table-&gt;<a class="code" href="structospf6__route__table.html#aeafd4caa78003db24d65c63bdae13383">table_type</a>)
<a name="l00106"></a>00106             {
<a name="l00107"></a>00107               <span class="keywordflow">case</span> <a class="code" href="ospf6__route_8h.html#ab2a6e068d4d0222c9ec79a6f1eda0d9c">OSPF6_TABLE_TYPE_CONNECTED_ROUTES</a>:
<a name="l00108"></a>00108                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name), <span class="stringliteral">&quot;interface %s connected table&quot;</span>,
<a name="l00109"></a>00109                           oi-&gt;<a class="code" href="structospf6__interface.html#ab77617d3c7c82e25b6c035d9e1856c22">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);
<a name="l00110"></a>00110                 <span class="keywordflow">break</span>;
<a name="l00111"></a>00111               <span class="keywordflow">default</span>:
<a name="l00112"></a>00112                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name), <span class="stringliteral">&quot;interface %s unknown table&quot;</span>,
<a name="l00113"></a>00113                           oi-&gt;<a class="code" href="structospf6__interface.html#ab77617d3c7c82e25b6c035d9e1856c22">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);
<a name="l00114"></a>00114                 <span class="keywordflow">break</span>;
<a name="l00115"></a>00115             }
<a name="l00116"></a>00116         }
<a name="l00117"></a>00117         <span class="keywordflow">break</span>;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119       <span class="keywordflow">default</span>:
<a name="l00120"></a>00120         {
<a name="l00121"></a>00121           <span class="keywordflow">switch</span> (table-&gt;<a class="code" href="structospf6__route__table.html#aeafd4caa78003db24d65c63bdae13383">table_type</a>)
<a name="l00122"></a>00122             {
<a name="l00123"></a>00123               <span class="keywordflow">case</span> <a class="code" href="ospf6__route_8h.html#a5e5972074db40a90fffb4387b78fd1b2">OSPF6_TABLE_TYPE_SPF_RESULTS</a>:
<a name="l00124"></a>00124                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name), <span class="stringliteral">&quot;temporary spf table&quot;</span>);
<a name="l00125"></a>00125                 <span class="keywordflow">break</span>;
<a name="l00126"></a>00126               <span class="keywordflow">default</span>:
<a name="l00127"></a>00127                 <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (name, <span class="keyword">sizeof</span> (name), <span class="stringliteral">&quot;temporary unknown table&quot;</span>);
<a name="l00128"></a>00128                 <span class="keywordflow">break</span>;
<a name="l00129"></a>00129             }
<a name="l00130"></a>00130         }
<a name="l00131"></a>00131         <span class="keywordflow">break</span>;
<a name="l00132"></a>00132     }
<a name="l00133"></a>00133   <span class="keywordflow">return</span> <a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l00134"></a>00134 }
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 <span class="keywordtype">void</span>
<a name="l00137"></a><a class="code" href="ospf6__route_8h.html#a5190b1a4d8babac390d4504e6119ffde">00137</a> <a class="code" href="ospf6__route_8c.html#a5190b1a4d8babac390d4504e6119ffde">ospf6_linkstate_prefix</a> (u_int32_t <a class="code" href="prefix_8h.html#aa4419784611184c74a36162ffcf0123d">adv_router</a>, u_int32_t <span class="keywordtype">id</span>,
<a name="l00138"></a>00138                         <span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *<a class="code" href="structprefix.html">prefix</a>)
<a name="l00139"></a>00139 {
<a name="l00140"></a>00140   memset (prefix, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> prefix));
<a name="l00141"></a>00141   prefix-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> = AF_INET6;
<a name="l00142"></a>00142   prefix-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> = 64;
<a name="l00143"></a>00143   <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;prefix-&gt;u.prefix6.s6_addr[0], &amp;adv_router, 4);
<a name="l00144"></a>00144   <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;prefix-&gt;u.prefix6.s6_addr[4], &amp;<span class="keywordtype">id</span>, 4);
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="keywordtype">void</span>
<a name="l00148"></a><a class="code" href="ospf6__route_8h.html#a6cd3c9be4769715b219b63202f5cd802">00148</a> <a class="code" href="ospf6__route_8c.html#a6cd3c9be4769715b219b63202f5cd802">ospf6_linkstate_prefix2str</a> (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *<a class="code" href="structprefix.html">prefix</a>, <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> size)
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150   u_int32_t <a class="code" href="prefix_8h.html#aa4419784611184c74a36162ffcf0123d">adv_router</a>, <a class="code" href="prefix_8h.html#a68c0ada54c6414ef00bca919465286ac">id</a>;
<a name="l00151"></a>00151   <span class="keywordtype">char</span> adv_router_str[16], id_str[16];
<a name="l00152"></a>00152   <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;adv_router, &amp;prefix-&gt;u.prefix6.s6_addr[0], 4);
<a name="l00153"></a>00153   <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;<span class="keywordtype">id</span>, &amp;prefix-&gt;u.prefix6.s6_addr[4], 4);
<a name="l00154"></a>00154   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;adv_router, adv_router_str, <span class="keyword">sizeof</span> (adv_router_str));
<a name="l00155"></a>00155   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;<span class="keywordtype">id</span>, id_str, <span class="keyword">sizeof</span> (id_str));
<a name="l00156"></a>00156   <span class="keywordflow">if</span> (ntohl (<span class="keywordtype">id</span>))
<a name="l00157"></a>00157     <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (buf, size, <span class="stringliteral">&quot;%s Net-ID: %s&quot;</span>, adv_router_str, id_str);
<a name="l00158"></a>00158   <span class="keywordflow">else</span>
<a name="l00159"></a>00159     <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (buf, size, <span class="stringliteral">&quot;%s&quot;</span>, adv_router_str);
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 <span class="comment">/* Global strings for logging */</span>
<a name="l00163"></a><a class="code" href="ospf6__route_8h.html#a82872b706da5f3f784a7e1fde0f9fb8a">00163</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ospf6__route_8c.html#a82872b706da5f3f784a7e1fde0f9fb8a">ospf6_dest_type_str</a>[<a class="code" href="ospf6__route_8h.html#aee32c5fd7672635f7d34082ad8f5c984">OSPF6_DEST_TYPE_MAX</a>] =
<a name="l00164"></a>00164 { <span class="stringliteral">&quot;Unknown&quot;</span>, <span class="stringliteral">&quot;Router&quot;</span>, <span class="stringliteral">&quot;Network&quot;</span>, <span class="stringliteral">&quot;Discard&quot;</span>, <span class="stringliteral">&quot;Linkstate&quot;</span>, <span class="stringliteral">&quot;AddressRange&quot;</span>, };
<a name="l00165"></a>00165 
<a name="l00166"></a><a class="code" href="ospf6__route_8h.html#ab4c663b82d082f51788995bfaf5cd054">00166</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ospf6__route_8c.html#ab4c663b82d082f51788995bfaf5cd054">ospf6_dest_type_substr</a>[<a class="code" href="ospf6__route_8h.html#aee32c5fd7672635f7d34082ad8f5c984">OSPF6_DEST_TYPE_MAX</a>] =
<a name="l00167"></a>00167 { <span class="stringliteral">&quot;?&quot;</span>, <span class="stringliteral">&quot;R&quot;</span>, <span class="stringliteral">&quot;N&quot;</span>, <span class="stringliteral">&quot;D&quot;</span>, <span class="stringliteral">&quot;L&quot;</span>, <span class="stringliteral">&quot;A&quot;</span>, };
<a name="l00168"></a>00168 
<a name="l00169"></a><a class="code" href="ospf6__route_8h.html#a5105e7d7332722c224b5b034c3607793">00169</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ospf6__route_8c.html#a5105e7d7332722c224b5b034c3607793">ospf6_path_type_str</a>[<a class="code" href="ospf6__route_8h.html#a58713f677df3b5e893312852a8fdba29">OSPF6_PATH_TYPE_MAX</a>] =
<a name="l00170"></a>00170 { <span class="stringliteral">&quot;Unknown&quot;</span>, <span class="stringliteral">&quot;Intra-Area&quot;</span>, <span class="stringliteral">&quot;Inter-Area&quot;</span>, <span class="stringliteral">&quot;External-1&quot;</span>, <span class="stringliteral">&quot;External-2&quot;</span>, };
<a name="l00171"></a>00171 
<a name="l00172"></a><a class="code" href="ospf6__route_8h.html#ac0671343fb5b810096fbf321eaecb39b">00172</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ospf6__route_8c.html#ac0671343fb5b810096fbf321eaecb39b">ospf6_path_type_substr</a>[<a class="code" href="ospf6__route_8h.html#a58713f677df3b5e893312852a8fdba29">OSPF6_PATH_TYPE_MAX</a>] =
<a name="l00173"></a>00173 { <span class="stringliteral">&quot;??&quot;</span>, <span class="stringliteral">&quot;IA&quot;</span>, <span class="stringliteral">&quot;IE&quot;</span>, <span class="stringliteral">&quot;E1&quot;</span>, <span class="stringliteral">&quot;E2&quot;</span>, };
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *
<a name="l00177"></a><a class="code" href="ospf6__route_8h.html#af4307729ed4bcbcb064c0a7363f3084f">00177</a> <a class="code" href="ospf6__route_8c.html#af4307729ed4bcbcb064c0a7363f3084f">ospf6_route_create</a> (<span class="keywordtype">void</span>)
<a name="l00178"></a>00178 {
<a name="l00179"></a>00179   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route;
<a name="l00180"></a>00180   route = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167bab41d86236e3a778976a0183cfe48894f">MTYPE_OSPF6_ROUTE</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a>));
<a name="l00181"></a>00181   <span class="keywordflow">return</span> route;
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="keywordtype">void</span>
<a name="l00185"></a><a class="code" href="ospf6__route_8h.html#a6a7756bce7870f5569bdb5a2ed6f533f">00185</a> <a class="code" href="ospf6__route_8c.html#afe483c6d6b442082f70587b8a137ef9c">ospf6_route_delete</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route)
<a name="l00186"></a>00186 {
<a name="l00187"></a>00187   <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167bab41d86236e3a778976a0183cfe48894f">MTYPE_OSPF6_ROUTE</a>, route);
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *
<a name="l00191"></a><a class="code" href="ospf6__route_8h.html#aa406f9a6fff899c6c153b2d208efd1a0">00191</a> <a class="code" href="ospf6__route_8c.html#aa406f9a6fff899c6c153b2d208efd1a0">ospf6_route_copy</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route)
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *<span class="keyword">new</span>;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <span class="keyword">new</span> = <a class="code" href="ospf6__route_8c.html#af4307729ed4bcbcb064c0a7363f3084f">ospf6_route_create</a> ();
<a name="l00196"></a>00196   <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (<span class="keyword">new</span>, route, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a>));
<a name="l00197"></a>00197   <span class="keyword">new</span>-&gt;rnode = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00198"></a>00198   <span class="keyword">new</span>-&gt;prev = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00199"></a>00199   <span class="keyword">new</span>-&gt;next = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00200"></a>00200   <span class="keyword">new</span>-&gt;table = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00201"></a>00201   <span class="keyword">new</span>-&gt;lock = 0;
<a name="l00202"></a>00202   <span class="keywordflow">return</span> <span class="keyword">new</span>;
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 <span class="keywordtype">void</span>
<a name="l00206"></a><a class="code" href="ospf6__route_8h.html#a0ad7c43050f40ca3637220835928c2af">00206</a> <a class="code" href="ospf6__route_8c.html#a0ad7c43050f40ca3637220835928c2af">ospf6_route_lock</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route)
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208   route-&gt;<a class="code" href="structospf6__route.html#a7c548e8e59600e136436ce9aaf378baa">lock</a>++;
<a name="l00209"></a>00209 }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211 <span class="keywordtype">void</span>
<a name="l00212"></a><a class="code" href="ospf6__route_8h.html#ae0268d845495f56740dbf46b80489b0c">00212</a> <a class="code" href="ospf6__route_8c.html#ae0268d845495f56740dbf46b80489b0c">ospf6_route_unlock</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route)
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (route-&gt;<a class="code" href="structospf6__route.html#a7c548e8e59600e136436ce9aaf378baa">lock</a> &gt; 0);
<a name="l00215"></a>00215   route-&gt;<a class="code" href="structospf6__route.html#a7c548e8e59600e136436ce9aaf378baa">lock</a>--;
<a name="l00216"></a>00216   <span class="keywordflow">if</span> (route-&gt;<a class="code" href="structospf6__route.html#a7c548e8e59600e136436ce9aaf378baa">lock</a> == 0)
<a name="l00217"></a>00217     {
<a name="l00218"></a>00218       <span class="comment">/* Can&#39;t detach from the table until here</span>
<a name="l00219"></a>00219 <span class="comment">         because ospf6_route_next () will use</span>
<a name="l00220"></a>00220 <span class="comment">         the &#39;route-&gt;table&#39; pointer for logging */</span>
<a name="l00221"></a>00221       route-&gt;<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00222"></a>00222       <a class="code" href="ospf6__route_8c.html#afe483c6d6b442082f70587b8a137ef9c">ospf6_route_delete</a> (route);
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="comment">/* Route compare function. If ra is more preferred, it returns</span>
<a name="l00227"></a>00227 <span class="comment">   less than 0. If rb is more preferred returns greater than 0.</span>
<a name="l00228"></a>00228 <span class="comment">   Otherwise (neither one is preferred), returns 0 */</span>
<a name="l00229"></a>00229 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00230"></a><a class="code" href="ospf6__route_8c.html#a02403e3544541e5a854683aa0ee88f85">00230</a> <a class="code" href="ospf6__route_8c.html#a02403e3544541e5a854683aa0ee88f85">ospf6_route_cmp</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *ra, <span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *rb)
<a name="l00231"></a>00231 {
<a name="l00232"></a>00232   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (<a class="code" href="ospf6__route_8h.html#a7133738c8b5e672f6e20d99fa76d3f90">ospf6_route_is_same</a> (ra, rb));
<a name="l00233"></a>00233   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (OSPF6_PATH_TYPE_NONE &lt; ra-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a> &amp;&amp;
<a name="l00234"></a>00234           ra-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a> &lt; <a class="code" href="ospf6__route_8h.html#a58713f677df3b5e893312852a8fdba29">OSPF6_PATH_TYPE_MAX</a>);
<a name="l00235"></a>00235   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (OSPF6_PATH_TYPE_NONE &lt; rb-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a> &amp;&amp;
<a name="l00236"></a>00236           rb-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a> &lt; <a class="code" href="ospf6__route_8h.html#a58713f677df3b5e893312852a8fdba29">OSPF6_PATH_TYPE_MAX</a>);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238   <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a> != rb-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a>)
<a name="l00239"></a>00239     <span class="keywordflow">return</span> (ra-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a> - rb-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a>);
<a name="l00240"></a>00240 
<a name="l00241"></a>00241   <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ad4fc384dbcd343e1ba3e5918e4d25c15">area_id</a> != rb-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ad4fc384dbcd343e1ba3e5918e4d25c15">area_id</a>)
<a name="l00242"></a>00242     <span class="keywordflow">return</span> (ntohl (ra-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ad4fc384dbcd343e1ba3e5918e4d25c15">area_id</a>) - ntohl (rb-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ad4fc384dbcd343e1ba3e5918e4d25c15">area_id</a>));
<a name="l00243"></a>00243 
<a name="l00244"></a>00244   <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a> != rb-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a>)
<a name="l00245"></a>00245     <span class="keywordflow">return</span> (ra-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a> - rb-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a>);
<a name="l00246"></a>00246 
<a name="l00247"></a>00247   <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a> == <a class="code" href="ospf6__route_8h.html#a753677bbce3e5b4d74252300c43e422a">OSPF6_PATH_TYPE_EXTERNAL2</a>)
<a name="l00248"></a>00248     {
<a name="l00249"></a>00249       <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#afbe458c0a581463749e46edf6ae726c3">cost_e2</a> != rb-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#afbe458c0a581463749e46edf6ae726c3">cost_e2</a>)
<a name="l00250"></a>00250         <span class="keywordflow">return</span> (ra-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#afbe458c0a581463749e46edf6ae726c3">cost_e2</a> - rb-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#afbe458c0a581463749e46edf6ae726c3">cost_e2</a>);
<a name="l00251"></a>00251     }
<a name="l00252"></a>00252   <span class="keywordflow">else</span>
<a name="l00253"></a>00253     {
<a name="l00254"></a>00254       <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ab33bf3c3ce1f07b918167dbfa4af30e6">cost</a> != rb-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ab33bf3c3ce1f07b918167dbfa4af30e6">cost</a>)
<a name="l00255"></a>00255         <span class="keywordflow">return</span> (ra-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ab33bf3c3ce1f07b918167dbfa4af30e6">cost</a> - rb-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ab33bf3c3ce1f07b918167dbfa4af30e6">cost</a>);
<a name="l00256"></a>00256     }
<a name="l00257"></a>00257 
<a name="l00258"></a>00258   <span class="keywordflow">return</span> 0;
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *
<a name="l00262"></a><a class="code" href="ospf6__route_8h.html#aa7d8f56a2e18e2dc561dfda78a980fb2">00262</a> <a class="code" href="ospf6__route_8c.html#aa7d8f56a2e18e2dc561dfda78a980fb2">ospf6_route_lookup</a> (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *<a class="code" href="structprefix.html">prefix</a>,
<a name="l00263"></a>00263                     <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l00264"></a>00264 {
<a name="l00265"></a>00265   <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *node;
<a name="l00266"></a>00266   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route;
<a name="l00267"></a>00267 
<a name="l00268"></a>00268   node = <a class="code" href="table_8c.html#ab99d86b40440c8f18d4f2b31b5b8f1c7">route_node_lookup</a> (table-&gt;<a class="code" href="structospf6__route__table.html#a2323f5dbcbf6d64f99bacb2d12c01761">table</a>, prefix);
<a name="l00269"></a>00269   <span class="keywordflow">if</span> (node == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00270"></a>00270     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272   route = (<span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *) node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>;
<a name="l00273"></a>00273   <span class="keywordflow">return</span> route;
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *
<a name="l00277"></a><a class="code" href="ospf6__route_8h.html#a350bfb8c1552479b037feb16a0d5e2b8">00277</a> <a class="code" href="ospf6__route_8c.html#a350bfb8c1552479b037feb16a0d5e2b8">ospf6_route_lookup_identical</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route,
<a name="l00278"></a>00278                               <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l00279"></a>00279 {
<a name="l00280"></a>00280   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *target;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282   <span class="keywordflow">for</span> (target = <a class="code" href="ospf6__route_8c.html#aa7d8f56a2e18e2dc561dfda78a980fb2">ospf6_route_lookup</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>, table);
<a name="l00283"></a>00283        target; target = target-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>)
<a name="l00284"></a>00284     {
<a name="l00285"></a>00285       <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a8be4fa6a36fd91902ea68d983f44ea54">ospf6_route_is_identical</a> (target, route))
<a name="l00286"></a>00286         <span class="keywordflow">return</span> target;
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288   <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *
<a name="l00292"></a><a class="code" href="ospf6__route_8h.html#ad09379fefd4d4c2cf9af55345000d9cf">00292</a> <a class="code" href="ospf6__route_8c.html#ad09379fefd4d4c2cf9af55345000d9cf">ospf6_route_lookup_bestmatch</a> (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *<a class="code" href="structprefix.html">prefix</a>,
<a name="l00293"></a>00293                               <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l00294"></a>00294 {
<a name="l00295"></a>00295   <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *node;
<a name="l00296"></a>00296   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   node = <a class="code" href="table_8c.html#a948f4335026cd8417c7424e85156ae55">route_node_match</a> (table-&gt;<a class="code" href="structospf6__route__table.html#a2323f5dbcbf6d64f99bacb2d12c01761">table</a>, prefix);
<a name="l00299"></a>00299   <span class="keywordflow">if</span> (node == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00300"></a>00300     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00301"></a>00301   <a class="code" href="table_8c.html#a849965644708e01ef49c203a2e00afd4">route_unlock_node</a> (node);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303   route = (<span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *) node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>;
<a name="l00304"></a>00304   <span class="keywordflow">return</span> route;
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 <span class="preprocessor">#ifndef NDEBUG</span>
<a name="l00308"></a>00308 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00309"></a><a class="code" href="ospf6__route_8c.html#a089a4116900915f16a3711f16c962778">00309</a> <a class="code" href="ospf6__route_8c.html#a089a4116900915f16a3711f16c962778">route_table_assert</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l00310"></a>00310 {
<a name="l00311"></a>00311   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a>, *r, *<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>;
<a name="l00312"></a>00312   <span class="keywordtype">char</span> buf[64];
<a name="l00313"></a>00313   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> link_error = 0, <a class="code" href="bgp__open_8h.html#ab4570498c4316aa5f7b4852c778b3320">num</a> = 0;
<a name="l00314"></a>00314   
<a name="l00315"></a>00315   r = <a class="code" href="ospf6__route_8c.html#a400d24a67548089d8a59242677ef33cf">ospf6_route_head</a> (table);
<a name="l00316"></a>00316   prev = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00317"></a>00317   <span class="keywordflow">while</span> (r)
<a name="l00318"></a>00318     {
<a name="l00319"></a>00319       <span class="keywordflow">if</span> (r-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a> != prev)
<a name="l00320"></a>00320         link_error++;
<a name="l00321"></a>00321       
<a name="l00322"></a>00322       next = <a class="code" href="ospf6__route_8c.html#a4cdecc41a86097a7d0871397f7a80fb8">ospf6_route_next</a> (r);
<a name="l00323"></a>00323       
<a name="l00324"></a>00324       <span class="keywordflow">if</span> (r-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a> != next)
<a name="l00325"></a>00325         link_error++;
<a name="l00326"></a>00326       
<a name="l00327"></a>00327       prev = r;
<a name="l00328"></a>00328       r = <a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>;
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330   
<a name="l00331"></a>00331   <span class="keywordflow">for</span> (r = <a class="code" href="ospf6__route_8c.html#a400d24a67548089d8a59242677ef33cf">ospf6_route_head</a> (table); r; r = <a class="code" href="ospf6__route_8c.html#a4cdecc41a86097a7d0871397f7a80fb8">ospf6_route_next</a> (r))
<a name="l00332"></a>00332     <a class="code" href="bgp__open_8h.html#ab4570498c4316aa5f7b4852c778b3320">num</a>++;
<a name="l00333"></a>00333   
<a name="l00334"></a>00334   <span class="keywordflow">if</span> (link_error == 0 &amp;&amp; <a class="code" href="bgp__open_8h.html#ab4570498c4316aa5f7b4852c778b3320">num</a> == table-&gt;<a class="code" href="structospf6__route__table.html#ac242748e782f2dbbc1f2d69ce7d9a140">count</a>)
<a name="l00335"></a>00335     <span class="keywordflow">return</span>;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;PANIC !!&quot;</span>);
<a name="l00338"></a>00338   <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;Something has gone wrong with ospf6_route_table[%p]&quot;</span>, table);
<a name="l00339"></a>00339   <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;table count = %d, real number = %d&quot;</span>, table-&gt;<a class="code" href="structospf6__route__table.html#ac242748e782f2dbbc1f2d69ce7d9a140">count</a>, <a class="code" href="bgp__open_8h.html#ab4570498c4316aa5f7b4852c778b3320">num</a>);
<a name="l00340"></a>00340   <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;DUMP START&quot;</span>);
<a name="l00341"></a>00341   <span class="keywordflow">for</span> (r = <a class="code" href="ospf6__route_8c.html#a400d24a67548089d8a59242677ef33cf">ospf6_route_head</a> (table); r; r = <a class="code" href="ospf6__route_8c.html#a4cdecc41a86097a7d0871397f7a80fb8">ospf6_route_next</a> (r))
<a name="l00342"></a>00342     {
<a name="l00343"></a>00343       <a class="code" href="prefix_8c.html#a8b848557695ae5694bd2282eba23e367">prefix2str</a> (&amp;r-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>, buf, sizeof (buf));
<a name="l00344"></a>00344       <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a> (<span class="stringliteral">&quot;%p&lt;-[%p]-&gt;%p : %s&quot;</span>, r-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a>, r, r-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>, buf);
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346   <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;DUMP END&quot;</span>);
<a name="l00347"></a>00347 
<a name="l00348"></a>00348   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (link_error == 0 &amp;&amp; <a class="code" href="bgp__open_8h.html#ab4570498c4316aa5f7b4852c778b3320">num</a> == table-&gt;<a class="code" href="structospf6__route__table.html#ac242748e782f2dbbc1f2d69ce7d9a140">count</a>);
<a name="l00349"></a>00349 }
<a name="l00350"></a><a class="code" href="ospf6__route_8c.html#a67085861a8db3e45bf5108ad14f9485d">00350</a> <span class="preprocessor">#define ospf6_route_table_assert(t) (route_table_assert (t))</span>
<a name="l00351"></a>00351 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00352"></a>00352 <span class="preprocessor"></span><span class="preprocessor">#define ospf6_route_table_assert(t) ((void) 0)</span>
<a name="l00353"></a>00353 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/*NDEBUG*/</span>
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *
<a name="l00356"></a><a class="code" href="ospf6__route_8h.html#ab35c4efbc72f9bf772e334f1725da353">00356</a> <a class="code" href="ospf6__route_8c.html#ab35c4efbc72f9bf772e334f1725da353">ospf6_route_add</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route,
<a name="l00357"></a>00357                  <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l00358"></a>00358 {
<a name="l00359"></a>00359   <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *node, *<a class="code" href="linklist_8h.html#a55fb4579b486236096a9ead8ece51bad">nextnode</a>, *prevnode;
<a name="l00360"></a>00360   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *current = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00361"></a>00361   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *old = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00362"></a>00362   <span class="keywordtype">char</span> buf[64];
<a name="l00363"></a>00363   <span class="keyword">struct </span>timeval now;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (route-&gt;<a class="code" href="structospf6__route.html#a400b25094c113ad6cca921b696b77f8b">rnode</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00366"></a>00366   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (route-&gt;<a class="code" href="structospf6__route.html#a7c548e8e59600e136436ce9aaf378baa">lock</a> == 0);
<a name="l00367"></a>00367   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00368"></a>00368   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (route-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00369"></a>00369 
<a name="l00370"></a>00370   <span class="keywordflow">if</span> (route-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a> == <a class="code" href="ospf6__route_8h.html#aa7dc51fbd11971c3f8dff933ea524492">OSPF6_DEST_TYPE_LINKSTATE</a>)
<a name="l00371"></a>00371     <a class="code" href="ospf6__route_8c.html#a6cd3c9be4769715b219b63202f5cd802">ospf6_linkstate_prefix2str</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>, buf, sizeof (buf));
<a name="l00372"></a>00372   <span class="keywordflow">else</span>
<a name="l00373"></a>00373     <a class="code" href="prefix_8c.html#a8b848557695ae5694bd2282eba23e367">prefix2str</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>, buf, sizeof (buf));
<a name="l00374"></a>00374 
<a name="l00375"></a>00375   <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (MEMORY))
<a name="l00376"></a>00376     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s %p: route add %p: %s&quot;</span>, <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table),
<a name="l00377"></a>00377                 table, route, buf);
<a name="l00378"></a>00378   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (TABLE))
<a name="l00379"></a>00379     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s: route add: %s&quot;</span>, <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table), buf);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381   <a class="code" href="thread_8c.html#abf5861abe71d6f9a1ddd493be0218de1">quagga_gettime</a> (<a class="code" href="thread_8h.html#a64fff521e88ba8b01645c5bb89085b33a7f92aaa461f13c163b13f96085eb3cd9">QUAGGA_CLK_MONOTONIC</a>, &amp;now);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383   node = <a class="code" href="table_8c.html#ac91fdff1a0b8dc3d60ebaf152caa0f80">route_node_get</a> (table-&gt;<a class="code" href="structospf6__route__table.html#a2323f5dbcbf6d64f99bacb2d12c01761">table</a>, &amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>);
<a name="l00384"></a>00384   route-&gt;<a class="code" href="structospf6__route.html#a400b25094c113ad6cca921b696b77f8b">rnode</a> = node;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386   <span class="comment">/* find place to insert */</span>
<a name="l00387"></a>00387   <span class="keywordflow">for</span> (current = node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>; current; current = current-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>)
<a name="l00388"></a>00388     {
<a name="l00389"></a>00389       <span class="keywordflow">if</span> (! <a class="code" href="ospf6__route_8h.html#a7133738c8b5e672f6e20d99fa76d3f90">ospf6_route_is_same</a> (current, route))
<a name="l00390"></a>00390         next = current;
<a name="l00391"></a>00391       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (current-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a> != route-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a>)
<a name="l00392"></a>00392         prev = current;
<a name="l00393"></a>00393       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#ac093ba9e1fbda0c67c91801240718e8c">ospf6_route_is_same_origin</a> (current, route))
<a name="l00394"></a>00394         old = current;
<a name="l00395"></a>00395       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8c.html#a02403e3544541e5a854683aa0ee88f85">ospf6_route_cmp</a> (current, route) &gt; 0)
<a name="l00396"></a>00396         next = current;
<a name="l00397"></a>00397       <span class="keywordflow">else</span>
<a name="l00398"></a>00398         prev = current;
<a name="l00399"></a>00399 
<a name="l00400"></a>00400       <span class="keywordflow">if</span> (old || next)
<a name="l00401"></a>00401         <span class="keywordflow">break</span>;
<a name="l00402"></a>00402     }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404   <span class="keywordflow">if</span> (old)
<a name="l00405"></a>00405     {
<a name="l00406"></a>00406       <span class="comment">/* if route does not actually change, return unchanged */</span>
<a name="l00407"></a>00407       <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a8be4fa6a36fd91902ea68d983f44ea54">ospf6_route_is_identical</a> (old, route))
<a name="l00408"></a>00408         {
<a name="l00409"></a>00409           <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (MEMORY))
<a name="l00410"></a>00410             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s %p: route add %p: needless update of %p&quot;</span>,
<a name="l00411"></a>00411                         <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table), table, route, old);
<a name="l00412"></a>00412           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (TABLE))
<a name="l00413"></a>00413             <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s: route add: needless update&quot;</span>,
<a name="l00414"></a>00414                         <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table));
<a name="l00415"></a>00415 
<a name="l00416"></a>00416           <a class="code" href="ospf6__route_8c.html#afe483c6d6b442082f70587b8a137ef9c">ospf6_route_delete</a> (route);
<a name="l00417"></a>00417           <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (old-&gt;flag, <a class="code" href="ospf6__route_8h.html#af81460bb17acb9299c98ef5e703f29fa">OSPF6_ROUTE_ADD</a>);
<a name="l00418"></a>00418           <a class="code" href="ospf6__route_8c.html#a67085861a8db3e45bf5108ad14f9485d">ospf6_route_table_assert</a> (table);
<a name="l00419"></a>00419 
<a name="l00420"></a>00420           <span class="keywordflow">return</span> old;
<a name="l00421"></a>00421         }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423       <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (MEMORY))
<a name="l00424"></a>00424         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s %p: route add %p: update of %p&quot;</span>,
<a name="l00425"></a>00425                     <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table), table, route, old);
<a name="l00426"></a>00426       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (TABLE))
<a name="l00427"></a>00427         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s: route add: update&quot;</span>,
<a name="l00428"></a>00428                     <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table));
<a name="l00429"></a>00429 
<a name="l00430"></a>00430       <span class="comment">/* replace old one if exists */</span>
<a name="l00431"></a>00431       <span class="keywordflow">if</span> (node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> == old)
<a name="l00432"></a>00432         {
<a name="l00433"></a>00433           node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> = route;
<a name="l00434"></a>00434           <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (route-&gt;<a class="code" href="structospf6__route.html#a6ea0bf028d117b76ebdf829dd1214f86">flag</a>, <a class="code" href="ospf6__route_8h.html#a15a16e004b7ad8a332e55f65fa81bc88">OSPF6_ROUTE_BEST</a>);
<a name="l00435"></a>00435         }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437       <span class="keywordflow">if</span> (old-&gt;prev)
<a name="l00438"></a>00438         old-&gt;prev-&gt;next = route;
<a name="l00439"></a>00439       route-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a> = old-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a>;
<a name="l00440"></a>00440       <span class="keywordflow">if</span> (old-&gt;next)
<a name="l00441"></a>00441         old-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a> = route;
<a name="l00442"></a>00442       route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a> = old-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444       route-&gt;<a class="code" href="structospf6__route.html#a927c15a4c44ad75a74d8386e2c8deea3">installed</a> = old-&gt;installed;
<a name="l00445"></a>00445       route-&gt;<a class="code" href="structospf6__route.html#a22eb727157fffbb2b611795562329b9d">changed</a> = now;
<a name="l00446"></a>00446       <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (route-&gt;<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00447"></a>00447       route-&gt;<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a> = table;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449       <a class="code" href="ospf6__route_8c.html#ae0268d845495f56740dbf46b80489b0c">ospf6_route_unlock</a> (old); <span class="comment">/* will be deleted later */</span>
<a name="l00450"></a>00450       <a class="code" href="ospf6__route_8c.html#a0ad7c43050f40ca3637220835928c2af">ospf6_route_lock</a> (route);
<a name="l00451"></a>00451 
<a name="l00452"></a>00452       <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (route-&gt;<a class="code" href="structospf6__route.html#a6ea0bf028d117b76ebdf829dd1214f86">flag</a>, <a class="code" href="ospf6__route_8h.html#a2e34d8560d88a78a2243622c923dde72">OSPF6_ROUTE_CHANGE</a>);
<a name="l00453"></a>00453       <a class="code" href="ospf6__route_8c.html#a67085861a8db3e45bf5108ad14f9485d">ospf6_route_table_assert</a> (table);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455       <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structospf6__route__table.html#a150a5f55306ff86d6b220fb0658b4c18">hook_add</a>)
<a name="l00456"></a>00456         (*table-&gt;<a class="code" href="structospf6__route__table.html#a150a5f55306ff86d6b220fb0658b4c18">hook_add</a>) (route);
<a name="l00457"></a>00457 
<a name="l00458"></a>00458       <span class="keywordflow">return</span> route;
<a name="l00459"></a>00459     }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461   <span class="comment">/* insert if previous or next node found */</span>
<a name="l00462"></a>00462   <span class="keywordflow">if</span> (prev || next)
<a name="l00463"></a>00463     {
<a name="l00464"></a>00464       <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (MEMORY))
<a name="l00465"></a>00465         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s %p: route add %p: another path: prev %p, next %p&quot;</span>,
<a name="l00466"></a>00466                    <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table), table, route, prev, next);
<a name="l00467"></a>00467       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (TABLE))
<a name="l00468"></a>00468         <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s: route add: another path found&quot;</span>,
<a name="l00469"></a>00469                     <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table));
<a name="l00470"></a>00470 
<a name="l00471"></a>00471       <span class="keywordflow">if</span> (prev == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00472"></a>00472         prev = next-&gt;prev;
<a name="l00473"></a>00473       <span class="keywordflow">if</span> (next == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00474"></a>00474         next = prev-&gt;next;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476       <span class="keywordflow">if</span> (prev)
<a name="l00477"></a>00477         prev-&gt;next = route;
<a name="l00478"></a>00478       route-&gt;prev = prev;
<a name="l00479"></a>00479       <span class="keywordflow">if</span> (next)
<a name="l00480"></a>00480         next-&gt;prev = route;
<a name="l00481"></a>00481       route-&gt;next = next;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483       <span class="keywordflow">if</span> (node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> == next)
<a name="l00484"></a>00484         {
<a name="l00485"></a>00485           <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (next-&gt;rnode == node);
<a name="l00486"></a>00486           node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> = route;
<a name="l00487"></a>00487           <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (next-&gt;flag, <a class="code" href="ospf6__route_8h.html#a15a16e004b7ad8a332e55f65fa81bc88">OSPF6_ROUTE_BEST</a>);
<a name="l00488"></a>00488           <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (route-&gt;flag, <a class="code" href="ospf6__route_8h.html#a15a16e004b7ad8a332e55f65fa81bc88">OSPF6_ROUTE_BEST</a>);
<a name="l00489"></a>00489           <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (MEMORY))
<a name="l00490"></a>00490             <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a> (<span class="stringliteral">&quot;%s %p: route add %p: replacing previous best: %p&quot;</span>,
<a name="l00491"></a>00491                        <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table), table, route, next);
<a name="l00492"></a>00492         }
<a name="l00493"></a>00493 
<a name="l00494"></a>00494       route-&gt;installed = now;
<a name="l00495"></a>00495       route-&gt;changed = now;
<a name="l00496"></a>00496       <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (route-&gt;table == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00497"></a>00497       route-&gt;table = table;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499       <a class="code" href="ospf6__route_8c.html#a0ad7c43050f40ca3637220835928c2af">ospf6_route_lock</a> (route);
<a name="l00500"></a>00500       table-&gt;<a class="code" href="structospf6__route__table.html#ac242748e782f2dbbc1f2d69ce7d9a140">count</a>++;
<a name="l00501"></a>00501       <a class="code" href="ospf6__route_8c.html#a67085861a8db3e45bf5108ad14f9485d">ospf6_route_table_assert</a> (table);
<a name="l00502"></a>00502 
<a name="l00503"></a>00503       <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (route-&gt;flag, <a class="code" href="ospf6__route_8h.html#af81460bb17acb9299c98ef5e703f29fa">OSPF6_ROUTE_ADD</a>);
<a name="l00504"></a>00504       <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structospf6__route__table.html#a150a5f55306ff86d6b220fb0658b4c18">hook_add</a>)
<a name="l00505"></a>00505         (*table-&gt;<a class="code" href="structospf6__route__table.html#a150a5f55306ff86d6b220fb0658b4c18">hook_add</a>) (route);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507       <span class="keywordflow">return</span> route;
<a name="l00508"></a>00508     }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510   <span class="comment">/* Else, this is the brand new route regarding to the prefix */</span>
<a name="l00511"></a>00511   <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (MEMORY))
<a name="l00512"></a>00512     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s %p: route add %p: brand new route&quot;</span>,
<a name="l00513"></a>00513                 <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table), table, route);
<a name="l00514"></a>00514   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (TABLE))
<a name="l00515"></a>00515     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s: route add: brand new route&quot;</span>,
<a name="l00516"></a>00516                 <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table));
<a name="l00517"></a>00517 
<a name="l00518"></a>00518   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00519"></a>00519   node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> = route;
<a name="l00520"></a>00520   <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (route-&gt;<a class="code" href="structospf6__route.html#a6ea0bf028d117b76ebdf829dd1214f86">flag</a>, <a class="code" href="ospf6__route_8h.html#a15a16e004b7ad8a332e55f65fa81bc88">OSPF6_ROUTE_BEST</a>);
<a name="l00521"></a>00521   <a class="code" href="ospf6__route_8c.html#a0ad7c43050f40ca3637220835928c2af">ospf6_route_lock</a> (route);
<a name="l00522"></a>00522   route-&gt;<a class="code" href="structospf6__route.html#a927c15a4c44ad75a74d8386e2c8deea3">installed</a> = now;
<a name="l00523"></a>00523   route-&gt;<a class="code" href="structospf6__route.html#a22eb727157fffbb2b611795562329b9d">changed</a> = now;
<a name="l00524"></a>00524   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (route-&gt;<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00525"></a>00525   route-&gt;<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a> = table;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527   <span class="comment">/* lookup real existing next route */</span>
<a name="l00528"></a>00528   nextnode = node;
<a name="l00529"></a>00529   <a class="code" href="table_8c.html#a5f018f727fe43d17553baabbf7fa6498">route_lock_node</a> (nextnode);
<a name="l00530"></a>00530   <span class="keywordflow">do</span> {
<a name="l00531"></a>00531     nextnode = <a class="code" href="table_8c.html#ad2addc694ecf6cd0cce57cb3a7d96902">route_next</a> (nextnode);
<a name="l00532"></a>00532   } <span class="keywordflow">while</span> (nextnode &amp;&amp; nextnode-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00533"></a>00533 
<a name="l00534"></a>00534   <span class="comment">/* set next link */</span>
<a name="l00535"></a>00535   <span class="keywordflow">if</span> (nextnode == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00536"></a>00536     route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00537"></a>00537   <span class="keywordflow">else</span>
<a name="l00538"></a>00538     {
<a name="l00539"></a>00539       <a class="code" href="table_8c.html#a849965644708e01ef49c203a2e00afd4">route_unlock_node</a> (nextnode);
<a name="l00540"></a>00540 
<a name="l00541"></a>00541       next = nextnode-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>;
<a name="l00542"></a>00542       route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a> = next;
<a name="l00543"></a>00543       next-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a> = route;
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546   <span class="comment">/* lookup real existing prev route */</span>
<a name="l00547"></a>00547   prevnode = node;
<a name="l00548"></a>00548   <a class="code" href="table_8c.html#a5f018f727fe43d17553baabbf7fa6498">route_lock_node</a> (prevnode);
<a name="l00549"></a>00549   <span class="keywordflow">do</span> {
<a name="l00550"></a>00550     prevnode = <a class="code" href="ospf6d_8c.html#ad926da9353e529391401a826d9254f93">route_prev</a> (prevnode);
<a name="l00551"></a>00551   } <span class="keywordflow">while</span> (prevnode &amp;&amp; prevnode-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553   <span class="comment">/* set prev link */</span>
<a name="l00554"></a>00554   <span class="keywordflow">if</span> (prevnode == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00555"></a>00555     route-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00556"></a>00556   <span class="keywordflow">else</span>
<a name="l00557"></a>00557     {
<a name="l00558"></a>00558       <a class="code" href="table_8c.html#a849965644708e01ef49c203a2e00afd4">route_unlock_node</a> (prevnode);
<a name="l00559"></a>00559 
<a name="l00560"></a>00560       prev = prevnode-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>;
<a name="l00561"></a>00561       <span class="keywordflow">while</span> (prev-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a> &amp;&amp; <a class="code" href="ospf6__route_8h.html#a7133738c8b5e672f6e20d99fa76d3f90">ospf6_route_is_same</a> (prev, prev-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>))
<a name="l00562"></a>00562         prev = prev-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>;
<a name="l00563"></a>00563       route-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a> = prev;
<a name="l00564"></a>00564       prev-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a> = route;
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567   table-&gt;<a class="code" href="structospf6__route__table.html#ac242748e782f2dbbc1f2d69ce7d9a140">count</a>++;
<a name="l00568"></a>00568   <a class="code" href="ospf6__route_8c.html#a67085861a8db3e45bf5108ad14f9485d">ospf6_route_table_assert</a> (table);
<a name="l00569"></a>00569 
<a name="l00570"></a>00570   <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (route-&gt;<a class="code" href="structospf6__route.html#a6ea0bf028d117b76ebdf829dd1214f86">flag</a>, <a class="code" href="ospf6__route_8h.html#af81460bb17acb9299c98ef5e703f29fa">OSPF6_ROUTE_ADD</a>);
<a name="l00571"></a>00571   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structospf6__route__table.html#a150a5f55306ff86d6b220fb0658b4c18">hook_add</a>)
<a name="l00572"></a>00572     (*table-&gt;<a class="code" href="structospf6__route__table.html#a150a5f55306ff86d6b220fb0658b4c18">hook_add</a>) (route);
<a name="l00573"></a>00573 
<a name="l00574"></a>00574   <span class="keywordflow">return</span> route;
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577 <span class="keywordtype">void</span>
<a name="l00578"></a><a class="code" href="ospf6__route_8h.html#a89c513ce389875d0c89a20017db2c410">00578</a> <a class="code" href="ospf6__route_8c.html#a89c513ce389875d0c89a20017db2c410">ospf6_route_remove</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route,
<a name="l00579"></a>00579                     <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *table)
<a name="l00580"></a>00580 {
<a name="l00581"></a>00581   <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *node;
<a name="l00582"></a>00582   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *current;
<a name="l00583"></a>00583   <span class="keywordtype">char</span> buf[64];
<a name="l00584"></a>00584 
<a name="l00585"></a>00585   <span class="keywordflow">if</span> (route-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a> == <a class="code" href="ospf6__route_8h.html#aa7dc51fbd11971c3f8dff933ea524492">OSPF6_DEST_TYPE_LINKSTATE</a>)
<a name="l00586"></a>00586     <a class="code" href="ospf6__route_8c.html#a6cd3c9be4769715b219b63202f5cd802">ospf6_linkstate_prefix2str</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>, buf, sizeof (buf));
<a name="l00587"></a>00587   <span class="keywordflow">else</span>
<a name="l00588"></a>00588     <a class="code" href="prefix_8c.html#a8b848557695ae5694bd2282eba23e367">prefix2str</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>, buf, sizeof (buf));
<a name="l00589"></a>00589 
<a name="l00590"></a>00590   <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (MEMORY))
<a name="l00591"></a>00591     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s %p: route remove %p: %s&quot;</span>,
<a name="l00592"></a>00592                 <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table), table, route, buf);
<a name="l00593"></a>00593   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (TABLE))
<a name="l00594"></a>00594     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s: route remove: %s&quot;</span>, <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table), buf);
<a name="l00595"></a>00595 
<a name="l00596"></a>00596   node = <a class="code" href="table_8c.html#ab99d86b40440c8f18d4f2b31b5b8f1c7">route_node_lookup</a> (table-&gt;<a class="code" href="structospf6__route__table.html#a2323f5dbcbf6d64f99bacb2d12c01761">table</a>, &amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>);
<a name="l00597"></a>00597   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (node);
<a name="l00598"></a>00598 
<a name="l00599"></a>00599   <span class="comment">/* find the route to remove, making sure that the route pointer</span>
<a name="l00600"></a>00600 <span class="comment">     is from the route table. */</span>
<a name="l00601"></a>00601   current = node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>;
<a name="l00602"></a>00602   <span class="keywordflow">while</span> (current &amp;&amp; <a class="code" href="ospf6__route_8h.html#a7133738c8b5e672f6e20d99fa76d3f90">ospf6_route_is_same</a> (current, route))
<a name="l00603"></a>00603     {
<a name="l00604"></a>00604       <span class="keywordflow">if</span> (current == route)
<a name="l00605"></a>00605         <span class="keywordflow">break</span>;
<a name="l00606"></a>00606       current = current-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>;
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (current == route);
<a name="l00609"></a>00609 
<a name="l00610"></a>00610   <span class="comment">/* adjust doubly linked list */</span>
<a name="l00611"></a>00611   <span class="keywordflow">if</span> (route-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a>)
<a name="l00612"></a>00612     route-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a>-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a> = route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>;
<a name="l00613"></a>00613   <span class="keywordflow">if</span> (route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>)
<a name="l00614"></a>00614     route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a> = route-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a>;
<a name="l00615"></a>00615 
<a name="l00616"></a>00616   <span class="keywordflow">if</span> (node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> == route)
<a name="l00617"></a>00617     {
<a name="l00618"></a>00618       <span class="keywordflow">if</span> (route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a> &amp;&amp; <a class="code" href="ospf6__route_8h.html#a7133738c8b5e672f6e20d99fa76d3f90">ospf6_route_is_same</a> (route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>, route))
<a name="l00619"></a>00619         {
<a name="l00620"></a>00620           node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> = route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>;
<a name="l00621"></a>00621           <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>-&gt;<a class="code" href="structospf6__route.html#a6ea0bf028d117b76ebdf829dd1214f86">flag</a>, <a class="code" href="ospf6__route_8h.html#a15a16e004b7ad8a332e55f65fa81bc88">OSPF6_ROUTE_BEST</a>);
<a name="l00622"></a>00622         }
<a name="l00623"></a>00623       <span class="keywordflow">else</span>
<a name="l00624"></a>00624         node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">/* should unlock route_node here ? */</span>
<a name="l00625"></a>00625     }
<a name="l00626"></a>00626 
<a name="l00627"></a>00627   table-&gt;<a class="code" href="structospf6__route__table.html#ac242748e782f2dbbc1f2d69ce7d9a140">count</a>--;
<a name="l00628"></a>00628   <a class="code" href="ospf6__route_8c.html#a67085861a8db3e45bf5108ad14f9485d">ospf6_route_table_assert</a> (table);
<a name="l00629"></a>00629 
<a name="l00630"></a>00630   <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (route-&gt;<a class="code" href="structospf6__route.html#a6ea0bf028d117b76ebdf829dd1214f86">flag</a>, <a class="code" href="ospf6__route_8h.html#a369671cf7e53eb4fe9277650c49f5240">OSPF6_ROUTE_WAS_REMOVED</a>);
<a name="l00631"></a>00631 
<a name="l00632"></a>00632   <span class="keywordflow">if</span> (table-&gt;<a class="code" href="structospf6__route__table.html#a1c69b4917bafb6ef7a03299b262f0839">hook_remove</a>)
<a name="l00633"></a>00633     (*table-&gt;<a class="code" href="structospf6__route__table.html#a1c69b4917bafb6ef7a03299b262f0839">hook_remove</a>) (route);
<a name="l00634"></a>00634 
<a name="l00635"></a>00635   <a class="code" href="ospf6__route_8c.html#ae0268d845495f56740dbf46b80489b0c">ospf6_route_unlock</a> (route);
<a name="l00636"></a>00636 }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *
<a name="l00639"></a><a class="code" href="ospf6__route_8h.html#a400d24a67548089d8a59242677ef33cf">00639</a> <a class="code" href="ospf6__route_8c.html#a400d24a67548089d8a59242677ef33cf">ospf6_route_head</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l00640"></a>00640 {
<a name="l00641"></a>00641   <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *node;
<a name="l00642"></a>00642   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644   node = <a class="code" href="table_8c.html#aee1d06c531794df326d946bdac647fb2">route_top</a> (table-&gt;<a class="code" href="structospf6__route__table.html#a2323f5dbcbf6d64f99bacb2d12c01761">table</a>);
<a name="l00645"></a>00645   <span class="keywordflow">if</span> (node == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00646"></a>00646     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00647"></a>00647 
<a name="l00648"></a>00648   <span class="comment">/* skip to the real existing entry */</span>
<a name="l00649"></a>00649   <span class="keywordflow">while</span> (node &amp;&amp; node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00650"></a>00650     node = <a class="code" href="table_8c.html#ad2addc694ecf6cd0cce57cb3a7d96902">route_next</a> (node);
<a name="l00651"></a>00651   <span class="keywordflow">if</span> (node == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00652"></a>00652     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00653"></a>00653 
<a name="l00654"></a>00654   <a class="code" href="table_8c.html#a849965644708e01ef49c203a2e00afd4">route_unlock_node</a> (node);
<a name="l00655"></a>00655   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>);
<a name="l00656"></a>00656 
<a name="l00657"></a>00657   route = (<span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *) node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>;
<a name="l00658"></a>00658   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (route-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00659"></a>00659   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (route-&gt;<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a> == table);
<a name="l00660"></a>00660   <a class="code" href="ospf6__route_8c.html#a0ad7c43050f40ca3637220835928c2af">ospf6_route_lock</a> (route);
<a name="l00661"></a>00661 
<a name="l00662"></a>00662   <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (MEMORY))
<a name="l00663"></a>00663     <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a> (<span class="stringliteral">&quot;%s %p: route head: %p&lt;-[%p]-&gt;%p&quot;</span>,
<a name="l00664"></a>00664                <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (table), table,
<a name="l00665"></a>00665                route-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a>, route, route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>);
<a name="l00666"></a>00666 
<a name="l00667"></a>00667   <span class="keywordflow">return</span> route;
<a name="l00668"></a>00668 }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670 <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *
<a name="l00671"></a><a class="code" href="ospf6__route_8h.html#a4cdecc41a86097a7d0871397f7a80fb8">00671</a> <a class="code" href="ospf6__route_8c.html#a4cdecc41a86097a7d0871397f7a80fb8">ospf6_route_next</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route)
<a name="l00672"></a>00672 {
<a name="l00673"></a>00673   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a> = route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>;
<a name="l00674"></a>00674 
<a name="l00675"></a>00675   <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (MEMORY))
<a name="l00676"></a>00676     <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a> (<span class="stringliteral">&quot;%s %p: route next: %p&lt;-[%p]-&gt;%p&quot;</span>,
<a name="l00677"></a>00677                <a class="code" href="ospf6__route_8c.html#a817a1b980af5dda29697b048757934c9">ospf6_route_table_name</a> (route-&gt;<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>), route-&gt;<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>,
<a name="l00678"></a>00678                route-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a>, route, route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>);
<a name="l00679"></a>00679 
<a name="l00680"></a>00680   <a class="code" href="ospf6__route_8c.html#ae0268d845495f56740dbf46b80489b0c">ospf6_route_unlock</a> (route);
<a name="l00681"></a>00681   <span class="keywordflow">if</span> (next)
<a name="l00682"></a>00682     <a class="code" href="ospf6__route_8c.html#a0ad7c43050f40ca3637220835928c2af">ospf6_route_lock</a> (next);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684   <span class="keywordflow">return</span> <a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>;
<a name="l00685"></a>00685 }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687 <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *
<a name="l00688"></a><a class="code" href="ospf6__route_8h.html#ad6c22f4091c972c555827dc1632f2fd8">00688</a> <a class="code" href="ospf6__route_8c.html#ad6c22f4091c972c555827dc1632f2fd8">ospf6_route_best_next</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route)
<a name="l00689"></a>00689 {
<a name="l00690"></a>00690   <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *rnode;
<a name="l00691"></a>00691   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>;
<a name="l00692"></a>00692 
<a name="l00693"></a>00693   rnode = route-&gt;<a class="code" href="structospf6__route.html#a400b25094c113ad6cca921b696b77f8b">rnode</a>;
<a name="l00694"></a>00694   <a class="code" href="table_8c.html#a5f018f727fe43d17553baabbf7fa6498">route_lock_node</a> (rnode);
<a name="l00695"></a>00695   rnode = <a class="code" href="table_8c.html#ad2addc694ecf6cd0cce57cb3a7d96902">route_next</a> (rnode);
<a name="l00696"></a>00696   <span class="keywordflow">while</span> (rnode &amp;&amp; rnode-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00697"></a>00697     rnode = <a class="code" href="table_8c.html#ad2addc694ecf6cd0cce57cb3a7d96902">route_next</a> (rnode);
<a name="l00698"></a>00698   <span class="keywordflow">if</span> (rnode == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00699"></a>00699     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00700"></a>00700   <a class="code" href="table_8c.html#a849965644708e01ef49c203a2e00afd4">route_unlock_node</a> (rnode);
<a name="l00701"></a>00701 
<a name="l00702"></a>00702   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (rnode-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>);
<a name="l00703"></a>00703   next = (<span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *) rnode-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>;
<a name="l00704"></a>00704   <a class="code" href="ospf6__route_8c.html#ae0268d845495f56740dbf46b80489b0c">ospf6_route_unlock</a> (route);
<a name="l00705"></a>00705   <a class="code" href="ospf6__route_8c.html#a0ad7c43050f40ca3637220835928c2af">ospf6_route_lock</a> (next);
<a name="l00706"></a>00706   <span class="keywordflow">return</span> <a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>;
<a name="l00707"></a>00707 }
<a name="l00708"></a>00708 
<a name="l00709"></a>00709 <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *
<a name="l00710"></a><a class="code" href="ospf6__route_8h.html#aac8aa08a2c7dca4d417db4681b0529a0">00710</a> <a class="code" href="ospf6__route_8c.html#aac8aa08a2c7dca4d417db4681b0529a0">ospf6_route_match_head</a> (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *<a class="code" href="structprefix.html">prefix</a>,
<a name="l00711"></a>00711                         <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l00712"></a>00712 {
<a name="l00713"></a>00713   <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *node;
<a name="l00714"></a>00714   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716   <span class="comment">/* Walk down tree. */</span>
<a name="l00717"></a>00717   node = table-&gt;<a class="code" href="structospf6__route__table.html#a2323f5dbcbf6d64f99bacb2d12c01761">table</a>-&gt;<a class="code" href="structroute__table.html#a4d58458d9c18192cecaea1b98775f529">top</a>;
<a name="l00718"></a>00718   <span class="keywordflow">while</span> (node &amp;&amp; node-&gt;<a class="code" href="structroute__node.html#ae6d28f3985e8e2a761c8e22bae5767eb">p</a>.<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> &lt; prefix-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> &amp;&amp;
<a name="l00719"></a>00719      <a class="code" href="prefix_8c.html#a8c5d68665a4b036a361330bee254318e">prefix_match</a> (&amp;node-&gt;<a class="code" href="structroute__node.html#ae6d28f3985e8e2a761c8e22bae5767eb">p</a>, prefix))
<a name="l00720"></a>00720     node = node-&gt;<a class="code" href="structroute__node.html#a6416caa9a71f122b759c0a8d79dfb72e">link</a>[<a class="code" href="prefix_8h.html#a448f1ebdeae472533f8faafd675e8f0b">prefix_bit</a>(&amp;prefix-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, node-&gt;<a class="code" href="structroute__node.html#ae6d28f3985e8e2a761c8e22bae5767eb">p</a>.<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>)];
<a name="l00721"></a>00721 
<a name="l00722"></a>00722   <span class="keywordflow">if</span> (node)
<a name="l00723"></a>00723     <a class="code" href="table_8c.html#a5f018f727fe43d17553baabbf7fa6498">route_lock_node</a> (node);
<a name="l00724"></a>00724   <span class="keywordflow">while</span> (node &amp;&amp; node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00725"></a>00725     node = <a class="code" href="table_8c.html#ad2addc694ecf6cd0cce57cb3a7d96902">route_next</a> (node);
<a name="l00726"></a>00726   <span class="keywordflow">if</span> (node == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00727"></a>00727     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00728"></a>00728   <a class="code" href="table_8c.html#a849965644708e01ef49c203a2e00afd4">route_unlock_node</a> (node);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730   <span class="keywordflow">if</span> (! <a class="code" href="prefix_8c.html#a8c5d68665a4b036a361330bee254318e">prefix_match</a> (prefix, &amp;node-&gt;<a class="code" href="structroute__node.html#ae6d28f3985e8e2a761c8e22bae5767eb">p</a>))
<a name="l00731"></a>00731     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733   route = node-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>;
<a name="l00734"></a>00734   <a class="code" href="ospf6__route_8c.html#a0ad7c43050f40ca3637220835928c2af">ospf6_route_lock</a> (route);
<a name="l00735"></a>00735   <span class="keywordflow">return</span> route;
<a name="l00736"></a>00736 }
<a name="l00737"></a>00737 
<a name="l00738"></a>00738 <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *
<a name="l00739"></a><a class="code" href="ospf6__route_8h.html#a944bc519c57314c58c6ca2043c5154cd">00739</a> <a class="code" href="ospf6__route_8c.html#a944bc519c57314c58c6ca2043c5154cd">ospf6_route_match_next</a> (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *<a class="code" href="structprefix.html">prefix</a>,
<a name="l00740"></a>00740                         <span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route)
<a name="l00741"></a>00741 {
<a name="l00742"></a>00742   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>;
<a name="l00743"></a>00743 
<a name="l00744"></a>00744   next = <a class="code" href="ospf6__route_8c.html#a4cdecc41a86097a7d0871397f7a80fb8">ospf6_route_next</a> (route);
<a name="l00745"></a>00745   <span class="keywordflow">if</span> (next &amp;&amp; ! <a class="code" href="prefix_8c.html#a8c5d68665a4b036a361330bee254318e">prefix_match</a> (prefix, &amp;next-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>))
<a name="l00746"></a>00746     {
<a name="l00747"></a>00747       <a class="code" href="ospf6__route_8c.html#ae0268d845495f56740dbf46b80489b0c">ospf6_route_unlock</a> (next);
<a name="l00748"></a>00748       next = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00749"></a>00749     }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751   <span class="keywordflow">return</span> <a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>;
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754 <span class="keywordtype">void</span>
<a name="l00755"></a><a class="code" href="ospf6__route_8h.html#a84e44b9507ad85758154304ef273b0c8">00755</a> <a class="code" href="ospf6__route_8c.html#a0429954cda76d4207a53813e869b451d">ospf6_route_remove_all</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l00756"></a>00756 {
<a name="l00757"></a>00757   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route;
<a name="l00758"></a>00758   <span class="keywordflow">for</span> (route = <a class="code" href="ospf6__route_8c.html#a400d24a67548089d8a59242677ef33cf">ospf6_route_head</a> (table); route;
<a name="l00759"></a>00759        route = <a class="code" href="ospf6__route_8c.html#a4cdecc41a86097a7d0871397f7a80fb8">ospf6_route_next</a> (route))
<a name="l00760"></a>00760     <a class="code" href="ospf6__route_8c.html#a89c513ce389875d0c89a20017db2c410">ospf6_route_remove</a> (route, table);
<a name="l00761"></a>00761 }
<a name="l00762"></a>00762 
<a name="l00763"></a>00763 <span class="keyword">struct </span><a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *
<a name="l00764"></a><a class="code" href="ospf6__route_8h.html#a79652b40c9c81bf3ef56b21732b5ee8e">00764</a> <a class="code" href="ospf6__route_8c.html#a79652b40c9c81bf3ef56b21732b5ee8e">ospf6_route_table_create</a> (<span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>, <span class="keywordtype">int</span> <a class="code" href="test-sig_8c.html#ab4ed0bba3292270af8ad67b45a21280d">t</a>)
<a name="l00765"></a>00765 {
<a name="l00766"></a>00766   <span class="keyword">struct </span><a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<span class="keyword">new</span>;
<a name="l00767"></a>00767   <span class="keyword">new</span> = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167bab41d86236e3a778976a0183cfe48894f">MTYPE_OSPF6_ROUTE</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a>));
<a name="l00768"></a>00768   <span class="keyword">new</span>-&gt;table = <a class="code" href="table_8c.html#a9b1d6d715d752d224b322da32d425046">route_table_init</a> ();
<a name="l00769"></a>00769   <span class="keyword">new</span>-&gt;scope_type = <a class="code" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>;
<a name="l00770"></a>00770   <span class="keyword">new</span>-&gt;table_type = <a class="code" href="test-sig_8c.html#ab4ed0bba3292270af8ad67b45a21280d">t</a>;
<a name="l00771"></a>00771   <span class="keywordflow">return</span> <span class="keyword">new</span>;
<a name="l00772"></a>00772 }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774 <span class="keywordtype">void</span>
<a name="l00775"></a><a class="code" href="ospf6__route_8h.html#ade08da42c4374a6d033096ca12e5550b">00775</a> <a class="code" href="ospf6__route_8c.html#a02985ae1fd04f0ab2826100b9dae38b2">ospf6_route_table_delete</a> (<span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route__table.html#a2323f5dbcbf6d64f99bacb2d12c01761">table</a>)
<a name="l00776"></a>00776 {
<a name="l00777"></a>00777   <a class="code" href="ospf6__route_8c.html#a0429954cda76d4207a53813e869b451d">ospf6_route_remove_all</a> (table);
<a name="l00778"></a>00778   <a class="code" href="table_8c.html#adc5ff276f1698f5bef7bb74289e3b26e">route_table_finish</a> (table-&gt;<a class="code" href="structospf6__route__table.html#a2323f5dbcbf6d64f99bacb2d12c01761">table</a>);
<a name="l00779"></a>00779   <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167bab41d86236e3a778976a0183cfe48894f">MTYPE_OSPF6_ROUTE</a>, table);
<a name="l00780"></a>00780 }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 <span class="comment">/* VTY commands */</span>
<a name="l00784"></a>00784 <span class="keywordtype">void</span>
<a name="l00785"></a><a class="code" href="ospf6__route_8h.html#a1ff2114a5d187ef4c6285fa25c38642b">00785</a> <a class="code" href="ospf6__route_8c.html#a1ff2114a5d187ef4c6285fa25c38642b">ospf6_route_show</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>, <span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route)
<a name="l00786"></a>00786 {
<a name="l00787"></a>00787   <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
<a name="l00788"></a>00788   <span class="keywordtype">char</span> destination[64], <a class="code" href="structnexthop.html">nexthop</a>[64];
<a name="l00789"></a>00789   <span class="keywordtype">char</span> duration[16], ifname[IFNAMSIZ];
<a name="l00790"></a>00790   <span class="keyword">struct </span>timeval now, res;
<a name="l00791"></a>00791 
<a name="l00792"></a>00792   <a class="code" href="thread_8c.html#abf5861abe71d6f9a1ddd493be0218de1">quagga_gettime</a> (<a class="code" href="thread_8h.html#a64fff521e88ba8b01645c5bb89085b33a7f92aaa461f13c163b13f96085eb3cd9">QUAGGA_CLK_MONOTONIC</a>, &amp;now);
<a name="l00793"></a>00793   <a class="code" href="ospf6d_8h.html#ad8549d8029286e53812f5d1aab4439e5">timersub</a> (&amp;now, &amp;route-&gt;<a class="code" href="structospf6__route.html#a22eb727157fffbb2b611795562329b9d">changed</a>, &amp;res);
<a name="l00794"></a>00794   <a class="code" href="ospf6d_8h.html#aac49ca805b11c1540def0721e069a851">timerstring</a> (&amp;res, duration, <span class="keyword">sizeof</span> (duration));
<a name="l00795"></a>00795 
<a name="l00796"></a>00796   <span class="comment">/* destination */</span>
<a name="l00797"></a>00797   <span class="keywordflow">if</span> (route-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a> == <a class="code" href="ospf6__route_8h.html#aa7dc51fbd11971c3f8dff933ea524492">OSPF6_DEST_TYPE_LINKSTATE</a>)
<a name="l00798"></a>00798     <a class="code" href="ospf6__route_8c.html#a6cd3c9be4769715b219b63202f5cd802">ospf6_linkstate_prefix2str</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>, destination,
<a name="l00799"></a>00799                                 sizeof (destination));
<a name="l00800"></a>00800   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (route-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a> == <a class="code" href="ospf6__route_8h.html#a0dcb3d4e20fc75a249f2091ba481d37b">OSPF6_DEST_TYPE_ROUTER</a>)
<a name="l00801"></a>00801     <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>.<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>.u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>,
<a name="l00802"></a>00802                destination, sizeof (destination));
<a name="l00803"></a>00803   <span class="keywordflow">else</span>
<a name="l00804"></a>00804     <a class="code" href="prefix_8c.html#a8b848557695ae5694bd2282eba23e367">prefix2str</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>, destination, sizeof (destination));
<a name="l00805"></a>00805 
<a name="l00806"></a>00806   <span class="comment">/* nexthop */</span>
<a name="l00807"></a>00807   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, &amp;route-&gt;<a class="code" href="structospf6__route.html#aeff840303635790b4975364a57c300a3">nexthop</a>[0].<a class="code" href="structospf6__nexthop.html#aca0fcfd059411e2638d19d1d95288a10">address</a>, nexthop,
<a name="l00808"></a>00808              sizeof (nexthop));
<a name="l00809"></a>00809   <span class="keywordflow">if</span> (! <a class="code" href="if_8c.html#a2e22330f87622f0659002d0aff75b487">if_indextoname</a> (route-&gt;<a class="code" href="structospf6__route.html#aeff840303635790b4975364a57c300a3">nexthop</a>[0].<a class="code" href="structospf6__nexthop.html#a5809ab035d671ce92e5492ea78d79051">ifindex</a>, ifname))
<a name="l00810"></a>00810     <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (ifname, <span class="keyword">sizeof</span> (ifname), <span class="stringliteral">&quot;%d&quot;</span>, route-&gt;<a class="code" href="structospf6__route.html#aeff840303635790b4975364a57c300a3">nexthop</a>[0].<a class="code" href="structospf6__nexthop.html#a5809ab035d671ce92e5492ea78d79051">ifindex</a>);
<a name="l00811"></a>00811 
<a name="l00812"></a>00812   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%c%1s %2s %-30s %-25s %6.*s %s%s&quot;</span>,
<a name="l00813"></a>00813            (<a class="code" href="ospf6__route_8h.html#ab764ec517d66bed7d7de5de12ee51cf3">ospf6_route_is_best</a> (route) ? <span class="charliteral">&#39;*&#39;</span> : <span class="charliteral">&#39; &#39;</span>),
<a name="l00814"></a>00814            <a class="code" href="ospf6__route_8h.html#a2524ab2f82562768130fc1cf2a43474c">OSPF6_DEST_TYPE_SUBSTR</a> (route-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a>),
<a name="l00815"></a>00815            <a class="code" href="ospf6__route_8h.html#a3a7cc7e97c92e8fa20cc02034d416ba4">OSPF6_PATH_TYPE_SUBSTR</a> (route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a>),
<a name="l00816"></a>00816            destination, nexthop, IFNAMSIZ, ifname, duration, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00817"></a>00817 
<a name="l00818"></a>00818   <span class="keywordflow">for</span> (i = 1; <a class="code" href="ospf6__route_8h.html#ab3d4b67ab2b8648021096e2fca7d980b">ospf6_nexthop_is_set</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#aeff840303635790b4975364a57c300a3">nexthop</a>[i]) &amp;&amp;
<a name="l00819"></a>00819        i &lt; <a class="code" href="ospf6__route_8h.html#a722b45cea00290e2da6ebe98934f8749">OSPF6_MULTI_PATH_LIMIT</a>; i++)
<a name="l00820"></a>00820     {
<a name="l00821"></a>00821       <span class="comment">/* nexthop */</span>
<a name="l00822"></a>00822       <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, &amp;route-&gt;<a class="code" href="structospf6__route.html#aeff840303635790b4975364a57c300a3">nexthop</a>[i].<a class="code" href="structospf6__nexthop.html#aca0fcfd059411e2638d19d1d95288a10">address</a>, nexthop,
<a name="l00823"></a>00823                  sizeof (nexthop));
<a name="l00824"></a>00824       <span class="keywordflow">if</span> (! <a class="code" href="if_8c.html#a2e22330f87622f0659002d0aff75b487">if_indextoname</a> (route-&gt;<a class="code" href="structospf6__route.html#aeff840303635790b4975364a57c300a3">nexthop</a>[i].<a class="code" href="structospf6__nexthop.html#a5809ab035d671ce92e5492ea78d79051">ifindex</a>, ifname))
<a name="l00825"></a>00825         <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (ifname, <span class="keyword">sizeof</span> (ifname), <span class="stringliteral">&quot;%d&quot;</span>, route-&gt;<a class="code" href="structospf6__route.html#aeff840303635790b4975364a57c300a3">nexthop</a>[i].<a class="code" href="structospf6__nexthop.html#a5809ab035d671ce92e5492ea78d79051">ifindex</a>);
<a name="l00826"></a>00826 
<a name="l00827"></a>00827       <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%c%1s %2s %-30s %-25s %6.*s %s%s&quot;</span>,
<a name="l00828"></a>00828                <span class="charliteral">&#39; &#39;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, nexthop, IFNAMSIZ, ifname, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830 }
<a name="l00831"></a>00831 
<a name="l00832"></a>00832 <span class="keywordtype">void</span>
<a name="l00833"></a><a class="code" href="ospf6__route_8h.html#a8aa84829fb3ba1693d7c1d020844a606">00833</a> <a class="code" href="ospf6__route_8c.html#a8aa84829fb3ba1693d7c1d020844a606">ospf6_route_show_detail</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>, <span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route)
<a name="l00834"></a>00834 {
<a name="l00835"></a>00835   <span class="keywordtype">char</span> destination[64], <a class="code" href="structnexthop.html">nexthop</a>[64], ifname[IFNAMSIZ];
<a name="l00836"></a>00836   <span class="keywordtype">char</span> area_id[16], <span class="keywordtype">id</span>[16], <a class="code" href="prefix_8h.html#aa4419784611184c74a36162ffcf0123d">adv_router</a>[16], capa[16], options[16];
<a name="l00837"></a>00837   <span class="keyword">struct </span>timeval now, res;
<a name="l00838"></a>00838   <span class="keywordtype">char</span> duration[16];
<a name="l00839"></a>00839   <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
<a name="l00840"></a>00840 
<a name="l00841"></a>00841   <a class="code" href="thread_8c.html#abf5861abe71d6f9a1ddd493be0218de1">quagga_gettime</a> (<a class="code" href="thread_8h.html#a64fff521e88ba8b01645c5bb89085b33a7f92aaa461f13c163b13f96085eb3cd9">QUAGGA_CLK_MONOTONIC</a>, &amp;now);
<a name="l00842"></a>00842 
<a name="l00843"></a>00843   <span class="comment">/* destination */</span>
<a name="l00844"></a>00844   <span class="keywordflow">if</span> (route-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a> == <a class="code" href="ospf6__route_8h.html#aa7dc51fbd11971c3f8dff933ea524492">OSPF6_DEST_TYPE_LINKSTATE</a>)
<a name="l00845"></a>00845     <a class="code" href="ospf6__route_8c.html#a6cd3c9be4769715b219b63202f5cd802">ospf6_linkstate_prefix2str</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>, destination,
<a name="l00846"></a>00846                                 sizeof (destination));
<a name="l00847"></a>00847   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (route-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a> == <a class="code" href="ospf6__route_8h.html#a0dcb3d4e20fc75a249f2091ba481d37b">OSPF6_DEST_TYPE_ROUTER</a>)
<a name="l00848"></a>00848     <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>.<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>.u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>,
<a name="l00849"></a>00849                destination, sizeof (destination));
<a name="l00850"></a>00850   <span class="keywordflow">else</span>
<a name="l00851"></a>00851     <a class="code" href="prefix_8c.html#a8b848557695ae5694bd2282eba23e367">prefix2str</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>, destination, sizeof (destination));
<a name="l00852"></a>00852   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Destination: %s%s&quot;</span>, destination, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00853"></a>00853 
<a name="l00854"></a>00854   <span class="comment">/* destination type */</span>
<a name="l00855"></a>00855   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Destination type: %s%s&quot;</span>,
<a name="l00856"></a>00856            <a class="code" href="ospf6__route_8h.html#a4de3573d61df82ef11e0164f22ca9ad7">OSPF6_DEST_TYPE_NAME</a> (route-&gt;<a class="code" href="structospf6__route.html#a74705096f252ccb17294f45fe3945757">type</a>),
<a name="l00857"></a>00857            <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00858"></a>00858 
<a name="l00859"></a>00859   <span class="comment">/* Time */</span>
<a name="l00860"></a>00860   <a class="code" href="ospf6d_8h.html#ad8549d8029286e53812f5d1aab4439e5">timersub</a> (&amp;now, &amp;route-&gt;<a class="code" href="structospf6__route.html#a927c15a4c44ad75a74d8386e2c8deea3">installed</a>, &amp;res);
<a name="l00861"></a>00861   <a class="code" href="ospf6d_8h.html#aac49ca805b11c1540def0721e069a851">timerstring</a> (&amp;res, duration, <span class="keyword">sizeof</span> (duration));
<a name="l00862"></a>00862   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Installed Time: %s ago%s&quot;</span>, duration, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00863"></a>00863 
<a name="l00864"></a>00864   <a class="code" href="ospf6d_8h.html#ad8549d8029286e53812f5d1aab4439e5">timersub</a> (&amp;now, &amp;route-&gt;<a class="code" href="structospf6__route.html#a22eb727157fffbb2b611795562329b9d">changed</a>, &amp;res);
<a name="l00865"></a>00865   <a class="code" href="ospf6d_8h.html#aac49ca805b11c1540def0721e069a851">timerstring</a> (&amp;res, duration, <span class="keyword">sizeof</span> (duration));
<a name="l00866"></a>00866   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  Changed Time: %s ago%s&quot;</span>, duration, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00867"></a>00867 
<a name="l00868"></a>00868   <span class="comment">/* Debugging info */</span>
<a name="l00869"></a>00869   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Lock: %d Flags: %s%s%s%s%s&quot;</span>, route-&gt;<a class="code" href="structospf6__route.html#a7c548e8e59600e136436ce9aaf378baa">lock</a>,
<a name="l00870"></a>00870            (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (route-&gt;<a class="code" href="structospf6__route.html#a6ea0bf028d117b76ebdf829dd1214f86">flag</a>, <a class="code" href="ospf6__route_8h.html#a15a16e004b7ad8a332e55f65fa81bc88">OSPF6_ROUTE_BEST</a>)   ? <span class="stringliteral">&quot;B&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>),
<a name="l00871"></a>00871            (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (route-&gt;<a class="code" href="structospf6__route.html#a6ea0bf028d117b76ebdf829dd1214f86">flag</a>, <a class="code" href="ospf6__route_8h.html#af81460bb17acb9299c98ef5e703f29fa">OSPF6_ROUTE_ADD</a>)    ? <span class="stringliteral">&quot;A&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>),
<a name="l00872"></a>00872            (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (route-&gt;<a class="code" href="structospf6__route.html#a6ea0bf028d117b76ebdf829dd1214f86">flag</a>, <a class="code" href="ospf6__route_8h.html#a35dc694fea451eddcc4e6d5fa14ed8cd">OSPF6_ROUTE_REMOVE</a>) ? <span class="stringliteral">&quot;R&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>),
<a name="l00873"></a>00873            (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (route-&gt;<a class="code" href="structospf6__route.html#a6ea0bf028d117b76ebdf829dd1214f86">flag</a>, <a class="code" href="ospf6__route_8h.html#a2e34d8560d88a78a2243622c923dde72">OSPF6_ROUTE_CHANGE</a>) ? <span class="stringliteral">&quot;C&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>),
<a name="l00874"></a>00874            <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00875"></a>00875   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Memory: prev: %p this: %p next: %p%s&quot;</span>,
<a name="l00876"></a>00876            route-&gt;<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a>, route, route-&gt;<a class="code" href="structospf6__route.html#ae263097eea30f7d0de5ca576770012ab">next</a>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00877"></a>00877 
<a name="l00878"></a>00878   <span class="comment">/* Path section */</span>
<a name="l00879"></a>00879 
<a name="l00880"></a>00880   <span class="comment">/* Area-ID */</span>
<a name="l00881"></a>00881   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ad4fc384dbcd343e1ba3e5918e4d25c15">area_id</a>, area_id, sizeof (area_id));
<a name="l00882"></a>00882   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Associated Area: %s%s&quot;</span>, area_id, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00883"></a>00883 
<a name="l00884"></a>00884   <span class="comment">/* Path type */</span>
<a name="l00885"></a>00885   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Path Type: %s%s&quot;</span>,
<a name="l00886"></a>00886            <a class="code" href="ospf6__route_8h.html#aa450597cf8eef04535375a88c66bde88">OSPF6_PATH_TYPE_NAME</a> (route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a>), <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00887"></a>00887 
<a name="l00888"></a>00888   <span class="comment">/* LS Origin */</span>
<a name="l00889"></a>00889   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a7f174fe7a9fdaded7fc074cb1c51b351">origin</a>.<a class="code" href="structospf6__ls__origin.html#a5462d6c847d9cddd5e0bace437f2199a">id</a>, <span class="keywordtype">id</span>, sizeof (<span class="keywordtype">id</span>));
<a name="l00890"></a>00890   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a7f174fe7a9fdaded7fc074cb1c51b351">origin</a>.<a class="code" href="structospf6__ls__origin.html#aad4727f62192e5db63a98474f9845694">adv_router</a>, adv_router,
<a name="l00891"></a>00891              sizeof (adv_router));
<a name="l00892"></a>00892   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;LS Origin: %s Id: %s Adv: %s%s&quot;</span>,
<a name="l00893"></a>00893            <a class="code" href="ospf6__lsa_8c.html#aef56342b1e39d23bf9977353c1c2deb1">ospf6_lstype_name</a> (route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a7f174fe7a9fdaded7fc074cb1c51b351">origin</a>.<a class="code" href="structospf6__ls__origin.html#a88f1d08bddf61718681883834fd9990e">type</a>),
<a name="l00894"></a>00894            <span class="keywordtype">id</span>, adv_router, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00895"></a>00895 
<a name="l00896"></a>00896   <span class="comment">/* Options */</span>
<a name="l00897"></a>00897   <a class="code" href="ospf6__proto_8c.html#a70fba8cd2453bf33405c98ff2ff14a38">ospf6_options_printbuf</a> (route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a1c10b3d1f386486e496d7196ec16e5e5">options</a>, options, sizeof (options));
<a name="l00898"></a>00898   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Options: %s%s&quot;</span>, options, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00899"></a>00899 
<a name="l00900"></a>00900   <span class="comment">/* Router Bits */</span>
<a name="l00901"></a>00901   <a class="code" href="ospf6__proto_8c.html#acfafe064fed258582397cfd39d7d69ba">ospf6_capability_printbuf</a> (route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ad4c22e82497e95ddac15345fbdf50245">router_bits</a>, capa, sizeof (capa));
<a name="l00902"></a>00902   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Router Bits: %s%s&quot;</span>, capa, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00903"></a>00903 
<a name="l00904"></a>00904   <span class="comment">/* Prefix Options */</span>
<a name="l00905"></a>00905   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Prefix Options: xxx%s&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00906"></a>00906 
<a name="l00907"></a>00907   <span class="comment">/* Metrics */</span>
<a name="l00908"></a>00908   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Metric Type: %d%s&quot;</span>, route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a5723668da86dfd4caea4f50e8ad0457f">metric_type</a>,
<a name="l00909"></a>00909            <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00910"></a>00910   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Metric: %d (%d)%s&quot;</span>,
<a name="l00911"></a>00911            route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ab33bf3c3ce1f07b918167dbfa4af30e6">cost</a>, route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#afbe458c0a581463749e46edf6ae726c3">cost_e2</a>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00912"></a>00912 
<a name="l00913"></a>00913   <span class="comment">/* Nexthops */</span>
<a name="l00914"></a>00914   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Nexthop:%s&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00915"></a>00915   <span class="keywordflow">for</span> (i = 0; <a class="code" href="ospf6__route_8h.html#ab3d4b67ab2b8648021096e2fca7d980b">ospf6_nexthop_is_set</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#aeff840303635790b4975364a57c300a3">nexthop</a>[i]) &amp;&amp;
<a name="l00916"></a>00916        i &lt; <a class="code" href="ospf6__route_8h.html#a722b45cea00290e2da6ebe98934f8749">OSPF6_MULTI_PATH_LIMIT</a>; i++)
<a name="l00917"></a>00917     {
<a name="l00918"></a>00918       <span class="comment">/* nexthop */</span>
<a name="l00919"></a>00919       <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, &amp;route-&gt;<a class="code" href="structospf6__route.html#aeff840303635790b4975364a57c300a3">nexthop</a>[i].<a class="code" href="structospf6__nexthop.html#aca0fcfd059411e2638d19d1d95288a10">address</a>, nexthop,
<a name="l00920"></a>00920                  sizeof (nexthop));
<a name="l00921"></a>00921       <span class="keywordflow">if</span> (! <a class="code" href="if_8c.html#a2e22330f87622f0659002d0aff75b487">if_indextoname</a> (route-&gt;<a class="code" href="structospf6__route.html#aeff840303635790b4975364a57c300a3">nexthop</a>[i].<a class="code" href="structospf6__nexthop.html#a5809ab035d671ce92e5492ea78d79051">ifindex</a>, ifname))
<a name="l00922"></a>00922         <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (ifname, <span class="keyword">sizeof</span> (ifname), <span class="stringliteral">&quot;%d&quot;</span>, route-&gt;<a class="code" href="structospf6__route.html#aeff840303635790b4975364a57c300a3">nexthop</a>[i].<a class="code" href="structospf6__nexthop.html#a5809ab035d671ce92e5492ea78d79051">ifindex</a>);
<a name="l00923"></a>00923       <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  %s %.*s%s&quot;</span>, nexthop, IFNAMSIZ, ifname, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00924"></a>00924     }
<a name="l00925"></a>00925   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00926"></a>00926 }
<a name="l00927"></a>00927 
<a name="l00928"></a>00928 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00929"></a><a class="code" href="ospf6__route_8c.html#a0d211a8759e8ffca98854d171496ce6e">00929</a> <a class="code" href="ospf6__route_8c.html#a0d211a8759e8ffca98854d171496ce6e">ospf6_route_show_table_summary</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>,
<a name="l00930"></a>00930                                 <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *table)
<a name="l00931"></a>00931 {
<a name="l00932"></a>00932   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route, *<a class="code" href="structospf6__route.html#a5c1146c72a8aeebba166d22b57baf005">prev</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00933"></a>00933   <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>, pathtype[<a class="code" href="ospf6__route_8h.html#a58713f677df3b5e893312852a8fdba29">OSPF6_PATH_TYPE_MAX</a>];
<a name="l00934"></a>00934   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> number = 0;
<a name="l00935"></a>00935   <span class="keywordtype">int</span> nhinval = 0, ecmp = 0;
<a name="l00936"></a>00936   <span class="keywordtype">int</span> alternative = 0, destination = 0;
<a name="l00937"></a>00937 
<a name="l00938"></a>00938   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ospf6__route_8h.html#a58713f677df3b5e893312852a8fdba29">OSPF6_PATH_TYPE_MAX</a>; i++)
<a name="l00939"></a>00939     pathtype[i] = 0;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941   <span class="keywordflow">for</span> (route = <a class="code" href="ospf6__route_8c.html#a400d24a67548089d8a59242677ef33cf">ospf6_route_head</a> (table); route;
<a name="l00942"></a>00942        route = <a class="code" href="ospf6__route_8c.html#a4cdecc41a86097a7d0871397f7a80fb8">ospf6_route_next</a> (route))
<a name="l00943"></a>00943     {
<a name="l00944"></a>00944       <span class="keywordflow">if</span> (prev == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || ! <a class="code" href="ospf6__route_8h.html#a7133738c8b5e672f6e20d99fa76d3f90">ospf6_route_is_same</a> (prev, route))
<a name="l00945"></a>00945         destination++;
<a name="l00946"></a>00946       <span class="keywordflow">else</span>
<a name="l00947"></a>00947         alternative++;
<a name="l00948"></a>00948       <span class="keywordflow">if</span> (! <a class="code" href="ospf6__route_8h.html#ab3d4b67ab2b8648021096e2fca7d980b">ospf6_nexthop_is_set</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#aeff840303635790b4975364a57c300a3">nexthop</a>[0]))
<a name="l00949"></a>00949         nhinval++;
<a name="l00950"></a>00950       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#ab3d4b67ab2b8648021096e2fca7d980b">ospf6_nexthop_is_set</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#aeff840303635790b4975364a57c300a3">nexthop</a>[1]))
<a name="l00951"></a>00951         ecmp++;
<a name="l00952"></a>00952       pathtype[route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a>]++;
<a name="l00953"></a>00953       number++;
<a name="l00954"></a>00954 
<a name="l00955"></a>00955       prev = route;
<a name="l00956"></a>00956     }
<a name="l00957"></a>00957 
<a name="l00958"></a>00958   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (number == table-&gt;<a class="code" href="structospf6__route__table.html#ac242748e782f2dbbc1f2d69ce7d9a140">count</a>);
<a name="l00959"></a>00959 
<a name="l00960"></a>00960   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Number of OSPFv3 routes: %d%s&quot;</span>, number, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00961"></a>00961   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Number of Destination: %d%s&quot;</span>, destination, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00962"></a>00962   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Number of Alternative routes: %d%s&quot;</span>, alternative, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00963"></a>00963   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Number of Equal Cost Multi Path: %d%s&quot;</span>, ecmp, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00964"></a>00964   <span class="keywordflow">for</span> (i = <a class="code" href="ospf6__route_8h.html#a6cda40031860bfed6184599f4ac957ec">OSPF6_PATH_TYPE_INTRA</a>; i &lt;= <a class="code" href="ospf6__route_8h.html#a753677bbce3e5b4d74252300c43e422a">OSPF6_PATH_TYPE_EXTERNAL2</a>; i++)
<a name="l00965"></a>00965     {
<a name="l00966"></a>00966       <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Number of %s routes: %d%s&quot;</span>,
<a name="l00967"></a>00967                <a class="code" href="ospf6__route_8h.html#aa450597cf8eef04535375a88c66bde88">OSPF6_PATH_TYPE_NAME</a> (i), pathtype[i], <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l00968"></a>00968     }
<a name="l00969"></a>00969 }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00972"></a><a class="code" href="ospf6__route_8c.html#aedac939c1185474baca0d8522d85770b">00972</a> <a class="code" href="ospf6__route_8c.html#aedac939c1185474baca0d8522d85770b">ospf6_route_show_table_prefix</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>,
<a name="l00973"></a>00973                                <span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *<a class="code" href="structprefix.html">prefix</a>,
<a name="l00974"></a>00974                                <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l00975"></a>00975 {
<a name="l00976"></a>00976   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route;
<a name="l00977"></a>00977 
<a name="l00978"></a>00978   route = <a class="code" href="ospf6__route_8c.html#aa7d8f56a2e18e2dc561dfda78a980fb2">ospf6_route_lookup</a> (prefix, table);
<a name="l00979"></a>00979   <span class="keywordflow">if</span> (route == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00980"></a>00980     <span class="keywordflow">return</span>;
<a name="l00981"></a>00981 
<a name="l00982"></a>00982   <a class="code" href="ospf6__route_8c.html#a0ad7c43050f40ca3637220835928c2af">ospf6_route_lock</a> (route);
<a name="l00983"></a>00983   <span class="keywordflow">while</span> (route &amp;&amp; <a class="code" href="ospf6__route_8h.html#a0a95fc057a8b281526dc83bdda838baf">ospf6_route_is_prefix</a> (prefix, route))
<a name="l00984"></a>00984     {
<a name="l00985"></a>00985       <span class="comment">/* Specifying a prefix will always display details */</span>
<a name="l00986"></a>00986       <a class="code" href="ospf6__route_8c.html#a8aa84829fb3ba1693d7c1d020844a606">ospf6_route_show_detail</a> (vty, route);
<a name="l00987"></a>00987       route = <a class="code" href="ospf6__route_8c.html#a4cdecc41a86097a7d0871397f7a80fb8">ospf6_route_next</a> (route);
<a name="l00988"></a>00988     }
<a name="l00989"></a>00989   <span class="keywordflow">if</span> (route)
<a name="l00990"></a>00990     <a class="code" href="ospf6__route_8c.html#ae0268d845495f56740dbf46b80489b0c">ospf6_route_unlock</a> (route);
<a name="l00991"></a>00991 }
<a name="l00992"></a>00992 
<a name="l00993"></a>00993 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00994"></a><a class="code" href="ospf6__route_8c.html#af57cbe250fad712f581275018c2aaa32">00994</a> <a class="code" href="ospf6__route_8c.html#af57cbe250fad712f581275018c2aaa32">ospf6_route_show_table_address</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>,
<a name="l00995"></a>00995                                 <span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *<a class="code" href="structprefix.html">prefix</a>,
<a name="l00996"></a>00996                                 <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l00997"></a>00997 {
<a name="l00998"></a>00998   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route;
<a name="l00999"></a>00999 
<a name="l01000"></a>01000   route = <a class="code" href="ospf6__route_8c.html#ad09379fefd4d4c2cf9af55345000d9cf">ospf6_route_lookup_bestmatch</a> (prefix, table);
<a name="l01001"></a>01001   <span class="keywordflow">if</span> (route == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01002"></a>01002     <span class="keywordflow">return</span>;
<a name="l01003"></a>01003 
<a name="l01004"></a>01004   prefix = &amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>;
<a name="l01005"></a>01005   <a class="code" href="ospf6__route_8c.html#a0ad7c43050f40ca3637220835928c2af">ospf6_route_lock</a> (route);
<a name="l01006"></a>01006   <span class="keywordflow">while</span> (route &amp;&amp; <a class="code" href="ospf6__route_8h.html#a0a95fc057a8b281526dc83bdda838baf">ospf6_route_is_prefix</a> (prefix, route))
<a name="l01007"></a>01007     {
<a name="l01008"></a>01008       <span class="comment">/* Specifying a prefix will always display details */</span>
<a name="l01009"></a>01009       <a class="code" href="ospf6__route_8c.html#a8aa84829fb3ba1693d7c1d020844a606">ospf6_route_show_detail</a> (vty, route);
<a name="l01010"></a>01010       route = <a class="code" href="ospf6__route_8c.html#a4cdecc41a86097a7d0871397f7a80fb8">ospf6_route_next</a> (route);
<a name="l01011"></a>01011     }
<a name="l01012"></a>01012   <span class="keywordflow">if</span> (route)
<a name="l01013"></a>01013     <a class="code" href="ospf6__route_8c.html#ae0268d845495f56740dbf46b80489b0c">ospf6_route_unlock</a> (route);
<a name="l01014"></a>01014 }
<a name="l01015"></a>01015 
<a name="l01016"></a>01016 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01017"></a><a class="code" href="ospf6__route_8c.html#af628a19cde541b495ecb1c36b4aa04e4">01017</a> <a class="code" href="ospf6__route_8c.html#af628a19cde541b495ecb1c36b4aa04e4">ospf6_route_show_table_match</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>, <span class="keywordtype">int</span> detail,
<a name="l01018"></a>01018                               <span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *<a class="code" href="structprefix.html">prefix</a>,
<a name="l01019"></a>01019                               <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l01020"></a>01020 {
<a name="l01021"></a>01021   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route;
<a name="l01022"></a>01022   <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (prefix-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>);
<a name="l01023"></a>01023 
<a name="l01024"></a>01024   route = <a class="code" href="ospf6__route_8c.html#aac8aa08a2c7dca4d417db4681b0529a0">ospf6_route_match_head</a> (prefix, table);
<a name="l01025"></a>01025   <span class="keywordflow">while</span> (route)
<a name="l01026"></a>01026     {
<a name="l01027"></a>01027       <span class="keywordflow">if</span> (detail)
<a name="l01028"></a>01028         <a class="code" href="ospf6__route_8c.html#a8aa84829fb3ba1693d7c1d020844a606">ospf6_route_show_detail</a> (vty, route);
<a name="l01029"></a>01029       <span class="keywordflow">else</span>
<a name="l01030"></a>01030         <a class="code" href="ospf6__route_8c.html#a1ff2114a5d187ef4c6285fa25c38642b">ospf6_route_show</a> (vty, route);
<a name="l01031"></a>01031       route = <a class="code" href="ospf6__route_8c.html#a944bc519c57314c58c6ca2043c5154cd">ospf6_route_match_next</a> (prefix, route);
<a name="l01032"></a>01032     }
<a name="l01033"></a>01033 }
<a name="l01034"></a>01034 
<a name="l01035"></a>01035 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01036"></a><a class="code" href="ospf6__route_8c.html#a5ed09a0bde6959f110fbe3944a5d8a2b">01036</a> <a class="code" href="ospf6__route_8c.html#a5ed09a0bde6959f110fbe3944a5d8a2b">ospf6_route_show_table_type</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>, <span class="keywordtype">int</span> detail, u_char <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a>,
<a name="l01037"></a>01037                              <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l01038"></a>01038 {
<a name="l01039"></a>01039   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route;
<a name="l01040"></a>01040 
<a name="l01041"></a>01041   route = <a class="code" href="ospf6__route_8c.html#a400d24a67548089d8a59242677ef33cf">ospf6_route_head</a> (table);
<a name="l01042"></a>01042   <span class="keywordflow">while</span> (route)
<a name="l01043"></a>01043     {
<a name="l01044"></a>01044       <span class="keywordflow">if</span> (route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a> == type)
<a name="l01045"></a>01045         {
<a name="l01046"></a>01046           <span class="keywordflow">if</span> (detail)
<a name="l01047"></a>01047             <a class="code" href="ospf6__route_8c.html#a8aa84829fb3ba1693d7c1d020844a606">ospf6_route_show_detail</a> (vty, route);
<a name="l01048"></a>01048           <span class="keywordflow">else</span>
<a name="l01049"></a>01049             <a class="code" href="ospf6__route_8c.html#a1ff2114a5d187ef4c6285fa25c38642b">ospf6_route_show</a> (vty, route);
<a name="l01050"></a>01050         }
<a name="l01051"></a>01051       route = <a class="code" href="ospf6__route_8c.html#a4cdecc41a86097a7d0871397f7a80fb8">ospf6_route_next</a> (route);
<a name="l01052"></a>01052     }
<a name="l01053"></a>01053 }
<a name="l01054"></a>01054 
<a name="l01055"></a>01055 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01056"></a><a class="code" href="ospf6__route_8c.html#ae83bdb775eb53a4ecb7186e1d918fb21">01056</a> <a class="code" href="ospf6__route_8c.html#ae83bdb775eb53a4ecb7186e1d918fb21">ospf6_route_show_table</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>, <span class="keywordtype">int</span> detail,
<a name="l01057"></a>01057                         <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l01058"></a>01058 {
<a name="l01059"></a>01059   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route;
<a name="l01060"></a>01060 
<a name="l01061"></a>01061   route = <a class="code" href="ospf6__route_8c.html#a400d24a67548089d8a59242677ef33cf">ospf6_route_head</a> (table);
<a name="l01062"></a>01062   <span class="keywordflow">while</span> (route)
<a name="l01063"></a>01063     {
<a name="l01064"></a>01064       <span class="keywordflow">if</span> (detail)
<a name="l01065"></a>01065         <a class="code" href="ospf6__route_8c.html#a8aa84829fb3ba1693d7c1d020844a606">ospf6_route_show_detail</a> (vty, route);
<a name="l01066"></a>01066       <span class="keywordflow">else</span>
<a name="l01067"></a>01067         <a class="code" href="ospf6__route_8c.html#a1ff2114a5d187ef4c6285fa25c38642b">ospf6_route_show</a> (vty, route);
<a name="l01068"></a>01068       route = <a class="code" href="ospf6__route_8c.html#a4cdecc41a86097a7d0871397f7a80fb8">ospf6_route_next</a> (route);
<a name="l01069"></a>01069     }
<a name="l01070"></a>01070 }
<a name="l01071"></a>01071 
<a name="l01072"></a>01072 <span class="keywordtype">int</span>
<a name="l01073"></a><a class="code" href="ospf6__route_8h.html#a84ceb3a14333bed003a1e1ea9cdc2058">01073</a> <a class="code" href="ospf6__route_8c.html#ad8dd248912104287781bf809f8f57a5d">ospf6_route_table_show</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>, <span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[],
<a name="l01074"></a>01074                         <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l01075"></a>01075 {
<a name="l01076"></a>01076   <span class="keywordtype">int</span> summary = 0;
<a name="l01077"></a>01077   <span class="keywordtype">int</span> match = 0;
<a name="l01078"></a>01078   <span class="keywordtype">int</span> detail = 0;
<a name="l01079"></a>01079   <span class="keywordtype">int</span> slash = 0;
<a name="l01080"></a>01080   <span class="keywordtype">int</span> isprefix = 0;
<a name="l01081"></a>01081   <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>, ret;
<a name="l01082"></a>01082   <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> prefix;
<a name="l01083"></a>01083   u_char <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a> = 0;
<a name="l01084"></a>01084 
<a name="l01085"></a>01085   memset (&amp;prefix, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> prefix));
<a name="l01086"></a>01086 
<a name="l01087"></a>01087   <span class="keywordflow">for</span> (i = 0; i &lt; argc; i++)
<a name="l01088"></a>01088     {
<a name="l01089"></a>01089       <span class="keywordflow">if</span> (! strcmp (argv[i], <span class="stringliteral">&quot;summary&quot;</span>))
<a name="l01090"></a>01090         {
<a name="l01091"></a>01091           summary++;
<a name="l01092"></a>01092           <span class="keywordflow">continue</span>;
<a name="l01093"></a>01093         }
<a name="l01094"></a>01094 
<a name="l01095"></a>01095       <span class="keywordflow">if</span> (! strcmp (argv[i], <span class="stringliteral">&quot;intra-area&quot;</span>))
<a name="l01096"></a>01096         {
<a name="l01097"></a>01097           type = <a class="code" href="ospf6__route_8h.html#a6cda40031860bfed6184599f4ac957ec">OSPF6_PATH_TYPE_INTRA</a>;
<a name="l01098"></a>01098           <span class="keywordflow">continue</span>;
<a name="l01099"></a>01099         }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101       <span class="keywordflow">if</span> (! strcmp (argv[i], <span class="stringliteral">&quot;inter-area&quot;</span>))
<a name="l01102"></a>01102         {
<a name="l01103"></a>01103           type = <a class="code" href="ospf6__route_8h.html#a47d0af1809c89bd797ef4c2c728220c6">OSPF6_PATH_TYPE_INTER</a>;
<a name="l01104"></a>01104           <span class="keywordflow">continue</span>;
<a name="l01105"></a>01105         }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107       <span class="keywordflow">if</span> (! strcmp (argv[i], <span class="stringliteral">&quot;external-1&quot;</span>))
<a name="l01108"></a>01108         {
<a name="l01109"></a>01109           type = <a class="code" href="ospf6__route_8h.html#ac93e11c1cfd47244e95e27b3ba4571ae">OSPF6_PATH_TYPE_EXTERNAL1</a>;
<a name="l01110"></a>01110           <span class="keywordflow">continue</span>;
<a name="l01111"></a>01111         }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113       <span class="keywordflow">if</span> (! strcmp (argv[i], <span class="stringliteral">&quot;external-2&quot;</span>))
<a name="l01114"></a>01114         {
<a name="l01115"></a>01115           type = <a class="code" href="ospf6__route_8h.html#a753677bbce3e5b4d74252300c43e422a">OSPF6_PATH_TYPE_EXTERNAL2</a>;
<a name="l01116"></a>01116           <span class="keywordflow">continue</span>;
<a name="l01117"></a>01117         }
<a name="l01118"></a>01118 
<a name="l01119"></a>01119       <span class="keywordflow">if</span> (! strcmp (argv[i], <span class="stringliteral">&quot;detail&quot;</span>))
<a name="l01120"></a>01120         {
<a name="l01121"></a>01121           detail++;
<a name="l01122"></a>01122           <span class="keywordflow">continue</span>;
<a name="l01123"></a>01123         }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125       <span class="keywordflow">if</span> (! strcmp (argv[i], <span class="stringliteral">&quot;match&quot;</span>))
<a name="l01126"></a>01126         {
<a name="l01127"></a>01127           match++;
<a name="l01128"></a>01128           <span class="keywordflow">continue</span>;
<a name="l01129"></a>01129         }
<a name="l01130"></a>01130 
<a name="l01131"></a>01131       ret = <a class="code" href="prefix_8c.html#a35f57d44562d00baaf5d227d03214786">str2prefix</a> (argv[i], &amp;prefix);
<a name="l01132"></a>01132       <span class="keywordflow">if</span> (ret == 1 &amp;&amp; prefix.<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6)
<a name="l01133"></a>01133         {
<a name="l01134"></a>01134           isprefix++;
<a name="l01135"></a>01135           <span class="keywordflow">if</span> (strchr (argv[i], <span class="charliteral">&#39;/&#39;</span>))
<a name="l01136"></a>01136             slash++;
<a name="l01137"></a>01137           <span class="keywordflow">continue</span>;
<a name="l01138"></a>01138         }
<a name="l01139"></a>01139 
<a name="l01140"></a>01140       <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Malformed argument: %s%s&quot;</span>, argv[i], <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l01141"></a>01141       <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l01142"></a>01142     }
<a name="l01143"></a>01143 
<a name="l01144"></a>01144   <span class="comment">/* Give summary of this route table */</span>
<a name="l01145"></a>01145   <span class="keywordflow">if</span> (summary)
<a name="l01146"></a>01146     {
<a name="l01147"></a>01147       <a class="code" href="ospf6__route_8c.html#a0d211a8759e8ffca98854d171496ce6e">ospf6_route_show_table_summary</a> (vty, table);
<a name="l01148"></a>01148       <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l01149"></a>01149     }
<a name="l01150"></a>01150 
<a name="l01151"></a>01151   <span class="comment">/* Give exact prefix-match route */</span>
<a name="l01152"></a>01152   <span class="keywordflow">if</span> (isprefix &amp;&amp; ! match)
<a name="l01153"></a>01153     {
<a name="l01154"></a>01154       <span class="comment">/* If exact address, give best matching route */</span>
<a name="l01155"></a>01155       <span class="keywordflow">if</span> (! slash)
<a name="l01156"></a>01156         <a class="code" href="ospf6__route_8c.html#af57cbe250fad712f581275018c2aaa32">ospf6_route_show_table_address</a> (vty, &amp;prefix, table);
<a name="l01157"></a>01157       <span class="keywordflow">else</span>
<a name="l01158"></a>01158         <a class="code" href="ospf6__route_8c.html#aedac939c1185474baca0d8522d85770b">ospf6_route_show_table_prefix</a> (vty, &amp;prefix, table);
<a name="l01159"></a>01159 
<a name="l01160"></a>01160       <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l01161"></a>01161     }
<a name="l01162"></a>01162 
<a name="l01163"></a>01163   <span class="keywordflow">if</span> (match)
<a name="l01164"></a>01164     <a class="code" href="ospf6__route_8c.html#af628a19cde541b495ecb1c36b4aa04e4">ospf6_route_show_table_match</a> (vty, detail, &amp;prefix, table);
<a name="l01165"></a>01165   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type)
<a name="l01166"></a>01166     <a class="code" href="ospf6__route_8c.html#a5ed09a0bde6959f110fbe3944a5d8a2b">ospf6_route_show_table_type</a> (vty, detail, type, table);
<a name="l01167"></a>01167   <span class="keywordflow">else</span>
<a name="l01168"></a>01168     <a class="code" href="ospf6__route_8c.html#ae83bdb775eb53a4ecb7186e1d918fb21">ospf6_route_show_table</a> (vty, detail, table);
<a name="l01169"></a>01169 
<a name="l01170"></a>01170   <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l01171"></a>01171 }
<a name="l01172"></a>01172 
<a name="l01173"></a>01173 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01174"></a><a class="code" href="ospf6__route_8c.html#ad071f916d299d092204aa8d00515ecb3">01174</a> <a class="code" href="ospf6__route_8c.html#ad071f916d299d092204aa8d00515ecb3">ospf6_linkstate_show_header</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>)
<a name="l01175"></a>01175 {
<a name="l01176"></a>01176   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%-7s %-15s %-15s %-8s %-14s %s%s&quot;</span>,
<a name="l01177"></a>01177            <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;Router-ID&quot;</span>, <span class="stringliteral">&quot;Net-ID&quot;</span>, <span class="stringliteral">&quot;Rtr-Bits&quot;</span>, <span class="stringliteral">&quot;Options&quot;</span>, <span class="stringliteral">&quot;Cost&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l01178"></a>01178 }
<a name="l01179"></a>01179 
<a name="l01180"></a>01180 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01181"></a><a class="code" href="ospf6__route_8c.html#af9d3e316e5ab019787d232fa72a3f716">01181</a> <a class="code" href="ospf6__route_8c.html#af9d3e316e5ab019787d232fa72a3f716">ospf6_linkstate_show</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>, <span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route)
<a name="l01182"></a>01182 {
<a name="l01183"></a>01183   u_int32_t router, <a class="code" href="prefix_8h.html#a68c0ada54c6414ef00bca919465286ac">id</a>;
<a name="l01184"></a>01184   <span class="keywordtype">char</span> routername[16], idname[16], rbits[16], options[16];
<a name="l01185"></a>01185 
<a name="l01186"></a>01186   router = <a class="code" href="ospf6__route_8h.html#ab056946ac3b3ce6cc32c6eefa5a2f238">ospf6_linkstate_prefix_adv_router</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>);
<a name="l01187"></a>01187   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;router, routername, <span class="keyword">sizeof</span> (routername));
<a name="l01188"></a>01188   <span class="keywordtype">id</span> = <a class="code" href="ospf6__route_8h.html#a9a6edcbcd65205cf8454ae194f2c41b2">ospf6_linkstate_prefix_id</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>);
<a name="l01189"></a>01189   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;<span class="keywordtype">id</span>, idname, <span class="keyword">sizeof</span> (idname));
<a name="l01190"></a>01190 
<a name="l01191"></a>01191   <a class="code" href="ospf6__proto_8c.html#acfafe064fed258582397cfd39d7d69ba">ospf6_capability_printbuf</a> (route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ad4c22e82497e95ddac15345fbdf50245">router_bits</a>, rbits, sizeof (rbits));
<a name="l01192"></a>01192   <a class="code" href="ospf6__proto_8c.html#a70fba8cd2453bf33405c98ff2ff14a38">ospf6_options_printbuf</a> (route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a1c10b3d1f386486e496d7196ec16e5e5">options</a>, options, sizeof (options));
<a name="l01193"></a>01193 
<a name="l01194"></a>01194   <span class="keywordflow">if</span> (ntohl (<span class="keywordtype">id</span>))
<a name="l01195"></a>01195     <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%-7s %-15s %-15s %-8s %-14s %lu%s&quot;</span>,
<a name="l01196"></a>01196              <span class="stringliteral">&quot;Network&quot;</span>, routername, idname, rbits, options,
<a name="l01197"></a>01197              (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ab33bf3c3ce1f07b918167dbfa4af30e6">cost</a>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l01198"></a>01198   <span class="keywordflow">else</span>
<a name="l01199"></a>01199     <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%-7s %-15s %-15s %-8s %-14s %lu%s&quot;</span>,
<a name="l01200"></a>01200              <span class="stringliteral">&quot;Router&quot;</span>, routername, idname, rbits, options,
<a name="l01201"></a>01201              (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ab33bf3c3ce1f07b918167dbfa4af30e6">cost</a>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l01202"></a>01202 }
<a name="l01203"></a>01203 
<a name="l01204"></a>01204 
<a name="l01205"></a>01205 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01206"></a><a class="code" href="ospf6__route_8c.html#ada26d1dbfdad8538591f47cc732b47ad">01206</a> <a class="code" href="ospf6__route_8c.html#ada26d1dbfdad8538591f47cc732b47ad">ospf6_linkstate_show_table_exact</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>,
<a name="l01207"></a>01207                                   <span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *<a class="code" href="structprefix.html">prefix</a>,
<a name="l01208"></a>01208                                   <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *table)
<a name="l01209"></a>01209 {
<a name="l01210"></a>01210   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route;
<a name="l01211"></a>01211 
<a name="l01212"></a>01212   route = <a class="code" href="ospf6__route_8c.html#aa7d8f56a2e18e2dc561dfda78a980fb2">ospf6_route_lookup</a> (prefix, table);
<a name="l01213"></a>01213   <span class="keywordflow">if</span> (route == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01214"></a>01214     <span class="keywordflow">return</span>;
<a name="l01215"></a>01215 
<a name="l01216"></a>01216   <a class="code" href="ospf6__route_8c.html#a0ad7c43050f40ca3637220835928c2af">ospf6_route_lock</a> (route);
<a name="l01217"></a>01217   <span class="keywordflow">while</span> (route &amp;&amp; <a class="code" href="ospf6__route_8h.html#a0a95fc057a8b281526dc83bdda838baf">ospf6_route_is_prefix</a> (prefix, route))
<a name="l01218"></a>01218     {
<a name="l01219"></a>01219       <span class="comment">/* Specifying a prefix will always display details */</span>
<a name="l01220"></a>01220       <a class="code" href="ospf6__route_8c.html#a8aa84829fb3ba1693d7c1d020844a606">ospf6_route_show_detail</a> (vty, route);
<a name="l01221"></a>01221       route = <a class="code" href="ospf6__route_8c.html#a4cdecc41a86097a7d0871397f7a80fb8">ospf6_route_next</a> (route);
<a name="l01222"></a>01222     }
<a name="l01223"></a>01223   <span class="keywordflow">if</span> (route)
<a name="l01224"></a>01224     <a class="code" href="ospf6__route_8c.html#ae0268d845495f56740dbf46b80489b0c">ospf6_route_unlock</a> (route);
<a name="l01225"></a>01225 }
<a name="l01226"></a>01226 
<a name="l01227"></a>01227 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01228"></a><a class="code" href="ospf6__route_8c.html#aafa93a7d8c1acfe3d0e153ff9dd7af01">01228</a> <a class="code" href="ospf6__route_8c.html#aafa93a7d8c1acfe3d0e153ff9dd7af01">ospf6_linkstate_show_table</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>, <span class="keywordtype">int</span> detail,
<a name="l01229"></a>01229                             <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l01230"></a>01230 {
<a name="l01231"></a>01231   <span class="keyword">struct </span><a class="code" href="structospf6__route.html">ospf6_route</a> *route;
<a name="l01232"></a>01232 
<a name="l01233"></a>01233   <span class="keywordflow">if</span> (! detail)
<a name="l01234"></a>01234     <a class="code" href="ospf6__route_8c.html#ad071f916d299d092204aa8d00515ecb3">ospf6_linkstate_show_header</a> (vty);
<a name="l01235"></a>01235 
<a name="l01236"></a>01236   route = <a class="code" href="ospf6__route_8c.html#a400d24a67548089d8a59242677ef33cf">ospf6_route_head</a> (table);
<a name="l01237"></a>01237   <span class="keywordflow">while</span> (route)
<a name="l01238"></a>01238     {
<a name="l01239"></a>01239       <span class="keywordflow">if</span> (detail)
<a name="l01240"></a>01240         <a class="code" href="ospf6__route_8c.html#a8aa84829fb3ba1693d7c1d020844a606">ospf6_route_show_detail</a> (vty, route);
<a name="l01241"></a>01241       <span class="keywordflow">else</span>
<a name="l01242"></a>01242         <a class="code" href="ospf6__route_8c.html#af9d3e316e5ab019787d232fa72a3f716">ospf6_linkstate_show</a> (vty, route);
<a name="l01243"></a>01243       route = <a class="code" href="ospf6__route_8c.html#a4cdecc41a86097a7d0871397f7a80fb8">ospf6_route_next</a> (route);
<a name="l01244"></a>01244     }
<a name="l01245"></a>01245 }
<a name="l01246"></a>01246 
<a name="l01247"></a>01247 <span class="keywordtype">int</span>
<a name="l01248"></a><a class="code" href="ospf6__route_8h.html#a6f3eeb015410531936d5df6aaa00ce4f">01248</a> <a class="code" href="ospf6__route_8c.html#a6f3eeb015410531936d5df6aaa00ce4f">ospf6_linkstate_table_show</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>, <span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[],
<a name="l01249"></a>01249                             <span class="keyword">struct</span> <a class="code" href="structospf6__route__table.html">ospf6_route_table</a> *<a class="code" href="structospf6__route.html#a2d99ee3cfa2172978768a500be5b7437">table</a>)
<a name="l01250"></a>01250 {
<a name="l01251"></a>01251   <span class="keywordtype">int</span> detail = 0;
<a name="l01252"></a>01252   <span class="keywordtype">int</span> is_id = 0;
<a name="l01253"></a>01253   <span class="keywordtype">int</span> is_router = 0;
<a name="l01254"></a>01254   <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>, ret;
<a name="l01255"></a>01255   <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> router, id, prefix;
<a name="l01256"></a>01256 
<a name="l01257"></a>01257   memset (&amp;router, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> prefix));
<a name="l01258"></a>01258   memset (&amp;<span class="keywordtype">id</span>, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> prefix));
<a name="l01259"></a>01259   memset (&amp;prefix, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> prefix));
<a name="l01260"></a>01260 
<a name="l01261"></a>01261   <span class="keywordflow">for</span> (i = 0; i &lt; argc; i++)
<a name="l01262"></a>01262     {
<a name="l01263"></a>01263       <span class="keywordflow">if</span> (! strcmp (argv[i], <span class="stringliteral">&quot;detail&quot;</span>))
<a name="l01264"></a>01264         {
<a name="l01265"></a>01265           detail++;
<a name="l01266"></a>01266           <span class="keywordflow">continue</span>;
<a name="l01267"></a>01267         }
<a name="l01268"></a>01268 
<a name="l01269"></a>01269       <span class="keywordflow">if</span> (! is_router)
<a name="l01270"></a>01270         {
<a name="l01271"></a>01271           ret = <a class="code" href="prefix_8c.html#a35f57d44562d00baaf5d227d03214786">str2prefix</a> (argv[i], &amp;router);
<a name="l01272"></a>01272           <span class="keywordflow">if</span> (ret == 1 &amp;&amp; router.<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET)
<a name="l01273"></a>01273             {
<a name="l01274"></a>01274               is_router++;
<a name="l01275"></a>01275               <span class="keywordflow">continue</span>;
<a name="l01276"></a>01276             }
<a name="l01277"></a>01277           <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Malformed argument: %s%s&quot;</span>, argv[i], <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l01278"></a>01278           <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l01279"></a>01279         }
<a name="l01280"></a>01280 
<a name="l01281"></a>01281       <span class="keywordflow">if</span> (! is_id)
<a name="l01282"></a>01282         {
<a name="l01283"></a>01283           ret = <a class="code" href="prefix_8c.html#a35f57d44562d00baaf5d227d03214786">str2prefix</a> (argv[i], &amp;<span class="keywordtype">id</span>);
<a name="l01284"></a>01284           <span class="keywordflow">if</span> (ret == 1 &amp;&amp; <span class="keywordtype">id</span>.<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET)
<a name="l01285"></a>01285             {
<a name="l01286"></a>01286               is_id++;
<a name="l01287"></a>01287               <span class="keywordflow">continue</span>;
<a name="l01288"></a>01288             }
<a name="l01289"></a>01289           <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Malformed argument: %s%s&quot;</span>, argv[i], <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l01290"></a>01290           <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l01291"></a>01291         }
<a name="l01292"></a>01292 
<a name="l01293"></a>01293       <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;Malformed argument: %s%s&quot;</span>, argv[i], <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l01294"></a>01294       <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l01295"></a>01295     }
<a name="l01296"></a>01296 
<a name="l01297"></a>01297   <span class="keywordflow">if</span> (is_router)
<a name="l01298"></a>01298     <a class="code" href="ospf6__route_8c.html#a5190b1a4d8babac390d4504e6119ffde">ospf6_linkstate_prefix</a> (router.u.<a class="code" href="structprefix.html#ab37b8922554b41b7dc2417d8f37e7829">prefix4</a>.s_addr,
<a name="l01299"></a>01299                             <span class="keywordtype">id</span>.u.prefix4.s_addr, &amp;prefix);
<a name="l01300"></a>01300 
<a name="l01301"></a>01301   <span class="keywordflow">if</span> (prefix.<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>)
<a name="l01302"></a>01302     <a class="code" href="ospf6__route_8c.html#ada26d1dbfdad8538591f47cc732b47ad">ospf6_linkstate_show_table_exact</a> (vty, &amp;prefix, table);
<a name="l01303"></a>01303   <span class="keywordflow">else</span>
<a name="l01304"></a>01304     <a class="code" href="ospf6__route_8c.html#aafa93a7d8c1acfe3d0e153ff9dd7af01">ospf6_linkstate_show_table</a> (vty, detail, table);
<a name="l01305"></a>01305 
<a name="l01306"></a>01306   <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l01307"></a>01307 }
<a name="l01308"></a>01308 
<a name="l01309"></a>01309 
<a name="l01310"></a>01310 <span class="keywordtype">void</span>
<a name="l01311"></a><a class="code" href="ospf6__route_8h.html#aa4066ae715d8d2937f584483a2218dc4">01311</a> <a class="code" href="ospf6__route_8c.html#aa4066ae715d8d2937f584483a2218dc4">ospf6_brouter_show_header</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>)
<a name="l01312"></a>01312 {
<a name="l01313"></a>01313   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%-15s %-8s %-14s %-10s %-15s%s&quot;</span>,
<a name="l01314"></a>01314            <span class="stringliteral">&quot;Router-ID&quot;</span>, <span class="stringliteral">&quot;Rtr-Bits&quot;</span>, <span class="stringliteral">&quot;Options&quot;</span>, <span class="stringliteral">&quot;Path-Type&quot;</span>, <span class="stringliteral">&quot;Area&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l01315"></a>01315 }
<a name="l01316"></a>01316 
<a name="l01317"></a>01317 <span class="keywordtype">void</span>
<a name="l01318"></a><a class="code" href="ospf6__route_8h.html#afd101ee59e80fde3535bad27b4266e64">01318</a> <a class="code" href="ospf6__route_8c.html#afd101ee59e80fde3535bad27b4266e64">ospf6_brouter_show</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>, <span class="keyword">struct</span> <a class="code" href="structospf6__route.html">ospf6_route</a> *route)
<a name="l01319"></a>01319 {
<a name="l01320"></a>01320   u_int32_t <a class="code" href="prefix_8h.html#aa4419784611184c74a36162ffcf0123d">adv_router</a>;
<a name="l01321"></a>01321   <span class="keywordtype">char</span> adv[16], rbits[16], options[16], <a class="code" href="ospf__vty_8c.html#a7030c85f46deeffac793079c664c14ce">area</a>[16];
<a name="l01322"></a>01322 
<a name="l01323"></a>01323   adv_router = <a class="code" href="ospf6__route_8h.html#ab056946ac3b3ce6cc32c6eefa5a2f238">ospf6_linkstate_prefix_adv_router</a> (&amp;route-&gt;<a class="code" href="structospf6__route.html#a39f2a986ed391c16d5216ad5797c2eda">prefix</a>);
<a name="l01324"></a>01324   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;adv_router, adv, <span class="keyword">sizeof</span> (adv));
<a name="l01325"></a>01325   <a class="code" href="ospf6__proto_8c.html#acfafe064fed258582397cfd39d7d69ba">ospf6_capability_printbuf</a> (route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ad4c22e82497e95ddac15345fbdf50245">router_bits</a>, rbits, sizeof (rbits));
<a name="l01326"></a>01326   <a class="code" href="ospf6__proto_8c.html#a70fba8cd2453bf33405c98ff2ff14a38">ospf6_options_printbuf</a> (route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a1c10b3d1f386486e496d7196ec16e5e5">options</a>, options, sizeof (options));
<a name="l01327"></a>01327   <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#ad4fc384dbcd343e1ba3e5918e4d25c15">area_id</a>, area, sizeof (area));
<a name="l01328"></a>01328 
<a name="l01329"></a>01329   <span class="comment">/* vty_out (vty, &quot;%-15s %-8s %-14s %-10s %-15s%s&quot;,</span>
<a name="l01330"></a>01330 <span class="comment">           &quot;Router-ID&quot;, &quot;Rtr-Bits&quot;, &quot;Options&quot;, &quot;Path-Type&quot;, &quot;Area&quot;, VNL); */</span>
<a name="l01331"></a>01331   <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%-15s %-8s %-14s %-10s %-15s%s&quot;</span>,
<a name="l01332"></a>01332            adv, rbits, options, <a class="code" href="ospf6__route_8h.html#aa450597cf8eef04535375a88c66bde88">OSPF6_PATH_TYPE_NAME</a> (route-&gt;<a class="code" href="structospf6__route.html#a5a6311b685c1d76468b47edb218bf4a5">path</a>.<a class="code" href="structospf6__path.html#a9cffc83cee981501db820772cab34b7e">type</a>),
<a name="l01333"></a>01333            area, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l01334"></a>01334 }
<a name="l01335"></a>01335 
<a name="l01336"></a><a class="code" href="ospf6__route_8c.html#a404b1ca0c2b25ce737b175a504167840">01336</a> <a class="code" href="command_8h.html#acc29190d35966eddbcfeceed3aab6d25">DEFUN</a> (debug_ospf6_route,
<a name="l01337"></a>01337        debug_ospf6_route_cmd,
<a name="l01338"></a>01338        <span class="stringliteral">&quot;debug ospf6 route (table|intra-area|inter-area)&quot;</span>,
<a name="l01339"></a>01339        <a class="code" href="command_8h.html#aa32f22e2cc4c90e73981459688712288">DEBUG_STR</a>
<a name="l01340"></a>01340        <a class="code" href="command_8h.html#a46e5b0a7baf38db964a69848c26aa96a">OSPF6_STR</a>
<a name="l01341"></a>01341        <span class="stringliteral">&quot;Debug route table calculation\n&quot;</span>
<a name="l01342"></a>01342        <span class="stringliteral">&quot;Debug detail\n&quot;</span>
<a name="l01343"></a>01343        <span class="stringliteral">&quot;Debug intra-area route calculation\n&quot;</span>
<a name="l01344"></a>01344        <span class="stringliteral">&quot;Debug inter-area route calculation\n&quot;</span>
<a name="l01345"></a>01345        )
<a name="l01346"></a>01346 {
<a name="l01347"></a>01347   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> level = 0;
<a name="l01348"></a>01348 
<a name="l01349"></a>01349   <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;table&quot;</span>, 5))
<a name="l01350"></a>01350     level = <a class="code" href="ospf6__route_8h.html#a36026ad398d9e5accb4a7a38e3356b10">OSPF6_DEBUG_ROUTE_TABLE</a>;
<a name="l01351"></a>01351   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;intra&quot;</span>, 5))
<a name="l01352"></a>01352     level = <a class="code" href="ospf6__route_8h.html#ae8dade70d28454d36847594d9c0e8ed2">OSPF6_DEBUG_ROUTE_INTRA</a>;
<a name="l01353"></a>01353   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;inter&quot;</span>, 5))
<a name="l01354"></a>01354     level = <a class="code" href="ospf6__route_8h.html#a00b335903e2a39615f5f59d6b1385f3b">OSPF6_DEBUG_ROUTE_INTER</a>;
<a name="l01355"></a>01355   <a class="code" href="ospf6__route_8h.html#ab859700c130bb1b56013e8891026c76d">OSPF6_DEBUG_ROUTE_ON</a> (level);
<a name="l01356"></a>01356   <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l01357"></a>01357 }
<a name="l01358"></a>01358 
<a name="l01359"></a><a class="code" href="ospf6__route_8c.html#a4487d6c8f94cb5991bc223d9ae0161fe">01359</a> <a class="code" href="command_8h.html#acc29190d35966eddbcfeceed3aab6d25">DEFUN</a> (no_debug_ospf6_route,
<a name="l01360"></a>01360        no_debug_ospf6_route_cmd,
<a name="l01361"></a>01361        <span class="stringliteral">&quot;no debug ospf6 route (table|intra-area|inter-area)&quot;</span>,
<a name="l01362"></a>01362        <a class="code" href="command_8h.html#a5b14384572729c1d1b3755d1bea1f17d">NO_STR</a>
<a name="l01363"></a>01363        <a class="code" href="command_8h.html#aa32f22e2cc4c90e73981459688712288">DEBUG_STR</a>
<a name="l01364"></a>01364        <a class="code" href="command_8h.html#a46e5b0a7baf38db964a69848c26aa96a">OSPF6_STR</a>
<a name="l01365"></a>01365        <span class="stringliteral">&quot;Debug route table calculation\n&quot;</span>
<a name="l01366"></a>01366        <span class="stringliteral">&quot;Debug intra-area route calculation\n&quot;</span>)
<a name="l01367"></a>01367 {
<a name="l01368"></a>01368   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> level = 0;
<a name="l01369"></a>01369 
<a name="l01370"></a>01370   <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;table&quot;</span>, 5))
<a name="l01371"></a>01371     level = <a class="code" href="ospf6__route_8h.html#a36026ad398d9e5accb4a7a38e3356b10">OSPF6_DEBUG_ROUTE_TABLE</a>;
<a name="l01372"></a>01372   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;intra&quot;</span>, 5))
<a name="l01373"></a>01373     level = <a class="code" href="ospf6__route_8h.html#ae8dade70d28454d36847594d9c0e8ed2">OSPF6_DEBUG_ROUTE_INTRA</a>;
<a name="l01374"></a>01374   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! strncmp (argv[0], <span class="stringliteral">&quot;inter&quot;</span>, 5))
<a name="l01375"></a>01375     level = <a class="code" href="ospf6__route_8h.html#a00b335903e2a39615f5f59d6b1385f3b">OSPF6_DEBUG_ROUTE_INTER</a>;
<a name="l01376"></a>01376   <a class="code" href="ospf6__route_8h.html#a47ae12ec36ce698f395a596050f10dc6">OSPF6_DEBUG_ROUTE_OFF</a> (level);
<a name="l01377"></a>01377   <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
<a name="l01378"></a>01378 }
<a name="l01379"></a>01379 
<a name="l01380"></a>01380 <span class="keywordtype">int</span>
<a name="l01381"></a><a class="code" href="ospf6__route_8h.html#abb73743d5ef4d6cf49bf47d1ae80ce5a">01381</a> <a class="code" href="ospf6__route_8c.html#abb73743d5ef4d6cf49bf47d1ae80ce5a">config_write_ospf6_debug_route</a> (<span class="keyword">struct</span> <a class="code" href="structvty.html">vty</a> *<a class="code" href="structvty.html">vty</a>)
<a name="l01382"></a>01382 {
<a name="l01383"></a>01383   <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (TABLE))
<a name="l01384"></a>01384     <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;debug ospf6 route table%s&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l01385"></a>01385   <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (INTRA))
<a name="l01386"></a>01386     <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;debug ospf6 route intra-area%s&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l01387"></a>01387   <span class="keywordflow">if</span> (<a class="code" href="ospf6__route_8h.html#a93829ee05fb7c64e1b29f7d808383383">IS_OSPF6_DEBUG_ROUTE</a> (INTER))
<a name="l01388"></a>01388     <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;debug ospf6 route inter-area%s&quot;</span>, <a class="code" href="ospf6d_8h.html#a356c06c82b90b274c7f519f9a405142c">VNL</a>);
<a name="l01389"></a>01389   <span class="keywordflow">return</span> 0;
<a name="l01390"></a>01390 }
<a name="l01391"></a>01391 
<a name="l01392"></a>01392 <span class="keywordtype">void</span>
<a name="l01393"></a><a class="code" href="ospf6__route_8h.html#a6b4b18309578a645c17cc6b15d9bfec8">01393</a> <a class="code" href="ospf6__route_8c.html#a6b4b18309578a645c17cc6b15d9bfec8">install_element_ospf6_debug_route</a> (<span class="keywordtype">void</span>)
<a name="l01394"></a>01394 {
<a name="l01395"></a>01395   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a8eeaebd59fec75e66abd261377c21a2d">ENABLE_NODE</a>, &amp;debug_ospf6_route_cmd);
<a name="l01396"></a>01396   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a8eeaebd59fec75e66abd261377c21a2d">ENABLE_NODE</a>, &amp;no_debug_ospf6_route_cmd);
<a name="l01397"></a>01397   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a50754044f565f7421a152eaa411eebcc">CONFIG_NODE</a>, &amp;debug_ospf6_route_cmd);
<a name="l01398"></a>01398   <a class="code" href="command_8c.html#af8546e314a1538d53ef78e4b02804f40">install_element</a> (<a class="code" href="command_8h.html#a6a276b85e2da28c5f9c3dbce61c55682a50754044f565f7421a152eaa411eebcc">CONFIG_NODE</a>, &amp;no_debug_ospf6_route_cmd);
<a name="l01399"></a>01399 }
<a name="l01400"></a>01400 
<a name="l01401"></a>01401 
<a name="l01402"></a>01402 
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ospf6__route_8c.html">ospf6_route.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:06 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
