<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: ospfd/ospf_neighbor.h File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ospf__neighbor_8h.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ospfd/ospf_neighbor.h File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="ospf__packet_8h_source.html">ospfd/ospf_packet.h</a>&gt;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ospf_neighbor.h:</div>
<div class="dyncontent">
<div class="center"><img src="ospf__neighbor_8h__incl.png" border="0" usemap="#ospfd_2ospf__neighbor_8h" alt=""/></div>
<map name="ospfd_2ospf__neighbor_8h" id="ospfd_2ospf__neighbor_8h">
<area shape="rect" id="node3" href="ospf__packet_8h.html" title="ospfd/ospf_packet.h" alt="" coords="11,80,157,107"/></map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="ospf__neighbor_8h__dep__incl.png" border="0" usemap="#ospfd_2ospf__neighbor_8hdep" alt=""/></div>
<map name="ospfd_2ospf__neighbor_8hdep" id="ospfd_2ospf__neighbor_8hdep">
<area shape="rect" id="node3" href="ospf__apiclient_8c.html" title="ospfclient/ospf_apiclient.c" alt="" coords="5,80,187,107"/><area shape="rect" id="node5" href="ospf__abr_8c.html" title="ospfd/ospf_abr.c" alt="" coords="211,80,335,107"/><area shape="rect" id="node7" href="ospf__asbr_8c.html" title="ospfd/ospf_asbr.c" alt="" coords="360,80,491,107"/><area shape="rect" id="node9" href="ospf__ase_8c.html" title="ospfd/ospf_ase.c" alt="" coords="515,80,641,107"/><area shape="rect" id="node11" href="ospf__dump_8c.html" title="ospfd/ospf_dump.c" alt="" coords="667,80,805,107"/><area shape="rect" id="node13" href="ospf__flood_8c.html" title="ospfd/ospf_flood.c" alt="" coords="829,80,965,107"/><area shape="rect" id="node15" href="ospf__ia_8c.html" title="ospfd/ospf_ia.c" alt="" coords="989,80,1104,107"/><area shape="rect" id="node17" href="ospf__interface_8c.html" title="ospfd/ospf_interface.c" alt="" coords="1129,80,1287,107"/><area shape="rect" id="node19" href="ospf__ism_8c.html" title="ospfd/ospf_ism.c" alt="" coords="1311,80,1437,107"/><area shape="rect" id="node21" href="ospf__lsa_8c.html" title="ospfd/ospf_lsa.c" alt="" coords="1463,80,1585,107"/><area shape="rect" id="node23" href="ospf__main_8c.html" title="ospfd/ospf_main.c" alt="" coords="1609,80,1743,107"/><area shape="rect" id="node25" href="ospf__neighbor_8c.html" title="ospfd/ospf_neighbor.c" alt="" coords="1767,80,1925,107"/><area shape="rect" id="node27" href="ospf__network_8c.html" title="ospfd/ospf_network.c" alt="" coords="1951,80,2105,107"/><area shape="rect" id="node29" href="ospf__nsm_8c.html" title="ospfd/ospf_nsm.c" alt="" coords="2129,80,2260,107"/><area shape="rect" id="node31" href="ospf__packet_8c.html" title="ospfd/ospf_packet.c" alt="" coords="2284,80,2431,107"/><area shape="rect" id="node33" href="ospf__spf_8c.html" title="ospfd/ospf_spf.c" alt="" coords="2455,80,2579,107"/><area shape="rect" id="node35" href="ospf__vty_8c.html" title="ospfd/ospf_vty.c" alt="" coords="2603,80,2727,107"/><area shape="rect" id="node37" href="ospfd_8c.html" title="ospfd/ospfd.c" alt="" coords="2752,80,2859,107"/></map>
</div>
</div>
<p><a href="ospf__neighbor_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structospf__neighbor.html">ospf_neighbor</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__neighbor_8h.html#ad422e372f51656c4649d96641b24f6e0">NBR_IS_DR</a>(<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>)&#160;&#160;&#160;IPV4_ADDR_SAME (&amp;<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>-&gt;<a class="el" href="prefix_8h.html#a08e40e2dbc7ccdbf7fb88358aead274e">address.u.prefix4</a>, &amp;<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>-&gt;d_router)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__neighbor_8h.html#a1b94db83d088198f33a207de991a5316">NBR_IS_BDR</a>(<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>)&#160;&#160;&#160;IPV4_ADDR_SAME (&amp;<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>-&gt;<a class="el" href="prefix_8h.html#a08e40e2dbc7ccdbf7fb88358aead274e">address.u.prefix4</a>, &amp;<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>-&gt;bd_router)</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__neighbor_8h.html#a61055a7caa840bab7fe67f1e8dacd3e9">ospf_nbr_new</a> (struct <a class="el" href="structospf__interface.html">ospf_interface</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__neighbor_8h.html#a6e9abc6c5c435f41e45743b991f8e11f">ospf_nbr_free</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__neighbor_8h.html#a5ca09047ca89c6e46059c0b0f4dd1c49">ospf_nbr_delete</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__neighbor_8h.html#a5ecaafa091dbe233567d67f588545221">ospf_nbr_bidirectional</a> (struct in_addr *, struct in_addr *, int)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__neighbor_8h.html#a0d5e36f67d1a0a4a381f00c2e0edf4a2">ospf_nbr_add_self</a> (struct <a class="el" href="structospf__interface.html">ospf_interface</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__neighbor_8h.html#ac16c769777de9bc112ebb22c014379a1">ospf_nbr_count</a> (struct <a class="el" href="structospf__interface.html">ospf_interface</a> *, int)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__neighbor_8h.html#a89e3df52ddc90c10ffd91d08784140a8">ospf_nbr_get</a> (struct <a class="el" href="structospf__interface.html">ospf_interface</a> *, struct <a class="el" href="structospf__header.html">ospf_header</a> *, struct <a class="el" href="spgrid_8c.html#addd335afdb9230f431842ebb6cbbce62">ip</a> *, struct <a class="el" href="structprefix.html">prefix</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__neighbor_8h.html#a58185a4bad05b3a279205b4e16de5683">ospf_nbr_lookup</a> (struct <a class="el" href="structospf__interface.html">ospf_interface</a> *, struct <a class="el" href="spgrid_8c.html#addd335afdb9230f431842ebb6cbbce62">ip</a> *, struct <a class="el" href="structospf__header.html">ospf_header</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__neighbor_8h.html#a2700f59c75fa92fccc94506be5a04d0c">ospf_nbr_lookup_by_addr</a> (struct <a class="el" href="structroute__table.html">route_table</a> *, struct in_addr *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__neighbor_8h.html#a0eba723573ec74c11313714e1e71cc5a">ospf_nbr_lookup_by_routerid</a> (struct <a class="el" href="structroute__table.html">route_table</a> *, struct in_addr *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__neighbor_8h.html#ad8a06eee7456a7316b7814eb0ef6f1c1">ospf_renegotiate_optional_capabilities</a> (struct <a class="el" href="structospf.html">ospf</a> *top)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a1b94db83d088198f33a207de991a5316"></a><!-- doxytag: member="ospf_neighbor.h::NBR_IS_BDR" ref="a1b94db83d088198f33a207de991a5316" args="(n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NBR_IS_BDR</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a></td><td>)</td>
          <td>&#160;&#160;&#160;IPV4_ADDR_SAME (&amp;<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>-&gt;<a class="el" href="prefix_8h.html#a08e40e2dbc7ccdbf7fb88358aead274e">address.u.prefix4</a>, &amp;<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>-&gt;bd_router)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__neighbor_8h_source.html#l00095">95</a> of file <a class="el" href="ospf__neighbor_8h_source.html">ospf_neighbor.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad422e372f51656c4649d96641b24f6e0"></a><!-- doxytag: member="ospf_neighbor.h::NBR_IS_DR" ref="ad422e372f51656c4649d96641b24f6e0" args="(n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NBR_IS_DR</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a></td><td>)</td>
          <td>&#160;&#160;&#160;IPV4_ADDR_SAME (&amp;<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>-&gt;<a class="el" href="prefix_8h.html#a08e40e2dbc7ccdbf7fb88358aead274e">address.u.prefix4</a>, &amp;<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>-&gt;d_router)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__neighbor_8h_source.html#l00094">94</a> of file <a class="el" href="ospf__neighbor_8h_source.html">ospf_neighbor.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a0d5e36f67d1a0a4a381f00c2e0edf4a2"></a><!-- doxytag: member="ospf_neighbor.h::ospf_nbr_add_self" ref="a0d5e36f67d1a0a4a381f00c2e0edf4a2" args="(struct ospf_interface *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_nbr_add_self </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__interface.html">ospf_interface</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__neighbor_8c_source.html#l00207">207</a> of file <a class="el" href="ospf__neighbor_8c_source.html">ospf_neighbor.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
  <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *rn;

  <span class="comment">/* Initial state */</span>
  oi-&gt;nbr_self-&gt;address = *oi-&gt;address;
  oi-&gt;nbr_self-&gt;priority = <a class="code" href="ospf__interface_8h.html#a3082a40385804021e56001ea2bc5bdb1">OSPF_IF_PARAM</a> (oi, priority);
  oi-&gt;nbr_self-&gt;router_id = oi-&gt;ospf-&gt;router_id;
  oi-&gt;nbr_self-&gt;src = oi-&gt;address-&gt;u.prefix4;
  oi-&gt;nbr_self-&gt;state = <a class="code" href="ospf__nsm_8h.html#a8a9d14bfc7d840e04eff13df3337fa24">NSM_TwoWay</a>;
  
  <span class="keywordflow">switch</span> (oi-&gt;area-&gt;external_routing)
    {
      <span class="keywordflow">case</span> <a class="code" href="ospfd_8h.html#a43f84c8e8584ccc8b82990d251abec4d">OSPF_AREA_DEFAULT</a>:
        <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (oi-&gt;nbr_self-&gt;options, <a class="code" href="ospfd_8h.html#a0cb690faccaae5c2692a2f2c1b273720">OSPF_OPTION_E</a>);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <a class="code" href="ospfd_8h.html#a34e738eee2ef9dfcea3d7f31d36de08c">OSPF_AREA_STUB</a>:
        <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (oi-&gt;nbr_self-&gt;options, <a class="code" href="ospfd_8h.html#a0cb690faccaae5c2692a2f2c1b273720">OSPF_OPTION_E</a>);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <a class="code" href="ospfd_8h.html#a871478d6ecced0907ee1f67c5dbacf99">OSPF_AREA_NSSA</a>:
        <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (oi-&gt;nbr_self-&gt;options, <a class="code" href="ospfd_8h.html#a0cb690faccaae5c2692a2f2c1b273720">OSPF_OPTION_E</a>);
        <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (oi-&gt;nbr_self-&gt;options, <a class="code" href="ospfd_8h.html#af9739335948debe99dd1e5e62d87c00c">OSPF_OPTION_NP</a>);
        <span class="keywordflow">break</span>;
    }
  
  <span class="comment">/* Add nbr_self to nbrs table */</span>
  <a class="code" href="ospf__neighbor_8c.html#af8485e20652f26e18ccb9725cc90f587">ospf_nbr_key</a> (oi, oi-&gt;nbr_self, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);
  
  rn = <a class="code" href="table_8c.html#ac91fdff1a0b8dc3d60ebaf152caa0f80">route_node_get</a> (oi-&gt;nbrs, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);
  <span class="keywordflow">if</span> (rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>)
    {
      <span class="comment">/* There is already pseudo neighbor. */</span>
      <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (oi-&gt;nbr_self == rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>);
      <a class="code" href="table_8c.html#a849965644708e01ef49c203a2e00afd4">route_unlock_node</a> (rn);
    }
  <span class="keywordflow">else</span>
    rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> = oi-&gt;nbr_self;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5ecaafa091dbe233567d67f588545221"></a><!-- doxytag: member="ospf_neighbor.h::ospf_nbr_bidirectional" ref="a5ecaafa091dbe233567d67f588545221" args="(struct in_addr *, struct in_addr *, int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ospf_nbr_bidirectional </td>
          <td>(</td>
          <td class="paramtype">struct in_addr *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__neighbor_8c_source.html#l00190">190</a> of file <a class="el" href="ospf__neighbor_8c_source.html">ospf_neighbor.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
  <span class="keywordtype">int</span> max;

  max = size / <span class="keyword">sizeof</span> (<span class="keyword">struct </span>in_addr);

  <span class="keywordflow">for</span> (i = 0; i &lt; max; i ++)
    <span class="keywordflow">if</span> (<a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a> (router_id, &amp;neighbors[i]))
      <span class="keywordflow">return</span> 1;

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac16c769777de9bc112ebb22c014379a1"></a><!-- doxytag: member="ospf_neighbor.h::ospf_nbr_count" ref="ac16c769777de9bc112ebb22c014379a1" args="(struct ospf_interface *, int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ospf_nbr_count </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__interface.html">ospf_interface</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__neighbor_8c_source.html#l00250">250</a> of file <a class="el" href="ospf__neighbor_8c_source.html">ospf_neighbor.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structospf__neighbor.html">ospf_neighbor</a> *nbr;
  <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *rn;
  <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a66e3fedede6aa372e5196e55e5e8d5c1">count</a> = 0;

  <span class="keywordflow">for</span> (rn = <a class="code" href="table_8c.html#aee1d06c531794df326d946bdac647fb2">route_top</a> (oi-&gt;nbrs); rn; rn = <a class="code" href="table_8c.html#ad2addc694ecf6cd0cce57cb3a7d96902">route_next</a> (rn))
    <span class="keywordflow">if</span> ((nbr = rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>))
      <span class="keywordflow">if</span> (!<a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a> (&amp;nbr-&gt;<a class="code" href="structospf__neighbor.html#a2257238c9040a76e9de9a78cf95bae0d">router_id</a>, &amp;oi-&gt;ospf-&gt;router_id))
    <span class="keywordflow">if</span> (state == 0 || nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a> == state)
      count++;

  <span class="keywordflow">return</span> <a class="code" href="spgrid_8c.html#a66e3fedede6aa372e5196e55e5e8d5c1">count</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5ca09047ca89c6e46059c0b0f4dd1c49"></a><!-- doxytag: member="ospf_neighbor.h::ospf_nbr_delete" ref="a5ca09047ca89c6e46059c0b0f4dd1c49" args="(struct ospf_neighbor *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_nbr_delete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__neighbor_8c_source.html#l00149">149</a> of file <a class="el" href="ospf__neighbor_8c_source.html">ospf_neighbor.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structospf__interface.html">ospf_interface</a> *oi;
  <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;

  oi = nbr-&gt;oi;
  
  <span class="comment">/* get appropriate prefix &#39;key&#39; */</span>
  <a class="code" href="ospf__neighbor_8c.html#af8485e20652f26e18ccb9725cc90f587">ospf_nbr_key</a> (oi, nbr, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);

  rn = <a class="code" href="table_8c.html#ab99d86b40440c8f18d4f2b31b5b8f1c7">route_node_lookup</a> (oi-&gt;nbrs, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);
  <span class="keywordflow">if</span> (rn)
    {
      <span class="comment">/* If lookup for a NBR succeeds, the leaf route_node could</span>
<span class="comment">       * only exist because there is (or was) a nbr there.</span>
<span class="comment">       * If the nbr was deleted, the leaf route_node should have</span>
<span class="comment">       * lost its last refcount too, and be deleted.</span>
<span class="comment">       * Therefore a looked-up leaf route_node in nbrs table</span>
<span class="comment">       * should never have NULL info.</span>
<span class="comment">       */</span>
      <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>);
      
      <span class="keywordflow">if</span> (rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>)
    {
      rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
      <a class="code" href="table_8c.html#a849965644708e01ef49c203a2e00afd4">route_unlock_node</a> (rn);
    }
      <span class="keywordflow">else</span>
    <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a> (<span class="stringliteral">&quot;Can&#39;t find neighbor %s in the interface %s&quot;</span>,
           inet_ntoa (nbr-&gt;src), <a class="code" href="ospf__dump_8h.html#a8617b8a577debdfb2cd2f08c41066497">IF_NAME</a> (oi));

      <a class="code" href="table_8c.html#a849965644708e01ef49c203a2e00afd4">route_unlock_node</a> (rn);
    }

  <span class="comment">/* Free ospf_neighbor structure. */</span>
  <a class="code" href="ospf__neighbor_8c.html#a6cacaea2728fb6f64caff42aa4d27df7">ospf_nbr_free</a> (nbr);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6e9abc6c5c435f41e45743b991f8e11f"></a><!-- doxytag: member="ospf_neighbor.h::ospf_nbr_free" ref="a6e9abc6c5c435f41e45743b991f8e11f" args="(struct ospf_neighbor *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_nbr_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__neighbor_8c_source.html#l00105">105</a> of file <a class="el" href="ospf__neighbor_8c_source.html">ospf_neighbor.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">/* Free DB summary list. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="ospf__nsm_8c.html#aa880af5829d8741b9012bf64e3c7a0c9">ospf_db_summary_count</a> (nbr))
    <a class="code" href="ospf__nsm_8c.html#a3f2d40c890bf5146459e631083a4677b">ospf_db_summary_clear</a> (nbr);
    <span class="comment">/* ospf_db_summary_delete_all (nbr); */</span>

  <span class="comment">/* Free ls request list. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="ospf__flood_8c.html#a9544780854006403934ea809e4e99caa">ospf_ls_request_count</a> (nbr))
    <a class="code" href="ospf__flood_8c.html#a90c072738e661b151c8fd6b180cb7fcd">ospf_ls_request_delete_all</a> (nbr);

  <span class="comment">/* Free retransmit list. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="ospf__flood_8c.html#a9fc5f626cdb9afa119113fb7a8b9daf2">ospf_ls_retransmit_count</a> (nbr))
    <a class="code" href="ospf__flood_8c.html#afa1fd3e1ddaf46a4674019b35f527667">ospf_ls_retransmit_clear</a> (nbr);

  <span class="comment">/* Cleanup LSDBs. */</span>
  <a class="code" href="ospf__lsdb_8c.html#a98d8e88a12546d5ad907691a3c8dd8d2">ospf_lsdb_cleanup</a> (&amp;nbr-&gt;db_sum);
  <a class="code" href="ospf__lsdb_8c.html#a98d8e88a12546d5ad907691a3c8dd8d2">ospf_lsdb_cleanup</a> (&amp;nbr-&gt;ls_req);
  <a class="code" href="ospf__lsdb_8c.html#a98d8e88a12546d5ad907691a3c8dd8d2">ospf_lsdb_cleanup</a> (&amp;nbr-&gt;ls_rxmt);
  
  <span class="comment">/* Clear last send packet. */</span>
  <span class="keywordflow">if</span> (nbr-&gt;last_send)
    <a class="code" href="ospf__packet_8c.html#a809c1e09677b5aaee9ed0c336a04a4c6">ospf_packet_free</a> (nbr-&gt;last_send);

  <span class="keywordflow">if</span> (nbr-&gt;nbr_nbma)
    {
      nbr-&gt;nbr_nbma-&gt;nbr = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
      nbr-&gt;nbr_nbma = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }

  <span class="comment">/* Cancel all timers. */</span>
  <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;t_inactivity);
  <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;t_db_desc);
  <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;t_ls_req);
  <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;t_ls_upd);

  <span class="comment">/* Cancel all events. */</span><span class="comment">/* Thread lookup cost would be negligible. */</span>
  <a class="code" href="thread_8c.html#a97786b4a047014e5b642219f1013e066">thread_cancel_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, nbr);

  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167bab58490337f5bf8a11d9b6ced5016d192">MTYPE_OSPF_NEIGHBOR</a>, nbr);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a89e3df52ddc90c10ffd91d08784140a8"></a><!-- doxytag: member="ospf_neighbor.h::ospf_nbr_get" ref="a89e3df52ddc90c10ffd91d08784140a8" args="(struct ospf_interface *, struct ospf_header *, struct ip *, struct prefix *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a>* ospf_nbr_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__interface.html">ospf_interface</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structospf__header.html">ospf_header</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="spgrid_8c.html#addd335afdb9230f431842ebb6cbbce62">ip</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__neighbor_8c_source.html#l00428">428</a> of file <a class="el" href="ospf__neighbor_8c_source.html">ospf_neighbor.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> <a class="code" href="structkey.html">key</a>;
  <span class="keyword">struct </span><a class="code" href="structospf__neighbor.html">ospf_neighbor</a> *nbr;
  
  <a class="code" href="structkey.html">key</a>.family = AF_INET;
  <a class="code" href="structkey.html">key</a>.prefixlen = <a class="code" href="prefix_8h.html#a9bd48f210d9f91d189e70196918f82c6">IPV4_MAX_BITLEN</a>;

  <span class="keywordflow">if</span> (<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#adb923b0bfebf30738af57dafcf0d0d57">type</a> == <a class="code" href="ospf__interface_8h.html#a45798a2a8b566abd1907f7ae8bc0a2be">OSPF_IFTYPE_VIRTUALLINK</a>)
    <a class="code" href="structkey.html">key</a>.u.prefix4 = ospfh-&gt;router_id;   <span class="comment">/* index vlink nbrs by router-id */</span>
  <span class="keywordflow">else</span>
    <a class="code" href="structkey.html">key</a>.u.prefix4 = iph-&gt;ip_src;

  rn = <a class="code" href="table_8c.html#ac91fdff1a0b8dc3d60ebaf152caa0f80">route_node_get</a> (<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#aeb2e2f33698c499957bb55bfc80835d9">nbrs</a>, &amp;<a class="code" href="structkey.html">key</a>);
  <span class="keywordflow">if</span> (rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>)
    {
      <a class="code" href="table_8c.html#a849965644708e01ef49c203a2e00afd4">route_unlock_node</a> (rn);
      nbr = rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>;
      
      <span class="keywordflow">if</span> (<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#adb923b0bfebf30738af57dafcf0d0d57">type</a> == <a class="code" href="ospf__interface_8h.html#abf2c650e64355936c071432d92dd5ecb">OSPF_IFTYPE_NBMA</a> &amp;&amp; nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a> == <a class="code" href="ospf__nsm_8h.html#a8151a9925f00bd1d3b3362a7557bab67">NSM_Attempt</a>)
        {
          nbr-&gt;<a class="code" href="structospf__neighbor.html#a959c002cab5b6328120fcac7ba25fbee">src</a> = iph-&gt;ip_src;
          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;nbr-&gt;<a class="code" href="structospf__neighbor.html#a4be3cd4b416bc267a4e3b35b9e2b1102">address</a>, <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, sizeof (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a>));
        }
    }
  <span class="keywordflow">else</span>
    {
      rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> = nbr = <a class="code" href="ospf__neighbor_8c.html#a5433e7b2194afa0cff866e8e0a46583a">ospf_nbr_add</a> (<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>, ospfh, <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);
    }
  
  nbr-&gt;<a class="code" href="structospf__neighbor.html#a2257238c9040a76e9de9a78cf95bae0d">router_id</a> = ospfh-&gt;router_id;

  <span class="keywordflow">return</span> nbr;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a58185a4bad05b3a279205b4e16de5683"></a><!-- doxytag: member="ospf_neighbor.h::ospf_nbr_lookup" ref="a58185a4bad05b3a279205b4e16de5683" args="(struct ospf_interface *, struct ip *, struct ospf_header *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a>* ospf_nbr_lookup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__interface.html">ospf_interface</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="spgrid_8c.html#addd335afdb9230f431842ebb6cbbce62">ip</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structospf__header.html">ospf_header</a> *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__neighbor_8c_source.html#l00375">375</a> of file <a class="el" href="ospf__neighbor_8c_source.html">ospf_neighbor.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#adb923b0bfebf30738af57dafcf0d0d57">type</a> == <a class="code" href="ospf__interface_8h.html#a45798a2a8b566abd1907f7ae8bc0a2be">OSPF_IFTYPE_VIRTUALLINK</a>)
    <span class="keywordflow">return</span> (<a class="code" href="ospf__neighbor_8c.html#a69530f1315a5a3c0c58662ef6ad4efa9">ospf_nbr_lookup_by_routerid</a> (<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#aeb2e2f33698c499957bb55bfc80835d9">nbrs</a>, &amp;ospfh-&gt;router_id));
  <span class="keywordflow">else</span>
    <span class="keywordflow">return</span> (<a class="code" href="ospf__neighbor_8c.html#a9530eac0c0816f41b9c9306a90db3b98">ospf_nbr_lookup_by_addr</a> (<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#aeb2e2f33698c499957bb55bfc80835d9">nbrs</a>, &amp;iph-&gt;ip_src));
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2700f59c75fa92fccc94506be5a04d0c"></a><!-- doxytag: member="ospf_neighbor.h::ospf_nbr_lookup_by_addr" ref="a2700f59c75fa92fccc94506be5a04d0c" args="(struct route_table *, struct in_addr *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a>* ospf_nbr_lookup_by_addr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structroute__table.html">route_table</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__neighbor_8c_source.html#l00289">289</a> of file <a class="el" href="ospf__neighbor_8c_source.html">ospf_neighbor.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
  <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structospf__neighbor.html">ospf_neighbor</a> *nbr;

  <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.family = AF_INET;
  <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.prefixlen = <a class="code" href="prefix_8h.html#a9bd48f210d9f91d189e70196918f82c6">IPV4_MAX_BITLEN</a>;
  <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.u.prefix4 = *addr;

  rn = <a class="code" href="table_8c.html#ab99d86b40440c8f18d4f2b31b5b8f1c7">route_node_lookup</a> (nbrs, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);
  <span class="keywordflow">if</span> (! rn)
    <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  
  <span class="comment">/* See comment in ospf_nbr_delete */</span>
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>);

  <span class="keywordflow">if</span> (rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      <a class="code" href="table_8c.html#a849965644708e01ef49c203a2e00afd4">route_unlock_node</a> (rn);
      <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }

  nbr = (<span class="keyword">struct </span><a class="code" href="structospf__neighbor.html">ospf_neighbor</a> *) rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>;
  <a class="code" href="table_8c.html#a849965644708e01ef49c203a2e00afd4">route_unlock_node</a> (rn);

  <span class="keywordflow">return</span> nbr;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0eba723573ec74c11313714e1e71cc5a"></a><!-- doxytag: member="ospf_neighbor.h::ospf_nbr_lookup_by_routerid" ref="a0eba723573ec74c11313714e1e71cc5a" args="(struct route_table *, struct in_addr *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a>* ospf_nbr_lookup_by_routerid </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structroute__table.html">route_table</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__neighbor_8c_source.html#l00320">320</a> of file <a class="el" href="ospf__neighbor_8c_source.html">ospf_neighbor.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structospf__neighbor.html">ospf_neighbor</a> *nbr;

  <span class="keywordflow">for</span> (rn = <a class="code" href="table_8c.html#aee1d06c531794df326d946bdac647fb2">route_top</a> (nbrs); rn; rn = <a class="code" href="table_8c.html#ad2addc694ecf6cd0cce57cb3a7d96902">route_next</a> (rn))
    <span class="keywordflow">if</span> ((nbr = rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>) != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
      <span class="keywordflow">if</span> (<a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a> (&amp;nbr-&gt;<a class="code" href="structospf__neighbor.html#a2257238c9040a76e9de9a78cf95bae0d">router_id</a>, <span class="keywordtype">id</span>))
    {
      <a class="code" href="table_8c.html#a849965644708e01ef49c203a2e00afd4">route_unlock_node</a>(rn);
      <span class="keywordflow">return</span> nbr;
    }

  <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a61055a7caa840bab7fe67f1e8dacd3e9"></a><!-- doxytag: member="ospf_neighbor.h::ospf_nbr_new" ref="a61055a7caa840bab7fe67f1e8dacd3e9" args="(struct ospf_interface *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a>* ospf_nbr_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__interface.html">ospf_interface</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__neighbor_8c_source.html#l00067">67</a> of file <a class="el" href="ospf__neighbor_8c_source.html">ospf_neighbor.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structospf__neighbor.html">ospf_neighbor</a> *nbr;

  <span class="comment">/* Allcate new neighbor. */</span>
  nbr = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167bab58490337f5bf8a11d9b6ced5016d192">MTYPE_OSPF_NEIGHBOR</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structospf__neighbor.html">ospf_neighbor</a>));

  <span class="comment">/* Relate neighbor to the interface. */</span>
  nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a> = <a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>;

  <span class="comment">/* Set default values. */</span>
  nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a> = <a class="code" href="ospf__nsm_8h.html#a4bdf4e7631050dcf28cbe7959f0675ce">NSM_Down</a>;

  <span class="comment">/* Set inheritance values. */</span>
  nbr-&gt;<a class="code" href="structospf__neighbor.html#a4e51d35a798becc9ffa76cda3462caaf">v_inactivity</a> = <a class="code" href="ospf__interface_8h.html#a3082a40385804021e56001ea2bc5bdb1">OSPF_IF_PARAM</a> (<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>, v_wait);
  nbr-&gt;<a class="code" href="structospf__neighbor.html#a9ba43b317ff6786a5885cc96e7e98a28">v_db_desc</a> = <a class="code" href="ospf__interface_8h.html#a3082a40385804021e56001ea2bc5bdb1">OSPF_IF_PARAM</a> (<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>, retransmit_interval);
  nbr-&gt;<a class="code" href="structospf__neighbor.html#a7f247fc2d724d69acef918ad766be6f6">v_ls_req</a> = <a class="code" href="ospf__interface_8h.html#a3082a40385804021e56001ea2bc5bdb1">OSPF_IF_PARAM</a> (<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>, retransmit_interval);
  nbr-&gt;<a class="code" href="structospf__neighbor.html#aae25ef8d8903b3aecf90a95b4c5c7bc3">v_ls_upd</a> = <a class="code" href="ospf__interface_8h.html#a3082a40385804021e56001ea2bc5bdb1">OSPF_IF_PARAM</a> (<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>, retransmit_interval);
  nbr-&gt;<a class="code" href="structospf__neighbor.html#ade51baa719592185df1db62d13e9cf63">priority</a> = -1;

  <span class="comment">/* DD flags. */</span>
  nbr-&gt;<a class="code" href="structospf__neighbor.html#afd7a64a3a213196cc5dd3c4c5b2e2a5b">dd_flags</a> = <a class="code" href="ospfd_8h.html#ab3fc3af333a4f7ffe2a5d89dd794c124">OSPF_DD_FLAG_MS</a>|<a class="code" href="ospfd_8h.html#a6b39a0f2e2f0415a60230aa869cabb48">OSPF_DD_FLAG_M</a>|<a class="code" href="ospfd_8h.html#afbd1b8930e1f40abaeaf47d3d978d21d">OSPF_DD_FLAG_I</a>;

  <span class="comment">/* Last received and sent DD. */</span>
  nbr-&gt;<a class="code" href="structospf__neighbor.html#ae5321e0cc874246d0002917b591ee3d0">last_send</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  nbr-&gt;<a class="code" href="structospf__neighbor.html#a68b82493dd68fd0a271db2e168c36617">nbr_nbma</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <a class="code" href="ospf__flood_8h.html#afcbf84e6f5791298594bbd311a3079d0">ospf_lsdb_init</a> (&amp;nbr-&gt;<a class="code" href="structospf__neighbor.html#aa9dff1f5ba19ec799c3dc9254b849049">db_sum</a>);
  <a class="code" href="ospf__flood_8h.html#afcbf84e6f5791298594bbd311a3079d0">ospf_lsdb_init</a> (&amp;nbr-&gt;<a class="code" href="structospf__neighbor.html#aaab4ea26de244d322ac4c82abb4defab">ls_rxmt</a>);
  <a class="code" href="ospf__flood_8h.html#afcbf84e6f5791298594bbd311a3079d0">ospf_lsdb_init</a> (&amp;nbr-&gt;<a class="code" href="structospf__neighbor.html#ac1ff0219316301982d09b282b86dc16d">ls_req</a>);

  nbr-&gt;<a class="code" href="structospf__neighbor.html#a20275ce82383ee306fddb23a4d6684ab">crypt_seqnum</a> = 0;

  <span class="keywordflow">return</span> nbr;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad8a06eee7456a7316b7814eb0ef6f1c1"></a><!-- doxytag: member="ospf_neighbor.h::ospf_renegotiate_optional_capabilities" ref="ad8a06eee7456a7316b7814eb0ef6f1c1" args="(struct ospf *top)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_renegotiate_optional_capabilities </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf.html">ospf</a> *&#160;</td>
          <td class="paramname"><em>top</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__neighbor_8c_source.html#l00338">338</a> of file <a class="el" href="ospf__neighbor_8c_source.html">ospf_neighbor.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node;
  <span class="keyword">struct </span><a class="code" href="structospf__interface.html">ospf_interface</a> *oi;
  <span class="keyword">struct </span><a class="code" href="structroute__table.html">route_table</a> *nbrs;
  <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structospf__neighbor.html">ospf_neighbor</a> *nbr;

  <span class="comment">/* At first, flush self-originated LSAs from routing domain. */</span>
  <a class="code" href="ospf__lsa_8c.html#a286fff473dd64a6db6e15d1a04f4b5b2">ospf_flush_self_originated_lsas_now</a> (top);

  <span class="comment">/* Revert all neighbor status to ExStart. */</span>
  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (top-&gt;<a class="code" href="structospf.html#a977d3608343fe5db7900ec646880cb6a">oiflist</a>, node, oi))
    {
      <span class="keywordflow">if</span> ((nbrs = oi-&gt;<a class="code" href="structospf__interface.html#aeb2e2f33698c499957bb55bfc80835d9">nbrs</a>) == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
        <span class="keywordflow">continue</span>;

      <span class="keywordflow">for</span> (rn = <a class="code" href="table_8c.html#aee1d06c531794df326d946bdac647fb2">route_top</a> (nbrs); rn; rn = <a class="code" href="table_8c.html#ad2addc694ecf6cd0cce57cb3a7d96902">route_next</a> (rn))
        {
          <span class="keywordflow">if</span> ((nbr = rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>) == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || nbr == oi-&gt;<a class="code" href="structospf__interface.html#a6450831debea20d192ad89e650d0edab">nbr_self</a>)
            <span class="keywordflow">continue</span>;

          <span class="keywordflow">if</span> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a> &lt; <a class="code" href="ospf__nsm_8h.html#aa02b0a534709b4557e46db7b31bbedd7">NSM_ExStart</a>)
            <span class="keywordflow">continue</span>;

          <span class="keywordflow">if</span> (<a class="code" href="ospf__dump_8h.html#a6634b26c3071a42864be94d63bfa8d27">IS_DEBUG_OSPF_EVENT</a>)
            <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Renegotiate optional capabilities with neighbor(%s)&quot;</span>, inet_ntoa (nbr-&gt;<a class="code" href="structospf__neighbor.html#a2257238c9040a76e9de9a78cf95bae0d">router_id</a>));

          <a class="code" href="ospf__nsm_8h.html#a1cb080254e9d0314d6ef4bc2c05e36b4">OSPF_NSM_EVENT_SCHEDULE</a> (nbr, <a class="code" href="ospf__nsm_8h.html#aab00c9e1d8f7f1c47e4e2d857a4753e3">NSM_SeqNumberMismatch</a>);
        }
    }

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ospf__neighbor_8h.html">ospf_neighbor.h</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:29 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
