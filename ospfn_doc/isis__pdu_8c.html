<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: isisd/isis_pdu.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('isis__pdu_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">isisd/isis_pdu.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="zebra_8h_source.html">zebra.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="memory_8h_source.html">memory.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="thread_8h_source.html">thread.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linklist_8h_source.html">linklist.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stream_8h_source.html">stream.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vty_8h_source.html">vty.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="hash_8c_source.html">hash.c</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="prefix_8h_source.html">prefix.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="if_8h_source.html">if.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="checksum_8h_source.html">checksum.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="dict_8h_source.html">isisd/dict.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="iso_8h_source.html">isisd/include-netbsd/iso.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__constants_8h_source.html">isisd/isis_constants.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__common_8h_source.html">isisd/isis_common.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__adjacency_8h_source.html">isisd/isis_adjacency.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__circuit_8h_source.html">isisd/isis_circuit.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__network_8h_source.html">isisd/isis_network.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__misc_8h_source.html">isisd/isis_misc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__dr_8h_source.html">isisd/isis_dr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__flags_8h_source.html">isisd/isis_flags.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__tlv_8h_source.html">isisd/isis_tlv.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isisd_8h_source.html">isisd/isisd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__dynhn_8h_source.html">isisd/isis_dynhn.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__lsp_8h_source.html">isisd/isis_lsp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__pdu_8h_source.html">isisd/isis_pdu.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="iso__checksum_8h_source.html">isisd/iso_checksum.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__csm_8h_source.html">isisd/isis_csm.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__events_8h_source.html">isisd/isis_events.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for isis_pdu.c:</div>
<div class="dyncontent">
<div class="center"><img src="isis__pdu_8c__incl.png" border="0" usemap="#isisd_2isis__pdu_8c" alt=""/></div>
<map name="isisd_2isis__pdu_8c" id="isisd_2isis__pdu_8c">
<area shape="rect" id="node3" href="zebra_8h.html" title="zebra.h" alt="" coords="909,155,976,181"/><area shape="rect" id="node45" href="memory_8h.html" title="memory.h" alt="" coords="1019,155,1101,181"/><area shape="rect" id="node47" href="thread_8h.html" title="thread.h" alt="" coords="1221,155,1293,181"/><area shape="rect" id="node49" href="linklist_8h.html" title="linklist.h" alt="" coords="1318,155,1388,181"/><area shape="rect" id="node51" href="log_8h.html" title="log.h" alt="" coords="1145,155,1196,181"/><area shape="rect" id="node54" href="stream_8h.html" title="stream.h" alt="" coords="1409,80,1484,107"/><area shape="rect" id="node56" href="prefix_8h.html" title="prefix.h" alt="" coords="1450,155,1517,181"/><area shape="rect" id="node58" href="vty_8h.html" title="vty.h" alt="" coords="1167,80,1219,107"/><area shape="rect" id="node62" href="hash_8c.html" title="hash.c" alt="" coords="980,80,1041,107"/><area shape="rect" id="node67" href="if_8h.html" title="if.h" alt="" coords="1295,80,1335,107"/><area shape="rect" id="node70" href="checksum_8h.html" title="checksum.h" alt="" coords="1559,80,1652,107"/><area shape="rect" id="node72" href="dict_8h.html" title="isisd/dict.h" alt="" coords="1677,80,1763,107"/><area shape="rect" id="node74" href="iso_8h.html" title="isisd/include&#45;netbsd/iso.h" alt="" coords="1788,80,1964,107"/><area shape="rect" id="node76" href="isis__constants_8h.html" title="isisd/isis_constants.h" alt="" coords="1989,80,2139,107"/><area shape="rect" id="node78" href="isis__common_8h.html" title="isisd/isis_common.h" alt="" coords="2163,80,2305,107"/><area shape="rect" id="node80" href="isis__adjacency_8h.html" title="isisd/isis_adjacency.h" alt="" coords="2330,80,2483,107"/><area shape="rect" id="node82" href="isis__circuit_8h.html" title="isisd/isis_circuit.h" alt="" coords="2507,80,2633,107"/><area shape="rect" id="node84" href="isis__network_8h.html" title="isisd/isis_network.h" alt="" coords="2658,80,2797,107"/><area shape="rect" id="node86" href="isis__misc_8h.html" title="isisd/isis_misc.h" alt="" coords="2822,80,2940,107"/><area shape="rect" id="node88" href="isis__dr_8h.html" title="isisd/isis_dr.h" alt="" coords="2965,80,3067,107"/><area shape="rect" id="node90" href="isis__flags_8h.html" title="isisd/isis_flags.h" alt="" coords="3092,80,3212,107"/><area shape="rect" id="node92" href="isis__tlv_8h.html" title="isisd/isis_tlv.h" alt="" coords="3236,80,3343,107"/><area shape="rect" id="node94" href="isisd_8h.html" title="isisd/isisd.h" alt="" coords="3367,80,3459,107"/><area shape="rect" id="node96" href="isis__dynhn_8h.html" title="isisd/isis_dynhn.h" alt="" coords="3483,80,3609,107"/><area shape="rect" id="node98" href="isis__lsp_8h.html" title="isisd/isis_lsp.h" alt="" coords="3635,80,3744,107"/><area shape="rect" id="node100" href="isis__pdu_8h.html" title="isisd/isis_pdu.h" alt="" coords="3768,80,3883,107"/><area shape="rect" id="node102" href="iso__checksum_8h.html" title="isisd/iso_checksum.h" alt="" coords="3907,80,4056,107"/><area shape="rect" id="node104" href="isis__csm_8h.html" title="isisd/isis_csm.h" alt="" coords="4081,80,4196,107"/><area shape="rect" id="node106" href="isis__events_8h.html" title="isisd/isis_events.h" alt="" coords="4221,80,4355,107"/></map>
</div>
</div>
<p><a href="isis__pdu_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#aca2aaedf29c85944f6063b91c0461b20">ISIS_MINIMUM_FIXED_HDR_LEN</a>&#160;&#160;&#160;15</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#ac2bed1172792ac0de1f61070ae90e647">ISIS_MIN_PDU_LEN</a>&#160;&#160;&#160;13</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a6f9a32b2fd315bf69360c883843e8699">PNBBY</a>&#160;&#160;&#160;8</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#ac44201d5d72450ec89f35a014c1e31c1">area_match</a> (struct <a class="el" href="structlist.html">list</a> *left, struct <a class="el" href="structlist.html">list</a> *right)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#ae727c7399fa6085b6d0ef021c52b887b">ip_same_subnet</a> (struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a> *ip1, struct in_addr *ip2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a7df02c36d437547a772bc406fc9594fb">ip_match</a> (struct <a class="el" href="structlist.html">list</a> *left, struct <a class="el" href="structlist.html">list</a> *right)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#ad3be9b74a266fca7d08e91ad3e4b0d45">accept_level</a> (int level, int <a class="el" href="isis__pdu_8h.html#a4237fb9b680bb5a92208b7e02eccb6a1">circuit_t</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#aefd5a8caa169a427e30d599b51ab52e9">authentication_check</a> (struct <a class="el" href="structisis__passwd.html">isis_passwd</a> *one, struct <a class="el" href="structisis__passwd.html">isis_passwd</a> *theother)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#afb3df247f88b4af648f1abf59f8a6044">tlvs_to_adj_nlpids</a> (struct <a class="el" href="structtlvs.html">tlvs</a> *<a class="el" href="structtlvs.html">tlvs</a>, struct <a class="el" href="structisis__adjacency.html">isis_adjacency</a> *adj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a1eb77861c826ae12837e4245dee655ae">del_ip_addr</a> (void *<a class="el" href="prefix_8h.html#a43e03366be2dd9176e91229d76541ce9">val</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#af96726be5388512e070368d2438bbf99">tlvs_to_adj_ipv4_addrs</a> (struct <a class="el" href="structtlvs.html">tlvs</a> *<a class="el" href="structtlvs.html">tlvs</a>, struct <a class="el" href="structisis__adjacency.html">isis_adjacency</a> *adj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#ae1ed5a5e3ac93396b812ac8d35186073">process_p2p_hello</a> (struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#adb45f30316e2d1fed63fc164d31657c1">process_lan_hello</a> (int level, struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, u_char *ssnpa)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#aa15bc068c8e49090fcf9268028d4fb03">process_lsp</a> (int level, struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, u_char *ssnpa)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a4e16ec0d4416a973611faf1d57beac3a">process_snp</a> (int snp_type, int level, struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, u_char *ssnpa)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#aae34abef6549bb3917ee120cb846bb41">process_csnp</a> (int level, struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, u_char *ssnpa)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a4341127ac99b45c32f8f35aa8bc277df">process_psnp</a> (int level, struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, u_char *ssnpa)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a91fbea5cc0d8560ca8d150743f5da79d">process_is_hello</a> (struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#acb5f4492a8f9bb27a780ebfe97934e85">isis_handle_pdu</a> (struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, u_char *ssnpa)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a75016a6ce480bc69cba2753bce7c52e1">isis_receive</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a5bb1429f6b41964f060f6abbfb50b5bf">fill_fixed_hdr</a> (struct <a class="el" href="structisis__fixed__hdr.html">isis_fixed_hdr</a> *hdr, u_char <a class="el" href="isis__pdu_8h.html#a171cfddbd6dabd8e34fb43da9912c3ca">pdu_type</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#adec6ead19bda8ae8f106249935b71552">fill_fixed_hdr_andstream</a> (struct <a class="el" href="structisis__fixed__hdr.html">isis_fixed_hdr</a> *hdr, u_char <a class="el" href="isis__pdu_8h.html#a171cfddbd6dabd8e34fb43da9912c3ca">pdu_type</a>, struct <a class="el" href="structstream.html">stream</a> *<a class="el" href="structstream.html">stream</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#ada46fc1940683eac5a47249f80f865b5">send_hello</a> (struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#ad38fe669ff232d9720882e210d46781d">send_lan_hello</a> (struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#ac3719e0f27b001ab4b863944a14d2727">send_lan_l1_hello</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a395c19db187c485c02eb41b63fc024ac">send_lan_l2_hello</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#add55c6255271cf958880489585619db9">send_p2p_hello</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a713bfb71ca33fedd6b66ea5e8ab8f21c">build_csnp</a> (int level, u_char *start, u_char *stop, struct <a class="el" href="structlist.html">list</a> *lsps, struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#ab75f3f062607df2c29d3ba4f4c2341dc">send_csnp</a> (struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#ab5830fef07f627c56ba857e36b108bac">send_l1_csnp</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a2a1bbd2f0b090ddcd6d6e87a7c352ca3">send_l2_csnp</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#acea9f4e378ed2d9b0e535fbd57172a42">build_psnp</a> (int level, struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, struct <a class="el" href="structlist.html">list</a> *lsps)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#ac55cfde4697927e6b91ef2296a57493c">send_psnp</a> (int level, struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a001cd2fbdf45b46870187e20b3cc7efc">send_l1_psnp</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#ada5c84113d20d6c83fce25bfea104e93">send_l2_psnp</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a23b42a7925a367125e6e0fa3db33f597">send_lsp</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a92677d57850d42c168f35387f9bcaeb8">ack_lsp</a> (struct <a class="el" href="structisis__link__state__hdr.html">isis_link_state_hdr</a> *hdr, struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, int level)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structthread__master.html">thread_master</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structisis.html">isis</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#aa8cfdc8f7777fd242bd2c45f3a48b950">isis</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const u_char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__pdu_8c.html#a675cc05c7391c1cd5e88ed25175ad5e1">maskbit</a> []</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ac2bed1172792ac0de1f61070ae90e647"></a><!-- doxytag: member="isis_pdu.c::ISIS_MIN_PDU_LEN" ref="ac2bed1172792ac0de1f61070ae90e647" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ISIS_MIN_PDU_LEN&#160;&#160;&#160;13</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00060">60</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>

</div>
</div>
<a class="anchor" id="aca2aaedf29c85944f6063b91c0461b20"></a><!-- doxytag: member="isis_pdu.c::ISIS_MINIMUM_FIXED_HDR_LEN" ref="aca2aaedf29c85944f6063b91c0461b20" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ISIS_MINIMUM_FIXED_HDR_LEN&#160;&#160;&#160;15</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00059">59</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6f9a32b2fd315bf69360c883843e8699"></a><!-- doxytag: member="isis_pdu.c::PNBBY" ref="a6f9a32b2fd315bf69360c883843e8699" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PNBBY&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00063">63</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ad3be9b74a266fca7d08e91ad3e4b0d45"></a><!-- doxytag: member="isis_pdu.c::accept_level" ref="ad3be9b74a266fca7d08e91ad3e4b0d45" args="(int level, int circuit_t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int accept_level </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>circuit_t</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00164">164</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> retval = ((<a class="code" href="isis__pdu_8h.html#a4237fb9b680bb5a92208b7e02eccb6a1">circuit_t</a> &amp; level) == level);  <span class="comment">/* simple approach */</span>

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a92677d57850d42c168f35387f9bcaeb8"></a><!-- doxytag: member="isis_pdu.c::ack_lsp" ref="a92677d57850d42c168f35387f9bcaeb8" args="(struct isis_link_state_hdr *hdr, struct isis_circuit *circuit, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ack_lsp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__link__state__hdr.html">isis_link_state_hdr</a> *&#160;</td>
          <td class="paramname"><em>hdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02550">2550</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> lenp;
  <span class="keywordtype">int</span> retval;
  u_int16_t <a class="code" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a>;
  <span class="keyword">struct </span><a class="code" href="structisis__fixed__hdr.html">isis_fixed_hdr</a> fixed_hdr;

  <span class="keywordflow">if</span> (!circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>)
    circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a> = <a class="code" href="stream_8c.html#a7117cdad9fa5e5ae633e0cf08d047459">stream_new</a> (<a class="code" href="isis__constants_8h.html#aa507eb18af6ca6d6db6e3db750ab0737">ISO_MTU</a> (circuit));
  <span class="keywordflow">else</span>
    <a class="code" href="stream_8c.html#aee8fd31485ebc2f0a556a6a5d5c2d1e6">stream_reset</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);

<span class="comment">//  fill_llc_hdr (stream);</span>
  <span class="keywordflow">if</span> (level == 1)
    <a class="code" href="isis__pdu_8c.html#adec6ead19bda8ae8f106249935b71552">fill_fixed_hdr_andstream</a> (&amp;fixed_hdr, <a class="code" href="isis__pdu_8h.html#acb5235709fbb83fee17285736e47f228">L1_PARTIAL_SEQ_NUM</a>,
                  circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
  <span class="keywordflow">else</span>
    <a class="code" href="isis__pdu_8c.html#adec6ead19bda8ae8f106249935b71552">fill_fixed_hdr_andstream</a> (&amp;fixed_hdr, <a class="code" href="isis__pdu_8h.html#a711a885da413c85c2add3efefec3a69f">L2_PARTIAL_SEQ_NUM</a>,
                  circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);


  lenp = <a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
  <a class="code" href="stream_8c.html#a03459a9331e0333d2b396636eca3c2e4">stream_putw</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, 0); <span class="comment">/* PDU length  */</span>
  <a class="code" href="stream_8c.html#a2f540a71efdf46e8c3a923f73e9f3b73">stream_put</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
  <a class="code" href="stream_8c.html#a8a00e56e71aed4753ee4a21f8dd2aa65">stream_putc</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#abac1ddd5e6459cc84fe32064f6643471">idx</a>);
  <a class="code" href="stream_8c.html#a8a00e56e71aed4753ee4a21f8dd2aa65">stream_putc</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, 9); <span class="comment">/* code */</span>
  <a class="code" href="stream_8c.html#a8a00e56e71aed4753ee4a21f8dd2aa65">stream_putc</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, 16);    <span class="comment">/* len */</span>

  <a class="code" href="stream_8c.html#a03459a9331e0333d2b396636eca3c2e4">stream_putw</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, ntohs (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>));
  <a class="code" href="stream_8c.html#a2f540a71efdf46e8c3a923f73e9f3b73">stream_put</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2);
  <a class="code" href="stream_8c.html#af366d780a14cb8de53279378a8a4faeb">stream_putl</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, ntohl (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>));
  <a class="code" href="stream_8c.html#a03459a9331e0333d2b396636eca3c2e4">stream_putw</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, ntohs (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>));

  length = (u_int16_t) <a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
  <span class="comment">/* Update PDU length */</span>
  <a class="code" href="stream_8c.html#a41de70a7383bac6220b787d740c0b261">stream_putw_at</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, lenp, length);

  retval = circuit-&gt;<a class="code" href="structisis__circuit.html#af17faf994f21d75da89129ed100cb71d">tx</a> (circuit, level);

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac44201d5d72450ec89f35a014c1e31c1"></a><!-- doxytag: member="isis_pdu.c::area_match" ref="ac44201d5d72450ec89f35a014c1e31c1" args="(struct list *left, struct list *right)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int area_match </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlist.html">list</a> *&#160;</td>
          <td class="paramname"><em>left</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist.html">list</a> *&#160;</td>
          <td class="paramname"><em>right</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00079">79</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structarea__addr.html">area_addr</a> *addr1, *addr2;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node1, *node2;

  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (left, node1, addr1))
  {
    <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (right, node2, addr2))
    {
      <span class="keywordflow">if</span> (addr1-&gt;<a class="code" href="structarea__addr.html#ae735a6ff10c8e48ebe4e98a06e194a82">addr_len</a> == addr2-&gt;<a class="code" href="structarea__addr.html#ae735a6ff10c8e48ebe4e98a06e194a82">addr_len</a> &amp;&amp;
      !<a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (addr1-&gt;<a class="code" href="structarea__addr.html#ac84395fbe3f40a45edf1d7ab43a701da">area_addr</a>, addr2-&gt;<a class="code" href="structarea__addr.html#ac84395fbe3f40a45edf1d7ab43a701da">area_addr</a>, (<span class="keywordtype">int</span>) addr1-&gt;<a class="code" href="structarea__addr.html#ae735a6ff10c8e48ebe4e98a06e194a82">addr_len</a>))
    <span class="keywordflow">return</span> 1;       <span class="comment">/* match */</span>
    }
  }

  <span class="keywordflow">return</span> 0;         <span class="comment">/* mismatch */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="aefd5a8caa169a427e30d599b51ab52e9"></a><!-- doxytag: member="isis_pdu.c::authentication_check" ref="aefd5a8caa169a427e30d599b51ab52e9" args="(struct isis_passwd *one, struct isis_passwd *theother)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int authentication_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__passwd.html">isis_passwd</a> *&#160;</td>
          <td class="paramname"><em>one</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__passwd.html">isis_passwd</a> *&#160;</td>
          <td class="paramname"><em>theother</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00172">172</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (one-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a> != theother-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Unsupported authentication type %d&quot;</span>, theother-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>);
      <span class="keywordflow">return</span> 1;         <span class="comment">/* Auth fail (different authentication types) */</span>
    }
  <span class="keywordflow">switch</span> (one-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>)
    {
    <span class="keywordflow">case</span> <a class="code" href="isis__common_8h.html#a1883f8c30a26198657877c3860ae1160">ISIS_PASSWD_TYPE_CLEARTXT</a>:
      <span class="keywordflow">if</span> (one-&gt;<a class="code" href="structisis__passwd.html#a3981443a6501783995b003ab8fd82f48">len</a> != theother-&gt;<a class="code" href="structisis__passwd.html#a3981443a6501783995b003ab8fd82f48">len</a>)
    <span class="keywordflow">return</span> 1;       <span class="comment">/* Auth fail () - passwd len mismatch */</span>
      <span class="keywordflow">return</span> <a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (one-&gt;<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>, theother-&gt;<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>, one-&gt;<a class="code" href="structisis__passwd.html#a3981443a6501783995b003ab8fd82f48">len</a>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Unsupported authentication type&quot;</span>);
      <span class="keywordflow">break</span>;
    }
  <span class="keywordflow">return</span> 0;         <span class="comment">/* Auth pass */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a713bfb71ca33fedd6b66ea5e8ab8f21c"></a><!-- doxytag: member="isis_pdu.c::build_csnp" ref="a713bfb71ca33fedd6b66ea5e8ab8f21c" args="(int level, u_char *start, u_char *stop, struct list *lsps, struct isis_circuit *circuit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int build_csnp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>stop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist.html">list</a> *&#160;</td>
          <td class="paramname"><em>lsps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02126">2126</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__fixed__hdr.html">isis_fixed_hdr</a> fixed_hdr;
  <span class="keyword">struct </span><a class="code" href="structisis__passwd.html">isis_passwd</a> *<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>;
  <span class="keywordtype">int</span> retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> lenp;
  u_int16_t <a class="code" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a>;

  <span class="keywordflow">if</span> (level == 1)
    <a class="code" href="isis__pdu_8c.html#adec6ead19bda8ae8f106249935b71552">fill_fixed_hdr_andstream</a> (&amp;fixed_hdr, <a class="code" href="isis__pdu_8h.html#acd69d37ac6c82a2f79d1790b258f35b4">L1_COMPLETE_SEQ_NUM</a>,
                  circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
  <span class="keywordflow">else</span>
    <a class="code" href="isis__pdu_8c.html#adec6ead19bda8ae8f106249935b71552">fill_fixed_hdr_andstream</a> (&amp;fixed_hdr, <a class="code" href="isis__pdu_8h.html#a56e28262496597ee720d611b16040847">L2_COMPLETE_SEQ_NUM</a>,
                  circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);

  <span class="comment">/*</span>
<span class="comment">   * Fill Level 1 or 2 Complete Sequence Numbers header</span>
<span class="comment">   */</span>

  lenp = <a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
  <a class="code" href="stream_8c.html#a03459a9331e0333d2b396636eca3c2e4">stream_putw</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, 0); <span class="comment">/* PDU length - when we know it */</span>
  <span class="comment">/* no need to send the source here, it is always us if we csnp */</span>
  <a class="code" href="stream_8c.html#a2f540a71efdf46e8c3a923f73e9f3b73">stream_put</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
  <span class="comment">/* with zero circuit id - ref 9.10, 9.11 */</span>
  <a class="code" href="stream_8c.html#a8a00e56e71aed4753ee4a21f8dd2aa65">stream_putc</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, 0x00);

  <a class="code" href="stream_8c.html#a2f540a71efdf46e8c3a923f73e9f3b73">stream_put</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, start, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2);
  <a class="code" href="stream_8c.html#a2f540a71efdf46e8c3a923f73e9f3b73">stream_put</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, stop, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2);

  <span class="comment">/*</span>
<span class="comment">   * And TLVs</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (level == 1)
    passwd = &amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#afb66934e4bd3bda094550517a94de442">area_passwd</a>;
  <span class="keywordflow">else</span>
    passwd = &amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a60cd44a3a31b36dc808ad3fd9efc97a0">domain_passwd</a>;

  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(passwd-&gt;<a class="code" href="structisis__passwd.html#ae05e8ad6fc2b30cdbb8c29196f120bdf">snp_auth</a>, <a class="code" href="isis__common_8h.html#a7f46c0cc8c90fa42f9d6c82abb532b74">SNP_AUTH_SEND</a>))
    <span class="keywordflow">if</span> (passwd-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>)
      retval = <a class="code" href="isis__tlv_8c.html#a02f053566530986751054dcf500af3a9">tlv_add_authinfo</a> (passwd-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>, passwd-&gt;<a class="code" href="structisis__passwd.html#a3981443a6501783995b003ab8fd82f48">len</a>,
                 passwd-&gt;<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);

  <span class="keywordflow">if</span> (!retval &amp;&amp; lsps)
    {
      retval = <a class="code" href="isis__tlv_8c.html#a1f29437b2c7ce6a210cee6cc9f9f920d">tlv_add_lsp_entries</a> (lsps, circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
    }
  length = (u_int16_t) <a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (length &gt;= <a class="code" href="isis__pdu_8h.html#ad643847e4f6bb080e2e6359abcad1c15">ISIS_CSNP_HDRLEN</a>);
  <span class="comment">/* Update PU length */</span>
  <a class="code" href="stream_8c.html#a41de70a7383bac6220b787d740c0b261">stream_putw_at</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, lenp, length);

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acea9f4e378ed2d9b0e535fbd57172a42"></a><!-- doxytag: member="isis_pdu.c::build_psnp" ref="acea9f4e378ed2d9b0e535fbd57172a42" args="(int level, struct isis_circuit *circuit, struct list *lsps)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int build_psnp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist.html">list</a> *&#160;</td>
          <td class="paramname"><em>lsps</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02282">2282</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__fixed__hdr.html">isis_fixed_hdr</a> fixed_hdr;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> lenp;
  u_int16_t <a class="code" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a>;
  <span class="keywordtype">int</span> retval = 0;
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;
  <span class="keyword">struct </span><a class="code" href="structisis__passwd.html">isis_passwd</a> *<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node;

  <span class="keywordflow">if</span> (level == 1)
    <a class="code" href="isis__pdu_8c.html#adec6ead19bda8ae8f106249935b71552">fill_fixed_hdr_andstream</a> (&amp;fixed_hdr, <a class="code" href="isis__pdu_8h.html#acb5235709fbb83fee17285736e47f228">L1_PARTIAL_SEQ_NUM</a>,
                  circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
  <span class="keywordflow">else</span>
    <a class="code" href="isis__pdu_8c.html#adec6ead19bda8ae8f106249935b71552">fill_fixed_hdr_andstream</a> (&amp;fixed_hdr, <a class="code" href="isis__pdu_8h.html#a711a885da413c85c2add3efefec3a69f">L2_PARTIAL_SEQ_NUM</a>,
                  circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);

  <span class="comment">/*</span>
<span class="comment">   * Fill Level 1 or 2 Partial Sequence Numbers header</span>
<span class="comment">   */</span>
  lenp = <a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
  <a class="code" href="stream_8c.html#a03459a9331e0333d2b396636eca3c2e4">stream_putw</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, 0); <span class="comment">/* PDU length - when we know it */</span>
  <a class="code" href="stream_8c.html#a2f540a71efdf46e8c3a923f73e9f3b73">stream_put</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
  <a class="code" href="stream_8c.html#a8a00e56e71aed4753ee4a21f8dd2aa65">stream_putc</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#abac1ddd5e6459cc84fe32064f6643471">idx</a>);

  <span class="comment">/*</span>
<span class="comment">   * And TLVs</span>
<span class="comment">   */</span>

  <span class="keywordflow">if</span> (level == 1)
    passwd = &amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#afb66934e4bd3bda094550517a94de442">area_passwd</a>;
  <span class="keywordflow">else</span>
    passwd = &amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a60cd44a3a31b36dc808ad3fd9efc97a0">domain_passwd</a>;

  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(passwd-&gt;<a class="code" href="structisis__passwd.html#ae05e8ad6fc2b30cdbb8c29196f120bdf">snp_auth</a>, <a class="code" href="isis__common_8h.html#a7f46c0cc8c90fa42f9d6c82abb532b74">SNP_AUTH_SEND</a>))
    <span class="keywordflow">if</span> (passwd-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>)
      retval = <a class="code" href="isis__tlv_8c.html#a02f053566530986751054dcf500af3a9">tlv_add_authinfo</a> (passwd-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>, passwd-&gt;<a class="code" href="structisis__passwd.html#a3981443a6501783995b003ab8fd82f48">len</a>,
                 passwd-&gt;<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);

  <span class="keywordflow">if</span> (!retval &amp;&amp; lsps)
    {
      retval = <a class="code" href="isis__tlv_8c.html#a1f29437b2c7ce6a210cee6cc9f9f920d">tlv_add_lsp_entries</a> (lsps, circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
    }

  <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#ab16b82eb25717295303c7099035d9dc9">DEBUG_SNP_PACKETS</a>)
    {
      <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (lsps, node, lsp))
      {
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s):         PSNP entry %s, seq 0x%08x,&quot;</span>
            <span class="stringliteral">&quot; cksum 0x%04x, lifetime %us&quot;</span>,
            circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
            <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
            ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>),
            ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>),
            ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>));
      }
    }

  length = (u_int16_t) <a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (length &gt;= <a class="code" href="isis__pdu_8h.html#aceab21fb8507148277e0980a0cd31a1e">ISIS_PSNP_HDRLEN</a>);
  <span class="comment">/* Update PDU length */</span>
  <a class="code" href="stream_8c.html#a41de70a7383bac6220b787d740c0b261">stream_putw_at</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, lenp, length);

  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1eb77861c826ae12837e4245dee655ae"></a><!-- doxytag: member="isis_pdu.c::del_ip_addr" ref="a1eb77861c826ae12837e4245dee655ae" args="(void *val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void del_ip_addr </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>val</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00217">217</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba80b5687b76c7243b1ec8be38fb740b3f">MTYPE_ISIS_TMP</a>, <a class="code" href="prefix_8h.html#a43e03366be2dd9176e91229d76541ce9">val</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5bb1429f6b41964f060f6abbfb50b5bf"></a><!-- doxytag: member="isis_pdu.c::fill_fixed_hdr" ref="a5bb1429f6b41964f060f6abbfb50b5bf" args="(struct isis_fixed_hdr *hdr, u_char pdu_type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fill_fixed_hdr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__fixed__hdr.html">isis_fixed_hdr</a> *&#160;</td>
          <td class="paramname"><em>hdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char&#160;</td>
          <td class="paramname"><em>pdu_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l01845">1845</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  memset (hdr, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structisis__fixed__hdr.html">isis_fixed_hdr</a>));

  hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#ab7d3a92cb745fd25d033e0daefca7f74">idrp</a> = <a class="code" href="iso_8h.html#a5246f338b99d70bb67f26fdbf2c25c8b">ISO10589_ISIS</a>;

  <span class="keywordflow">switch</span> (<a class="code" href="isis__pdu_8h.html#a171cfddbd6dabd8e34fb43da9912c3ca">pdu_type</a>)
    {
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#aaecfaf101078595ebfeed0bd1740932b">L1_LAN_HELLO</a>:
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#af62a8d7593e2fabd396e8dce9124d09d">L2_LAN_HELLO</a>:
      hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#acde2c4eefcd9af9aef447b106383b03e">length</a> = <a class="code" href="isis__pdu_8h.html#ae252f7eb62c9ee4fd050d82558623d39">ISIS_LANHELLO_HDRLEN</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#ac01a71c9cb0d66d483f5022d9812b4db">P2P_HELLO</a>:
      hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#acde2c4eefcd9af9aef447b106383b03e">length</a> = <a class="code" href="isis__pdu_8h.html#afc57a4bb656d257caa10f6a172006cd1">ISIS_P2PHELLO_HDRLEN</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#a37bd70be235d213245350209287f9d69">L1_LINK_STATE</a>:
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#a0078daf40d7e45a7bdbd26a016dde2da">L2_LINK_STATE</a>:
      hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#acde2c4eefcd9af9aef447b106383b03e">length</a> = <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#acd69d37ac6c82a2f79d1790b258f35b4">L1_COMPLETE_SEQ_NUM</a>:
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#a56e28262496597ee720d611b16040847">L2_COMPLETE_SEQ_NUM</a>:
      hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#acde2c4eefcd9af9aef447b106383b03e">length</a> = <a class="code" href="isis__pdu_8h.html#ad643847e4f6bb080e2e6359abcad1c15">ISIS_CSNP_HDRLEN</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#acb5235709fbb83fee17285736e47f228">L1_PARTIAL_SEQ_NUM</a>:
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#a711a885da413c85c2add3efefec3a69f">L2_PARTIAL_SEQ_NUM</a>:
      hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#acde2c4eefcd9af9aef447b106383b03e">length</a> = <a class="code" href="isis__pdu_8h.html#aceab21fb8507148277e0980a0cd31a1e">ISIS_PSNP_HDRLEN</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;fill_fixed_hdr(): unknown pdu type %d&quot;</span>, <a class="code" href="isis__pdu_8h.html#a171cfddbd6dabd8e34fb43da9912c3ca">pdu_type</a>);
      <span class="keywordflow">return</span>;
    }
  hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#acde2c4eefcd9af9aef447b106383b03e">length</a> += <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a>;
  hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#a6e0886d9e411e4f4ab9de644af8ee034">pdu_type</a> = <a class="code" href="isis__pdu_8h.html#a171cfddbd6dabd8e34fb43da9912c3ca">pdu_type</a>;
  hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#aae65a4fef2c1f3f7f5601da9fe5491c3">version1</a> = 1;
  hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#adbac4c42a022759367d1fd9a1fdb40f7">id_len</a> = 0;      <span class="comment">/* ISIS_SYS_ID_LEN -  0==6 */</span>
  hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#ab0240202f6415d4ad641b692615ed1eb">version2</a> = 1;
  hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#abf027a2ccc2b29a6b36cae277894f7c3">max_area_addrs</a> = 0;  <span class="comment">/* isis-&gt;max_area_addrs -  0==3 */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="adec6ead19bda8ae8f106249935b71552"></a><!-- doxytag: member="isis_pdu.c::fill_fixed_hdr_andstream" ref="adec6ead19bda8ae8f106249935b71552" args="(struct isis_fixed_hdr *hdr, u_char pdu_type, struct stream *stream)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void fill_fixed_hdr_andstream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__fixed__hdr.html">isis_fixed_hdr</a> *&#160;</td>
          <td class="paramname"><em>hdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char&#160;</td>
          <td class="paramname"><em>pdu_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structstream.html">stream</a> *&#160;</td>
          <td class="paramname"><em>stream</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l01888">1888</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="isis__pdu_8c.html#a5bb1429f6b41964f060f6abbfb50b5bf">fill_fixed_hdr</a> (hdr, <a class="code" href="isis__pdu_8h.html#a171cfddbd6dabd8e34fb43da9912c3ca">pdu_type</a>);

  <a class="code" href="stream_8c.html#a8a00e56e71aed4753ee4a21f8dd2aa65">stream_putc</a> (stream, hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#ab7d3a92cb745fd25d033e0daefca7f74">idrp</a>);
  <a class="code" href="stream_8c.html#a8a00e56e71aed4753ee4a21f8dd2aa65">stream_putc</a> (stream, hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#acde2c4eefcd9af9aef447b106383b03e">length</a>);
  <a class="code" href="stream_8c.html#a8a00e56e71aed4753ee4a21f8dd2aa65">stream_putc</a> (stream, hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#aae65a4fef2c1f3f7f5601da9fe5491c3">version1</a>);
  <a class="code" href="stream_8c.html#a8a00e56e71aed4753ee4a21f8dd2aa65">stream_putc</a> (stream, hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#adbac4c42a022759367d1fd9a1fdb40f7">id_len</a>);
  <a class="code" href="stream_8c.html#a8a00e56e71aed4753ee4a21f8dd2aa65">stream_putc</a> (stream, hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#a6e0886d9e411e4f4ab9de644af8ee034">pdu_type</a>);
  <a class="code" href="stream_8c.html#a8a00e56e71aed4753ee4a21f8dd2aa65">stream_putc</a> (stream, hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#ab0240202f6415d4ad641b692615ed1eb">version2</a>);
  <a class="code" href="stream_8c.html#a8a00e56e71aed4753ee4a21f8dd2aa65">stream_putc</a> (stream, hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#a4291f7b81ea45e9f30bf6c05f3190ed7">reserved</a>);
  <a class="code" href="stream_8c.html#a8a00e56e71aed4753ee4a21f8dd2aa65">stream_putc</a> (stream, hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#abf027a2ccc2b29a6b36cae277894f7c3">max_area_addrs</a>);

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7df02c36d437547a772bc406fc9594fb"></a><!-- doxytag: member="isis_pdu.c::ip_match" ref="a7df02c36d437547a772bc406fc9594fb" args="(struct list *left, struct list *right)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ip_match </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlist.html">list</a> *&#160;</td>
          <td class="paramname"><em>left</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist.html">list</a> *&#160;</td>
          <td class="paramname"><em>right</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00137">137</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structprefix__ipv4.html">prefix_ipv4</a> *ip1;
  <span class="keyword">struct </span>in_addr *ip2;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node1, *node2;

  <span class="keywordflow">if</span> ((left == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (right == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
    <span class="keywordflow">return</span> 0;
  
  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (left, node1, ip1))
  {
    <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (right, node2, ip2))
    {
      <span class="keywordflow">if</span> (<a class="code" href="isis__pdu_8c.html#ae727c7399fa6085b6d0ef021c52b887b">ip_same_subnet</a> (ip1, ip2))
    {
      <span class="keywordflow">return</span> 1;     <span class="comment">/* match */</span>
    }
    }

  }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae727c7399fa6085b6d0ef021c52b887b"></a><!-- doxytag: member="isis_pdu.c::ip_same_subnet" ref="ae727c7399fa6085b6d0ef021c52b887b" args="(struct prefix_ipv4 *ip1, struct in_addr *ip2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ip_same_subnet </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structprefix__ipv4.html">prefix_ipv4</a> *&#160;</td>
          <td class="paramname"><em>ip1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr *&#160;</td>
          <td class="paramname"><em>ip2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00105">105</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  u_char *addr1, *addr2;
  <span class="keywordtype">int</span> shift, offset, offsetloop;
  <span class="keywordtype">int</span> len;

  addr1 = (u_char *) &amp; ip1-&gt;prefix.s_addr;
  addr2 = (u_char *) &amp; ip2-&gt;s_addr;
  len = ip1-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a>;

  shift = len % <a class="code" href="isis__pdu_8c.html#a6f9a32b2fd315bf69360c883843e8699">PNBBY</a>;
  offsetloop = offset = len / <a class="code" href="isis__pdu_8c.html#a6f9a32b2fd315bf69360c883843e8699">PNBBY</a>;

  <span class="keywordflow">while</span> (offsetloop--)
    <span class="keywordflow">if</span> (addr1[offsetloop] != addr2[offsetloop])
      <span class="keywordflow">return</span> 0;

  <span class="keywordflow">if</span> (shift)
    <span class="keywordflow">if</span> (<a class="code" href="isis__pdu_8c.html#a675cc05c7391c1cd5e88ed25175ad5e1">maskbit</a>[shift] &amp; (addr1[offset] ^ addr2[offset]))
      <span class="keywordflow">return</span> 0;

  <span class="keywordflow">return</span> 1;         <span class="comment">/* match  */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="acb5f4492a8f9bb27a780ebfe97934e85"></a><!-- doxytag: member="isis_pdu.c::isis_handle_pdu" ref="acb5f4492a8f9bb27a780ebfe97934e85" args="(struct isis_circuit *circuit, u_char *ssnpa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int isis_handle_pdu </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>ssnpa</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l01649">1649</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__fixed__hdr.html">isis_fixed_hdr</a> *hdr;
  <span class="keyword">struct </span><a class="code" href="structesis__fixed__hdr.html">esis_fixed_hdr</a> *esis_hdr;

  <span class="keywordtype">int</span> retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;

  <span class="comment">/*</span>
<span class="comment">   * Let&#39;s first read data from stream to the header</span>
<span class="comment">   */</span>
  hdr = (<span class="keyword">struct </span><a class="code" href="structisis__fixed__hdr.html">isis_fixed_hdr</a> *) <a class="code" href="stream_8h.html#afde5f5db208a43da6faf7b830f26d7fc">STREAM_DATA</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>);

  <span class="keywordflow">if</span> ((hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#ab7d3a92cb745fd25d033e0daefca7f74">idrp</a> != <a class="code" href="iso_8h.html#a5246f338b99d70bb67f26fdbf2c25c8b">ISO10589_ISIS</a>) &amp;&amp; (hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#ab7d3a92cb745fd25d033e0daefca7f74">idrp</a> != <a class="code" href="iso_8h.html#ac46252393a469e6335e3689dd8a9c45b">ISO9542_ESIS</a>))
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Not an IS-IS or ES-IS packet IDRP=%02x&quot;</span>, hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#ab7d3a92cb745fd25d033e0daefca7f74">idrp</a>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;
    }

  <span class="comment">/* now we need to know if this is an ISO 9542 packet and</span>
<span class="comment">   * take real good care of it, waaa!</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#ab7d3a92cb745fd25d033e0daefca7f74">idrp</a> == <a class="code" href="iso_8h.html#ac46252393a469e6335e3689dd8a9c45b">ISO9542_ESIS</a>)
    {
      esis_hdr = (<span class="keyword">struct </span><a class="code" href="structesis__fixed__hdr.html">esis_fixed_hdr</a> *) <a class="code" href="stream_8h.html#afde5f5db208a43da6faf7b830f26d7fc">STREAM_DATA</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>);
      <a class="code" href="stream_8c.html#a5506a87bd79df66accb6ad8fbbd5857c">stream_set_getp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>, <a class="code" href="isis__pdu_8h.html#aa6a1330be2a7f7ca02ccd7d7cefeb6de">ESIS_FIXED_HDR_LEN</a>);
      <span class="comment">/* FIXME: Need to do some acceptence tests */</span>
      <span class="comment">/* example length... */</span>
      <span class="keywordflow">switch</span> (esis_hdr-&gt;<a class="code" href="structesis__fixed__hdr.html#ac2151754f7d0212d4a1be3e1f1512aad">pdu_type</a>)
    {
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#a7d8d38ce35472f05aa4a7e74e68576c8">ESH_PDU</a>:
      <span class="comment">/* FIXME */</span>
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#adf31bc2976b78796a60f4d978dcbc518">ISH_PDU</a>:
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;AN ISH PDU!!&quot;</span>);
      retval = <a class="code" href="isis__pdu_8c.html#a91fbea5cc0d8560ca8d150743f5da79d">process_is_hello</a> (circuit);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;
    }
      <span class="keywordflow">return</span> retval;
    }
  <span class="keywordflow">else</span>
    {
      <a class="code" href="stream_8c.html#a5506a87bd79df66accb6ad8fbbd5857c">stream_set_getp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>, <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a>);
    }
  <span class="comment">/*</span>
<span class="comment">   * and then process it</span>
<span class="comment">   */</span>

  <span class="keywordflow">if</span> (hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#acde2c4eefcd9af9aef447b106383b03e">length</a> &lt; <a class="code" href="isis__pdu_8c.html#aca2aaedf29c85944f6063b91c0461b20">ISIS_MINIMUM_FIXED_HDR_LEN</a>)
    {
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;Fixed header length = %d&quot;</span>, hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#acde2c4eefcd9af9aef447b106383b03e">length</a>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;
    }

  <span class="keywordflow">if</span> (hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#aae65a4fef2c1f3f7f5601da9fe5491c3">version1</a> != 1)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Unsupported ISIS version %u&quot;</span>, hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#aae65a4fef2c1f3f7f5601da9fe5491c3">version1</a>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }
  <span class="comment">/* either 6 or 0 */</span>
  <span class="keywordflow">if</span> ((hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#adbac4c42a022759367d1fd9a1fdb40f7">id_len</a> != 0) &amp;&amp; (hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#adbac4c42a022759367d1fd9a1fdb40f7">id_len</a> != <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>))
    {
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>
    (<span class="stringliteral">&quot;IDFieldLengthMismatch: ID Length field in a received PDU  %u, &quot;</span>
     <span class="stringliteral">&quot;while the parameter for this IS is %u&quot;</span>, hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#adbac4c42a022759367d1fd9a1fdb40f7">id_len</a>,
     <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;
    }

  <span class="keywordflow">if</span> (hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#ab0240202f6415d4ad641b692615ed1eb">version2</a> != 1)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Unsupported ISIS version %u&quot;</span>, hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#ab0240202f6415d4ad641b692615ed1eb">version2</a>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }
  <span class="comment">/* either 3 or 0 */</span>
  <span class="keywordflow">if</span> ((hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#abf027a2ccc2b29a6b36cae277894f7c3">max_area_addrs</a> != 0)
      &amp;&amp; (hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#abf027a2ccc2b29a6b36cae277894f7c3">max_area_addrs</a> != <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#aece17be3ce01b59ac1e2c1b443cb4a19">max_area_addrs</a>))
    {
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;maximumAreaAddressesMismatch: maximumAreaAdresses in a &quot;</span>
        <span class="stringliteral">&quot;received PDU %u while the parameter for this IS is %u&quot;</span>,
        hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#abf027a2ccc2b29a6b36cae277894f7c3">max_area_addrs</a>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#aece17be3ce01b59ac1e2c1b443cb4a19">max_area_addrs</a>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;
    }

  <span class="keywordflow">switch</span> (hdr-&gt;<a class="code" href="structisis__fixed__hdr.html#a6e0886d9e411e4f4ab9de644af8ee034">pdu_type</a>)
    {
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#aaecfaf101078595ebfeed0bd1740932b">L1_LAN_HELLO</a>:
      retval = <a class="code" href="isis__pdu_8c.html#adb45f30316e2d1fed63fc164d31657c1">process_lan_hello</a> (<a class="code" href="isis__constants_8h.html#a07d8effa4d110dfe9ed04bf051e6ebab">ISIS_LEVEL1</a>, circuit, ssnpa);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#af62a8d7593e2fabd396e8dce9124d09d">L2_LAN_HELLO</a>:
      retval = <a class="code" href="isis__pdu_8c.html#adb45f30316e2d1fed63fc164d31657c1">process_lan_hello</a> (<a class="code" href="isis__constants_8h.html#ad8502b655a001bf61391e956a316ffc2">ISIS_LEVEL2</a>, circuit, ssnpa);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#ac01a71c9cb0d66d483f5022d9812b4db">P2P_HELLO</a>:
      retval = <a class="code" href="isis__pdu_8c.html#ae1ed5a5e3ac93396b812ac8d35186073">process_p2p_hello</a> (circuit);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#a37bd70be235d213245350209287f9d69">L1_LINK_STATE</a>:
      retval = <a class="code" href="isis__pdu_8c.html#aa15bc068c8e49090fcf9268028d4fb03">process_lsp</a> (<a class="code" href="isis__constants_8h.html#a07d8effa4d110dfe9ed04bf051e6ebab">ISIS_LEVEL1</a>, circuit, ssnpa);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#a0078daf40d7e45a7bdbd26a016dde2da">L2_LINK_STATE</a>:
      retval = <a class="code" href="isis__pdu_8c.html#aa15bc068c8e49090fcf9268028d4fb03">process_lsp</a> (<a class="code" href="isis__constants_8h.html#ad8502b655a001bf61391e956a316ffc2">ISIS_LEVEL2</a>, circuit, ssnpa);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#acd69d37ac6c82a2f79d1790b258f35b4">L1_COMPLETE_SEQ_NUM</a>:
      retval = <a class="code" href="isis__pdu_8c.html#aae34abef6549bb3917ee120cb846bb41">process_csnp</a> (<a class="code" href="isis__constants_8h.html#a07d8effa4d110dfe9ed04bf051e6ebab">ISIS_LEVEL1</a>, circuit, ssnpa);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#a56e28262496597ee720d611b16040847">L2_COMPLETE_SEQ_NUM</a>:
      retval = <a class="code" href="isis__pdu_8c.html#aae34abef6549bb3917ee120cb846bb41">process_csnp</a> (<a class="code" href="isis__constants_8h.html#ad8502b655a001bf61391e956a316ffc2">ISIS_LEVEL2</a>, circuit, ssnpa);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#acb5235709fbb83fee17285736e47f228">L1_PARTIAL_SEQ_NUM</a>:
      retval = <a class="code" href="isis__pdu_8c.html#a4341127ac99b45c32f8f35aa8bc277df">process_psnp</a> (<a class="code" href="isis__constants_8h.html#a07d8effa4d110dfe9ed04bf051e6ebab">ISIS_LEVEL1</a>, circuit, ssnpa);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__pdu_8h.html#a711a885da413c85c2add3efefec3a69f">L2_PARTIAL_SEQ_NUM</a>:
      retval = <a class="code" href="isis__pdu_8c.html#a4341127ac99b45c32f8f35aa8bc277df">process_psnp</a> (<a class="code" href="isis__constants_8h.html#ad8502b655a001bf61391e956a316ffc2">ISIS_LEVEL2</a>, circuit, ssnpa);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;
    }

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a75016a6ce480bc69cba2753bce7c52e1"></a><!-- doxytag: member="isis_pdu.c::isis_receive" ref="a75016a6ce480bc69cba2753bce7c52e1" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int isis_receive </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l01806">1806</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;
  u_char ssnpa[<a class="code" href="isis__constants_8h.html#a9822d89774e0d6ddaa06503950130423">ETH_ALEN</a>];
  <span class="keywordtype">int</span> retval;

  <span class="comment">/*</span>
<span class="comment">   * Get the circuit </span>
<span class="comment">   */</span>
  circuit = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit);

  circuit-&gt;<a class="code" href="structisis__circuit.html#afa7165030b312ae2ce406ec15a4624df">t_read</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a> = <a class="code" href="stream_8c.html#a7117cdad9fa5e5ae633e0cf08d047459">stream_new</a> (<a class="code" href="isis__constants_8h.html#aa507eb18af6ca6d6db6e3db750ab0737">ISO_MTU</a> (circuit));
  <span class="keywordflow">else</span>
    <a class="code" href="stream_8c.html#aee8fd31485ebc2f0a556a6a5d5c2d1e6">stream_reset</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>);

  retval = circuit-&gt;<a class="code" href="structisis__circuit.html#ae53bfd73cd6f9a69f392c645c4ccce7c">rx</a> (circuit, ssnpa);

  <span class="keywordflow">if</span> (retval == <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>)
    retval = <a class="code" href="isis__pdu_8c.html#acb5f4492a8f9bb27a780ebfe97934e85">isis_handle_pdu</a> (circuit, ssnpa);

  <span class="comment">/* </span>
<span class="comment">   * prepare for next packet. </span>
<span class="comment">   */</span>
  circuit-&gt;<a class="code" href="structisis__circuit.html#afa7165030b312ae2ce406ec15a4624df">t_read</a> = <a class="code" href="thread_8h.html#a9231be4b08f04f6ebc1bea080443ba74">thread_add_timer_msec</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="isis__pdu_8c.html#a75016a6ce480bc69cba2753bce7c52e1">isis_receive</a>, circuit,
                       <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a>
                       (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a1ef8753b22245b7d8fff0331deef3b21">circuit_list</a>) *
                       100);

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aae34abef6549bb3917ee120cb846bb41"></a><!-- doxytag: member="isis_pdu.c::process_csnp" ref="aae34abef6549bb3917ee120cb846bb41" args="(int level, struct isis_circuit *circuit, u_char *ssnpa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int process_csnp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>ssnpa</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l01545">1545</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">/* Sanity check - FIXME: move to correct place */</span>
  <span class="keywordflow">if</span> ((<a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>) -
       <a class="code" href="stream_8c.html#a717f15645000d42a15034f5ec83fc9a5">stream_get_getp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>)) &lt; <a class="code" href="isis__pdu_8h.html#ad643847e4f6bb080e2e6359abcad1c15">ISIS_CSNP_HDRLEN</a>)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Packet too short ( &lt; %d)&quot;</span>, <a class="code" href="isis__pdu_8h.html#ad643847e4f6bb080e2e6359abcad1c15">ISIS_CSNP_HDRLEN</a>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }

  <span class="keywordflow">return</span> <a class="code" href="isis__pdu_8c.html#a4e16ec0d4416a973611faf1d57beac3a">process_snp</a> (<a class="code" href="isis__pdu_8h.html#ab9d39eb77423805c1c9e40824167b90d">ISIS_SNP_CSNP_FLAG</a>, level, circuit, ssnpa);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a91fbea5cc0d8560ca8d150743f5da79d"></a><!-- doxytag: member="isis_pdu.c::process_is_hello" ref="a91fbea5cc0d8560ca8d150743f5da79d" args="(struct isis_circuit *circuit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int process_is_hello </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l01581">1581</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__adjacency.html">isis_adjacency</a> *adj;
  <span class="keywordtype">int</span> retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
  u_char neigh_len;
  u_char *<a class="code" href="isis__misc_8c.html#aba11fdf75896b0a0b94c02619b945c97">sysid</a>;

  <span class="comment">/* In this point in time we are not yet able to handle is_hellos</span>
<span class="comment">   * on lan - Sorry juniper...</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
    <span class="keywordflow">return</span> retval;

  neigh_len = <a class="code" href="stream_8c.html#a7902a86d9a749707c535840654ded3f6">stream_getc</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>);
  sysid = <a class="code" href="stream_8h.html#a4bb95ef1391c2b8b7b97678a5ad87cb7">STREAM_PNT</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>) + neigh_len - 1 - <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>;
  adj = circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a15852a59ea8be80680abac2070659440">p2p</a>.<a class="code" href="structisis__p2p__info.html#a17d32289e6648b9855b93482cd7c45a5">neighbor</a>;
  <span class="keywordflow">if</span> (!adj)
    {
      <span class="comment">/* 8.2.2 */</span>
      adj = <a class="code" href="isis__adjacency_8c.html#a81fa83638827781e0f128c9c01551a95">isis_new_adj</a> (sysid, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, circuit);
      <span class="keywordflow">if</span> (adj == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;

      <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1973db8c983074b9c3e0cc74c23eab47">ISIS_ADJ_INITIALIZING</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
      adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> = <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4da1d20bc4d429708dd9bc81735bd176618">ISIS_SYSTYPE_UNKNOWN</a>;
      circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a15852a59ea8be80680abac2070659440">p2p</a>.<a class="code" href="structisis__p2p__info.html#a17d32289e6648b9855b93482cd7c45a5">neighbor</a> = adj;
    }
  <span class="comment">/* 8.2.2 a) */</span>
  <span class="keywordflow">if</span> ((adj-&gt;<a class="code" href="structisis__adjacency.html#ade48f111121efb755bd2ea13a06a16ae">adj_state</a> == <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>) &amp;&amp; <a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (adj-&gt;<a class="code" href="structisis__adjacency.html#a7b23942ae5652d5cf59b263f131c2038">sysid</a>, sysid,
                         ISIS_SYS_ID_LEN))
    {
      <span class="comment">/* 8.2.2 a) 1) FIXME: adjStateChange(down) event */</span>
      <span class="comment">/* 8.2.2 a) 2) delete the adj */</span>
      <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba573c15a700e70c8a655319a64727f856">MTYPE_ISIS_ADJACENCY</a>, adj);
      <span class="comment">/* 8.2.2 a) 3) create a new adj */</span>
      adj = <a class="code" href="isis__adjacency_8c.html#a81fa83638827781e0f128c9c01551a95">isis_new_adj</a> (sysid, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, circuit);
      <span class="keywordflow">if</span> (adj == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;

      <span class="comment">/* 8.2.2 a) 3) i */</span>
      <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1973db8c983074b9c3e0cc74c23eab47">ISIS_ADJ_INITIALIZING</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
      <span class="comment">/* 8.2.2 a) 3) ii */</span>
      adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> = <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4da1d20bc4d429708dd9bc81735bd176618">ISIS_SYSTYPE_UNKNOWN</a>;
      <span class="comment">/* 8.2.2 a) 4) quite meaningless */</span>
    }
  <span class="comment">/* 8.2.2 b) ignore on condition */</span>
  <span class="keywordflow">if</span> ((adj-&gt;<a class="code" href="structisis__adjacency.html#ade48f111121efb755bd2ea13a06a16ae">adj_state</a> == <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1973db8c983074b9c3e0cc74c23eab47">ISIS_ADJ_INITIALIZING</a>) &amp;&amp;
      (adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> == <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4da200778581ea795c59c48b27748eae10e">ISIS_SYSTYPE_IS</a>))
    {
      <span class="comment">/* do nothing */</span>
    }
  <span class="keywordflow">else</span>
    {
      <span class="comment">/* 8.2.2 c) respond with a p2p IIH */</span>
      <a class="code" href="isis__pdu_8c.html#ada46fc1940683eac5a47249f80f865b5">send_hello</a> (circuit, 1);
    }
  <span class="comment">/* 8.2.2 d) type is IS */</span>
  adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> = <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4da200778581ea795c59c48b27748eae10e">ISIS_SYSTYPE_IS</a>;
  <span class="comment">/* 8.2.2 e) FIXME: Circuit type of? */</span>

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="adb45f30316e2d1fed63fc164d31657c1"></a><!-- doxytag: member="isis_pdu.c::process_lan_hello" ref="adb45f30316e2d1fed63fc164d31657c1" args="(int level, struct isis_circuit *circuit, u_char *ssnpa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int process_lan_hello </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>ssnpa</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00655">655</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
  <span class="keyword">struct </span><a class="code" href="structisis__lan__hello__hdr.html">isis_lan_hello_hdr</a> hdr;
  <span class="keyword">struct </span><a class="code" href="structisis__adjacency.html">isis_adjacency</a> *adj;
  u_int32_t expected = 0, found;
  <span class="keyword">struct </span><a class="code" href="structtlvs.html">tlvs</a> <a class="code" href="structtlvs.html">tlvs</a>;
  u_char *<a class="code" href="isis__misc_8c.html#aa1751dc9ca6ba209edc0f7f8e51e1d11">snpa</a>;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node;

  <span class="keywordflow">if</span> ((<a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>) -
       <a class="code" href="stream_8c.html#a717f15645000d42a15034f5ec83fc9a5">stream_get_getp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>)) &lt; <a class="code" href="isis__pdu_8h.html#ae252f7eb62c9ee4fd050d82558623d39">ISIS_LANHELLO_HDRLEN</a>)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Packet too short&quot;</span>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#aa21c1b770870b6ca7583a164435d1977">ext_domain</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;level %d LAN Hello received over circuit with &quot;</span>
          <span class="stringliteral">&quot;externalDomain = true&quot;</span>, level);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }

  <span class="keywordflow">if</span> (!<a class="code" href="isis__pdu_8c.html#ad3be9b74a266fca7d08e91ad3e4b0d45">accept_level</a> (level, circuit-&gt;<a class="code" href="structisis__circuit.html#ab222d6d0b054faa159d72bcb9768b3fb">circuit_is_type</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#a4113d6aad857cfa148450dfc6ed85b5b">DEBUG_ADJ_PACKETS</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Adj (%s): Interface level mismatch, %s&quot;</span>,
              circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);
    }
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>  <span class="comment">/* Cisco&#39;s debug message compatability */</span>
  <span class="keywordflow">if</span> (!<a class="code" href="isis__pdu_8c.html#ad3be9b74a266fca7d08e91ad3e4b0d45">accept_level</a> (level, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#a4113d6aad857cfa148450dfc6ed85b5b">DEBUG_ADJ_PACKETS</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Adj (%s): is type mismatch&quot;</span>,
              circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>);
    }
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>  <span class="comment">/*</span>
<span class="comment">   * Fill the header</span>
<span class="comment">   */</span>
  hdr.circuit_t = <a class="code" href="stream_8c.html#a7902a86d9a749707c535840654ded3f6">stream_getc</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>);
  <a class="code" href="stream_8c.html#ab7101e57ef0d9dc1a33e7f7e30c91b9a">stream_get</a> (hdr.source_id, circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
  hdr.hold_time = <a class="code" href="stream_8c.html#a66155fa63acd1f377a5b9e98aba7b888">stream_getw</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>);
  hdr.pdu_len = <a class="code" href="stream_8c.html#a66155fa63acd1f377a5b9e98aba7b888">stream_getw</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>);
  hdr.prio = <a class="code" href="stream_8c.html#a7902a86d9a749707c535840654ded3f6">stream_getc</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>);
  <a class="code" href="stream_8c.html#ab7101e57ef0d9dc1a33e7f7e30c91b9a">stream_get</a> (hdr.lan_id, circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);

  <span class="keywordflow">if</span> (hdr.circuit_t != <a class="code" href="isis__constants_8h.html#a4806dbcd4c094ef55cecd6aca29520d7">IS_LEVEL_1</a> &amp;&amp; hdr.circuit_t != <a class="code" href="isis__constants_8h.html#a9daa7fbf09b604c718f3bbe189aedd1a">IS_LEVEL_2</a> &amp;&amp;
      hdr.circuit_t != <a class="code" href="isis__constants_8h.html#a9906fe43cc332e34827b3c233d509da6">IS_LEVEL_1_AND_2</a>)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Level %d LAN Hello with Circuit Type %d&quot;</span>, level,
         hdr.circuit_t);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;
    }
  <span class="comment">/*</span>
<span class="comment">   * Then get the tlvs</span>
<span class="comment">   */</span>
  expected |= <a class="code" href="isis__tlv_8h.html#a493ed26a4a2decc55275bd699df9a4a8">TLVFLAG_AUTH_INFO</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#ae2a91163530ea4d9bfb3b00394a48316">TLVFLAG_AREA_ADDRS</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#a73ebf94211143da42abc8c4a8c2deec3">TLVFLAG_LAN_NEIGHS</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#ac9149da10b98f4211a51249c752b5fee">TLVFLAG_NLPID</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#ac1d5ea73aa3cc33a2c7e4190df6fab00">TLVFLAG_IPV4_ADDR</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#af63af1cfdbe427be867d8191c1ea5b5f">TLVFLAG_IPV6_ADDR</a>;

  retval = <a class="code" href="isis__tlv_8c.html#aad6fa3b6cc5e93707f75d8247f8787c8">parse_tlvs</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
               <a class="code" href="stream_8h.html#a4bb95ef1391c2b8b7b97678a5ad87cb7">STREAM_PNT</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>),
               hdr.pdu_len - <a class="code" href="isis__pdu_8h.html#ae252f7eb62c9ee4fd050d82558623d39">ISIS_LANHELLO_HDRLEN</a> -
               <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a>, &amp;expected, &amp;found, &amp;<a class="code" href="structtlvs.html">tlvs</a>);

  <span class="keywordflow">if</span> (retval &gt; <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;parse_tlvs() failed&quot;</span>);
      <span class="keywordflow">goto</span> out;
    }

  <span class="keywordflow">if</span> (!(found &amp; <a class="code" href="isis__tlv_8h.html#ae2a91163530ea4d9bfb3b00394a48316">TLVFLAG_AREA_ADDRS</a>))
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;No Area addresses TLV in Level %d LAN IS to IS hello&quot;</span>,
         level);
      retval = <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
      <span class="keywordflow">goto</span> out;
    }

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a601d2b4b3220757f8f7212f2a1628ab2">passwd</a>.<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>)
    {
      <span class="keywordflow">if</span> (!(found &amp; <a class="code" href="isis__tlv_8h.html#a493ed26a4a2decc55275bd699df9a4a8">TLVFLAG_AUTH_INFO</a>) ||
      <a class="code" href="isis__pdu_8c.html#aefd5a8caa169a427e30d599b51ab52e9">authentication_check</a> (&amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a601d2b4b3220757f8f7212f2a1628ab2">passwd</a>, &amp;<a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>))
    {
      <a class="code" href="isis__events_8c.html#a16a754e810bb7ba8e3b2a23c89d6d130">isis_event_auth_failure</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
                   <span class="stringliteral">&quot;LAN hello authentication failure&quot;</span>,
                   hdr.source_id);
      retval = <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
      <span class="keywordflow">goto</span> out;
    }
    }

  <span class="comment">/*</span>
<span class="comment">   * Accept the level 1 adjacency only if a match between local and</span>
<span class="comment">   * remote area addresses is found</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (level == 1 &amp;&amp; !<a class="code" href="isis__pdu_8c.html#ac44201d5d72450ec89f35a014c1e31c1">area_match</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aca1436df894da89fb83d7924ef248397">area_addrs</a>, <a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#a11d8deaa75c26e958cff5f74fee3ef10">area_addrs</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#a4113d6aad857cfa148450dfc6ed85b5b">DEBUG_ADJ_PACKETS</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Adj (%s): Area mismatch, level %d IIH on %s&quot;</span>,
              circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, level,
              circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);
    }
      retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
      <span class="keywordflow">goto</span> out;
    }

  <span class="comment">/* </span>
<span class="comment">   * it&#39;s own IIH PDU - discard silently </span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (!<a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ac7adabf9b24b03c93e73bb9b03c2192b">snpa</a>, ssnpa, <a class="code" href="isis__constants_8h.html#a9822d89774e0d6ddaa06503950130423">ETH_ALEN</a>))
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Adj (%s): it&#39;s own IIH PDU - discarded&quot;</span>,
          circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>);

      retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
      <span class="keywordflow">goto</span> out;
    }

  <span class="comment">/*</span>
<span class="comment">   * check if it&#39;s own interface ip match iih ip addrs</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (!(found &amp; <a class="code" href="isis__tlv_8h.html#ac1d5ea73aa3cc33a2c7e4190df6fab00">TLVFLAG_IPV4_ADDR</a>)
      || !<a class="code" href="isis__pdu_8c.html#a7df02c36d437547a772bc406fc9594fb">ip_match</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#adcde796f44a1e725abe092f95a6cb075">ip_addrs</a>, <a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#ae9ef317829a76d7a79d2789786a2ac1f">ipv4_addrs</a>))
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>
    (<span class="stringliteral">&quot;ISIS-Adj: No usable IP interface addresses in LAN IIH from %s\n&quot;</span>,
     circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);
      retval = <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
      <span class="keywordflow">goto</span> out;
    }

  adj = <a class="code" href="isis__adjacency_8c.html#af928a678a2e0e3296d688be2a4d8e7ac">isis_adj_lookup</a> (hdr.source_id, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ada9bf2584373a37aed06b2e4c9e796f9">adjdb</a>[level - 1]);
  <span class="keywordflow">if</span> (!adj)
    {
      <span class="comment">/*</span>
<span class="comment">       * Do as in 8.4.2.5</span>
<span class="comment">       */</span>
      adj = <a class="code" href="isis__adjacency_8c.html#a81fa83638827781e0f128c9c01551a95">isis_new_adj</a> (hdr.source_id, ssnpa, level, circuit);
      <span class="keywordflow">if</span> (adj == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      retval = <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;
      <span class="keywordflow">goto</span> out;
    }

      adj-&gt;<a class="code" href="structisis__adjacency.html#abee45e3e4c2c3f246db1c8aa19186cc8">level</a> = level;
      <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1973db8c983074b9c3e0cc74c23eab47">ISIS_ADJ_INITIALIZING</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);

      <span class="keywordflow">if</span> (level == 1)
    {
      adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> = <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4daddebdf6ea1f78c8503dd520854310078">ISIS_SYSTYPE_L1_IS</a>;
    }
      <span class="keywordflow">else</span>
    {
      adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> = <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4da615d7aa9f3d08cd8360e1b04a0b8806b">ISIS_SYSTYPE_L2_IS</a>;
    }
      <a class="code" href="linklist_8c.html#acd6daa4be8ab3f175376e63c9d9c9500">list_delete_all_node</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a1a8b5b8fcf6defb0b21b509d99953742">lan_neighs</a>[level - 1]);
      <a class="code" href="isis__adjacency_8c.html#aa6290067148c07fb10f67b9e4237585f">isis_adj_build_neigh_list</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ada9bf2584373a37aed06b2e4c9e796f9">adjdb</a>[level - 1],
                 circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a1a8b5b8fcf6defb0b21b509d99953742">lan_neighs</a>[level - 1]);
    }

  <span class="keywordflow">if</span>(adj-&gt;<a class="code" href="structisis__adjacency.html#a76bf3ed808e66f1047d7a2a698683db2">dis_record</a>[level-1].<a class="code" href="structisis__dis__record.html#ae53530d9ceb39ce5604d82c3b5f0da1b">dis</a>==<a class="code" href="isis__dr_8h.html#a411da867a1e3279a6ff0d1624b9ab05fa971f7814bbbbb88e9186770d1ef77ae2">ISIS_IS_DIS</a>)
    <span class="keywordflow">switch</span> (level)
      {
      <span class="keywordflow">case</span> 1:
    <span class="keywordflow">if</span> (<a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a015b72bf5854d99b722f9f599b9eb158">l1_desig_is</a>, hdr.lan_id, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1))
      {
        <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="isis__events_8c.html#aa449cea2358b48018e359f93e4909864">isis_event_dis_status_change</a>, circuit, 0);
        <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a015b72bf5854d99b722f9f599b9eb158">l1_desig_is</a>, hdr.lan_id,
            <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);
      }
    <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> 2:
    <span class="keywordflow">if</span> (<a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a2bde5462284eb2b294ed998fb5907de8">l2_desig_is</a>, hdr.lan_id, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1))
      {
        <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="isis__events_8c.html#aa449cea2358b48018e359f93e4909864">isis_event_dis_status_change</a>, circuit, 0);
        <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a2bde5462284eb2b294ed998fb5907de8">l2_desig_is</a>, hdr.lan_id,
            <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);
      }
    <span class="keywordflow">break</span>;
      }

  adj-&gt;<a class="code" href="structisis__adjacency.html#a656446a9be5f9ebf466ffacc8741a909">hold_time</a> = hdr.hold_time;
  adj-&gt;<a class="code" href="structisis__adjacency.html#afd570f7072dac8465cf207cd6df6c567">last_upd</a> = time (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
  adj-&gt;<a class="code" href="structisis__adjacency.html#a4eca92e54cf0d683720479515d044d1c">prio</a>[level - 1] = hdr.prio;

  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (adj-&gt;<a class="code" href="structisis__adjacency.html#a7d3a80980b6870f382dc48f91035bd6b">lanid</a>, hdr.lan_id, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);

  <span class="comment">/* which protocol are spoken ??? */</span>
  <span class="keywordflow">if</span> (found &amp; <a class="code" href="isis__tlv_8h.html#ac9149da10b98f4211a51249c752b5fee">TLVFLAG_NLPID</a>)
    <a class="code" href="isis__pdu_8c.html#afb3df247f88b4af648f1abf59f8a6044">tlvs_to_adj_nlpids</a> (&amp;<a class="code" href="structtlvs.html">tlvs</a>, adj);

  <span class="comment">/* we need to copy addresses to the adj */</span>
  <span class="keywordflow">if</span> (found &amp; TLVFLAG_IPV4_ADDR)
    <a class="code" href="isis__pdu_8c.html#af96726be5388512e070368d2438bbf99">tlvs_to_adj_ipv4_addrs</a> (&amp;<a class="code" href="structtlvs.html">tlvs</a>, adj);

<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (found &amp; <a class="code" href="isis__tlv_8h.html#af63af1cfdbe427be867d8191c1ea5b5f">TLVFLAG_IPV6_ADDR</a>)
    tlvs_to_adj_ipv6_addrs (&amp;<a class="code" href="structtlvs.html">tlvs</a>, adj);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

  adj-&gt;<a class="code" href="structisis__adjacency.html#a94749cb53088c1898166a701f2a3931f">circuit_t</a> = hdr.circuit_t;

  <span class="comment">/* lets take care of the expiry */</span>
  <a class="code" href="thread_8h.html#ae1dfd3f5f643212148d60a41d9f2192a">THREAD_TIMER_OFF</a> (adj-&gt;<a class="code" href="structisis__adjacency.html#a16900c0c5677510df0a115d145d5ce87">t_expire</a>);
  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, adj-&gt;<a class="code" href="structisis__adjacency.html#a16900c0c5677510df0a115d145d5ce87">t_expire</a>, <a class="code" href="isis__adjacency_8c.html#a089c767d62df53d044fc7ba923219879">isis_adj_expire</a>, adj,
           (<span class="keywordtype">long</span>) adj-&gt;<a class="code" href="structisis__adjacency.html#a656446a9be5f9ebf466ffacc8741a909">hold_time</a>);

  <span class="comment">/*</span>
<span class="comment">   * If the snpa for this circuit is found from LAN Neighbours TLV</span>
<span class="comment">   * we have two-way communication -&gt; adjacency can be put to state &quot;up&quot;</span>
<span class="comment">   */</span>

  <span class="keywordflow">if</span> (found &amp; <a class="code" href="isis__tlv_8h.html#a73ebf94211143da42abc8c4a8c2deec3">TLVFLAG_LAN_NEIGHS</a>)
    {
      <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#ade48f111121efb755bd2ea13a06a16ae">adj_state</a> != <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>)
    {
      <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (<a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#ab00441be3a4bb1a610cf6b2746498568">lan_neighs</a>, node, snpa))
        <span class="keywordflow">if</span> (!<a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (snpa, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ac7adabf9b24b03c93e73bb9b03c2192b">snpa</a>, <a class="code" href="isis__constants_8h.html#a9822d89774e0d6ddaa06503950130423">ETH_ALEN</a>))
        {
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>,
                     <span class="stringliteral">&quot;own SNPA found in LAN Neighbours TLV&quot;</span>);
        }
    }
    }

out:
  <span class="comment">/* DEBUG_ADJ_PACKETS */</span>
  <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#a4113d6aad857cfa148450dfc6ed85b5b">DEBUG_ADJ_PACKETS</a>)
    {
      <span class="comment">/* FIXME: is this place right? fix missing info */</span>
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Adj (%s): Rcvd L%d LAN IIH from %s on %s, cirType %s, &quot;</span>
          <span class="stringliteral">&quot;cirID %u, length %ld&quot;</span>,
          circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
          level, <a class="code" href="isis__misc_8c.html#a9ff6d4a3900eef27814548c4c5357090">snpa_print</a> (ssnpa), circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>,
          <a class="code" href="isis__misc_8c.html#a35b15c65a44088982fa8daca9fc7b022">circuit_t2string</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#ab222d6d0b054faa159d72bcb9768b3fb">circuit_is_type</a>),
          circuit-&gt;<a class="code" href="structisis__circuit.html#a10453f6bcc1e8f1cb466240a81836ba9">circuit_id</a>,
          <span class="comment">/* FIXME: use %z when we stop supporting old compilers. */</span>
          (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) <a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>));
    }

  <a class="code" href="isis__tlv_8c.html#a5f499235cf5a69697d280f5a1cd01612">free_tlvs</a> (&amp;<a class="code" href="structtlvs.html">tlvs</a>);

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa15bc068c8e49090fcf9268028d4fb03"></a><!-- doxytag: member="isis_pdu.c::process_lsp" ref="aa15bc068c8e49090fcf9268028d4fb03" args="(int level, struct isis_circuit *circuit, u_char *ssnpa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int process_lsp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>ssnpa</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00921">921</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__link__state__hdr.html">isis_link_state_hdr</a> *hdr;
  <span class="keyword">struct </span><a class="code" href="structisis__adjacency.html">isis_adjacency</a> *adj = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp, *lsp0 = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keywordtype">int</span> retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>, comp = 0;
  u_char <a class="code" href="isis__misc_8c.html#ac0016d3200b8885e05d151ca16ef4315">lspid</a>[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2];
  <span class="keyword">struct </span><a class="code" href="structisis__passwd.html">isis_passwd</a> *<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>;

  <span class="comment">/* Sanity check - FIXME: move to correct place */</span>
  <span class="keywordflow">if</span> ((<a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>) -
       <a class="code" href="stream_8c.html#a717f15645000d42a15034f5ec83fc9a5">stream_get_getp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>)) &lt; <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Packet too short&quot;</span>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }

  <span class="comment">/* Reference the header   */</span>
  hdr = (<span class="keyword">struct </span><a class="code" href="structisis__link__state__hdr.html">isis_link_state_hdr</a> *) <a class="code" href="stream_8h.html#a4bb95ef1391c2b8b7b97678a5ad87cb7">STREAM_PNT</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>);

  <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#abd8d8358bf794de3d9fba9ef5de689b3">DEBUG_UPDATE_PACKETS</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Upd (%s): Rcvd L%d LSP %s, seq 0x%08x, cksum 0x%04x, &quot;</span>
          <span class="stringliteral">&quot;lifetime %us, len %lu, on %s&quot;</span>,
          circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
          level,
          <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
          ntohl (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>),
          ntohs (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>),
          ntohs (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>),
          <span class="comment">/* FIXME: use %z when we stop supporting old compilers. */</span>
          (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) <a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>), 
          circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);
    }

  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (ntohs (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a>) &gt; <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>);

  <span class="comment">/* Checksum sanity check - FIXME: move to correct place */</span>
  <span class="comment">/* 12 = sysid+pdu+remtime */</span>
  <span class="keywordflow">if</span> (<a class="code" href="iso__checksum_8c.html#abf5d1536c8849c3b76e6fd4aa41785d6">iso_csum_verify</a> (<a class="code" href="stream_8h.html#a4bb95ef1391c2b8b7b97678a5ad87cb7">STREAM_PNT</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>) + 4,
               ntohs (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a>) - 12, &amp;hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>))
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Upd (%s): LSP %s invalid LSP checksum 0x%04x&quot;</span>,
          circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
          <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>), ntohs (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>));

      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }

  <span class="comment">/* 7.3.15.1 a) 1 - external domain circuit will discard lsps */</span>
  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#aa21c1b770870b6ca7583a164435d1977">ext_domain</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>
    (<span class="stringliteral">&quot;ISIS-Upd (%s): LSP %s received at level %d over circuit with &quot;</span>
     <span class="stringliteral">&quot;externalDomain = true&quot;</span>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
     <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>), level);

      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }

  <span class="comment">/* 7.3.15.1 a) 2,3 - manualL2OnlyMode not implemented */</span>
  <span class="keywordflow">if</span> (!<a class="code" href="isis__pdu_8c.html#ad3be9b74a266fca7d08e91ad3e4b0d45">accept_level</a> (level, circuit-&gt;<a class="code" href="structisis__circuit.html#ab222d6d0b054faa159d72bcb9768b3fb">circuit_is_type</a>))
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Upd (%s): LSP %s received at level %d over circuit of&quot;</span>
          <span class="stringliteral">&quot; type %s&quot;</span>,
          circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
          <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
          level, <a class="code" href="isis__misc_8c.html#a35b15c65a44088982fa8daca9fc7b022">circuit_t2string</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#ab222d6d0b054faa159d72bcb9768b3fb">circuit_is_type</a>));

      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }

  <span class="comment">/* 7.3.15.1 a) 4 - need to make sure IDLength matches */</span>

  <span class="comment">/* 7.3.15.1 a) 5 - maximum area match, can be ommited since we only use 3 */</span>

  <span class="comment">/* 7.3.15.1 a) 7 - password check */</span>
  (level == <a class="code" href="isis__constants_8h.html#a07d8effa4d110dfe9ed04bf051e6ebab">ISIS_LEVEL1</a>) ? (passwd = &amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#afb66934e4bd3bda094550517a94de442">area_passwd</a>) :
    (passwd = &amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a60cd44a3a31b36dc808ad3fd9efc97a0">domain_passwd</a>);
  <span class="keywordflow">if</span> (passwd-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>)
    {
      <span class="keywordflow">if</span> (<a class="code" href="isis__lsp_8c.html#ae815308b33a56b78b9a65809bc344ac4">isis_lsp_authinfo_check</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>,
                   ntohs (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a>), passwd))
    {
      <a class="code" href="isis__events_8c.html#a16a754e810bb7ba8e3b2a23c89d6d130">isis_event_auth_failure</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
                   <span class="stringliteral">&quot;LSP authentication failure&quot;</span>, hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }
    }
  <span class="comment">/* Find the LSP in our database and compare it to this Link State header */</span>
  lsp = <a class="code" href="isis__lsp_8c.html#a3859237ab43b147f4520d060439ca002">lsp_search</a> (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1]);
  <span class="keywordflow">if</span> (lsp)
    comp = <a class="code" href="isis__lsp_8c.html#a299d8a18662f432a07979c177e2723f0">lsp_compare</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, lsp, hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>,
            hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>, hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>);
  <span class="keywordflow">if</span> (lsp &amp;&amp; (lsp-&gt;<a class="code" href="structisis__lsp.html#a92fb19d67740e3bfde012e19af97b7d3">own_lsp</a>
#ifdef TOPOLOGY_GENERATE
          || lsp-&gt;from_topology
#endif <span class="comment">/* TOPOLOGY_GENERATE */</span>
      ))
    <span class="keywordflow">goto</span> dontcheckadj;

  <span class="comment">/* 7.3.15.1 a) 6 - Must check that we have an adjacency of the same level  */</span>
  <span class="comment">/* for broadcast circuits, snpa should be compared */</span>
  <span class="comment">/* FIXME : Point To Point */</span>

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
    {
      adj = <a class="code" href="isis__adjacency_8c.html#ae2500faa623c2fe78fef559c347dc2c7">isis_adj_lookup_snpa</a> (ssnpa, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ada9bf2584373a37aed06b2e4c9e796f9">adjdb</a>[level - 1]);
      <span class="keywordflow">if</span> (!adj)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;(%s): DS ======= LSP %s, seq 0x%08x, cksum 0x%04x, &quot;</span>
              <span class="stringliteral">&quot;lifetime %us on %s&quot;</span>,
              circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
              <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
              ntohl (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>),
              ntohs (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>),
              ntohs (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>), circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;  <span class="comment">/* Silently discard */</span>
    }
    }

  <span class="comment">/* for non broadcast, we just need to find same level adj */</span>
  <span class="keywordflow">else</span>
    {
      <span class="comment">/* If no adj, or no sharing of level */</span>
      <span class="keywordflow">if</span> (!circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a15852a59ea8be80680abac2070659440">p2p</a>.<a class="code" href="structisis__p2p__info.html#a17d32289e6648b9855b93482cd7c45a5">neighbor</a>)
    {
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;   <span class="comment">/* Silently discard */</span>
    }
      <span class="keywordflow">else</span>
    {
      <span class="keywordflow">if</span> (((level == 1) &amp;&amp;
           (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a15852a59ea8be80680abac2070659440">p2p</a>.<a class="code" href="structisis__p2p__info.html#a17d32289e6648b9855b93482cd7c45a5">neighbor</a>-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434a299a3b0ab58836ff30296ebbd291ac59">ISIS_ADJ_LEVEL2</a>)) ||
          ((level == 2) &amp;&amp;
           (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a15852a59ea8be80680abac2070659440">p2p</a>.<a class="code" href="structisis__p2p__info.html#a17d32289e6648b9855b93482cd7c45a5">neighbor</a>-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434ac5e73d4da9efe1a383f26fd0c958c53c">ISIS_ADJ_LEVEL1</a>)))
        <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;    <span class="comment">/* Silently discard */</span>
    }
    }
dontcheckadj:
  <span class="comment">/* 7.3.15.1 a) 7 - Passwords for level 1 - not implemented  */</span>

  <span class="comment">/* 7.3.15.1 a) 8 - Passwords for level 2 - not implemented  */</span>

  <span class="comment">/* 7.3.15.1 a) 9 - OriginatingLSPBufferSize - not implemented  FIXME: do it */</span>

  <span class="comment">/* 7.3.15.1 b) - If the remaining life time is 0, we perform 7.3.16.4 */</span>
  <span class="keywordflow">if</span> (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a> == 0)
    {
      <span class="keywordflow">if</span> (!lsp)
    {
      <span class="comment">/* 7.3.16.4 a) 1) No LSP in db -&gt; send an ack, but don&#39;t save */</span>
      <span class="comment">/* only needed on explicit update, eg - p2p */</span>
      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#aa2113a49e7c75a5d4997d59df0530726">CIRCUIT_T_P2P</a>)
        <a class="code" href="isis__pdu_8c.html#a92677d57850d42c168f35387f9bcaeb8">ack_lsp</a> (hdr, circuit, level);
      <span class="keywordflow">return</span> retval;    <span class="comment">/* FIXME: do we need a purge? */</span>
    }
      <span class="keywordflow">else</span>
    {
      <span class="keywordflow">if</span> (<a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>))
        {
          <span class="comment">/* LSP by some other system -&gt; do 7.3.16.4 b) */</span>
          <span class="comment">/* 7.3.16.4 b) 1)  */</span>
          <span class="keywordflow">if</span> (comp == <a class="code" href="isis__lsp_8h.html#a2b334f17cd54fd535379deac75b7e8f0">LSP_NEWER</a>)
        {
          <a class="code" href="isis__lsp_8c.html#ad5c26e2f2f08b4a76183ca91ff454ff9">lsp_update</a> (lsp, hdr, circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>,
                  level);
          <span class="comment">/* ii */</span>
          <a class="code" href="isis__flags_8h.html#a57f45d9b4a8c70c53f796d96e5555fac">ISIS_FLAGS_SET_ALL</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>);
          <span class="comment">/* iii */</span>
          <a class="code" href="isis__flags_8h.html#ac67a62e2e71ff606be09d8e74865aac8">ISIS_CLEAR_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>, circuit);
          <span class="comment">/* v */</span>
          <a class="code" href="isis__flags_8h.html#a4de3e70a95a71772672a6188573dba45">ISIS_FLAGS_CLEAR_ALL</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a03d0dd350cd760986f4907c5df08363a">SSNflags</a>); <span class="comment">/* FIXME: OTHER than c */</span>
          <span class="comment">/* iv */</span>
          <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> != <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
            <a class="code" href="isis__flags_8h.html#a1f7b5b2baa94ebc0450ccb5839a682e7">ISIS_SET_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a03d0dd350cd760986f4907c5df08363a">SSNflags</a>, circuit);

        }       <span class="comment">/* 7.3.16.4 b) 2) */</span>
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (comp == <a class="code" href="isis__lsp_8h.html#a99cb1e872b18fd541d954846ec30aa7f">LSP_EQUAL</a>)
        {
          <span class="comment">/* i */</span>
          <a class="code" href="isis__flags_8h.html#ac67a62e2e71ff606be09d8e74865aac8">ISIS_CLEAR_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>, circuit);
          <span class="comment">/* ii */</span>
          <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> != <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
            <a class="code" href="isis__flags_8h.html#a1f7b5b2baa94ebc0450ccb5839a682e7">ISIS_SET_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a03d0dd350cd760986f4907c5df08363a">SSNflags</a>, circuit);
        }       <span class="comment">/* 7.3.16.4 b) 3) */</span>
          <span class="keywordflow">else</span>
        {
          <a class="code" href="isis__flags_8h.html#a1f7b5b2baa94ebc0450ccb5839a682e7">ISIS_SET_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>, circuit);
          <a class="code" href="isis__flags_8h.html#ac67a62e2e71ff606be09d8e74865aac8">ISIS_CLEAR_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a03d0dd350cd760986f4907c5df08363a">SSNflags</a>, circuit);
        }
        }
      <span class="keywordflow">else</span>
        {
          <span class="comment">/* our own LSP -&gt; 7.3.16.4 c) */</span>
          <span class="keywordflow">if</span> (<a class="code" href="isis__lsp_8h.html#a15ad7ce72dee875930a28bec035f7b71">LSP_PSEUDO_ID</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>) !=
          circuit-&gt;<a class="code" href="structisis__circuit.html#a10453f6bcc1e8f1cb466240a81836ba9">circuit_id</a>
          || (<a class="code" href="isis__lsp_8h.html#a15ad7ce72dee875930a28bec035f7b71">LSP_PSEUDO_ID</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>) ==
              circuit-&gt;<a class="code" href="structisis__circuit.html#a10453f6bcc1e8f1cb466240a81836ba9">circuit_id</a>
              &amp;&amp; circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#adb24376d01beb41cab0ed0c49c3a214c">is_dr</a>[level - 1] == 1))
        {
          lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a> = htonl (ntohl (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>) + 1);
          <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#abd8d8358bf794de3d9fba9ef5de689b3">DEBUG_UPDATE_PACKETS</a>)
            <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;LSP LEN: %d&quot;</span>,
                ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a>));
          <a class="code" href="checksum_8c.html#a097fa5404eb654e8e112bb954bf4ef15">fletcher_checksum</a> (<a class="code" href="stream_8h.html#afde5f5db208a43da6faf7b830f26d7fc">STREAM_DATA</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>) + 12,
                   ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a>) - 12, 12);
          <a class="code" href="isis__flags_8h.html#a57f45d9b4a8c70c53f796d96e5555fac">ISIS_FLAGS_SET_ALL</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>);
          <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#abd8d8358bf794de3d9fba9ef5de689b3">DEBUG_UPDATE_PACKETS</a>)
            <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Upd (%s): (1) re-originating LSP %s new &quot;</span>
                <span class="stringliteral">&quot;seq 0x%08x&quot;</span>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
                <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
                ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>));
          lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a> =
            htons (<a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a>
               (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#af0e5e6cfa7b7536e0700dd3645025d9b">max_lsp_lifetime</a>[level - 1],
                <a class="code" href="isis__constants_8h.html#adfaaf0b4e69adf9ae9c8dc47e3e00918">MAX_AGE_JITTER</a>));
        }
          <span class="keywordflow">else</span>
        {
          <span class="comment">/* Got purge for own pseudo-lsp, and we are not DR  */</span>
          <a class="code" href="isis__lsp_8c.html#a326bd66d63f17cf92421e5df0d29fe32">lsp_purge_dr</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>, circuit, level);
        }
        }
    }
      <span class="keywordflow">return</span> retval;
    }
  <span class="comment">/* 7.3.15.1 c) - If this is our own lsp and we don&#39;t have it initiate a </span>
<span class="comment">   * purge */</span>
  <span class="keywordflow">if</span> (<a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>) == 0)
    {
      <span class="keywordflow">if</span> (!lsp)
    {
      <span class="comment">/* 7.3.16.4: initiate a purge */</span>
      <a class="code" href="isis__lsp_8c.html#a3b934844c90f614a6f5f4a2734a23e77">lsp_purge_non_exist</a> (hdr, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
    }
      <span class="comment">/* 7.3.15.1 d) - If this is our own lsp and we have it */</span>

      <span class="comment">/* In 7.3.16.1, If an Intermediate system R somewhere in the domain</span>
<span class="comment">       * has information that the current sequence number for source S is</span>
<span class="comment">       * &quot;greater&quot; than that held by S, ... */</span>

      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ntohl (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>) &gt; ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>))
    {
      <span class="comment">/* 7.3.16.1  */</span>
      lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a> = htonl (ntohl (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>) + 1);

      <a class="code" href="checksum_8c.html#a097fa5404eb654e8e112bb954bf4ef15">fletcher_checksum</a> (<a class="code" href="stream_8h.html#afde5f5db208a43da6faf7b830f26d7fc">STREAM_DATA</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>) + 12,
               ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a>) - 12, 12);

      <a class="code" href="isis__flags_8h.html#a57f45d9b4a8c70c53f796d96e5555fac">ISIS_FLAGS_SET_ALL</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>);
      <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#abd8d8358bf794de3d9fba9ef5de689b3">DEBUG_UPDATE_PACKETS</a>)
        <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Upd (%s): (2) re-originating LSP %s new seq &quot;</span>
            <span class="stringliteral">&quot;0x%08x&quot;</span>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
            <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
            ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>));
      lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a> =
        htons (<a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a>
           (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#af0e5e6cfa7b7536e0700dd3645025d9b">max_lsp_lifetime</a>[level - 1],
            <a class="code" href="isis__constants_8h.html#adfaaf0b4e69adf9ae9c8dc47e3e00918">MAX_AGE_JITTER</a>));
    }
    }
  <span class="keywordflow">else</span>
    {
      <span class="comment">/* 7.3.15.1 e) - This lsp originated on another system */</span>

      <span class="comment">/* 7.3.15.1 e) 1) LSP newer than the one in db or no LSP in db */</span>
      <span class="keywordflow">if</span> ((!lsp || comp == <a class="code" href="isis__lsp_8h.html#a2b334f17cd54fd535379deac75b7e8f0">LSP_NEWER</a>))
    {
      <span class="comment">/* i */</span>
      <span class="keywordflow">if</span> (lsp)
        {
<span class="preprocessor">#ifdef EXTREME_DEBUG</span>
<span class="preprocessor"></span>          <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;level %d number is - %ld&quot;</span>, level,
              circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1]-&gt;<a class="code" href="structdict__t.html#a488591945754dac1b010461dfc4ff75b">dict_nodecount</a>);
<span class="preprocessor">#endif </span><span class="comment">/* EXTREME DEBUG */</span>
          <a class="code" href="isis__lsp_8c.html#ac9198965904e0c9a57ade0011b114d3f">lsp_search_and_destroy</a> (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>,
                      circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1]);
          <span class="comment">/* exists, so we overwrite */</span>
<span class="preprocessor">#ifdef EXTREME_DEBUG</span>
<span class="preprocessor"></span>          <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;level %d number is - %ld&quot;</span>, level,
              circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1]-&gt;<a class="code" href="structdict__t.html#a488591945754dac1b010461dfc4ff75b">dict_nodecount</a>);
<span class="preprocessor">#endif </span><span class="comment">/* EXTREME DEBUG */</span>
        }
      <span class="comment">/*</span>
<span class="comment">       * If this lsp is a frag, need to see if we have zero lsp present</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (<a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>) != 0)
        {
          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (lspid, hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);
          <a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (lspid) = 0;
          lsp0 = <a class="code" href="isis__lsp_8c.html#a3859237ab43b147f4520d060439ca002">lsp_search</a> (lspid, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1]);
          <span class="keywordflow">if</span> (!lsp0)
        {
          <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;Got lsp frag, while zero lsp not database&quot;</span>);
          <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
        }
        }
      lsp =
        <a class="code" href="isis__lsp_8c.html#af11fc334a37a7a089a4c5e2d44496110">lsp_new_from_stream_ptr</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>,
                     ntohs (hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a>), lsp0,
                     circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>);
      lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> = level;
      lsp-&gt;<a class="code" href="structisis__lsp.html#a4481c48a70a19d351802ee561729fce3">adj</a> = adj;
      <a class="code" href="isis__lsp_8c.html#a09d8f3bcc073c87f01c32b2f0994fb04">lsp_insert</a> (lsp, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1]);
      <span class="comment">/* ii */</span>
      <a class="code" href="isis__flags_8h.html#a57f45d9b4a8c70c53f796d96e5555fac">ISIS_FLAGS_SET_ALL</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>);
      <span class="comment">/* iii */</span>
      <a class="code" href="isis__flags_8h.html#ac67a62e2e71ff606be09d8e74865aac8">ISIS_CLEAR_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>, circuit);

      <span class="comment">/* iv */</span>
      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> != <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
        <a class="code" href="isis__flags_8h.html#a1f7b5b2baa94ebc0450ccb5839a682e7">ISIS_SET_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a03d0dd350cd760986f4907c5df08363a">SSNflags</a>, circuit);
      <span class="comment">/* FIXME: v) */</span>
    }
      <span class="comment">/* 7.3.15.1 e) 2) LSP equal to the one in db */</span>
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (comp == <a class="code" href="isis__lsp_8h.html#a99cb1e872b18fd541d954846ec30aa7f">LSP_EQUAL</a>)
    {
      <a class="code" href="isis__flags_8h.html#ac67a62e2e71ff606be09d8e74865aac8">ISIS_CLEAR_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>, circuit);
      <a class="code" href="isis__lsp_8c.html#ad5c26e2f2f08b4a76183ca91ff454ff9">lsp_update</a> (lsp, hdr, circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>, level);
      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> != <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
        {
          <a class="code" href="isis__flags_8h.html#a1f7b5b2baa94ebc0450ccb5839a682e7">ISIS_SET_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a03d0dd350cd760986f4907c5df08363a">SSNflags</a>, circuit);
        }
    }
      <span class="comment">/* 7.3.15.1 e) 3) LSP older than the one in db */</span>
      <span class="keywordflow">else</span>
    {
      <a class="code" href="isis__flags_8h.html#a1f7b5b2baa94ebc0450ccb5839a682e7">ISIS_SET_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>, circuit);
      <a class="code" href="isis__flags_8h.html#ac67a62e2e71ff606be09d8e74865aac8">ISIS_CLEAR_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a03d0dd350cd760986f4907c5df08363a">SSNflags</a>, circuit);
    }
    }
  <span class="keywordflow">if</span> (lsp)
    lsp-&gt;<a class="code" href="structisis__lsp.html#a4481c48a70a19d351802ee561729fce3">adj</a> = adj;
  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae1ed5a5e3ac93396b812ac8d35186073"></a><!-- doxytag: member="isis_pdu.c::process_p2p_hello" ref="ae1ed5a5e3ac93396b812ac8d35186073" args="(struct isis_circuit *circuit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int process_p2p_hello </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00282">282</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
  <span class="keyword">struct </span><a class="code" href="structisis__p2p__hello__hdr.html">isis_p2p_hello_hdr</a> *hdr;
  <span class="keyword">struct </span><a class="code" href="structisis__adjacency.html">isis_adjacency</a> *adj;
  u_int32_t expected = 0, found;
  <span class="keyword">struct </span><a class="code" href="structtlvs.html">tlvs</a> <a class="code" href="structtlvs.html">tlvs</a>;

  <span class="keywordflow">if</span> ((<a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>) -
       <a class="code" href="stream_8c.html#a717f15645000d42a15034f5ec83fc9a5">stream_get_getp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>)) &lt; <a class="code" href="isis__pdu_8h.html#afc57a4bb656d257caa10f6a172006cd1">ISIS_P2PHELLO_HDRLEN</a>)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Packet too short&quot;</span>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }

  <span class="comment">/* 8.2.5.1 PDU acceptance tests */</span>

  <span class="comment">/* 8.2.5.1 a) external domain untrue */</span>
  <span class="comment">/* FIXME: not useful at all?         */</span>

  <span class="comment">/* 8.2.5.1 b) ID Length mismatch */</span>
  <span class="comment">/* checked at the handle_pdu     */</span>

  <span class="comment">/* 8.2.5.2 IIH PDU Processing */</span>

  <span class="comment">/* 8.2.5.2 a) 1) Maximum Area Addresses */</span>
  <span class="comment">/* Already checked, and can also be ommited */</span>

  <span class="comment">/*</span>
<span class="comment">   * Get the header</span>
<span class="comment">   */</span>
  hdr = (<span class="keyword">struct </span><a class="code" href="structisis__p2p__hello__hdr.html">isis_p2p_hello_hdr</a> *) <a class="code" href="stream_8h.html#a4bb95ef1391c2b8b7b97678a5ad87cb7">STREAM_PNT</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>);
  circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>-&gt;<a class="code" href="structstream.html#adb2dceb1b9e09edf611d9076a7a1a491">getp</a> += <a class="code" href="isis__pdu_8h.html#afc57a4bb656d257caa10f6a172006cd1">ISIS_P2PHELLO_HDRLEN</a>;

  <span class="comment">/*  hdr.circuit_t = stream_getc (stream);</span>
<span class="comment">     stream_get (hdr.source_id, stream, ISIS_SYS_ID_LEN);</span>
<span class="comment">     hdr.hold_time = stream_getw (stream);</span>
<span class="comment">     hdr.pdu_len   = stream_getw (stream);</span>
<span class="comment">     hdr.local_id  = stream_getc (stream); */</span>

  <span class="comment">/*</span>
<span class="comment">   * My interpertation of the ISO, if no adj exists we will create one for </span>
<span class="comment">   * the circuit</span>
<span class="comment">   */</span>

  <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#a4113d6aad857cfa148450dfc6ed85b5b">DEBUG_ADJ_PACKETS</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Adj (%s): Rcvd P2P IIH from (%s), cir type %s,&quot;</span>
          <span class="stringliteral">&quot; cir id %02d, length %d&quot;</span>,
          circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>,
          <a class="code" href="isis__misc_8c.html#a35b15c65a44088982fa8daca9fc7b022">circuit_t2string</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#ab222d6d0b054faa159d72bcb9768b3fb">circuit_is_type</a>),
          circuit-&gt;<a class="code" href="structisis__circuit.html#a10453f6bcc1e8f1cb466240a81836ba9">circuit_id</a>, ntohs (hdr-&gt;<a class="code" href="structisis__p2p__hello__hdr.html#ab4e1e57d67bc848f55e96d85a9e840c5">pdu_len</a>));
    }

  adj = circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a15852a59ea8be80680abac2070659440">p2p</a>.<a class="code" href="structisis__p2p__info.html#a17d32289e6648b9855b93482cd7c45a5">neighbor</a>;
  <span class="keywordflow">if</span> (!adj)
    {
      adj = <a class="code" href="isis__adjacency_8c.html#a81fa83638827781e0f128c9c01551a95">isis_new_adj</a> (hdr-&gt;<a class="code" href="structisis__p2p__hello__hdr.html#af8de3d87d0e44db1853b72c60e11a983">source_id</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, circuit);
      <span class="keywordflow">if</span> (adj == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;
      circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a15852a59ea8be80680abac2070659440">p2p</a>.<a class="code" href="structisis__p2p__info.html#a17d32289e6648b9855b93482cd7c45a5">neighbor</a> = adj;
      <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1973db8c983074b9c3e0cc74c23eab47">ISIS_ADJ_INITIALIZING</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
      adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> = <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4da1d20bc4d429708dd9bc81735bd176618">ISIS_SYSTYPE_UNKNOWN</a>;
    }

  <span class="comment">/* 8.2.6 Monitoring point-to-point adjacencies */</span>
  adj-&gt;<a class="code" href="structisis__adjacency.html#a656446a9be5f9ebf466ffacc8741a909">hold_time</a> = ntohs (hdr-&gt;<a class="code" href="structisis__p2p__hello__hdr.html#a7bacc6278778ae3b6aeab9a68b5ed6fb">hold_time</a>);
  adj-&gt;<a class="code" href="structisis__adjacency.html#afd570f7072dac8465cf207cd6df6c567">last_upd</a> = time (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);

  <span class="comment">/*</span>
<span class="comment">   * Lets get the TLVS now</span>
<span class="comment">   */</span>
  expected |= <a class="code" href="isis__tlv_8h.html#ae2a91163530ea4d9bfb3b00394a48316">TLVFLAG_AREA_ADDRS</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#a493ed26a4a2decc55275bd699df9a4a8">TLVFLAG_AUTH_INFO</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#ac9149da10b98f4211a51249c752b5fee">TLVFLAG_NLPID</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#ac1d5ea73aa3cc33a2c7e4190df6fab00">TLVFLAG_IPV4_ADDR</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#af63af1cfdbe427be867d8191c1ea5b5f">TLVFLAG_IPV6_ADDR</a>;

  retval = <a class="code" href="isis__tlv_8c.html#aad6fa3b6cc5e93707f75d8247f8787c8">parse_tlvs</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
               <a class="code" href="stream_8h.html#a4bb95ef1391c2b8b7b97678a5ad87cb7">STREAM_PNT</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>),
               ntohs (hdr-&gt;<a class="code" href="structisis__p2p__hello__hdr.html#ab4e1e57d67bc848f55e96d85a9e840c5">pdu_len</a>) - <a class="code" href="isis__pdu_8h.html#afc57a4bb656d257caa10f6a172006cd1">ISIS_P2PHELLO_HDRLEN</a>
               - <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a>, &amp;expected, &amp;found, &amp;<a class="code" href="structtlvs.html">tlvs</a>);

  <span class="keywordflow">if</span> (retval &gt; <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>)
    {
      <a class="code" href="isis__tlv_8c.html#a5f499235cf5a69697d280f5a1cd01612">free_tlvs</a> (&amp;<a class="code" href="structtlvs.html">tlvs</a>);
      <span class="keywordflow">return</span> retval;
    };

  <span class="comment">/* 8.2.5.1 c) Authentication */</span>
  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a601d2b4b3220757f8f7212f2a1628ab2">passwd</a>.<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>)
    {
      <span class="keywordflow">if</span> (!(found &amp; <a class="code" href="isis__tlv_8h.html#a493ed26a4a2decc55275bd699df9a4a8">TLVFLAG_AUTH_INFO</a>) ||
      <a class="code" href="isis__pdu_8c.html#aefd5a8caa169a427e30d599b51ab52e9">authentication_check</a> (&amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a601d2b4b3220757f8f7212f2a1628ab2">passwd</a>, &amp;<a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>))
    {
      <a class="code" href="isis__events_8c.html#a16a754e810bb7ba8e3b2a23c89d6d130">isis_event_auth_failure</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
                   <span class="stringliteral">&quot;P2P hello authentication failure&quot;</span>,
                   hdr-&gt;<a class="code" href="structisis__p2p__hello__hdr.html#af8de3d87d0e44db1853b72c60e11a983">source_id</a>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
    }
    }

  <span class="comment">/* we do this now because the adj may not survive till the end... */</span>

  <span class="comment">/* we need to copy addresses to the adj */</span>
  <a class="code" href="isis__pdu_8c.html#af96726be5388512e070368d2438bbf99">tlvs_to_adj_ipv4_addrs</a> (&amp;<a class="code" href="structtlvs.html">tlvs</a>, adj);

<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  tlvs_to_adj_ipv6_addrs (&amp;<a class="code" href="structtlvs.html">tlvs</a>, adj);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

  <span class="comment">/* lets take care of the expiry */</span>
  <a class="code" href="thread_8h.html#ae1dfd3f5f643212148d60a41d9f2192a">THREAD_TIMER_OFF</a> (adj-&gt;<a class="code" href="structisis__adjacency.html#a16900c0c5677510df0a115d145d5ce87">t_expire</a>);
  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, adj-&gt;<a class="code" href="structisis__adjacency.html#a16900c0c5677510df0a115d145d5ce87">t_expire</a>, <a class="code" href="isis__adjacency_8c.html#a089c767d62df53d044fc7ba923219879">isis_adj_expire</a>, adj,
           (<span class="keywordtype">long</span>) adj-&gt;<a class="code" href="structisis__adjacency.html#a656446a9be5f9ebf466ffacc8741a909">hold_time</a>);

  <span class="comment">/* 8.2.5.2 a) a match was detected */</span>
  <span class="keywordflow">if</span> (<a class="code" href="isis__pdu_8c.html#ac44201d5d72450ec89f35a014c1e31c1">area_match</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aca1436df894da89fb83d7924ef248397">area_addrs</a>, <a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#a11d8deaa75c26e958cff5f74fee3ef10">area_addrs</a>))
    {
      <span class="comment">/* 8.2.5.2 a) 2) If the system is L1 - table 5 */</span>
      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a> == <a class="code" href="isis__constants_8h.html#a4806dbcd4c094ef55cecd6aca29520d7">IS_LEVEL_1</a>)
    {
      <span class="keywordflow">switch</span> (hdr-&gt;<a class="code" href="structisis__p2p__hello__hdr.html#a0baabb9d6fe6845b3c63268586bf169a">circuit_t</a>)
        {
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#a4806dbcd4c094ef55cecd6aca29520d7">IS_LEVEL_1</a>:
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#a9906fe43cc332e34827b3c233d509da6">IS_LEVEL_1_AND_2</a>:
          <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#ade48f111121efb755bd2ea13a06a16ae">adj_state</a> != <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>)
        {
          <span class="comment">/* (4) adj state up */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
          <span class="comment">/* (5) adj usage level 1 */</span>
          adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> = <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434ac5e73d4da9efe1a383f26fd0c958c53c">ISIS_ADJ_LEVEL1</a>;
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434ac5e73d4da9efe1a383f26fd0c958c53c">ISIS_ADJ_LEVEL1</a>)
        {
          ;     <span class="comment">/* accept */</span>
        }
          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#a9daa7fbf09b604c718f3bbe189aedd1a">IS_LEVEL_2</a>:
          <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#ade48f111121efb755bd2ea13a06a16ae">adj_state</a> != <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>)
        {
          <span class="comment">/* (7) reject - wrong system type event */</span>
          <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;wrongSystemType&quot;</span>);
          <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;  <span class="comment">/* Reject */</span>
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434ac5e73d4da9efe1a383f26fd0c958c53c">ISIS_ADJ_LEVEL1</a>)
        {
          <span class="comment">/* (6) down - wrong system */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a74fdb396aae235e00736312b60c5d347">ISIS_ADJ_DOWN</a>, <span class="stringliteral">&quot;Wrong System&quot;</span>);
        }
          <span class="keywordflow">break</span>;
        }
    }

      <span class="comment">/* 8.2.5.2 a) 3) If the system is L1L2 - table 6 */</span>
      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a> == <a class="code" href="isis__constants_8h.html#a9906fe43cc332e34827b3c233d509da6">IS_LEVEL_1_AND_2</a>)
    {
      <span class="keywordflow">switch</span> (hdr-&gt;<a class="code" href="structisis__p2p__hello__hdr.html#a0baabb9d6fe6845b3c63268586bf169a">circuit_t</a>)
        {
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#a4806dbcd4c094ef55cecd6aca29520d7">IS_LEVEL_1</a>:
          <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#ade48f111121efb755bd2ea13a06a16ae">adj_state</a> != <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>)
        {
          <span class="comment">/* (6) adj state up */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
          <span class="comment">/* (7) adj usage level 1 */</span>
          adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> = <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434ac5e73d4da9efe1a383f26fd0c958c53c">ISIS_ADJ_LEVEL1</a>;
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434ac5e73d4da9efe1a383f26fd0c958c53c">ISIS_ADJ_LEVEL1</a>)
        {
          ;     <span class="comment">/* accept */</span>
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434aae5d5e9d6b2655fbe76c0eaa011f9c58">ISIS_ADJ_LEVEL1AND2</a>) ||
               (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434a299a3b0ab58836ff30296ebbd291ac59">ISIS_ADJ_LEVEL2</a>))
        {
          <span class="comment">/* (8) down - wrong system */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a74fdb396aae235e00736312b60c5d347">ISIS_ADJ_DOWN</a>, <span class="stringliteral">&quot;Wrong System&quot;</span>);
        }
          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#a9daa7fbf09b604c718f3bbe189aedd1a">IS_LEVEL_2</a>:
          <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#ade48f111121efb755bd2ea13a06a16ae">adj_state</a> != <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>)
        {
          <span class="comment">/* (6) adj state up */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
          <span class="comment">/* (9) adj usage level 2 */</span>
          adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> = <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434a299a3b0ab58836ff30296ebbd291ac59">ISIS_ADJ_LEVEL2</a>;
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434ac5e73d4da9efe1a383f26fd0c958c53c">ISIS_ADJ_LEVEL1</a>) ||
               (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434aae5d5e9d6b2655fbe76c0eaa011f9c58">ISIS_ADJ_LEVEL1AND2</a>))
        {
          <span class="comment">/* (8) down - wrong system */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a74fdb396aae235e00736312b60c5d347">ISIS_ADJ_DOWN</a>, <span class="stringliteral">&quot;Wrong System&quot;</span>);
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434a299a3b0ab58836ff30296ebbd291ac59">ISIS_ADJ_LEVEL2</a>)
        {
          ;     <span class="comment">/* Accept */</span>
        }
          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#a9906fe43cc332e34827b3c233d509da6">IS_LEVEL_1_AND_2</a>:
          <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#ade48f111121efb755bd2ea13a06a16ae">adj_state</a> != <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>)
        {
          <span class="comment">/* (6) adj state up */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
          <span class="comment">/* (10) adj usage level 1 */</span>
          adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> = <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434aae5d5e9d6b2655fbe76c0eaa011f9c58">ISIS_ADJ_LEVEL1AND2</a>;
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434ac5e73d4da9efe1a383f26fd0c958c53c">ISIS_ADJ_LEVEL1</a>) ||
               (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434a299a3b0ab58836ff30296ebbd291ac59">ISIS_ADJ_LEVEL2</a>))
        {
          <span class="comment">/* (8) down - wrong system */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a74fdb396aae235e00736312b60c5d347">ISIS_ADJ_DOWN</a>, <span class="stringliteral">&quot;Wrong System&quot;</span>);
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434aae5d5e9d6b2655fbe76c0eaa011f9c58">ISIS_ADJ_LEVEL1AND2</a>)
        {
          ;     <span class="comment">/* Accept */</span>
        }
          <span class="keywordflow">break</span>;
        }
    }

      <span class="comment">/* 8.2.5.2 a) 4) If the system is L2 - table 7 */</span>
      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a> == <a class="code" href="isis__constants_8h.html#a9daa7fbf09b604c718f3bbe189aedd1a">IS_LEVEL_2</a>)
    {
      <span class="keywordflow">switch</span> (hdr-&gt;<a class="code" href="structisis__p2p__hello__hdr.html#a0baabb9d6fe6845b3c63268586bf169a">circuit_t</a>)
        {
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#a4806dbcd4c094ef55cecd6aca29520d7">IS_LEVEL_1</a>:
          <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#ade48f111121efb755bd2ea13a06a16ae">adj_state</a> != <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>)
        {
          <span class="comment">/* (5) reject - wrong system type event */</span>
          <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;wrongSystemType&quot;</span>);
          <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;  <span class="comment">/* Reject */</span>
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434aae5d5e9d6b2655fbe76c0eaa011f9c58">ISIS_ADJ_LEVEL1AND2</a>) ||
               (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434a299a3b0ab58836ff30296ebbd291ac59">ISIS_ADJ_LEVEL2</a>))
        {
          <span class="comment">/* (6) down - wrong system */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a74fdb396aae235e00736312b60c5d347">ISIS_ADJ_DOWN</a>, <span class="stringliteral">&quot;Wrong System&quot;</span>);
        }
          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#a9906fe43cc332e34827b3c233d509da6">IS_LEVEL_1_AND_2</a>:
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#a9daa7fbf09b604c718f3bbe189aedd1a">IS_LEVEL_2</a>:
          <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#ade48f111121efb755bd2ea13a06a16ae">adj_state</a> != <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>)
        {
          <span class="comment">/* (7) adj state up */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
          <span class="comment">/* (8) adj usage level 2 */</span>
          adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> = <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434a299a3b0ab58836ff30296ebbd291ac59">ISIS_ADJ_LEVEL2</a>;
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434aae5d5e9d6b2655fbe76c0eaa011f9c58">ISIS_ADJ_LEVEL1AND2</a>)
        {
          <span class="comment">/* (6) down - wrong system */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a74fdb396aae235e00736312b60c5d347">ISIS_ADJ_DOWN</a>, <span class="stringliteral">&quot;Wrong System&quot;</span>);
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434a299a3b0ab58836ff30296ebbd291ac59">ISIS_ADJ_LEVEL2</a>)
        {
          ;     <span class="comment">/* Accept */</span>
        }
          <span class="keywordflow">break</span>;
        }
    }
    }
  <span class="comment">/* 8.2.5.2 b) if no match was detected */</span>
  <span class="keywordflow">else</span>
    {
      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a> == <a class="code" href="isis__constants_8h.html#a4806dbcd4c094ef55cecd6aca29520d7">IS_LEVEL_1</a>)
    {
      <span class="comment">/* 8.2.5.2 b) 1) is_type L1 and adj is not up */</span>
      <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#ade48f111121efb755bd2ea13a06a16ae">adj_state</a> != <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>)
        {
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a74fdb396aae235e00736312b60c5d347">ISIS_ADJ_DOWN</a>, <span class="stringliteral">&quot;Area Mismatch&quot;</span>);
          <span class="comment">/* 8.2.5.2 b) 2)is_type L1 and adj is up */</span>
        }
      <span class="keywordflow">else</span>
        {
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a74fdb396aae235e00736312b60c5d347">ISIS_ADJ_DOWN</a>,
                     <span class="stringliteral">&quot;Down - Area Mismatch&quot;</span>);
        }
    }
      <span class="comment">/* 8.2.5.2 b 3 If the system is L2 or L1L2 - table 8 */</span>
      <span class="keywordflow">else</span>
    {
      <span class="keywordflow">switch</span> (hdr-&gt;<a class="code" href="structisis__p2p__hello__hdr.html#a0baabb9d6fe6845b3c63268586bf169a">circuit_t</a>)
        {
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#a4806dbcd4c094ef55cecd6aca29520d7">IS_LEVEL_1</a>:
          <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#ade48f111121efb755bd2ea13a06a16ae">adj_state</a> != <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>)
        {
          <span class="comment">/* (6) reject - Area Mismatch event */</span>
          <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;AreaMismatch&quot;</span>);
          <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;  <span class="comment">/* Reject */</span>
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434ac5e73d4da9efe1a383f26fd0c958c53c">ISIS_ADJ_LEVEL1</a>)
        {
          <span class="comment">/* (7) down - area mismatch */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a74fdb396aae235e00736312b60c5d347">ISIS_ADJ_DOWN</a>, <span class="stringliteral">&quot;Area Mismatch&quot;</span>);

        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434aae5d5e9d6b2655fbe76c0eaa011f9c58">ISIS_ADJ_LEVEL1AND2</a>) ||
               (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434a299a3b0ab58836ff30296ebbd291ac59">ISIS_ADJ_LEVEL2</a>))
        {
          <span class="comment">/* (7) down - wrong system */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a74fdb396aae235e00736312b60c5d347">ISIS_ADJ_DOWN</a>, <span class="stringliteral">&quot;Wrong System&quot;</span>);
        }
          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#a9906fe43cc332e34827b3c233d509da6">IS_LEVEL_1_AND_2</a>:
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#a9daa7fbf09b604c718f3bbe189aedd1a">IS_LEVEL_2</a>:
          <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#ade48f111121efb755bd2ea13a06a16ae">adj_state</a> != <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>)
        {
          <span class="comment">/* (8) adj state up */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a1762b381ed451feffee948c5f5d0ed86">ISIS_ADJ_UP</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
          <span class="comment">/* (9) adj usage level 2 */</span>
          adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> = <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434a299a3b0ab58836ff30296ebbd291ac59">ISIS_ADJ_LEVEL2</a>;
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434ac5e73d4da9efe1a383f26fd0c958c53c">ISIS_ADJ_LEVEL1</a>)
        {
          <span class="comment">/* (7) down - wrong system */</span>
          <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a74fdb396aae235e00736312b60c5d347">ISIS_ADJ_DOWN</a>, <span class="stringliteral">&quot;Wrong System&quot;</span>);
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434aae5d5e9d6b2655fbe76c0eaa011f9c58">ISIS_ADJ_LEVEL1AND2</a>)
        {
          <span class="keywordflow">if</span> (hdr-&gt;<a class="code" href="structisis__p2p__hello__hdr.html#a0baabb9d6fe6845b3c63268586bf169a">circuit_t</a> == <a class="code" href="isis__constants_8h.html#a9daa7fbf09b604c718f3bbe189aedd1a">IS_LEVEL_2</a>)
            {
              <span class="comment">/* (7) down - wrong system */</span>
              <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a74fdb396aae235e00736312b60c5d347">ISIS_ADJ_DOWN</a>,
                         <span class="stringliteral">&quot;Wrong System&quot;</span>);
            }
          <span class="keywordflow">else</span>
            {
              <span class="comment">/* (7) down - area mismatch */</span>
              <a class="code" href="isis__adjacency_8c.html#a0f8f010e5bafa4fe5497e600c1ac12dd">isis_adj_state_change</a> (adj, <a class="code" href="isis__adjacency_8h.html#ad407b8d5b86106c7891c353d06af5576a74fdb396aae235e00736312b60c5d347">ISIS_ADJ_DOWN</a>,
                         <span class="stringliteral">&quot;Area Mismatch&quot;</span>);
            }
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434a299a3b0ab58836ff30296ebbd291ac59">ISIS_ADJ_LEVEL2</a>)
        {
          ;     <span class="comment">/* Accept */</span>
        }
          <span class="keywordflow">break</span>;
        }
    }
    }
  <span class="comment">/* 8.2.5.2 c) if the action was up - comparing circuit IDs */</span>
  <span class="comment">/* FIXME - Missing parts */</span>

  <span class="comment">/* some of my own understanding of the ISO, why the heck does</span>
<span class="comment">   * it not say what should I change the system_type to...</span>
<span class="comment">   */</span>
  <span class="keywordflow">switch</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a>)
    {
    <span class="keywordflow">case</span> <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434ac5e73d4da9efe1a383f26fd0c958c53c">ISIS_ADJ_LEVEL1</a>:
      adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> = <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4daddebdf6ea1f78c8503dd520854310078">ISIS_SYSTYPE_L1_IS</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434a299a3b0ab58836ff30296ebbd291ac59">ISIS_ADJ_LEVEL2</a>:
      adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> = <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4da615d7aa9f3d08cd8360e1b04a0b8806b">ISIS_SYSTYPE_L2_IS</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434aae5d5e9d6b2655fbe76c0eaa011f9c58">ISIS_ADJ_LEVEL1AND2</a>:
      adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> = <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4da615d7aa9f3d08cd8360e1b04a0b8806b">ISIS_SYSTYPE_L2_IS</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434a501a122376669a6dd34f5db4c380d43a">ISIS_ADJ_NONE</a>:
      adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> = <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4da1d20bc4d429708dd9bc81735bd176618">ISIS_SYSTYPE_UNKNOWN</a>;
      <span class="keywordflow">break</span>;
    }

  adj-&gt;<a class="code" href="structisis__adjacency.html#a94749cb53088c1898166a701f2a3931f">circuit_t</a> = hdr-&gt;<a class="code" href="structisis__p2p__hello__hdr.html#a0baabb9d6fe6845b3c63268586bf169a">circuit_t</a>;
  adj-&gt;<a class="code" href="structisis__adjacency.html#abee45e3e4c2c3f246db1c8aa19186cc8">level</a> = hdr-&gt;<a class="code" href="structisis__p2p__hello__hdr.html#a0baabb9d6fe6845b3c63268586bf169a">circuit_t</a>;

  <a class="code" href="isis__tlv_8c.html#a5f499235cf5a69697d280f5a1cd01612">free_tlvs</a> (&amp;<a class="code" href="structtlvs.html">tlvs</a>);

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4341127ac99b45c32f8f35aa8bc277df"></a><!-- doxytag: member="isis_pdu.c::process_psnp" ref="a4341127ac99b45c32f8f35aa8bc277df" args="(int level, struct isis_circuit *circuit, u_char *ssnpa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int process_psnp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>ssnpa</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l01559">1559</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> ((<a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>) -
       <a class="code" href="stream_8c.html#a717f15645000d42a15034f5ec83fc9a5">stream_get_getp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>)) &lt; <a class="code" href="isis__pdu_8h.html#aceab21fb8507148277e0980a0cd31a1e">ISIS_PSNP_HDRLEN</a>)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Packet too short&quot;</span>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }

  <span class="keywordflow">return</span> <a class="code" href="isis__pdu_8c.html#a4e16ec0d4416a973611faf1d57beac3a">process_snp</a> (<a class="code" href="isis__pdu_8h.html#aa027c4cc52b1c87015b46641ced54839">ISIS_SNP_PSNP_FLAG</a>, level, circuit, ssnpa);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4e16ec0d4416a973611faf1d57beac3a"></a><!-- doxytag: member="isis_pdu.c::process_snp" ref="a4e16ec0d4416a973611faf1d57beac3a" args="(int snp_type, int level, struct isis_circuit *circuit, u_char *ssnpa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int process_snp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>snp_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>ssnpa</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l01265">1265</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
  <span class="keywordtype">int</span> <a class="code" href="ospf__spf_8c.html#aea544039058f177b3d5698fbaa84cfb0">cmp</a>, own_lsp;
  <span class="keywordtype">char</span> typechar = <span class="charliteral">&#39; &#39;</span>;
  <span class="keywordtype">int</span> len;
  <span class="keyword">struct </span><a class="code" href="structisis__adjacency.html">isis_adjacency</a> *adj;
  <span class="keyword">struct </span><a class="code" href="structisis__complete__seqnum__hdr.html">isis_complete_seqnum_hdr</a> *chdr = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keyword">struct </span><a class="code" href="structisis__partial__seqnum__hdr.html">isis_partial_seqnum_hdr</a> *phdr = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  uint32_t found = 0, expected = 0;
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;
  <span class="keyword">struct </span><a class="code" href="structlsp__entry.html">lsp_entry</a> *entry;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node2, *nnode2;
  <span class="keyword">struct </span><a class="code" href="structtlvs.html">tlvs</a> <a class="code" href="structtlvs.html">tlvs</a>;
  <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *lsp_list = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keyword">struct </span><a class="code" href="structisis__passwd.html">isis_passwd</a> *<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>;

  <span class="keywordflow">if</span> (snp_type == <a class="code" href="isis__pdu_8h.html#ab9d39eb77423805c1c9e40824167b90d">ISIS_SNP_CSNP_FLAG</a>)
    {
      <span class="comment">/* getting the header info */</span>
      typechar = <span class="charliteral">&#39;C&#39;</span>;
      chdr =
    (<span class="keyword">struct </span><a class="code" href="structisis__complete__seqnum__hdr.html">isis_complete_seqnum_hdr</a> *) <a class="code" href="stream_8h.html#a4bb95ef1391c2b8b7b97678a5ad87cb7">STREAM_PNT</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>);
      circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>-&gt;<a class="code" href="structstream.html#adb2dceb1b9e09edf611d9076a7a1a491">getp</a> += <a class="code" href="isis__pdu_8h.html#ad643847e4f6bb080e2e6359abcad1c15">ISIS_CSNP_HDRLEN</a>;
      len = ntohs (chdr-&gt;<a class="code" href="structisis__complete__seqnum__hdr.html#aac677c5f7229ab1b4a718e5e4dc5705d">pdu_len</a>);
      <span class="keywordflow">if</span> (len &lt; <a class="code" href="isis__pdu_8h.html#ad643847e4f6bb080e2e6359abcad1c15">ISIS_CSNP_HDRLEN</a>)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Received a CSNP with bogus length!&quot;</span>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
    }
    }
  <span class="keywordflow">else</span>
    {
      typechar = <span class="charliteral">&#39;P&#39;</span>;
      phdr =
    (<span class="keyword">struct </span><a class="code" href="structisis__partial__seqnum__hdr.html">isis_partial_seqnum_hdr</a> *) <a class="code" href="stream_8h.html#a4bb95ef1391c2b8b7b97678a5ad87cb7">STREAM_PNT</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>);
      circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>-&gt;<a class="code" href="structstream.html#adb2dceb1b9e09edf611d9076a7a1a491">getp</a> += <a class="code" href="isis__pdu_8h.html#aceab21fb8507148277e0980a0cd31a1e">ISIS_PSNP_HDRLEN</a>;
      len = ntohs (phdr-&gt;<a class="code" href="structisis__partial__seqnum__hdr.html#a410986989ab5574f82baaaa8c26c9efa">pdu_len</a>);
      <span class="keywordflow">if</span> (len &lt; <a class="code" href="isis__pdu_8h.html#aceab21fb8507148277e0980a0cd31a1e">ISIS_PSNP_HDRLEN</a>)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Received a CSNP with bogus length!&quot;</span>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
    }
    }

  <span class="comment">/* 7.3.15.2 a) 1 - external domain circuit will discard snp pdu */</span>
  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#aa21c1b770870b6ca7583a164435d1977">ext_domain</a>)
    {

      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s): Rcvd L%d %cSNP on %s, &quot;</span>
          <span class="stringliteral">&quot;skipping: circuit externalDomain = true&quot;</span>,
          circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
          level, typechar, circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);

      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
    }

  <span class="comment">/* 7.3.15.2 a) 2,3 - manualL2OnlyMode not implemented */</span>
  <span class="keywordflow">if</span> (!<a class="code" href="isis__pdu_8c.html#ad3be9b74a266fca7d08e91ad3e4b0d45">accept_level</a> (level, circuit-&gt;<a class="code" href="structisis__circuit.html#ab222d6d0b054faa159d72bcb9768b3fb">circuit_is_type</a>))
    {

      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s): Rcvd L%d %cSNP on %s, &quot;</span>
          <span class="stringliteral">&quot;skipping: circuit type %s does not match level %d&quot;</span>,
          circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
          level,
          typechar,
          circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>,
          <a class="code" href="isis__misc_8c.html#a35b15c65a44088982fa8daca9fc7b022">circuit_t2string</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#ab222d6d0b054faa159d72bcb9768b3fb">circuit_is_type</a>), level);

      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
    }

  <span class="comment">/* 7.3.15.2 a) 4 - not applicable for CSNP  only PSNPs on broadcast */</span>
  <span class="keywordflow">if</span> ((snp_type == <a class="code" href="isis__pdu_8h.html#aa027c4cc52b1c87015b46641ced54839">ISIS_SNP_PSNP_FLAG</a>) &amp;&amp;
      (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>))
    {
      <span class="keywordflow">if</span> (!circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#adb24376d01beb41cab0ed0c49c3a214c">is_dr</a>[level - 1])
    {

      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s): Rcvd L%d %cSNP from %s on %s, &quot;</span>
              <span class="stringliteral">&quot;skipping: we are not the DIS&quot;</span>,
              circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
              level,
              typechar, <a class="code" href="isis__misc_8c.html#a9ff6d4a3900eef27814548c4c5357090">snpa_print</a> (ssnpa), circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);

      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
    }
    }

  <span class="comment">/* 7.3.15.2 a) 5 - need to make sure IDLength matches - already checked */</span>

  <span class="comment">/* 7.3.15.2 a) 6 - maximum area match, can be ommited since we only use 3</span>
<span class="comment">   * - already checked */</span>

  <span class="comment">/* 7.3.15.2 a) 7 - Must check that we have an adjacency of the same level  */</span>
  <span class="comment">/* for broadcast circuits, snpa should be compared */</span>
  <span class="comment">/* FIXME : Do we need to check SNPA? */</span>
  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
    {
      <span class="keywordflow">if</span> (snp_type == <a class="code" href="isis__pdu_8h.html#ab9d39eb77423805c1c9e40824167b90d">ISIS_SNP_CSNP_FLAG</a>)
    {
      adj =
        <a class="code" href="isis__adjacency_8c.html#af928a678a2e0e3296d688be2a4d8e7ac">isis_adj_lookup</a> (chdr-&gt;<a class="code" href="structisis__complete__seqnum__hdr.html#af1752370bddd40a0438065042268ff34">source_id</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ada9bf2584373a37aed06b2e4c9e796f9">adjdb</a>[level - 1]);
    }
      <span class="keywordflow">else</span>
    {
      <span class="comment">/* a psnp on a broadcast, how lovely of Juniper :) */</span>
      adj =
        <a class="code" href="isis__adjacency_8c.html#af928a678a2e0e3296d688be2a4d8e7ac">isis_adj_lookup</a> (phdr-&gt;<a class="code" href="structisis__partial__seqnum__hdr.html#af7a4f90cdd7c994d35d3bac0b367e9b1">source_id</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ada9bf2584373a37aed06b2e4c9e796f9">adjdb</a>[level - 1]);
    }
      <span class="keywordflow">if</span> (!adj)
    <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;     <span class="comment">/* Silently discard */</span>
    }
  <span class="keywordflow">else</span>
    {
      <span class="keywordflow">if</span> (!circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a15852a59ea8be80680abac2070659440">p2p</a>.<a class="code" href="structisis__p2p__info.html#a17d32289e6648b9855b93482cd7c45a5">neighbor</a>)
    <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;     <span class="comment">/* Silently discard */</span>
    }

  <span class="comment">/* 7.3.15.2 a) 8 - Passwords for level 1 - not implemented  */</span>

  <span class="comment">/* 7.3.15.2 a) 9 - Passwords for level 2 - not implemented  */</span>

  memset (&amp;<a class="code" href="structtlvs.html">tlvs</a>, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structtlvs.html">tlvs</a>));

  <span class="comment">/* parse the SNP */</span>
  expected |= <a class="code" href="isis__tlv_8h.html#a42ad62b910ab7635f552812763aeac12">TLVFLAG_LSP_ENTRIES</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#a493ed26a4a2decc55275bd699df9a4a8">TLVFLAG_AUTH_INFO</a>;
  retval = <a class="code" href="isis__tlv_8c.html#aad6fa3b6cc5e93707f75d8247f8787c8">parse_tlvs</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
               <a class="code" href="stream_8h.html#a4bb95ef1391c2b8b7b97678a5ad87cb7">STREAM_PNT</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>),
               len - circuit-&gt;<a class="code" href="structisis__circuit.html#abc0c4c6484b34715228b6811f442f9aa">rcv_stream</a>-&gt;<a class="code" href="structstream.html#adb2dceb1b9e09edf611d9076a7a1a491">getp</a>,
               &amp;expected, &amp;found, &amp;<a class="code" href="structtlvs.html">tlvs</a>);

  <span class="keywordflow">if</span> (retval &gt; <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;something went very wrong processing SNP&quot;</span>);
      <a class="code" href="isis__tlv_8c.html#a5f499235cf5a69697d280f5a1cd01612">free_tlvs</a> (&amp;<a class="code" href="structtlvs.html">tlvs</a>);
      <span class="keywordflow">return</span> retval;
    }

  <span class="keywordflow">if</span> (level == 1)
    passwd = &amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#afb66934e4bd3bda094550517a94de442">area_passwd</a>;
  <span class="keywordflow">else</span>
    passwd = &amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a60cd44a3a31b36dc808ad3fd9efc97a0">domain_passwd</a>;

  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(passwd-&gt;<a class="code" href="structisis__passwd.html#ae05e8ad6fc2b30cdbb8c29196f120bdf">snp_auth</a>, <a class="code" href="isis__common_8h.html#ae1c1a601a5f1496d080ddd19881916a3">SNP_AUTH_RECV</a>))
    {
      <span class="keywordflow">if</span> (passwd-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>)
    {
      <span class="keywordflow">if</span> (!(found &amp; <a class="code" href="isis__tlv_8h.html#a493ed26a4a2decc55275bd699df9a4a8">TLVFLAG_AUTH_INFO</a>) ||
          <a class="code" href="isis__pdu_8c.html#aefd5a8caa169a427e30d599b51ab52e9">authentication_check</a> (passwd, &amp;<a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>))
        {
          <a class="code" href="isis__events_8c.html#a16a754e810bb7ba8e3b2a23c89d6d130">isis_event_auth_failure</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
                       <span class="stringliteral">&quot;SNP authentication&quot;</span> <span class="stringliteral">&quot; failure&quot;</span>,
                       phdr ? phdr-&gt;<a class="code" href="structisis__partial__seqnum__hdr.html#af7a4f90cdd7c994d35d3bac0b367e9b1">source_id</a> : chdr-&gt;<a class="code" href="structisis__complete__seqnum__hdr.html#af1752370bddd40a0438065042268ff34">source_id</a>);
          <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
        }
    }
    }

  <span class="comment">/* debug isis snp-packets */</span>
  <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#ab16b82eb25717295303c7099035d9dc9">DEBUG_SNP_PACKETS</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s): Rcvd L%d %cSNP from %s on %s&quot;</span>,
          circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
          level,
          typechar, <a class="code" href="isis__misc_8c.html#a9ff6d4a3900eef27814548c4c5357090">snpa_print</a> (ssnpa), circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);
      <span class="keywordflow">if</span> (<a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#a5819e536c61399ab0dea624041495a35">lsp_entries</a>)
    {
      <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (<a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#a5819e536c61399ab0dea624041495a35">lsp_entries</a>, node, entry))
      {
        <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s):         %cSNP entry %s, seq 0x%08x,&quot;</span>
            <span class="stringliteral">&quot; cksum 0x%04x, lifetime %us&quot;</span>,
            circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
            typechar,
            <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (entry-&gt;<a class="code" href="structlsp__entry.html#a7343aec4f3fe479341c7a46e78593115">lsp_id</a>),
            ntohl (entry-&gt;<a class="code" href="structlsp__entry.html#a1c2972b33699b2a8e93f42dcc2519a1a">seq_num</a>),
            ntohs (entry-&gt;<a class="code" href="structlsp__entry.html#afb608ebc17ca3af33a74f25ae2f1e7d8">checksum</a>), ntohs (entry-&gt;<a class="code" href="structlsp__entry.html#ad216f5b8048448d789ea75d5958de3e1">rem_lifetime</a>));
      }
    }
    }

  <span class="comment">/* 7.3.15.2 b) Actions on LSP_ENTRIES reported */</span>
  <span class="keywordflow">if</span> (<a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#a5819e536c61399ab0dea624041495a35">lsp_entries</a>)
    {
      <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (<a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#a5819e536c61399ab0dea624041495a35">lsp_entries</a>, node, entry))
      {
    lsp = <a class="code" href="isis__lsp_8c.html#a3859237ab43b147f4520d060439ca002">lsp_search</a> (entry-&gt;<a class="code" href="structlsp__entry.html#a7343aec4f3fe479341c7a46e78593115">lsp_id</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1]);
    own_lsp = !<a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (entry-&gt;<a class="code" href="structlsp__entry.html#a7343aec4f3fe479341c7a46e78593115">lsp_id</a>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
    <span class="keywordflow">if</span> (lsp)
      {
        <span class="comment">/* 7.3.15.2 b) 1) is this LSP newer */</span>
        cmp = <a class="code" href="isis__lsp_8c.html#a299d8a18662f432a07979c177e2723f0">lsp_compare</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, lsp, entry-&gt;<a class="code" href="structlsp__entry.html#a1c2972b33699b2a8e93f42dcc2519a1a">seq_num</a>,
                   entry-&gt;<a class="code" href="structlsp__entry.html#afb608ebc17ca3af33a74f25ae2f1e7d8">checksum</a>, entry-&gt;<a class="code" href="structlsp__entry.html#ad216f5b8048448d789ea75d5958de3e1">rem_lifetime</a>);
        <span class="comment">/* 7.3.15.2 b) 2) if it equals, clear SRM on p2p */</span>
        <span class="keywordflow">if</span> (cmp == <a class="code" href="isis__lsp_8h.html#a99cb1e872b18fd541d954846ec30aa7f">LSP_EQUAL</a>)
          {
        <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> != <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
          <a class="code" href="isis__flags_8h.html#ac67a62e2e71ff606be09d8e74865aac8">ISIS_CLEAR_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>, circuit);
        <span class="comment">/* 7.3.15.2 b) 3) if it is older, clear SSN and set SRM */</span>
          }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cmp == <a class="code" href="isis__lsp_8h.html#a3902417a88de806e8b32c2a5930eb9bc">LSP_OLDER</a>)
          {
        <a class="code" href="isis__flags_8h.html#ac67a62e2e71ff606be09d8e74865aac8">ISIS_CLEAR_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a03d0dd350cd760986f4907c5df08363a">SSNflags</a>, circuit);
        <a class="code" href="isis__flags_8h.html#a1f7b5b2baa94ebc0450ccb5839a682e7">ISIS_SET_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>, circuit);
          }
        <span class="keywordflow">else</span>
          {
        <span class="comment">/* 7.3.15.2 b) 4) if it is newer, set SSN and clear SRM</span>
<span class="comment">         * on p2p */</span>
        <span class="keywordflow">if</span> (own_lsp)
          {
            <a class="code" href="isis__lsp_8c.html#a95c7b93c607b9aba6b6697b136d9ad98">lsp_inc_seqnum</a> (lsp, ntohl (entry-&gt;<a class="code" href="structlsp__entry.html#a1c2972b33699b2a8e93f42dcc2519a1a">seq_num</a>));
            <a class="code" href="isis__flags_8h.html#a1f7b5b2baa94ebc0450ccb5839a682e7">ISIS_SET_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>, circuit);
          }
        <span class="keywordflow">else</span>
          {
            <a class="code" href="isis__flags_8h.html#a1f7b5b2baa94ebc0450ccb5839a682e7">ISIS_SET_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a03d0dd350cd760986f4907c5df08363a">SSNflags</a>, circuit);
            <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> != <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
              <a class="code" href="isis__flags_8h.html#ac67a62e2e71ff606be09d8e74865aac8">ISIS_CLEAR_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>, circuit);
          }
          }
      }
    <span class="keywordflow">else</span>
      {
        <span class="comment">/* 7.3.15.2 b) 5) if it was not found, and all of those are not 0, </span>
<span class="comment">         * insert it and set SSN on it */</span>
        <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="structlsp__entry.html#ad216f5b8048448d789ea75d5958de3e1">rem_lifetime</a> &amp;&amp; entry-&gt;<a class="code" href="structlsp__entry.html#afb608ebc17ca3af33a74f25ae2f1e7d8">checksum</a> &amp;&amp; entry-&gt;<a class="code" href="structlsp__entry.html#a1c2972b33699b2a8e93f42dcc2519a1a">seq_num</a> &amp;&amp;
        <a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (entry-&gt;<a class="code" href="structlsp__entry.html#a7343aec4f3fe479341c7a46e78593115">lsp_id</a>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>))
          {
        lsp = <a class="code" href="isis__lsp_8c.html#af43ff22a21554145c239b6c37556ce1a">lsp_new</a> (entry-&gt;<a class="code" href="structlsp__entry.html#a7343aec4f3fe479341c7a46e78593115">lsp_id</a>, ntohs (entry-&gt;<a class="code" href="structlsp__entry.html#ad216f5b8048448d789ea75d5958de3e1">rem_lifetime</a>),
                   0, 0, entry-&gt;<a class="code" href="structlsp__entry.html#afb608ebc17ca3af33a74f25ae2f1e7d8">checksum</a>, level);
        <a class="code" href="isis__lsp_8c.html#a09d8f3bcc073c87f01c32b2f0994fb04">lsp_insert</a> (lsp, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1]);
        <a class="code" href="isis__flags_8h.html#a1f7b5b2baa94ebc0450ccb5839a682e7">ISIS_SET_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a03d0dd350cd760986f4907c5df08363a">SSNflags</a>, circuit);
          }
      }
      }
    }

  <span class="comment">/* 7.3.15.2 c) on CSNP set SRM for all in range which were not reported */</span>
  <span class="keywordflow">if</span> (snp_type == <a class="code" href="isis__pdu_8h.html#ab9d39eb77423805c1c9e40824167b90d">ISIS_SNP_CSNP_FLAG</a>)
    {
      <span class="comment">/*</span>
<span class="comment">       * Build a list from our own LSP db bounded with start_ and stop_lsp_id</span>
<span class="comment">       */</span>
      lsp_list = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
      <a class="code" href="isis__lsp_8c.html#a66fb0f7dfcff76c23f14eaaf816b11f9">lsp_build_list_nonzero_ht</a> (chdr-&gt;<a class="code" href="structisis__complete__seqnum__hdr.html#a0b2c464f9ef4210d2ed04dbff13b5c75">start_lsp_id</a>, chdr-&gt;<a class="code" href="structisis__complete__seqnum__hdr.html#ac714a51c6fabe095eadf5f093764ca76">stop_lsp_id</a>,
                 lsp_list, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1]);

      <span class="comment">/* Fixme: Find a better solution */</span>
      <span class="keywordflow">if</span> (<a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#a5819e536c61399ab0dea624041495a35">lsp_entries</a>)
    {
      <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (<a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#a5819e536c61399ab0dea624041495a35">lsp_entries</a>, node, nnode, entry))
      {
        <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (lsp_list, node2, nnode2, lsp))
        {
          <span class="keywordflow">if</span> (<a class="code" href="isis__lsp_8c.html#a04ba9b8f0efece8345a3f6e90be19da1">lsp_id_cmp</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>, entry-&gt;<a class="code" href="structlsp__entry.html#a7343aec4f3fe479341c7a46e78593115">lsp_id</a>) == 0)
        {
          <a class="code" href="linklist_8c.html#a44569d4d868c60e29b21409612a5df05">list_delete_node</a> (lsp_list, node2);
          <span class="keywordflow">break</span>;
        }
        }
      }
    }
      <span class="comment">/* on remaining LSPs we set SRM (neighbor knew not of) */</span>
      <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (lsp_list, node, lsp))
      {
    <a class="code" href="isis__flags_8h.html#a1f7b5b2baa94ebc0450ccb5839a682e7">ISIS_SET_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>, circuit);
      }
      <span class="comment">/* lets free it */</span>
      <a class="code" href="linklist_8c.html#a15aa9f8cf8424489adf1efd4d075aac6">list_free</a> (lsp_list);
    }

  <a class="code" href="isis__tlv_8c.html#a5f499235cf5a69697d280f5a1cd01612">free_tlvs</a> (&amp;<a class="code" href="structtlvs.html">tlvs</a>);
  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab75f3f062607df2c29d3ba4f4c2341dc"></a><!-- doxytag: member="isis_pdu.c::send_csnp" ref="ab75f3f062607df2c29d3ba4f4c2341dc" args="(struct isis_circuit *circuit, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_csnp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02186">2186</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
  u_char start[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2];
  u_char stop[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2];
  <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *<a class="code" href="structlist.html">list</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node;
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;

  memset (start, 0x00, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2);
  memset (stop, 0xff, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2);

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1] &amp;&amp;
      <a class="code" href="dict_8h.html#a392c768130a1c7ed5a6c2f299cd0d2e8">dict_count</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1]) &gt; 0)
    {
      list = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
      <a class="code" href="isis__lsp_8c.html#ac59fd5f8a4d5e146a7d36dd6525e43ae">lsp_build_list</a> (start, stop, list, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1]);

      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a> = <a class="code" href="stream_8c.html#a7117cdad9fa5e5ae633e0cf08d047459">stream_new</a> (<a class="code" href="isis__constants_8h.html#aa507eb18af6ca6d6db6e3db750ab0737">ISO_MTU</a> (circuit));
      <span class="keywordflow">else</span>
    <a class="code" href="stream_8c.html#aee8fd31485ebc2f0a556a6a5d5c2d1e6">stream_reset</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);

      retval = <a class="code" href="isis__pdu_8c.html#a713bfb71ca33fedd6b66ea5e8ab8f21c">build_csnp</a> (<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>, start, stop, list, circuit);

      <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#ab16b82eb25717295303c7099035d9dc9">DEBUG_SNP_PACKETS</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s): Sent L%d CSNP on %s, length %ld&quot;</span>,
             circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, <a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>,
             <span class="comment">/* FIXME: use %z when we stop supporting old compilers. */</span>
             (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) <a class="code" href="stream_8h.html#a6e3b6e25ed5cfa2faea8485414a0c1a4">STREAM_SIZE</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>));
      <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (list, node, lsp))
      {
        <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s):         CSNP entry %s, seq 0x%08x,&quot;</span>
            <span class="stringliteral">&quot; cksum 0x%04x, lifetime %us&quot;</span>,
            circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
            <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
            ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>),
            ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>),
            ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>));
      }
    }

      <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (list);

      <span class="keywordflow">if</span> (retval == <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>)
    retval = circuit-&gt;<a class="code" href="structisis__circuit.html#af17faf994f21d75da89129ed100cb71d">tx</a> (circuit, <a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>);
    }
  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ada46fc1940683eac5a47249f80f865b5"></a><!-- doxytag: member="isis_pdu.c::send_hello" ref="ada46fc1940683eac5a47249f80f865b5" args="(struct isis_circuit *circuit, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_hello </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l01906">1906</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__fixed__hdr.html">isis_fixed_hdr</a> fixed_hdr;
  <span class="keyword">struct </span><a class="code" href="structisis__lan__hello__hdr.html">isis_lan_hello_hdr</a> hello_hdr;
  <span class="keyword">struct </span><a class="code" href="structisis__p2p__hello__hdr.html">isis_p2p_hello_hdr</a> p2p_hello_hdr;

  u_int32_t <a class="code" href="isis__circuit_8c.html#a900b5f9651c07bafd5d81cc876b93885">interval</a>;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> len_pointer, <a class="code" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a>;
  <span class="keywordtype">int</span> retval;

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#aadd24df2d261a3bfcbdfe4797e639afb">mtu</a> == 0)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;circuit has zero MTU&quot;</span>);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }

  <span class="keywordflow">if</span> (!circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>)
    circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a> = <a class="code" href="stream_8c.html#a7117cdad9fa5e5ae633e0cf08d047459">stream_new</a> (<a class="code" href="isis__constants_8h.html#aa507eb18af6ca6d6db6e3db750ab0737">ISO_MTU</a> (circuit));
  <span class="keywordflow">else</span>
    <a class="code" href="stream_8c.html#aee8fd31485ebc2f0a556a6a5d5c2d1e6">stream_reset</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
    <span class="keywordflow">if</span> (level == 1)
      <a class="code" href="isis__pdu_8c.html#adec6ead19bda8ae8f106249935b71552">fill_fixed_hdr_andstream</a> (&amp;fixed_hdr, <a class="code" href="isis__pdu_8h.html#aaecfaf101078595ebfeed0bd1740932b">L1_LAN_HELLO</a>,
                circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
    <span class="keywordflow">else</span>
      <a class="code" href="isis__pdu_8c.html#adec6ead19bda8ae8f106249935b71552">fill_fixed_hdr_andstream</a> (&amp;fixed_hdr, <a class="code" href="isis__pdu_8h.html#af62a8d7593e2fabd396e8dce9124d09d">L2_LAN_HELLO</a>,
                circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
  <span class="keywordflow">else</span>
    <a class="code" href="isis__pdu_8c.html#adec6ead19bda8ae8f106249935b71552">fill_fixed_hdr_andstream</a> (&amp;fixed_hdr, <a class="code" href="isis__pdu_8h.html#ac01a71c9cb0d66d483f5022d9812b4db">P2P_HELLO</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);

  <span class="comment">/*</span>
<span class="comment">   * Fill LAN Level 1 or 2 Hello PDU header</span>
<span class="comment">   */</span>
  memset (&amp;hello_hdr, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structisis__lan__hello__hdr.html">isis_lan_hello_hdr</a>));
  interval = circuit-&gt;<a class="code" href="structisis__circuit.html#a9af263fd35717a7f759e4a0cf2fd1a2b">hello_multiplier</a>[level - 1] *
    circuit-&gt;<a class="code" href="structisis__circuit.html#a7edd39f2abe11ecbbd758dc1a0d3f8c0">hello_interval</a>[level - 1];
  <span class="keywordflow">if</span> (interval &gt; USHRT_MAX)
    interval = USHRT_MAX;
  hello_hdr.circuit_t = circuit-&gt;<a class="code" href="structisis__circuit.html#ab222d6d0b054faa159d72bcb9768b3fb">circuit_is_type</a>;
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (hello_hdr.source_id, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
  hello_hdr.hold_time = htons ((u_int16_t) interval);

  hello_hdr.pdu_len = 0;    <span class="comment">/* Update the PDU Length later */</span>
  len_pointer = <a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>) + 3 + <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>;

  <span class="comment">/* copy the shared part of the hello to the p2p hello if needed */</span>
  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#aa2113a49e7c75a5d4997d59df0530726">CIRCUIT_T_P2P</a>)
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;p2p_hello_hdr, &amp;hello_hdr, 5 + <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
      p2p_hello_hdr.local_id = circuit-&gt;<a class="code" href="structisis__circuit.html#a10453f6bcc1e8f1cb466240a81836ba9">circuit_id</a>;
      <span class="comment">/* FIXME: need better understanding */</span>
      <a class="code" href="stream_8c.html#a2f540a71efdf46e8c3a923f73e9f3b73">stream_put</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, &amp;p2p_hello_hdr, <a class="code" href="isis__pdu_8h.html#afc57a4bb656d257caa10f6a172006cd1">ISIS_P2PHELLO_HDRLEN</a>);
    }
  <span class="keywordflow">else</span>
    {
      hello_hdr.prio = circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a9087f16298d7bbf26ac8b480c932ab8d">priority</a>[level - 1];
      <span class="keywordflow">if</span> (level == 1 &amp;&amp; circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a015b72bf5854d99b722f9f599b9eb158">l1_desig_is</a>)
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (hello_hdr.lan_id, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a015b72bf5854d99b722f9f599b9eb158">l1_desig_is</a>,
          <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);
    }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (level == 2 &amp;&amp; circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a2bde5462284eb2b294ed998fb5907de8">l2_desig_is</a>)
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (hello_hdr.lan_id, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a2bde5462284eb2b294ed998fb5907de8">l2_desig_is</a>,
          <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);
    }
      <a class="code" href="stream_8c.html#a2f540a71efdf46e8c3a923f73e9f3b73">stream_put</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, &amp;hello_hdr, <a class="code" href="isis__pdu_8h.html#ae252f7eb62c9ee4fd050d82558623d39">ISIS_LANHELLO_HDRLEN</a>);
    }

  <span class="comment">/*</span>
<span class="comment">   * Then the variable length part </span>
<span class="comment">   */</span>
  <span class="comment">/* add circuit password */</span>
  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a601d2b4b3220757f8f7212f2a1628ab2">passwd</a>.<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>)
    <span class="keywordflow">if</span> (<a class="code" href="isis__tlv_8c.html#a02f053566530986751054dcf500af3a9">tlv_add_authinfo</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a601d2b4b3220757f8f7212f2a1628ab2">passwd</a>.<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a601d2b4b3220757f8f7212f2a1628ab2">passwd</a>.<a class="code" href="structisis__passwd.html#a3981443a6501783995b003ab8fd82f48">len</a>,
              circuit-&gt;<a class="code" href="structisis__circuit.html#a601d2b4b3220757f8f7212f2a1628ab2">passwd</a>.<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>))
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
  <span class="comment">/*  Area Addresses TLV */</span>
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>);
  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aca1436df894da89fb83d7924ef248397">area_addrs</a> &amp;&amp; circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aca1436df894da89fb83d7924ef248397">area_addrs</a>-&gt;<a class="code" href="structlist.html#ac9c4d4d7c65e726bd9ee0c8884b6349b">count</a> &gt; 0)
    <span class="keywordflow">if</span> (<a class="code" href="isis__tlv_8c.html#abd5c4be878c3cab41e46d107480f433e">tlv_add_area_addrs</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aca1436df894da89fb83d7924ef248397">area_addrs</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>))
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;

  <span class="comment">/*  LAN Neighbors TLV */</span>
  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
    {
      <span class="keywordflow">if</span> (level == 1 &amp;&amp; circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a1a8b5b8fcf6defb0b21b509d99953742">lan_neighs</a>[0]-&gt;<a class="code" href="structlist.html#ac9c4d4d7c65e726bd9ee0c8884b6349b">count</a> &gt; 0)
    <span class="keywordflow">if</span> (<a class="code" href="isis__tlv_8c.html#af413f4244b14abcd0bd1a9f01784b979">tlv_add_lan_neighs</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a1a8b5b8fcf6defb0b21b509d99953742">lan_neighs</a>[0],
                circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>))
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
      <span class="keywordflow">if</span> (level == 2 &amp;&amp; circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a1a8b5b8fcf6defb0b21b509d99953742">lan_neighs</a>[1]-&gt;<a class="code" href="structlist.html#ac9c4d4d7c65e726bd9ee0c8884b6349b">count</a> &gt; 0)
    <span class="keywordflow">if</span> (<a class="code" href="isis__tlv_8c.html#af413f4244b14abcd0bd1a9f01784b979">tlv_add_lan_neighs</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a1a8b5b8fcf6defb0b21b509d99953742">lan_neighs</a>[1],
                circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>))
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
    }

  <span class="comment">/* Protocols Supported TLV */</span>
  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#aa9672d51825e67d22c772575a9d8624a">nlpids</a>.<a class="code" href="structnlpids.html#a73f0f5f1e7aa64694d5802b91af6533b">count</a> &gt; 0)
    <span class="keywordflow">if</span> (<a class="code" href="isis__tlv_8c.html#ab4ebf52852b3eeb88bc641ce88d2657b">tlv_add_nlpid</a> (&amp;circuit-&gt;<a class="code" href="structisis__circuit.html#aa9672d51825e67d22c772575a9d8624a">nlpids</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>))
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
  <span class="comment">/* IP interface Address TLV */</span>
  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a9dbb2266ee5b76604a27fd0855e910f5">ip_router</a> &amp;&amp; circuit-&gt;<a class="code" href="structisis__circuit.html#adcde796f44a1e725abe092f95a6cb075">ip_addrs</a> &amp;&amp; circuit-&gt;<a class="code" href="structisis__circuit.html#adcde796f44a1e725abe092f95a6cb075">ip_addrs</a>-&gt;<a class="code" href="structlist.html#ac9c4d4d7c65e726bd9ee0c8884b6349b">count</a> &gt; 0)
    <span class="keywordflow">if</span> (<a class="code" href="isis__tlv_8c.html#a53f64fb8ba8bcd845f37594d4132bb89">tlv_add_ip_addrs</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#adcde796f44a1e725abe092f95a6cb075">ip_addrs</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>))
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;

<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="comment">/* IPv6 Interface Address TLV */</span>
  <span class="keywordflow">if</span> (circuit-&gt;ipv6_router &amp;&amp; circuit-&gt;ipv6_link &amp;&amp;
      circuit-&gt;ipv6_link-&gt;count &gt; 0)
    <span class="keywordflow">if</span> (tlv_add_ipv6_addrs (circuit-&gt;ipv6_link, circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>))
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a83676730231d3a5aad5d5914957a2b68">pad_hellos</a>)
    <span class="keywordflow">if</span> (<a class="code" href="isis__tlv_8c.html#a182acd86508a8e8113496b2fe82501a6">tlv_add_padding</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>))
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;

  length = <a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);
  <span class="comment">/* Update PDU length */</span>
  <a class="code" href="stream_8c.html#a41de70a7383bac6220b787d740c0b261">stream_putw_at</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, len_pointer, (u_int16_t) length);

  retval = circuit-&gt;<a class="code" href="structisis__circuit.html#af17faf994f21d75da89129ed100cb71d">tx</a> (circuit, level);
  <span class="keywordflow">if</span> (retval)
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;sending of LAN Level %d Hello failed&quot;</span>, level);

  <span class="comment">/* DEBUG_ADJ_PACKETS */</span>
  <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#a4113d6aad857cfa148450dfc6ed85b5b">DEBUG_ADJ_PACKETS</a>)
    {
      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Adj (%s): Sent L%d LAN IIH on %s, length %ld&quot;</span>,
              circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, level, circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>,
              <span class="comment">/* FIXME: use %z when we stop supporting old compilers. */</span>
              (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) <a class="code" href="stream_8h.html#a6e3b6e25ed5cfa2faea8485414a0c1a4">STREAM_SIZE</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>));
    }
      <span class="keywordflow">else</span>
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Adj (%s): Sent P2P IIH on %s, length %ld&quot;</span>,
              circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>,
              <span class="comment">/* FIXME: use %z when we stop supporting old compilers. */</span>
              (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) <a class="code" href="stream_8h.html#a6e3b6e25ed5cfa2faea8485414a0c1a4">STREAM_SIZE</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>));
    }
    }

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab5830fef07f627c56ba857e36b108bac"></a><!-- doxytag: member="isis_pdu.c::send_l1_csnp" ref="ab5830fef07f627c56ba857e36b108bac" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_l1_csnp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02238">2238</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;
  <span class="keywordtype">int</span> retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;

  circuit = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit);

  circuit-&gt;<a class="code" href="structisis__circuit.html#afb1b17f21dd3115002016a0b3d9116cb">t_send_csnp</a>[0] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a> &amp;&amp; circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#adb24376d01beb41cab0ed0c49c3a214c">is_dr</a>[0])
    {
      <a class="code" href="isis__pdu_8c.html#ab75f3f062607df2c29d3ba4f4c2341dc">send_csnp</a> (circuit, 1);
    }
  <span class="comment">/* set next timer thread */</span>
  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#afb1b17f21dd3115002016a0b3d9116cb">t_send_csnp</a>[0], <a class="code" href="isis__pdu_8c.html#ab5830fef07f627c56ba857e36b108bac">send_l1_csnp</a>, circuit,
           <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a1b3a587132c475f3b90b5f8b03ec182d">csnp_interval</a>[0], <a class="code" href="isis__constants_8h.html#a5bd43220bafd834e4710deaea471541b">CSNP_JITTER</a>));

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a001cd2fbdf45b46870187e20b3cc7efc"></a><!-- doxytag: member="isis_pdu.c::send_l1_psnp" ref="a001cd2fbdf45b46870187e20b3cc7efc" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_l1_psnp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02409">2409</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{

  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;
  <span class="keywordtype">int</span> retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;

  circuit = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit);

  circuit-&gt;<a class="code" href="structisis__circuit.html#a3ad206840c48b3ff93d5160f5a402e2e">t_send_psnp</a>[0] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <a class="code" href="isis__pdu_8c.html#ac55cfde4697927e6b91ef2296a57493c">send_psnp</a> (1, circuit);
  <span class="comment">/* set next timer thread */</span>
  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a3ad206840c48b3ff93d5160f5a402e2e">t_send_psnp</a>[0], <a class="code" href="isis__pdu_8c.html#a001cd2fbdf45b46870187e20b3cc7efc">send_l1_psnp</a>, circuit,
           <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#ab73d895f1c1588eb68e5b467f7f1b479">psnp_interval</a>[0], <a class="code" href="isis__constants_8h.html#a8ebe0205326ccb2592f752237c21729b">PSNP_JITTER</a>));

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2a1bbd2f0b090ddcd6d6e87a7c352ca3"></a><!-- doxytag: member="isis_pdu.c::send_l2_csnp" ref="a2a1bbd2f0b090ddcd6d6e87a7c352ca3" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_l2_csnp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02260">2260</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;
  <span class="keywordtype">int</span> retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;

  circuit = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit);

  circuit-&gt;<a class="code" href="structisis__circuit.html#afb1b17f21dd3115002016a0b3d9116cb">t_send_csnp</a>[1] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a> &amp;&amp; circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#adb24376d01beb41cab0ed0c49c3a214c">is_dr</a>[1])
    {
      <a class="code" href="isis__pdu_8c.html#ab75f3f062607df2c29d3ba4f4c2341dc">send_csnp</a> (circuit, 2);
    }
  <span class="comment">/* set next timer thread */</span>
  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#afb1b17f21dd3115002016a0b3d9116cb">t_send_csnp</a>[1], <a class="code" href="isis__pdu_8c.html#a2a1bbd2f0b090ddcd6d6e87a7c352ca3">send_l2_csnp</a>, circuit,
           <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a1b3a587132c475f3b90b5f8b03ec182d">csnp_interval</a>[1], <a class="code" href="isis__constants_8h.html#a5bd43220bafd834e4710deaea471541b">CSNP_JITTER</a>));

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ada5c84113d20d6c83fce25bfea104e93"></a><!-- doxytag: member="isis_pdu.c::send_l2_psnp" ref="ada5c84113d20d6c83fce25bfea104e93" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_l2_psnp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02433">2433</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;
  <span class="keywordtype">int</span> retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;

  circuit = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit);

  circuit-&gt;<a class="code" href="structisis__circuit.html#a3ad206840c48b3ff93d5160f5a402e2e">t_send_psnp</a>[1] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <a class="code" href="isis__pdu_8c.html#ac55cfde4697927e6b91ef2296a57493c">send_psnp</a> (2, circuit);

  <span class="comment">/* set next timer thread */</span>
  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a3ad206840c48b3ff93d5160f5a402e2e">t_send_psnp</a>[1], <a class="code" href="isis__pdu_8c.html#ada5c84113d20d6c83fce25bfea104e93">send_l2_psnp</a>, circuit,
           <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#ab73d895f1c1588eb68e5b467f7f1b479">psnp_interval</a>[1], <a class="code" href="isis__constants_8h.html#a8ebe0205326ccb2592f752237c21729b">PSNP_JITTER</a>));

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad38fe669ff232d9720882e210d46781d"></a><!-- doxytag: member="isis_pdu.c::send_lan_hello" ref="ad38fe669ff232d9720882e210d46781d" args="(struct isis_circuit *circuit, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int send_lan_hello </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02055">2055</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> <a class="code" href="isis__pdu_8c.html#ada46fc1940683eac5a47249f80f865b5">send_hello</a> (circuit, level);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac3719e0f27b001ab4b863944a14d2727"></a><!-- doxytag: member="isis_pdu.c::send_lan_l1_hello" ref="ac3719e0f27b001ab4b863944a14d2727" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_lan_l1_hello </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02061">2061</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;
  <span class="keywordtype">int</span> retval;

  circuit = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit);
  circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ae47a7d7fa924f3848bff4793fc250826">t_send_lan_hello</a>[0] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0766cf32585b89b427a69cd8ad1c22fb">run_dr_elect</a>[0])
    retval = <a class="code" href="isis__dr_8c.html#a35798a245595794b3cb07a6561e0499a">isis_dr_elect</a> (circuit, 1);

  retval = <a class="code" href="isis__pdu_8c.html#ad38fe669ff232d9720882e210d46781d">send_lan_hello</a> (circuit, 1);

  <span class="comment">/* set next timer thread */</span>
  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ae47a7d7fa924f3848bff4793fc250826">t_send_lan_hello</a>[0],
           <a class="code" href="isis__pdu_8c.html#ac3719e0f27b001ab4b863944a14d2727">send_lan_l1_hello</a>, circuit,
           <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a7edd39f2abe11ecbbd758dc1a0d3f8c0">hello_interval</a>[0], <a class="code" href="isis__constants_8h.html#a05b53aafec81f1ae7ca52ad0aac5255c">IIH_JITTER</a>));

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a395c19db187c485c02eb41b63fc024ac"></a><!-- doxytag: member="isis_pdu.c::send_lan_l2_hello" ref="a395c19db187c485c02eb41b63fc024ac" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_lan_l2_hello </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02084">2084</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;
  <span class="keywordtype">int</span> retval;

  circuit = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit);
  circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ae47a7d7fa924f3848bff4793fc250826">t_send_lan_hello</a>[1] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0766cf32585b89b427a69cd8ad1c22fb">run_dr_elect</a>[1])
    retval = <a class="code" href="isis__dr_8c.html#a35798a245595794b3cb07a6561e0499a">isis_dr_elect</a> (circuit, 2);

  retval = <a class="code" href="isis__pdu_8c.html#ad38fe669ff232d9720882e210d46781d">send_lan_hello</a> (circuit, 2);

  <span class="comment">/* set next timer thread */</span>
  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ae47a7d7fa924f3848bff4793fc250826">t_send_lan_hello</a>[1],
           <a class="code" href="isis__pdu_8c.html#a395c19db187c485c02eb41b63fc024ac">send_lan_l2_hello</a>, circuit,
           <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a7edd39f2abe11ecbbd758dc1a0d3f8c0">hello_interval</a>[1], <a class="code" href="isis__constants_8h.html#a05b53aafec81f1ae7ca52ad0aac5255c">IIH_JITTER</a>));

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a23b42a7925a367125e6e0fa3db33f597"></a><!-- doxytag: member="isis_pdu.c::send_lsp" ref="a23b42a7925a367125e6e0fa3db33f597" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_lsp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02456">2456</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node;
  <span class="keywordtype">int</span> retval = 0;

  circuit = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit);

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a7491f48eafb46ce87d7041bd7959633b">state</a> == <a class="code" href="isis__csm_8h.html#a65d367a002446ae64678b4586f5e2cc5">C_STATE_UP</a>)
    {
      lsp = <a class="code" href="linklist_8h.html#a574f1b7acbcea848771bd5ddc61e430a">listgetdata</a> ((node = <a class="code" href="linklist_8h.html#a3d4492ca03b023aeecd4d6b0cdaa16fb">listhead</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a3540c30e2a6967daf9f9e1b76b00e2be">lsp_queue</a>)));

      <span class="comment">/*</span>
<span class="comment">       * Do not send if levels do not match</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (!(lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> &amp; circuit-&gt;<a class="code" href="structisis__circuit.html#ab222d6d0b054faa159d72bcb9768b3fb">circuit_is_type</a>))
    <span class="keywordflow">goto</span> dontsend;

      <span class="comment">/*</span>
<span class="comment">       * Do not send if we do not have adjacencies in state up on the circuit</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#ad3b84de111be4155660a1ed94e380e2b">upadjcount</a>[lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1] == 0)
    <span class="keywordflow">goto</span> dontsend;
      <span class="comment">/* only send if it needs sending */</span>
      <span class="keywordflow">if</span> ((time (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) - lsp-&gt;<a class="code" href="structisis__lsp.html#af7c4e460bdbf8301b65213ca256581e0">last_sent</a>) &gt;=
      circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a5806de66c9aa420f4b2a5774df0959cf">lsp_gen_interval</a>[lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1])
    {

      <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#abd8d8358bf794de3d9fba9ef5de689b3">DEBUG_UPDATE_PACKETS</a>)
        {
          <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>
        (<span class="stringliteral">&quot;ISIS-Upd (%s): Sent L%d LSP %s, seq 0x%08x, cksum 0x%04x,&quot;</span>
         <span class="stringliteral">&quot; lifetime %us on %s&quot;</span>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>,
         <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
         ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>),
         ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>),
         ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>),
         circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>);
        }
      <span class="comment">/* copy our lsp to the send buffer */</span>
      <a class="code" href="stream_8c.html#a53dd7429b44228c374706fdc5e35c6ae">stream_copy</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);

      retval = circuit-&gt;<a class="code" href="structisis__circuit.html#af17faf994f21d75da89129ed100cb71d">tx</a> (circuit, lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>);

      <span class="comment">/*</span>
<span class="comment">       * If the sending succeeded, we can del the lsp from circuits</span>
<span class="comment">       * lsp_queue</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (retval == <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>)
        {
          <a class="code" href="linklist_8c.html#a44569d4d868c60e29b21409612a5df05">list_delete_node</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a3540c30e2a6967daf9f9e1b76b00e2be">lsp_queue</a>, node);

          <span class="comment">/*</span>
<span class="comment">           * On broadcast circuits also the SRMflag can be cleared</span>
<span class="comment">           */</span>
          <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
        <a class="code" href="isis__flags_8h.html#ac67a62e2e71ff606be09d8e74865aac8">ISIS_CLEAR_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>, circuit);

          <span class="keywordflow">if</span> (<a class="code" href="isis__flags_8c.html#aa104abd02ef1ceeb11c8cea01a058796">flags_any_set</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>) == 0)
        {
          <span class="comment">/*</span>
<span class="comment">           * need to remember when we were last sent</span>
<span class="comment">           */</span>
          lsp-&gt;<a class="code" href="structisis__lsp.html#af7c4e460bdbf8301b65213ca256581e0">last_sent</a> = time (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
        }
        }
      <span class="keywordflow">else</span>
        {
          <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;sending of level %d link state failed&quot;</span>, lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>);
        }
    }
      <span class="keywordflow">else</span>
    {
      <span class="comment">/* my belief is that if it wasn&#39;t his time, the lsp can be removed</span>
<span class="comment">       * from the queue</span>
<span class="comment">       */</span>
    dontsend:
      <a class="code" href="linklist_8c.html#a44569d4d868c60e29b21409612a5df05">list_delete_node</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a3540c30e2a6967daf9f9e1b76b00e2be">lsp_queue</a>, node);
    }
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>      <span class="comment">/*</span>
<span class="comment">       * If there are still LSPs send next one after lsp-interval (33 msecs)</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (<a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a3540c30e2a6967daf9f9e1b76b00e2be">lsp_queue</a>) &gt; 0)
    <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="isis__pdu_8c.html#a23b42a7925a367125e6e0fa3db33f597">send_lsp</a>, circuit, 1);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    }

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="add55c6255271cf958880489585619db9"></a><!-- doxytag: member="isis_pdu.c::send_p2p_hello" ref="add55c6255271cf958880489585619db9" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_p2p_hello </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02107">2107</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;

  circuit = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit);
  circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a15852a59ea8be80680abac2070659440">p2p</a>.<a class="code" href="structisis__p2p__info.html#adaa34f30db7fc536f5aec39d08fcbf64">t_send_p2p_hello</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <a class="code" href="isis__pdu_8c.html#ada46fc1940683eac5a47249f80f865b5">send_hello</a> (circuit, 1);

  <span class="comment">/* set next timer thread */</span>
  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a15852a59ea8be80680abac2070659440">p2p</a>.<a class="code" href="structisis__p2p__info.html#adaa34f30db7fc536f5aec39d08fcbf64">t_send_p2p_hello</a>, <a class="code" href="isis__pdu_8c.html#add55c6255271cf958880489585619db9">send_p2p_hello</a>,
           circuit, <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a7edd39f2abe11ecbbd758dc1a0d3f8c0">hello_interval</a>[1],
                     <a class="code" href="isis__constants_8h.html#a05b53aafec81f1ae7ca52ad0aac5255c">IIH_JITTER</a>));

  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac55cfde4697927e6b91ef2296a57493c"></a><!-- doxytag: member="isis_pdu.c::send_psnp" ref="ac55cfde4697927e6b91ef2296a57493c" args="(int level, struct isis_circuit *circuit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int send_psnp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l02353">2353</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;
  <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *<a class="code" href="structlist.html">list</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node;

  <span class="keywordflow">if</span> ((circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a> &amp;&amp;
       !circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#adb24376d01beb41cab0ed0c49c3a214c">is_dr</a>[level - 1]) ||
      circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> != <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>)
    {

      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1] &amp;&amp;
      <a class="code" href="dict_8h.html#a392c768130a1c7ed5a6c2f299cd0d2e8">dict_count</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1]) &gt; 0)
    {
      list = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
      <a class="code" href="isis__lsp_8c.html#ac59c6231af3791411278d2b5f3be2188">lsp_build_list_ssn</a> (circuit, list, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1]);

      <span class="keywordflow">if</span> (<a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (list) &gt; 0)
        {
          <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
        circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a> = <a class="code" href="stream_8c.html#a7117cdad9fa5e5ae633e0cf08d047459">stream_new</a> (<a class="code" href="isis__constants_8h.html#aa507eb18af6ca6d6db6e3db750ab0737">ISO_MTU</a> (circuit));
          <span class="keywordflow">else</span>
        <a class="code" href="stream_8c.html#aee8fd31485ebc2f0a556a6a5d5c2d1e6">stream_reset</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>);


          <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#ab16b82eb25717295303c7099035d9dc9">DEBUG_SNP_PACKETS</a>)
        <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s): Sent L%d PSNP on %s, length %ld&quot;</span>,
                circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, level,
                circuit-&gt;<a class="code" href="structisis__circuit.html#ab03cac6463284a4ce8c1eb19e49f3b6d">interface</a>-&gt;<a class="code" href="structinterface.html#a98cadce768ec5aacb4c5fc4ca2c3eaa8">name</a>,
                <span class="comment">/* FIXME: use %z when we stop supporting old</span>
<span class="comment">                 * compilers. */</span>
                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) <a class="code" href="stream_8h.html#a6e3b6e25ed5cfa2faea8485414a0c1a4">STREAM_SIZE</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a282678da28cc5e426019913c913ea490">snd_stream</a>));

          retval = <a class="code" href="isis__pdu_8c.html#acea9f4e378ed2d9b0e535fbd57172a42">build_psnp</a> (level, circuit, list);
          <span class="keywordflow">if</span> (retval == <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>)
        retval = circuit-&gt;<a class="code" href="structisis__circuit.html#af17faf994f21d75da89129ed100cb71d">tx</a> (circuit, level);

          <span class="keywordflow">if</span> (retval == <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>)
        {
          <span class="comment">/*</span>
<span class="comment">           * sending succeeded, we can clear SSN flags of this circuit</span>
<span class="comment">           * for the LSPs in list</span>
<span class="comment">           */</span>
          <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (list, node, lsp))
                    <a class="code" href="isis__flags_8h.html#ac67a62e2e71ff606be09d8e74865aac8">ISIS_CLEAR_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a03d0dd350cd760986f4907c5df08363a">SSNflags</a>, circuit);
        }
        }
      <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (list);
    }
    }

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af96726be5388512e070368d2438bbf99"></a><!-- doxytag: member="isis_pdu.c::tlvs_to_adj_ipv4_addrs" ref="af96726be5388512e070368d2438bbf99" args="(struct tlvs *tlvs, struct isis_adjacency *adj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void tlvs_to_adj_ipv4_addrs </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtlvs.html">tlvs</a> *&#160;</td>
          <td class="paramname"><em>tlvs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__adjacency.html">isis_adjacency</a> *&#160;</td>
          <td class="paramname"><em>adj</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00223">223</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node;
  <span class="keyword">struct </span>in_addr *ipv4_addr, *malloced;

  <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#ad4c07af99270cae2fdc9f48120cbebcb">ipv4_addrs</a>)
    {
      adj-&gt;<a class="code" href="structisis__adjacency.html#ad4c07af99270cae2fdc9f48120cbebcb">ipv4_addrs</a>-&gt;<a class="code" href="structlist.html#ac4fd9a331fe65f4c0891aa35bf84a6f5">del</a> = <a class="code" href="isis__pdu_8c.html#a1eb77861c826ae12837e4245dee655ae">del_ip_addr</a>;
      <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (adj-&gt;<a class="code" href="structisis__adjacency.html#ad4c07af99270cae2fdc9f48120cbebcb">ipv4_addrs</a>);
    }
  adj-&gt;<a class="code" href="structisis__adjacency.html#ad4c07af99270cae2fdc9f48120cbebcb">ipv4_addrs</a> = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
  <span class="keywordflow">if</span> (tlvs-&gt;<a class="code" href="structtlvs.html#ae9ef317829a76d7a79d2789786a2ac1f">ipv4_addrs</a>)
    {
      <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (tlvs-&gt;<a class="code" href="structtlvs.html#ae9ef317829a76d7a79d2789786a2ac1f">ipv4_addrs</a>, node, ipv4_addr))
      {
    malloced = <a class="code" href="memory_8h.html#a6491adf46c1d769b529a8f2f7d75f2fe">XMALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba80b5687b76c7243b1ec8be38fb740b3f">MTYPE_ISIS_TMP</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> in_addr));
    <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (malloced, ipv4_addr, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> in_addr));
    <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (adj-&gt;<a class="code" href="structisis__adjacency.html#ad4c07af99270cae2fdc9f48120cbebcb">ipv4_addrs</a>, malloced);
      }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="afb3df247f88b4af648f1abf59f8a6044"></a><!-- doxytag: member="isis_pdu.c::tlvs_to_adj_nlpids" ref="afb3df247f88b4af648f1abf59f8a6044" args="(struct tlvs *tlvs, struct isis_adjacency *adj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void tlvs_to_adj_nlpids </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtlvs.html">tlvs</a> *&#160;</td>
          <td class="paramname"><em>tlvs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__adjacency.html">isis_adjacency</a> *&#160;</td>
          <td class="paramname"><em>adj</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00197">197</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
  <span class="keyword">struct </span><a class="code" href="structnlpids.html">nlpids</a> *tlv_nlpids;

  <span class="keywordflow">if</span> (tlvs-&gt;<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>)
    {

      tlv_nlpids = tlvs-&gt;<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>;

      adj-&gt;<a class="code" href="structisis__adjacency.html#a1c8f17ff6b70d8c457e8d2860909312c">nlpids</a>.<a class="code" href="structnlpids.html#a73f0f5f1e7aa64694d5802b91af6533b">count</a> = tlv_nlpids-&gt;<a class="code" href="structnlpids.html#a73f0f5f1e7aa64694d5802b91af6533b">count</a>;

      <span class="keywordflow">for</span> (i = 0; i &lt; tlv_nlpids-&gt;<a class="code" href="structnlpids.html#a73f0f5f1e7aa64694d5802b91af6533b">count</a>; i++)
    {
      adj-&gt;<a class="code" href="structisis__adjacency.html#a1c8f17ff6b70d8c457e8d2860909312c">nlpids</a>.<a class="code" href="structnlpids.html#a6dbd263750da21187880986a50fd5857">nlpids</a>[<a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>] = tlv_nlpids-&gt;<a class="code" href="structnlpids.html#a6dbd263750da21187880986a50fd5857">nlpids</a>[<a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>];
    }
    }
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="aa8cfdc8f7777fd242bd2c45f3a48b950"></a><!-- doxytag: member="isis_pdu.c::isis" ref="aa8cfdc8f7777fd242bd2c45f3a48b950" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structisis.html">isis</a>* <a class="el" href="structisis.html">isis</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isisd_8c_source.html#l00061">61</a> of file <a class="el" href="isisd_8c_source.html">isisd.c</a>.</p>

</div>
</div>
<a class="anchor" id="a675cc05c7391c1cd5e88ed25175ad5e1"></a><!-- doxytag: member="isis_pdu.c::maskbit" ref="a675cc05c7391c1cd5e88ed25175ad5e1" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const u_char <a class="el" href="table_8c.html#a675cc05c7391c1cd5e88ed25175ad5e1">maskbit</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
  0x00, 0x80, 0xc0, 0xe0, 0xf0, 0xf8, 0xfc, 0xfe, 0xff
}
</pre></div>
<p>Definition at line <a class="el" href="isis__pdu_8c_source.html#l00067">67</a> of file <a class="el" href="isis__pdu_8c_source.html">isis_pdu.c</a>.</p>

</div>
</div>
<a class="anchor" id="af7f9077bc08df049beb65a1c09cde5fa"></a><!-- doxytag: member="isis_pdu.c::master" ref="af7f9077bc08df049beb65a1c09cde5fa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structthread__master.html">thread_master</a>* <a class="el" href="test__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__main_8c_source.html#l00105">105</a> of file <a class="el" href="bgp__main_8c_source.html">bgp_main.c</a>.</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="isis__pdu_8c.html">isis_pdu.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:20 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
