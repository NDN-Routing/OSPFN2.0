<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: bgpd/bgp_damp.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('bgp__damp_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">bgpd/bgp_damp.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="zebra_8h_source.html">zebra.h</a>&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="prefix_8h_source.html">prefix.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="memory_8h_source.html">memory.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="command_8h_source.html">command.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="thread_8h_source.html">thread.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgpd_8h_source.html">bgpd/bgpd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__damp_8h_source.html">bgpd/bgp_damp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__table_8h_source.html">bgpd/bgp_table.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__route_8h_source.html">bgpd/bgp_route.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__attr_8h_source.html">bgpd/bgp_attr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__advertise_8h_source.html">bgpd/bgp_advertise.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for bgp_damp.c:</div>
<div class="dyncontent">
<div class="center"><img src="bgp__damp_8c__incl.png" border="0" usemap="#bgpd_2bgp__damp_8c" alt=""/></div>
<map name="bgpd_2bgp__damp_8c" id="bgpd_2bgp__damp_8c">
<area shape="rect" id="node3" href="zebra_8h.html" title="zebra.h" alt="" coords="1446,80,1513,107"/><area shape="rect" id="node63" href="prefix_8h.html" title="prefix.h" alt="" coords="2941,80,3009,107"/><area shape="rect" id="node67" href="memory_8h.html" title="memory.h" alt="" coords="3034,80,3117,107"/><area shape="rect" id="node71" href="command_8h.html" title="command.h" alt="" coords="3141,80,3233,107"/><area shape="rect" id="node77" href="thread_8h.html" title="thread.h" alt="" coords="3265,229,3337,256"/><area shape="rect" id="node79" href="log_8h.html" title="log.h" alt="" coords="2753,229,2805,256"/><area shape="rect" id="node86" href="bgpd_8h.html" title="bgpd/bgpd.h" alt="" coords="2817,80,2917,107"/><area shape="rect" id="node89" href="bgp__damp_8h.html" title="bgpd/bgp_damp.h" alt="" coords="3309,80,3442,107"/><area shape="rect" id="node91" href="bgp__table_8h.html" title="bgpd/bgp_table.h" alt="" coords="3517,155,3647,181"/><area shape="rect" id="node93" href="bgp__route_8h.html" title="bgpd/bgp_route.h" alt="" coords="3466,80,3597,107"/><area shape="rect" id="node96" href="bgp__attr_8h.html" title="bgpd/bgp_attr.h" alt="" coords="3671,80,3791,107"/><area shape="rect" id="node98" href="bgp__advertise_8h.html" title="bgpd/bgp_advertise.h" alt="" coords="3816,80,3971,107"/><area shape="rect" id="node57" href="zassert_8h.html" title="zassert.h" alt="" coords="1869,155,1946,181"/><area shape="rect" id="node59" href="str_8h.html" title="str.h" alt="" coords="1971,155,2019,181"/><area shape="rect" id="node65" href="sockunion_8h.html" title="sockunion.h" alt="" coords="2817,155,2910,181"/><area shape="rect" id="node69" href="memtypes_8h.html" title="lib/memtypes.h" alt="" coords="2934,155,3049,181"/><area shape="rect" id="node73" href="vector_8h.html" title="vector.h" alt="" coords="3073,155,3145,181"/><area shape="rect" id="node75" href="vty_8h.html" title="vty.h" alt="" coords="3169,155,3221,181"/><area shape="rect" id="node82" href="route__types_8h.html" title="lib/route_types.h" alt="" coords="3245,155,3369,181"/></map>
</div>
</div>
<p><a href="bgp__damp_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a9adb7c9da2bfb12c80b3c0602bdda527">BGP_DAMP_LIST_ADD</a>(N, A)&#160;&#160;&#160;BGP_INFO_ADD(N,A,no_reuse_list)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#af9283a47419c1af6dab5a1f220f3fa69">BGP_DAMP_LIST_DEL</a>(N, A)&#160;&#160;&#160;BGP_INFO_DEL(N,A,no_reuse_list)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a8950077f458e540a8b4292539e0120cf">ONE_DAY_SECOND</a>&#160;&#160;&#160;60*60*24</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a762bcaaf64d0f21361ca5c0262b49f33">ONE_WEEK_SECOND</a>&#160;&#160;&#160;60*60*24*7</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a893f4a6a09973768072cdc67c71b5438">bgp_reuse_index</a> (int penalty)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a65aabd892cd32d8abc34163aa4c61582">bgp_reuse_list_add</a> (struct <a class="el" href="structbgp__damp__info.html">bgp_damp_info</a> *bdi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a38fa0292f82b418960810ceb8c2d2309">bgp_reuse_list_delete</a> (struct <a class="el" href="structbgp__damp__info.html">bgp_damp_info</a> *bdi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a04742fc672b86175444b4b94161c9a81">bgp_damp_decay</a> (time_t tdiff, int penalty)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a1eb38f534f8bbb214584a2dbacb649a0">bgp_reuse_timer</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="test-sig_8c.html#ab4ed0bba3292270af8ad67b45a21280d">t</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a6495e2d88335e918ccca6f80fa52cee9">bgp_damp_withdraw</a> (struct <a class="el" href="structbgp__info.html">bgp_info</a> *binfo, struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, int attr_change)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#ab12b23e18629cfff0fcc114ca69829d5">bgp_damp_update</a> (struct <a class="el" href="structbgp__info.html">bgp_info</a> *binfo, struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a1cdac465054860376051b602d242b392">bgp_damp_scan</a> (struct <a class="el" href="structbgp__info.html">bgp_info</a> *binfo, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a0c4f46bfbd9a397b8ba5d830d48cc5ca">bgp_damp_info_free</a> (struct <a class="el" href="structbgp__damp__info.html">bgp_damp_info</a> *bdi, int withdraw)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#ada34675b0114f7719991dae8fb21defe">bgp_damp_parameter_set</a> (int hlife, int reuse, int sup, int maxsup)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a1c4a2f4e76f8ebba440c7a7db87bf2d2">bgp_damp_enable</a> (struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, time_t half, unsigned int reuse, unsigned int suppress, time_t max)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#ae83c7c3e15db5d6fb697f7321c1c6f4b">bgp_damp_config_clean</a> (struct <a class="el" href="structbgp__damp__config.html">bgp_damp_config</a> *<a class="el" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a87eff85caf5992e70da951242cccc565">bgp_damp_info_clean</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a12aae1fce37ad880818236997eb67e51">bgp_damp_disable</a> (struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a2d5528f427dd64bddefa520e998f085e">bgp_config_write_damp</a> (struct <a class="el" href="structvty.html">vty</a> *<a class="el" href="structvty.html">vty</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a09df51c0fccbc11c1818a00e06be28da">bgp_get_reuse_time</a> (unsigned int penalty, char *buf, size_t len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a3d56794255e856c30ce24f0adc808221">bgp_damp_info_vty</a> (struct <a class="el" href="structvty.html">vty</a> *<a class="el" href="structvty.html">vty</a>, struct <a class="el" href="structbgp__info.html">bgp_info</a> *binfo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a4dab8cc4c114da6cbe9ff4258a958103">bgp_damp_reuse_time_vty</a> (struct <a class="el" href="structvty.html">vty</a> *<a class="el" href="structvty.html">vty</a>, struct <a class="el" href="structbgp__info.html">bgp_info</a> *binfo, char *timebuf, size_t len)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structbgp__damp__config.html">bgp_damp_config</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structbgp__damp__config.html">bgp_damp_config</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a> = &amp;<a class="el" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a9adb7c9da2bfb12c80b3c0602bdda527"></a><!-- doxytag: member="bgp_damp.c::BGP_DAMP_LIST_ADD" ref="a9adb7c9da2bfb12c80b3c0602bdda527" args="(N, A)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BGP_DAMP_LIST_ADD</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">N, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">A&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;BGP_INFO_ADD(N,A,no_reuse_list)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00043">43</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>

</div>
</div>
<a class="anchor" id="af9283a47419c1af6dab5a1f220f3fa69"></a><!-- doxytag: member="bgp_damp.c::BGP_DAMP_LIST_DEL" ref="af9283a47419c1af6dab5a1f220f3fa69" args="(N, A)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BGP_DAMP_LIST_DEL</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">N, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">A&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;BGP_INFO_DEL(N,A,no_reuse_list)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00044">44</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8950077f458e540a8b4292539e0120cf"></a><!-- doxytag: member="bgp_damp.c::ONE_DAY_SECOND" ref="a8950077f458e540a8b4292539e0120cf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ONE_DAY_SECOND&#160;&#160;&#160;60*60*24</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a762bcaaf64d0f21361ca5c0262b49f33"></a><!-- doxytag: member="bgp_damp.c::ONE_WEEK_SECOND" ref="a762bcaaf64d0f21361ca5c0262b49f33" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ONE_WEEK_SECOND&#160;&#160;&#160;60*60*24*7</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a2d5528f427dd64bddefa520e998f085e"></a><!-- doxytag: member="bgp_damp.c::bgp_config_write_damp" ref="a2d5528f427dd64bddefa520e998f085e" args="(struct vty *vty)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_config_write_damp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvty.html">vty</a> *&#160;</td>
          <td class="paramname"><em>vty</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00521">521</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (<a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#a7055c68200a901c92d87d6aa79acece7">half_life</a> == <a class="code" href="bgp__damp_8h.html#a099e218170293741c73cc9dbfff822f8">DEFAULT_HALF_LIFE</a>*60
      &amp;&amp; <a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a> == <a class="code" href="bgp__damp_8h.html#a3bf1dcbb80b956851a56ad50639e2acd">DEFAULT_REUSE</a>
      &amp;&amp; <a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#a61e0e7bdc6964b808d6796fe1019edbd">suppress_value</a> == <a class="code" href="bgp__damp_8h.html#a94af1812833b72e6cc01e6d2c253fdd7">DEFAULT_SUPPRESS</a>
      &amp;&amp; <a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#a94f99fef7621bac5fab20490f889dca4">max_suppress_time</a> == <a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#a7055c68200a901c92d87d6aa79acece7">half_life</a>*4)
    <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot; bgp dampening%s&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#a7055c68200a901c92d87d6aa79acece7">half_life</a> != <a class="code" href="bgp__damp_8h.html#a099e218170293741c73cc9dbfff822f8">DEFAULT_HALF_LIFE</a>*60
       &amp;&amp; <a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a> == <a class="code" href="bgp__damp_8h.html#a3bf1dcbb80b956851a56ad50639e2acd">DEFAULT_REUSE</a>
       &amp;&amp; <a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#a61e0e7bdc6964b808d6796fe1019edbd">suppress_value</a> == <a class="code" href="bgp__damp_8h.html#a94af1812833b72e6cc01e6d2c253fdd7">DEFAULT_SUPPRESS</a>
       &amp;&amp; <a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#a94f99fef7621bac5fab20490f889dca4">max_suppress_time</a> == <a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#a7055c68200a901c92d87d6aa79acece7">half_life</a>*4)
    <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot; bgp dampening %ld%s&quot;</span>,
         <a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#a7055c68200a901c92d87d6aa79acece7">half_life</a>/60,
         <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
  <span class="keywordflow">else</span>
    <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot; bgp dampening %ld %d %d %ld%s&quot;</span>,
         <a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#a7055c68200a901c92d87d6aa79acece7">half_life</a>/60,
         <a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a>,
         <a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#a61e0e7bdc6964b808d6796fe1019edbd">suppress_value</a>,
         <a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>.<a class="code" href="structbgp__damp__config.html#a94f99fef7621bac5fab20490f889dca4">max_suppress_time</a>/60,
         <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae83c7c3e15db5d6fb697f7321c1c6f4b"></a><!-- doxytag: member="bgp_damp.c::bgp_damp_config_clean" ref="ae83c7c3e15db5d6fb697f7321c1c6f4b" args="(struct bgp_damp_config *damp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_damp_config_clean </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__damp__config.html">bgp_damp_config</a> *&#160;</td>
          <td class="paramname"><em>damp</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00460">460</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">/* Free decay array */</span>
  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba3ba40968b9b6a7aff633aea95f2341f8">MTYPE_BGP_DAMP_ARRAY</a>, damp-&gt;<a class="code" href="structbgp__damp__config.html#ad35b88c80cde9e6c1b6dd5f73d79c599">decay_array</a>);

  <span class="comment">/* Free reuse index array */</span>
  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba3ba40968b9b6a7aff633aea95f2341f8">MTYPE_BGP_DAMP_ARRAY</a>, damp-&gt;<a class="code" href="structbgp__damp__config.html#a4f84b3db83411ea2f69351e487f19b42">reuse_index</a>);

  <span class="comment">/* Free reuse list array. */</span>
  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba3ba40968b9b6a7aff633aea95f2341f8">MTYPE_BGP_DAMP_ARRAY</a>, damp-&gt;<a class="code" href="structbgp__damp__config.html#a31e11b75924cfb22e0a563e532849fd4">reuse_list</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a04742fc672b86175444b4b94161c9a81"></a><!-- doxytag: member="bgp_damp.c::bgp_damp_decay" ref="a04742fc672b86175444b4b94161c9a81" args="(time_t tdiff, int penalty)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_damp_decay </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>tdiff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>penalty</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00092">92</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;

  i = (int) ((<span class="keywordtype">double</span>) tdiff / <a class="code" href="bgp__damp_8h.html#a5400b1f2028d38732e4377be4f32b255">DELTA_T</a>);

  <span class="keywordflow">if</span> (i == 0)
    <span class="keywordflow">return</span> penalty; 
  
  <span class="keywordflow">if</span> (i &gt;= <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a8a14f82a5f992a698f6be233a21afce9">decay_array_size</a>)
    <span class="keywordflow">return</span> 0;

  <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) (penalty * <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad35b88c80cde9e6c1b6dd5f73d79c599">decay_array</a>[<a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>]);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a12aae1fce37ad880818236997eb67e51"></a><!-- doxytag: member="bgp_damp.c::bgp_damp_disable" ref="a12aae1fce37ad880818236997eb67e51" args="(struct bgp *bgp, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_damp_disable </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00503">503</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">/* Cancel reuse thread. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a917075d1961998bb01d7cb2043a4aa80">t_reuse</a> )
    <a class="code" href="thread_8c.html#aceb89c1157b6a1d8bb3afa5021f1ab6d">thread_cancel</a> (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a917075d1961998bb01d7cb2043a4aa80">t_reuse</a>);
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a917075d1961998bb01d7cb2043a4aa80">t_reuse</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="comment">/* Clean BGP dampening information.  */</span>
  <a class="code" href="bgp__damp_8c.html#a87eff85caf5992e70da951242cccc565">bgp_damp_info_clean</a> ();

  <span class="comment">/* Clear configuration */</span>
  <a class="code" href="bgp__damp_8c.html#ae83c7c3e15db5d6fb697f7321c1c6f4b">bgp_damp_config_clean</a> (&amp;<a class="code" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a>);

  <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (bgp-&gt;<a class="code" href="structbgp.html#a30da262ef5f391dae5c93ed04cf243c4">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a1f74f91741ac0799c3348ce5f9e82992">BGP_CONFIG_DAMPENING</a>);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1c4a2f4e76f8ebba440c7a7db87bf2d2"></a><!-- doxytag: member="bgp_damp.c::bgp_damp_enable" ref="a1c4a2f4e76f8ebba440c7a7db87bf2d2" args="(struct bgp *bgp, afi_t afi, safi_t safi, time_t half, unsigned int reuse, unsigned int suppress, time_t max)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_damp_enable </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>half</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>reuse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>suppress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>max</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00435">435</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (bgp-&gt;<a class="code" href="structbgp.html#a30da262ef5f391dae5c93ed04cf243c4">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a1f74f91741ac0799c3348ce5f9e82992">BGP_CONFIG_DAMPENING</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a7055c68200a901c92d87d6aa79acece7">half_life</a> == half
      &amp;&amp; <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a> == reuse
      &amp;&amp; <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a61e0e7bdc6964b808d6796fe1019edbd">suppress_value</a> == suppress
      &amp;&amp; <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a94f99fef7621bac5fab20490f889dca4">max_suppress_time</a> == max)
    <span class="keywordflow">return</span> 0;
      <a class="code" href="bgp__damp_8c.html#a12aae1fce37ad880818236997eb67e51">bgp_damp_disable</a> (bgp, afi, safi);
    }

  <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (bgp-&gt;<a class="code" href="structbgp.html#a30da262ef5f391dae5c93ed04cf243c4">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a1f74f91741ac0799c3348ce5f9e82992">BGP_CONFIG_DAMPENING</a>);
  <a class="code" href="bgp__damp_8c.html#ada34675b0114f7719991dae8fb21defe">bgp_damp_parameter_set</a> (half, reuse, suppress, max);

  <span class="comment">/* Register reuse timer.  */</span>
  <span class="keywordflow">if</span> (! <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a917075d1961998bb01d7cb2043a4aa80">t_reuse</a>)
    <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a917075d1961998bb01d7cb2043a4aa80">t_reuse</a> = 
      <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="bgp__damp_8c.html#a1eb38f534f8bbb214584a2dbacb649a0">bgp_reuse_timer</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="bgp__damp_8h.html#a0ab730b90f217aaee332a4c77360dfca">DELTA_REUSE</a>);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a87eff85caf5992e70da951242cccc565"></a><!-- doxytag: member="bgp_damp.c::bgp_damp_info_clean" ref="a87eff85caf5992e70da951242cccc565" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_damp_info_clean </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00474">474</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__damp__info.html">bgp_damp_info</a> *bdi, *<a class="code" href="structbgp__damp__info.html#aaab72d4a62904dfd1c1c317936d7ffea">next</a>;

  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a9043492faf6e46560ab22c0e408d2b86">reuse_offset</a> = 0;

  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad82b645f7ca7c7debdb3c54943d86771">reuse_list_size</a>; i++)
    {
      <span class="keywordflow">if</span> (! <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a31e11b75924cfb22e0a563e532849fd4">reuse_list</a>[i])
    <span class="keywordflow">continue</span>;

      <span class="keywordflow">for</span> (bdi = <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a31e11b75924cfb22e0a563e532849fd4">reuse_list</a>[i]; bdi; bdi = next)
    {
      next = bdi-&gt;<a class="code" href="structbgp__damp__info.html#aaab72d4a62904dfd1c1c317936d7ffea">next</a>;
      <a class="code" href="bgp__damp_8c.html#a0c4f46bfbd9a397b8ba5d830d48cc5ca">bgp_damp_info_free</a> (bdi, 1);
    }
      <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a31e11b75924cfb22e0a563e532849fd4">reuse_list</a>[<a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }

  <span class="keywordflow">for</span> (bdi = <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aaa7d72e2afdf80f29bd4c71fdeb100bd">no_reuse_list</a>; bdi; bdi = next)
    {
      next = bdi-&gt;<a class="code" href="structbgp__damp__info.html#aaab72d4a62904dfd1c1c317936d7ffea">next</a>;
      <a class="code" href="bgp__damp_8c.html#a0c4f46bfbd9a397b8ba5d830d48cc5ca">bgp_damp_info_free</a> (bdi, 1);
    }
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aaa7d72e2afdf80f29bd4c71fdeb100bd">no_reuse_list</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0c4f46bfbd9a397b8ba5d830d48cc5ca"></a><!-- doxytag: member="bgp_damp.c::bgp_damp_info_free" ref="a0c4f46bfbd9a397b8ba5d830d48cc5ca" args="(struct bgp_damp_info *bdi, int withdraw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_damp_info_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__damp__info.html">bgp_damp_info</a> *&#160;</td>
          <td class="paramname"><em>bdi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>withdraw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00350">350</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *binfo;

  <span class="keywordflow">if</span> (! bdi)
    <span class="keywordflow">return</span>;

  binfo = bdi-&gt;<a class="code" href="structbgp__damp__info.html#af37fca6e0e158d27ae0558caedbb6379">binfo</a>;
  binfo-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#a7ff3f44362518bf22b13989ec6924986">damp_info</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (binfo-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a8ef9b384054b6b52e7d0af4021a3cc05">BGP_INFO_DAMPED</a>))
    <a class="code" href="bgp__damp_8c.html#a38fa0292f82b418960810ceb8c2d2309">bgp_reuse_list_delete</a> (bdi);
  <span class="keywordflow">else</span>
    <a class="code" href="bgp__damp_8c.html#af9283a47419c1af6dab5a1f220f3fa69">BGP_DAMP_LIST_DEL</a> (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>, bdi);

  <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a506a36cf4f20e2069a1623933c18d6fb">rn</a>, binfo, <a class="code" href="bgp__route_8h.html#a57adf9fc517cc65fb9f4bcbf8ff796f2">BGP_INFO_HISTORY</a>|<a class="code" href="bgp__route_8h.html#a8ef9b384054b6b52e7d0af4021a3cc05">BGP_INFO_DAMPED</a>);

  <span class="keywordflow">if</span> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#acdc7e308a11230cd73c90b0dcf7a3cdf">lastrecord</a> == <a class="code" href="bgp__damp_8h.html#aeb2d15f73eff91038418b5c8596a8308">BGP_RECORD_WITHDRAW</a> &amp;&amp; withdraw)
    <a class="code" href="bgp__route_8c.html#abfe260239e1b72a286e9c45a5aa1afbd">bgp_info_delete</a> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a506a36cf4f20e2069a1623933c18d6fb">rn</a>, binfo);
  
  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba0469230ad2a9a5121c508a98d7d279c2">MTYPE_BGP_DAMP_INFO</a>, bdi);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3d56794255e856c30ce24f0adc808221"></a><!-- doxytag: member="bgp_damp.c::bgp_damp_info_vty" ref="a3d56794255e856c30ce24f0adc808221" args="(struct vty *vty, struct bgp_info *binfo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_damp_info_vty </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvty.html">vty</a> *&#160;</td>
          <td class="paramname"><em>vty</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>binfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00581">581</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__damp__info.html">bgp_damp_info</a> *bdi;
  time_t t_now, t_diff;
  <span class="keywordtype">char</span> timebuf[<a class="code" href="bgpd_8h.html#a4c420c0c5e00f67ebf9850015b7efd27">BGP_UPTIME_LEN</a>];
  <span class="keywordtype">int</span> <a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a>;

  <span class="keywordflow">if</span> (!binfo-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>)
    <span class="keywordflow">return</span>;
  
  <span class="comment">/* BGP dampening information.  */</span>
  bdi = binfo-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#a7ff3f44362518bf22b13989ec6924986">damp_info</a>;

  <span class="comment">/* If dampening is not enabled or there is no dampening information,</span>
<span class="comment">     return immediately.  */</span>
  <span class="keywordflow">if</span> (! <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a> || ! bdi)
    <span class="keywordflow">return</span>;

  <span class="comment">/* Calculate new penalty.  */</span>
  t_now = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();
  t_diff = t_now - bdi-&gt;<a class="code" href="structbgp__damp__info.html#a3d0c950f70317aedfd15a0b28feceae1">t_updated</a>;
  penalty = <a class="code" href="bgp__damp_8c.html#a04742fc672b86175444b4b94161c9a81">bgp_damp_decay</a> (t_diff, bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a>);

  <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;      Dampinfo: penalty %d, flapped %d times in %s&quot;</span>,
           penalty, bdi-&gt;<a class="code" href="structbgp__damp__info.html#ab12ae05f133ded91a152d8b42c33336a">flap</a>,
       <a class="code" href="bgpd_8c.html#acf827381bb67155dd3f9ec490bc453ff">peer_uptime</a> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a79b767b81bcc0f2015c6da5651dfa149">start_time</a>, timebuf, <a class="code" href="bgpd_8h.html#a4c420c0c5e00f67ebf9850015b7efd27">BGP_UPTIME_LEN</a>));

  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (binfo-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a8ef9b384054b6b52e7d0af4021a3cc05">BGP_INFO_DAMPED</a>)
      &amp;&amp; ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (binfo-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a57adf9fc517cc65fb9f4bcbf8ff796f2">BGP_INFO_HISTORY</a>))
    <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;, reuse in %s&quot;</span>,
         <a class="code" href="bgp__damp_8c.html#a09df51c0fccbc11c1818a00e06be28da">bgp_get_reuse_time</a> (penalty, timebuf, <a class="code" href="bgpd_8h.html#a4c420c0c5e00f67ebf9850015b7efd27">BGP_UPTIME_LEN</a>));

  <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ada34675b0114f7719991dae8fb21defe"></a><!-- doxytag: member="bgp_damp.c::bgp_damp_parameter_set" ref="ada34675b0114f7719991dae8fb21defe" args="(int hlife, int reuse, int sup, int maxsup)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_damp_parameter_set </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>hlife</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>reuse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxsup</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00374">374</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> reuse_max_ratio;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
  <span class="keywordtype">double</span> <a class="code" href="spgrid_8c.html#a7113d77fc628f14d4e7d1262969c613e">j</a>;
    
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a61e0e7bdc6964b808d6796fe1019edbd">suppress_value</a> = sup;
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a7055c68200a901c92d87d6aa79acece7">half_life</a> = hlife;
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a> = reuse;
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a94f99fef7621bac5fab20490f889dca4">max_suppress_time</a> = maxsup;

  <span class="comment">/* Initialize params per bgp_damp_config. */</span>
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad01f01c54dc229b545b912d7a14ded83">reuse_index_size</a> = <a class="code" href="bgp__damp_8h.html#a8b34f88efd4ed74a463e46260f850e8e">REUSE_ARRAY_SIZE</a>;

  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a46ab465397181f1fc58383f268e30885">ceiling</a> = (int)(<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a> * (pow(2, (<span class="keywordtype">double</span>)<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a94f99fef7621bac5fab20490f889dca4">max_suppress_time</a>/<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a7055c68200a901c92d87d6aa79acece7">half_life</a>))); 

  <span class="comment">/* Decay-array computations */</span>
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a8a14f82a5f992a698f6be233a21afce9">decay_array_size</a> = ceil ((<span class="keywordtype">double</span>) <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a94f99fef7621bac5fab20490f889dca4">max_suppress_time</a> / <a class="code" href="bgp__damp_8h.html#a5400b1f2028d38732e4377be4f32b255">DELTA_T</a>);
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad35b88c80cde9e6c1b6dd5f73d79c599">decay_array</a> = <a class="code" href="memory_8h.html#a6491adf46c1d769b529a8f2f7d75f2fe">XMALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba3ba40968b9b6a7aff633aea95f2341f8">MTYPE_BGP_DAMP_ARRAY</a>,
                   <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a8a14f82a5f992a698f6be233a21afce9">decay_array_size</a>));
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad35b88c80cde9e6c1b6dd5f73d79c599">decay_array</a>[0] = 1.0;
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad35b88c80cde9e6c1b6dd5f73d79c599">decay_array</a>[1] = exp ((1.0/((<span class="keywordtype">double</span>)<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a7055c68200a901c92d87d6aa79acece7">half_life</a>/<a class="code" href="bgp__damp_8h.html#a5400b1f2028d38732e4377be4f32b255">DELTA_T</a>)) * log(0.5));

  <span class="comment">/* Calculate decay values for all possible times */</span>
  <span class="keywordflow">for</span> (i = 2; i &lt; <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a8a14f82a5f992a698f6be233a21afce9">decay_array_size</a>; i++)
    <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad35b88c80cde9e6c1b6dd5f73d79c599">decay_array</a>[i] = <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad35b88c80cde9e6c1b6dd5f73d79c599">decay_array</a>[i-1] * <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad35b88c80cde9e6c1b6dd5f73d79c599">decay_array</a>[1];
    
  <span class="comment">/* Reuse-list computations */</span>
  i = ceil ((<span class="keywordtype">double</span>)<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a94f99fef7621bac5fab20490f889dca4">max_suppress_time</a> / <a class="code" href="bgp__damp_8h.html#a0ab730b90f217aaee332a4c77360dfca">DELTA_REUSE</a>) + 1;
  <span class="keywordflow">if</span> (i &gt; <a class="code" href="bgp__damp_8h.html#a9d1055d6abdc192383615cb45d163fba">REUSE_LIST_SIZE</a> || i == 0)
    i = <a class="code" href="bgp__damp_8h.html#a9d1055d6abdc192383615cb45d163fba">REUSE_LIST_SIZE</a>;
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad82b645f7ca7c7debdb3c54943d86771">reuse_list_size</a> = <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>; 

  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a31e11b75924cfb22e0a563e532849fd4">reuse_list</a> = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba3ba40968b9b6a7aff633aea95f2341f8">MTYPE_BGP_DAMP_ARRAY</a>, 
                  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad82b645f7ca7c7debdb3c54943d86771">reuse_list_size</a> 
                  * sizeof (<span class="keyword">struct</span> bgp_reuse_node *));
  memset (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a31e11b75924cfb22e0a563e532849fd4">reuse_list</a>, 0x00, 
          <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad82b645f7ca7c7debdb3c54943d86771">reuse_list_size</a> * sizeof (<span class="keyword">struct</span> bgp_reuse_node *));  

  <span class="comment">/* Reuse-array computations */</span>
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a4f84b3db83411ea2f69351e487f19b42">reuse_index</a> = <a class="code" href="memory_8h.html#a6491adf46c1d769b529a8f2f7d75f2fe">XMALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba3ba40968b9b6a7aff633aea95f2341f8">MTYPE_BGP_DAMP_ARRAY</a>, 
                   <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad01f01c54dc229b545b912d7a14ded83">reuse_index_size</a>);
  memset (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a4f84b3db83411ea2f69351e487f19b42">reuse_index</a>, 0x00,
          <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad82b645f7ca7c7debdb3c54943d86771">reuse_list_size</a> * sizeof (<span class="keywordtype">int</span>));

  reuse_max_ratio = (double)<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a46ab465397181f1fc58383f268e30885">ceiling</a>/<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a>;
  j = (exp((<span class="keywordtype">double</span>)<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a94f99fef7621bac5fab20490f889dca4">max_suppress_time</a>/<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a7055c68200a901c92d87d6aa79acece7">half_life</a>) * log10(2.0));
  <span class="keywordflow">if</span> ( reuse_max_ratio &gt; j &amp;&amp; j != 0 )
    reuse_max_ratio = <a class="code" href="spgrid_8c.html#a7113d77fc628f14d4e7d1262969c613e">j</a>;

  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ae3cb43b4b1bdb6330512218fe87bbce0">scale_factor</a> = (double)<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad01f01c54dc229b545b912d7a14ded83">reuse_index_size</a>/(reuse_max_ratio - 1);

  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad01f01c54dc229b545b912d7a14ded83">reuse_index_size</a>; i++)
    {
      <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a4f84b3db83411ea2f69351e487f19b42">reuse_index</a>[<a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>] = 
    (int)(((<span class="keywordtype">double</span>)<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a7055c68200a901c92d87d6aa79acece7">half_life</a> / <a class="code" href="bgp__damp_8h.html#a0ab730b90f217aaee332a4c77360dfca">DELTA_REUSE</a>)
          * log10 (1.0 / (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a> * ( 1.0 + ((<span class="keywordtype">double</span>)i/<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ae3cb43b4b1bdb6330512218fe87bbce0">scale_factor</a>)))) / log10(0.5));
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4dab8cc4c114da6cbe9ff4258a958103"></a><!-- doxytag: member="bgp_damp.c::bgp_damp_reuse_time_vty" ref="a4dab8cc4c114da6cbe9ff4258a958103" args="(struct vty *vty, struct bgp_info *binfo, char *timebuf, size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* bgp_damp_reuse_time_vty </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvty.html">vty</a> *&#160;</td>
          <td class="paramname"><em>vty</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>binfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>timebuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00617">617</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__damp__info.html">bgp_damp_info</a> *bdi;
  time_t t_now, t_diff;
  <span class="keywordtype">int</span> <a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a>;
  
  <span class="keywordflow">if</span> (!binfo-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>)
    <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  
  <span class="comment">/* BGP dampening information.  */</span>
  bdi = binfo-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#a7ff3f44362518bf22b13989ec6924986">damp_info</a>;

  <span class="comment">/* If dampening is not enabled or there is no dampening information,</span>
<span class="comment">     return immediately.  */</span>
  <span class="keywordflow">if</span> (! <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a> || ! bdi)
    <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="comment">/* Calculate new penalty.  */</span>
  t_now = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();
  t_diff = t_now - bdi-&gt;<a class="code" href="structbgp__damp__info.html#a3d0c950f70317aedfd15a0b28feceae1">t_updated</a>;
  penalty = <a class="code" href="bgp__damp_8c.html#a04742fc672b86175444b4b94161c9a81">bgp_damp_decay</a> (t_diff, bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a>);

  <span class="keywordflow">return</span>  <a class="code" href="bgp__damp_8c.html#a09df51c0fccbc11c1818a00e06be28da">bgp_get_reuse_time</a> (penalty, timebuf, len);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1cdac465054860376051b602d242b392"></a><!-- doxytag: member="bgp_damp.c::bgp_damp_scan" ref="a1cdac465054860376051b602d242b392" args="(struct bgp_info *binfo, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_damp_scan </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>binfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00302">302</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  time_t t_now, t_diff;
  <span class="keyword">struct </span><a class="code" href="structbgp__damp__info.html">bgp_damp_info</a> *bdi;
  
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (binfo-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a> &amp;&amp; binfo-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#a7ff3f44362518bf22b13989ec6924986">damp_info</a>);
  
  t_now = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();
  bdi = binfo-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#a7ff3f44362518bf22b13989ec6924986">damp_info</a>;
 
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (binfo-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a8ef9b384054b6b52e7d0af4021a3cc05">BGP_INFO_DAMPED</a>))
    {
      t_diff = t_now - bdi-&gt;<a class="code" href="structbgp__damp__info.html#ad4151e652c9e1583cc8ff0ccde2dd72f">suppress_time</a>;

      <span class="keywordflow">if</span> (t_diff &gt;= <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a94f99fef7621bac5fab20490f889dca4">max_suppress_time</a>)
        {
          <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a506a36cf4f20e2069a1623933c18d6fb">rn</a>, binfo, <a class="code" href="bgp__route_8h.html#a8ef9b384054b6b52e7d0af4021a3cc05">BGP_INFO_DAMPED</a>);
          <a class="code" href="bgp__damp_8c.html#a38fa0292f82b418960810ceb8c2d2309">bgp_reuse_list_delete</a> (bdi);
      <a class="code" href="bgp__damp_8c.html#a9adb7c9da2bfb12c80b3c0602bdda527">BGP_DAMP_LIST_ADD</a> (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>, bdi);
          bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> = <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a>;
          bdi-&gt;<a class="code" href="structbgp__damp__info.html#ad4151e652c9e1583cc8ff0ccde2dd72f">suppress_time</a> = 0;
          bdi-&gt;<a class="code" href="structbgp__damp__info.html#a3d0c950f70317aedfd15a0b28feceae1">t_updated</a> = t_now;
          
          <span class="comment">/* Need to announce UPDATE once this binfo is usable again. */</span>
          <span class="keywordflow">if</span> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#acdc7e308a11230cd73c90b0dcf7a3cdf">lastrecord</a> == <a class="code" href="bgp__damp_8h.html#a311f4eb102141807a3a95b5f0a55726a">BGP_RECORD_UPDATE</a>)
            <span class="keywordflow">return</span> 1;
          <span class="keywordflow">else</span>
            <span class="keywordflow">return</span> 0;
        }
    }
  <span class="keywordflow">else</span>
    {
      t_diff = t_now - bdi-&gt;<a class="code" href="structbgp__damp__info.html#a3d0c950f70317aedfd15a0b28feceae1">t_updated</a>;
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> = <a class="code" href="bgp__damp_8c.html#a04742fc672b86175444b4b94161c9a81">bgp_damp_decay</a> (t_diff, bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a>);

      <span class="keywordflow">if</span> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> &lt;= <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a> / 2.0)
        {
          <span class="comment">/* release the bdi, bdi-&gt;binfo. */</span>  
          <a class="code" href="bgp__damp_8c.html#a0c4f46bfbd9a397b8ba5d830d48cc5ca">bgp_damp_info_free</a> (bdi, 1);
          <span class="keywordflow">return</span> 0;
        }            
      <span class="keywordflow">else</span>
        bdi-&gt;<a class="code" href="structbgp__damp__info.html#a3d0c950f70317aedfd15a0b28feceae1">t_updated</a> = t_now;
    }       
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab12b23e18629cfff0fcc114ca69829d5"></a><!-- doxytag: member="bgp_damp.c::bgp_damp_update" ref="ab12b23e18629cfff0fcc114ca69829d5" args="(struct bgp_info *binfo, struct bgp_node *rn, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_damp_update </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>binfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00261">261</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  time_t t_now;
  <span class="keyword">struct </span><a class="code" href="structbgp__damp__info.html">bgp_damp_info</a> *bdi;
  <span class="keywordtype">int</span> status;

  <span class="keywordflow">if</span> (!binfo-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a> || !((bdi = binfo-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#a7ff3f44362518bf22b13989ec6924986">damp_info</a>)))
    <span class="keywordflow">return</span> <a class="code" href="bgp__damp_8h.html#aa51e39b231ea1edb713d9549a42d00a0">BGP_DAMP_USED</a>;

  t_now = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();
  <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, binfo, <a class="code" href="bgp__route_8h.html#a57adf9fc517cc65fb9f4bcbf8ff796f2">BGP_INFO_HISTORY</a>);

  bdi-&gt;<a class="code" href="structbgp__damp__info.html#acdc7e308a11230cd73c90b0dcf7a3cdf">lastrecord</a> = <a class="code" href="bgp__damp_8h.html#a311f4eb102141807a3a95b5f0a55726a">BGP_RECORD_UPDATE</a>;
  bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> = <a class="code" href="bgp__damp_8c.html#a04742fc672b86175444b4b94161c9a81">bgp_damp_decay</a> (t_now - bdi-&gt;<a class="code" href="structbgp__damp__info.html#a3d0c950f70317aedfd15a0b28feceae1">t_updated</a>, bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a>);

  <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#af37fca6e0e158d27ae0558caedbb6379">binfo</a>-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a8ef9b384054b6b52e7d0af4021a3cc05">BGP_INFO_DAMPED</a>)
      &amp;&amp; (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> &lt; <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a61e0e7bdc6964b808d6796fe1019edbd">suppress_value</a>))
    status = <a class="code" href="bgp__damp_8h.html#aa51e39b231ea1edb713d9549a42d00a0">BGP_DAMP_USED</a>;
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#af37fca6e0e158d27ae0558caedbb6379">binfo</a>-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a8ef9b384054b6b52e7d0af4021a3cc05">BGP_INFO_DAMPED</a>)
       &amp;&amp; (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> &lt; <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a>) )
    {
      <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, binfo, <a class="code" href="bgp__route_8h.html#a8ef9b384054b6b52e7d0af4021a3cc05">BGP_INFO_DAMPED</a>);
      <a class="code" href="bgp__damp_8c.html#a38fa0292f82b418960810ceb8c2d2309">bgp_reuse_list_delete</a> (bdi);
      <a class="code" href="bgp__damp_8c.html#a9adb7c9da2bfb12c80b3c0602bdda527">BGP_DAMP_LIST_ADD</a> (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>, bdi);
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#ad4151e652c9e1583cc8ff0ccde2dd72f">suppress_time</a> = 0;
      status = <a class="code" href="bgp__damp_8h.html#aa51e39b231ea1edb713d9549a42d00a0">BGP_DAMP_USED</a>;
    }
  <span class="keywordflow">else</span>
    status = <a class="code" href="bgp__damp_8h.html#a0f58b7873622a8c3d2e28d38e30719e4">BGP_DAMP_SUPPRESSED</a>;  

  <span class="keywordflow">if</span> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> &gt; <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a> / 2.0)
    bdi-&gt;<a class="code" href="structbgp__damp__info.html#a3d0c950f70317aedfd15a0b28feceae1">t_updated</a> = t_now;
  <span class="keywordflow">else</span>
    <a class="code" href="bgp__damp_8c.html#a0c4f46bfbd9a397b8ba5d830d48cc5ca">bgp_damp_info_free</a> (bdi, 0);
    
  <span class="keywordflow">return</span> status;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6495e2d88335e918ccca6f80fa52cee9"></a><!-- doxytag: member="bgp_damp.c::bgp_damp_withdraw" ref="a6495e2d88335e918ccca6f80fa52cee9" args="(struct bgp_info *binfo, struct bgp_node *rn, afi_t afi, safi_t safi, int attr_change)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_damp_withdraw </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>binfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>attr_change</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00177">177</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  time_t t_now;
  <span class="keyword">struct </span><a class="code" href="structbgp__damp__info.html">bgp_damp_info</a> *bdi = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keywordtype">double</span> last_penalty = 0;
  
  t_now = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();

  <span class="comment">/* Processing Unreachable Messages.  */</span>
  <span class="keywordflow">if</span> (binfo-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>)
    bdi = binfo-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#a7ff3f44362518bf22b13989ec6924986">damp_info</a>;
  
  <span class="keywordflow">if</span> (bdi == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      <span class="comment">/* If there is no previous stability history. */</span>

      <span class="comment">/* RFC2439 said:</span>
<span class="comment">     1. allocate a damping structure.</span>
<span class="comment">         2. set figure-of-merit = 1.</span>
<span class="comment">         3. withdraw the route.  */</span>

      bdi =  <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba0469230ad2a9a5121c508a98d7d279c2">MTYPE_BGP_DAMP_INFO</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structbgp__damp__info.html">bgp_damp_info</a>));
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#af37fca6e0e158d27ae0558caedbb6379">binfo</a> = <a class="code" href="structbgp__damp__info.html#af37fca6e0e158d27ae0558caedbb6379">binfo</a>;
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#a506a36cf4f20e2069a1623933c18d6fb">rn</a> = <a class="code" href="structbgp__damp__info.html#a506a36cf4f20e2069a1623933c18d6fb">rn</a>;
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> = (attr_change ? <a class="code" href="bgp__damp_8h.html#acb4faa4de0633c71f02c70db3c1ab2a6">DEFAULT_PENALTY</a> / 2 : <a class="code" href="bgp__damp_8h.html#acb4faa4de0633c71f02c70db3c1ab2a6">DEFAULT_PENALTY</a>);
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#ab12ae05f133ded91a152d8b42c33336a">flap</a> = 1;
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#a79b767b81bcc0f2015c6da5651dfa149">start_time</a> = t_now;
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#ad4151e652c9e1583cc8ff0ccde2dd72f">suppress_time</a> = 0;
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#a212900332ed4c50d247893983896e937">index</a> = -1;
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#a14549e505c1698c5d8473351caaa2d7f">afi</a> = <a class="code" href="structbgp__damp__info.html#a14549e505c1698c5d8473351caaa2d7f">afi</a>;
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#a47ce9fc92a7ad8fd67a9c768d3f9fc00">safi</a> = <a class="code" href="structbgp__damp__info.html#a47ce9fc92a7ad8fd67a9c768d3f9fc00">safi</a>;
      (<a class="code" href="bgp__route_8c.html#a3afeebe128032bb8a486915820234af9">bgp_info_extra_get</a> (binfo))-&gt;damp_info = bdi;
      <a class="code" href="bgp__damp_8c.html#a9adb7c9da2bfb12c80b3c0602bdda527">BGP_DAMP_LIST_ADD</a> (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>, bdi);
    }
  <span class="keywordflow">else</span>
    {
      last_penalty = bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a>;

      <span class="comment">/* 1. Set t-diff = t-now - t-updated.  */</span>
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> = 
    (<a class="code" href="bgp__damp_8c.html#a04742fc672b86175444b4b94161c9a81">bgp_damp_decay</a> (t_now - bdi-&gt;<a class="code" href="structbgp__damp__info.html#a3d0c950f70317aedfd15a0b28feceae1">t_updated</a>, bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a>) 
     + (attr_change ? <a class="code" href="bgp__damp_8h.html#acb4faa4de0633c71f02c70db3c1ab2a6">DEFAULT_PENALTY</a> / 2 : <a class="code" href="bgp__damp_8h.html#acb4faa4de0633c71f02c70db3c1ab2a6">DEFAULT_PENALTY</a>));

      <span class="keywordflow">if</span> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> &gt; <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a46ab465397181f1fc58383f268e30885">ceiling</a>)
    bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> = <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a46ab465397181f1fc58383f268e30885">ceiling</a>;

      bdi-&gt;<a class="code" href="structbgp__damp__info.html#ab12ae05f133ded91a152d8b42c33336a">flap</a>++;
    }
  
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> ((rn == bdi-&gt;<a class="code" href="structbgp__damp__info.html#a506a36cf4f20e2069a1623933c18d6fb">rn</a>) &amp;&amp; (binfo == bdi-&gt;<a class="code" href="structbgp__damp__info.html#af37fca6e0e158d27ae0558caedbb6379">binfo</a>));
  
  bdi-&gt;<a class="code" href="structbgp__damp__info.html#acdc7e308a11230cd73c90b0dcf7a3cdf">lastrecord</a> = <a class="code" href="bgp__damp_8h.html#aeb2d15f73eff91038418b5c8596a8308">BGP_RECORD_WITHDRAW</a>;
  bdi-&gt;<a class="code" href="structbgp__damp__info.html#a3d0c950f70317aedfd15a0b28feceae1">t_updated</a> = t_now;

  <span class="comment">/* Make this route as historical status.  */</span>
  <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, binfo, <a class="code" href="bgp__route_8h.html#a57adf9fc517cc65fb9f4bcbf8ff796f2">BGP_INFO_HISTORY</a>);

  <span class="comment">/* Remove the route from a reuse list if it is on one.  */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#af37fca6e0e158d27ae0558caedbb6379">binfo</a>-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a8ef9b384054b6b52e7d0af4021a3cc05">BGP_INFO_DAMPED</a>))
    {
      <span class="comment">/* If decay rate isn&#39;t equal to 0, reinsert brn. */</span>  
      <span class="keywordflow">if</span> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> != last_penalty)
    {
      <a class="code" href="bgp__damp_8c.html#a38fa0292f82b418960810ceb8c2d2309">bgp_reuse_list_delete</a> (bdi);
      <a class="code" href="bgp__damp_8c.html#a65aabd892cd32d8abc34163aa4c61582">bgp_reuse_list_add</a> (bdi);  
    }
      <span class="keywordflow">return</span> <a class="code" href="bgp__damp_8h.html#a0f58b7873622a8c3d2e28d38e30719e4">BGP_DAMP_SUPPRESSED</a>; 
    }

  <span class="comment">/* If not suppressed before, do annonunce this withdraw and</span>
<span class="comment">     insert into reuse_list.  */</span>
  <span class="keywordflow">if</span> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> &gt;= <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a61e0e7bdc6964b808d6796fe1019edbd">suppress_value</a>)
    {
      <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, binfo, <a class="code" href="bgp__route_8h.html#a8ef9b384054b6b52e7d0af4021a3cc05">BGP_INFO_DAMPED</a>);
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#ad4151e652c9e1583cc8ff0ccde2dd72f">suppress_time</a> = t_now;
      <a class="code" href="bgp__damp_8c.html#af9283a47419c1af6dab5a1f220f3fa69">BGP_DAMP_LIST_DEL</a> (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>, bdi);
      <a class="code" href="bgp__damp_8c.html#a65aabd892cd32d8abc34163aa4c61582">bgp_reuse_list_add</a> (bdi);
    }

  <span class="keywordflow">return</span> <a class="code" href="bgp__damp_8h.html#aa51e39b231ea1edb713d9549a42d00a0">BGP_DAMP_USED</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a09df51c0fccbc11c1818a00e06be28da"></a><!-- doxytag: member="bgp_damp.c::bgp_get_reuse_time" ref="a09df51c0fccbc11c1818a00e06be28da" args="(unsigned int penalty, char *buf, size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static const char* bgp_get_reuse_time </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>penalty</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00545">545</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  time_t reuse_time = 0;
  <span class="keyword">struct </span>tm *tm = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (penalty &gt; <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a>)
    {
      reuse_time = (int) (<a class="code" href="bgp__damp_8h.html#a5400b1f2028d38732e4377be4f32b255">DELTA_T</a> * ((log((<span class="keywordtype">double</span>)<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a>/penalty))/(log(<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad35b88c80cde9e6c1b6dd5f73d79c599">decay_array</a>[1])))); 

      <span class="keywordflow">if</span> (reuse_time &gt; <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a94f99fef7621bac5fab20490f889dca4">max_suppress_time</a>)
    reuse_time = <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a94f99fef7621bac5fab20490f889dca4">max_suppress_time</a>;

      tm = gmtime (&amp;reuse_time);
    }
  <span class="keywordflow">else</span> 
    reuse_time = 0;

  <span class="comment">/* Making formatted timer strings. */</span>
<span class="preprocessor">#define ONE_DAY_SECOND 60*60*24</span>
<span class="preprocessor"></span><span class="preprocessor">#define ONE_WEEK_SECOND 60*60*24*7</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (reuse_time == 0)
    <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (buf, len, <span class="stringliteral">&quot;00:00:00&quot;</span>);
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (reuse_time &lt; ONE_DAY_SECOND)
    <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (buf, len, <span class="stringliteral">&quot;%02d:%02d:%02d&quot;</span>, 
              tm-&gt;tm_hour, tm-&gt;tm_min, tm-&gt;tm_sec);
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (reuse_time &lt; ONE_WEEK_SECOND)
    <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (buf, len, <span class="stringliteral">&quot;%dd%02dh%02dm&quot;</span>, 
              tm-&gt;tm_yday, tm-&gt;tm_hour, tm-&gt;tm_min);
  <span class="keywordflow">else</span>
    <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (buf, len, <span class="stringliteral">&quot;%02dw%dd%02dh&quot;</span>, 
              tm-&gt;tm_yday/7, tm-&gt;tm_yday - ((tm-&gt;tm_yday/7) * 7), tm-&gt;tm_hour); 

  <span class="keywordflow">return</span> buf;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a893f4a6a09973768072cdc67c71b5438"></a><!-- doxytag: member="bgp_damp.c::bgp_reuse_index" ref="a893f4a6a09973768072cdc67c71b5438" args="(int penalty)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_reuse_index </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>penalty</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00048">48</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
  <span class="keywordtype">int</span> index;

  i = (int)(((<span class="keywordtype">double</span>) penalty / <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a> - 1.0) * <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ae3cb43b4b1bdb6330512218fe87bbce0">scale_factor</a>);
  
  <span class="keywordflow">if</span> ( i &gt;= <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad01f01c54dc229b545b912d7a14ded83">reuse_index_size</a> )
    i = <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad01f01c54dc229b545b912d7a14ded83">reuse_index_size</a> - 1;

  index = <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a4f84b3db83411ea2f69351e487f19b42">reuse_index</a>[<a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>] - <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a4f84b3db83411ea2f69351e487f19b42">reuse_index</a>[0];

  <span class="keywordflow">return</span> (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a9043492faf6e46560ab22c0e408d2b86">reuse_offset</a> + index) % <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad82b645f7ca7c7debdb3c54943d86771">reuse_list_size</a>;  
}
</pre></div>
</div>
</div>
<a class="anchor" id="a65aabd892cd32d8abc34163aa4c61582"></a><!-- doxytag: member="bgp_damp.c::bgp_reuse_list_add" ref="a65aabd892cd32d8abc34163aa4c61582" args="(struct bgp_damp_info *bdi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_reuse_list_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__damp__info.html">bgp_damp_info</a> *&#160;</td>
          <td class="paramname"><em>bdi</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00065">65</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> index;

  index = bdi-&gt;<a class="code" href="structbgp__damp__info.html#a212900332ed4c50d247893983896e937">index</a> = <a class="code" href="bgp__damp_8c.html#a893f4a6a09973768072cdc67c71b5438">bgp_reuse_index</a> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a>);

  bdi-&gt;<a class="code" href="structbgp__damp__info.html#a30906878e7f0745ceee443bc46d30c4e">prev</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  bdi-&gt;<a class="code" href="structbgp__damp__info.html#aaab72d4a62904dfd1c1c317936d7ffea">next</a> = <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a31e11b75924cfb22e0a563e532849fd4">reuse_list</a>[index];
  <span class="keywordflow">if</span> (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a31e11b75924cfb22e0a563e532849fd4">reuse_list</a>[index])
    <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a31e11b75924cfb22e0a563e532849fd4">reuse_list</a>[index]-&gt;<a class="code" href="structbgp__damp__info.html#a30906878e7f0745ceee443bc46d30c4e">prev</a> = bdi;
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a31e11b75924cfb22e0a563e532849fd4">reuse_list</a>[index] = bdi;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a38fa0292f82b418960810ceb8c2d2309"></a><!-- doxytag: member="bgp_damp.c::bgp_reuse_list_delete" ref="a38fa0292f82b418960810ceb8c2d2309" args="(struct bgp_damp_info *bdi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_reuse_list_delete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__damp__info.html">bgp_damp_info</a> *&#160;</td>
          <td class="paramname"><em>bdi</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00080">80</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#aaab72d4a62904dfd1c1c317936d7ffea">next</a>)
    bdi-&gt;<a class="code" href="structbgp__damp__info.html#aaab72d4a62904dfd1c1c317936d7ffea">next</a>-&gt;<a class="code" href="structbgp__damp__info.html#a30906878e7f0745ceee443bc46d30c4e">prev</a> = bdi-&gt;<a class="code" href="structbgp__damp__info.html#a30906878e7f0745ceee443bc46d30c4e">prev</a>;
  <span class="keywordflow">if</span> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a30906878e7f0745ceee443bc46d30c4e">prev</a>)
    bdi-&gt;<a class="code" href="structbgp__damp__info.html#a30906878e7f0745ceee443bc46d30c4e">prev</a>-&gt;<a class="code" href="structbgp__damp__info.html#aaab72d4a62904dfd1c1c317936d7ffea">next</a> = bdi-&gt;<a class="code" href="structbgp__damp__info.html#aaab72d4a62904dfd1c1c317936d7ffea">next</a>;
  <span class="keywordflow">else</span>
    <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a31e11b75924cfb22e0a563e532849fd4">reuse_list</a>[bdi-&gt;<a class="code" href="structbgp__damp__info.html#a212900332ed4c50d247893983896e937">index</a>] = bdi-&gt;<a class="code" href="structbgp__damp__info.html#aaab72d4a62904dfd1c1c317936d7ffea">next</a>;
}   
</pre></div>
</div>
</div>
<a class="anchor" id="a1eb38f534f8bbb214584a2dbacb649a0"></a><!-- doxytag: member="bgp_damp.c::bgp_reuse_timer" ref="a1eb38f534f8bbb214584a2dbacb649a0" args="(struct thread *t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_reuse_timer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>t</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00110">110</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__damp__info.html">bgp_damp_info</a> *bdi;
  <span class="keyword">struct </span><a class="code" href="structbgp__damp__info.html">bgp_damp_info</a> *<a class="code" href="structbgp__damp__info.html#aaab72d4a62904dfd1c1c317936d7ffea">next</a>;
  time_t t_now, t_diff;
    
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a917075d1961998bb01d7cb2043a4aa80">t_reuse</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a917075d1961998bb01d7cb2043a4aa80">t_reuse</a> =
    <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="bgp__damp_8c.html#a1eb38f534f8bbb214584a2dbacb649a0">bgp_reuse_timer</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="bgp__damp_8h.html#a0ab730b90f217aaee332a4c77360dfca">DELTA_REUSE</a>);

  t_now = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();

  <span class="comment">/* 1.  save a pointer to the current zeroth queue head and zero the</span>
<span class="comment">     list head entry.  */</span>
  bdi = <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a31e11b75924cfb22e0a563e532849fd4">reuse_list</a>[<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a9043492faf6e46560ab22c0e408d2b86">reuse_offset</a>];
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a31e11b75924cfb22e0a563e532849fd4">reuse_list</a>[<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a9043492faf6e46560ab22c0e408d2b86">reuse_offset</a>] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="comment">/* 2.  set offset = modulo reuse-list-size ( offset + 1 ), thereby</span>
<span class="comment">     rotating the circular queue of list-heads.  */</span>
  <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a9043492faf6e46560ab22c0e408d2b86">reuse_offset</a> = (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#a9043492faf6e46560ab22c0e408d2b86">reuse_offset</a> + 1) % <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#ad82b645f7ca7c7debdb3c54943d86771">reuse_list_size</a>;

  <span class="comment">/* 3. if ( the saved list head pointer is non-empty ) */</span>
  for (; bdi; bdi = <a class="code" href="structbgp__damp__info.html#aaab72d4a62904dfd1c1c317936d7ffea">next</a>)
    {
      <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="structbgp.html">bgp</a> = bdi-&gt;<a class="code" href="structbgp__damp__info.html#af37fca6e0e158d27ae0558caedbb6379">binfo</a>-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>;
      
      next = bdi-&gt;<a class="code" href="structbgp__damp__info.html#aaab72d4a62904dfd1c1c317936d7ffea">next</a>;

      <span class="comment">/* Set t-diff = t-now - t-updated.  */</span>
      t_diff = t_now - bdi-&gt;<a class="code" href="structbgp__damp__info.html#a3d0c950f70317aedfd15a0b28feceae1">t_updated</a>;

      <span class="comment">/* Set figure-of-merit = figure-of-merit * decay-array-ok [t-diff] */</span>
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> = <a class="code" href="bgp__damp_8c.html#a04742fc672b86175444b4b94161c9a81">bgp_damp_decay</a> (t_diff, bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a>);   

      <span class="comment">/* Set t-updated = t-now.  */</span>
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#a3d0c950f70317aedfd15a0b28feceae1">t_updated</a> = t_now;

      <span class="comment">/* if (figure-of-merit &lt; reuse).  */</span>
      <span class="keywordflow">if</span> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> &lt; <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a>)
    {
      <span class="comment">/* Reuse the route.  */</span>
      <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a506a36cf4f20e2069a1623933c18d6fb">rn</a>, bdi-&gt;<a class="code" href="structbgp__damp__info.html#af37fca6e0e158d27ae0558caedbb6379">binfo</a>, <a class="code" href="bgp__route_8h.html#a8ef9b384054b6b52e7d0af4021a3cc05">BGP_INFO_DAMPED</a>);
      bdi-&gt;<a class="code" href="structbgp__damp__info.html#ad4151e652c9e1583cc8ff0ccde2dd72f">suppress_time</a> = 0;

      <span class="keywordflow">if</span> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#acdc7e308a11230cd73c90b0dcf7a3cdf">lastrecord</a> == <a class="code" href="bgp__damp_8h.html#a311f4eb102141807a3a95b5f0a55726a">BGP_RECORD_UPDATE</a>)
        {
          <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a506a36cf4f20e2069a1623933c18d6fb">rn</a>, bdi-&gt;<a class="code" href="structbgp__damp__info.html#af37fca6e0e158d27ae0558caedbb6379">binfo</a>, <a class="code" href="bgp__route_8h.html#a57adf9fc517cc65fb9f4bcbf8ff796f2">BGP_INFO_HISTORY</a>);
          <a class="code" href="bgp__route_8h.html#ac218a5ef2e04869ebdac5ea9bfbf19e2">bgp_aggregate_increment</a> (bgp, &amp;bdi-&gt;<a class="code" href="structbgp__damp__info.html#a506a36cf4f20e2069a1623933c18d6fb">rn</a>-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>, bdi-&gt;<a class="code" href="structbgp__damp__info.html#af37fca6e0e158d27ae0558caedbb6379">binfo</a>,
                       bdi-&gt;<a class="code" href="structbgp__damp__info.html#a14549e505c1698c5d8473351caaa2d7f">afi</a>, bdi-&gt;<a class="code" href="structbgp__damp__info.html#a47ce9fc92a7ad8fd67a9c768d3f9fc00">safi</a>);   
          <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, bdi-&gt;<a class="code" href="structbgp__damp__info.html#a506a36cf4f20e2069a1623933c18d6fb">rn</a>, bdi-&gt;<a class="code" href="structbgp__damp__info.html#a14549e505c1698c5d8473351caaa2d7f">afi</a>, bdi-&gt;<a class="code" href="structbgp__damp__info.html#a47ce9fc92a7ad8fd67a9c768d3f9fc00">safi</a>);
        }

      <span class="keywordflow">if</span> (bdi-&gt;<a class="code" href="structbgp__damp__info.html#a64957844448af43a55f25e72ffe419a6">penalty</a> &lt;= <a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>-&gt;<a class="code" href="structbgp__damp__config.html#aec889c6882eb02a28dc81d58f8321d3c">reuse_limit</a> / 2.0)
        <a class="code" href="bgp__damp_8c.html#a0c4f46bfbd9a397b8ba5d830d48cc5ca">bgp_damp_info_free</a> (bdi, 1);
      <span class="keywordflow">else</span>
        <a class="code" href="bgp__damp_8c.html#a9adb7c9da2bfb12c80b3c0602bdda527">BGP_DAMP_LIST_ADD</a> (<a class="code" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a>, bdi);
    }
      <span class="keywordflow">else</span>
    <span class="comment">/* Re-insert into another list (See RFC2439 Section 4.8.6).  */</span>
    <a class="code" href="bgp__damp_8c.html#a65aabd892cd32d8abc34163aa4c61582">bgp_reuse_list_add</a> (bdi);
    }

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ad3adefbd53055fecb5eea7e002c2c638"></a><!-- doxytag: member="bgp_damp.c::bgp_damp_cfg" ref="ad3adefbd53055fecb5eea7e002c2c638" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structbgp__damp__config.html">bgp_damp_config</a> <a class="el" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00038">38</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3a204141fb82f4db060f07b20f6d34fc"></a><!-- doxytag: member="bgp_damp.c::damp" ref="a3a204141fb82f4db060f07b20f6d34fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structbgp__damp__config.html">bgp_damp_config</a>* <a class="el" href="bgp__damp_8c.html#a3a204141fb82f4db060f07b20f6d34fc">damp</a> = &amp;<a class="el" href="bgp__damp_8c.html#ad3adefbd53055fecb5eea7e002c2c638">bgp_damp_cfg</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__damp_8c_source.html#l00039">39</a> of file <a class="el" href="bgp__damp_8c_source.html">bgp_damp.c</a>.</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="bgp__damp_8c.html">bgp_damp.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:11 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
