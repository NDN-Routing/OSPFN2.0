<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: watchquagga/watchquagga.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('watchquagga_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">watchquagga/watchquagga.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="zebra_8h_source.html">zebra.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="thread_8h_source.html">thread.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="log_8h_source.html">log.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="network_8h_source.html">network.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sigevent_8h_source.html">sigevent.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="version_8h_source.html">lib/version.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="getopt_8h_source.html">getopt.h</a>&gt;</code><br/>
<code>#include &lt;sys/un.h&gt;</code><br/>
<code>#include &lt;sys/wait.h&gt;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for watchquagga.c:</div>
<div class="dyncontent">
<div class="center"><img src="watchquagga_8c__incl.png" border="0" usemap="#watchquagga_2watchquagga_8c" alt=""/></div>
<map name="watchquagga_2watchquagga_8c" id="watchquagga_2watchquagga_8c">
<area shape="rect" id="node3" href="zebra_8h.html" title="zebra.h" alt="" coords="1345,80,1412,107"/><area shape="rect" id="node61" href="thread_8h.html" title="thread.h" alt="" coords="2884,155,2956,181"/><area shape="rect" id="node63" href="log_8h.html" title="log.h" alt="" coords="2719,80,2771,107"/><area shape="rect" id="node66" href="network_8h.html" title="network.h" alt="" coords="2847,80,2929,107"/><area shape="rect" id="node68" href="sigevent_8h.html" title="sigevent.h" alt="" coords="2954,80,3040,107"/><area shape="rect" id="node71" href="version_8h.html" title="lib/version.h" alt="" coords="3065,80,3159,107"/><area shape="rect" id="node73" href="getopt_8h.html" title="getopt.h" alt="" coords="3184,80,3259,107"/><area shape="rect" id="node57" href="zassert_8h.html" title="zassert.h" alt="" coords="2572,155,2649,181"/><area shape="rect" id="node59" href="str_8h.html" title="str.h" alt="" coords="2674,155,2723,181"/></map>
</div>
</div>
<p><a href="watchquagga_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrestart__info.html">restart_info</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structglobal__state.html">global_state</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdaemon.html">daemon</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a810038e66782b0b095cf08242013fe60">JITTER</a>(<a class="el" href="spgrid_8c.html#a90fd6c5f495a36ebf73ab5d2f1c21b47">X</a>)&#160;&#160;&#160;((random() % ((<a class="el" href="spgrid_8c.html#a90fd6c5f495a36ebf73ab5d2f1c21b47">X</a>)+1))-((<a class="el" href="spgrid_8c.html#a90fd6c5f495a36ebf73ab5d2f1c21b47">X</a>)/2))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a1279c98bba43bbc22f2d276291ec8840">FUZZY</a>(<a class="el" href="spgrid_8c.html#a90fd6c5f495a36ebf73ab5d2f1c21b47">X</a>)&#160;&#160;&#160;((<a class="el" href="spgrid_8c.html#a90fd6c5f495a36ebf73ab5d2f1c21b47">X</a>)+JITTER((<a class="el" href="spgrid_8c.html#a90fd6c5f495a36ebf73ab5d2f1c21b47">X</a>)/20))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a19ae3417888a615aca7350e9e1ba0204">DEFAULT_PERIOD</a>&#160;&#160;&#160;5</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#aad2dd72565852b91c809cd4685833b17">DEFAULT_TIMEOUT</a>&#160;&#160;&#160;10</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#abc9c0b03b73ee41cc7d9962a87194b29">DEFAULT_RESTART_TIMEOUT</a>&#160;&#160;&#160;20</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#aec8c265923c6714be1f4a42e252bc872">DEFAULT_LOGLEVEL</a>&#160;&#160;&#160;LOG_INFO</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#aa6d28ab74f2bbba9e5ebc440216f68d2">DEFAULT_MIN_RESTART</a>&#160;&#160;&#160;60</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#abaee7e06edf46609c00dddb2a7e78f46">DEFAULT_MAX_RESTART</a>&#160;&#160;&#160;600</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a108b7f06d065ce9a1087cc8ffbd481c2">DEFAULT_PIDFILE</a>&#160;&#160;&#160;STATEDIR &quot;/watchquagga.pid&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a5f1e994b088713b35b7f9b7edd1b4242">VTYDIR</a>&#160;&#160;&#160;STATEDIR</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#abc0f87853cfbb9f46572c6f4ea34f591">PING_TOKEN</a>&#160;&#160;&#160;&quot;PING&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#adf01e890ebef9b526d4b22f2ca5b10ec">PHASE_TIMEOUT</a>&#160;&#160;&#160;(3*gs.restart_timeout)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a4e0c264b87680b3b88c43526a082b12e">IS_UP</a>(DMN)&#160;&#160;&#160;(((DMN)-&gt;state == DAEMON_UP) || ((DMN)-&gt;state == DAEMON_UNRESPONSIVE))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#aad9410fad46db274da2408cc6efbd681">SET_READ_HANDLER</a>(DMN)&#160;&#160;&#160;(DMN)-&gt;t_read = thread_add_read(<a class="el" href="test__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>,handle_read,(DMN),(DMN)-&gt;fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a3f4208a945dd2e77f915f9b7cbb77803">SET_WAKEUP_DOWN</a>(DMN)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a28c11f6de68844c7454b7c807a1c40d1">SET_WAKEUP_UNRESPONSIVE</a>(DMN)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a86108789f08240f7d0fc965bfe9a7bbf">SET_WAKEUP_ECHO</a>(DMN)</td></tr>
<tr><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639d">watch_mode_t</a> { <br/>
&#160;&#160;<a class="el" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639daff82e266ad97e1f6b0536947534b9db1">MODE_MONITOR</a> =  0, 
<a class="el" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da10a238369099481dca5e44d95b55076d">MODE_GLOBAL_RESTART</a>, 
<a class="el" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639dadaa0f184c31c44f5f393f09b472dd19d">MODE_SEPARATE_RESTART</a>, 
<a class="el" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da59ac418e6adf6d90de6eaa305dbdfed4">MODE_PHASED_ZEBRA_RESTART</a>, 
<br/>
&#160;&#160;<a class="el" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da88749ab4e93d56fac47580244e170b05">MODE_PHASED_ALL_RESTART</a>
<br/>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430">restart_phase_t</a> { <br/>
&#160;&#160;<a class="el" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a61e900515aec51ba22cfdd63c1082fc7">PHASE_NONE</a> =  0, 
<a class="el" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430af979eabf3440749d3ff3ef7fbb5c1f78">PHASE_STOPS_PENDING</a>, 
<a class="el" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a839919f29423cc27e216f678746abebf">PHASE_WAITING_DOWN</a>, 
<a class="el" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a957d64ff81ae79b0264c549b5714a9bc">PHASE_ZEBRA_RESTART_PENDING</a>, 
<br/>
&#160;&#160;<a class="el" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a0a5ea50c0e1f43a6981748026fe58208">PHASE_WAITING_ZEBRA_UP</a>
<br/>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38">daemon_state_t</a> { <br/>
&#160;&#160;<a class="el" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a92e10d588126a0f8066b9dd18f2f90f6">DAEMON_INIT</a>, 
<a class="el" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a0ec7be6d84eb71cf7d575b2a53d8ddce">DAEMON_DOWN</a>, 
<a class="el" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a269ad29eaf90e57e0fe5da74fcbc9320">DAEMON_CONNECTING</a>, 
<a class="el" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a1be09914c1c6bf9825ef80fb681ee2ec">DAEMON_UP</a>, 
<br/>
&#160;&#160;<a class="el" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a275085ab09194304efb7f479f7b49232">DAEMON_UNRESPONSIVE</a>
<br/>
 }</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#af11b57b4da019de6d555b11a73ff1dd3">try_connect</a> (struct <a class="el" href="structdaemon.html">daemon</a> *dmn)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#af8369e03b393c7ab747bf04aac92b020">wakeup_send_echo</a> (struct <a class="el" href="structthread.html">thread</a> *t_wakeup)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#aa637d38f3150c85002318b8947389e45">try_restart</a> (struct <a class="el" href="structdaemon.html">daemon</a> *dmn)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#af892b970a62c4640caf2ec4d9ef7dc40">phase_check</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a09ab3bc0cba22a79f31c7e04c2f62f63">usage</a> (const char *<a class="el" href="vtysh__main_8c.html#ab9e1449fd00c98428516f0b41eddcb10">progname</a>, int status)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static pid_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a043794d8f8da2faffe9b9a98bbf4f116">run_background</a> (const char *shell_cmd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct timeval *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a79bb4fa30cfacd7831e1bec08147c6ab">time_elapsed</a> (struct timeval *result, const struct timeval *start_time)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a4b122497788fd6bae49352f1c9d6d6be">restart_kill</a> (struct <a class="el" href="structthread.html">thread</a> *t_kill)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structrestart__info.html">restart_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#ad1e38d2596f500ffef6fec5a9f63231c">find_child</a> (pid_t child)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#afb0f8b8f3f52afd07bd6fb5793b999c4">sigchild</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a88a4bd930358f3f0df5b6b7256becc50">run_job</a> (struct <a class="el" href="structrestart__info.html">restart_info</a> *restart, const char *cmdtype, const char *command, int force, int update_interval)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a861ae2ed5075dec55c6065399e736ed9">wakeup_down</a> (struct <a class="el" href="structthread.html">thread</a> *t_wakeup)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a20a45d7c8bed8569a2cbeba4747461ee">wakeup_init</a> (struct <a class="el" href="structthread.html">thread</a> *t_wakeup)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a2dee993c9ca79cff47ffdb2460953bb2">daemon_down</a> (struct <a class="el" href="structdaemon.html">daemon</a> *dmn, const char *why)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a24ffcd6d1835e1e4b0f70c7e259c0db7">handle_read</a> (struct <a class="el" href="structthread.html">thread</a> *t_read)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#adc676d395fc4b1fe2adcad8c505eda09">daemon_up</a> (struct <a class="el" href="structdaemon.html">daemon</a> *dmn, const char *why)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a41f7caca64f819bbd7134cbd20ac2098">check_connect</a> (struct <a class="el" href="structthread.html">thread</a> *t_write)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#ac7ca844b9f41979949e5d43bd55c6001">wakeup_connect_hanging</a> (struct <a class="el" href="structthread.html">thread</a> *t_wakeup)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#afc99643db56e6fa9af56e9ad5f112fb3">phase_hanging</a> (struct <a class="el" href="structthread.html">thread</a> *t_hanging)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#afe6e5a642e61fc1a4f7c5b9d243b644e">set_phase</a> (<a class="el" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430">restart_phase_t</a> new_phase)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a0b10a2b1c589d7ac81017d90a30df739">wakeup_unresponsive</a> (struct <a class="el" href="structthread.html">thread</a> *t_wakeup)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a0f31474fb09f036f544dd171f271ba46">wakeup_no_answer</a> (struct <a class="el" href="structthread.html">thread</a> *t_wakeup)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#acc1594c0e273f7b9134404951c7ef595">sigint</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a72ce6b2c5071c2fae3cc7d61f559502b">valid_command</a> (const char *cmd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a368996dc1c464c40bfd40dab47efad45">translate_blanks</a> (const char *cmd, const char *blankstr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structthread__master.html">thread_master</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#aa26a9ffa56c9c4fce0f6dbe9eae8a7ae">phase_str</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structglobal__state.html">global_state</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a3012714639dac6ee77ac759f561c8702">state_str</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structoption.html">option</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchquagga_8c.html#a94965649155359a4c4eb047af782bf22">longopts</a> []</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="aec8c265923c6714be1f4a42e252bc872"></a><!-- doxytag: member="watchquagga.c::DEFAULT_LOGLEVEL" ref="aec8c265923c6714be1f4a42e252bc872" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_LOGLEVEL&#160;&#160;&#160;LOG_INFO</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00044">44</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="abaee7e06edf46609c00dddb2a7e78f46"></a><!-- doxytag: member="watchquagga.c::DEFAULT_MAX_RESTART" ref="abaee7e06edf46609c00dddb2a7e78f46" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_MAX_RESTART&#160;&#160;&#160;600</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00046">46</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa6d28ab74f2bbba9e5ebc440216f68d2"></a><!-- doxytag: member="watchquagga.c::DEFAULT_MIN_RESTART" ref="aa6d28ab74f2bbba9e5ebc440216f68d2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_MIN_RESTART&#160;&#160;&#160;60</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00045">45</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="a19ae3417888a615aca7350e9e1ba0204"></a><!-- doxytag: member="watchquagga.c::DEFAULT_PERIOD" ref="a19ae3417888a615aca7350e9e1ba0204" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_PERIOD&#160;&#160;&#160;5</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00041">41</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="a108b7f06d065ce9a1087cc8ffbd481c2"></a><!-- doxytag: member="watchquagga.c::DEFAULT_PIDFILE" ref="a108b7f06d065ce9a1087cc8ffbd481c2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_PIDFILE&#160;&#160;&#160;STATEDIR &quot;/watchquagga.pid&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00050">50</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="abc9c0b03b73ee41cc7d9962a87194b29"></a><!-- doxytag: member="watchquagga.c::DEFAULT_RESTART_TIMEOUT" ref="abc9c0b03b73ee41cc7d9962a87194b29" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_RESTART_TIMEOUT&#160;&#160;&#160;20</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00043">43</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="aad2dd72565852b91c809cd4685833b17"></a><!-- doxytag: member="watchquagga.c::DEFAULT_TIMEOUT" ref="aad2dd72565852b91c809cd4685833b17" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_TIMEOUT&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00042">42</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1279c98bba43bbc22f2d276291ec8840"></a><!-- doxytag: member="watchquagga.c::FUZZY" ref="a1279c98bba43bbc22f2d276291ec8840" args="(X)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FUZZY</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="spgrid_8c.html#a90fd6c5f495a36ebf73ab5d2f1c21b47">X</a></td><td>)</td>
          <td>&#160;&#160;&#160;((<a class="el" href="spgrid_8c.html#a90fd6c5f495a36ebf73ab5d2f1c21b47">X</a>)+JITTER((<a class="el" href="spgrid_8c.html#a90fd6c5f495a36ebf73ab5d2f1c21b47">X</a>)/20))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00039">39</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4e0c264b87680b3b88c43526a082b12e"></a><!-- doxytag: member="watchquagga.c::IS_UP" ref="a4e0c264b87680b3b88c43526a082b12e" args="(DMN)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_UP</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">DMN</td><td>)</td>
          <td>&#160;&#160;&#160;(((DMN)-&gt;state == DAEMON_UP) || ((DMN)-&gt;state == DAEMON_UNRESPONSIVE))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00158">158</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="a810038e66782b0b095cf08242013fe60"></a><!-- doxytag: member="watchquagga.c::JITTER" ref="a810038e66782b0b095cf08242013fe60" args="(X)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define JITTER</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="spgrid_8c.html#a90fd6c5f495a36ebf73ab5d2f1c21b47">X</a></td><td>)</td>
          <td>&#160;&#160;&#160;((random() % ((<a class="el" href="spgrid_8c.html#a90fd6c5f495a36ebf73ab5d2f1c21b47">X</a>)+1))-((<a class="el" href="spgrid_8c.html#a90fd6c5f495a36ebf73ab5d2f1c21b47">X</a>)/2))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00038">38</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="adf01e890ebef9b526d4b22f2ca5b10ec"></a><!-- doxytag: member="watchquagga.c::PHASE_TIMEOUT" ref="adf01e890ebef9b526d4b22f2ca5b10ec" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PHASE_TIMEOUT&#160;&#160;&#160;(3*gs.restart_timeout)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00100">100</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="abc0f87853cfbb9f46572c6f4ea34f591"></a><!-- doxytag: member="watchquagga.c::PING_TOKEN" ref="abc0f87853cfbb9f46572c6f4ea34f591" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PING_TOKEN&#160;&#160;&#160;&quot;PING&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00058">58</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="aad9410fad46db274da2408cc6efbd681"></a><!-- doxytag: member="watchquagga.c::SET_READ_HANDLER" ref="aad9410fad46db274da2408cc6efbd681" args="(DMN)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SET_READ_HANDLER</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">DMN</td><td>)</td>
          <td>&#160;&#160;&#160;(DMN)-&gt;t_read = thread_add_read(<a class="el" href="test__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>,handle_read,(DMN),(DMN)-&gt;fd)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00531">531</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3f4208a945dd2e77f915f9b7cbb77803"></a><!-- doxytag: member="watchquagga.c::SET_WAKEUP_DOWN" ref="a3f4208a945dd2e77f915f9b7cbb77803" args="(DMN)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SET_WAKEUP_DOWN</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">DMN</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">(DMN)-&gt;t_wakeup = <a class="code" href="thread_8h.html#a9231be4b08f04f6ebc1bea080443ba74">thread_add_timer_msec</a>(<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>,<a class="code" href="watchquagga_8c.html#a861ae2ed5075dec55c6065399e736ed9">wakeup_down</a>,(DMN),   \
                          FUZZY(<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a42da62a70b72aef10271d714a63ba606">period</a>))
</pre></div>
<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00534">534</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="a86108789f08240f7d0fc965bfe9a7bbf"></a><!-- doxytag: member="watchquagga.c::SET_WAKEUP_ECHO" ref="a86108789f08240f7d0fc965bfe9a7bbf" args="(DMN)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SET_WAKEUP_ECHO</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">DMN</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">(DMN)-&gt;t_wakeup = <a class="code" href="thread_8h.html#a9231be4b08f04f6ebc1bea080443ba74">thread_add_timer_msec</a>(<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>,<a class="code" href="watchquagga_8c.html#af8369e03b393c7ab747bf04aac92b020">wakeup_send_echo</a>,(DMN), \
                      FUZZY(<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a42da62a70b72aef10271d714a63ba606">period</a>))
</pre></div>
<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00542">542</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="a28c11f6de68844c7454b7c807a1c40d1"></a><!-- doxytag: member="watchquagga.c::SET_WAKEUP_UNRESPONSIVE" ref="a28c11f6de68844c7454b7c807a1c40d1" args="(DMN)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SET_WAKEUP_UNRESPONSIVE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">DMN</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">(DMN)-&gt;t_wakeup = <a class="code" href="thread_8h.html#a9231be4b08f04f6ebc1bea080443ba74">thread_add_timer_msec</a>(<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>,<a class="code" href="watchquagga_8c.html#a0b10a2b1c589d7ac81017d90a30df739">wakeup_unresponsive</a>,(DMN), \
                          FUZZY(<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a42da62a70b72aef10271d714a63ba606">period</a>))
</pre></div>
<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00538">538</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5f1e994b088713b35b7f9b7edd1b4242"></a><!-- doxytag: member="watchquagga.c::VTYDIR" ref="a5f1e994b088713b35b7f9b7edd1b4242" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VTYDIR&#160;&#160;&#160;STATEDIR</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00055">55</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a73529b87279a7fdabf5b3c42b3ddec38"></a><!-- doxytag: member="watchquagga.c::daemon_state_t" ref="a73529b87279a7fdabf5b3c42b3ddec38" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38">daemon_state_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a73529b87279a7fdabf5b3c42b3ddec38a92e10d588126a0f8066b9dd18f2f90f6"></a><!-- doxytag: member="DAEMON_INIT" ref="a73529b87279a7fdabf5b3c42b3ddec38a92e10d588126a0f8066b9dd18f2f90f6" args="" -->DAEMON_INIT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a73529b87279a7fdabf5b3c42b3ddec38a0ec7be6d84eb71cf7d575b2a53d8ddce"></a><!-- doxytag: member="DAEMON_DOWN" ref="a73529b87279a7fdabf5b3c42b3ddec38a0ec7be6d84eb71cf7d575b2a53d8ddce" args="" -->DAEMON_DOWN</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a73529b87279a7fdabf5b3c42b3ddec38a269ad29eaf90e57e0fe5da74fcbc9320"></a><!-- doxytag: member="DAEMON_CONNECTING" ref="a73529b87279a7fdabf5b3c42b3ddec38a269ad29eaf90e57e0fe5da74fcbc9320" args="" -->DAEMON_CONNECTING</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a73529b87279a7fdabf5b3c42b3ddec38a1be09914c1c6bf9825ef80fb681ee2ec"></a><!-- doxytag: member="DAEMON_UP" ref="a73529b87279a7fdabf5b3c42b3ddec38a1be09914c1c6bf9825ef80fb681ee2ec" args="" -->DAEMON_UP</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a73529b87279a7fdabf5b3c42b3ddec38a275085ab09194304efb7f479f7b49232"></a><!-- doxytag: member="DAEMON_UNRESPONSIVE" ref="a73529b87279a7fdabf5b3c42b3ddec38a275085ab09194304efb7f479f7b49232" args="" -->DAEMON_UNRESPONSIVE</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00149">149</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a92e10d588126a0f8066b9dd18f2f90f6">DAEMON_INIT</a>,
  <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a0ec7be6d84eb71cf7d575b2a53d8ddce">DAEMON_DOWN</a>,
  <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a269ad29eaf90e57e0fe5da74fcbc9320">DAEMON_CONNECTING</a>,
  <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a1be09914c1c6bf9825ef80fb681ee2ec">DAEMON_UP</a>,
  <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a275085ab09194304efb7f479f7b49232">DAEMON_UNRESPONSIVE</a>
} <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38">daemon_state_t</a>;
</pre></div>
</div>
</div>
<a class="anchor" id="a32d1552af3e5d7e6582e6e832ba6e430"></a><!-- doxytag: member="watchquagga.c::restart_phase_t" ref="a32d1552af3e5d7e6582e6e832ba6e430" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430">restart_phase_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a32d1552af3e5d7e6582e6e832ba6e430a61e900515aec51ba22cfdd63c1082fc7"></a><!-- doxytag: member="PHASE_NONE" ref="a32d1552af3e5d7e6582e6e832ba6e430a61e900515aec51ba22cfdd63c1082fc7" args="" -->PHASE_NONE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a32d1552af3e5d7e6582e6e832ba6e430af979eabf3440749d3ff3ef7fbb5c1f78"></a><!-- doxytag: member="PHASE_STOPS_PENDING" ref="a32d1552af3e5d7e6582e6e832ba6e430af979eabf3440749d3ff3ef7fbb5c1f78" args="" -->PHASE_STOPS_PENDING</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a32d1552af3e5d7e6582e6e832ba6e430a839919f29423cc27e216f678746abebf"></a><!-- doxytag: member="PHASE_WAITING_DOWN" ref="a32d1552af3e5d7e6582e6e832ba6e430a839919f29423cc27e216f678746abebf" args="" -->PHASE_WAITING_DOWN</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a32d1552af3e5d7e6582e6e832ba6e430a957d64ff81ae79b0264c549b5714a9bc"></a><!-- doxytag: member="PHASE_ZEBRA_RESTART_PENDING" ref="a32d1552af3e5d7e6582e6e832ba6e430a957d64ff81ae79b0264c549b5714a9bc" args="" -->PHASE_ZEBRA_RESTART_PENDING</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a32d1552af3e5d7e6582e6e832ba6e430a0a5ea50c0e1f43a6981748026fe58208"></a><!-- doxytag: member="PHASE_WAITING_ZEBRA_UP" ref="a32d1552af3e5d7e6582e6e832ba6e430a0a5ea50c0e1f43a6981748026fe58208" args="" -->PHASE_WAITING_ZEBRA_UP</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00081">81</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a61e900515aec51ba22cfdd63c1082fc7">PHASE_NONE</a> = 0,
  <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430af979eabf3440749d3ff3ef7fbb5c1f78">PHASE_STOPS_PENDING</a>,
  <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a839919f29423cc27e216f678746abebf">PHASE_WAITING_DOWN</a>,
  <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a957d64ff81ae79b0264c549b5714a9bc">PHASE_ZEBRA_RESTART_PENDING</a>,
  <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a0a5ea50c0e1f43a6981748026fe58208">PHASE_WAITING_ZEBRA_UP</a>
} <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430">restart_phase_t</a>;
</pre></div>
</div>
</div>
<a class="anchor" id="a2d7d16a6771b465726c774ca18dc639d"></a><!-- doxytag: member="watchquagga.c::watch_mode_t" ref="a2d7d16a6771b465726c774ca18dc639d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639d">watch_mode_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a2d7d16a6771b465726c774ca18dc639daff82e266ad97e1f6b0536947534b9db1"></a><!-- doxytag: member="MODE_MONITOR" ref="a2d7d16a6771b465726c774ca18dc639daff82e266ad97e1f6b0536947534b9db1" args="" -->MODE_MONITOR</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2d7d16a6771b465726c774ca18dc639da10a238369099481dca5e44d95b55076d"></a><!-- doxytag: member="MODE_GLOBAL_RESTART" ref="a2d7d16a6771b465726c774ca18dc639da10a238369099481dca5e44d95b55076d" args="" -->MODE_GLOBAL_RESTART</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2d7d16a6771b465726c774ca18dc639dadaa0f184c31c44f5f393f09b472dd19d"></a><!-- doxytag: member="MODE_SEPARATE_RESTART" ref="a2d7d16a6771b465726c774ca18dc639dadaa0f184c31c44f5f393f09b472dd19d" args="" -->MODE_SEPARATE_RESTART</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2d7d16a6771b465726c774ca18dc639da59ac418e6adf6d90de6eaa305dbdfed4"></a><!-- doxytag: member="MODE_PHASED_ZEBRA_RESTART" ref="a2d7d16a6771b465726c774ca18dc639da59ac418e6adf6d90de6eaa305dbdfed4" args="" -->MODE_PHASED_ZEBRA_RESTART</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2d7d16a6771b465726c774ca18dc639da88749ab4e93d56fac47580244e170b05"></a><!-- doxytag: member="MODE_PHASED_ALL_RESTART" ref="a2d7d16a6771b465726c774ca18dc639da88749ab4e93d56fac47580244e170b05" args="" -->MODE_PHASED_ALL_RESTART</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00063">63</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639daff82e266ad97e1f6b0536947534b9db1">MODE_MONITOR</a> = 0,
  <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da10a238369099481dca5e44d95b55076d">MODE_GLOBAL_RESTART</a>,
  <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639dadaa0f184c31c44f5f393f09b472dd19d">MODE_SEPARATE_RESTART</a>,
  <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da59ac418e6adf6d90de6eaa305dbdfed4">MODE_PHASED_ZEBRA_RESTART</a>,
  <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da88749ab4e93d56fac47580244e170b05">MODE_PHASED_ALL_RESTART</a>
} <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639d">watch_mode_t</a>;
</pre></div>
</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a41f7caca64f819bbd7134cbd20ac2098"></a><!-- doxytag: member="watchquagga.c::check_connect" ref="a41f7caca64f819bbd7134cbd20ac2098" args="(struct thread *t_write)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int check_connect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>t_write</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00689">689</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structdaemon.html">daemon</a> *dmn = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a>(t_write);
  <span class="keywordtype">int</span> sockerr;
  <a class="code" href="zebra_8h.html#a6b82106923cc13b3a9734520ecc29514">socklen_t</a> reslen = <span class="keyword">sizeof</span>(sockerr);

  dmn-&gt;<a class="code" href="structdaemon.html#a87626d3568f735b3d920a70d8215ef3f">t_write</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keywordflow">if</span> (getsockopt(dmn-&gt;<a class="code" href="structdaemon.html#a3542d9daecabffc92a567be4b8966a40">fd</a>,SOL_SOCKET,SO_ERROR,(<span class="keywordtype">char</span> *)&amp;sockerr,&amp;reslen) &lt; 0)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a>(<span class="stringliteral">&quot;%s: check_connect: getsockopt failed: %s&quot;</span>,
            dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>,<a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a>(errno));
      <a class="code" href="watchquagga_8c.html#a2dee993c9ca79cff47ffdb2460953bb2">daemon_down</a>(dmn,<span class="stringliteral">&quot;getsockopt failed checking connection success&quot;</span>);
      <span class="keywordflow">return</span> 0;
    }
  <span class="keywordflow">if</span> ((reslen == <span class="keyword">sizeof</span>(sockerr)) &amp;&amp; sockerr)
    {
      <span class="keywordtype">char</span> why[100];
      <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a>(why,<span class="keyword">sizeof</span>(why),
           <span class="stringliteral">&quot;getsockopt reports that connection attempt failed: %s&quot;</span>,
           <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a>(sockerr));
      <a class="code" href="watchquagga_8c.html#a2dee993c9ca79cff47ffdb2460953bb2">daemon_down</a>(dmn,why);
      <span class="keywordflow">return</span> 0;
    }

  <a class="code" href="watchquagga_8c.html#adc676d395fc4b1fe2adcad8c505eda09">daemon_up</a>(dmn,<span class="stringliteral">&quot;delayed connect succeeded&quot;</span>);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2dee993c9ca79cff47ffdb2460953bb2"></a><!-- doxytag: member="watchquagga.c::daemon_down" ref="a2dee993c9ca79cff47ffdb2460953bb2" args="(struct daemon *dmn, const char *why)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void daemon_down </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdaemon.html">daemon</a> *&#160;</td>
          <td class="paramname"><em>dmn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>why</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00576">576</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#a4e0c264b87680b3b88c43526a082b12e">IS_UP</a>(dmn) || (dmn-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a> == <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a92e10d588126a0f8066b9dd18f2f90f6">DAEMON_INIT</a>))
    <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;%s state -&gt; down : %s&quot;</span>,dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>,why);
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a> &gt; LOG_DEBUG)
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>(<span class="stringliteral">&quot;%s still down : %s&quot;</span>,dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>,why);
  <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#a4e0c264b87680b3b88c43526a082b12e">IS_UP</a>(dmn))
    <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a86a9f6cb40c4f333bbf65cc5edfbb5b3">numdown</a>++;
  dmn-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a> = <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a0ec7be6d84eb71cf7d575b2a53d8ddce">DAEMON_DOWN</a>;
  <span class="keywordflow">if</span> (dmn-&gt;<a class="code" href="structdaemon.html#a3542d9daecabffc92a567be4b8966a40">fd</a> &gt;= 0)
    {
      close(dmn-&gt;<a class="code" href="structdaemon.html#a3542d9daecabffc92a567be4b8966a40">fd</a>);
      dmn-&gt;<a class="code" href="structdaemon.html#a3542d9daecabffc92a567be4b8966a40">fd</a> = -1;
    }
  <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a>(dmn-&gt;<a class="code" href="structdaemon.html#aaa14e26823f29ef1575160c5cc7c1726">t_read</a>);
  <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a>(dmn-&gt;<a class="code" href="structdaemon.html#a87626d3568f735b3d920a70d8215ef3f">t_write</a>);
  <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a>(dmn-&gt;<a class="code" href="structdaemon.html#afd4798b097eebc4eb76552af259db02e">t_wakeup</a>);
  <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#af11b57b4da019de6d555b11a73ff1dd3">try_connect</a>(dmn) &lt; 0)
    <a class="code" href="watchquagga_8c.html#a3f4208a945dd2e77f915f9b7cbb77803">SET_WAKEUP_DOWN</a>(dmn);
  <a class="code" href="watchquagga_8c.html#af892b970a62c4640caf2ec4d9ef7dc40">phase_check</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="adc676d395fc4b1fe2adcad8c505eda09"></a><!-- doxytag: member="watchquagga.c::daemon_up" ref="adc676d395fc4b1fe2adcad8c505eda09" args="(struct daemon *dmn, const char *why)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void daemon_up </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdaemon.html">daemon</a> *&#160;</td>
          <td class="paramname"><em>dmn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>why</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00677">677</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  dmn-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a> = <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a1be09914c1c6bf9825ef80fb681ee2ec">DAEMON_UP</a>;
  <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a86a9f6cb40c4f333bbf65cc5edfbb5b3">numdown</a>--;
  dmn-&gt;<a class="code" href="structdaemon.html#a20eb3de9e79ed801c2d430fd8531f469">connect_tries</a> = 0;
  <a class="code" href="log_8h.html#a2fcbf88ea2e5eb71befdbdb4a3f1474f">zlog_notice</a>(<span class="stringliteral">&quot;%s state -&gt; up : %s&quot;</span>,dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>,why);
  <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a45558c9d21a312b8fc39c91a1949389b">do_ping</a>)
    <a class="code" href="watchquagga_8c.html#a86108789f08240f7d0fc965bfe9a7bbf">SET_WAKEUP_ECHO</a>(dmn);
  <a class="code" href="watchquagga_8c.html#af892b970a62c4640caf2ec4d9ef7dc40">phase_check</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad1e38d2596f500ffef6fec5a9f63231c"></a><!-- doxytag: member="watchquagga.c::find_child" ref="ad1e38d2596f500ffef6fec5a9f63231c" args="(pid_t child)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structrestart__info.html">restart_info</a>* find_child </td>
          <td>(</td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>child</em></td><td>)</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00395">395</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> == <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da10a238369099481dca5e44d95b55076d">MODE_GLOBAL_RESTART</a>)
    {
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ae5d3312fd823496cf937a0dd53a4c1b7">restart</a>.<a class="code" href="structrestart__info.html#abe55f773030d03c53430f97ffbcbc9f8">pid</a> == child)
        <span class="keywordflow">return</span> &amp;<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ae5d3312fd823496cf937a0dd53a4c1b7">restart</a>;
    }
  <span class="keywordflow">else</span>
    {
      <span class="keyword">struct </span><a class="code" href="structdaemon.html">daemon</a> *dmn;
      <span class="keywordflow">for</span> (dmn = <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a104a4cbe6fb91bf4013aa6df0f11fcfa">daemons</a>; dmn; dmn = dmn-&gt;<a class="code" href="structdaemon.html#a702d305af420a44b6ac4019b03788d7b">next</a>)
        {
      <span class="keywordflow">if</span> (dmn-&gt;<a class="code" href="structdaemon.html#acfb8cb0345bfb642e1d41f686cc21f83">restart</a>.<a class="code" href="structrestart__info.html#abe55f773030d03c53430f97ffbcbc9f8">pid</a> == child)
        <span class="keywordflow">return</span> &amp;dmn-&gt;<a class="code" href="structdaemon.html#acfb8cb0345bfb642e1d41f686cc21f83">restart</a>;
        }
    }
  <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a24ffcd6d1835e1e4b0f70c7e259c0db7"></a><!-- doxytag: member="watchquagga.c::handle_read" ref="a24ffcd6d1835e1e4b0f70c7e259c0db7" args="(struct thread *t_read)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int handle_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>t_read</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00599">599</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structdaemon.html">daemon</a> *dmn = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a>(t_read);
  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> resp[<span class="keyword">sizeof</span>(<a class="code" href="watchquagga_8c.html#abc0f87853cfbb9f46572c6f4ea34f591">PING_TOKEN</a>)+4] = <a class="code" href="watchquagga_8c.html#abc0f87853cfbb9f46572c6f4ea34f591">PING_TOKEN</a> <span class="stringliteral">&quot;\n&quot;</span>;
  <span class="keywordtype">char</span> buf[<span class="keyword">sizeof</span>(resp)+100];
  ssize_t rc;
  <span class="keyword">struct </span>timeval delay;

  dmn-&gt;<a class="code" href="structdaemon.html#aaa14e26823f29ef1575160c5cc7c1726">t_read</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keywordflow">if</span> ((rc = read(dmn-&gt;<a class="code" href="structdaemon.html#a3542d9daecabffc92a567be4b8966a40">fd</a>,buf,<span class="keyword">sizeof</span>(buf))) &lt; 0)
    {
      <span class="keywordtype">char</span> why[100];

      <span class="keywordflow">if</span> (<a class="code" href="network_8h.html#a45b38a31650d3cee8087360351384d9e">ERRNO_IO_RETRY</a>(errno))
    {
      <span class="comment">/* Pretend it never happened. */</span>
      <a class="code" href="watchquagga_8c.html#aad9410fad46db274da2408cc6efbd681">SET_READ_HANDLER</a>(dmn);
      <span class="keywordflow">return</span> 0;
    }
      <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a>(why,<span class="keyword">sizeof</span>(why),<span class="stringliteral">&quot;unexpected read error: %s&quot;</span>,
           <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a>(errno));
      <a class="code" href="watchquagga_8c.html#a2dee993c9ca79cff47ffdb2460953bb2">daemon_down</a>(dmn,why);
      <span class="keywordflow">return</span> 0;
    }
  <span class="keywordflow">if</span> (rc == 0)
    {
      <a class="code" href="watchquagga_8c.html#a2dee993c9ca79cff47ffdb2460953bb2">daemon_down</a>(dmn,<span class="stringliteral">&quot;read returned EOF&quot;</span>);
      <span class="keywordflow">return</span> 0;
    }
  <span class="keywordflow">if</span> (!dmn-&gt;<a class="code" href="structdaemon.html#aecbec7a86985b13493216cdfd690850f">echo_sent</a>.tv_sec)
    {
      <span class="keywordtype">char</span> why[<span class="keyword">sizeof</span>(buf)+100];
      <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a>(why,<span class="keyword">sizeof</span>(why),<span class="stringliteral">&quot;unexpected read returns %d bytes: %.*s&quot;</span>,
           (<span class="keywordtype">int</span>)rc,(<span class="keywordtype">int</span>)rc,buf);
      <a class="code" href="watchquagga_8c.html#a2dee993c9ca79cff47ffdb2460953bb2">daemon_down</a>(dmn,why);
      <span class="keywordflow">return</span> 0;
    }

  <span class="comment">/* We are expecting an echo response: is there any chance that the</span>
<span class="comment">     response would not be returned entirely in the first read?  That</span>
<span class="comment">     seems inconceivable... */</span>
  <span class="keywordflow">if</span> ((rc != <span class="keyword">sizeof</span>(resp)) || <a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a>(buf,resp,<span class="keyword">sizeof</span>(resp)))
    {
      <span class="keywordtype">char</span> why[100+<span class="keyword">sizeof</span>(buf)];
      <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a>(why,<span class="keyword">sizeof</span>(why),<span class="stringliteral">&quot;read returned bad echo response of %d bytes &quot;</span>
                   <span class="stringliteral">&quot;(expecting %u): %.*s&quot;</span>,
           (<span class="keywordtype">int</span>)rc,(u_int)<span class="keyword">sizeof</span>(resp),(<span class="keywordtype">int</span>)rc,buf);
      <a class="code" href="watchquagga_8c.html#a2dee993c9ca79cff47ffdb2460953bb2">daemon_down</a>(dmn,why);
      <span class="keywordflow">return</span> 0;
    }

  <a class="code" href="watchquagga_8c.html#a79bb4fa30cfacd7831e1bec08147c6ab">time_elapsed</a>(&amp;delay,&amp;dmn-&gt;<a class="code" href="structdaemon.html#aecbec7a86985b13493216cdfd690850f">echo_sent</a>);
  dmn-&gt;<a class="code" href="structdaemon.html#aecbec7a86985b13493216cdfd690850f">echo_sent</a>.tv_sec = 0;
  <span class="keywordflow">if</span> (dmn-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a> == <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a275085ab09194304efb7f479f7b49232">DAEMON_UNRESPONSIVE</a>)
    {
      <span class="keywordflow">if</span> (delay.tv_sec &lt; <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ad5605522165f6b1c78e6ebab05ccd391">timeout</a>)
    {
      dmn-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a> = <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a1be09914c1c6bf9825ef80fb681ee2ec">DAEMON_UP</a>;
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a>(<span class="stringliteral">&quot;%s state -&gt; up : echo response received after %ld.%06ld &quot;</span>
            <span class="stringliteral">&quot;seconds&quot;</span>, dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>,delay.tv_sec,delay.tv_usec);
    }
      <span class="keywordflow">else</span>
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a>(<span class="stringliteral">&quot;%s: slow echo response finally received after %ld.%06ld &quot;</span>
          <span class="stringliteral">&quot;seconds&quot;</span>, dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>,delay.tv_sec,delay.tv_usec);
    }
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a> &gt; LOG_DEBUG+1)
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>(<span class="stringliteral">&quot;%s: echo response received after %ld.%06ld seconds&quot;</span>,
           dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>,delay.tv_sec,delay.tv_usec);

  <a class="code" href="watchquagga_8c.html#aad9410fad46db274da2408cc6efbd681">SET_READ_HANDLER</a>(dmn);
  <span class="keywordflow">if</span> (dmn-&gt;<a class="code" href="structdaemon.html#afd4798b097eebc4eb76552af259db02e">t_wakeup</a>)
    <a class="code" href="thread_8c.html#aceb89c1157b6a1d8bb3afa5021f1ab6d">thread_cancel</a>(dmn-&gt;<a class="code" href="structdaemon.html#afd4798b097eebc4eb76552af259db02e">t_wakeup</a>);
  <a class="code" href="watchquagga_8c.html#a86108789f08240f7d0fc965bfe9a7bbf">SET_WAKEUP_ECHO</a>(dmn);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3c04138a5bfe5d72780bb7e82a18e627"></a><!-- doxytag: member="watchquagga.c::main" ref="a3c04138a5bfe5d72780bb7e82a18e627" args="(int argc, char **argv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l01029">1029</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="isis__main_8c.html#ab9e1449fd00c98428516f0b41eddcb10">progname</a>;
  <span class="keywordtype">int</span> opt;
  <span class="keywordtype">int</span> <a class="code" href="isis__main_8c.html#a4255d3efd1474d8e9d267e4b1559c1f9">daemon_mode</a> = 0;
  <span class="keyword">const</span> <span class="keywordtype">char</span> *pidfile = <a class="code" href="watchquagga_8c.html#a108b7f06d065ce9a1087cc8ffbd481c2">DEFAULT_PIDFILE</a>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> *special = <span class="stringliteral">&quot;zebra&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> *blankstr = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structquagga__signal__t.html">quagga_signal_t</a> my_signals[] =
  {
    {
      .<a class="code" href="structquagga__signal__t.html#a3287dfb3c5c31bdd6edba16891faa265">signal</a> = SIGINT,
      .handler = <a class="code" href="bgp__main_8c.html#a3028bbc8ee1e04b72a2ef7fdaad1d71e">sigint</a>,
    },
    {
      .signal = SIGTERM,
      .handler = <a class="code" href="bgp__main_8c.html#a3028bbc8ee1e04b72a2ef7fdaad1d71e">sigint</a>,
    },
    {
      .signal = SIGCHLD,
      .handler = <a class="code" href="watchquagga_8c.html#afb0f8b8f3f52afd07bd6fb5793b999c4">sigchild</a>,
    },
  };

  <span class="keywordflow">if</span> ((progname = strrchr (argv[0], <span class="charliteral">&#39;/&#39;</span>)) != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    progname++;
  <span class="keywordflow">else</span>
    progname = argv[0];

  <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ae5d3312fd823496cf937a0dd53a4c1b7">restart</a>.<a class="code" href="structrestart__info.html#a2b3c824d6724befab51b9d208ba745a4">name</a> = <span class="stringliteral">&quot;all&quot;</span>;
  <span class="keywordflow">while</span> ((opt = <a class="code" href="getopt_8h.html#a8616b8a74ae6c01a7ad95ad2876226ec">getopt_long</a>(argc, argv, <span class="stringliteral">&quot;aAb:dek:l:m:M:i:p:r:R:S:s:t:T:zvh&quot;</span>,
                <a class="code" href="bgp__main_8c.html#a94965649155359a4c4eb047af782bf22">longopts</a>, 0)) != EOF)
    {
      <span class="keywordflow">switch</span> (opt)
        {
    <span class="keywordflow">case</span> 0:
      <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:
      <span class="keywordflow">if</span> ((<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> != <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639daff82e266ad97e1f6b0536947534b9db1">MODE_MONITOR</a>) &amp;&amp; (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> != <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639dadaa0f184c31c44f5f393f09b472dd19d">MODE_SEPARATE_RESTART</a>))
        {
          fputs(<span class="stringliteral">&quot;Ambiguous operating mode selected.\n&quot;</span>,stderr);
          <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
        }
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> = <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da59ac418e6adf6d90de6eaa305dbdfed4">MODE_PHASED_ZEBRA_RESTART</a>;
      <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:
      <span class="keywordflow">if</span> ((<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> != <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639daff82e266ad97e1f6b0536947534b9db1">MODE_MONITOR</a>) &amp;&amp; (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> != <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639dadaa0f184c31c44f5f393f09b472dd19d">MODE_SEPARATE_RESTART</a>))
        {
          fputs(<span class="stringliteral">&quot;Ambiguous operating mode selected.\n&quot;</span>,stderr);
          <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
        }
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> = <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da88749ab4e93d56fac47580244e170b05">MODE_PHASED_ALL_RESTART</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:
      blankstr = <a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>;
      <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:
      daemon_mode = 1;
      <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a45558c9d21a312b8fc39c91a1949389b">do_ping</a> = 0;
      <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <span class="charliteral">&#39;k&#39;</span>:
      <span class="keywordflow">if</span> (!<a class="code" href="watchquagga_8c.html#a72ce6b2c5071c2fae3cc7d61f559502b">valid_command</a>(<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>))
      {
        fprintf(stderr,<span class="stringliteral">&quot;Invalid kill command, must contain &#39;%%s&#39;: %s\n&quot;</span>,
            <a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>);
        <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
      }
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#accfc2ab01009040ec7974d383211213e">stop_command</a> = <a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:
      {
        <span class="keywordtype">char</span> garbage[3];
        <span class="keywordflow">if</span> ((sscanf(<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>,<span class="stringliteral">&quot;%d%1s&quot;</span>,&amp;<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a>,garbage) != 1) ||
            (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a> &lt; LOG_EMERG))
          {
            fprintf(stderr,<span class="stringliteral">&quot;Invalid loglevel argument: %s\n&quot;</span>,<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>);
        <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
          }
      }
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:
      {
        <span class="keywordtype">char</span> garbage[3];
        <span class="keywordflow">if</span> ((sscanf(<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>,<span class="stringliteral">&quot;%ld%1s&quot;</span>,
                &amp;<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a56523bed8eb4d3aaba1b92c4f5487749">min_restart_interval</a>,garbage) != 1) ||
            (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a56523bed8eb4d3aaba1b92c4f5487749">min_restart_interval</a> &lt; 0))
          {
            fprintf(stderr,<span class="stringliteral">&quot;Invalid min_restart_interval argument: %s\n&quot;</span>,
                <a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>);
        <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
          }
      }
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <span class="charliteral">&#39;M&#39;</span>:
      {
        <span class="keywordtype">char</span> garbage[3];
        <span class="keywordflow">if</span> ((sscanf(<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>,<span class="stringliteral">&quot;%ld%1s&quot;</span>,
                &amp;<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abbea16b7eed0f8bb8ca6e16a3d24ba4f">max_restart_interval</a>,garbage) != 1) ||
            (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abbea16b7eed0f8bb8ca6e16a3d24ba4f">max_restart_interval</a> &lt; 0))
          {
            fprintf(stderr,<span class="stringliteral">&quot;Invalid max_restart_interval argument: %s\n&quot;</span>,
                <a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>);
        <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
          }
      }
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:
      {
        <span class="keywordtype">char</span> garbage[3];
        <span class="keywordtype">int</span> period;
        <span class="keywordflow">if</span> ((sscanf(<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>,<span class="stringliteral">&quot;%d%1s&quot;</span>,&amp;period,garbage) != 1) ||
            (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a42da62a70b72aef10271d714a63ba606">period</a> &lt; 1))
          {
            fprintf(stderr,<span class="stringliteral">&quot;Invalid interval argument: %s\n&quot;</span>,<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>);
        <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
          }
        <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a42da62a70b72aef10271d714a63ba606">period</a> = 1000*period;
      }
      <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:
      pidfile = <a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>;
      <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:
      <span class="keywordflow">if</span> ((<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> == <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da10a238369099481dca5e44d95b55076d">MODE_GLOBAL_RESTART</a>) ||
          (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> == <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639dadaa0f184c31c44f5f393f09b472dd19d">MODE_SEPARATE_RESTART</a>))
        {
          fputs(<span class="stringliteral">&quot;Ambiguous operating mode selected.\n&quot;</span>,stderr);
          <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
        }
      <span class="keywordflow">if</span> (!<a class="code" href="watchquagga_8c.html#a72ce6b2c5071c2fae3cc7d61f559502b">valid_command</a>(<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>))
      {
        fprintf(stderr,
            <span class="stringliteral">&quot;Invalid restart command, must contain &#39;%%s&#39;: %s\n&quot;</span>,
            <a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>);
        <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
      }
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#af20cc377ff8e04eb957ce9b4545e00c4">restart_command</a> = <a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>;
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> == <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639daff82e266ad97e1f6b0536947534b9db1">MODE_MONITOR</a>)
        <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> = <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639dadaa0f184c31c44f5f393f09b472dd19d">MODE_SEPARATE_RESTART</a>;
      <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <span class="charliteral">&#39;R&#39;</span>:
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> != <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639daff82e266ad97e1f6b0536947534b9db1">MODE_MONITOR</a>)
        {
          fputs(<span class="stringliteral">&quot;Ambiguous operating mode selected.\n&quot;</span>,stderr);
          <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
        }
      <span class="keywordflow">if</span> (strchr(<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>,<span class="charliteral">&#39;%&#39;</span>))
        {
          fprintf(stderr,
              <span class="stringliteral">&quot;Invalid restart-all arg, must not contain &#39;%%s&#39;: %s\n&quot;</span>,
              <a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>);
          <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
        }
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#af20cc377ff8e04eb957ce9b4545e00c4">restart_command</a> = <a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>;
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> = <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da10a238369099481dca5e44d95b55076d">MODE_GLOBAL_RESTART</a>;
      <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:
      <span class="keywordflow">if</span> (!<a class="code" href="watchquagga_8c.html#a72ce6b2c5071c2fae3cc7d61f559502b">valid_command</a>(<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>))
      {
        fprintf(stderr,<span class="stringliteral">&quot;Invalid start command, must contain &#39;%%s&#39;: %s\n&quot;</span>,
            <a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>);
        <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
      }
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ac04d8bac169679b5c511c199333783ef">start_command</a> = <a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>:
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a6cad3336e001d272b61b9d52bcecc9ce">vtydir</a> = <a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:
      {
        <span class="keywordtype">char</span> garbage[3];
        <span class="keywordflow">if</span> ((sscanf(<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>,<span class="stringliteral">&quot;%ld%1s&quot;</span>,&amp;<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ad5605522165f6b1c78e6ebab05ccd391">timeout</a>,garbage) != 1) ||
            (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ad5605522165f6b1c78e6ebab05ccd391">timeout</a> &lt; 1))
          {
            fprintf(stderr,<span class="stringliteral">&quot;Invalid timeout argument: %s\n&quot;</span>,<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>);
        <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
          }
      }
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <span class="charliteral">&#39;T&#39;</span>:
      {
        <span class="keywordtype">char</span> garbage[3];
        <span class="keywordflow">if</span> ((sscanf(<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>,<span class="stringliteral">&quot;%ld%1s&quot;</span>,&amp;<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5fb22d967ccfda0f9342572d35859b60">restart_timeout</a>,garbage) != 1) ||
            (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5fb22d967ccfda0f9342572d35859b60">restart_timeout</a> &lt; 1))
          {
            fprintf(stderr,<span class="stringliteral">&quot;Invalid restart timeout argument: %s\n&quot;</span>,<a class="code" href="getopt_8c.html#adb50a0eab9fed92fc3bfc7dfa4f2c410">optarg</a>);
        <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
          }
      }
      <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <span class="charliteral">&#39;z&#39;</span>:
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#aa9865e52cbc935f0d1188b4451b0494f">unresponsive_restart</a> = 1;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:
      printf (<span class="stringliteral">&quot;%s version %s\n&quot;</span>, progname, <a class="code" href="version_8h.html#a47310a38938bb82f0c5b9ad133443852">QUAGGA_VERSION</a>);
      puts(<span class="stringliteral">&quot;Copyright 2004 Andrew J. Schorr&quot;</span>);
      <span class="keywordflow">return</span> 0;
        <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:
      <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,0);
        <span class="keywordflow">default</span>:
      fputs(<span class="stringliteral">&quot;Invalid option.\n&quot;</span>,stderr);
      <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
        }
    }
  
  <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#aa9865e52cbc935f0d1188b4451b0494f">unresponsive_restart</a> &amp;&amp; (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> == <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639daff82e266ad97e1f6b0536947534b9db1">MODE_MONITOR</a>))
    {
      fputs(<span class="stringliteral">&quot;Option -z requires a -r or -R restart option.\n&quot;</span>,stderr);
      <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
    }
  <span class="keywordflow">switch</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a>)
    {
    <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639daff82e266ad97e1f6b0536947534b9db1">MODE_MONITOR</a>:
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#af20cc377ff8e04eb957ce9b4545e00c4">restart_command</a> || <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ac04d8bac169679b5c511c199333783ef">start_command</a> || <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#accfc2ab01009040ec7974d383211213e">stop_command</a>)
        {
      fprintf(stderr,<span class="stringliteral">&quot;No kill/(re)start commands needed for %s mode.\n&quot;</span>,
          <a class="code" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a>]);
      <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
    }
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da10a238369099481dca5e44d95b55076d">MODE_GLOBAL_RESTART</a>:
    <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639dadaa0f184c31c44f5f393f09b472dd19d">MODE_SEPARATE_RESTART</a>:
      <span class="keywordflow">if</span> (!<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#af20cc377ff8e04eb957ce9b4545e00c4">restart_command</a> || <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ac04d8bac169679b5c511c199333783ef">start_command</a> || <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#accfc2ab01009040ec7974d383211213e">stop_command</a>)
        {
      fprintf(stderr,<span class="stringliteral">&quot;No start/kill commands needed in [%s] mode.\n&quot;</span>,
          <a class="code" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a>]);
      <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
    }
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da59ac418e6adf6d90de6eaa305dbdfed4">MODE_PHASED_ZEBRA_RESTART</a>:
    <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da88749ab4e93d56fac47580244e170b05">MODE_PHASED_ALL_RESTART</a>:
      <span class="keywordflow">if</span> (!<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#af20cc377ff8e04eb957ce9b4545e00c4">restart_command</a> || !<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ac04d8bac169679b5c511c199333783ef">start_command</a> || !<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#accfc2ab01009040ec7974d383211213e">stop_command</a>)
        {
      fprintf(stderr,
          <span class="stringliteral">&quot;Need start, kill, and restart commands in [%s] mode.\n&quot;</span>,
          <a class="code" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a>]);
      <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
    }
      <span class="keywordflow">break</span>;
    }

  <span class="keywordflow">if</span> (blankstr)
    {
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#af20cc377ff8e04eb957ce9b4545e00c4">restart_command</a>)
        <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#af20cc377ff8e04eb957ce9b4545e00c4">restart_command</a> = <a class="code" href="watchquagga_8c.html#a368996dc1c464c40bfd40dab47efad45">translate_blanks</a>(<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#af20cc377ff8e04eb957ce9b4545e00c4">restart_command</a>,blankstr);
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ac04d8bac169679b5c511c199333783ef">start_command</a>)
        <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ac04d8bac169679b5c511c199333783ef">start_command</a> = <a class="code" href="watchquagga_8c.html#a368996dc1c464c40bfd40dab47efad45">translate_blanks</a>(<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ac04d8bac169679b5c511c199333783ef">start_command</a>,blankstr);
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#accfc2ab01009040ec7974d383211213e">stop_command</a>)
        <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#accfc2ab01009040ec7974d383211213e">stop_command</a> = <a class="code" href="watchquagga_8c.html#a368996dc1c464c40bfd40dab47efad45">translate_blanks</a>(<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#accfc2ab01009040ec7974d383211213e">stop_command</a>,blankstr);
    }
      
  <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ae5d3312fd823496cf937a0dd53a4c1b7">restart</a>.<a class="code" href="structrestart__info.html#a9ef91309464ce22b14881987fab3c32f">interval</a> = <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a56523bed8eb4d3aaba1b92c4f5487749">min_restart_interval</a>;
  <a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a> = <a class="code" href="thread_8c.html#a6d9de673f4874d0c6b7f6a84b2e0e9cf">thread_master_create</a>();
  <a class="code" href="sigevent_8c.html#a715b48c4a10aeaff0a38a822e6888c3e">signal_init</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="sigevent_8h.html#a4728c7c7b9bd1ad2a4d36727afb35022">Q_SIGC</a>(my_signals), my_signals);
  srandom(time(<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));

  {
    <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
    <span class="keyword">struct </span><a class="code" href="structdaemon.html">daemon</a> *tail = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

    <span class="keywordflow">for</span> (i = <a class="code" href="getopt_8c.html#ad5e1c16213bbee2d5e8cc363309f418c">optind</a>; i &lt; argc; i++)
      {
    <span class="keyword">struct </span><a class="code" href="structdaemon.html">daemon</a> *dmn;

    <span class="keywordflow">if</span> (!(dmn = (<span class="keyword">struct</span> <a class="code" href="structdaemon.html">daemon</a> *)calloc(1,<span class="keyword">sizeof</span>(*dmn))))
      {
        fprintf(stderr,<span class="stringliteral">&quot;calloc(1,%u) failed: %s\n&quot;</span>,
            (u_int)<span class="keyword">sizeof</span>(*dmn), <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a>(errno));
        <span class="keywordflow">return</span> 1;
      }
    dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a> = dmn-&gt;<a class="code" href="structdaemon.html#acfb8cb0345bfb642e1d41f686cc21f83">restart</a>.<a class="code" href="structrestart__info.html#a2b3c824d6724befab51b9d208ba745a4">name</a> = argv[<a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>];
    dmn-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a> = <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a92e10d588126a0f8066b9dd18f2f90f6">DAEMON_INIT</a>;
    <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a8c3ffb8fa696d43b1f97e7a0852c0f5a">numdaemons</a>++;
    <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a86a9f6cb40c4f333bbf65cc5edfbb5b3">numdown</a>++;
    dmn-&gt;<a class="code" href="structdaemon.html#a3542d9daecabffc92a567be4b8966a40">fd</a> = -1;
    dmn-&gt;<a class="code" href="structdaemon.html#afd4798b097eebc4eb76552af259db02e">t_wakeup</a> = <a class="code" href="thread_8h.html#a9231be4b08f04f6ebc1bea080443ba74">thread_add_timer_msec</a>(<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>,<a class="code" href="watchquagga_8c.html#a20a45d7c8bed8569a2cbeba4747461ee">wakeup_init</a>,dmn,
                          100+(random() % 900));
    dmn-&gt;<a class="code" href="structdaemon.html#acfb8cb0345bfb642e1d41f686cc21f83">restart</a>.<a class="code" href="structrestart__info.html#a9ef91309464ce22b14881987fab3c32f">interval</a> = <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a56523bed8eb4d3aaba1b92c4f5487749">min_restart_interval</a>;
    <span class="keywordflow">if</span> (tail)
      tail-&gt;<a class="code" href="structdaemon.html#a702d305af420a44b6ac4019b03788d7b">next</a> = dmn;
    <span class="keywordflow">else</span>
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a104a4cbe6fb91bf4013aa6df0f11fcfa">daemons</a> = dmn;
    tail = dmn;

    <span class="keywordflow">if</span> (((<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> == <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da59ac418e6adf6d90de6eaa305dbdfed4">MODE_PHASED_ZEBRA_RESTART</a>) ||
         (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> == <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da88749ab4e93d56fac47580244e170b05">MODE_PHASED_ALL_RESTART</a>)) &amp;&amp;
        !strcmp(dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>,special))
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a> = dmn;
      }
  }
  <span class="keywordflow">if</span> (!<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a104a4cbe6fb91bf4013aa6df0f11fcfa">daemons</a>)
    {
      fputs(<span class="stringliteral">&quot;Must specify one or more daemons to monitor.\n&quot;</span>,stderr);
      <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
    }
  <span class="keywordflow">if</span> (((<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> == <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da59ac418e6adf6d90de6eaa305dbdfed4">MODE_PHASED_ZEBRA_RESTART</a>) ||
      (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a> == <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da88749ab4e93d56fac47580244e170b05">MODE_PHASED_ALL_RESTART</a>)) &amp;&amp; !<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>)
    {
      fprintf(stderr,<span class="stringliteral">&quot;In mode [%s], but cannot find master daemon %s\n&quot;</span>,
          <a class="code" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a>],special);
      <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
    }
  <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a> &amp;&amp; (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a8c3ffb8fa696d43b1f97e7a0852c0f5a">numdaemons</a> &lt; 2))
    {
      fprintf(stderr,<span class="stringliteral">&quot;Mode [%s] does not make sense with only 1 daemon &quot;</span>
             <span class="stringliteral">&quot;to watch.\n&quot;</span>,<a class="code" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a>]);
      <span class="keywordflow">return</span> <a class="code" href="bgp__main_8c.html#ab24f62159230cf265fc4d7ddc4c91872">usage</a>(progname,1);
    }

  <a class="code" href="log_8c.html#a69cba84b9cc9c438ad5f5b1379b702b5">zlog_default</a> = <a class="code" href="log_8c.html#a0e29a4e0e59d1fdbff2aab49e067b501">openzlog</a>(progname, <a class="code" href="log_8h.html#a7191b9759b28b288102a2c6dd41e20a3aa158dd67301a680e9877c00efbb01c35">ZLOG_NONE</a>,
              LOG_CONS|LOG_NDELAY|LOG_PID, LOG_DAEMON);
  <a class="code" href="log_8c.html#a8ef98c8a7cd8474e0570a342208b7cfb">zlog_set_level</a>(<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="log_8h.html#a73f647b113a31234b2acdc6979aa37afad7c519b6be9a085d26f764f00a6e3c72">ZLOG_DEST_MONITOR</a>, <a class="code" href="log_8h.html#a4881df705c4665936da19cea6623685e">ZLOG_DISABLED</a>);
  <span class="keywordflow">if</span> (daemon_mode)
    {
      <a class="code" href="log_8c.html#a8ef98c8a7cd8474e0570a342208b7cfb">zlog_set_level</a>(<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="log_8h.html#a73f647b113a31234b2acdc6979aa37afa0b23cfb9b02e22f2606823361d397ef4">ZLOG_DEST_SYSLOG</a>, <a class="code" href="regex_8c.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a>,LOG_DEBUG));
      <span class="keywordflow">if</span> (<a class="code" href="structdaemon.html">daemon</a> (0, 0) &lt; 0)
    {
      fprintf(stderr, <span class="stringliteral">&quot;Watchquagga daemon failed: %s&quot;</span>, strerror(errno));
      <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a> (1);
    }
    }
  <span class="keywordflow">else</span>
    <a class="code" href="log_8c.html#a8ef98c8a7cd8474e0570a342208b7cfb">zlog_set_level</a>(<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="log_8h.html#a73f647b113a31234b2acdc6979aa37afa1883db184dab41d65e03180c1fbed617">ZLOG_DEST_STDOUT</a>, <a class="code" href="regex_8c.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a>,LOG_DEBUG));

  <span class="comment">/* Make sure we&#39;re not already running. */</span>
  <a class="code" href="pid__output_8c.html#ab11a24a9f2adabdcc3ec451dcb976f20">pid_output</a> (pidfile);

  <span class="comment">/* Announce which daemons are being monitored. */</span>
  {
    <span class="keyword">struct </span><a class="code" href="structdaemon.html">daemon</a> *dmn;
    <span class="keywordtype">size_t</span> len = 0;

    <span class="keywordflow">for</span> (dmn = <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a104a4cbe6fb91bf4013aa6df0f11fcfa">daemons</a>; dmn; dmn = dmn-&gt;<a class="code" href="structdaemon.html#a702d305af420a44b6ac4019b03788d7b">next</a>)
      len += strlen(dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>)+1;

    {
      <span class="keywordtype">char</span> buf[len+1];
      <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a> = buf;

      <span class="keywordflow">for</span> (dmn = <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a104a4cbe6fb91bf4013aa6df0f11fcfa">daemons</a>; dmn; dmn = dmn-&gt;<a class="code" href="structdaemon.html#a702d305af420a44b6ac4019b03788d7b">next</a>)
    {
      <span class="keywordflow">if</span> (p != buf)
        *p++ = <span class="charliteral">&#39; &#39;</span>;
      strcpy(p,dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>);
      p += strlen(p);
    }
      <a class="code" href="log_8h.html#a2fcbf88ea2e5eb71befdbdb4a3f1474f">zlog_notice</a>(<span class="stringliteral">&quot;%s %s watching [%s], mode [%s]&quot;</span>,
              progname, <a class="code" href="version_8h.html#a47310a38938bb82f0c5b9ad133443852">QUAGGA_VERSION</a>, buf, <a class="code" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a>]);
    }
  }

  {
    <span class="keyword">struct </span><a class="code" href="structthread.html">thread</a> <a class="code" href="structthread.html">thread</a>;

    <span class="keywordflow">while</span> (<a class="code" href="thread_8c.html#a1674b380ab1baf464b4f541c0a938656">thread_fetch</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, &amp;<a class="code" href="structthread.html">thread</a>))
      <a class="code" href="thread_8c.html#aebb1b7a2cf2a872d69ab8c1e6f788744">thread_call</a> (&amp;<a class="code" href="structthread.html">thread</a>);
  }

  <span class="comment">/* Not reached. */</span>
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af892b970a62c4640caf2ec4d9ef7dc40"></a><!-- doxytag: member="watchquagga.c::phase_check" ref="af892b970a62c4640caf2ec4d9ef7dc40" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void phase_check </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00825">825</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">switch</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a55de65524793e810dc972e6086965b70">phase</a>)
    {
    <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a61e900515aec51ba22cfdd63c1082fc7">PHASE_NONE</a>:
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430af979eabf3440749d3ff3ef7fbb5c1f78">PHASE_STOPS_PENDING</a>:
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a450212f3425150a559b4b66b2f224e74">numpids</a>)
    <span class="keywordflow">break</span>;
      <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a>(<span class="stringliteral">&quot;Phased restart: all routing daemon stop jobs have completed.&quot;</span>);
      <a class="code" href="watchquagga_8c.html#afe6e5a642e61fc1a4f7c5b9d243b644e">set_phase</a>(<a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a839919f29423cc27e216f678746abebf">PHASE_WAITING_DOWN</a>);
      <span class="comment">/*FALLTHRU*/</span>
    <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a839919f29423cc27e216f678746abebf">PHASE_WAITING_DOWN</a>:
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a86a9f6cb40c4f333bbf65cc5edfbb5b3">numdown</a>+<a class="code" href="watchquagga_8c.html#a4e0c264b87680b3b88c43526a082b12e">IS_UP</a>(<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>) &lt; <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a8c3ffb8fa696d43b1f97e7a0852c0f5a">numdaemons</a>)
        <span class="keywordflow">break</span>;
      <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a>(<span class="stringliteral">&quot;Phased restart: all routing daemons now down.&quot;</span>);
      <a class="code" href="watchquagga_8c.html#a88a4bd930358f3f0df5b6b7256becc50">run_job</a>(&amp;<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>-&gt;<a class="code" href="structdaemon.html#acfb8cb0345bfb642e1d41f686cc21f83">restart</a>,<span class="stringliteral">&quot;restart&quot;</span>,<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#af20cc377ff8e04eb957ce9b4545e00c4">restart_command</a>,1,1);
      <a class="code" href="watchquagga_8c.html#afe6e5a642e61fc1a4f7c5b9d243b644e">set_phase</a>(<a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a957d64ff81ae79b0264c549b5714a9bc">PHASE_ZEBRA_RESTART_PENDING</a>);
      <span class="comment">/*FALLTHRU*/</span>
    <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a957d64ff81ae79b0264c549b5714a9bc">PHASE_ZEBRA_RESTART_PENDING</a>:
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>-&gt;<a class="code" href="structdaemon.html#acfb8cb0345bfb642e1d41f686cc21f83">restart</a>.<a class="code" href="structrestart__info.html#abe55f773030d03c53430f97ffbcbc9f8">pid</a>)
    <span class="keywordflow">break</span>;
      <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a>(<span class="stringliteral">&quot;Phased restart: %s restart job completed.&quot;</span>,<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>);
      <a class="code" href="watchquagga_8c.html#afe6e5a642e61fc1a4f7c5b9d243b644e">set_phase</a>(<a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a0a5ea50c0e1f43a6981748026fe58208">PHASE_WAITING_ZEBRA_UP</a>);
      <span class="comment">/*FALLTHRU*/</span>
    <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a0a5ea50c0e1f43a6981748026fe58208">PHASE_WAITING_ZEBRA_UP</a>:
      <span class="keywordflow">if</span> (!<a class="code" href="watchquagga_8c.html#a4e0c264b87680b3b88c43526a082b12e">IS_UP</a>(<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>))
        <span class="keywordflow">break</span>;
      <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a>(<span class="stringliteral">&quot;Phased restart: %s is now up.&quot;</span>,<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>);
      {
        <span class="keyword">struct </span><a class="code" href="structdaemon.html">daemon</a> *dmn;
    <span class="keywordflow">for</span> (dmn = <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a104a4cbe6fb91bf4013aa6df0f11fcfa">daemons</a>; dmn; dmn = dmn-&gt;<a class="code" href="structdaemon.html#a702d305af420a44b6ac4019b03788d7b">next</a>)
      {
        <span class="keywordflow">if</span> (dmn != <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>)
          <a class="code" href="watchquagga_8c.html#a88a4bd930358f3f0df5b6b7256becc50">run_job</a>(&amp;dmn-&gt;<a class="code" href="structdaemon.html#acfb8cb0345bfb642e1d41f686cc21f83">restart</a>,<span class="stringliteral">&quot;start&quot;</span>,<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ac04d8bac169679b5c511c199333783ef">start_command</a>,1,0);
      }
      }
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a55de65524793e810dc972e6086965b70">phase</a> = <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a61e900515aec51ba22cfdd63c1082fc7">PHASE_NONE</a>;
      <a class="code" href="thread_8h.html#a7e1de4fc338e4feae498978461742dbb">THREAD_OFF</a>(<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a6fb4a12837f9f5e939e3a1f07c09398c">t_phase_hanging</a>);
      <a class="code" href="log_8h.html#a2fcbf88ea2e5eb71befdbdb4a3f1474f">zlog_notice</a>(<span class="stringliteral">&quot;Phased global restart has completed.&quot;</span>);
      <span class="keywordflow">break</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="afc99643db56e6fa9af56e9ad5f112fb3"></a><!-- doxytag: member="watchquagga.c::phase_hanging" ref="afc99643db56e6fa9af56e9ad5f112fb3" args="(struct thread *t_hanging)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int phase_hanging </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>t_hanging</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00805">805</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a6fb4a12837f9f5e939e3a1f07c09398c">t_phase_hanging</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;Phase [%s] hanging for %ld seconds, aborting phased restart&quot;</span>,
           <a class="code" href="watchquagga_8c.html#aa26a9ffa56c9c4fce0f6dbe9eae8a7ae">phase_str</a>[<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a55de65524793e810dc972e6086965b70">phase</a>],<a class="code" href="watchquagga_8c.html#adf01e890ebef9b526d4b22f2ca5b10ec">PHASE_TIMEOUT</a>);
  <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a55de65524793e810dc972e6086965b70">phase</a> = <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a61e900515aec51ba22cfdd63c1082fc7">PHASE_NONE</a>;
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4b122497788fd6bae49352f1c9d6d6be"></a><!-- doxytag: member="watchquagga.c::restart_kill" ref="a4b122497788fd6bae49352f1c9d6d6be" args="(struct thread *t_kill)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int restart_kill </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>t_kill</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00377">377</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structrestart__info.html">restart_info</a> *restart = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a>(t_kill);
  <span class="keyword">struct </span>timeval delay;

  <a class="code" href="watchquagga_8c.html#a79bb4fa30cfacd7831e1bec08147c6ab">time_elapsed</a>(&amp;delay,&amp;restart-&gt;<a class="code" href="structrestart__info.html#a44a266ccb4d916176de7f3e451fff6ed">time</a>);
  <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a>(<span class="stringliteral">&quot;Warning: %s %s child process %d still running after &quot;</span>
        <span class="stringliteral">&quot;%ld seconds, sending signal %d&quot;</span>,
        restart-&gt;<a class="code" href="structrestart__info.html#a2c2fed49b4e15287ad4421e68f678a2d">what</a>,restart-&gt;<a class="code" href="structrestart__info.html#a2b3c824d6724befab51b9d208ba745a4">name</a>,(<span class="keywordtype">int</span>)restart-&gt;<a class="code" href="structrestart__info.html#abe55f773030d03c53430f97ffbcbc9f8">pid</a>,delay.tv_sec,
        (restart-&gt;<a class="code" href="structrestart__info.html#a8a5dc9a00fd77b39a1839c78c123643c">kills</a> ? SIGKILL : SIGTERM));
  kill(-restart-&gt;<a class="code" href="structrestart__info.html#abe55f773030d03c53430f97ffbcbc9f8">pid</a>,(restart-&gt;<a class="code" href="structrestart__info.html#a8a5dc9a00fd77b39a1839c78c123643c">kills</a> ? SIGKILL : SIGTERM));
  restart-&gt;<a class="code" href="structrestart__info.html#a8a5dc9a00fd77b39a1839c78c123643c">kills</a>++;
  restart-&gt;<a class="code" href="structrestart__info.html#a74ffd0ccc53e39e2e3005471e9dbaa25">t_kill</a> = <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a>(<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>,<a class="code" href="watchquagga_8c.html#a4b122497788fd6bae49352f1c9d6d6be">restart_kill</a>,restart,
                     <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5fb22d967ccfda0f9342572d35859b60">restart_timeout</a>);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a043794d8f8da2faffe9b9a98bbf4f116"></a><!-- doxytag: member="watchquagga.c::run_background" ref="a043794d8f8da2faffe9b9a98bbf4f116" args="(const char *shell_cmd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static pid_t run_background </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>shell_cmd</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00333">333</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  pid_t child;

  <span class="keywordflow">switch</span> (child = fork())
    {
    <span class="keywordflow">case</span> -1:
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;fork failed, cannot run command [%s]: %s&quot;</span>,
           shell_cmd,<a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a>(errno));
      <span class="keywordflow">return</span> -1;
    <span class="keywordflow">case</span> 0:
      <span class="comment">/* Child process. */</span>
      <span class="comment">/* Use separate process group so child processes can be killed easily. */</span>
      <span class="keywordflow">if</span> (setpgid(0,0) &lt; 0)
        <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a>(<span class="stringliteral">&quot;warning: setpgid(0,0) failed: %s&quot;</span>,<a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a>(errno));
      {
        <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[4] = { <span class="stringliteral">&quot;sh&quot;</span>, <span class="stringliteral">&quot;-c&quot;</span>, shell_cmd, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
    execv(<span class="stringliteral">&quot;/bin/sh&quot;</span>,(<span class="keywordtype">char</span> *<span class="keyword">const</span> *)argv);
    <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;execv(/bin/sh -c &#39;%s&#39;) failed: %s&quot;</span>,
         shell_cmd,<a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a>(errno));
    _exit(127);
      }
    <span class="keywordflow">default</span>:
      <span class="comment">/* Parent process: we will reap the child later. */</span>
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;Forked background command [pid %d]: %s&quot;</span>,(<span class="keywordtype">int</span>)child,shell_cmd);
      <span class="keywordflow">return</span> child;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a88a4bd930358f3f0df5b6b7256becc50"></a><!-- doxytag: member="watchquagga.c::run_job" ref="a88a4bd930358f3f0df5b6b7256becc50" args="(struct restart_info *restart, const char *cmdtype, const char *command, int force, int update_interval)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int run_job </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structrestart__info.html">restart_info</a> *&#160;</td>
          <td class="paramname"><em>restart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmdtype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>force</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>update_interval</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00472">472</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span>timeval delay;

  <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a> &gt; LOG_DEBUG+1)
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>(<span class="stringliteral">&quot;attempting to %s %s&quot;</span>,cmdtype,restart-&gt;<a class="code" href="structrestart__info.html#a2b3c824d6724befab51b9d208ba745a4">name</a>);

  <span class="keywordflow">if</span> (restart-&gt;<a class="code" href="structrestart__info.html#abe55f773030d03c53430f97ffbcbc9f8">pid</a>)
    {
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a> &gt; LOG_DEBUG+1)
        <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>(<span class="stringliteral">&quot;cannot %s %s, previous pid %d still running&quot;</span>,
           cmdtype,restart-&gt;<a class="code" href="structrestart__info.html#a2b3c824d6724befab51b9d208ba745a4">name</a>,(<span class="keywordtype">int</span>)restart-&gt;<a class="code" href="structrestart__info.html#abe55f773030d03c53430f97ffbcbc9f8">pid</a>);
      <span class="keywordflow">return</span> -1;
    }

  <span class="comment">/* Note: time_elapsed test must come before the force test, since we need</span>
<span class="comment">     to make sure that delay is initialized for use below in updating the</span>
<span class="comment">     restart interval. */</span>
  <span class="keywordflow">if</span> ((<a class="code" href="watchquagga_8c.html#a79bb4fa30cfacd7831e1bec08147c6ab">time_elapsed</a>(&amp;delay,&amp;restart-&gt;<a class="code" href="structrestart__info.html#a44a266ccb4d916176de7f3e451fff6ed">time</a>)-&gt;tv_sec &lt; restart-&gt;<a class="code" href="structrestart__info.html#a9ef91309464ce22b14881987fab3c32f">interval</a>) &amp;&amp;
      !force)
    {
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a> &gt; LOG_DEBUG+1)
        <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>(<span class="stringliteral">&quot;postponing %s %s: &quot;</span>
           <span class="stringliteral">&quot;elapsed time %ld &lt; retry interval %ld&quot;</span>,
           cmdtype,restart-&gt;<a class="code" href="structrestart__info.html#a2b3c824d6724befab51b9d208ba745a4">name</a>,(<span class="keywordtype">long</span>)delay.tv_sec,restart-&gt;<a class="code" href="structrestart__info.html#a9ef91309464ce22b14881987fab3c32f">interval</a>);
      <span class="keywordflow">return</span> -1;
    }

  gettimeofday(&amp;restart-&gt;<a class="code" href="structrestart__info.html#a44a266ccb4d916176de7f3e451fff6ed">time</a>,<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
  restart-&gt;<a class="code" href="structrestart__info.html#a8a5dc9a00fd77b39a1839c78c123643c">kills</a> = 0;
  {
    <span class="keywordtype">char</span> cmd[strlen(command)+strlen(restart-&gt;<a class="code" href="structrestart__info.html#a2b3c824d6724befab51b9d208ba745a4">name</a>)+1];
    <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a>(cmd,<span class="keyword">sizeof</span>(cmd),command,restart-&gt;<a class="code" href="structrestart__info.html#a2b3c824d6724befab51b9d208ba745a4">name</a>);
    <span class="keywordflow">if</span> ((restart-&gt;<a class="code" href="structrestart__info.html#abe55f773030d03c53430f97ffbcbc9f8">pid</a> = <a class="code" href="watchquagga_8c.html#a043794d8f8da2faffe9b9a98bbf4f116">run_background</a>(cmd)) &gt; 0)
      {
    restart-&gt;<a class="code" href="structrestart__info.html#a74ffd0ccc53e39e2e3005471e9dbaa25">t_kill</a> = <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a>(<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>,<a class="code" href="watchquagga_8c.html#a4b122497788fd6bae49352f1c9d6d6be">restart_kill</a>,restart,
                       <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5fb22d967ccfda0f9342572d35859b60">restart_timeout</a>);
    restart-&gt;<a class="code" href="structrestart__info.html#a2c2fed49b4e15287ad4421e68f678a2d">what</a> = cmdtype;
    <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a450212f3425150a559b4b66b2f224e74">numpids</a>++;
      }
    <span class="keywordflow">else</span>
      restart-&gt;<a class="code" href="structrestart__info.html#abe55f773030d03c53430f97ffbcbc9f8">pid</a> = 0;
  }

  <span class="comment">/* Calculate the new restart interval. */</span>
  <span class="keywordflow">if</span> (update_interval)
    {
      <span class="keywordflow">if</span> (delay.tv_sec &gt; 2*<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abbea16b7eed0f8bb8ca6e16a3d24ba4f">max_restart_interval</a>)
    restart-&gt;<a class="code" href="structrestart__info.html#a9ef91309464ce22b14881987fab3c32f">interval</a> = <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a56523bed8eb4d3aaba1b92c4f5487749">min_restart_interval</a>;
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((restart-&gt;<a class="code" href="structrestart__info.html#a9ef91309464ce22b14881987fab3c32f">interval</a> *= 2) &gt; <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abbea16b7eed0f8bb8ca6e16a3d24ba4f">max_restart_interval</a>)
    restart-&gt;<a class="code" href="structrestart__info.html#a9ef91309464ce22b14881987fab3c32f">interval</a> = <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abbea16b7eed0f8bb8ca6e16a3d24ba4f">max_restart_interval</a>;
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a> &gt; LOG_DEBUG+1)
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>(<span class="stringliteral">&quot;restart %s interval is now %ld&quot;</span>,
           restart-&gt;<a class="code" href="structrestart__info.html#a2b3c824d6724befab51b9d208ba745a4">name</a>,restart-&gt;<a class="code" href="structrestart__info.html#a9ef91309464ce22b14881987fab3c32f">interval</a>);
    }
  <span class="keywordflow">return</span> restart-&gt;<a class="code" href="structrestart__info.html#abe55f773030d03c53430f97ffbcbc9f8">pid</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afe6e5a642e61fc1a4f7c5b9d243b644e"></a><!-- doxytag: member="watchquagga.c::set_phase" ref="afe6e5a642e61fc1a4f7c5b9d243b644e" args="(restart_phase_t new_phase)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void set_phase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430">restart_phase_t</a>&#160;</td>
          <td class="paramname"><em>new_phase</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00815">815</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a55de65524793e810dc972e6086965b70">phase</a> = new_phase;
  <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a6fb4a12837f9f5e939e3a1f07c09398c">t_phase_hanging</a>)
    <a class="code" href="thread_8c.html#aceb89c1157b6a1d8bb3afa5021f1ab6d">thread_cancel</a>(<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a6fb4a12837f9f5e939e3a1f07c09398c">t_phase_hanging</a>);
  <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a6fb4a12837f9f5e939e3a1f07c09398c">t_phase_hanging</a> = <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a>(<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>,<a class="code" href="watchquagga_8c.html#afc99643db56e6fa9af56e9ad5f112fb3">phase_hanging</a>,<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
                    <a class="code" href="watchquagga_8c.html#adf01e890ebef9b526d4b22f2ca5b10ec">PHASE_TIMEOUT</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="afb0f8b8f3f52afd07bd6fb5793b999c4"></a><!-- doxytag: member="watchquagga.c::sigchild" ref="afb0f8b8f3f52afd07bd6fb5793b999c4" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void sigchild </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00415">415</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  pid_t child;
  <span class="keywordtype">int</span> status;
  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> *what;
  <span class="keyword">struct </span><a class="code" href="structrestart__info.html">restart_info</a> *restart;

  <span class="keywordflow">switch</span> (child = waitpid(-1,&amp;status,WNOHANG)) 
    {
    <span class="keywordflow">case</span> -1:
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;waitpid failed: %s&quot;</span>,<a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a>(errno));
      <span class="keywordflow">return</span>;
    <span class="keywordflow">case</span> 0:
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a>(<span class="stringliteral">&quot;SIGCHLD received, but waitpid did not reap a child&quot;</span>);
      <span class="keywordflow">return</span>;
    }

  <span class="keywordflow">if</span> ((restart = <a class="code" href="watchquagga_8c.html#ad1e38d2596f500ffef6fec5a9f63231c">find_child</a>(child)) != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      name = restart-&gt;<a class="code" href="structrestart__info.html#a2b3c824d6724befab51b9d208ba745a4">name</a>;
      what = restart-&gt;<a class="code" href="structrestart__info.html#a2c2fed49b4e15287ad4421e68f678a2d">what</a>;
      restart-&gt;<a class="code" href="structrestart__info.html#abe55f773030d03c53430f97ffbcbc9f8">pid</a> = 0;
      <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a450212f3425150a559b4b66b2f224e74">numpids</a>--;
      <a class="code" href="thread_8c.html#aceb89c1157b6a1d8bb3afa5021f1ab6d">thread_cancel</a>(restart-&gt;<a class="code" href="structrestart__info.html#a74ffd0ccc53e39e2e3005471e9dbaa25">t_kill</a>);
      restart-&gt;<a class="code" href="structrestart__info.html#a74ffd0ccc53e39e2e3005471e9dbaa25">t_kill</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
      <span class="comment">/* Update restart time to reflect the time the command completed. */</span>
      gettimeofday(&amp;restart-&gt;<a class="code" href="structrestart__info.html#a44a266ccb4d916176de7f3e451fff6ed">time</a>,<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
    }
  <span class="keywordflow">else</span>
    {
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;waitpid returned status for an unknown child process %d&quot;</span>,
           (<span class="keywordtype">int</span>)child);
      name = <span class="stringliteral">&quot;(unknown)&quot;</span>;
      what = <span class="stringliteral">&quot;background&quot;</span>;
    }
  <span class="keywordflow">if</span> (WIFSTOPPED(status))
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a>(<span class="stringliteral">&quot;warning: %s %s process %d is stopped&quot;</span>,
        what,name,(<span class="keywordtype">int</span>)child);
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (WIFSIGNALED(status))
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a>(<span class="stringliteral">&quot;%s %s process %d terminated due to signal %d&quot;</span>,
          what,name,(<span class="keywordtype">int</span>)child,WTERMSIG(status));
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (WIFEXITED(status))
    {
      <span class="keywordflow">if</span> (WEXITSTATUS(status) != 0)
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a>(<span class="stringliteral">&quot;%s %s process %d exited with non-zero status %d&quot;</span>,
          what,name,(<span class="keywordtype">int</span>)child,WEXITSTATUS(status));
      <span class="keywordflow">else</span>
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>(<span class="stringliteral">&quot;%s %s process %d exited normally&quot;</span>,what,name,(<span class="keywordtype">int</span>)child);
    }
  <span class="keywordflow">else</span>
    <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;cannot interpret %s %s process %d wait status 0x%x&quot;</span>,
         what,name,(<span class="keywordtype">int</span>)child,status);
  <a class="code" href="watchquagga_8c.html#af892b970a62c4640caf2ec4d9ef7dc40">phase_check</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="acc1594c0e273f7b9134404951c7ef595"></a><!-- doxytag: member="watchquagga.c::sigint" ref="acc1594c0e273f7b9134404951c7ef595" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void sigint </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00991">991</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="log_8h.html#a2fcbf88ea2e5eb71befdbdb4a3f1474f">zlog_notice</a>(<span class="stringliteral">&quot;Terminating on signal&quot;</span>);
  <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a>(0);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a79bb4fa30cfacd7831e1bec08147c6ab"></a><!-- doxytag: member="watchquagga.c::time_elapsed" ref="a79bb4fa30cfacd7831e1bec08147c6ab" args="(struct timeval *result, const struct timeval *start_time)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct timeval* time_elapsed </td>
          <td>(</td>
          <td class="paramtype">struct timeval *&#160;</td>
          <td class="paramname"><em>result</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct timeval *&#160;</td>
          <td class="paramname"><em>start_time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00363">363</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  gettimeofday(result,<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
  result-&gt;tv_sec -= start_time-&gt;tv_sec;
  result-&gt;tv_usec -= start_time-&gt;tv_usec;
  <span class="keywordflow">while</span> (result-&gt;tv_usec &lt; 0)
    {
      result-&gt;tv_usec += 1000000L;
      result-&gt;tv_sec--;
    }
  <span class="keywordflow">return</span> result;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a368996dc1c464c40bfd40dab47efad45"></a><!-- doxytag: member="watchquagga.c::translate_blanks" ref="a368996dc1c464c40bfd40dab47efad45" args="(const char *cmd, const char *blankstr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* translate_blanks </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>blankstr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l01008">1008</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">char</span> *res;
  <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
  <span class="keywordtype">size_t</span> bslen = strlen(blankstr);

  <span class="keywordflow">if</span> (!(res = strdup(cmd)))
    {
      perror(<span class="stringliteral">&quot;strdup&quot;</span>);
      <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a>(1);
    }
  <span class="keywordflow">while</span> ((p = strstr(res,blankstr)) != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      *p = <span class="charliteral">&#39; &#39;</span>;
      <span class="keywordflow">if</span> (bslen != 1)
     memmove(p+1,p+bslen,strlen(p+bslen)+1);
    }
  <span class="keywordflow">return</span> res;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af11b57b4da019de6d555b11a73ff1dd3"></a><!-- doxytag: member="watchquagga.c::try_connect" ref="af11b57b4da019de6d555b11a73ff1dd3" args="(struct daemon *dmn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int try_connect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdaemon.html">daemon</a> *&#160;</td>
          <td class="paramname"><em>dmn</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00732">732</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> sock;
  <span class="keyword">struct </span>sockaddr_un addr;
  <a class="code" href="zebra_8h.html#a6b82106923cc13b3a9734520ecc29514">socklen_t</a> len;

  <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a> &gt; LOG_DEBUG+1)
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>(<span class="stringliteral">&quot;%s: attempting to connect&quot;</span>,dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>);
  dmn-&gt;<a class="code" href="structdaemon.html#a20eb3de9e79ed801c2d430fd8531f469">connect_tries</a>++;

  memset (&amp;addr, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> sockaddr_un));
  addr.sun_family = AF_UNIX;
  <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a>(addr.sun_path, <span class="keyword">sizeof</span>(addr.sun_path), <span class="stringliteral">&quot;%s/%s.vty&quot;</span>,
       <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a6cad3336e001d272b61b9d52bcecc9ce">vtydir</a>,dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>);
<span class="preprocessor">#ifdef HAVE_STRUCT_SOCKADDR_UN_SUN_LEN</span>
<span class="preprocessor"></span>  len = addr.sun_len = SUN_LEN(&amp;addr);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>  len = <span class="keyword">sizeof</span> (addr.sun_family) + strlen (addr.sun_path);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_STRUCT_SOCKADDR_UN_SUN_LEN */</span>

  <span class="comment">/* Quick check to see if we might succeed before we go to the trouble</span>
<span class="comment">     of creating a socket. */</span>
  <span class="keywordflow">if</span> (access(addr.sun_path, W_OK) &lt; 0)
    {
      <span class="keywordflow">if</span> (errno != ENOENT)
        <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;%s: access to socket %s denied: %s&quot;</span>,
        dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>,addr.sun_path,<a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a>(errno));
      <span class="keywordflow">return</span> -1;
    }

  <span class="keywordflow">if</span> ((sock = socket (AF_UNIX, SOCK_STREAM, 0)) &lt; 0)
    {
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;%s(%s): cannot make socket: %s&quot;</span>,
           __func__,addr.sun_path, <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a>(errno));
      <span class="keywordflow">return</span> -1;
    }

  <span class="keywordflow">if</span> (<a class="code" href="network_8c.html#a450a9be7be692d8ac42f64acddbdaadd">set_nonblocking</a>(sock) &lt; 0)
    {
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;%s(%s): set_nonblocking(%d) failed&quot;</span>,
           __func__, addr.sun_path, sock);
      close(sock);
      <span class="keywordflow">return</span> -1;
    }

  <span class="keywordflow">if</span> (connect (sock, (<span class="keyword">struct</span> sockaddr *) &amp;addr, len) &lt; 0)
    {
      <span class="keywordflow">if</span> ((errno != EINPROGRESS) &amp;&amp; (errno != EWOULDBLOCK))
    {
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a> &gt; LOG_DEBUG)
        <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>(<span class="stringliteral">&quot;%s(%s): connect failed: %s&quot;</span>,
               __func__,addr.sun_path, <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a>(errno));
      close (sock);
      <span class="keywordflow">return</span> -1;
    }
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a> &gt; LOG_DEBUG)
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>(<span class="stringliteral">&quot;%s: connection in progress&quot;</span>,dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>);
      dmn-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a> = <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a269ad29eaf90e57e0fe5da74fcbc9320">DAEMON_CONNECTING</a>;
      dmn-&gt;<a class="code" href="structdaemon.html#a3542d9daecabffc92a567be4b8966a40">fd</a> = sock;
      dmn-&gt;<a class="code" href="structdaemon.html#a87626d3568f735b3d920a70d8215ef3f">t_write</a> = <a class="code" href="thread_8h.html#a8a2f048ba94722b1e88f08254fbd4444">thread_add_write</a>(<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>,<a class="code" href="watchquagga_8c.html#a41f7caca64f819bbd7134cbd20ac2098">check_connect</a>,dmn,dmn-&gt;<a class="code" href="structdaemon.html#a3542d9daecabffc92a567be4b8966a40">fd</a>);
      dmn-&gt;<a class="code" href="structdaemon.html#afd4798b097eebc4eb76552af259db02e">t_wakeup</a> = <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a>(<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>,<a class="code" href="watchquagga_8c.html#ac7ca844b9f41979949e5d43bd55c6001">wakeup_connect_hanging</a>,dmn,
                       <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ad5605522165f6b1c78e6ebab05ccd391">timeout</a>);
      <a class="code" href="watchquagga_8c.html#aad9410fad46db274da2408cc6efbd681">SET_READ_HANDLER</a>(dmn);
      <span class="keywordflow">return</span> 0;
    }

  dmn-&gt;<a class="code" href="structdaemon.html#a3542d9daecabffc92a567be4b8966a40">fd</a> = sock;
  <a class="code" href="watchquagga_8c.html#aad9410fad46db274da2408cc6efbd681">SET_READ_HANDLER</a>(dmn);
  <a class="code" href="watchquagga_8c.html#adc676d395fc4b1fe2adcad8c505eda09">daemon_up</a>(dmn,<span class="stringliteral">&quot;connect succeeded&quot;</span>);
  <span class="keywordflow">return</span> 1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa637d38f3150c85002318b8947389e45"></a><!-- doxytag: member="watchquagga.c::try_restart" ref="aa637d38f3150c85002318b8947389e45" args="(struct daemon *dmn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void try_restart </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdaemon.html">daemon</a> *&#160;</td>
          <td class="paramname"><em>dmn</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00870">870</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">switch</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a>)
  {
  <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639daff82e266ad97e1f6b0536947534b9db1">MODE_MONITOR</a>:
    <span class="keywordflow">return</span>;
  <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da10a238369099481dca5e44d95b55076d">MODE_GLOBAL_RESTART</a>:
    <a class="code" href="watchquagga_8c.html#a88a4bd930358f3f0df5b6b7256becc50">run_job</a>(&amp;<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ae5d3312fd823496cf937a0dd53a4c1b7">restart</a>,<span class="stringliteral">&quot;restart&quot;</span>,<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#af20cc377ff8e04eb957ce9b4545e00c4">restart_command</a>,0,1);
    <span class="keywordflow">break</span>;
  <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639dadaa0f184c31c44f5f393f09b472dd19d">MODE_SEPARATE_RESTART</a>:
    <a class="code" href="watchquagga_8c.html#a88a4bd930358f3f0df5b6b7256becc50">run_job</a>(&amp;dmn-&gt;<a class="code" href="structdaemon.html#acfb8cb0345bfb642e1d41f686cc21f83">restart</a>,<span class="stringliteral">&quot;restart&quot;</span>,<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#af20cc377ff8e04eb957ce9b4545e00c4">restart_command</a>,0,1);
    <span class="keywordflow">break</span>;
  <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da59ac418e6adf6d90de6eaa305dbdfed4">MODE_PHASED_ZEBRA_RESTART</a>:
    <span class="keywordflow">if</span> (dmn != <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>)
      {
        <span class="keywordflow">if</span> ((<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a> == <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a1be09914c1c6bf9825ef80fb681ee2ec">DAEMON_UP</a>) &amp;&amp; (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a55de65524793e810dc972e6086965b70">phase</a> == <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a61e900515aec51ba22cfdd63c1082fc7">PHASE_NONE</a>))
      <a class="code" href="watchquagga_8c.html#a88a4bd930358f3f0df5b6b7256becc50">run_job</a>(&amp;dmn-&gt;<a class="code" href="structdaemon.html#acfb8cb0345bfb642e1d41f686cc21f83">restart</a>,<span class="stringliteral">&quot;restart&quot;</span>,<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#af20cc377ff8e04eb957ce9b4545e00c4">restart_command</a>,0,1);
    <span class="keywordflow">else</span>
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>(<span class="stringliteral">&quot;%s: postponing restart attempt because master %s daemon &quot;</span>
             <span class="stringliteral">&quot;not up [%s], or phased restart in progress&quot;</span>,
             dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>,<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>,<a class="code" href="watchquagga_8c.html#a3012714639dac6ee77ac759f561c8702">state_str</a>[<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a>]);
    <span class="keywordflow">break</span>;
      }
    <span class="comment">/*FALLTHRU*/</span>
  <span class="keywordflow">case</span> <a class="code" href="watchquagga_8c.html#a2d7d16a6771b465726c774ca18dc639da88749ab4e93d56fac47580244e170b05">MODE_PHASED_ALL_RESTART</a>:
    <span class="keywordflow">if</span> ((<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a55de65524793e810dc972e6086965b70">phase</a> != <a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430a61e900515aec51ba22cfdd63c1082fc7">PHASE_NONE</a>) || <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a450212f3425150a559b4b66b2f224e74">numpids</a>)
      {
    <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a> &gt; LOG_DEBUG+1)
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>(<span class="stringliteral">&quot;postponing phased global restart: restart already in &quot;</span>
             <span class="stringliteral">&quot;progress [%s], or outstanding child processes [%d]&quot;</span>,
             <a class="code" href="watchquagga_8c.html#aa26a9ffa56c9c4fce0f6dbe9eae8a7ae">phase_str</a>[<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a55de65524793e810dc972e6086965b70">phase</a>],<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a450212f3425150a559b4b66b2f224e74">numpids</a>);
        <span class="keywordflow">break</span>;
      }
    <span class="comment">/* Is it too soon for a restart? */</span>
    {
      <span class="keyword">struct </span>timeval delay;
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#a79bb4fa30cfacd7831e1bec08147c6ab">time_elapsed</a>(&amp;delay,&amp;<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>-&gt;<a class="code" href="structdaemon.html#acfb8cb0345bfb642e1d41f686cc21f83">restart</a>.<a class="code" href="structrestart__info.html#a44a266ccb4d916176de7f3e451fff6ed">time</a>)-&gt;tv_sec &lt;
          <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>-&gt;<a class="code" href="structdaemon.html#acfb8cb0345bfb642e1d41f686cc21f83">restart</a>.<a class="code" href="structrestart__info.html#a9ef91309464ce22b14881987fab3c32f">interval</a>)
    {
      <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a9c23d1c7a9050aae866b113f0013162b">loglevel</a> &gt; LOG_DEBUG+1)
        <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>(<span class="stringliteral">&quot;postponing phased global restart: &quot;</span>
               <span class="stringliteral">&quot;elapsed time %ld &lt; retry interval %ld&quot;</span>,
               (<span class="keywordtype">long</span>)delay.tv_sec,<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>-&gt;<a class="code" href="structdaemon.html#acfb8cb0345bfb642e1d41f686cc21f83">restart</a>.<a class="code" href="structrestart__info.html#a9ef91309464ce22b14881987fab3c32f">interval</a>);
      <span class="keywordflow">break</span>;
    }
    }
    <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a>(<span class="stringliteral">&quot;Phased restart: stopping all routing daemons.&quot;</span>);
    <span class="comment">/* First step: stop all other daemons. */</span>
    <span class="keywordflow">for</span> (dmn = <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a104a4cbe6fb91bf4013aa6df0f11fcfa">daemons</a>; dmn; dmn = dmn-&gt;<a class="code" href="structdaemon.html#a702d305af420a44b6ac4019b03788d7b">next</a>)
      {
        <span class="keywordflow">if</span> (dmn != <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#a5d23a1c305454dd9496b4e835c1c8374">special</a>)
      <a class="code" href="watchquagga_8c.html#a88a4bd930358f3f0df5b6b7256becc50">run_job</a>(&amp;dmn-&gt;<a class="code" href="structdaemon.html#acfb8cb0345bfb642e1d41f686cc21f83">restart</a>,<span class="stringliteral">&quot;stop&quot;</span>,<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#accfc2ab01009040ec7974d383211213e">stop_command</a>,1,1);
      }
    <a class="code" href="watchquagga_8c.html#afe6e5a642e61fc1a4f7c5b9d243b644e">set_phase</a>(<a class="code" href="watchquagga_8c.html#a32d1552af3e5d7e6582e6e832ba6e430af979eabf3440749d3ff3ef7fbb5c1f78">PHASE_STOPS_PENDING</a>);
    <span class="keywordflow">break</span>;
  <span class="keywordflow">default</span>:
    <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;error: unknown restart mode %d&quot;</span>,<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#abaa6604c09ebbcf1a929ac92c9931417">mode</a>);
    <span class="keywordflow">break</span>;
  }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a09ab3bc0cba22a79f31c7e04c2f62f63"></a><!-- doxytag: member="watchquagga.c::usage" ref="a09ab3bc0cba22a79f31c7e04c2f62f63" args="(const char *progname, int status)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int usage </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>progname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>status</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00214">214</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (status != 0)
    fprintf(stderr, <span class="stringliteral">&quot;Try `%s --help&#39; for more information.\n&quot;</span>, <a class="code" href="isis__main_8c.html#ab9e1449fd00c98428516f0b41eddcb10">progname</a>);
  <span class="keywordflow">else</span>
    printf(<span class="stringliteral">&quot;Usage : %s [OPTION...] &lt;daemon name&gt; ...\n\n\</span>
<span class="stringliteral">Watchdog program to monitor status of quagga daemons and try to restart\n\</span>
<span class="stringliteral">them if they are down or unresponsive.  It determines whether a daemon is\n\</span>
<span class="stringliteral">up based on whether it can connect to the daemon&#39;s vty unix stream socket.\n\</span>
<span class="stringliteral">It then repeatedly sends echo commands over that socket to determine whether\n\</span>
<span class="stringliteral">the daemon is responsive.  If the daemon crashes, we will receive an EOF\n\</span>
<span class="stringliteral">on the socket connection and know immediately that the daemon is down.\n\n\</span>
<span class="stringliteral">The daemons to be monitored should be listed on the command line.\n\n\</span>
<span class="stringliteral">This program can run in one of 5 modes:\n\n\</span>
<span class="stringliteral">0. Mode: %s.\n\</span>
<span class="stringliteral">  Just monitor and report on status changes.  Example:\n\</span>
<span class="stringliteral">    %s -d zebra ospfd bgpd\n\n\</span>
<span class="stringliteral">1. Mode: %s.\n\</span>
<span class="stringliteral">  Whenever any daemon hangs or crashes, use the given command to restart\n\</span>
<span class="stringliteral">  them all.  Example:\n\</span>
<span class="stringliteral">    %s -dz \\\n\</span>
<span class="stringliteral">      -R &#39;/sbin/service zebra restart; /sbin/service ospfd restart&#39; \\\n\</span>
<span class="stringliteral">      zebra ospfd\n\n\</span>
<span class="stringliteral">2. Mode: %s.\n\</span>
<span class="stringliteral">  When any single daemon hangs or crashes, restart only the daemon that&#39;s\n\</span>
<span class="stringliteral">  in trouble using the supplied restart command.  Example:\n\</span>
<span class="stringliteral">    %s -dz -r &#39;/sbin/service %%s restart&#39; zebra ospfd bgpd\n\n\</span>
<span class="stringliteral">3. Mode: %s.\n\</span>
<span class="stringliteral">  The same as the previous mode, except that there is special treatment when\n\</span>
<span class="stringliteral">  the zebra daemon is in trouble.  In that case, a phased restart approach\n\</span>
<span class="stringliteral">  is used: 1. stop all other daemons; 2. restart zebra; 3. start the other\n\</span>
<span class="stringliteral">  daemons.  Example:\n\</span>
<span class="stringliteral">    %s -adz -r &#39;/sbin/service %%s restart&#39; \\\n\</span>
<span class="stringliteral">      -s &#39;/sbin/service %%s start&#39; \\\n\</span>
<span class="stringliteral">      -k &#39;/sbin/service %%s stop&#39; zebra ospfd bgpd\n\n\</span>
<span class="stringliteral">4. Mode: %s.\n\</span>
<span class="stringliteral">  This is the same as the previous mode, except that the phased restart\n\</span>
<span class="stringliteral">  procedure is used whenever any of the daemons hangs or crashes.  Example:\n\</span>
<span class="stringliteral">    %s -Adz -r &#39;/sbin/service %%s restart&#39; \\\n\</span>
<span class="stringliteral">      -s &#39;/sbin/service %%s start&#39; \\\n\</span>
<span class="stringliteral">      -k &#39;/sbin/service %%s stop&#39; zebra ospfd bgpd\n\n\</span>
<span class="stringliteral">As of this writing, it is believed that mode 2 [%s]\n\</span>
<span class="stringliteral">is not safe, and mode 3 [%s] may not be safe with some of the\n\</span>
<span class="stringliteral">routing daemons.\n\n\</span>
<span class="stringliteral">In order to avoid attempting to restart the daemons in a fast loop,\n\</span>
<span class="stringliteral">the -m and -M options allow you to control the minimum delay between\n\</span>
<span class="stringliteral">restart commands.  The minimum restart delay is recalculated each time\n\</span>
<span class="stringliteral">a restart is attempted: if the time since the last restart attempt exceeds\n\</span>
<span class="stringliteral">twice the -M value, then the restart delay is set to the -m value.\n\</span>
<span class="stringliteral">Otherwise, the interval is doubled (but capped at the -M value).\n\n\</span>
<span class="stringliteral">Options:\n\</span>
<span class="stringliteral">-d, --daemon    Run in daemon mode.  In this mode, error messages are sent\n\</span>
<span class="stringliteral">        to syslog instead of stdout.\n\</span>
<span class="stringliteral">-S, --statedir  Set the vty socket directory (default is %s)\n\</span>
<span class="stringliteral">-e, --no-echo   Do not ping the daemons to test responsiveness (this\n\</span>
<span class="stringliteral">        option is necessary if the daemons do not support the\n\</span>
<span class="stringliteral">        echo command)\n\</span>
<span class="stringliteral">-l, --loglevel  Set the logging level (default is %d).\n\</span>
<span class="stringliteral">        The value should range from %d (LOG_EMERG) to %d (LOG_DEBUG),\n\</span>
<span class="stringliteral">        but it can be set higher than %d if extra-verbose debugging\n\</span>
<span class="stringliteral">        messages are desired.\n\</span>
<span class="stringliteral">-m, --min-restart-interval\n\</span>
<span class="stringliteral">        Set the minimum seconds to wait between invocations of daemon\n\</span>
<span class="stringliteral">        restart commands (default is %d).\n\</span>
<span class="stringliteral">-M, --max-restart-interval\n\</span>
<span class="stringliteral">        Set the maximum seconds to wait between invocations of daemon\n\</span>
<span class="stringliteral">        restart commands (default is %d).\n\</span>
<span class="stringliteral">-i, --interval  Set the status polling interval in seconds (default is %d)\n\</span>
<span class="stringliteral">-t, --timeout   Set the unresponsiveness timeout in seconds (default is %d)\n\</span>
<span class="stringliteral">-T, --restart-timeout\n\</span>
<span class="stringliteral">        Set the restart (kill) timeout in seconds (default is %d).\n\</span>
<span class="stringliteral">        If any background jobs are still running after this much\n\</span>
<span class="stringliteral">        time has elapsed, they will be killed.\n\</span>
<span class="stringliteral">-r, --restart   Supply a Bourne shell command to use to restart a single\n\</span>
<span class="stringliteral">        daemon.  The command string should include &#39;%%s&#39; where the\n\</span>
<span class="stringliteral">        name of the daemon should be substituted.\n\</span>
<span class="stringliteral">        Note that -r and -R are incompatible.\n\</span>
<span class="stringliteral">-s, --start-command\n\</span>
<span class="stringliteral">        Supply a Bourne shell to command to use to start a single\n\</span>
<span class="stringliteral">        daemon.  The command string should include &#39;%%s&#39; where the\n\</span>
<span class="stringliteral">        name of the daemon should be substituted.\n\</span>
<span class="stringliteral">-k, --kill-command\n\</span>
<span class="stringliteral">        Supply a Bourne shell to command to use to stop a single\n\</span>
<span class="stringliteral">        daemon.  The command string should include &#39;%%s&#39; where the\n\</span>
<span class="stringliteral">        name of the daemon should be substituted.\n\</span>
<span class="stringliteral">-R, --restart-all\n\</span>
<span class="stringliteral">        When one or more daemons is down, try to restart everything\n\</span>
<span class="stringliteral">        using the Bourne shell command supplied as the argument.\n\</span>
<span class="stringliteral">        Note that -r and -R are incompatible.\n\</span>
<span class="stringliteral">-z, --unresponsive-restart\n\</span>
<span class="stringliteral">        When a daemon is unresponsive, treat it as being down for\n\</span>
<span class="stringliteral">        restart purposes.\n\</span>
<span class="stringliteral">-a, --all-restart\n\</span>
<span class="stringliteral">        When zebra hangs or crashes, restart all daemons using\n\</span>
<span class="stringliteral">        this phased approach: 1. stop all other daemons; 2. restart\n\</span>
<span class="stringliteral">        zebra; 3. start other daemons.  Requires -r, -s, and -k.\n\</span>
<span class="stringliteral">-A, --always-all-restart\n\</span>
<span class="stringliteral">        When any daemon (not just zebra) hangs or crashes, use the\n\</span>
<span class="stringliteral">        same phased restart mechanism described above for -a.\n\</span>
<span class="stringliteral">        Requires -r, -s, and -k.\n\</span>
<span class="stringliteral">-p, --pid-file  Set process identifier file name\n\</span>
<span class="stringliteral">        (default is %s).\n\</span>
<span class="stringliteral">-b, --blank-string\n\</span>
<span class="stringliteral">        When the supplied argument string is found in any of the\n\</span>
<span class="stringliteral">        various shell command arguments (-r, -s, -k, or -R), replace\n\</span>
<span class="stringliteral">        it with a space.  This is an ugly hack to circumvent problems\n\</span>
<span class="stringliteral">        passing command-line arguments with embedded spaces.\n\</span>
<span class="stringliteral">-v, --version   Print program version\n\</span>
<span class="stringliteral">-h, --help  Display this help and exit\n\</span>
<span class="stringliteral">&quot;</span>, <a class="code" href="isis__main_8c.html#ab9e1449fd00c98428516f0b41eddcb10">progname</a>,<a class="code" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[0],<a class="code" href="isis__main_8c.html#ab9e1449fd00c98428516f0b41eddcb10">progname</a>,<a class="code" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[1],<a class="code" href="isis__main_8c.html#ab9e1449fd00c98428516f0b41eddcb10">progname</a>,<a class="code" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[2],
<a class="code" href="isis__main_8c.html#ab9e1449fd00c98428516f0b41eddcb10">progname</a>,<a class="code" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[3],<a class="code" href="isis__main_8c.html#ab9e1449fd00c98428516f0b41eddcb10">progname</a>,<a class="code" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[4],<a class="code" href="isis__main_8c.html#ab9e1449fd00c98428516f0b41eddcb10">progname</a>,<a class="code" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[2],<a class="code" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[3],
<a class="code" href="watchquagga_8c.html#a5f1e994b088713b35b7f9b7edd1b4242">VTYDIR</a>,<a class="code" href="watchquagga_8c.html#aec8c265923c6714be1f4a42e252bc872">DEFAULT_LOGLEVEL</a>,LOG_EMERG,LOG_DEBUG,LOG_DEBUG,
<a class="code" href="watchquagga_8c.html#aa6d28ab74f2bbba9e5ebc440216f68d2">DEFAULT_MIN_RESTART</a>,<a class="code" href="watchquagga_8c.html#abaee7e06edf46609c00dddb2a7e78f46">DEFAULT_MAX_RESTART</a>,
<a class="code" href="watchquagga_8c.html#a19ae3417888a615aca7350e9e1ba0204">DEFAULT_PERIOD</a>,<a class="code" href="watchquagga_8c.html#aad2dd72565852b91c809cd4685833b17">DEFAULT_TIMEOUT</a>,<a class="code" href="watchquagga_8c.html#abc9c0b03b73ee41cc7d9962a87194b29">DEFAULT_RESTART_TIMEOUT</a>,<a class="code" href="watchquagga_8c.html#a108b7f06d065ce9a1087cc8ffbd481c2">DEFAULT_PIDFILE</a>);

  <span class="keywordflow">return</span> status;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a72ce6b2c5071c2fae3cc7d61f559502b"></a><!-- doxytag: member="watchquagga.c::valid_command" ref="a72ce6b2c5071c2fae3cc7d61f559502b" args="(const char *cmd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int valid_command </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmd</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00998">998</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;

  <span class="keywordflow">return</span> ((p = strchr(cmd,<span class="charliteral">&#39;%&#39;</span>)) != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (*(p+1) == <span class="charliteral">&#39;s&#39;</span>) &amp;&amp; !strchr(p+1,<span class="charliteral">&#39;%&#39;</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac7ca844b9f41979949e5d43bd55c6001"></a><!-- doxytag: member="watchquagga.c::wakeup_connect_hanging" ref="ac7ca844b9f41979949e5d43bd55c6001" args="(struct thread *t_wakeup)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int wakeup_connect_hanging </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>t_wakeup</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00718">718</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structdaemon.html">daemon</a> *dmn = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a>(t_wakeup);
  <span class="keywordtype">char</span> why[100];

  dmn-&gt;<a class="code" href="structdaemon.html#afd4798b097eebc4eb76552af259db02e">t_wakeup</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a>(why,<span class="keyword">sizeof</span>(why),<span class="stringliteral">&quot;connection attempt timed out after %ld seconds&quot;</span>,
       <a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ad5605522165f6b1c78e6ebab05ccd391">timeout</a>);
  <a class="code" href="watchquagga_8c.html#a2dee993c9ca79cff47ffdb2460953bb2">daemon_down</a>(dmn,why);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a861ae2ed5075dec55c6065399e736ed9"></a><!-- doxytag: member="watchquagga.c::wakeup_down" ref="a861ae2ed5075dec55c6065399e736ed9" args="(struct thread *t_wakeup)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int wakeup_down </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>t_wakeup</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00547">547</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structdaemon.html">daemon</a> *dmn = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a>(t_wakeup);

  dmn-&gt;<a class="code" href="structdaemon.html#afd4798b097eebc4eb76552af259db02e">t_wakeup</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#af11b57b4da019de6d555b11a73ff1dd3">try_connect</a>(dmn) &lt; 0)
    <a class="code" href="watchquagga_8c.html#a3f4208a945dd2e77f915f9b7cbb77803">SET_WAKEUP_DOWN</a>(dmn);
  <span class="keywordflow">if</span> ((dmn-&gt;<a class="code" href="structdaemon.html#a20eb3de9e79ed801c2d430fd8531f469">connect_tries</a> &gt; 1) &amp;&amp; (dmn-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a> != <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a1be09914c1c6bf9825ef80fb681ee2ec">DAEMON_UP</a>))
    <a class="code" href="watchquagga_8c.html#aa637d38f3150c85002318b8947389e45">try_restart</a>(dmn);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a20a45d7c8bed8569a2cbeba4747461ee"></a><!-- doxytag: member="watchquagga.c::wakeup_init" ref="a20a45d7c8bed8569a2cbeba4747461ee" args="(struct thread *t_wakeup)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int wakeup_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>t_wakeup</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00560">560</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structdaemon.html">daemon</a> *dmn = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a>(t_wakeup);

  dmn-&gt;<a class="code" href="structdaemon.html#afd4798b097eebc4eb76552af259db02e">t_wakeup</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#af11b57b4da019de6d555b11a73ff1dd3">try_connect</a>(dmn) &lt; 0)
    {
      <a class="code" href="watchquagga_8c.html#a3f4208a945dd2e77f915f9b7cbb77803">SET_WAKEUP_DOWN</a>(dmn);
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;%s state -&gt; down : initial connection attempt failed&quot;</span>,
           dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>);
      dmn-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a> = <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a0ec7be6d84eb71cf7d575b2a53d8ddce">DAEMON_DOWN</a>;
    }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0f31474fb09f036f544dd171f271ba46"></a><!-- doxytag: member="watchquagga.c::wakeup_no_answer" ref="a0f31474fb09f036f544dd171f271ba46" args="(struct thread *t_wakeup)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int wakeup_no_answer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>t_wakeup</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00950">950</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structdaemon.html">daemon</a> *dmn = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a>(t_wakeup);

  dmn-&gt;<a class="code" href="structdaemon.html#afd4798b097eebc4eb76552af259db02e">t_wakeup</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  dmn-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a> = <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a275085ab09194304efb7f479f7b49232">DAEMON_UNRESPONSIVE</a>;
  <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;%s state -&gt; unresponsive : no response yet to ping &quot;</span>
       <span class="stringliteral">&quot;sent %ld seconds ago&quot;</span>,dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>,<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ad5605522165f6b1c78e6ebab05ccd391">timeout</a>);
  <span class="keywordflow">if</span> (<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#aa9865e52cbc935f0d1188b4451b0494f">unresponsive_restart</a>)
    {
      <a class="code" href="watchquagga_8c.html#a28c11f6de68844c7454b7c807a1c40d1">SET_WAKEUP_UNRESPONSIVE</a>(dmn);
      <a class="code" href="watchquagga_8c.html#aa637d38f3150c85002318b8947389e45">try_restart</a>(dmn);
    }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af8369e03b393c7ab747bf04aac92b020"></a><!-- doxytag: member="watchquagga.c::wakeup_send_echo" ref="af8369e03b393c7ab747bf04aac92b020" args="(struct thread *t_wakeup)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int wakeup_send_echo </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>t_wakeup</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00967">967</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> echocmd[] = <span class="stringliteral">&quot;echo &quot;</span> <a class="code" href="watchquagga_8c.html#abc0f87853cfbb9f46572c6f4ea34f591">PING_TOKEN</a>;
  ssize_t rc;
  <span class="keyword">struct </span><a class="code" href="structdaemon.html">daemon</a> *dmn = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a>(t_wakeup);

  dmn-&gt;<a class="code" href="structdaemon.html#afd4798b097eebc4eb76552af259db02e">t_wakeup</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keywordflow">if</span> (((rc = write(dmn-&gt;<a class="code" href="structdaemon.html#a3542d9daecabffc92a567be4b8966a40">fd</a>,echocmd,<span class="keyword">sizeof</span>(echocmd))) &lt; 0) ||
      ((<span class="keywordtype">size_t</span>)rc != <span class="keyword">sizeof</span>(echocmd)))
    {
      <span class="keywordtype">char</span> why[100+<span class="keyword">sizeof</span>(echocmd)];
      <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a>(why,<span class="keyword">sizeof</span>(why),<span class="stringliteral">&quot;write &#39;%s&#39; returned %d instead of %u&quot;</span>,
               echocmd,(<span class="keywordtype">int</span>)rc,(u_int)<span class="keyword">sizeof</span>(echocmd));
      <a class="code" href="watchquagga_8c.html#a2dee993c9ca79cff47ffdb2460953bb2">daemon_down</a>(dmn,why);
    }
  <span class="keywordflow">else</span>
    {
      gettimeofday(&amp;dmn-&gt;<a class="code" href="structdaemon.html#aecbec7a86985b13493216cdfd690850f">echo_sent</a>,<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
      dmn-&gt;<a class="code" href="structdaemon.html#afd4798b097eebc4eb76552af259db02e">t_wakeup</a> = <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a>(<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>,<a class="code" href="watchquagga_8c.html#a0f31474fb09f036f544dd171f271ba46">wakeup_no_answer</a>,dmn,<a class="code" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a>.<a class="code" href="structglobal__state.html#ad5605522165f6b1c78e6ebab05ccd391">timeout</a>);
    }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0b10a2b1c589d7ac81017d90a30df739"></a><!-- doxytag: member="watchquagga.c::wakeup_unresponsive" ref="a0b10a2b1c589d7ac81017d90a30df739" args="(struct thread *t_wakeup)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int wakeup_unresponsive </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>t_wakeup</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00932">932</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structdaemon.html">daemon</a> *dmn = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a>(t_wakeup);

  dmn-&gt;<a class="code" href="structdaemon.html#afd4798b097eebc4eb76552af259db02e">t_wakeup</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keywordflow">if</span> (dmn-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a> != <a class="code" href="watchquagga_8c.html#a73529b87279a7fdabf5b3c42b3ddec38a275085ab09194304efb7f479f7b49232">DAEMON_UNRESPONSIVE</a>)
    <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>(<span class="stringliteral">&quot;%s: no longer unresponsive (now %s), &quot;</span>
         <span class="stringliteral">&quot;wakeup should have been cancelled!&quot;</span>,
         dmn-&gt;<a class="code" href="structdaemon.html#a7b15450fb0ac807fd89e68cd7ae90a0c">name</a>,<a class="code" href="watchquagga_8c.html#a3012714639dac6ee77ac759f561c8702">state_str</a>[dmn-&gt;<a class="code" href="structdaemon.html#a5bc8be40536aa1612c0c6fbe5b7acf3e">state</a>]);
  <span class="keywordflow">else</span>
    {
      <a class="code" href="watchquagga_8c.html#a28c11f6de68844c7454b7c807a1c40d1">SET_WAKEUP_UNRESPONSIVE</a>(dmn);
      <a class="code" href="watchquagga_8c.html#aa637d38f3150c85002318b8947389e45">try_restart</a>(dmn);
    }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="aaf8225eee1beba4ca2638c0f98fbb17a"></a><!-- doxytag: member="watchquagga.c::gs" ref="aaf8225eee1beba4ca2638c0f98fbb17a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structglobal__state.html">global_state</a>  <a class="el" href="watchquagga_8c.html#aaf8225eee1beba4ca2638c0f98fbb17a">gs</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a94965649155359a4c4eb047af782bf22"></a><!-- doxytag: member="watchquagga.c::longopts" ref="a94965649155359a4c4eb047af782bf22" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structoption.html">option</a> <a class="el" href="test__main_8c.html#a94965649155359a4c4eb047af782bf22">longopts</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> 
{
  { <span class="stringliteral">&quot;daemon&quot;</span>, <a class="code" href="getopt_8h.html#a3bc1d5f667b5b4ca4b4abb685dc874ce">no_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;d&#39;</span>},
  { <span class="stringliteral">&quot;statedir&quot;</span>, <a class="code" href="getopt_8h.html#a6ece8d8dfa8378778f7290fdaba5b8bc">required_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;S&#39;</span>},
  { <span class="stringliteral">&quot;no-echo&quot;</span>, <a class="code" href="getopt_8h.html#a3bc1d5f667b5b4ca4b4abb685dc874ce">no_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;e&#39;</span>},
  { <span class="stringliteral">&quot;loglevel&quot;</span>, <a class="code" href="getopt_8h.html#a6ece8d8dfa8378778f7290fdaba5b8bc">required_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;l&#39;</span>},
  { <span class="stringliteral">&quot;interval&quot;</span>, <a class="code" href="getopt_8h.html#a6ece8d8dfa8378778f7290fdaba5b8bc">required_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;i&#39;</span>},
  { <span class="stringliteral">&quot;timeout&quot;</span>, <a class="code" href="getopt_8h.html#a6ece8d8dfa8378778f7290fdaba5b8bc">required_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;t&#39;</span>},
  { <span class="stringliteral">&quot;restart-timeout&quot;</span>, <a class="code" href="getopt_8h.html#a6ece8d8dfa8378778f7290fdaba5b8bc">required_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;T&#39;</span>},
  { <span class="stringliteral">&quot;restart&quot;</span>, <a class="code" href="getopt_8h.html#a6ece8d8dfa8378778f7290fdaba5b8bc">required_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;r&#39;</span>},
  { <span class="stringliteral">&quot;start-command&quot;</span>, <a class="code" href="getopt_8h.html#a6ece8d8dfa8378778f7290fdaba5b8bc">required_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;s&#39;</span>},
  { <span class="stringliteral">&quot;kill-command&quot;</span>, <a class="code" href="getopt_8h.html#a6ece8d8dfa8378778f7290fdaba5b8bc">required_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;k&#39;</span>},
  { <span class="stringliteral">&quot;restart-all&quot;</span>, <a class="code" href="getopt_8h.html#a6ece8d8dfa8378778f7290fdaba5b8bc">required_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;R&#39;</span>},
  { <span class="stringliteral">&quot;all-restart&quot;</span>, <a class="code" href="getopt_8h.html#a3bc1d5f667b5b4ca4b4abb685dc874ce">no_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;a&#39;</span>},
  { <span class="stringliteral">&quot;always-all-restart&quot;</span>, <a class="code" href="getopt_8h.html#a3bc1d5f667b5b4ca4b4abb685dc874ce">no_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;A&#39;</span>},
  { <span class="stringliteral">&quot;unresponsive-restart&quot;</span>, <a class="code" href="getopt_8h.html#a3bc1d5f667b5b4ca4b4abb685dc874ce">no_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;z&#39;</span>},
  { <span class="stringliteral">&quot;min-restart-interval&quot;</span>, <a class="code" href="getopt_8h.html#a6ece8d8dfa8378778f7290fdaba5b8bc">required_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;m&#39;</span>},
  { <span class="stringliteral">&quot;max-restart-interval&quot;</span>, <a class="code" href="getopt_8h.html#a6ece8d8dfa8378778f7290fdaba5b8bc">required_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;M&#39;</span>},
  { <span class="stringliteral">&quot;pid-file&quot;</span>, <a class="code" href="getopt_8h.html#a6ece8d8dfa8378778f7290fdaba5b8bc">required_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;p&#39;</span>},
  { <span class="stringliteral">&quot;blank-string&quot;</span>, <a class="code" href="getopt_8h.html#a6ece8d8dfa8378778f7290fdaba5b8bc">required_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;b&#39;</span>},
  { <span class="stringliteral">&quot;help&quot;</span>, <a class="code" href="getopt_8h.html#a3bc1d5f667b5b4ca4b4abb685dc874ce">no_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;h&#39;</span>},
  { <span class="stringliteral">&quot;version&quot;</span>, <a class="code" href="getopt_8h.html#a3bc1d5f667b5b4ca4b4abb685dc874ce">no_argument</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;v&#39;</span>},
  { <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0 }
}
</pre></div>
<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00183">183</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="af7f9077bc08df049beb65a1c09cde5fa"></a><!-- doxytag: member="watchquagga.c::master" ref="af7f9077bc08df049beb65a1c09cde5fa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structthread__master.html">thread_master</a>* <a class="el" href="test__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00061">61</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="adae7fb2bd856b59aca20e47c56f137a6"></a><!-- doxytag: member="watchquagga.c::mode_str" ref="adae7fb2bd856b59aca20e47c56f137a6" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="watchquagga_8c.html#adae7fb2bd856b59aca20e47c56f137a6">mode_str</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment">
{
  <span class="stringliteral">&quot;monitor&quot;</span>,
  <span class="stringliteral">&quot;global restart&quot;</span>,
  <span class="stringliteral">&quot;individual daemon restart&quot;</span>,
  <span class="stringliteral">&quot;phased zebra restart&quot;</span>,
  <span class="stringliteral">&quot;phased global restart for any failure&quot;</span>,
}
</pre></div>
<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00072">72</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa26a9ffa56c9c4fce0f6dbe9eae8a7ae"></a><!-- doxytag: member="watchquagga.c::phase_str" ref="aa26a9ffa56c9c4fce0f6dbe9eae8a7ae" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="watchquagga_8c.html#aa26a9ffa56c9c4fce0f6dbe9eae8a7ae">phase_str</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment">
{
  <span class="stringliteral">&quot;None&quot;</span>,
  <span class="stringliteral">&quot;Stop jobs running&quot;</span>,
  <span class="stringliteral">&quot;Waiting for other daemons to come down&quot;</span>,
  <span class="stringliteral">&quot;Zebra restart job running&quot;</span>,
  <span class="stringliteral">&quot;Waiting for zebra to come up&quot;</span>,
  <span class="stringliteral">&quot;Start jobs running&quot;</span>,
}
</pre></div>
<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00090">90</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3012714639dac6ee77ac759f561c8702"></a><!-- doxytag: member="watchquagga.c::state_str" ref="a3012714639dac6ee77ac759f561c8702" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="watchquagga_8c.html#a3012714639dac6ee77ac759f561c8702">state_str</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment">
{
  <span class="stringliteral">&quot;Init&quot;</span>,
  <span class="stringliteral">&quot;Down&quot;</span>,
  <span class="stringliteral">&quot;Connecting&quot;</span>,
  <span class="stringliteral">&quot;Up&quot;</span>,
  <span class="stringliteral">&quot;Unresponsive&quot;</span>,
}
</pre></div>
<p>Definition at line <a class="el" href="watchquagga_8c_source.html#l00161">161</a> of file <a class="el" href="watchquagga_8c_source.html">watchquagga.c</a>.</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="watchquagga_8c.html">watchquagga.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:37 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
