<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: ospfn/ccn_fib.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ccn__fib_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ospfn/ccn_fib.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;netinet/in.h&gt;</code><br/>
<code>#include &lt;netdb.h&gt;</code><br/>
<code>#include &lt;sys/time.h&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;stdarg.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;ccn/ccn.h&gt;</code><br/>
<code>#include &lt;ccn/uri.h&gt;</code><br/>
<code>#include &lt;ccn/face_mgmt.h&gt;</code><br/>
<code>#include &lt;ccn/reg_mgmt.h&gt;</code><br/>
<code>#include &lt;ccn/charbuf.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="ccn__fib_8h_source.html">ccn_fib.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ccn_fib.c:</div>
<div class="dyncontent">
<div class="center"><img src="ccn__fib_8c__incl.png" border="0" usemap="#ospfn_2ccn__fib_8c" alt=""/></div>
<map name="ospfn_2ccn__fib_8c" id="ospfn_2ccn__fib_8c">
<area shape="rect" id="node31" href="ccn__fib_8h.html" title="ccn_fib.h" alt="" coords="1517,80,1592,107"/></map>
</div>
</div>
<p><a href="ccn__fib_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#a04ca4114f4488ec3ff95da3e6daad103">ON_ERROR_EXIT</a>(resval, <a class="el" href="structmsg.html">msg</a>)&#160;&#160;&#160;on_error_exit((resval), __LINE__, <a class="el" href="structmsg.html">msg</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#a8eac63cf968b7b4b72edd8971b5e646c">ON_ERROR_CLEANUP</a>(resval)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#a75a283d632fed04bbc5f9a72b238c884">ON_NULL_CLEANUP</a>(resval)</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#a5bd42f0ae35a1f9c8d486c9684a6c799">ccn_fib_warn</a> (int lineno, const char *format,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#a791983e6c19c85d3dc39440c098de1e7">ccn_fib_fatal</a> (int lineno, const char *format,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#a6ff717e78332e53e574f46e65b2a6028">on_error_exit</a> (int res, int lineno, const char *<a class="el" href="structmsg.html">msg</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#a8f6f4b812143ec6d511ec648e1fd8754">register_unregister_prefix</a> (struct ccn *h, struct ccn_charbuf *local_scope_template, struct ccn_charbuf *no_name, struct ccn_charbuf *<a class="el" href="structname__prefix.html">name_prefix</a>, struct ccn_face_instance *face_instance, int operation)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct ccn_face_instance *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#a13cf09f8721beb1f3f6d2afc176e59c7">create_face</a> (struct ccn *h, struct ccn_charbuf *local_scope_template, struct ccn_charbuf *no_name, struct ccn_face_instance *face_instance)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#a9e5c5841ad7489616006ec2f4835a09d">get_ccndid</a> (struct ccn *h, struct ccn_charbuf *local_scope_template, unsigned char *ccndid)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct ccn_face_instance *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#a95a5822f46344419114383afc616f13c">construct_face</a> (const unsigned char *ccndid, size_t ccndid_size, const char *address, const char *port)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#aedd1f26f7a71e3d25900e35808036ab0">init_data</a> (struct ccn_charbuf *local_scope_template, struct ccn_charbuf *no_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#af35bb2f8c05083a3744c8cc774cad4ac">add_delete_ccn_face</a> (struct ccn *h, const char *uri, const char *address, const unsigned int <a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, int operation)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#a6bb94cc5ad82e2f1c17ffb413ba72838">add_ccn_face</a> (struct ccn *h, const char *uri, const char *address, const unsigned int <a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccn__fib_8c.html#a12135bbf63b584d60aa46bd61c0607fd">delete_ccn_face</a> (struct ccn *h, const char *uri, const char *address, const unsigned int <a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Manipulate ccnd fib for ospfn. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Cheng Yi </dd></dl>

<p>Definition in file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="a8eac63cf968b7b4b72edd8971b5e646c"></a><!-- doxytag: member="ccn_fib.c::ON_ERROR_CLEANUP" ref="a8eac63cf968b7b4b72edd8971b5e646c" args="(resval)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ON_ERROR_CLEANUP</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">resval</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">{           \
    if ((resval) &lt; 0) { \
        ccn_fib_warn (__LINE__, <span class="stringliteral">&quot;OnError cleanup\n&quot;</span>); \
        goto cleanup; \
    } \
}
</pre></div>
<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00064">64</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>

</div>
</div>
<a class="anchor" id="a04ca4114f4488ec3ff95da3e6daad103"></a><!-- doxytag: member="ccn_fib.c::ON_ERROR_EXIT" ref="a04ca4114f4488ec3ff95da3e6daad103" args="(resval, msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ON_ERROR_EXIT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">resval, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="structmsg.html">msg</a>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;on_error_exit((resval), __LINE__, <a class="el" href="structmsg.html">msg</a>)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00054">54</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>

</div>
</div>
<a class="anchor" id="a75a283d632fed04bbc5f9a72b238c884"></a><!-- doxytag: member="ccn_fib.c::ON_NULL_CLEANUP" ref="a75a283d632fed04bbc5f9a72b238c884" args="(resval)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ON_NULL_CLEANUP</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">resval</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">{           \
    if ((resval) == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { \
        ccn_fib_warn(__LINE__, <span class="stringliteral">&quot;OnNull cleanup\n&quot;</span>); \
        goto cleanup; \
    } \
}
</pre></div>
<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00072">72</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a6bb94cc5ad82e2f1c17ffb413ba72838"></a><!-- doxytag: member="ccn_fib.c::add_ccn_face" ref="a6bb94cc5ad82e2f1c17ffb413ba72838" args="(struct ccn *h, const char *uri, const char *address, const unsigned int p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int add_ccn_face </td>
          <td>(</td>
          <td class="paramtype">struct ccn *&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>uri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a ccn face for a name prefix. </p>

<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00407">407</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="ccn__fib_8c.html#af35bb2f8c05083a3744c8cc774cad4ac">add_delete_ccn_face</a>(h, uri, address, <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, <a class="code" href="ccn__fib_8h.html#a73e89ddb5cae58b5357d85db0c3ed8d6">OP_REG</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="af35bb2f8c05083a3744c8cc774cad4ac"></a><!-- doxytag: member="ccn_fib.c::add_delete_ccn_face" ref="af35bb2f8c05083a3744c8cc774cad4ac" args="(struct ccn *h, const char *uri, const char *address, const unsigned int p, int operation)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int add_delete_ccn_face </td>
          <td>(</td>
          <td class="paramtype">struct ccn *&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>uri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>operation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00344">344</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span>ccn_charbuf *<a class="code" href="prefix_8h.html#a6b458105367a186babd858fd008a66be">prefix</a>;
    <span class="keywordtype">char</span> port[6];
    <span class="keyword">struct </span>ccn_charbuf *local_scope_template = ccn_charbuf_create();
    <span class="keyword">struct </span>ccn_charbuf *no_name = ccn_charbuf_create();
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ccndid_storage[32] = {0};
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ccndid = ccndid_storage;
    <span class="keywordtype">size_t</span> ccndid_size = 0;
    <span class="keyword">struct </span>ccn_face_instance *fi;
    <span class="keyword">struct </span>ccn_face_instance *nfi;
    <span class="keywordtype">int</span> res;

    prefix = ccn_charbuf_create();
    res = ccn_name_from_uri(prefix, uri);
    <a class="code" href="ccn__fib_8c.html#a8eac63cf968b7b4b72edd8971b5e646c">ON_ERROR_CLEANUP</a>(res);
    memset(port, 0, 6);
    sprintf(port, <span class="stringliteral">&quot;%d&quot;</span>, <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);

    <a class="code" href="ccn__fib_8c.html#aedd1f26f7a71e3d25900e35808036ab0" title="initialize local data">init_data</a>(local_scope_template, no_name);

    ccndid_size = <a class="code" href="ccn__fib_8c.html#a9e5c5841ad7489616006ec2f4835a09d" title="Get ccnd id.">get_ccndid</a>(h, local_scope_template, ccndid);
    <span class="keywordflow">if</span> (ccndid_size != <span class="keyword">sizeof</span>(ccndid_storage))
    {
        fprintf(stderr, <span class="stringliteral">&quot;Incorrect size for ccnd id in response\n&quot;</span>);
        <a class="code" href="ccn__fib_8c.html#a8eac63cf968b7b4b72edd8971b5e646c">ON_ERROR_CLEANUP</a>(-1);
    }

    <span class="comment">/* construct a face instance for new face request */</span>
    fi = <a class="code" href="ccn__fib_8c.html#a95a5822f46344419114383afc616f13c" title="Construct a new face instance based on the given address and port This face instance is only used to ...">construct_face</a>(ccndid, ccndid_size, address, port);
    <a class="code" href="ccn__fib_8c.html#a75a283d632fed04bbc5f9a72b238c884">ON_NULL_CLEANUP</a>(fi);

    <span class="comment">/* send new face request to actually create a new face */</span>
    nfi = <a class="code" href="ccn__fib_8c.html#a13cf09f8721beb1f3f6d2afc176e59c7" title="Create new face by sending out a request Interest The actual new face instance is returned...">create_face</a>(h, local_scope_template, no_name, fi);
    <a class="code" href="ccn__fib_8c.html#a75a283d632fed04bbc5f9a72b238c884">ON_NULL_CLEANUP</a>(nfi);

    res = <a class="code" href="ccn__fib_8c.html#a8f6f4b812143ec6d511ec648e1fd8754" title="Bind a prefix to a face.">register_unregister_prefix</a>(h, local_scope_template, no_name, prefix, nfi, operation);
    <a class="code" href="ccn__fib_8c.html#a8eac63cf968b7b4b72edd8971b5e646c">ON_ERROR_CLEANUP</a>(res);

    ccn_charbuf_destroy(&amp;local_scope_template);
    ccn_charbuf_destroy(&amp;no_name);
    ccn_face_instance_destroy(&amp;fi);
    ccn_face_instance_destroy(&amp;nfi);
    ccn_charbuf_destroy(&amp;prefix);

    <span class="keywordflow">return</span> 0;

    cleanup:
        ccn_charbuf_destroy(&amp;prefix);
        ccn_charbuf_destroy(&amp;local_scope_template);
        ccn_charbuf_destroy(&amp;no_name);
        ccn_face_instance_destroy(&amp;fi);
        ccn_face_instance_destroy(&amp;nfi);

    <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a791983e6c19c85d3dc39440c098de1e7"></a><!-- doxytag: member="ccn_fib.c::ccn_fib_fatal" ref="a791983e6c19c85d3dc39440c098de1e7" args="(int lineno, const char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ccn_fib_fatal </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lineno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00042">42</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span>timeval <a class="code" href="test-sig_8c.html#ab4ed0bba3292270af8ad67b45a21280d">t</a>;
    va_list ap;
    va_start(ap, format);
    gettimeofday(&amp;<a class="code" href="test-sig_8c.html#ab4ed0bba3292270af8ad67b45a21280d">t</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
    fprintf(stderr, <span class="stringliteral">&quot;%d.%06d ccn_fib[%d]:%d: &quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="test-sig_8c.html#ab4ed0bba3292270af8ad67b45a21280d">t</a>.tv_sec, (<span class="keywordtype">unsigned</span>)<a class="code" href="test-sig_8c.html#ab4ed0bba3292270af8ad67b45a21280d">t</a>.tv_usec, (<span class="keywordtype">int</span>)getpid(), lineno);
    vfprintf(stderr, format, ap);
    va_end(ap);
    <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a>(1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5bd42f0ae35a1f9c8d486c9684a6c799"></a><!-- doxytag: member="ccn_fib.c::ccn_fib_warn" ref="a5bd42f0ae35a1f9c8d486c9684a6c799" args="(int lineno, const char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ccn_fib_warn </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lineno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00030">30</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span>timeval <a class="code" href="test-sig_8c.html#ab4ed0bba3292270af8ad67b45a21280d">t</a>;
    va_list ap;
    va_start(ap, format);
    gettimeofday(&amp;<a class="code" href="test-sig_8c.html#ab4ed0bba3292270af8ad67b45a21280d">t</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
    fprintf(stderr, <span class="stringliteral">&quot;%d.%06d ccn_fib[%d]:%d: &quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="test-sig_8c.html#ab4ed0bba3292270af8ad67b45a21280d">t</a>.tv_sec, (<span class="keywordtype">unsigned</span>)<a class="code" href="test-sig_8c.html#ab4ed0bba3292270af8ad67b45a21280d">t</a>.tv_usec, (<span class="keywordtype">int</span>)getpid(), lineno);
    vfprintf(stderr, format, ap);
    va_end(ap);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a95a5822f46344419114383afc616f13c"></a><!-- doxytag: member="ccn_fib.c::construct_face" ref="a95a5822f46344419114383afc616f13c" args="(const unsigned char *ccndid, size_t ccndid_size, const char *address, const char *port)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct ccn_face_instance* construct_face </td>
          <td>(</td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>ccndid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>ccndid_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Construct a new face instance based on the given address and port This face instance is only used to send new face request. </p>

<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00273">273</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span>ccn_face_instance *fi = calloc(1, <span class="keyword">sizeof</span>(*fi));
    <span class="keywordtype">char</span> rhostnamebuf[NI_MAXHOST];
    <span class="keywordtype">char</span> rhostportbuf[NI_MAXSERV];
    <span class="keyword">struct </span>addrinfo hints = {.ai_family = AF_UNSPEC, .ai_flags = (AI_ADDRCONFIG),
        .ai_socktype = SOCK_DGRAM};
    <span class="keyword">struct </span>addrinfo *raddrinfo = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">struct </span>ccn_charbuf *store = ccn_charbuf_create();
    <span class="keywordtype">int</span> host_off = -1;
    <span class="keywordtype">int</span> port_off = -1;
    <span class="keywordtype">int</span> res;

    res = getaddrinfo(address, port, &amp;hints, &amp;raddrinfo);
    <span class="keywordflow">if</span> (res != 0 || raddrinfo == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) 
    {
        fprintf(stderr, <span class="stringliteral">&quot;Error: getaddrinfo\n&quot;</span>);
        <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }

    res = getnameinfo(raddrinfo-&gt;ai_addr, raddrinfo-&gt;ai_addrlen,
            rhostnamebuf, <span class="keyword">sizeof</span>(rhostnamebuf),
            rhostportbuf, <span class="keyword">sizeof</span>(rhostportbuf),
            NI_NUMERICHOST | NI_NUMERICSERV);
    freeaddrinfo(raddrinfo);    
    <span class="keywordflow">if</span> (res != 0) 
    {
        fprintf(stderr, <span class="stringliteral">&quot;Error: getnameinfo\n&quot;</span>);
        <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }

    fi-&gt;store = store;
    fi-&gt;descr.ipproto = IPPROTO_UDP;
    fi-&gt;descr.mcast_ttl = <a class="code" href="ccn__fib_8h.html#acb89c63e135baf6977f8d6b41c0f225b">CCN_FIB_MCASTTTL</a>;
    fi-&gt;lifetime = <a class="code" href="ccn__fib_8h.html#a4c186f767fd69e1a1eb989e703930d9d">CCN_FIB_LIFETIME</a>;

    ccn_charbuf_append(store, <span class="stringliteral">&quot;newface&quot;</span>, strlen(<span class="stringliteral">&quot;newface&quot;</span>) + 1);
    host_off = store-&gt;length;
    ccn_charbuf_append(store, rhostnamebuf, strlen(rhostnamebuf) + 1);
    port_off = store-&gt;length;
    ccn_charbuf_append(store, rhostportbuf, strlen(rhostportbuf) + 1);

    <span class="keywordtype">char</span> *<a class="code" href="ripng__nexthop_8h.html#a337ad8a7e52da2d584c2018f2ec2c81e">b</a> = (<span class="keywordtype">char</span> *)store-&gt;buf;
    fi-&gt;action = b;
    fi-&gt;descr.address = b + host_off;
    fi-&gt;descr.port = b + port_off;
    fi-&gt;descr.source_address = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    fi-&gt;ccnd_id = ccndid;
    fi-&gt;ccnd_id_size = ccndid_size;

    <span class="keywordflow">return</span> fi;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a13cf09f8721beb1f3f6d2afc176e59c7"></a><!-- doxytag: member="ccn_fib.c::create_face" ref="a13cf09f8721beb1f3f6d2afc176e59c7" args="(struct ccn *h, struct ccn_charbuf *local_scope_template, struct ccn_charbuf *no_name, struct ccn_face_instance *face_instance)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct ccn_face_instance* create_face </td>
          <td>(</td>
          <td class="paramtype">struct ccn *&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct ccn_charbuf *&#160;</td>
          <td class="paramname"><em>local_scope_template</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct ccn_charbuf *&#160;</td>
          <td class="paramname"><em>no_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct ccn_face_instance *&#160;</td>
          <td class="paramname"><em>face_instance</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create new face by sending out a request Interest The actual new face instance is returned. </p>

<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00167">167</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span>ccn_charbuf *newface = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">struct </span>ccn_charbuf *signed_info = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">struct </span>ccn_charbuf *temp = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">struct </span>ccn_charbuf *<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">struct </span>ccn_charbuf *resultbuf = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">struct </span>ccn_parsed_ContentObject pcobuf = {0};
    <span class="keyword">struct </span>ccn_face_instance *new_face_instance = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptr = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keywordtype">size_t</span> <a class="code" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a> = 0;
    <span class="keywordtype">int</span> res = 0;

    <span class="comment">/* Encode the given face instance */</span>
    newface = ccn_charbuf_create();
    ccnb_append_face_instance(newface, face_instance);

    temp = ccn_charbuf_create();
    res = ccn_sign_content(h, temp, no_name, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, newface-&gt;buf, newface-&gt;length);
    resultbuf = ccn_charbuf_create();

    <span class="comment">/* Construct the Interest name that will create the face */</span>
    name = ccn_charbuf_create();
    ccn_name_init(name);
    ccn_name_append_str(name, <span class="stringliteral">&quot;ccnx&quot;</span>);
    ccn_name_append(name, face_instance-&gt;ccnd_id, face_instance-&gt;ccnd_id_size);
    ccn_name_append_str(name, face_instance-&gt;action);
    ccn_name_append(name, temp-&gt;buf, temp-&gt;length);

    <span class="comment">/* send Interest to retrieve Data that contains the newly created face */</span>
    res = ccn_get(h, name, local_scope_template, 1000, resultbuf, &amp;pcobuf, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);
    <a class="code" href="ccn__fib_8c.html#a8eac63cf968b7b4b72edd8971b5e646c">ON_ERROR_CLEANUP</a>(res);

    <span class="comment">/* decode Data to get the actual face instance */</span>
    res = ccn_content_get_value(resultbuf-&gt;buf, resultbuf-&gt;length, &amp;pcobuf, &amp;ptr, &amp;length);
    <a class="code" href="ccn__fib_8c.html#a8eac63cf968b7b4b72edd8971b5e646c">ON_ERROR_CLEANUP</a>(res);

    new_face_instance = ccn_face_instance_parse(ptr, length);

    ccn_charbuf_destroy(&amp;newface);
    ccn_charbuf_destroy(&amp;signed_info);
    ccn_charbuf_destroy(&amp;temp);
    ccn_charbuf_destroy(&amp;resultbuf);
    ccn_charbuf_destroy(&amp;name);

    <span class="keywordflow">return</span> new_face_instance;

    cleanup:
        ccn_charbuf_destroy(&amp;newface);
        ccn_charbuf_destroy(&amp;signed_info);
        ccn_charbuf_destroy(&amp;temp);
        ccn_charbuf_destroy(&amp;resultbuf);
        ccn_charbuf_destroy(&amp;name);

    <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a12135bbf63b584d60aa46bd61c0607fd"></a><!-- doxytag: member="ccn_fib.c::delete_ccn_face" ref="a12135bbf63b584d60aa46bd61c0607fd" args="(struct ccn *h, const char *uri, const char *address, const unsigned int p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int delete_ccn_face </td>
          <td>(</td>
          <td class="paramtype">struct ccn *&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>uri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Delete a ccn face for a name prefix. </p>

<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00419">419</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="ccn__fib_8c.html#af35bb2f8c05083a3744c8cc774cad4ac">add_delete_ccn_face</a>(h, uri, address, <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, <a class="code" href="ccn__fib_8h.html#a00eb5f887f0faa76fae2ab76fa23bf4b">OP_UNREG</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9e5c5841ad7489616006ec2f4835a09d"></a><!-- doxytag: member="ccn_fib.c::get_ccndid" ref="a9e5c5841ad7489616006ec2f4835a09d" args="(struct ccn *h, struct ccn_charbuf *local_scope_template, unsigned char *ccndid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int get_ccndid </td>
          <td>(</td>
          <td class="paramtype">struct ccn *&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct ccn_charbuf *&#160;</td>
          <td class="paramname"><em>local_scope_template</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>ccndid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get ccnd id. </p>

<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00231">231</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span>ccn_charbuf *<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">struct </span>ccn_charbuf *resultbuf = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">struct </span>ccn_parsed_ContentObject pcobuf = {0};
    <span class="keywordtype">char</span> ccndid_uri[] = <span class="stringliteral">&quot;ccnx:/%C1.M.S.localhost/%C1.M.SRV/ccnd/KEY&quot;</span>;
    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ccndid_result;
    <span class="keyword">static</span> <span class="keywordtype">size_t</span> ccndid_result_size;
    <span class="keywordtype">int</span> res;

    name = ccn_charbuf_create();
    resultbuf = ccn_charbuf_create();

    res = ccn_name_from_uri(name, ccndid_uri);
    <a class="code" href="ccn__fib_8c.html#a04ca4114f4488ec3ff95da3e6daad103">ON_ERROR_EXIT</a>(res, <span class="stringliteral">&quot;Unable to parse service locator URI for ccnd key\n&quot;</span>);

    <span class="comment">/* get Data */</span>
    res = ccn_get(h, name, local_scope_template, 4500, resultbuf, &amp;pcobuf, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);
    <a class="code" href="ccn__fib_8c.html#a04ca4114f4488ec3ff95da3e6daad103">ON_ERROR_EXIT</a>(res, <span class="stringliteral">&quot;Unable to get key from ccnd\n&quot;</span>);

    <span class="comment">/* extract from Data */</span>
    res = ccn_ref_tagged_BLOB(CCN_DTAG_PublisherPublicKeyDigest,
            resultbuf-&gt;buf,
            pcobuf.offset[CCN_PCO_B_PublisherPublicKeyDigest],
            pcobuf.offset[CCN_PCO_E_PublisherPublicKeyDigest],
            &amp;ccndid_result, &amp;ccndid_result_size);
    <a class="code" href="ccn__fib_8c.html#a04ca4114f4488ec3ff95da3e6daad103">ON_ERROR_EXIT</a>(res, <span class="stringliteral">&quot;Unable to parse ccnd response for ccnd id\n&quot;</span>);

    <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a>((<span class="keywordtype">void</span> *)ccndid, ccndid_result, ccndid_result_size);

    ccn_charbuf_destroy(&amp;name);
    ccn_charbuf_destroy(&amp;resultbuf);

    <span class="keywordflow">return</span> (ccndid_result_size);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aedd1f26f7a71e3d25900e35808036ab0"></a><!-- doxytag: member="ccn_fib.c::init_data" ref="aedd1f26f7a71e3d25900e35808036ab0" args="(struct ccn_charbuf *local_scope_template, struct ccn_charbuf *no_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void init_data </td>
          <td>(</td>
          <td class="paramtype">struct ccn_charbuf *&#160;</td>
          <td class="paramname"><em>local_scope_template</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct ccn_charbuf *&#160;</td>
          <td class="paramname"><em>no_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initialize local data </p>

<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00331">331</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    ccn_charbuf_append_tt(local_scope_template, CCN_DTAG_Interest, CCN_DTAG);
    ccn_charbuf_append_tt(local_scope_template, CCN_DTAG_Name, CCN_DTAG);
    ccn_charbuf_append_closer(local_scope_template);    <span class="comment">/* &lt;/Name&gt; */</span>
    ccnb_tagged_putf(local_scope_template, CCN_DTAG_Scope, <span class="stringliteral">&quot;1&quot;</span>);
    ccn_charbuf_append_closer(local_scope_template);    <span class="comment">/* &lt;/Interest&gt; */</span>

    ccn_name_init(no_name);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6ff717e78332e53e574f46e65b2a6028"></a><!-- doxytag: member="ccn_fib.c::on_error_exit" ref="a6ff717e78332e53e574f46e65b2a6028" args="(int res, int lineno, const char *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void on_error_exit </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lineno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00057">57</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (res &gt;= 0)
        <span class="keywordflow">return</span>;
    <a class="code" href="ccn__fib_8c.html#a791983e6c19c85d3dc39440c098de1e7">ccn_fib_fatal</a>(lineno, <span class="stringliteral">&quot;fatal error, res = %d, %s\n&quot;</span>, res, <a class="code" href="structmsg.html">msg</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8f6f4b812143ec6d511ec648e1fd8754"></a><!-- doxytag: member="ccn_fib.c::register_unregister_prefix" ref="a8f6f4b812143ec6d511ec648e1fd8754" args="(struct ccn *h, struct ccn_charbuf *local_scope_template, struct ccn_charbuf *no_name, struct ccn_charbuf *name_prefix, struct ccn_face_instance *face_instance, int operation)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int register_unregister_prefix </td>
          <td>(</td>
          <td class="paramtype">struct ccn *&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct ccn_charbuf *&#160;</td>
          <td class="paramname"><em>local_scope_template</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct ccn_charbuf *&#160;</td>
          <td class="paramname"><em>no_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct ccn_charbuf *&#160;</td>
          <td class="paramname"><em>name_prefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct ccn_face_instance *&#160;</td>
          <td class="paramname"><em>face_instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>operation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Bind a prefix to a face. </p>

<p>Definition at line <a class="el" href="ccn__fib_8c_source.html#l00087">87</a> of file <a class="el" href="ccn__fib_8c_source.html">ccn_fib.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span>ccn_charbuf *temp = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">struct </span>ccn_charbuf *resultbuf = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">struct </span>ccn_charbuf *signed_info = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">struct </span>ccn_charbuf *<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">struct </span>ccn_charbuf *prefixreg = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keyword">struct </span>ccn_parsed_ContentObject pcobuf = {0};
    <span class="keyword">struct </span>ccn_forwarding_entry forwarding_entry_storage = {0};
    <span class="keyword">struct </span>ccn_forwarding_entry *forwarding_entry = &amp;forwarding_entry_storage;
    <span class="keyword">struct </span>ccn_forwarding_entry *new_forwarding_entry;
    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptr = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    <span class="keywordtype">size_t</span> <a class="code" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a> = 0;
    <span class="keywordtype">int</span> res;

    <span class="comment">/* Register or unregister the prefix */</span>
    forwarding_entry-&gt;action = (operation == <a class="code" href="ccn__fib_8h.html#a73e89ddb5cae58b5357d85db0c3ed8d6">OP_REG</a>) ? <span class="stringliteral">&quot;prefixreg&quot;</span> : <span class="stringliteral">&quot;unreg&quot;</span>;
    forwarding_entry-&gt;name_prefix = <a class="code" href="structname__prefix.html">name_prefix</a>;
    forwarding_entry-&gt;ccnd_id = face_instance-&gt;ccnd_id;
    forwarding_entry-&gt;ccnd_id_size = face_instance-&gt;ccnd_id_size;
    forwarding_entry-&gt;faceid = face_instance-&gt;faceid;
    forwarding_entry-&gt;flags = -1;
    forwarding_entry-&gt;lifetime = 2100;

    prefixreg = ccn_charbuf_create();
    ccnb_append_forwarding_entry(prefixreg, forwarding_entry);
    temp = ccn_charbuf_create();
    res = ccn_sign_content(h, temp, no_name, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, prefixreg-&gt;buf, prefixreg-&gt;length);
    resultbuf = ccn_charbuf_create();

    <span class="comment">/* construct Interest containing prefixreg request */</span>
    name = ccn_charbuf_create();
    ccn_name_init(name);
    ccn_name_append_str(name, <span class="stringliteral">&quot;ccnx&quot;</span>);
    ccn_name_append(name, face_instance-&gt;ccnd_id, face_instance-&gt;ccnd_id_size);
    ccn_name_append_str(name, (operation == <a class="code" href="ccn__fib_8h.html#a73e89ddb5cae58b5357d85db0c3ed8d6">OP_REG</a>) ? <span class="stringliteral">&quot;prefixreg&quot;</span> : <span class="stringliteral">&quot;unreg&quot;</span>);
    ccn_name_append(name, temp-&gt;buf, temp-&gt;length);

    <span class="comment">/* send Interest, get Data */</span>
    res = ccn_get(h, name, local_scope_template, 1000, resultbuf, &amp;pcobuf, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);
    <a class="code" href="ccn__fib_8c.html#a8eac63cf968b7b4b72edd8971b5e646c">ON_ERROR_CLEANUP</a>(res);

    res = ccn_content_get_value(resultbuf-&gt;buf, resultbuf-&gt;length, &amp;pcobuf, &amp;ptr, &amp;length);
    <a class="code" href="ccn__fib_8c.html#a8eac63cf968b7b4b72edd8971b5e646c">ON_ERROR_CLEANUP</a>(res);
    
    <span class="comment">/* extract new forwarding entry from Data */</span>
    new_forwarding_entry = ccn_forwarding_entry_parse(ptr, length);
    <a class="code" href="ccn__fib_8c.html#a75a283d632fed04bbc5f9a72b238c884">ON_NULL_CLEANUP</a>(new_forwarding_entry);

    res = new_forwarding_entry-&gt;faceid;

    ccn_forwarding_entry_destroy(&amp;new_forwarding_entry);
    ccn_charbuf_destroy(&amp;signed_info);
    ccn_charbuf_destroy(&amp;temp);
    ccn_charbuf_destroy(&amp;resultbuf);
    ccn_charbuf_destroy(&amp;name);
    ccn_charbuf_destroy(&amp;prefixreg);

    <span class="keywordflow">return</span> res;

    cleanup:
        ccn_forwarding_entry_destroy(&amp;new_forwarding_entry);
        ccn_charbuf_destroy(&amp;signed_info);
        ccn_charbuf_destroy(&amp;temp);
        ccn_charbuf_destroy(&amp;resultbuf);
        ccn_charbuf_destroy(&amp;name);
        ccn_charbuf_destroy(&amp;prefixreg);

    <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ccn__fib_8c.html">ccn_fib.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:34 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
