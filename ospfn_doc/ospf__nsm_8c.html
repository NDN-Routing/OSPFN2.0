<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: ospfd/ospf_nsm.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ospf__nsm_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">ospfd/ospf_nsm.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="zebra_8h_source.html">zebra.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="thread_8h_source.html">thread.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="memory_8h_source.html">memory.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="hash_8h_source.html">hash.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linklist_8h_source.html">linklist.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="prefix_8h_source.html">prefix.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="if_8h_source.html">if.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="table_8h_source.html">table.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stream_8h_source.html">stream.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospfd_8h_source.html">ospfd/ospfd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospf__interface_8h_source.html">ospfd/ospf_interface.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospf__ism_8h_source.html">ospfd/ospf_ism.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospf__asbr_8h_source.html">ospfd/ospf_asbr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospf__lsa_8h_source.html">ospfd/ospf_lsa.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospf__lsdb_8h_source.html">ospfd/ospf_lsdb.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospf__neighbor_8h_source.html">ospfd/ospf_neighbor.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospf__nsm_8h_source.html">ospfd/ospf_nsm.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospf__network_8h_source.html">ospfd/ospf_network.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospf__packet_8h_source.html">ospfd/ospf_packet.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospf__dump_8h_source.html">ospfd/ospf_dump.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospf__flood_8h_source.html">ospfd/ospf_flood.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospf__abr_8h_source.html">ospfd/ospf_abr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ospf__snmp_8h_source.html">ospfd/ospf_snmp.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ospf_nsm.c:</div>
<div class="dyncontent">
<div class="center"><img src="ospf__nsm_8c__incl.png" border="0" usemap="#ospfd_2ospf__nsm_8c" alt=""/></div>
<map name="ospfd_2ospf__nsm_8c" id="ospfd_2ospf__nsm_8c">
<area shape="rect" id="node3" href="zebra_8h.html" title="zebra.h" alt="" coords="1259,155,1325,181"/><area shape="rect" id="node55" href="thread_8h.html" title="thread.h" alt="" coords="1045,80,1117,107"/><area shape="rect" id="node57" href="memory_8h.html" title="memory.h" alt="" coords="1141,80,1224,107"/><area shape="rect" id="node59" href="hash_8h.html" title="hash.h" alt="" coords="1248,80,1309,107"/><area shape="rect" id="node61" href="linklist_8h.html" title="linklist.h" alt="" coords="1065,155,1135,181"/><area shape="rect" id="node63" href="prefix_8h.html" title="prefix.h" alt="" coords="2561,229,2628,256"/><area shape="rect" id="node65" href="if_8h.html" title="if.h" alt="" coords="981,80,1021,107"/><area shape="rect" id="node68" href="table_8h.html" title="table.h" alt="" coords="1565,80,1629,107"/><area shape="rect" id="node70" href="stream_8h.html" title="stream.h" alt="" coords="2557,155,2632,181"/><area shape="rect" id="node73" href="log_8h.html" title="log.h" alt="" coords="1627,155,1679,181"/><area shape="rect" id="node76" href="ospfd_8h.html" title="ospfd/ospfd.h" alt="" coords="1435,80,1541,107"/><area shape="rect" id="node80" href="ospf__interface_8h.html" title="ospfd/ospf_interface.h" alt="" coords="1989,80,2147,107"/><area shape="rect" id="node82" href="ospf__packet_8h.html" title="ospfd/ospf_packet.h" alt="" coords="1812,155,1959,181"/><area shape="rect" id="node84" href="ospf__ism_8h.html" title="ospfd/ospf_ism.h" alt="" coords="2171,80,2297,107"/><area shape="rect" id="node86" href="ospf__asbr_8h.html" title="ospfd/ospf_asbr.h" alt="" coords="2323,80,2453,107"/><area shape="rect" id="node88" href="ospf__lsa_8h.html" title="ospfd/ospf_lsa.h" alt="" coords="2683,80,2805,107"/><area shape="rect" id="node91" href="ospf__lsdb_8h.html" title="ospfd/ospf_lsdb.h" alt="" coords="2528,80,2659,107"/><area shape="rect" id="node93" href="ospf__neighbor_8h.html" title="ospfd/ospf_neighbor.h" alt="" coords="1806,80,1964,107"/><area shape="rect" id="node96" href="ospf__nsm_8h.html" title="ospfd/ospf_nsm.h" alt="" coords="2829,80,2960,107"/><area shape="rect" id="node98" href="ospf__network_8h.html" title="ospfd/ospf_network.h" alt="" coords="2984,80,3139,107"/><area shape="rect" id="node101" href="ospf__dump_8h.html" title="ospfd/ospf_dump.h" alt="" coords="3163,80,3301,107"/><area shape="rect" id="node103" href="ospf__flood_8h.html" title="ospfd/ospf_flood.h" alt="" coords="3325,80,3461,107"/><area shape="rect" id="node105" href="ospf__abr_8h.html" title="ospfd/ospf_abr.h" alt="" coords="3486,80,3609,107"/><area shape="rect" id="node107" href="ospf__snmp_8h.html" title="ospfd/ospf_snmp.h" alt="" coords="3635,80,3773,107"/></map>
</div>
</div>
<p><a href="ospf__nsm_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#a1a2ec67f48f6cdebf86fbcef972ad721">nsm_clear_adj</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#a538735cb90fed88c2a73e3073a41eef1">ospf_inactivity_timer</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#ab1b077a595491f8b7c5b08adcbade07c">ospf_db_desc_timer</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#a5fbae8b20facd83cfe8d9f5ce1ff5658">nsm_timer_set</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#ad17b9a8a8a6d03fa0e451794a6f173b0">nsm_should_adj</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#a8b8631b6c702b54d80f3c8b10ed0fb13">nsm_hello_received</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#ad333a1c46c27084d4250f90fc22618de">nsm_start</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#a53e2e2f5742584b8cc554dc7e8e4d3ec">nsm_twoway_received</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#aa880af5829d8741b9012bf64e3c7a0c9">ospf_db_summary_count</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#ac37bb4e71b7ca701aeec1bb101340ae3">ospf_db_summary_isempty</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#a04cb91edc2aa9251f5b79f9290997de4">ospf_db_summary_add</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr, struct <a class="el" href="structospf__lsa.html">ospf_lsa</a> *lsa)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#a3f2d40c890bf5146459e631083a4677b">ospf_db_summary_clear</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#afda0f7616d3cbedc939b508786356d0e">nsm_negotiation_done</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#ac3ca342d917bd34713acb81b72cf3997">nsm_exchange_done</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#aefc2cca9363db6369db163bd1a754c57">nsm_adj_ok</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#ad40227d1e15fa7469335ce637f6681e0">nsm_kill_nbr</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#aafaeb52974679a4579059489345079d6">nsm_notice_state_change</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr, int <a class="el" href="ospf__nsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a>, int <a class="el" href="vty_8c.html#a3b65133bb9997cd1ccf311af0927fc9e">event</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#a8df02ba42645a2104db36fac33afea34">nsm_change_state</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr, int state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#a87769e248868b1d0acbe5afdfa8912f1">ospf_nsm_event</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#a8c79532418548f4027b82bc41b4ed871">ospf_check_nbr_loading</a> (struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *nbr)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" >struct {</td></tr>
<tr><td class="memItemLeft" >&#160;&#160;&#160;int(*&#160;&#160;&#160;<a class="el" href="ospf__nsm_8c.html#a03307f8a561731a5c5657834da57ab11">func</a> )(struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *)</td></tr>
<tr><td class="memItemLeft" >&#160;&#160;&#160;int&#160;&#160;&#160;<a class="el" href="ospf__nsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a></td></tr>
<tr><td class="memItemLeft" valign="top">}&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#adbabdc9ffe6b3d5d187a1eed134c2141">NSM</a> [OSPF_NSM_STATE_MAX][OSPF_NSM_EVENT_MAX]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ospf__nsm_8c.html#a574380804c81a262de3cc8a42c713539">ospf_nsm_event_str</a> []</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aefc2cca9363db6369db163bd1a754c57"></a><!-- doxytag: member="ospf_nsm.c::nsm_adj_ok" ref="aefc2cca9363db6369db163bd1a754c57" args="(struct ospf_neighbor *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int nsm_adj_ok </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00334">334</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> <a class="code" href="bgp__fsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a> = nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a>;
  <span class="keywordtype">int</span> adj = <a class="code" href="ospf__nsm_8c.html#ad17b9a8a8a6d03fa0e451794a6f173b0">nsm_should_adj</a> (nbr);

  <span class="keywordflow">if</span> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a> == <a class="code" href="ospf__nsm_8h.html#a8a9d14bfc7d840e04eff13df3337fa24">NSM_TwoWay</a> &amp;&amp; adj == 1)
    next_state = <a class="code" href="ospf__nsm_8h.html#aa02b0a534709b4557e46db7b31bbedd7">NSM_ExStart</a>;
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a> &gt;= <a class="code" href="ospf__nsm_8h.html#aa02b0a534709b4557e46db7b31bbedd7">NSM_ExStart</a> &amp;&amp; adj == 0)
    next_state = <a class="code" href="ospf__nsm_8h.html#a8a9d14bfc7d840e04eff13df3337fa24">NSM_TwoWay</a>;

  <span class="keywordflow">return</span> <a class="code" href="bgp__fsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8df02ba42645a2104db36fac33afea34"></a><!-- doxytag: member="ospf_nsm.c::nsm_change_state" ref="a8df02ba42645a2104db36fac33afea34" args="(struct ospf_neighbor *nbr, int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nsm_change_state </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00647">647</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structospf__interface.html">ospf_interface</a> *oi = nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>;
  <span class="keyword">struct </span><a class="code" href="structospf__area.html">ospf_area</a> *vl_area = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  u_char old_state;
  <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a3162ada50d1df39e0f0555ea3d60dea1">x</a>;
  <span class="keywordtype">int</span> force = 1;
  
  <span class="comment">/* Preserve old status. */</span>
  old_state = nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a>;

  <span class="comment">/* Change to new status. */</span>
  nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a> = state;

  <span class="comment">/* Statistics. */</span>
  nbr-&gt;<a class="code" href="structospf__neighbor.html#a177ea967e71e4f14cc26a019e06ea533">state_change</a>++;

  <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf__interface.html#adb923b0bfebf30738af57dafcf0d0d57">type</a> == <a class="code" href="ospf__interface_8h.html#a45798a2a8b566abd1907f7ae8bc0a2be">OSPF_IFTYPE_VIRTUALLINK</a>)
    vl_area = <a class="code" href="ospfd_8c.html#a24d6ed2a6a05e4856e6dbf5eea74f6ef">ospf_area_lookup_by_area_id</a> (oi-&gt;<a class="code" href="structospf__interface.html#a159ae1c542016fc78f68c3e39a1b132e">ospf</a>, oi-&gt;<a class="code" href="structospf__interface.html#a78d2dfea28a4b72d89b194cf6a94cae1">vl_data</a>-&gt;<a class="code" href="structospf__vl__data.html#a7d89fa86fa918d94b7b4474f93569cd9">vl_area_id</a>);

  <span class="comment">/* One of the neighboring routers changes to/from the FULL state. */</span>
  <span class="keywordflow">if</span> ((old_state != <a class="code" href="ospf__nsm_8h.html#aae3fb624a87adcc8ae4d12d694fc0929">NSM_Full</a> &amp;&amp; state == <a class="code" href="ospf__nsm_8h.html#aae3fb624a87adcc8ae4d12d694fc0929">NSM_Full</a>) ||
      (old_state == <a class="code" href="ospf__nsm_8h.html#aae3fb624a87adcc8ae4d12d694fc0929">NSM_Full</a> &amp;&amp; state != <a class="code" href="ospf__nsm_8h.html#aae3fb624a87adcc8ae4d12d694fc0929">NSM_Full</a>))
    {
      <span class="keywordflow">if</span> (state == <a class="code" href="ospf__nsm_8h.html#aae3fb624a87adcc8ae4d12d694fc0929">NSM_Full</a>)
    {
      oi-&gt;<a class="code" href="structospf__interface.html#a6030ef4a9cb03295e6ab3481df3e6147">full_nbrs</a>++;
      oi-&gt;<a class="code" href="structospf__interface.html#a7a0df59739f1ffa31ab75ff4b9bbcd95">area</a>-&gt;<a class="code" href="structospf__area.html#a44f3838cd2e8fb5bd14a8c5cd1c2a0cd">full_nbrs</a>++;

          <a class="code" href="ospf__abr_8c.html#aae7756099eb070db13009f36bfd7736f">ospf_check_abr_status</a> (oi-&gt;<a class="code" href="structospf__interface.html#a159ae1c542016fc78f68c3e39a1b132e">ospf</a>);

      <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf__interface.html#adb923b0bfebf30738af57dafcf0d0d57">type</a> == <a class="code" href="ospf__interface_8h.html#a45798a2a8b566abd1907f7ae8bc0a2be">OSPF_IFTYPE_VIRTUALLINK</a> &amp;&amp; vl_area)
            <span class="keywordflow">if</span> (++vl_area-&gt;<a class="code" href="structospf__area.html#ab13a3eb52aec5fe41243fa7bef238fbc">full_vls</a> == 1)
          <a class="code" href="ospf__abr_8c.html#a1ff6c727604d00c49b9c4a26131e5462">ospf_schedule_abr_task</a> (oi-&gt;<a class="code" href="structospf__interface.html#a159ae1c542016fc78f68c3e39a1b132e">ospf</a>);

      <span class="comment">/* kevinm: refresh any redistributions */</span>
      <span class="keywordflow">for</span> (x = <a class="code" href="zebra_8h.html#a650967617adbd419d14e5e05d9548108">ZEBRA_ROUTE_SYSTEM</a>; x &lt; <a class="code" href="zebra_8h.html#aec97442680d773fd62f9af5c9426b842">ZEBRA_ROUTE_MAX</a>; x++)
        {
          <span class="keywordflow">if</span> (x == <a class="code" href="zebra_8h.html#a35ba23125eb2c360943b1bad51673ab0">ZEBRA_ROUTE_OSPF</a> || x == <a class="code" href="zebra_8h.html#ae05c36542e3fb1c5c7fd440ac322331f">ZEBRA_ROUTE_OSPF6</a>)
        <span class="keywordflow">continue</span>;
          <a class="code" href="ospf__lsa_8c.html#aef94b25c2a2fad9088e82a85ee71f226">ospf_external_lsa_refresh_type</a> (oi-&gt;<a class="code" href="structospf__interface.html#a159ae1c542016fc78f68c3e39a1b132e">ospf</a>, x, force);
        }
          <span class="comment">/* XXX: Clearly some thing is wrong with refresh of external LSAs</span>
<span class="comment">           * this added to hack around defaults not refreshing after a timer</span>
<span class="comment">           * jump.</span>
<span class="comment">           */</span>
          <a class="code" href="ospf__lsa_8c.html#a1be6376d9b23634a76f2a6a07833fe1e">ospf_external_lsa_refresh_default</a> (oi-&gt;<a class="code" href="structospf__interface.html#a159ae1c542016fc78f68c3e39a1b132e">ospf</a>);
    }
      <span class="keywordflow">else</span>
    {
      oi-&gt;<a class="code" href="structospf__interface.html#a6030ef4a9cb03295e6ab3481df3e6147">full_nbrs</a>--;
      oi-&gt;<a class="code" href="structospf__interface.html#a7a0df59739f1ffa31ab75ff4b9bbcd95">area</a>-&gt;<a class="code" href="structospf__area.html#a44f3838cd2e8fb5bd14a8c5cd1c2a0cd">full_nbrs</a>--;

          <a class="code" href="ospf__abr_8c.html#aae7756099eb070db13009f36bfd7736f">ospf_check_abr_status</a> (oi-&gt;<a class="code" href="structospf__interface.html#a159ae1c542016fc78f68c3e39a1b132e">ospf</a>);

      <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf__interface.html#adb923b0bfebf30738af57dafcf0d0d57">type</a> == <a class="code" href="ospf__interface_8h.html#a45798a2a8b566abd1907f7ae8bc0a2be">OSPF_IFTYPE_VIRTUALLINK</a> &amp;&amp; vl_area)
        <span class="keywordflow">if</span> (vl_area-&gt;<a class="code" href="structospf__area.html#ab13a3eb52aec5fe41243fa7bef238fbc">full_vls</a> &gt; 0)
          <span class="keywordflow">if</span> (--vl_area-&gt;<a class="code" href="structospf__area.html#ab13a3eb52aec5fe41243fa7bef238fbc">full_vls</a> == 0)
        <a class="code" href="ospf__abr_8c.html#a1ff6c727604d00c49b9c4a26131e5462">ospf_schedule_abr_task</a> (oi-&gt;<a class="code" href="structospf__interface.html#a159ae1c542016fc78f68c3e39a1b132e">ospf</a>);
    }

      <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a> (<span class="stringliteral">&quot;nsm_change_state(%s, %s -&gt; %s): &quot;</span>
         <span class="stringliteral">&quot;scheduling new router-LSA origination&quot;</span>,
         inet_ntoa (nbr-&gt;<a class="code" href="structospf__neighbor.html#a2257238c9040a76e9de9a78cf95bae0d">router_id</a>),
         <a class="code" href="log_8h.html#a3a4b1cad85aa6752f39580944e24a868">LOOKUP</a>(<a class="code" href="ospf__dump_8c.html#a7addd69d09415cd935c591a40b74ac46">ospf_nsm_state_msg</a>, old_state),
         <a class="code" href="log_8h.html#a3a4b1cad85aa6752f39580944e24a868">LOOKUP</a>(<a class="code" href="ospf__dump_8c.html#a7addd69d09415cd935c591a40b74ac46">ospf_nsm_state_msg</a>, state));

      <a class="code" href="ospf__lsa_8c.html#a66ad8a1fd151b43b11d7ec9650a644bf">ospf_router_lsa_timer_add</a> (oi-&gt;<a class="code" href="structospf__interface.html#a7a0df59739f1ffa31ab75ff4b9bbcd95">area</a>);

      <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf__interface.html#adb923b0bfebf30738af57dafcf0d0d57">type</a> == <a class="code" href="ospf__interface_8h.html#a45798a2a8b566abd1907f7ae8bc0a2be">OSPF_IFTYPE_VIRTUALLINK</a>)
    {
      <span class="keyword">struct </span><a class="code" href="structospf__area.html">ospf_area</a> *vl_area =
        <a class="code" href="ospfd_8c.html#a24d6ed2a6a05e4856e6dbf5eea74f6ef">ospf_area_lookup_by_area_id</a> (oi-&gt;<a class="code" href="structospf__interface.html#a159ae1c542016fc78f68c3e39a1b132e">ospf</a>, oi-&gt;<a class="code" href="structospf__interface.html#a78d2dfea28a4b72d89b194cf6a94cae1">vl_data</a>-&gt;<a class="code" href="structospf__vl__data.html#a7d89fa86fa918d94b7b4474f93569cd9">vl_area_id</a>);
      
      <span class="keywordflow">if</span> (vl_area)
        <a class="code" href="ospf__lsa_8c.html#a66ad8a1fd151b43b11d7ec9650a644bf">ospf_router_lsa_timer_add</a> (vl_area);
    }

      <span class="comment">/* Originate network-LSA. */</span>
      <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf__interface.html#a26605b9cc792cdd3e26c0481d24f0f63">state</a> == <a class="code" href="ospf__ism_8h.html#a7f179a571f4f8e112c0b887f39c87f23">ISM_DR</a>)
    {
      <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf__interface.html#a175c090a388cfc7d255012d0d569df6d">network_lsa_self</a> &amp;&amp; oi-&gt;<a class="code" href="structospf__interface.html#a6030ef4a9cb03295e6ab3481df3e6147">full_nbrs</a> == 0)
        {
          <a class="code" href="ospf__flood_8c.html#ad3049ba87364a6fbed7d352023e33a4a">ospf_lsa_flush_area</a> (oi-&gt;<a class="code" href="structospf__interface.html#a175c090a388cfc7d255012d0d569df6d">network_lsa_self</a>, oi-&gt;<a class="code" href="structospf__interface.html#a7a0df59739f1ffa31ab75ff4b9bbcd95">area</a>);
          <a class="code" href="ospf__lsa_8c.html#a268fc5c6673caf7ee94c0eaaa88455b8">ospf_lsa_unlock</a> (&amp;oi-&gt;<a class="code" href="structospf__interface.html#a175c090a388cfc7d255012d0d569df6d">network_lsa_self</a>);
          oi-&gt;<a class="code" href="structospf__interface.html#a175c090a388cfc7d255012d0d569df6d">network_lsa_self</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
          <a class="code" href="ospfd_8h.html#aad5b9afadb0a72aae30f4a7e750cc66a">OSPF_TIMER_OFF</a> (oi-&gt;<a class="code" href="structospf__interface.html#a278866980d98aa3ae2c393acb08c0337">t_network_lsa_self</a>);
        }
      <span class="keywordflow">else</span>
        <a class="code" href="ospf__lsa_8c.html#a42678c90c94d537b3d9c905d4685e2c5">ospf_network_lsa_timer_add</a> (oi);
    }
    }

<span class="preprocessor">#ifdef HAVE_OPAQUE_LSA</span>
<span class="preprocessor"></span>  <a class="code" href="ospf__opaque_8h.html#a2349d620cc402245a1e47d7ce5b4fc2e">ospf_opaque_nsm_change</a> (nbr, old_state);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_OPAQUE_LSA */</span>

  <span class="comment">/* State changes from &gt; ExStart to &lt;= ExStart should clear any Exchange</span>
<span class="comment">   * or Full/LSA Update related lists and state.</span>
<span class="comment">   * Potential causal events: BadLSReq, SeqNumberMismatch, AdjOK?</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> ((old_state &gt; <a class="code" href="ospf__nsm_8h.html#aa02b0a534709b4557e46db7b31bbedd7">NSM_ExStart</a>) &amp;&amp; (state &lt;= <a class="code" href="ospf__nsm_8h.html#aa02b0a534709b4557e46db7b31bbedd7">NSM_ExStart</a>))
    <a class="code" href="ospf__nsm_8c.html#a1a2ec67f48f6cdebf86fbcef972ad721">nsm_clear_adj</a> (nbr);

  <span class="comment">/* Start DD exchange protocol */</span>
  <span class="keywordflow">if</span> (state == <a class="code" href="ospf__nsm_8h.html#aa02b0a534709b4557e46db7b31bbedd7">NSM_ExStart</a>)
    {
      <span class="keywordflow">if</span> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a8d065d2872e94ddd25727faee7c39a7c">dd_seqnum</a> == 0)
    nbr-&gt;<a class="code" href="structospf__neighbor.html#a8d065d2872e94ddd25727faee7c39a7c">dd_seqnum</a> = <a class="code" href="thread_8c.html#acbaf2206b84f93fbe18f33483bf101d2">quagga_time</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
      <span class="keywordflow">else</span>
    nbr-&gt;<a class="code" href="structospf__neighbor.html#a8d065d2872e94ddd25727faee7c39a7c">dd_seqnum</a>++;

      nbr-&gt;<a class="code" href="structospf__neighbor.html#afd7a64a3a213196cc5dd3c4c5b2e2a5b">dd_flags</a> = <a class="code" href="ospfd_8h.html#afbd1b8930e1f40abaeaf47d3d978d21d">OSPF_DD_FLAG_I</a>|<a class="code" href="ospfd_8h.html#a6b39a0f2e2f0415a60230aa869cabb48">OSPF_DD_FLAG_M</a>|<a class="code" href="ospfd_8h.html#ab3fc3af333a4f7ffe2a5d89dd794c124">OSPF_DD_FLAG_MS</a>;
      <a class="code" href="ospf__packet_8c.html#adaf5568141a0f47dc301981cfb92fbfb">ospf_db_desc_send</a> (nbr);
    }

  <span class="comment">/* clear cryptographic sequence number */</span>
  <span class="keywordflow">if</span> (state == <a class="code" href="ospf__nsm_8h.html#a4bdf4e7631050dcf28cbe7959f0675ce">NSM_Down</a>)
    nbr-&gt;<a class="code" href="structospf__neighbor.html#a20275ce82383ee306fddb23a4d6684ab">crypt_seqnum</a> = 0;
  
  <span class="comment">/* Generete NeighborChange ISM event. */</span>
  <span class="keywordflow">switch</span> (oi-&gt;<a class="code" href="structospf__interface.html#a26605b9cc792cdd3e26c0481d24f0f63">state</a>) {
  <span class="keywordflow">case</span> <a class="code" href="ospf__ism_8h.html#a63c91d64f244427665286ca82eaeea04">ISM_DROther</a>:
  <span class="keywordflow">case</span> <a class="code" href="ospf__ism_8h.html#a3676782add5a8ecdb86981965ef9f37e">ISM_Backup</a>:
  <span class="keywordflow">case</span> <a class="code" href="ospf__ism_8h.html#a7f179a571f4f8e112c0b887f39c87f23">ISM_DR</a>:
    <span class="keywordflow">if</span> ((old_state &lt; NSM_TwoWay &amp;&amp; state &gt;= <a class="code" href="ospf__nsm_8h.html#a8a9d14bfc7d840e04eff13df3337fa24">NSM_TwoWay</a>) ||
        (old_state &gt;= <a class="code" href="ospf__nsm_8h.html#a8a9d14bfc7d840e04eff13df3337fa24">NSM_TwoWay</a> &amp;&amp; state &lt; <a class="code" href="ospf__nsm_8h.html#a8a9d14bfc7d840e04eff13df3337fa24">NSM_TwoWay</a>))
      <a class="code" href="ospf__ism_8h.html#a49b78d0f7b9cbc604466a345265bd846">OSPF_ISM_EVENT_EXECUTE</a> (oi, <a class="code" href="ospf__ism_8h.html#a2b12c9aa9a4cabd2064157cfe3d1fed4">ISM_NeighborChange</a>);
    <span class="keywordflow">break</span>;
  <span class="keywordflow">default</span>:
    <span class="comment">/* ISM_PointToPoint -&gt; ISM_Down, ISM_Loopback -&gt; ISM_Down, etc. */</span>
    <span class="keywordflow">break</span>;
  }

  <span class="comment">/* Preserve old status? */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1a2ec67f48f6cdebf86fbcef972ad721"></a><!-- doxytag: member="ospf_nsm.c::nsm_clear_adj" ref="a1a2ec67f48f6cdebf86fbcef972ad721" args="(struct ospf_neighbor *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void nsm_clear_adj </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00352">352</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">/* Clear Database Summary list. */</span>
  <span class="keywordflow">if</span> (!<a class="code" href="ospf__nsm_8c.html#ac37bb4e71b7ca701aeec1bb101340ae3">ospf_db_summary_isempty</a> (nbr))
    <a class="code" href="ospf__nsm_8c.html#a3f2d40c890bf5146459e631083a4677b">ospf_db_summary_clear</a> (nbr);

  <span class="comment">/* Clear Link State Request list. */</span>
  <span class="keywordflow">if</span> (!<a class="code" href="ospf__flood_8c.html#a1fad8802afa3d754e1ecf810d7cc1bd5">ospf_ls_request_isempty</a> (nbr))
    <a class="code" href="ospf__flood_8c.html#a90c072738e661b151c8fd6b180cb7fcd">ospf_ls_request_delete_all</a> (nbr);

  <span class="comment">/* Clear Link State Retransmission list. */</span>
  <span class="keywordflow">if</span> (!<a class="code" href="ospf__flood_8c.html#a00eeafc55321936ff86756ad0804c98b">ospf_ls_retransmit_isempty</a> (nbr))
    <a class="code" href="ospf__flood_8c.html#afa1fd3e1ddaf46a4674019b35f527667">ospf_ls_retransmit_clear</a> (nbr);

<span class="preprocessor">#ifdef HAVE_OPAQUE_LSA</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#aefbbf7455ee0d73ae283d9ab8edab4f6">options</a>, <a class="code" href="ospfd_8h.html#a3273018c458aa48440274e21e935c85f">OSPF_OPTION_O</a>))
    <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#aefbbf7455ee0d73ae283d9ab8edab4f6">options</a>, <a class="code" href="ospfd_8h.html#a3273018c458aa48440274e21e935c85f">OSPF_OPTION_O</a>);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_OPAQUE_LSA */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac3ca342d917bd34713acb81b72cf3997"></a><!-- doxytag: member="ospf_nsm.c::nsm_exchange_done" ref="ac3ca342d917bd34713acb81b72cf3997" args="(struct ospf_neighbor *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int nsm_exchange_done </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00322">322</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (<a class="code" href="ospf__flood_8c.html#a1fad8802afa3d754e1ecf810d7cc1bd5">ospf_ls_request_isempty</a> (nbr))
    <span class="keywordflow">return</span> <a class="code" href="ospf__nsm_8h.html#aae3fb624a87adcc8ae4d12d694fc0929">NSM_Full</a>;

  <span class="comment">/* Send Link State Request. */</span>
  <a class="code" href="ospf__packet_8c.html#a6ebacc4d964f773f52e1f4f184d5b622">ospf_ls_req_send</a> (nbr);

  <span class="keywordflow">return</span> <a class="code" href="ospf__nsm_8h.html#ab83ae0b2039dc911b4752c05da97bc8b">NSM_Loading</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8b8631b6c702b54d80f3c8b10ed0fb13"></a><!-- doxytag: member="ospf_nsm.c::nsm_hello_received" ref="a8b8631b6c702b54d80f3c8b10ed0fb13" args="(struct ospf_neighbor *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int nsm_hello_received </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00165">165</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">/* Start or Restart Inactivity Timer. */</span>
  <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a45b4258ca43f3e01958adfe4c7b8bd0b">t_inactivity</a>);
  
  <a class="code" href="ospf__nsm_8h.html#a13172a390c4ab15fea61d66d2c9262d9">OSPF_NSM_TIMER_ON</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a45b4258ca43f3e01958adfe4c7b8bd0b">t_inactivity</a>, <a class="code" href="ospf__nsm_8c.html#a538735cb90fed88c2a73e3073a41eef1">ospf_inactivity_timer</a>,
             nbr-&gt;<a class="code" href="structospf__neighbor.html#a4e51d35a798becc9ffa76cda3462caaf">v_inactivity</a>);

  <span class="keywordflow">if</span> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#adb923b0bfebf30738af57dafcf0d0d57">type</a> == <a class="code" href="ospf__interface_8h.html#abf2c650e64355936c071432d92dd5ecb">OSPF_IFTYPE_NBMA</a> &amp;&amp; nbr-&gt;<a class="code" href="structospf__neighbor.html#a68b82493dd68fd0a271db2e168c36617">nbr_nbma</a>)
    <a class="code" href="ospfd_8h.html#a00739e4ae75021e7e134dc6b292a9f2b">OSPF_POLL_TIMER_OFF</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a68b82493dd68fd0a271db2e168c36617">nbr_nbma</a>-&gt;<a class="code" href="structospf__nbr__nbma.html#a9aa6dd806f5903f6a4ded3ee4ca26e29">t_poll</a>);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad40227d1e15fa7469335ce637f6681e0"></a><!-- doxytag: member="ospf_nsm.c::nsm_kill_nbr" ref="ad40227d1e15fa7469335ce637f6681e0" args="(struct ospf_neighbor *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int nsm_kill_nbr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00373">373</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">/* killing nbr_self is invalid */</span>
  <span class="keywordflow">if</span> (nbr == nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#a6450831debea20d192ad89e650d0edab">nbr_self</a>)
    {
      <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (nbr != nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#a6450831debea20d192ad89e650d0edab">nbr_self</a>);
      <span class="keywordflow">return</span> 0;
    }
  
  <span class="keywordflow">if</span> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#adb923b0bfebf30738af57dafcf0d0d57">type</a> == <a class="code" href="ospf__interface_8h.html#abf2c650e64355936c071432d92dd5ecb">OSPF_IFTYPE_NBMA</a> &amp;&amp; nbr-&gt;<a class="code" href="structospf__neighbor.html#a68b82493dd68fd0a271db2e168c36617">nbr_nbma</a> != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      <span class="keyword">struct </span><a class="code" href="structospf__nbr__nbma.html">ospf_nbr_nbma</a> *nbr_nbma = nbr-&gt;<a class="code" href="structospf__neighbor.html#a68b82493dd68fd0a271db2e168c36617">nbr_nbma</a>;

      nbr_nbma-&gt;<a class="code" href="structospf__nbr__nbma.html#a83ef55950b998c17f62cf49e6d48494d">nbr</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
      nbr_nbma-&gt;<a class="code" href="structospf__nbr__nbma.html#a4edd94869d8b614378f091617fdd40ad">state_change</a> = nbr-&gt;<a class="code" href="structospf__neighbor.html#a177ea967e71e4f14cc26a019e06ea533">state_change</a>;

      nbr-&gt;<a class="code" href="structospf__neighbor.html#a68b82493dd68fd0a271db2e168c36617">nbr_nbma</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

      <a class="code" href="ospfd_8h.html#ac2416fe7bfb9581d7d9c05b7326be6c1">OSPF_POLL_TIMER_ON</a> (nbr_nbma-&gt;<a class="code" href="structospf__nbr__nbma.html#a9aa6dd806f5903f6a4ded3ee4ca26e29">t_poll</a>, <a class="code" href="ospf__packet_8c.html#a2232cdce5e30b12f8f9d29a49952b8f8">ospf_poll_timer</a>,
              nbr_nbma-&gt;<a class="code" href="structospf__nbr__nbma.html#ac2f40d497fd994774eaa662ba7a45f9d">v_poll</a>);

      <span class="keywordflow">if</span> (<a class="code" href="ospf__dump_8h.html#a065e478fcd8bd7a409804fc9e9e67e70">IS_DEBUG_OSPF</a> (nsm, NSM_EVENTS))
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;NSM[%s:%s]: Down (PollIntervalTimer scheduled)&quot;</span>,
           <a class="code" href="ospf__dump_8h.html#a8617b8a577debdfb2cd2f08c41066497">IF_NAME</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>), inet_ntoa (nbr-&gt;<a class="code" href="structospf__neighbor.html#a4be3cd4b416bc267a4e3b35b9e2b1102">address</a>.u.<a class="code" href="structprefix.html#ab37b8922554b41b7dc2417d8f37e7829">prefix4</a>));  
    }

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afda0f7616d3cbedc939b508786356d0e"></a><!-- doxytag: member="ospf_nsm.c::nsm_negotiation_done" ref="afda0f7616d3cbedc939b508786356d0e" args="(struct ospf_neighbor *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int nsm_negotiation_done </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00273">273</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structospf__area.html">ospf_area</a> *<a class="code" href="ospf__vty_8c.html#a7030c85f46deeffac793079c664c14ce">area</a> = nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#a7a0df59739f1ffa31ab75ff4b9bbcd95">area</a>;
  <span class="keyword">struct </span><a class="code" href="structospf__lsa.html">ospf_lsa</a> *lsa;
  <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *rn;

  <a class="code" href="ospf__lsdb_8h.html#a3112a41cf80dfabbf2962e8df1b8504b">LSDB_LOOP</a> (<a class="code" href="ospf__lsdb_8h.html#a9b953d2ac1c54862e897adada93cb8a4">ROUTER_LSDB</a> (area), rn, lsa)
    <a class="code" href="ospf__nsm_8c.html#a04cb91edc2aa9251f5b79f9290997de4">ospf_db_summary_add</a> (nbr, lsa);
  <a class="code" href="ospf__lsdb_8h.html#a3112a41cf80dfabbf2962e8df1b8504b">LSDB_LOOP</a> (<a class="code" href="ospf__lsdb_8h.html#a73230fbde5946c52a9905d9d56f5eb0d">NETWORK_LSDB</a> (area), rn, lsa)
    <a class="code" href="ospf__nsm_8c.html#a04cb91edc2aa9251f5b79f9290997de4">ospf_db_summary_add</a> (nbr, lsa);
  <a class="code" href="ospf__lsdb_8h.html#a3112a41cf80dfabbf2962e8df1b8504b">LSDB_LOOP</a> (<a class="code" href="ospf__lsdb_8h.html#a58ae6df59f7476d7784e19f7ca19db1f">SUMMARY_LSDB</a> (area), rn, lsa)
    <a class="code" href="ospf__nsm_8c.html#a04cb91edc2aa9251f5b79f9290997de4">ospf_db_summary_add</a> (nbr, lsa);
  <a class="code" href="ospf__lsdb_8h.html#a3112a41cf80dfabbf2962e8df1b8504b">LSDB_LOOP</a> (<a class="code" href="ospf__lsdb_8h.html#a145a10afd0c8a801d2e84b26c0becbfd">ASBR_SUMMARY_LSDB</a> (area), rn, lsa)
    <a class="code" href="ospf__nsm_8c.html#a04cb91edc2aa9251f5b79f9290997de4">ospf_db_summary_add</a> (nbr, lsa);

<span class="preprocessor">#ifdef HAVE_OPAQUE_LSA</span>
<span class="preprocessor"></span>  <span class="comment">/* Process only if the neighbor is opaque capable. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (nbr-&gt;options, <a class="code" href="ospfd_8h.html#a3273018c458aa48440274e21e935c85f">OSPF_OPTION_O</a>))
    {
      <a class="code" href="ospf__lsdb_8h.html#a3112a41cf80dfabbf2962e8df1b8504b">LSDB_LOOP</a> (<a class="code" href="ospf__lsdb_8h.html#a7b6d75a56662bb4e124777b376bb84da">OPAQUE_LINK_LSDB</a> (area), rn, lsa)
    <a class="code" href="ospf__nsm_8c.html#a04cb91edc2aa9251f5b79f9290997de4">ospf_db_summary_add</a> (nbr, lsa);
      <a class="code" href="ospf__lsdb_8h.html#a3112a41cf80dfabbf2962e8df1b8504b">LSDB_LOOP</a> (<a class="code" href="ospf__lsdb_8h.html#aec3918874489142043aedd1ac5855f57">OPAQUE_AREA_LSDB</a> (area), rn, lsa)
    <a class="code" href="ospf__nsm_8c.html#a04cb91edc2aa9251f5b79f9290997de4">ospf_db_summary_add</a> (nbr, lsa);
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_OPAQUE_LSA */</span>

  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (nbr-&gt;options, <a class="code" href="ospfd_8h.html#af9739335948debe99dd1e5e62d87c00c">OSPF_OPTION_NP</a>))
    {
      <a class="code" href="ospf__lsdb_8h.html#a3112a41cf80dfabbf2962e8df1b8504b">LSDB_LOOP</a> (<a class="code" href="ospf__lsdb_8h.html#aa704d331d2ac4e4034faca5c0f177364">NSSA_LSDB</a> (area), rn, lsa)
    <a class="code" href="ospf__nsm_8c.html#a04cb91edc2aa9251f5b79f9290997de4">ospf_db_summary_add</a> (nbr, lsa);
    }

  if (nbr-&gt;oi-&gt;<a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a> != <a class="code" href="ospf__interface_8h.html#a45798a2a8b566abd1907f7ae8bc0a2be">OSPF_IFTYPE_VIRTUALLINK</a>
      &amp;&amp; area-&gt;external_routing == <a class="code" href="ospfd_8h.html#a43f84c8e8584ccc8b82990d251abec4d">OSPF_AREA_DEFAULT</a>)
    <a class="code" href="ospf__lsdb_8h.html#a3112a41cf80dfabbf2962e8df1b8504b">LSDB_LOOP</a> (<a class="code" href="ospf__lsdb_8h.html#ae56a8a7b638bd22caf86ea3d810fdbd9">EXTERNAL_LSDB</a> (nbr-&gt;oi-&gt;<a class="code" href="structospf.html">ospf</a>), rn, lsa)
      <a class="code" href="ospf__nsm_8c.html#a04cb91edc2aa9251f5b79f9290997de4">ospf_db_summary_add</a> (nbr, lsa);

<span class="preprocessor">#ifdef HAVE_OPAQUE_LSA</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (nbr-&gt;options, <a class="code" href="ospfd_8h.html#a3273018c458aa48440274e21e935c85f">OSPF_OPTION_O</a>)
      &amp;&amp; (nbr-&gt;oi-&gt;type != <a class="code" href="ospf__interface_8h.html#a45798a2a8b566abd1907f7ae8bc0a2be">OSPF_IFTYPE_VIRTUALLINK</a>
      &amp;&amp; area-&gt;external_routing == <a class="code" href="ospfd_8h.html#a43f84c8e8584ccc8b82990d251abec4d">OSPF_AREA_DEFAULT</a>))
    <a class="code" href="ospf__lsdb_8h.html#a3112a41cf80dfabbf2962e8df1b8504b">LSDB_LOOP</a> (<a class="code" href="ospf__lsdb_8h.html#ac7a1aa21490d2bd86999d2e494cde6d0">OPAQUE_AS_LSDB</a> (nbr-&gt;oi-&gt;ospf), rn, lsa)
      <a class="code" href="ospf__nsm_8c.html#a04cb91edc2aa9251f5b79f9290997de4">ospf_db_summary_add</a> (nbr, lsa);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_OPAQUE_LSA */</span>

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aafaeb52974679a4579059489345079d6"></a><!-- doxytag: member="ospf_nsm.c::nsm_notice_state_change" ref="aafaeb52974679a4579059489345079d6" args="(struct ospf_neighbor *nbr, int next_state, int event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void nsm_notice_state_change </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>next_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00598">598</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">/* Logging change of status. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="ospf__dump_8h.html#a065e478fcd8bd7a409804fc9e9e67e70">IS_DEBUG_OSPF</a> (nsm, NSM_STATUS))
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;NSM[%s:%s]: State change %s -&gt; %s (%s)&quot;</span>,
               <a class="code" href="ospf__dump_8h.html#a8617b8a577debdfb2cd2f08c41066497">IF_NAME</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>), inet_ntoa (nbr-&gt;<a class="code" href="structospf__neighbor.html#a2257238c9040a76e9de9a78cf95bae0d">router_id</a>),
               <a class="code" href="log_8h.html#a3a4b1cad85aa6752f39580944e24a868">LOOKUP</a> (<a class="code" href="ospf__dump_8c.html#a7addd69d09415cd935c591a40b74ac46">ospf_nsm_state_msg</a>, nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a>),
               <a class="code" href="log_8h.html#a3a4b1cad85aa6752f39580944e24a868">LOOKUP</a> (<a class="code" href="ospf__dump_8c.html#a7addd69d09415cd935c591a40b74ac46">ospf_nsm_state_msg</a>, <a class="code" href="bgp__fsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a>),
               <a class="code" href="ospf__nsm_8c.html#a574380804c81a262de3cc8a42c713539">ospf_nsm_event_str</a> [<a class="code" href="vty_8c.html#a3b65133bb9997cd1ccf311af0927fc9e">event</a>]);

  <span class="comment">/* Optionally notify about adjacency changes */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#a159ae1c542016fc78f68c3e39a1b132e">ospf</a>-&gt;<a class="code" href="structospf.html#adef61932fdc53ba8c61df0343606337f">config</a>, <a class="code" href="ospfd_8h.html#acb2573c479628348631856350a9dd708">OSPF_LOG_ADJACENCY_CHANGES</a>) &amp;&amp;
      (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#a159ae1c542016fc78f68c3e39a1b132e">ospf</a>-&gt;<a class="code" href="structospf.html#adef61932fdc53ba8c61df0343606337f">config</a>, <a class="code" href="ospfd_8h.html#a0d30d5b76aa2044832a3d85bac90ca65">OSPF_LOG_ADJACENCY_DETAIL</a>) ||
       (<a class="code" href="bgp__fsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a> == <a class="code" href="ospf__nsm_8h.html#aae3fb624a87adcc8ae4d12d694fc0929">NSM_Full</a>) || (next_state &lt; nbr-&gt;state)))
    <a class="code" href="log_8h.html#a2fcbf88ea2e5eb71befdbdb4a3f1474f">zlog_notice</a>(<span class="stringliteral">&quot;AdjChg: Nbr %s on %s: %s -&gt; %s (%s)&quot;</span>,
                inet_ntoa (nbr-&gt;<a class="code" href="structospf__neighbor.html#a2257238c9040a76e9de9a78cf95bae0d">router_id</a>), <a class="code" href="ospf__dump_8h.html#a8617b8a577debdfb2cd2f08c41066497">IF_NAME</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>),
                <a class="code" href="log_8h.html#a3a4b1cad85aa6752f39580944e24a868">LOOKUP</a> (<a class="code" href="ospf__dump_8c.html#a7addd69d09415cd935c591a40b74ac46">ospf_nsm_state_msg</a>, nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a>),
                <a class="code" href="log_8h.html#a3a4b1cad85aa6752f39580944e24a868">LOOKUP</a> (<a class="code" href="ospf__dump_8c.html#a7addd69d09415cd935c591a40b74ac46">ospf_nsm_state_msg</a>, <a class="code" href="bgp__fsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a>),
                <a class="code" href="ospf__nsm_8c.html#a574380804c81a262de3cc8a42c713539">ospf_nsm_event_str</a> [<a class="code" href="vty_8c.html#a3b65133bb9997cd1ccf311af0927fc9e">event</a>]);

  <span class="comment">/* Advance in NSM */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__fsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a> &gt; nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a>)
    nbr-&gt;<a class="code" href="structospf__neighbor.html#a443f9812256edbf06fa45e26b706619a">ts_last_progress</a> = <a class="code" href="thread_8c.html#a010d58e49a3c74ae856d5cd111f7eb62">recent_relative_time</a> ();
  <span class="keywordflow">else</span> <span class="comment">/* regression in NSM */</span>
    {
      nbr-&gt;<a class="code" href="structospf__neighbor.html#a5b0d0bd60a0aa9961be33489ee9fe5f1">ts_last_regress</a> = <a class="code" href="thread_8c.html#a010d58e49a3c74ae856d5cd111f7eb62">recent_relative_time</a> ();
      nbr-&gt;<a class="code" href="structospf__neighbor.html#a3fd6a7ce196ae83634261bc7810a5927">last_regress_str</a> = <a class="code" href="ospf__nsm_8c.html#a574380804c81a262de3cc8a42c713539">ospf_nsm_event_str</a> [<a class="code" href="vty_8c.html#a3b65133bb9997cd1ccf311af0927fc9e">event</a>];
    }

<span class="preprocessor">#ifdef HAVE_SNMP</span>
<span class="preprocessor"></span>  <span class="comment">/* Terminal state or regression */</span> 
  <span class="keywordflow">if</span> ((<a class="code" href="bgp__fsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a> == <a class="code" href="ospf__nsm_8h.html#aae3fb624a87adcc8ae4d12d694fc0929">NSM_Full</a>) 
      || (<a class="code" href="bgp__fsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a> == <a class="code" href="ospf__nsm_8h.html#a8a9d14bfc7d840e04eff13df3337fa24">NSM_TwoWay</a>)
      || (next_state &lt; nbr-&gt;state))
    {
      <span class="comment">/* ospfVirtNbrStateChange */</span>
      <span class="keywordflow">if</span> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#adb923b0bfebf30738af57dafcf0d0d57">type</a> == <a class="code" href="ospf__interface_8h.html#a45798a2a8b566abd1907f7ae8bc0a2be">OSPF_IFTYPE_VIRTUALLINK</a>)
        <a class="code" href="ospf__snmp_8h.html#accf3b691f4461105fb861cb1e081de4e">ospfTrapVirtNbrStateChange</a>(nbr);
      <span class="comment">/* ospfNbrStateChange trap  */</span>
      <span class="keywordflow">else</span>  
        <span class="comment">/* To/From FULL, only managed by DR */</span>
        <span class="keywordflow">if</span> (((<a class="code" href="bgp__fsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a> != <a class="code" href="ospf__nsm_8h.html#aae3fb624a87adcc8ae4d12d694fc0929">NSM_Full</a>) &amp;&amp; (nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a> != <a class="code" href="ospf__nsm_8h.html#aae3fb624a87adcc8ae4d12d694fc0929">NSM_Full</a>)) 
            || (nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>-&gt;<a class="code" href="structospf__interface.html#a26605b9cc792cdd3e26c0481d24f0f63">state</a> == <a class="code" href="ospf__ism_8h.html#a7f179a571f4f8e112c0b887f39c87f23">ISM_DR</a>))
          <a class="code" href="ospf__snmp_8h.html#a90aca92ae6e6e864b2357f3b4059a9ff">ospfTrapNbrStateChange</a>(nbr);
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="ad17b9a8a8a6d03fa0e451794a6f173b0"></a><!-- doxytag: member="ospf_nsm.c::nsm_should_adj" ref="ad17b9a8a8a6d03fa0e451794a6f173b0" args="(struct ospf_neighbor *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int nsm_should_adj </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00144">144</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structospf__interface.html">ospf_interface</a> *oi = nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>;

      <span class="comment">/* These network types must always form adjacencies. */</span>
  <span class="keywordflow">if</span> (oi-&gt;<a class="code" href="structospf__interface.html#adb923b0bfebf30738af57dafcf0d0d57">type</a> == <a class="code" href="ospf__interface_8h.html#a7722c258e67d21a5c6f367811664cccb">OSPF_IFTYPE_POINTOPOINT</a>
      || oi-&gt;<a class="code" href="structospf__interface.html#adb923b0bfebf30738af57dafcf0d0d57">type</a> == <a class="code" href="ospf__interface_8h.html#aa65cd67781b9573131ead326b8976194">OSPF_IFTYPE_POINTOMULTIPOINT</a>
      || oi-&gt;<a class="code" href="structospf__interface.html#adb923b0bfebf30738af57dafcf0d0d57">type</a> == <a class="code" href="ospf__interface_8h.html#a45798a2a8b566abd1907f7ae8bc0a2be">OSPF_IFTYPE_VIRTUALLINK</a>
      <span class="comment">/* Router itself is the DRouter or the BDRouter. */</span>
      || <a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a> (&amp;oi-&gt;<a class="code" href="structospf__interface.html#a43493bc2b5d951e3e38ace850332eca1">address</a>-&gt;u.<a class="code" href="structprefix.html#ab37b8922554b41b7dc2417d8f37e7829">prefix4</a>, &amp;<a class="code" href="ospf__interface_8h.html#aa84a7dde76ac0a31898992d050858ec5">DR</a> (oi))
      || <a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a> (&amp;oi-&gt;<a class="code" href="structospf__interface.html#a43493bc2b5d951e3e38ace850332eca1">address</a>-&gt;u.<a class="code" href="structprefix.html#ab37b8922554b41b7dc2417d8f37e7829">prefix4</a>, &amp;<a class="code" href="ospf__interface_8h.html#ab9a182dc79cc0d10a77a27c60f2351cd">BDR</a> (oi))
      <span class="comment">/* Neighboring Router is the DRouter or the BDRouter. */</span>
      || <a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a> (&amp;nbr-&gt;<a class="code" href="structospf__neighbor.html#a4be3cd4b416bc267a4e3b35b9e2b1102">address</a>.u.<a class="code" href="structprefix.html#ab37b8922554b41b7dc2417d8f37e7829">prefix4</a>, &amp;<a class="code" href="ospf__interface_8h.html#aa84a7dde76ac0a31898992d050858ec5">DR</a> (oi))
      || <a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a> (&amp;nbr-&gt;<a class="code" href="structospf__neighbor.html#a4be3cd4b416bc267a4e3b35b9e2b1102">address</a>.u.<a class="code" href="structprefix.html#ab37b8922554b41b7dc2417d8f37e7829">prefix4</a>, &amp;<a class="code" href="ospf__interface_8h.html#ab9a182dc79cc0d10a77a27c60f2351cd">BDR</a> (oi)))
    <span class="keywordflow">return</span> 1;

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad333a1c46c27084d4250f90fc22618de"></a><!-- doxytag: member="ospf_nsm.c::nsm_start" ref="ad333a1c46c27084d4250f90fc22618de" args="(struct ospf_neighbor *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int nsm_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00180">180</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a68b82493dd68fd0a271db2e168c36617">nbr_nbma</a>)
      <a class="code" href="ospfd_8h.html#a00739e4ae75021e7e134dc6b292a9f2b">OSPF_POLL_TIMER_OFF</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a68b82493dd68fd0a271db2e168c36617">nbr_nbma</a>-&gt;<a class="code" href="structospf__nbr__nbma.html#a9aa6dd806f5903f6a4ded3ee4ca26e29">t_poll</a>);

  <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a45b4258ca43f3e01958adfe4c7b8bd0b">t_inactivity</a>);
  
  <a class="code" href="ospf__nsm_8h.html#a13172a390c4ab15fea61d66d2c9262d9">OSPF_NSM_TIMER_ON</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a45b4258ca43f3e01958adfe4c7b8bd0b">t_inactivity</a>, <a class="code" href="ospf__nsm_8c.html#a538735cb90fed88c2a73e3073a41eef1">ospf_inactivity_timer</a>,
                     nbr-&gt;<a class="code" href="structospf__neighbor.html#a4e51d35a798becc9ffa76cda3462caaf">v_inactivity</a>);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5fbae8b20facd83cfe8d9f5ce1ff5658"></a><!-- doxytag: member="ospf_nsm.c::nsm_timer_set" ref="a5fbae8b20facd83cfe8d9f5ce1ff5658" args="(struct ospf_neighbor *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void nsm_timer_set </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00107">107</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">switch</span> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a>)
    {
    <span class="keywordflow">case</span> <a class="code" href="ospf__nsm_8h.html#afc65d05c1dcff4d9143c7ba8e432a28f">NSM_Deleted</a>:
    <span class="keywordflow">case</span> <a class="code" href="ospf__nsm_8h.html#a4bdf4e7631050dcf28cbe7959f0675ce">NSM_Down</a>:
      <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a45b4258ca43f3e01958adfe4c7b8bd0b">t_inactivity</a>);
      <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a9bb86528f191dbbe6c6272501ccc7ad6">t_hello_reply</a>);
    <span class="keywordflow">case</span> <a class="code" href="ospf__nsm_8h.html#a8151a9925f00bd1d3b3362a7557bab67">NSM_Attempt</a>:
    <span class="keywordflow">case</span> <a class="code" href="ospf__nsm_8h.html#a42c71b8079e65eca44823c00cf93e477">NSM_Init</a>:
    <span class="keywordflow">case</span> <a class="code" href="ospf__nsm_8h.html#a8a9d14bfc7d840e04eff13df3337fa24">NSM_TwoWay</a>:
      <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a2b33ba18191ce9a9346bbaae651fdaac">t_db_desc</a>);
      <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a4529c944b245441aa81008b12d5331d1">t_ls_upd</a>);
      <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#ae92276b22586f96e9022efd0a447793b">t_ls_req</a>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="ospf__nsm_8h.html#aa02b0a534709b4557e46db7b31bbedd7">NSM_ExStart</a>:
      <a class="code" href="ospf__nsm_8h.html#a13172a390c4ab15fea61d66d2c9262d9">OSPF_NSM_TIMER_ON</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a2b33ba18191ce9a9346bbaae651fdaac">t_db_desc</a>, <a class="code" href="ospf__nsm_8c.html#ab1b077a595491f8b7c5b08adcbade07c">ospf_db_desc_timer</a>, nbr-&gt;<a class="code" href="structospf__neighbor.html#a9ba43b317ff6786a5885cc96e7e98a28">v_db_desc</a>);
      <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a4529c944b245441aa81008b12d5331d1">t_ls_upd</a>);
      <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#ae92276b22586f96e9022efd0a447793b">t_ls_req</a>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="ospf__nsm_8h.html#a2bac91ff388bd6722ce1cdd682184e83">NSM_Exchange</a>:
      <a class="code" href="ospf__nsm_8h.html#a13172a390c4ab15fea61d66d2c9262d9">OSPF_NSM_TIMER_ON</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a4529c944b245441aa81008b12d5331d1">t_ls_upd</a>, <a class="code" href="ospf__packet_8c.html#a6ddfa710e48ff5c20abef26d78456ceb">ospf_ls_upd_timer</a>, nbr-&gt;<a class="code" href="structospf__neighbor.html#aae25ef8d8903b3aecf90a95b4c5c7bc3">v_ls_upd</a>);
      <span class="keywordflow">if</span> (!<a class="code" href="ospf__packet_8h.html#a63eec6702c492926fcdfd84f33eaa836">IS_SET_DD_MS</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#afd7a64a3a213196cc5dd3c4c5b2e2a5b">dd_flags</a>))      
    <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a2b33ba18191ce9a9346bbaae651fdaac">t_db_desc</a>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="ospf__nsm_8h.html#ab83ae0b2039dc911b4752c05da97bc8b">NSM_Loading</a>:
    <span class="keywordflow">case</span> <a class="code" href="ospf__nsm_8h.html#aae3fb624a87adcc8ae4d12d694fc0929">NSM_Full</a>:
    <span class="keywordflow">default</span>:
      <a class="code" href="ospf__nsm_8h.html#a35ccddb2f6b01d639e00422254ae78a8">OSPF_NSM_TIMER_OFF</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a2b33ba18191ce9a9346bbaae651fdaac">t_db_desc</a>);
      <span class="keywordflow">break</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a53e2e2f5742584b8cc554dc7e8e4d3ec"></a><!-- doxytag: member="ospf_nsm.c::nsm_twoway_received" ref="a53e2e2f5742584b8cc554dc7e8e4d3ec" args="(struct ospf_neighbor *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int nsm_twoway_received </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00194">194</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> (<a class="code" href="ospf__nsm_8c.html#ad17b9a8a8a6d03fa0e451794a6f173b0">nsm_should_adj</a> (nbr) ? <a class="code" href="ospf__nsm_8h.html#aa02b0a534709b4557e46db7b31bbedd7">NSM_ExStart</a> : <a class="code" href="ospf__nsm_8h.html#a8a9d14bfc7d840e04eff13df3337fa24">NSM_TwoWay</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8c79532418548f4027b82bc41b4ed871"></a><!-- doxytag: member="ospf_nsm.c::ospf_check_nbr_loading" ref="a8c79532418548f4027b82bc41b4ed871" args="(struct ospf_neighbor *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_check_nbr_loading </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00855">855</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a07061a68f4e15effd12479e1047120c7">state</a> == <a class="code" href="ospf__nsm_8h.html#ab83ae0b2039dc911b4752c05da97bc8b">NSM_Loading</a>)
    {
      <span class="keywordflow">if</span> (<a class="code" href="ospf__flood_8c.html#a1fad8802afa3d754e1ecf810d7cc1bd5">ospf_ls_request_isempty</a> (nbr))
    <a class="code" href="ospf__nsm_8h.html#a1cb080254e9d0314d6ef4bc2c05e36b4">OSPF_NSM_EVENT_SCHEDULE</a> (nbr, <a class="code" href="ospf__nsm_8h.html#a0ba017c954f9dc58c2e3bc4412901d5d">NSM_LoadingDone</a>);
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a0071c28cc3ed4b8330606973e0f16323">ls_req_last</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    <a class="code" href="ospf__packet_8c.html#aa2fb26aa3ec8d705d7b62dfa9fc244e9">ospf_ls_req_event</a> (nbr);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab1b077a595491f8b7c5b08adcbade07c"></a><!-- doxytag: member="ospf_nsm.c::ospf_db_desc_timer" ref="ab1b077a595491f8b7c5b08adcbade07c" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ospf_db_desc_timer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00073">73</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structospf__interface.html">ospf_interface</a> *oi;
  <span class="keyword">struct </span><a class="code" href="structospf__neighbor.html">ospf_neighbor</a> *nbr;

  nbr = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  nbr-&gt;<a class="code" href="structospf__neighbor.html#a2b33ba18191ce9a9346bbaae651fdaac">t_db_desc</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  oi = nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>;

  <span class="keywordflow">if</span> (<a class="code" href="ospf__dump_8h.html#a065e478fcd8bd7a409804fc9e9e67e70">IS_DEBUG_OSPF</a> (nsm, NSM_TIMERS))
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_DEBUG, <span class="stringliteral">&quot;NSM[%s:%s]: Timer (DD Retransmit timer expire)&quot;</span>,
      <a class="code" href="ospf__dump_8h.html#a8617b8a577debdfb2cd2f08c41066497">IF_NAME</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>), inet_ntoa (nbr-&gt;<a class="code" href="structospf__neighbor.html#a959c002cab5b6328120fcac7ba25fbee">src</a>));

  <span class="comment">/* resent last send DD packet. */</span>
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#ae5321e0cc874246d0002917b591ee3d0">last_send</a>);
  <a class="code" href="ospf__packet_8c.html#a822058f9ec5fa23f5f9cb5a57ba4d8c1">ospf_db_desc_resend</a> (nbr);

  <span class="comment">/* DD Retransmit timer set. */</span>
  <a class="code" href="ospf__nsm_8h.html#a13172a390c4ab15fea61d66d2c9262d9">OSPF_NSM_TIMER_ON</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a2b33ba18191ce9a9346bbaae651fdaac">t_db_desc</a>, <a class="code" href="ospf__nsm_8c.html#ab1b077a595491f8b7c5b08adcbade07c">ospf_db_desc_timer</a>, nbr-&gt;<a class="code" href="structospf__neighbor.html#a9ba43b317ff6786a5885cc96e7e98a28">v_db_desc</a>);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a04cb91edc2aa9251f5b79f9290997de4"></a><!-- doxytag: member="ospf_nsm.c::ospf_db_summary_add" ref="a04cb91edc2aa9251f5b79f9290997de4" args="(struct ospf_neighbor *nbr, struct ospf_lsa *lsa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ospf_db_summary_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structospf__lsa.html">ospf_lsa</a> *&#160;</td>
          <td class="paramname"><em>lsa</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00212">212</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef HAVE_OPAQUE_LSA</span>
<span class="preprocessor"></span>  <span class="keywordflow">switch</span> (lsa-&gt;<a class="code" href="structospf__lsa.html#a31a637ecac976d557e71528613046582">data</a>-&gt;<a class="code" href="structlsa__header.html#a609df537f85c14e7146107e0cb67eae7">type</a>)
    {
    <span class="keywordflow">case</span> <a class="code" href="ospf__lsa_8h.html#a9f5ad1d8944ebad62941128f9aeee23a">OSPF_OPAQUE_LINK_LSA</a>:
      <span class="comment">/* Exclude type-9 LSAs that does not have the same &quot;oi&quot; with &quot;nbr&quot;. */</span>
      <span class="keywordflow">if</span> (lsa-&gt;oi != nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>)
          <span class="keywordflow">return</span> 0;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="ospf__lsa_8h.html#affea3ed894380623d4d5bf5dbbad90e9">OSPF_OPAQUE_AREA_LSA</a>:
      <span class="comment">/*</span>
<span class="comment">       * It is assured by the caller function &quot;nsm_negotiation_done()&quot;</span>
<span class="comment">       * that every given LSA belongs to the same area with &quot;nbr&quot;.</span>
<span class="comment">       */</span>
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="ospf__lsa_8h.html#a4ec63a35fbaffb7350ff4d69002af21e">OSPF_OPAQUE_AS_LSA</a>:
    <span class="keywordflow">default</span>:
      <span class="keywordflow">break</span>;
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_OPAQUE_LSA */</span>

  <span class="comment">/* Stay away from any Local Translated Type-7 LSAs */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (lsa-&gt;<a class="code" href="structospf__lsa.html#aa8c833176affd799afeb8db16cdb2602">flags</a>, <a class="code" href="ospf__lsa_8h.html#a20f98f1fb4931335ddf4dd15d8fe9040">OSPF_LSA_LOCAL_XLT</a>))
    <span class="keywordflow">return</span> 0;

  <span class="keywordflow">if</span> (<a class="code" href="ospf__lsa_8h.html#a29c1c83c9c5e24d75e33d7efd0d12b88">IS_LSA_MAXAGE</a> (lsa))
    <a class="code" href="ospf__flood_8c.html#af8c025c82461d3cb8c96d04692dc656c">ospf_ls_retransmit_add</a> (nbr, lsa);                      
  <span class="keywordflow">else</span> 
    <a class="code" href="ospf__lsdb_8c.html#a4247fc1a76fbbc491d0d55ac0d77be71">ospf_lsdb_add</a> (&amp;nbr-&gt;<a class="code" href="structospf__neighbor.html#aa9dff1f5ba19ec799c3dc9254b849049">db_sum</a>, lsa);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3f2d40c890bf5146459e631083a4677b"></a><!-- doxytag: member="ospf_nsm.c::ospf_db_summary_clear" ref="a3f2d40c890bf5146459e631083a4677b" args="(struct ospf_neighbor *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ospf_db_summary_clear </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00247">247</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structospf__lsdb.html">ospf_lsdb</a> *lsdb;
  <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;

  lsdb = &amp;nbr-&gt;<a class="code" href="structospf__neighbor.html#aa9dff1f5ba19ec799c3dc9254b849049">db_sum</a>;
  <span class="keywordflow">for</span> (i = <a class="code" href="ospf__lsa_8h.html#a28f56e6e5dedc2dd8223832a029e18b1">OSPF_MIN_LSA</a>; i &lt; <a class="code" href="ospf__lsa_8h.html#a3e45213a5a73c9e6ca277573059d1fbc">OSPF_MAX_LSA</a>; i++)
    {
      <span class="keyword">struct </span><a class="code" href="structroute__table.html">route_table</a> *table = lsdb-&gt;<a class="code" href="structospf__lsdb.html#a0af6d8740509eb2ed0ad1aa9c6599d56">type</a>[<a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>].<a class="code" href="structospf__lsdb.html#ac02ad39566534869219d3e9d942bf565">db</a>;
      <span class="keyword">struct </span><a class="code" href="structroute__node.html">route_node</a> *rn;

      <span class="keywordflow">for</span> (rn = <a class="code" href="table_8c.html#aee1d06c531794df326d946bdac647fb2">route_top</a> (table); rn; rn = <a class="code" href="table_8c.html#ad2addc694ecf6cd0cce57cb3a7d96902">route_next</a> (rn))
    <span class="keywordflow">if</span> (rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>)
      <a class="code" href="ospf__lsdb_8c.html#aea96804c9a8cf2e0f59e8cce0b7a264e">ospf_lsdb_delete</a> (&amp;nbr-&gt;<a class="code" href="structospf__neighbor.html#aa9dff1f5ba19ec799c3dc9254b849049">db_sum</a>, rn-&gt;<a class="code" href="structroute__node.html#a20aabb1a6fbe9de363a1c57fe3124c87">info</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa880af5829d8741b9012bf64e3c7a0c9"></a><!-- doxytag: member="ospf_nsm.c::ospf_db_summary_count" ref="aa880af5829d8741b9012bf64e3c7a0c9" args="(struct ospf_neighbor *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ospf_db_summary_count </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00200">200</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> <a class="code" href="ospf__lsdb_8c.html#aac22a3316876f4a266649e4f2d902973">ospf_lsdb_count_all</a> (&amp;nbr-&gt;<a class="code" href="structospf__neighbor.html#aa9dff1f5ba19ec799c3dc9254b849049">db_sum</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac37bb4e71b7ca701aeec1bb101340ae3"></a><!-- doxytag: member="ospf_nsm.c::ospf_db_summary_isempty" ref="ac37bb4e71b7ca701aeec1bb101340ae3" args="(struct ospf_neighbor *nbr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ospf_db_summary_isempty </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *&#160;</td>
          <td class="paramname"><em>nbr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00206">206</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> <a class="code" href="ospf__lsdb_8c.html#a2b5faf4a42f54a62fcf14d5a7ff0c481">ospf_lsdb_isempty</a> (&amp;nbr-&gt;<a class="code" href="structospf__neighbor.html#aa9dff1f5ba19ec799c3dc9254b849049">db_sum</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a538735cb90fed88c2a73e3073a41eef1"></a><!-- doxytag: member="ospf_nsm.c::ospf_inactivity_timer" ref="a538735cb90fed88c2a73e3073a41eef1" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ospf_inactivity_timer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00056">56</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structospf__neighbor.html">ospf_neighbor</a> *nbr;

  nbr = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  nbr-&gt;<a class="code" href="structospf__neighbor.html#a45b4258ca43f3e01958adfe4c7b8bd0b">t_inactivity</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (<a class="code" href="ospf__dump_8h.html#a065e478fcd8bd7a409804fc9e9e67e70">IS_DEBUG_OSPF</a> (nsm, NSM_TIMERS))
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_DEBUG, <span class="stringliteral">&quot;NSM[%s:%s]: Timer (Inactivity timer expire)&quot;</span>,
      <a class="code" href="ospf__dump_8h.html#a8617b8a577debdfb2cd2f08c41066497">IF_NAME</a> (nbr-&gt;<a class="code" href="structospf__neighbor.html#a24eabbd825aa53aba5343ae2d5ea7233">oi</a>), inet_ntoa (nbr-&gt;<a class="code" href="structospf__neighbor.html#a2257238c9040a76e9de9a78cf95bae0d">router_id</a>));

  <a class="code" href="ospf__nsm_8h.html#a1cb080254e9d0314d6ef4bc2c05e36b4">OSPF_NSM_EVENT_SCHEDULE</a> (nbr, <a class="code" href="ospf__nsm_8h.html#a43251ea21756a387d219d4a4ab319717">NSM_InactivityTimer</a>);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a87769e248868b1d0acbe5afdfa8912f1"></a><!-- doxytag: member="ospf_nsm.c::ospf_nsm_event" ref="a87769e248868b1d0acbe5afdfa8912f1" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ospf_nsm_event </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00786">786</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> <a class="code" href="vty_8c.html#a3b65133bb9997cd1ccf311af0927fc9e">event</a>;
  <span class="keywordtype">int</span> <a class="code" href="bgp__fsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a>;
  <span class="keyword">struct </span><a class="code" href="structospf__neighbor.html">ospf_neighbor</a> *nbr;
  <span class="keyword">struct </span>in_addr router_id;

  nbr = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <span class="keyword">event</span> = <a class="code" href="thread_8h.html#a88d7c483cad15baac709fac747480a11">THREAD_VAL</a> (thread);
  router_id = nbr-&gt;router_id;

  <span class="keywordflow">if</span> (<a class="code" href="ospf__dump_8h.html#a065e478fcd8bd7a409804fc9e9e67e70">IS_DEBUG_OSPF</a> (nsm, NSM_EVENTS))
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;NSM[%s:%s]: %s (%s)&quot;</span>, <a class="code" href="ospf__dump_8h.html#a8617b8a577debdfb2cd2f08c41066497">IF_NAME</a> (nbr-&gt;oi),
           inet_ntoa (nbr-&gt;router_id),
           <a class="code" href="log_8h.html#a3a4b1cad85aa6752f39580944e24a868">LOOKUP</a> (<a class="code" href="ospf__dump_8c.html#a7addd69d09415cd935c591a40b74ac46">ospf_nsm_state_msg</a>, nbr-&gt;state),
           <a class="code" href="ospf__nsm_8c.html#a574380804c81a262de3cc8a42c713539">ospf_nsm_event_str</a> [event]);
  
  next_state = <a class="code" href="ospf__nsm_8c.html#adbabdc9ffe6b3d5d187a1eed134c2141">NSM</a> [nbr-&gt;state][<a class="code" href="vty_8c.html#a3b65133bb9997cd1ccf311af0927fc9e">event</a>].next_state;

  <span class="comment">/* Call function. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="ospf__nsm_8c.html#adbabdc9ffe6b3d5d187a1eed134c2141">NSM</a> [nbr-&gt;state][event].func != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      <span class="keywordtype">int</span> func_state = (*(<a class="code" href="ospf__nsm_8c.html#adbabdc9ffe6b3d5d187a1eed134c2141">NSM</a> [nbr-&gt;state][<a class="code" href="vty_8c.html#a3b65133bb9997cd1ccf311af0927fc9e">event</a>].func))(nbr);
      
      <span class="keywordflow">if</span> (<a class="code" href="ospf__nsm_8c.html#adbabdc9ffe6b3d5d187a1eed134c2141">NSM</a> [nbr-&gt;state][event].next_state == <a class="code" href="ospf__nsm_8h.html#a1cab9f3408395d6da04471fa9fba1f16">NSM_DependUpon</a>)
        next_state = func_state;
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (func_state)
        {
          <span class="comment">/* There&#39;s a mismatch between the FSM tables and what an FSM</span>
<span class="comment">           * action/state-change function returned. State changes which</span>
<span class="comment">           * do not have conditional/DependUpon next-states should not</span>
<span class="comment">           * try set next_state.</span>
<span class="comment">           */</span>
          <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;NSM[%s:%s]: %s (%s): &quot;</span>
                     <span class="stringliteral">&quot;Warning: action tried to change next_state to %s&quot;</span>,
                     <a class="code" href="ospf__dump_8h.html#a8617b8a577debdfb2cd2f08c41066497">IF_NAME</a> (nbr-&gt;oi), inet_ntoa (nbr-&gt;router_id),
                     <a class="code" href="log_8h.html#a3a4b1cad85aa6752f39580944e24a868">LOOKUP</a> (<a class="code" href="ospf__dump_8c.html#a7addd69d09415cd935c591a40b74ac46">ospf_nsm_state_msg</a>, nbr-&gt;state),
                     <a class="code" href="ospf__nsm_8c.html#a574380804c81a262de3cc8a42c713539">ospf_nsm_event_str</a> [event],
                     <a class="code" href="log_8h.html#a3a4b1cad85aa6752f39580944e24a868">LOOKUP</a> (<a class="code" href="ospf__dump_8c.html#a7addd69d09415cd935c591a40b74ac46">ospf_nsm_state_msg</a>, func_state));
        }
    }

  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (next_state != <a class="code" href="ospf__nsm_8h.html#a1cab9f3408395d6da04471fa9fba1f16">NSM_DependUpon</a>);
  
  <span class="comment">/* If state is changed. */</span>
  <span class="keywordflow">if</span> (next_state != nbr-&gt;state)
    {
      <a class="code" href="ospf__nsm_8c.html#aafaeb52974679a4579059489345079d6">nsm_notice_state_change</a> (nbr, next_state, event);
      <a class="code" href="ospf__nsm_8c.html#a8df02ba42645a2104db36fac33afea34">nsm_change_state</a> (nbr, next_state);
    }

  <span class="comment">/* Make sure timer is set. */</span>
  <a class="code" href="ospf__nsm_8c.html#a5fbae8b20facd83cfe8d9f5ce1ff5658">nsm_timer_set</a> (nbr);

  <span class="comment">/* When event is NSM_KillNbr, InactivityTimer or LLDown, the neighbor</span>
<span class="comment">   * is deleted.</span>
<span class="comment">   *</span>
<span class="comment">   * Rather than encode knowledge here of which events lead to NBR</span>
<span class="comment">   * delete, we take our cue from the NSM table, via the dummy</span>
<span class="comment">   * &#39;Deleted&#39; neighbour state.</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (nbr-&gt;state == <a class="code" href="ospf__nsm_8h.html#afc65d05c1dcff4d9143c7ba8e432a28f">NSM_Deleted</a>)
    <a class="code" href="ospf__neighbor_8c.html#ace111af37bf8e7a8c058a55866b4cc08">ospf_nbr_delete</a> (nbr);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a03307f8a561731a5c5657834da57ab11"></a><!-- doxytag: member="ospf_nsm.c::func" ref="a03307f8a561731a5c5657834da57ab11" args=")(struct ospf_neighbor *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="ospf__nsm_8c.html#a03307f8a561731a5c5657834da57ab11">func</a>)(struct <a class="el" href="structospf__neighbor.html">ospf_neighbor</a> *)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00404">404</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac0c302bc97f010b7f5965faa07b00354"></a><!-- doxytag: member="ospf_nsm.c::next_state" ref="ac0c302bc97f010b7f5965faa07b00354" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ospf__nsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00405">405</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>

</div>
</div>
<a class="anchor" id="adbabdc9ffe6b3d5d187a1eed134c2141"></a><!-- doxytag: member="ospf_nsm.c::NSM" ref="adbabdc9ffe6b3d5d187a1eed134c2141" args="[OSPF_NSM_STATE_MAX][OSPF_NSM_EVENT_MAX]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct { ... }   <a class="el" href="ospf__nsm_8c.html#adbabdc9ffe6b3d5d187a1eed134c2141">NSM</a>[OSPF_NSM_STATE_MAX][OSPF_NSM_EVENT_MAX]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a574380804c81a262de3cc8a42c713539"></a><!-- doxytag: member="ospf_nsm.c::ospf_nsm_event_str" ref="a574380804c81a262de3cc8a42c713539" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="ospf__nsm_8c.html#a574380804c81a262de3cc8a42c713539">ospf_nsm_event_str</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment">
{
  <span class="stringliteral">&quot;NoEvent&quot;</span>,
  <span class="stringliteral">&quot;HelloReceived&quot;</span>,
  <span class="stringliteral">&quot;Start&quot;</span>,
  <span class="stringliteral">&quot;2-WayReceived&quot;</span>,
  <span class="stringliteral">&quot;NegotiationDone&quot;</span>,
  <span class="stringliteral">&quot;ExchangeDone&quot;</span>,
  <span class="stringliteral">&quot;BadLSReq&quot;</span>,
  <span class="stringliteral">&quot;LoadingDone&quot;</span>,
  <span class="stringliteral">&quot;AdjOK?&quot;</span>,
  <span class="stringliteral">&quot;SeqNumberMismatch&quot;</span>,
  <span class="stringliteral">&quot;1-WayReceived&quot;</span>,
  <span class="stringliteral">&quot;KillNbr&quot;</span>,
  <span class="stringliteral">&quot;InactivityTimer&quot;</span>,
  <span class="stringliteral">&quot;LLDown&quot;</span>,
}
</pre></div>
<p>Definition at line <a class="el" href="ospf__nsm_8c_source.html#l00579">579</a> of file <a class="el" href="ospf__nsm_8c_source.html">ospf_nsm.c</a>.</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ospf__nsm_8c.html">ospf_nsm.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:30 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
