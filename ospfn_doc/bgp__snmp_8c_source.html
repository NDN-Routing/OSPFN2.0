<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: bgpd/bgp_snmp.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('bgp__snmp_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">bgpd/bgp_snmp.c</div>  </div>
</div>
<div class="contents">
<a href="bgp__snmp_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* BGP4 SNMP support</span>
<a name="l00002"></a>00002 <span class="comment">   Copyright (C) 1999, 2000 Kunihiro Ishiguro</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">This file is part of GNU Zebra.</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">GNU Zebra is free software; you can redistribute it and/or modify it</span>
<a name="l00007"></a>00007 <span class="comment">under the terms of the GNU General Public License as published by the</span>
<a name="l00008"></a>00008 <span class="comment">Free Software Foundation; either version 2, or (at your option) any</span>
<a name="l00009"></a>00009 <span class="comment">later version.</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment">GNU Zebra is distributed in the hope that it will be useful, but</span>
<a name="l00012"></a>00012 <span class="comment">WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00014"></a>00014 <span class="comment">General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment">You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment">along with GNU Zebra; see the file COPYING.  If not, write to the Free</span>
<a name="l00018"></a>00018 <span class="comment">Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA</span>
<a name="l00019"></a>00019 <span class="comment">02111-1307, USA.  */</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;<a class="code" href="zebra_8h.html">zebra.h</a>&gt;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#ifdef HAVE_SNMP</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_NETSNMP</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#include &lt;net-snmp/net-snmp-config.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;net-snmp/net-snmp-includes.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#else</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#include &lt;asn1.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;snmp.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;snmp_impl.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#endif</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="if_8h.html">if.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="log_8h.html">log.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="prefix_8h.html">prefix.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="command_8h.html">command.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="thread_8h.html">thread.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="smux_8h.html">smux.h</a>&quot;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="bgpd_8h.html">bgpd/bgpd.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="bgp__table_8h.html">bgpd/bgp_table.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="bgp__aspath_8h.html">bgpd/bgp_aspath.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="bgp__attr_8h.html">bgpd/bgp_attr.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="bgp__route_8h.html">bgpd/bgp_route.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="bgp__fsm_8h.html">bgpd/bgp_fsm.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="bgp__snmp_8h.html">bgpd/bgp_snmp.h</a>&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="comment">/* BGP4-MIB described in RFC1657. */</span>
<a name="l00049"></a>00049 <span class="preprocessor">#define BGP4MIB 1,3,6,1,2,1,15</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span>
<a name="l00051"></a>00051 <span class="comment">/* BGP TRAP. */</span>
<a name="l00052"></a>00052 <span class="preprocessor">#define BGPESTABLISHED          1</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">#define BGPBACKWARDTRANSITION       2   </span>
<a name="l00054"></a>00054 <span class="preprocessor"></span>
<a name="l00055"></a>00055 <span class="comment">/* BGP MIB bgpVersion. */</span>
<a name="l00056"></a>00056 <span class="preprocessor">#define BGPVERSION                0</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>
<a name="l00058"></a>00058 <span class="comment">/* BGP MIB bgpLocalAs. */</span>
<a name="l00059"></a>00059 <span class="preprocessor">#define BGPLOCALAS                0</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>
<a name="l00061"></a>00061 <span class="comment">/* BGP MIB bgpPeerTable. */</span>
<a name="l00062"></a>00062 <span class="preprocessor">#define BGPPEERIDENTIFIER                     1</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERSTATE                          2</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERADMINSTATUS                    3</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERNEGOTIATEDVERSION              4</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERLOCALADDR                      5</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERLOCALPORT                      6</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERREMOTEADDR                     7</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERREMOTEPORT                     8</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERREMOTEAS                       9</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERINUPDATES                     10</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEEROUTUPDATES                    11</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERINTOTALMESSAGES               12</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEEROUTTOTALMESSAGES              13</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERLASTERROR                     14</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERFSMESTABLISHEDTRANSITIONS     15</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERFSMESTABLISHEDTIME            16</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERCONNECTRETRYINTERVAL          17</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERHOLDTIME                      18</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERKEEPALIVE                     19</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERHOLDTIMECONFIGURED            20</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERKEEPALIVECONFIGURED           21</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERMINASORIGINATIONINTERVAL      22</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERMINROUTEADVERTISEMENTINTERVAL 23</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span><span class="preprocessor">#define BGPPEERINUPDATEELAPSEDTIME           24</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span>
<a name="l00087"></a>00087 <span class="comment">/* BGP MIB bgpIdentifier. */</span>
<a name="l00088"></a>00088 <span class="preprocessor">#define BGPIDENTIFIER                         0</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00090"></a>00090 <span class="comment">/* BGP MIB bgpRcvdPathAttrTable */</span>
<a name="l00091"></a>00091 <span class="preprocessor">#define BGPPATHATTRPEER                       1</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span><span class="preprocessor">#define BGPPATHATTRDESTNETWORK                2</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span><span class="preprocessor">#define BGPPATHATTRORIGIN                     3</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span><span class="preprocessor">#define BGPPATHATTRASPATH                     4</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="preprocessor">#define BGPPATHATTRNEXTHOP                    5</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span><span class="preprocessor">#define BGPPATHATTRINTERASMETRIC              6</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>
<a name="l00098"></a>00098 <span class="comment">/* BGP MIB bgp4PathAttrTable. */</span>
<a name="l00099"></a>00099 <span class="preprocessor">#define BGP4PATHATTRPEER                      1</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span><span class="preprocessor">#define BGP4PATHATTRIPADDRPREFIXLEN           2</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span><span class="preprocessor">#define BGP4PATHATTRIPADDRPREFIX              3</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span><span class="preprocessor">#define BGP4PATHATTRORIGIN                    4</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span><span class="preprocessor">#define BGP4PATHATTRASPATHSEGMENT             5</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span><span class="preprocessor">#define BGP4PATHATTRNEXTHOP                   6</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span><span class="preprocessor">#define BGP4PATHATTRMULTIEXITDISC             7</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span><span class="preprocessor">#define BGP4PATHATTRLOCALPREF                 8</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span><span class="preprocessor">#define BGP4PATHATTRATOMICAGGREGATE           9</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span><span class="preprocessor">#define BGP4PATHATTRAGGREGATORAS             10</span>
<a name="l00109"></a>00109 <span class="preprocessor"></span><span class="preprocessor">#define BGP4PATHATTRAGGREGATORADDR           11</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span><span class="preprocessor">#define BGP4PATHATTRCALCLOCALPREF            12</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span><span class="preprocessor">#define BGP4PATHATTRBEST                     13</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span><span class="preprocessor">#define BGP4PATHATTRUNKNOWN                  14</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span>
<a name="l00114"></a>00114 <span class="comment">/* SNMP value hack. */</span>
<a name="l00115"></a>00115 <span class="preprocessor">#define INTEGER ASN_INTEGER</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span><span class="preprocessor">#define INTEGER32 ASN_INTEGER</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span><span class="preprocessor">#define COUNTER32 ASN_COUNTER</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span><span class="preprocessor">#define OCTET_STRING ASN_OCTET_STR</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span><span class="preprocessor">#define IPADDRESS ASN_IPADDRESS</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span><span class="preprocessor">#define GAUGE32 ASN_UNSIGNED</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span>
<a name="l00122"></a>00122 <span class="comment">/* Declare static local variables for convenience. */</span>
<a name="l00123"></a>00123 <a class="code" href="smux_8h.html#af4d69d4f09e2b7bedf8a6c9f8b704471">SNMP_LOCAL_VARIABLES</a>
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <span class="comment">/* BGP-MIB instances. */</span>
<a name="l00126"></a>00126 oid bgp_oid [] = { BGP4MIB };
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <span class="comment">/* IP address 0.0.0.0. */</span>
<a name="l00129"></a>00129 <span class="keyword">static</span> <span class="keyword">struct </span>in_addr bgp_empty_addr = {0};
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 <span class="comment">/* Hook functions. */</span>
<a name="l00132"></a>00132 <span class="keyword">static</span> u_char *bgpVersion (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *, oid [], <span class="keywordtype">size_t</span> *, <span class="keywordtype">int</span>,
<a name="l00133"></a>00133                <span class="keywordtype">size_t</span> *, <a class="code" href="smux_8h.html#ace14719892f7615b0228ad97d4cc8040">WriteMethod</a> **);
<a name="l00134"></a>00134 <span class="keyword">static</span> u_char *bgpLocalAs (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *, oid [], <span class="keywordtype">size_t</span> *,
<a name="l00135"></a>00135                <span class="keywordtype">int</span>, <span class="keywordtype">size_t</span> *, <a class="code" href="smux_8h.html#ace14719892f7615b0228ad97d4cc8040">WriteMethod</a> **);
<a name="l00136"></a>00136 <span class="keyword">static</span> u_char *bgpPeerTable (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *, oid [], <span class="keywordtype">size_t</span> *,
<a name="l00137"></a>00137                  <span class="keywordtype">int</span>, <span class="keywordtype">size_t</span> *, <a class="code" href="smux_8h.html#ace14719892f7615b0228ad97d4cc8040">WriteMethod</a> **);
<a name="l00138"></a>00138 <span class="keyword">static</span> u_char *bgpRcvdPathAttrTable (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *, oid [], <span class="keywordtype">size_t</span> *,
<a name="l00139"></a>00139                      <span class="keywordtype">int</span>, <span class="keywordtype">size_t</span> *, <a class="code" href="smux_8h.html#ace14719892f7615b0228ad97d4cc8040">WriteMethod</a> **);
<a name="l00140"></a>00140 <span class="keyword">static</span> u_char *bgpIdentifier (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *, oid [], <span class="keywordtype">size_t</span> *,
<a name="l00141"></a>00141                   <span class="keywordtype">int</span>, <span class="keywordtype">size_t</span> *, <a class="code" href="smux_8h.html#ace14719892f7615b0228ad97d4cc8040">WriteMethod</a> **);
<a name="l00142"></a>00142 <span class="keyword">static</span> u_char *bgp4PathAttrTable (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *, oid [], <span class="keywordtype">size_t</span> *,
<a name="l00143"></a>00143                   <span class="keywordtype">int</span>, <span class="keywordtype">size_t</span> *, <a class="code" href="smux_8h.html#ace14719892f7615b0228ad97d4cc8040">WriteMethod</a> **);
<a name="l00144"></a>00144 <span class="comment">/* static u_char *bgpTraps (); */</span>
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 <span class="keyword">struct </span><a class="code" href="structvariable.html">variable</a> bgp_variables[] = 
<a name="l00147"></a>00147 {
<a name="l00148"></a>00148   <span class="comment">/* BGP version. */</span>
<a name="l00149"></a>00149   {BGPVERSION,                OCTET_STRING, RONLY, bgpVersion,
<a name="l00150"></a>00150    1, {1}},
<a name="l00151"></a>00151   <span class="comment">/* BGP local AS. */</span>
<a name="l00152"></a>00152   {BGPLOCALAS,                INTEGER, RONLY, bgpLocalAs,
<a name="l00153"></a>00153    1, {2}},
<a name="l00154"></a>00154   <span class="comment">/* BGP peer table. */</span>
<a name="l00155"></a>00155   {BGPPEERIDENTIFIER,         IPADDRESS, RONLY, bgpPeerTable,
<a name="l00156"></a>00156    3, {3, 1, 1}},
<a name="l00157"></a>00157   {BGPPEERSTATE,              INTEGER, RONLY, bgpPeerTable,
<a name="l00158"></a>00158    3, {3, 1, 2}},
<a name="l00159"></a>00159   {BGPPEERADMINSTATUS,        INTEGER, RWRITE, bgpPeerTable,
<a name="l00160"></a>00160    3, {3, 1, 3}},
<a name="l00161"></a>00161   {BGPPEERNEGOTIATEDVERSION,  INTEGER32, RONLY, bgpPeerTable,
<a name="l00162"></a>00162    3, {3, 1, 4}},
<a name="l00163"></a>00163   {BGPPEERLOCALADDR,          IPADDRESS, RONLY, bgpPeerTable,
<a name="l00164"></a>00164    3, {3, 1, 5}},
<a name="l00165"></a>00165   {BGPPEERLOCALPORT,          INTEGER, RONLY, bgpPeerTable,
<a name="l00166"></a>00166    3, {3, 1, 6}},
<a name="l00167"></a>00167   {BGPPEERREMOTEADDR,         IPADDRESS, RONLY, bgpPeerTable,
<a name="l00168"></a>00168    3, {3, 1, 7}},
<a name="l00169"></a>00169   {BGPPEERREMOTEPORT,         INTEGER, RONLY, bgpPeerTable,
<a name="l00170"></a>00170    3, {3, 1, 8}},
<a name="l00171"></a>00171   {BGPPEERREMOTEAS,           INTEGER, RONLY, bgpPeerTable,
<a name="l00172"></a>00172    3, {3, 1, 9}},
<a name="l00173"></a>00173   {BGPPEERINUPDATES,          COUNTER32, RONLY, bgpPeerTable,
<a name="l00174"></a>00174    3, {3, 1, 10}},
<a name="l00175"></a>00175   {BGPPEEROUTUPDATES,         COUNTER32, RONLY, bgpPeerTable,
<a name="l00176"></a>00176    3, {3, 1, 11}},
<a name="l00177"></a>00177   {BGPPEERINTOTALMESSAGES,    COUNTER32, RONLY, bgpPeerTable,
<a name="l00178"></a>00178    3, {3, 1, 12}},
<a name="l00179"></a>00179   {BGPPEEROUTTOTALMESSAGES,   COUNTER32, RONLY, bgpPeerTable,
<a name="l00180"></a>00180    3, {3, 1, 13}},
<a name="l00181"></a>00181   {BGPPEERLASTERROR,          OCTET_STRING, RONLY, bgpPeerTable,
<a name="l00182"></a>00182    3, {3, 1, 14}},
<a name="l00183"></a>00183   {BGPPEERFSMESTABLISHEDTRANSITIONS, COUNTER32, RONLY, bgpPeerTable,
<a name="l00184"></a>00184    3, {3, 1, 15}},
<a name="l00185"></a>00185   {BGPPEERFSMESTABLISHEDTIME, GAUGE32, RONLY, bgpPeerTable,
<a name="l00186"></a>00186    3, {3, 1, 16}},
<a name="l00187"></a>00187   {BGPPEERCONNECTRETRYINTERVAL, INTEGER, RWRITE, bgpPeerTable,
<a name="l00188"></a>00188    3, {3, 1, 17}},
<a name="l00189"></a>00189   {BGPPEERHOLDTIME,           INTEGER, RONLY, bgpPeerTable,
<a name="l00190"></a>00190    3, {3, 1, 18}},
<a name="l00191"></a>00191   {BGPPEERKEEPALIVE,          INTEGER, RONLY, bgpPeerTable,
<a name="l00192"></a>00192    3, {3, 1, 19}},
<a name="l00193"></a>00193   {BGPPEERHOLDTIMECONFIGURED, INTEGER, RWRITE, bgpPeerTable,
<a name="l00194"></a>00194    3, {3, 1, 20}},
<a name="l00195"></a>00195   {BGPPEERKEEPALIVECONFIGURED, INTEGER, RWRITE, bgpPeerTable,
<a name="l00196"></a>00196    3, {3, 1, 21}},
<a name="l00197"></a>00197   {BGPPEERMINASORIGINATIONINTERVAL, INTEGER, RWRITE, bgpPeerTable,
<a name="l00198"></a>00198    3, {3, 1, 22}},
<a name="l00199"></a>00199   {BGPPEERMINROUTEADVERTISEMENTINTERVAL, INTEGER, RWRITE, bgpPeerTable,
<a name="l00200"></a>00200    3, {3, 1, 23}},
<a name="l00201"></a>00201   {BGPPEERINUPDATEELAPSEDTIME, GAUGE32, RONLY, bgpPeerTable,
<a name="l00202"></a>00202    3, {3, 1, 24}},
<a name="l00203"></a>00203   <span class="comment">/* BGP identifier. */</span>
<a name="l00204"></a>00204   {BGPIDENTIFIER,             IPADDRESS, RONLY, bgpIdentifier,
<a name="l00205"></a>00205    1, {4}},
<a name="l00206"></a>00206   <span class="comment">/* BGP received path attribute table. */</span>
<a name="l00207"></a>00207   {BGPPATHATTRPEER,           IPADDRESS, RONLY, bgpRcvdPathAttrTable,
<a name="l00208"></a>00208    3, {5, 1, 1}},
<a name="l00209"></a>00209   {BGPPATHATTRDESTNETWORK,    IPADDRESS, RONLY, bgpRcvdPathAttrTable,
<a name="l00210"></a>00210    3, {5, 1, 2}},
<a name="l00211"></a>00211   {BGPPATHATTRORIGIN,         INTEGER, RONLY, bgpRcvdPathAttrTable,
<a name="l00212"></a>00212    3, {5, 1, 3}},
<a name="l00213"></a>00213   {BGPPATHATTRASPATH,         OCTET_STRING, RONLY, bgpRcvdPathAttrTable,
<a name="l00214"></a>00214    3, {5, 1, 4}},
<a name="l00215"></a>00215   {BGPPATHATTRNEXTHOP,        IPADDRESS, RONLY, bgpRcvdPathAttrTable,
<a name="l00216"></a>00216    3, {5, 1, 5}},
<a name="l00217"></a>00217   {BGPPATHATTRINTERASMETRIC,  INTEGER32, RONLY, bgpRcvdPathAttrTable,
<a name="l00218"></a>00218    3, {5, 1, 6}},
<a name="l00219"></a>00219   <span class="comment">/* BGP-4 received path attribute table. */</span>
<a name="l00220"></a>00220   {BGP4PATHATTRPEER, IPADDRESS, RONLY, bgp4PathAttrTable,
<a name="l00221"></a>00221    3, {6, 1, 1}},
<a name="l00222"></a>00222   {BGP4PATHATTRIPADDRPREFIXLEN, INTEGER, RONLY, bgp4PathAttrTable,
<a name="l00223"></a>00223    3, {6, 1, 2}},
<a name="l00224"></a>00224   {BGP4PATHATTRIPADDRPREFIX,  IPADDRESS, RONLY, bgp4PathAttrTable,
<a name="l00225"></a>00225    3, {6, 1, 3}},
<a name="l00226"></a>00226   {BGP4PATHATTRORIGIN,        INTEGER, RONLY, bgp4PathAttrTable,
<a name="l00227"></a>00227    3, {6, 1, 4}},
<a name="l00228"></a>00228   {BGP4PATHATTRASPATHSEGMENT, OCTET_STRING, RONLY, bgp4PathAttrTable,
<a name="l00229"></a>00229    3, {6, 1, 5}},
<a name="l00230"></a>00230   {BGP4PATHATTRNEXTHOP,       IPADDRESS, RONLY, bgp4PathAttrTable,
<a name="l00231"></a>00231    3, {6, 1, 6}},
<a name="l00232"></a>00232   {BGP4PATHATTRMULTIEXITDISC, INTEGER, RONLY, bgp4PathAttrTable,
<a name="l00233"></a>00233    3, {6, 1, 7}},
<a name="l00234"></a>00234   {BGP4PATHATTRLOCALPREF,     INTEGER, RONLY, bgp4PathAttrTable,
<a name="l00235"></a>00235    3, {6, 1, 8}},
<a name="l00236"></a>00236   {BGP4PATHATTRATOMICAGGREGATE, INTEGER, RONLY, bgp4PathAttrTable,
<a name="l00237"></a>00237    3, {6, 1, 9}},
<a name="l00238"></a>00238   {BGP4PATHATTRAGGREGATORAS,  INTEGER, RONLY, bgp4PathAttrTable,
<a name="l00239"></a>00239    3, {6, 1, 10}},
<a name="l00240"></a>00240   {BGP4PATHATTRAGGREGATORADDR, IPADDRESS, RONLY, bgp4PathAttrTable,
<a name="l00241"></a>00241    3, {6, 1, 11}},
<a name="l00242"></a>00242   {BGP4PATHATTRCALCLOCALPREF, INTEGER, RONLY, bgp4PathAttrTable,
<a name="l00243"></a>00243    3, {6, 1, 12}},
<a name="l00244"></a>00244   {BGP4PATHATTRBEST,          INTEGER, RONLY, bgp4PathAttrTable,
<a name="l00245"></a>00245    3, {6, 1, 13}},
<a name="l00246"></a>00246   {BGP4PATHATTRUNKNOWN,       OCTET_STRING, RONLY, bgp4PathAttrTable,
<a name="l00247"></a>00247    3, {6, 1, 14}},
<a name="l00248"></a>00248 };
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 <span class="keyword">static</span> u_char *
<a name="l00252"></a>00252 bgpVersion (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *v, oid <a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>[], <span class="keywordtype">size_t</span> *<a class="code" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a>, <span class="keywordtype">int</span> exact,
<a name="l00253"></a>00253         <span class="keywordtype">size_t</span> *var_len, <a class="code" href="smux_8h.html#ace14719892f7615b0228ad97d4cc8040">WriteMethod</a> **write_method)
<a name="l00254"></a>00254 {
<a name="l00255"></a>00255   <span class="keyword">static</span> u_char <a class="code" href="isis__pdu_8h.html#ac477ee30f0ed8c0b09a6f3387287191f">version</a>;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257   <span class="keywordflow">if</span> (<a class="code" href="smux_8h.html#a15cc4f7bbc1b70b7fc5179e939073238">smux_header_generic</a>(v, name, length, exact, var_len, write_method)
<a name="l00258"></a>00258       == <a class="code" href="smux_8h.html#ac8ad57fb87ae8e10684a7b910e92bba6">MATCH_FAILED</a>)
<a name="l00259"></a>00259     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261   <span class="comment">/* Retrun BGP version.  Zebra bgpd only support version 4. */</span>
<a name="l00262"></a>00262   version = (0x80 &gt;&gt; (<a class="code" href="bgpd_8h.html#a9379703a2ec6cf40b147ec96a7777ef3">BGP_VERSION_4</a> - 1));
<a name="l00263"></a>00263 
<a name="l00264"></a>00264   <span class="comment">/* Return octet string length 1. */</span>
<a name="l00265"></a>00265   *var_len = 1;
<a name="l00266"></a>00266   <span class="keywordflow">return</span> (u_char *)&amp;<a class="code" href="isis__pdu_8h.html#ac477ee30f0ed8c0b09a6f3387287191f">version</a>;
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 <span class="keyword">static</span> u_char *
<a name="l00270"></a>00270 bgpLocalAs (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *v, oid name[], <span class="keywordtype">size_t</span> *length,
<a name="l00271"></a>00271         <span class="keywordtype">int</span> exact, <span class="keywordtype">size_t</span> *var_len, <a class="code" href="smux_8h.html#ace14719892f7615b0228ad97d4cc8040">WriteMethod</a> **write_method)
<a name="l00272"></a>00272 {
<a name="l00273"></a>00273   <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275   <span class="keywordflow">if</span> (<a class="code" href="smux_8h.html#a15cc4f7bbc1b70b7fc5179e939073238">smux_header_generic</a>(v, name, length, exact, var_len, write_method)
<a name="l00276"></a>00276       == <a class="code" href="smux_8h.html#ac8ad57fb87ae8e10684a7b910e92bba6">MATCH_FAILED</a>)
<a name="l00277"></a>00277     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279   <span class="comment">/* Get BGP structure. */</span>
<a name="l00280"></a>00280   bgp = <a class="code" href="bgpd_8c.html#ae19787bc29126d524ac261d00bacc13d">bgp_get_default</a> ();
<a name="l00281"></a>00281   <span class="keywordflow">if</span> (! bgp)
<a name="l00282"></a>00282     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284   <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (bgp-&gt;<a class="code" href="structbgp.html#a47faf46bdc2227fb56df263f60c099fb">as</a>);
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *
<a name="l00288"></a>00288 peer_lookup_addr_ipv4 (<span class="keyword">struct</span> in_addr *src)
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290   <span class="keyword">struct </span>bgp *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
<a name="l00291"></a>00291   <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *<a class="code" href="structpeer.html">peer</a>;
<a name="l00292"></a>00292   <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node;
<a name="l00293"></a>00293   <span class="keyword">struct </span>in_addr addr;
<a name="l00294"></a>00294   <span class="keywordtype">int</span> ret;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296   bgp = <a class="code" href="bgpd_8c.html#ae19787bc29126d524ac261d00bacc13d">bgp_get_default</a> ();
<a name="l00297"></a>00297   <span class="keywordflow">if</span> (! bgp)
<a name="l00298"></a>00298     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (bgp-&gt;<a class="code" href="structbgp.html#a99704607de62cd6d36eb8674f921ba8a">peer</a>, node, peer))
<a name="l00301"></a>00301     {
<a name="l00302"></a>00302       ret = <a class="code" href="sockunion_8c.html#ac13c2042641ea5031bc7e244e8061b84">inet_pton</a> (AF_INET, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, &amp;addr);
<a name="l00303"></a>00303       <span class="keywordflow">if</span> (ret &gt; 0)
<a name="l00304"></a>00304     {
<a name="l00305"></a>00305       <span class="keywordflow">if</span> (<a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a> (&amp;addr, src))
<a name="l00306"></a>00306         <span class="keywordflow">return</span> peer;
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309   <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00310"></a>00310 }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 <span class="keyword">static</span> <span class="keyword">struct </span>peer *
<a name="l00313"></a>00313 bgp_peer_lookup_next (<span class="keyword">struct</span> in_addr *src)
<a name="l00314"></a>00314 {
<a name="l00315"></a>00315   <span class="keyword">struct </span>bgp *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
<a name="l00316"></a>00316   <span class="keyword">struct </span>peer *peer;
<a name="l00317"></a>00317   <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node;
<a name="l00318"></a>00318   <span class="keyword">struct </span>in_addr *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
<a name="l00319"></a>00319   <span class="keyword">union </span><a class="code" href="unionsockunion.html">sockunion</a> su;
<a name="l00320"></a>00320   <span class="keywordtype">int</span> ret;
<a name="l00321"></a>00321 
<a name="l00322"></a>00322   memset (&amp;su, 0, <span class="keyword">sizeof</span> (<span class="keyword">union</span> <a class="code" href="unionsockunion.html">sockunion</a>));
<a name="l00323"></a>00323 
<a name="l00324"></a>00324   bgp = <a class="code" href="bgpd_8c.html#ae19787bc29126d524ac261d00bacc13d">bgp_get_default</a> ();
<a name="l00325"></a>00325   <span class="keywordflow">if</span> (! bgp)
<a name="l00326"></a>00326     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328   <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (bgp-&gt;<a class="code" href="structbgp.html#a99704607de62cd6d36eb8674f921ba8a">peer</a>, node, peer))
<a name="l00329"></a>00329     {
<a name="l00330"></a>00330       ret = <a class="code" href="sockunion_8c.html#ac13c2042641ea5031bc7e244e8061b84">inet_pton</a> (AF_INET, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, &amp;su.sin.sin_addr);
<a name="l00331"></a>00331       <span class="keywordflow">if</span> (ret &gt; 0)
<a name="l00332"></a>00332     {
<a name="l00333"></a>00333       p = &amp;su.sin.sin_addr;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335       <span class="keywordflow">if</span> (ntohl (p-&gt;s_addr) &gt; ntohl (src-&gt;s_addr))
<a name="l00336"></a>00336         {
<a name="l00337"></a>00337           src-&gt;s_addr = p-&gt;s_addr;
<a name="l00338"></a>00338           <span class="keywordflow">return</span> peer;
<a name="l00339"></a>00339         }
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341     }
<a name="l00342"></a>00342   <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00343"></a>00343 }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="keyword">static</span> <span class="keyword">struct </span>peer *
<a name="l00346"></a>00346 bgpPeerTable_lookup (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *v, oid name[], <span class="keywordtype">size_t</span> *length, 
<a name="l00347"></a>00347              <span class="keyword">struct</span> in_addr *addr, <span class="keywordtype">int</span> exact)
<a name="l00348"></a>00348 {
<a name="l00349"></a>00349   <span class="keyword">struct </span>peer *peer = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00350"></a>00350   <span class="keywordtype">int</span> len;
<a name="l00351"></a>00351 
<a name="l00352"></a>00352   <span class="keywordflow">if</span> (exact)
<a name="l00353"></a>00353     {
<a name="l00354"></a>00354       <span class="comment">/* Check the length. */</span>
<a name="l00355"></a>00355       <span class="keywordflow">if</span> (*length - v-&gt;<a class="code" href="structvariable.html#a1f0065dda83058eaf89301e319ec4cf7">namelen</a> != sizeof (<span class="keyword">struct</span> in_addr))
<a name="l00356"></a>00356     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00357"></a>00357 
<a name="l00358"></a>00358       <a class="code" href="smux_8h.html#a849e1a9c24025af6be77cd10ec1fb798">oid2in_addr</a> (name + v-&gt;<a class="code" href="structvariable.html#a1f0065dda83058eaf89301e319ec4cf7">namelen</a>, <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>, addr);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360       peer = peer_lookup_addr_ipv4 (addr);
<a name="l00361"></a>00361       <span class="keywordflow">return</span> peer;
<a name="l00362"></a>00362     }
<a name="l00363"></a>00363   <span class="keywordflow">else</span>
<a name="l00364"></a>00364     {
<a name="l00365"></a>00365       len = *length - v-&gt;<a class="code" href="structvariable.html#a1f0065dda83058eaf89301e319ec4cf7">namelen</a>;
<a name="l00366"></a>00366       <span class="keywordflow">if</span> (len &gt; 4) len = 4;
<a name="l00367"></a>00367       
<a name="l00368"></a>00368       <a class="code" href="smux_8h.html#a849e1a9c24025af6be77cd10ec1fb798">oid2in_addr</a> (name + v-&gt;<a class="code" href="structvariable.html#a1f0065dda83058eaf89301e319ec4cf7">namelen</a>, len, addr);
<a name="l00369"></a>00369       
<a name="l00370"></a>00370       peer = bgp_peer_lookup_next (addr);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372       <span class="keywordflow">if</span> (peer == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00373"></a>00373     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375       <a class="code" href="smux_8h.html#add26a84014415e99f576c71009174dc3">oid_copy_addr</a> (name + v-&gt;<a class="code" href="structvariable.html#a1f0065dda83058eaf89301e319ec4cf7">namelen</a>, addr, sizeof (<span class="keyword">struct</span> in_addr));
<a name="l00376"></a>00376       *length = <span class="keyword">sizeof</span> (<span class="keyword">struct </span>in_addr) + v-&gt;namelen;
<a name="l00377"></a>00377 
<a name="l00378"></a>00378       <span class="keywordflow">return</span> peer;
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380   <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00381"></a>00381 }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 <span class="comment">/* BGP write methods. */</span>
<a name="l00384"></a>00384 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00385"></a>00385 write_bgpPeerTable (<span class="keywordtype">int</span> action, u_char *var_val,
<a name="l00386"></a>00386             u_char var_val_type, <span class="keywordtype">size_t</span> var_val_len,
<a name="l00387"></a>00387             u_char *statP, oid *name, <span class="keywordtype">size_t</span> length,
<a name="l00388"></a>00388             <span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *v)
<a name="l00389"></a>00389 {
<a name="l00390"></a>00390   <span class="keyword">struct </span>in_addr addr;
<a name="l00391"></a>00391   <span class="keyword">struct </span>peer *peer;
<a name="l00392"></a>00392   <span class="keywordtype">long</span> intval;
<a name="l00393"></a>00393   <span class="keywordtype">size_t</span> bigsize = SNMP_MAX_LEN;
<a name="l00394"></a>00394   
<a name="l00395"></a>00395   <span class="keywordflow">if</span> (var_val_type != ASN_INTEGER) 
<a name="l00396"></a>00396     {
<a name="l00397"></a>00397       <span class="keywordflow">return</span> SNMP_ERR_WRONGTYPE;
<a name="l00398"></a>00398     }
<a name="l00399"></a>00399   <span class="keywordflow">if</span> (var_val_len != <span class="keyword">sizeof</span> (<span class="keywordtype">long</span>)) 
<a name="l00400"></a>00400     {
<a name="l00401"></a>00401       <span class="keywordflow">return</span> SNMP_ERR_WRONGLENGTH;
<a name="l00402"></a>00402     }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404   <span class="keywordflow">if</span> (! asn_parse_int(var_val, &amp;bigsize, &amp;var_val_type,
<a name="l00405"></a>00405                       &amp;intval, <span class="keyword">sizeof</span>(<span class="keywordtype">long</span>)))
<a name="l00406"></a>00406     {
<a name="l00407"></a>00407       <span class="keywordflow">return</span> SNMP_ERR_WRONGENCODING;
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   memset (&amp;addr, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> in_addr));
<a name="l00411"></a>00411 
<a name="l00412"></a>00412   peer = bgpPeerTable_lookup (v, name, &amp;length, &amp;addr, 1);
<a name="l00413"></a>00413   <span class="keywordflow">if</span> (! peer)
<a name="l00414"></a>00414     <span class="keywordflow">return</span> SNMP_ERR_NOSUCHNAME;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416   printf (<span class="stringliteral">&quot;val: %ld\n&quot;</span>, intval);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418   <span class="keywordflow">switch</span> (v-&gt;<a class="code" href="structvariable.html#ade92e000ca0d35650cc43fc3e54e6350">magic</a>)
<a name="l00419"></a>00419     {
<a name="l00420"></a>00420     <span class="keywordflow">case</span> BGPPEERADMINSTATUS:
<a name="l00421"></a>00421 <span class="preprocessor">#define BGP_PeerAdmin_stop  1</span>
<a name="l00422"></a>00422 <span class="preprocessor"></span><span class="preprocessor">#define BGP_PeerAdmin_start 2</span>
<a name="l00423"></a>00423 <span class="preprocessor"></span>      <span class="comment">/* When the peer is established,   */</span>
<a name="l00424"></a>00424       <span class="keywordflow">if</span> (intval == BGP_PeerAdmin_stop)
<a name="l00425"></a>00425     <a class="code" href="bgp__fsm_8h.html#a20f7fd10817508149783bf6729dd6727">BGP_EVENT_ADD</a> (peer, <a class="code" href="bgpd_8h.html#afffcc626edea20680a6ba32cf6436cef">BGP_Stop</a>);
<a name="l00426"></a>00426       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (intval == BGP_PeerAdmin_start)
<a name="l00427"></a>00427     ;           <span class="comment">/* Do nothing. */</span>
<a name="l00428"></a>00428       <span class="keywordflow">else</span>
<a name="l00429"></a>00429     <span class="keywordflow">return</span> SNMP_ERR_NOSUCHNAME;
<a name="l00430"></a>00430       <span class="keywordflow">break</span>;
<a name="l00431"></a>00431     <span class="keywordflow">case</span> BGPPEERCONNECTRETRYINTERVAL:
<a name="l00432"></a>00432       <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#add88f88547df15dd579f2001840a5ffe">config</a>, <a class="code" href="bgpd_8h.html#abcb2523c04caddc7794ece86bc5bc4e2">PEER_CONFIG_CONNECT</a>);
<a name="l00433"></a>00433       peer-&gt;<a class="code" href="structpeer.html#a914a090d97c964785aae224189ee9037">connect</a> = intval;
<a name="l00434"></a>00434       peer-&gt;<a class="code" href="structpeer.html#a54ca5fae2bc177a95b9277dc6f2eac6e">v_connect</a> = intval;
<a name="l00435"></a>00435       <span class="keywordflow">break</span>;
<a name="l00436"></a>00436     <span class="keywordflow">case</span> BGPPEERHOLDTIMECONFIGURED:
<a name="l00437"></a>00437       <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#add88f88547df15dd579f2001840a5ffe">config</a>, <a class="code" href="bgpd_8h.html#a0a38ee681fef67382b59bcacf7e71acc">PEER_CONFIG_TIMER</a>);
<a name="l00438"></a>00438       peer-&gt;<a class="code" href="structpeer.html#a94b9ef3bd3f901c67be200f2b394c206">holdtime</a> = intval;
<a name="l00439"></a>00439       peer-&gt;<a class="code" href="structpeer.html#ade54caf4be91128837361d44f0239fa0">v_holdtime</a> = intval;
<a name="l00440"></a>00440       <span class="keywordflow">break</span>;
<a name="l00441"></a>00441     <span class="keywordflow">case</span> BGPPEERKEEPALIVECONFIGURED:
<a name="l00442"></a>00442       <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#add88f88547df15dd579f2001840a5ffe">config</a>, <a class="code" href="bgpd_8h.html#a0a38ee681fef67382b59bcacf7e71acc">PEER_CONFIG_TIMER</a>);
<a name="l00443"></a>00443       peer-&gt;<a class="code" href="structpeer.html#a26d22938043d49420b6c9753c7c1eb2b">keepalive</a> = intval;
<a name="l00444"></a>00444       peer-&gt;<a class="code" href="structpeer.html#a4683327b18d77b5888cc293b180f01ff">v_keepalive</a> = intval;
<a name="l00445"></a>00445       <span class="keywordflow">break</span>;
<a name="l00446"></a>00446     <span class="keywordflow">case</span> BGPPEERMINASORIGINATIONINTERVAL:
<a name="l00447"></a>00447       peer-&gt;<a class="code" href="structpeer.html#a3231acf11a68285301f4e4ef3c24df3e">v_asorig</a> = intval;
<a name="l00448"></a>00448       <span class="keywordflow">break</span>;
<a name="l00449"></a>00449     <span class="keywordflow">case</span> BGPPEERMINROUTEADVERTISEMENTINTERVAL:
<a name="l00450"></a>00450       peer-&gt;<a class="code" href="structpeer.html#a458c8875d94b9a7f90a7c4a827c8e4fb">v_routeadv</a> = intval;
<a name="l00451"></a>00451       <span class="keywordflow">break</span>;
<a name="l00452"></a>00452     }
<a name="l00453"></a>00453   <span class="keywordflow">return</span> SNMP_ERR_NOERROR;
<a name="l00454"></a>00454 }
<a name="l00455"></a>00455 
<a name="l00456"></a>00456 <span class="keyword">static</span> u_char *
<a name="l00457"></a>00457 bgpPeerTable (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *v, oid name[], <span class="keywordtype">size_t</span> *length,
<a name="l00458"></a>00458           <span class="keywordtype">int</span> exact, <span class="keywordtype">size_t</span> *var_len, <a class="code" href="smux_8h.html#ace14719892f7615b0228ad97d4cc8040">WriteMethod</a> **write_method)
<a name="l00459"></a>00459 {
<a name="l00460"></a>00460   <span class="keyword">static</span> <span class="keyword">struct </span>in_addr addr;
<a name="l00461"></a>00461   <span class="keyword">struct </span>peer *peer;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463   *write_method = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00464"></a>00464   memset (&amp;addr, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> in_addr));
<a name="l00465"></a>00465 
<a name="l00466"></a>00466   peer = bgpPeerTable_lookup (v, name, length, &amp;addr, exact);
<a name="l00467"></a>00467   <span class="keywordflow">if</span> (! peer)
<a name="l00468"></a>00468     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470   <span class="keywordflow">switch</span> (v-&gt;<a class="code" href="structvariable.html#ade92e000ca0d35650cc43fc3e54e6350">magic</a>)
<a name="l00471"></a>00471     {
<a name="l00472"></a>00472     <span class="keywordflow">case</span> BGPPEERIDENTIFIER:
<a name="l00473"></a>00473       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a8745a86f37751629f4c280c33b06646c">SNMP_IPADDRESS</a> (peer-&gt;<a class="code" href="structpeer.html#ae620d85ff35b31ba9eb6073b81731b5b">remote_id</a>);
<a name="l00474"></a>00474       <span class="keywordflow">break</span>;
<a name="l00475"></a>00475     <span class="keywordflow">case</span> BGPPEERSTATE:
<a name="l00476"></a>00476       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a>);
<a name="l00477"></a>00477       <span class="keywordflow">break</span>;
<a name="l00478"></a>00478     <span class="keywordflow">case</span> BGPPEERADMINSTATUS:
<a name="l00479"></a>00479       *write_method = write_bgpPeerTable;
<a name="l00480"></a>00480 <span class="preprocessor">#define BGP_PeerAdmin_stop  1</span>
<a name="l00481"></a>00481 <span class="preprocessor"></span><span class="preprocessor">#define BGP_PeerAdmin_start 2</span>
<a name="l00482"></a>00482 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a3f18e3da00909bb1ce53919fd7129b54">flags</a>, <a class="code" href="bgpd_8h.html#abeded936fd302062253377062392247d">PEER_FLAG_SHUTDOWN</a>))
<a name="l00483"></a>00483     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (BGP_PeerAdmin_stop);
<a name="l00484"></a>00484       <span class="keywordflow">else</span>
<a name="l00485"></a>00485     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (BGP_PeerAdmin_start);
<a name="l00486"></a>00486       <span class="keywordflow">break</span>;
<a name="l00487"></a>00487     <span class="keywordflow">case</span> BGPPEERNEGOTIATEDVERSION:
<a name="l00488"></a>00488       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (<a class="code" href="bgpd_8h.html#a9379703a2ec6cf40b147ec96a7777ef3">BGP_VERSION_4</a>);
<a name="l00489"></a>00489       <span class="keywordflow">break</span>;
<a name="l00490"></a>00490     <span class="keywordflow">case</span> BGPPEERLOCALADDR:
<a name="l00491"></a>00491       <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a063537a13602c890880e9c4f1d6fccd3">su_local</a>)
<a name="l00492"></a>00492     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a8745a86f37751629f4c280c33b06646c">SNMP_IPADDRESS</a> (peer-&gt;<a class="code" href="structpeer.html#a063537a13602c890880e9c4f1d6fccd3">su_local</a>-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr);
<a name="l00493"></a>00493       <span class="keywordflow">else</span>
<a name="l00494"></a>00494     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a8745a86f37751629f4c280c33b06646c">SNMP_IPADDRESS</a> (bgp_empty_addr);
<a name="l00495"></a>00495       <span class="keywordflow">break</span>;
<a name="l00496"></a>00496     <span class="keywordflow">case</span> BGPPEERLOCALPORT:
<a name="l00497"></a>00497       <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a063537a13602c890880e9c4f1d6fccd3">su_local</a>)
<a name="l00498"></a>00498     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (ntohs (peer-&gt;<a class="code" href="structpeer.html#a063537a13602c890880e9c4f1d6fccd3">su_local</a>-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_port));
<a name="l00499"></a>00499       <span class="keywordflow">else</span>
<a name="l00500"></a>00500     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (0);
<a name="l00501"></a>00501       <span class="keywordflow">break</span>;
<a name="l00502"></a>00502     <span class="keywordflow">case</span> BGPPEERREMOTEADDR:
<a name="l00503"></a>00503       <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a9ab7f1f3e48a3027c0f8a92fa6e2de28">su_remote</a>)
<a name="l00504"></a>00504     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a8745a86f37751629f4c280c33b06646c">SNMP_IPADDRESS</a> (peer-&gt;<a class="code" href="structpeer.html#a9ab7f1f3e48a3027c0f8a92fa6e2de28">su_remote</a>-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr);
<a name="l00505"></a>00505       <span class="keywordflow">else</span>
<a name="l00506"></a>00506     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a8745a86f37751629f4c280c33b06646c">SNMP_IPADDRESS</a> (bgp_empty_addr);
<a name="l00507"></a>00507       <span class="keywordflow">break</span>;
<a name="l00508"></a>00508     <span class="keywordflow">case</span> BGPPEERREMOTEPORT:
<a name="l00509"></a>00509       <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a9ab7f1f3e48a3027c0f8a92fa6e2de28">su_remote</a>)
<a name="l00510"></a>00510     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (ntohs (peer-&gt;<a class="code" href="structpeer.html#a9ab7f1f3e48a3027c0f8a92fa6e2de28">su_remote</a>-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_port));
<a name="l00511"></a>00511       <span class="keywordflow">else</span>
<a name="l00512"></a>00512     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (0);
<a name="l00513"></a>00513       <span class="keywordflow">break</span>;
<a name="l00514"></a>00514     <span class="keywordflow">case</span> BGPPEERREMOTEAS:
<a name="l00515"></a>00515       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#aa35fab1a77bb496d8377a62cad372314">as</a>);
<a name="l00516"></a>00516       <span class="keywordflow">break</span>;
<a name="l00517"></a>00517     <span class="keywordflow">case</span> BGPPEERINUPDATES:
<a name="l00518"></a>00518       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#ae48025e5febc2a1c549110d9326c589f">update_in</a>);
<a name="l00519"></a>00519       <span class="keywordflow">break</span>;
<a name="l00520"></a>00520     <span class="keywordflow">case</span> BGPPEEROUTUPDATES:
<a name="l00521"></a>00521       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#ae471ee06ab605d6101199ec38f06f3b6">update_out</a>);
<a name="l00522"></a>00522       <span class="keywordflow">break</span>;
<a name="l00523"></a>00523     <span class="keywordflow">case</span> BGPPEERINTOTALMESSAGES:
<a name="l00524"></a>00524       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#a76ca0a8b7f67bf4d7abab5609ec90aca">open_in</a> + peer-&gt;<a class="code" href="structpeer.html#ae48025e5febc2a1c549110d9326c589f">update_in</a>
<a name="l00525"></a>00525                + peer-&gt;<a class="code" href="structpeer.html#ad0f0ede8dbcf74fef9fd50a9086cb136">keepalive_in</a> + peer-&gt;<a class="code" href="structpeer.html#ac87703f5a1621676779a0603453ff203">notify_in</a>
<a name="l00526"></a>00526                + peer-&gt;<a class="code" href="structpeer.html#a2d6e4e26d5cc36e86e0c35e992273035">refresh_in</a> + peer-&gt;<a class="code" href="structpeer.html#a0a23af24ef314346a4522804b82290e8">dynamic_cap_in</a>);
<a name="l00527"></a>00527       <span class="keywordflow">break</span>;
<a name="l00528"></a>00528     <span class="keywordflow">case</span> BGPPEEROUTTOTALMESSAGES:
<a name="l00529"></a>00529       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#a6372a52ffefb71ae6e45658ba6961c48">open_out</a> + peer-&gt;<a class="code" href="structpeer.html#ae471ee06ab605d6101199ec38f06f3b6">update_out</a>
<a name="l00530"></a>00530                + peer-&gt;<a class="code" href="structpeer.html#af879557d041a38f1603e09a38834f241">keepalive_out</a> + peer-&gt;<a class="code" href="structpeer.html#a3c2d072c10be8fbf3d56dad221b799cc">notify_out</a>
<a name="l00531"></a>00531                + peer-&gt;<a class="code" href="structpeer.html#abba30cc4402a799a43f4eb7bd04e4dfe">refresh_out</a> + peer-&gt;<a class="code" href="structpeer.html#a787d4c08df4bb74dbd15d58f206f6768">dynamic_cap_out</a>);
<a name="l00532"></a>00532       <span class="keywordflow">break</span>;
<a name="l00533"></a>00533     <span class="keywordflow">case</span> BGPPEERLASTERROR:
<a name="l00534"></a>00534       {
<a name="l00535"></a>00535     <span class="keyword">static</span> u_char lasterror[2];
<a name="l00536"></a>00536     lasterror[0] = peer-&gt;<a class="code" href="structpeer.html#af794a3e8a439d6e3a44ccf9723049a23">notify</a>.<a class="code" href="structbgp__notify.html#ad627202af54280e7417636695f2e38b5">code</a>;
<a name="l00537"></a>00537     lasterror[1] = peer-&gt;<a class="code" href="structpeer.html#af794a3e8a439d6e3a44ccf9723049a23">notify</a>.<a class="code" href="structbgp__notify.html#acbad94da20e4f492c1115dfc9181f463">subcode</a>;
<a name="l00538"></a>00538     *var_len = 2;
<a name="l00539"></a>00539     <span class="keywordflow">return</span> (u_char *)&amp;lasterror;
<a name="l00540"></a>00540       }
<a name="l00541"></a>00541       <span class="keywordflow">break</span>;
<a name="l00542"></a>00542     <span class="keywordflow">case</span> BGPPEERFSMESTABLISHEDTRANSITIONS:
<a name="l00543"></a>00543       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#a7e83fe65d0739a31eb5025f2aa0a6d51">established</a>);
<a name="l00544"></a>00544       <span class="keywordflow">break</span>;
<a name="l00545"></a>00545     <span class="keywordflow">case</span> BGPPEERFSMESTABLISHEDTIME:
<a name="l00546"></a>00546       <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a008ca2beea8dd058639039cf2b468844">uptime</a> == 0)
<a name="l00547"></a>00547     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (0);
<a name="l00548"></a>00548       <span class="keywordflow">else</span>
<a name="l00549"></a>00549     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (<a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> () - peer-&gt;<a class="code" href="structpeer.html#a008ca2beea8dd058639039cf2b468844">uptime</a>);
<a name="l00550"></a>00550       <span class="keywordflow">break</span>;
<a name="l00551"></a>00551     <span class="keywordflow">case</span> BGPPEERCONNECTRETRYINTERVAL:
<a name="l00552"></a>00552       *write_method = write_bgpPeerTable;
<a name="l00553"></a>00553       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#a54ca5fae2bc177a95b9277dc6f2eac6e">v_connect</a>);
<a name="l00554"></a>00554       <span class="keywordflow">break</span>;
<a name="l00555"></a>00555     <span class="keywordflow">case</span> BGPPEERHOLDTIME:
<a name="l00556"></a>00556       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#ade54caf4be91128837361d44f0239fa0">v_holdtime</a>);
<a name="l00557"></a>00557       <span class="keywordflow">break</span>;
<a name="l00558"></a>00558     <span class="keywordflow">case</span> BGPPEERKEEPALIVE:
<a name="l00559"></a>00559       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#a4683327b18d77b5888cc293b180f01ff">v_keepalive</a>);
<a name="l00560"></a>00560       <span class="keywordflow">break</span>;
<a name="l00561"></a>00561     <span class="keywordflow">case</span> BGPPEERHOLDTIMECONFIGURED:
<a name="l00562"></a>00562       *write_method = write_bgpPeerTable;
<a name="l00563"></a>00563       <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#add88f88547df15dd579f2001840a5ffe">config</a>, <a class="code" href="bgpd_8h.html#a0a38ee681fef67382b59bcacf7e71acc">PEER_CONFIG_TIMER</a>))
<a name="l00564"></a>00564     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#a94b9ef3bd3f901c67be200f2b394c206">holdtime</a>);
<a name="l00565"></a>00565       <span class="keywordflow">else</span>
<a name="l00566"></a>00566     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#ade54caf4be91128837361d44f0239fa0">v_holdtime</a>);
<a name="l00567"></a>00567       <span class="keywordflow">break</span>;
<a name="l00568"></a>00568     <span class="keywordflow">case</span> BGPPEERKEEPALIVECONFIGURED:
<a name="l00569"></a>00569       *write_method = write_bgpPeerTable;
<a name="l00570"></a>00570       <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#add88f88547df15dd579f2001840a5ffe">config</a>, <a class="code" href="bgpd_8h.html#a0a38ee681fef67382b59bcacf7e71acc">PEER_CONFIG_TIMER</a>))
<a name="l00571"></a>00571     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#a26d22938043d49420b6c9753c7c1eb2b">keepalive</a>);
<a name="l00572"></a>00572       <span class="keywordflow">else</span>
<a name="l00573"></a>00573     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#a4683327b18d77b5888cc293b180f01ff">v_keepalive</a>);
<a name="l00574"></a>00574       <span class="keywordflow">break</span>;
<a name="l00575"></a>00575     <span class="keywordflow">case</span> BGPPEERMINASORIGINATIONINTERVAL:
<a name="l00576"></a>00576       *write_method = write_bgpPeerTable;
<a name="l00577"></a>00577       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#a3231acf11a68285301f4e4ef3c24df3e">v_asorig</a>);
<a name="l00578"></a>00578       <span class="keywordflow">break</span>;
<a name="l00579"></a>00579     <span class="keywordflow">case</span> BGPPEERMINROUTEADVERTISEMENTINTERVAL:
<a name="l00580"></a>00580       *write_method = write_bgpPeerTable;
<a name="l00581"></a>00581       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (peer-&gt;<a class="code" href="structpeer.html#a458c8875d94b9a7f90a7c4a827c8e4fb">v_routeadv</a>);
<a name="l00582"></a>00582       <span class="keywordflow">break</span>;
<a name="l00583"></a>00583     <span class="keywordflow">case</span> BGPPEERINUPDATEELAPSEDTIME:
<a name="l00584"></a>00584       <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a417a77217f3ecfb948016245a4eaf650">update_time</a> == 0)
<a name="l00585"></a>00585     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (0);
<a name="l00586"></a>00586       <span class="keywordflow">else</span>
<a name="l00587"></a>00587     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (<a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> () - peer-&gt;<a class="code" href="structpeer.html#a417a77217f3ecfb948016245a4eaf650">update_time</a>);
<a name="l00588"></a>00588       <span class="keywordflow">break</span>;
<a name="l00589"></a>00589     <span class="keywordflow">default</span>:
<a name="l00590"></a>00590       <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00591"></a>00591       <span class="keywordflow">break</span>;
<a name="l00592"></a>00592     }  
<a name="l00593"></a>00593   <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00594"></a>00594 }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596 <span class="keyword">static</span> u_char *
<a name="l00597"></a>00597 bgpIdentifier (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *v, oid name[], <span class="keywordtype">size_t</span> *length,
<a name="l00598"></a>00598            <span class="keywordtype">int</span> exact, <span class="keywordtype">size_t</span> *var_len, <a class="code" href="smux_8h.html#ace14719892f7615b0228ad97d4cc8040">WriteMethod</a> **write_method)
<a name="l00599"></a>00599 {
<a name="l00600"></a>00600   <span class="keyword">struct </span>bgp *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
<a name="l00601"></a>00601 
<a name="l00602"></a>00602   <span class="keywordflow">if</span> (<a class="code" href="smux_8h.html#a15cc4f7bbc1b70b7fc5179e939073238">smux_header_generic</a>(v, name, length, exact, var_len, write_method)
<a name="l00603"></a>00603       == <a class="code" href="smux_8h.html#ac8ad57fb87ae8e10684a7b910e92bba6">MATCH_FAILED</a>)
<a name="l00604"></a>00604     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00605"></a>00605 
<a name="l00606"></a>00606   bgp = <a class="code" href="bgpd_8c.html#ae19787bc29126d524ac261d00bacc13d">bgp_get_default</a> ();
<a name="l00607"></a>00607   <span class="keywordflow">if</span> (!bgp)
<a name="l00608"></a>00608     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00609"></a>00609 
<a name="l00610"></a>00610   <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a8745a86f37751629f4c280c33b06646c">SNMP_IPADDRESS</a> (bgp-&gt;<a class="code" href="structbgp.html#ac85364afca7a6afc7c184148355318a7">router_id</a>);
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 <span class="keyword">static</span> u_char *
<a name="l00614"></a>00614 bgpRcvdPathAttrTable (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *v, oid name[], <span class="keywordtype">size_t</span> *length,
<a name="l00615"></a>00615               <span class="keywordtype">int</span> exact, <span class="keywordtype">size_t</span> *var_len, <a class="code" href="smux_8h.html#ace14719892f7615b0228ad97d4cc8040">WriteMethod</a> **write_method)
<a name="l00616"></a>00616 {
<a name="l00617"></a>00617   <span class="comment">/* Received Path Attribute Table.  This table contains, one entry</span>
<a name="l00618"></a>00618 <span class="comment">     per path to a network, path attributes received from all peers</span>
<a name="l00619"></a>00619 <span class="comment">     running BGP version 3 or less.  This table is obsolete, having</span>
<a name="l00620"></a>00620 <span class="comment">     been replaced in functionality with the bgp4PathAttrTable.  */</span>
<a name="l00621"></a>00621   <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00622"></a>00622 }
<a name="l00623"></a>00623 
<a name="l00624"></a>00624 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *
<a name="l00625"></a>00625 bgp4PathAttrLookup (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *v, oid name[], <span class="keywordtype">size_t</span> *length,
<a name="l00626"></a>00626             <span class="keyword">struct</span> bgp *bgp, <span class="keyword">struct</span> <a class="code" href="structprefix__ipv4.html">prefix_ipv4</a> *addr, <span class="keywordtype">int</span> exact)
<a name="l00627"></a>00627 {
<a name="l00628"></a>00628   oid *offset;
<a name="l00629"></a>00629   <span class="keywordtype">int</span> offsetlen;
<a name="l00630"></a>00630   <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *binfo;
<a name="l00631"></a>00631   <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *<a class="code" href="bgp__aspath_8c.html#a2d017cd3beb218080a7988e2deed2a11">min</a>;
<a name="l00632"></a>00632   <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
<a name="l00633"></a>00633   <span class="keyword">union </span><a class="code" href="unionsockunion.html">sockunion</a> su;
<a name="l00634"></a>00634   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len;
<a name="l00635"></a>00635   <span class="keyword">struct </span>in_addr paddr;
<a name="l00636"></a>00636 
<a name="l00637"></a>00637 <span class="preprocessor">#define BGP_PATHATTR_ENTRY_OFFSET \</span>
<a name="l00638"></a>00638 <span class="preprocessor">          (IN_ADDR_SIZE + 1 + IN_ADDR_SIZE)</span>
<a name="l00639"></a>00639 <span class="preprocessor"></span>
<a name="l00640"></a>00640   <span class="keywordflow">if</span> (exact)
<a name="l00641"></a>00641     {
<a name="l00642"></a>00642       <span class="keywordflow">if</span> (*length - v-&gt;<a class="code" href="structvariable.html#a1f0065dda83058eaf89301e319ec4cf7">namelen</a> != BGP_PATHATTR_ENTRY_OFFSET)
<a name="l00643"></a>00643     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00644"></a>00644 
<a name="l00645"></a>00645       <span class="comment">/* Set OID offset for prefix. */</span>
<a name="l00646"></a>00646       offset = name + v-&gt;<a class="code" href="structvariable.html#a1f0065dda83058eaf89301e319ec4cf7">namelen</a>;
<a name="l00647"></a>00647       <a class="code" href="smux_8h.html#a849e1a9c24025af6be77cd10ec1fb798">oid2in_addr</a> (offset, <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>, &amp;addr-&gt;prefix);
<a name="l00648"></a>00648       offset += <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>;
<a name="l00649"></a>00649 
<a name="l00650"></a>00650       <span class="comment">/* Prefix length. */</span>
<a name="l00651"></a>00651       addr-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> = *offset;
<a name="l00652"></a>00652       offset++;
<a name="l00653"></a>00653 
<a name="l00654"></a>00654       <span class="comment">/* Peer address. */</span>
<a name="l00655"></a>00655       su.sin.sin_family = AF_INET;
<a name="l00656"></a>00656       <a class="code" href="smux_8h.html#a849e1a9c24025af6be77cd10ec1fb798">oid2in_addr</a> (offset, <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>, &amp;su.sin.sin_addr);
<a name="l00657"></a>00657 
<a name="l00658"></a>00658       <span class="comment">/* Lookup node. */</span>
<a name="l00659"></a>00659       rn = <a class="code" href="bgp__table_8c.html#aa67a654ce220da27fb3f02757fcb0bdc">bgp_node_lookup</a> (bgp-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[<a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>][<a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>], 
<a name="l00660"></a>00660                   (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *) addr);
<a name="l00661"></a>00661       <span class="keywordflow">if</span> (rn)
<a name="l00662"></a>00662     {
<a name="l00663"></a>00663       <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
<a name="l00664"></a>00664 
<a name="l00665"></a>00665       <span class="keywordflow">for</span> (binfo = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; binfo; binfo = binfo-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
<a name="l00666"></a>00666         <span class="keywordflow">if</span> (<a class="code" href="sockunion_8c.html#afbcb327baabeb77f356791b1551e51b8">sockunion_same</a> (&amp;binfo-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#ab793b0acdca7d325f32edc25503b83b9">su</a>, &amp;su))
<a name="l00667"></a>00667           <span class="keywordflow">return</span> binfo;
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669     }
<a name="l00670"></a>00670   <span class="keywordflow">else</span>
<a name="l00671"></a>00671     {
<a name="l00672"></a>00672       offset = name + v-&gt;<a class="code" href="structvariable.html#a1f0065dda83058eaf89301e319ec4cf7">namelen</a>;
<a name="l00673"></a>00673       offsetlen = *length - v-&gt;<a class="code" href="structvariable.html#a1f0065dda83058eaf89301e319ec4cf7">namelen</a>;
<a name="l00674"></a>00674       len = offsetlen;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676       <span class="keywordflow">if</span> (offsetlen == 0)
<a name="l00677"></a>00677     rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (bgp-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[<a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>][<a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>]);
<a name="l00678"></a>00678       <span class="keywordflow">else</span>
<a name="l00679"></a>00679     {
<a name="l00680"></a>00680       <span class="keywordflow">if</span> (len &gt; <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>)
<a name="l00681"></a>00681         len = <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>;
<a name="l00682"></a>00682       
<a name="l00683"></a>00683       <a class="code" href="smux_8h.html#a849e1a9c24025af6be77cd10ec1fb798">oid2in_addr</a> (offset, len, &amp;addr-&gt;prefix);
<a name="l00684"></a>00684 
<a name="l00685"></a>00685       offset += <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>;
<a name="l00686"></a>00686       offsetlen -= <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>;
<a name="l00687"></a>00687 
<a name="l00688"></a>00688       <span class="keywordflow">if</span> (offsetlen &gt; 0)
<a name="l00689"></a>00689         addr-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> = *offset;
<a name="l00690"></a>00690       <span class="keywordflow">else</span>
<a name="l00691"></a>00691         addr-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> = len * 8;
<a name="l00692"></a>00692 
<a name="l00693"></a>00693       rn = <a class="code" href="bgp__table_8c.html#a81c9e9d48e2d66148c713e82968df389">bgp_node_get</a> (bgp-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[<a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>][<a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>],
<a name="l00694"></a>00694                    (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *) addr);
<a name="l00695"></a>00695 
<a name="l00696"></a>00696       offset++;
<a name="l00697"></a>00697       offsetlen--;
<a name="l00698"></a>00698     }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700       <span class="keywordflow">if</span> (offsetlen &gt; 0)
<a name="l00701"></a>00701     {
<a name="l00702"></a>00702       len = offsetlen;
<a name="l00703"></a>00703       <span class="keywordflow">if</span> (len &gt; <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>)
<a name="l00704"></a>00704         len = <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>;
<a name="l00705"></a>00705 
<a name="l00706"></a>00706       <a class="code" href="smux_8h.html#a849e1a9c24025af6be77cd10ec1fb798">oid2in_addr</a> (offset, len, &amp;paddr);
<a name="l00707"></a>00707     }
<a name="l00708"></a>00708       <span class="keywordflow">else</span>
<a name="l00709"></a>00709     paddr.s_addr = 0;
<a name="l00710"></a>00710 
<a name="l00711"></a>00711       <span class="keywordflow">if</span> (! rn)
<a name="l00712"></a>00712     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00713"></a>00713 
<a name="l00714"></a>00714       <span class="keywordflow">do</span>
<a name="l00715"></a>00715     {
<a name="l00716"></a>00716       min = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00717"></a>00717 
<a name="l00718"></a>00718       <span class="keywordflow">for</span> (binfo = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; binfo; binfo = binfo-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
<a name="l00719"></a>00719         {
<a name="l00720"></a>00720           <span class="keywordflow">if</span> (binfo-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#ab793b0acdca7d325f32edc25503b83b9">su</a>.<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_family == AF_INET
<a name="l00721"></a>00721           &amp;&amp; ntohl (paddr.s_addr) 
<a name="l00722"></a>00722           &lt; ntohl (binfo-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#ab793b0acdca7d325f32edc25503b83b9">su</a>.<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr.s_addr))
<a name="l00723"></a>00723         {
<a name="l00724"></a>00724           <span class="keywordflow">if</span> (min)
<a name="l00725"></a>00725             {
<a name="l00726"></a>00726               <span class="keywordflow">if</span> (ntohl (binfo-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#ab793b0acdca7d325f32edc25503b83b9">su</a>.<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr.s_addr) 
<a name="l00727"></a>00727               &lt; ntohl (min-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#ab793b0acdca7d325f32edc25503b83b9">su</a>.<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr.s_addr))
<a name="l00728"></a>00728             min = binfo;
<a name="l00729"></a>00729             }
<a name="l00730"></a>00730           <span class="keywordflow">else</span>
<a name="l00731"></a>00731             min = binfo;
<a name="l00732"></a>00732         }
<a name="l00733"></a>00733         }
<a name="l00734"></a>00734 
<a name="l00735"></a>00735       <span class="keywordflow">if</span> (min)
<a name="l00736"></a>00736         {
<a name="l00737"></a>00737           *length = v-&gt;<a class="code" href="structvariable.html#a1f0065dda83058eaf89301e319ec4cf7">namelen</a> + BGP_PATHATTR_ENTRY_OFFSET;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739           offset = name + v-&gt;<a class="code" href="structvariable.html#a1f0065dda83058eaf89301e319ec4cf7">namelen</a>;
<a name="l00740"></a>00740           <a class="code" href="smux_8h.html#add26a84014415e99f576c71009174dc3">oid_copy_addr</a> (offset, &amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>.u.<a class="code" href="structprefix.html#ab37b8922554b41b7dc2417d8f37e7829">prefix4</a>, <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>);
<a name="l00741"></a>00741           offset += <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>;
<a name="l00742"></a>00742           *offset = rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>.<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>;
<a name="l00743"></a>00743           offset++;
<a name="l00744"></a>00744           <a class="code" href="smux_8h.html#add26a84014415e99f576c71009174dc3">oid_copy_addr</a> (offset, &amp;min-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#ab793b0acdca7d325f32edc25503b83b9">su</a>.<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr, 
<a name="l00745"></a>00745                  <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>);
<a name="l00746"></a>00746           addr-&gt;prefix = rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>.u.<a class="code" href="structprefix.html#ab37b8922554b41b7dc2417d8f37e7829">prefix4</a>;
<a name="l00747"></a>00747           addr-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> = rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>.<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>;
<a name="l00748"></a>00748 
<a name="l00749"></a>00749           <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
<a name="l00750"></a>00750 
<a name="l00751"></a>00751           <span class="keywordflow">return</span> <a class="code" href="bgp__aspath_8c.html#a2d017cd3beb218080a7988e2deed2a11">min</a>;
<a name="l00752"></a>00752         }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754       paddr.s_addr = 0;
<a name="l00755"></a>00755     }
<a name="l00756"></a>00756       <span class="keywordflow">while</span> ((rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rn)) != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00757"></a>00757     }
<a name="l00758"></a>00758   <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00759"></a>00759 }
<a name="l00760"></a>00760 
<a name="l00761"></a>00761 <span class="keyword">static</span> u_char *
<a name="l00762"></a>00762 bgp4PathAttrTable (<span class="keyword">struct</span> <a class="code" href="structvariable.html">variable</a> *v, oid name[], <span class="keywordtype">size_t</span> *length,
<a name="l00763"></a>00763            <span class="keywordtype">int</span> exact, <span class="keywordtype">size_t</span> *var_len, <a class="code" href="smux_8h.html#ace14719892f7615b0228ad97d4cc8040">WriteMethod</a> **write_method)
<a name="l00764"></a>00764 {
<a name="l00765"></a>00765   <span class="keyword">struct </span>bgp *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
<a name="l00766"></a>00766   <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *binfo;
<a name="l00767"></a>00767   <span class="keyword">struct </span><a class="code" href="structprefix__ipv4.html">prefix_ipv4</a> addr;
<a name="l00768"></a>00768   
<a name="l00769"></a>00769   bgp = <a class="code" href="bgpd_8c.html#ae19787bc29126d524ac261d00bacc13d">bgp_get_default</a> ();
<a name="l00770"></a>00770   <span class="keywordflow">if</span> (! bgp)
<a name="l00771"></a>00771     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00772"></a>00772 
<a name="l00773"></a>00773   memset (&amp;addr, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structprefix__ipv4.html">prefix_ipv4</a>));
<a name="l00774"></a>00774 
<a name="l00775"></a>00775   binfo = bgp4PathAttrLookup (v, name, length, bgp, &amp;addr, exact);
<a name="l00776"></a>00776   <span class="keywordflow">if</span> (! binfo)
<a name="l00777"></a>00777     <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00778"></a>00778 
<a name="l00779"></a>00779   <span class="keywordflow">switch</span> (v-&gt;<a class="code" href="structvariable.html#ade92e000ca0d35650cc43fc3e54e6350">magic</a>)
<a name="l00780"></a>00780     {
<a name="l00781"></a>00781     <span class="keywordflow">case</span> BGP4PATHATTRPEER:  <span class="comment">/* 1 */</span>
<a name="l00782"></a>00782       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a8745a86f37751629f4c280c33b06646c">SNMP_IPADDRESS</a> (binfo-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#ab793b0acdca7d325f32edc25503b83b9">su</a>.<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr);
<a name="l00783"></a>00783       <span class="keywordflow">break</span>;
<a name="l00784"></a>00784     <span class="keywordflow">case</span> BGP4PATHATTRIPADDRPREFIXLEN: <span class="comment">/* 2 */</span>
<a name="l00785"></a>00785       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (addr.<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a>);
<a name="l00786"></a>00786       <span class="keywordflow">break</span>;
<a name="l00787"></a>00787     <span class="keywordflow">case</span> BGP4PATHATTRIPADDRPREFIX: <span class="comment">/* 3 */</span>
<a name="l00788"></a>00788       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a8745a86f37751629f4c280c33b06646c">SNMP_IPADDRESS</a> (addr.prefix);
<a name="l00789"></a>00789       <span class="keywordflow">break</span>;
<a name="l00790"></a>00790     <span class="keywordflow">case</span> BGP4PATHATTRORIGIN:    <span class="comment">/* 4 */</span>
<a name="l00791"></a>00791       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (binfo-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a17e152c15e3bd7a54475086d762e76ec">origin</a>);
<a name="l00792"></a>00792       <span class="keywordflow">break</span>;
<a name="l00793"></a>00793     <span class="keywordflow">case</span> BGP4PATHATTRASPATHSEGMENT: <span class="comment">/* 5 */</span>
<a name="l00794"></a>00794       <span class="keywordflow">return</span> <a class="code" href="bgp__aspath_8c.html#a46008828118eb829c4f5b010175de9ab">aspath_snmp_pathseg</a> (binfo-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>, var_len);
<a name="l00795"></a>00795       <span class="keywordflow">break</span>;
<a name="l00796"></a>00796     <span class="keywordflow">case</span> BGP4PATHATTRNEXTHOP:   <span class="comment">/* 6 */</span>
<a name="l00797"></a>00797       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a8745a86f37751629f4c280c33b06646c">SNMP_IPADDRESS</a> (binfo-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>);
<a name="l00798"></a>00798       <span class="keywordflow">break</span>;
<a name="l00799"></a>00799     <span class="keywordflow">case</span> BGP4PATHATTRMULTIEXITDISC: <span class="comment">/* 7 */</span>
<a name="l00800"></a>00800       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (binfo-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a2dc4bc77a20816cd457a2040b05e316f">med</a>);
<a name="l00801"></a>00801       <span class="keywordflow">break</span>;
<a name="l00802"></a>00802     <span class="keywordflow">case</span> BGP4PATHATTRLOCALPREF: <span class="comment">/* 8 */</span>
<a name="l00803"></a>00803       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (binfo-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#aa7caa960ced4e67e8aec2b0ab3d9b0b0">local_pref</a>);
<a name="l00804"></a>00804       <span class="keywordflow">break</span>;
<a name="l00805"></a>00805     <span class="keywordflow">case</span> BGP4PATHATTRATOMICAGGREGATE: <span class="comment">/* 9 */</span>
<a name="l00806"></a>00806       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (1);
<a name="l00807"></a>00807       <span class="keywordflow">break</span>;
<a name="l00808"></a>00808     <span class="keywordflow">case</span> BGP4PATHATTRAGGREGATORAS: <span class="comment">/* 10 */</span>
<a name="l00809"></a>00809       <span class="keywordflow">if</span> (binfo-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>)
<a name="l00810"></a>00810         <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (binfo-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#af91c71fee1beb30ae9f0d878f508bfbc">aggregator_as</a>);
<a name="l00811"></a>00811       <span class="keywordflow">else</span>
<a name="l00812"></a>00812         <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (0);
<a name="l00813"></a>00813       <span class="keywordflow">break</span>;
<a name="l00814"></a>00814     <span class="keywordflow">case</span> BGP4PATHATTRAGGREGATORADDR: <span class="comment">/* 11 */</span>
<a name="l00815"></a>00815       <span class="keywordflow">if</span> (binfo-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>)
<a name="l00816"></a>00816         <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a8745a86f37751629f4c280c33b06646c">SNMP_IPADDRESS</a> (binfo-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#a14c33c8295683eff20b2964e4b321622">aggregator_addr</a>);
<a name="l00817"></a>00817       <span class="keywordflow">else</span>
<a name="l00818"></a>00818         <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (0);
<a name="l00819"></a>00819       <span class="keywordflow">break</span>;
<a name="l00820"></a>00820     <span class="keywordflow">case</span> BGP4PATHATTRCALCLOCALPREF: <span class="comment">/* 12 */</span>
<a name="l00821"></a>00821       <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (-1);
<a name="l00822"></a>00822       <span class="keywordflow">break</span>;
<a name="l00823"></a>00823     <span class="keywordflow">case</span> BGP4PATHATTRBEST:  <span class="comment">/* 13 */</span>
<a name="l00824"></a>00824 <span class="preprocessor">#define BGP4_PathAttrBest_false 1</span>
<a name="l00825"></a>00825 <span class="preprocessor"></span><span class="preprocessor">#define BGP4_PathAttrBest_true  2</span>
<a name="l00826"></a>00826 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (binfo-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a43b3eb776824e6b86970e3886120913e">BGP_INFO_SELECTED</a>))
<a name="l00827"></a>00827     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (BGP4_PathAttrBest_true);
<a name="l00828"></a>00828       <span class="keywordflow">else</span>
<a name="l00829"></a>00829     <span class="keywordflow">return</span> <a class="code" href="smux_8h.html#a70470f9a0f3e693ede2b6d10bf3f591c">SNMP_INTEGER</a> (BGP4_PathAttrBest_false);
<a name="l00830"></a>00830       <span class="keywordflow">break</span>;
<a name="l00831"></a>00831     <span class="keywordflow">case</span> BGP4PATHATTRUNKNOWN:   <span class="comment">/* 14 */</span>
<a name="l00832"></a>00832       *var_len = 0;
<a name="l00833"></a>00833       <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00834"></a>00834       <span class="keywordflow">break</span>;
<a name="l00835"></a>00835     }
<a name="l00836"></a>00836   <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839 <span class="comment">/* BGP Traps. */</span>
<a name="l00840"></a>00840 <span class="keyword">struct </span><a class="code" href="structtrap__object.html">trap_object</a> bgpTrapList[] =
<a name="l00841"></a>00841 {
<a name="l00842"></a>00842   {bgpPeerTable, 3, {3, 1, BGPPEERLASTERROR}},
<a name="l00843"></a>00843   {bgpPeerTable, 3, {3, 1, BGPPEERSTATE}}
<a name="l00844"></a>00844 };
<a name="l00845"></a>00845 
<a name="l00846"></a>00846 <span class="keywordtype">void</span>
<a name="l00847"></a>00847 <a class="code" href="bgp__snmp_8h.html#aa020a6fafed939a240aa15f7e36ec578">bgpTrapEstablished</a> (<span class="keyword">struct</span> peer *peer)
<a name="l00848"></a>00848 {
<a name="l00849"></a>00849   <span class="keywordtype">int</span> ret;
<a name="l00850"></a>00850   <span class="keyword">struct </span>in_addr addr;
<a name="l00851"></a>00851   oid index[<span class="keyword">sizeof</span> (oid) * <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>];
<a name="l00852"></a>00852 
<a name="l00853"></a>00853   ret = <a class="code" href="sockunion_8c.html#a4203367afaacee3fa5cc1626b2ef63c0">inet_aton</a> (peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, &amp;addr);
<a name="l00854"></a>00854   <span class="keywordflow">if</span> (ret == 0)
<a name="l00855"></a>00855     <span class="keywordflow">return</span>;
<a name="l00856"></a>00856 
<a name="l00857"></a>00857   <a class="code" href="smux_8h.html#add26a84014415e99f576c71009174dc3">oid_copy_addr</a> (index, &amp;addr, <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>);
<a name="l00858"></a>00858 
<a name="l00859"></a>00859   <a class="code" href="smux_8h.html#aaf0b9cc33d65afe3c172191a78c87985">smux_trap</a> (bgp_oid, <span class="keyword">sizeof</span> bgp_oid / <span class="keyword">sizeof</span> (oid),
<a name="l00860"></a>00860          index, <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>,
<a name="l00861"></a>00861          bgpTrapList, <span class="keyword">sizeof</span> bgpTrapList / <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structtrap__object.html">trap_object</a>),
<a name="l00862"></a>00862          <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#a035d6d47723fa53d2d2587dc2495c8ad">start_time</a> - <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> (), BGPESTABLISHED);
<a name="l00863"></a>00863 }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 <span class="keywordtype">void</span>
<a name="l00866"></a>00866 <a class="code" href="bgp__snmp_8h.html#ad57de0ca6043122ebee75e6a97d18733">bgpTrapBackwardTransition</a> (<span class="keyword">struct</span> peer *peer)
<a name="l00867"></a>00867 {
<a name="l00868"></a>00868   <span class="keywordtype">int</span> ret;
<a name="l00869"></a>00869   <span class="keyword">struct </span>in_addr addr;
<a name="l00870"></a>00870   oid index[<span class="keyword">sizeof</span> (oid) * <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>];
<a name="l00871"></a>00871 
<a name="l00872"></a>00872   ret = <a class="code" href="sockunion_8c.html#a4203367afaacee3fa5cc1626b2ef63c0">inet_aton</a> (peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, &amp;addr);
<a name="l00873"></a>00873   <span class="keywordflow">if</span> (ret == 0)
<a name="l00874"></a>00874     <span class="keywordflow">return</span>;
<a name="l00875"></a>00875 
<a name="l00876"></a>00876   <a class="code" href="smux_8h.html#add26a84014415e99f576c71009174dc3">oid_copy_addr</a> (index, &amp;addr, <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>);
<a name="l00877"></a>00877 
<a name="l00878"></a>00878   <a class="code" href="smux_8h.html#aaf0b9cc33d65afe3c172191a78c87985">smux_trap</a> (bgp_oid, <span class="keyword">sizeof</span> bgp_oid / <span class="keyword">sizeof</span> (oid),
<a name="l00879"></a>00879          index, <a class="code" href="smux_8h.html#a046c11781e182edbfc70aae1bba67876">IN_ADDR_SIZE</a>,
<a name="l00880"></a>00880          bgpTrapList, <span class="keyword">sizeof</span> bgpTrapList / <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structtrap__object.html">trap_object</a>),
<a name="l00881"></a>00881          <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#a035d6d47723fa53d2d2587dc2495c8ad">start_time</a> - <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> (), BGPBACKWARDTRANSITION);
<a name="l00882"></a>00882 }
<a name="l00883"></a>00883 
<a name="l00884"></a>00884 <span class="keywordtype">void</span>
<a name="l00885"></a>00885 <a class="code" href="bgp__snmp_8h.html#a2b0aa61b10ec69afde81e859ae5db196">bgp_snmp_init</a> (<span class="keywordtype">void</span>)
<a name="l00886"></a>00886 {
<a name="l00887"></a>00887   <a class="code" href="smux_8h.html#a430d09d1e58132210a142a580cb8e6a8">smux_init</a> (<a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ab61d7cb301c6e2ab39c31553e677e300">master</a>);
<a name="l00888"></a>00888   <a class="code" href="smux_8h.html#a41b4afdce9bd47a5d68ba0b0b966c8b0">REGISTER_MIB</a>(<span class="stringliteral">&quot;mibII/bgp&quot;</span>, bgp_variables, <a class="code" href="structvariable.html">variable</a>, bgp_oid);
<a name="l00889"></a>00889 }
<a name="l00890"></a>00890 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_SNMP */</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="bgp__snmp_8c.html">bgp_snmp.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:03 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
