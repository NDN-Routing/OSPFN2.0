<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: isisd/isis_lsp.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('isis__lsp_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">isisd/isis_lsp.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="zebra_8h_source.html">zebra.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="linklist_8h_source.html">linklist.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="thread_8h_source.html">thread.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vty_8h_source.html">vty.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stream_8h_source.html">stream.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="memory_8h_source.html">memory.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="prefix_8h_source.html">prefix.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="command_8h_source.html">command.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="hash_8h_source.html">hash.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="if_8h_source.html">if.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="checksum_8h_source.html">checksum.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="dict_8h_source.html">isisd/dict.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__constants_8h_source.html">isisd/isis_constants.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__common_8h_source.html">isisd/isis_common.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__circuit_8h_source.html">isisd/isis_circuit.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isisd_8h_source.html">isisd/isisd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__tlv_8h_source.html">isisd/isis_tlv.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__lsp_8h_source.html">isisd/isis_lsp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__pdu_8h_source.html">isisd/isis_pdu.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__dynhn_8h_source.html">isisd/isis_dynhn.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__misc_8h_source.html">isisd/isis_misc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__flags_8h_source.html">isisd/isis_flags.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__csm_8h_source.html">isisd/isis_csm.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__adjacency_8h_source.html">isisd/isis_adjacency.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__spf_8h_source.html">isisd/isis_spf.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for isis_lsp.c:</div>
<div class="dyncontent">
<div class="center"><img src="isis__lsp_8c__incl.png" border="0" usemap="#isisd_2isis__lsp_8c" alt=""/></div>
<map name="isisd_2isis__lsp_8c" id="isisd_2isis__lsp_8c">
<area shape="rect" id="node3" href="zebra_8h.html" title="zebra.h" alt="" coords="1050,80,1117,107"/><area shape="rect" id="node51" href="linklist_8h.html" title="linklist.h" alt="" coords="2845,155,2915,181"/><area shape="rect" id="node53" href="thread_8h.html" title="thread.h" alt="" coords="2390,229,2462,256"/><area shape="rect" id="node55" href="vty_8h.html" title="vty.h" alt="" coords="2359,155,2410,181"/><area shape="rect" id="node58" href="log_8h.html" title="log.h" alt="" coords="2259,229,2310,256"/><area shape="rect" id="node61" href="stream_8h.html" title="stream.h" alt="" coords="2541,80,2615,107"/><area shape="rect" id="node63" href="prefix_8h.html" title="prefix.h" alt="" coords="2581,155,2649,181"/><area shape="rect" id="node65" href="memory_8h.html" title="memory.h" alt="" coords="2690,80,2773,107"/><area shape="rect" id="node69" href="command_8h.html" title="command.h" alt="" coords="2373,80,2465,107"/><area shape="rect" id="node72" href="hash_8h.html" title="hash.h" alt="" coords="2847,80,2909,107"/><area shape="rect" id="node74" href="if_8h.html" title="if.h" alt="" coords="2933,80,2973,107"/><area shape="rect" id="node77" href="checksum_8h.html" title="checksum.h" alt="" coords="2997,80,3090,107"/><area shape="rect" id="node79" href="dict_8h.html" title="isisd/dict.h" alt="" coords="3115,80,3201,107"/><area shape="rect" id="node81" href="isis__constants_8h.html" title="isisd/isis_constants.h" alt="" coords="3225,80,3375,107"/><area shape="rect" id="node83" href="isis__common_8h.html" title="isisd/isis_common.h" alt="" coords="3400,80,3542,107"/><area shape="rect" id="node85" href="isis__circuit_8h.html" title="isisd/isis_circuit.h" alt="" coords="3567,80,3693,107"/><area shape="rect" id="node87" href="isisd_8h.html" title="isisd/isisd.h" alt="" coords="3717,80,3809,107"/><area shape="rect" id="node89" href="isis__tlv_8h.html" title="isisd/isis_tlv.h" alt="" coords="3834,80,3941,107"/><area shape="rect" id="node91" href="isis__lsp_8h.html" title="isisd/isis_lsp.h" alt="" coords="3965,80,4074,107"/><area shape="rect" id="node93" href="isis__pdu_8h.html" title="isisd/isis_pdu.h" alt="" coords="4098,80,4213,107"/><area shape="rect" id="node95" href="isis__dynhn_8h.html" title="isisd/isis_dynhn.h" alt="" coords="4237,80,4363,107"/><area shape="rect" id="node97" href="isis__misc_8h.html" title="isisd/isis_misc.h" alt="" coords="4388,80,4506,107"/><area shape="rect" id="node99" href="isis__flags_8h.html" title="isisd/isis_flags.h" alt="" coords="4531,80,4651,107"/><area shape="rect" id="node101" href="isis__csm_8h.html" title="isisd/isis_csm.h" alt="" coords="4676,80,4791,107"/><area shape="rect" id="node103" href="isis__adjacency_8h.html" title="isisd/isis_adjacency.h" alt="" coords="4816,80,4969,107"/><area shape="rect" id="node105" href="isis__spf_8h.html" title="isisd/isis_spf.h" alt="" coords="4993,80,5103,107"/></map>
</div>
</div>
<p><a href="isis__lsp_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a07b3bf435d48e2570bec69501de3148f">LSP_MEMORY_PREASSIGN</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#ad16a88039454fce8d98bf77f09064204">FRAG_THOLD</a>(S, <a class="el" href="md5_8c.html#a7e83ec4daea14d9c3040af4e0ac30792">T</a>)&#160;&#160;&#160;((STREAM_SIZE(S)*<a class="el" href="md5_8c.html#a7e83ec4daea14d9c3040af4e0ac30792">T</a>)/100)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#acf35e8db3f0edc24594ad5db4e35f4e6">FRAG_NEEDED</a>(S, <a class="el" href="md5_8c.html#a7e83ec4daea14d9c3040af4e0ac30792">T</a>, I)&#160;&#160;&#160;(STREAM_SIZE(S)-STREAM_REMAIN(S)+(I) &gt; FRAG_THOLD(S,<a class="el" href="md5_8c.html#a7e83ec4daea14d9c3040af4e0ac30792">T</a>))</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a04ba9b8f0efece8345a3f6e90be19da1">lsp_id_cmp</a> (u_char *id1, u_char *id2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdict__t.html">dict_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#af93f1d3b7e8764bd70960ee03596374b">lsp_db_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a3859237ab43b147f4520d060439ca002">lsp_search</a> (u_char *<a class="el" href="prefix_8h.html#a68c0ada54c6414ef00bca919465286ac">id</a>, <a class="el" href="structdict__t.html">dict_t</a> *lspdb)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#aa0d51cf5f190804be9b73b52db69ccd6">lsp_clear_data</a> (struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a8910aea25a4f0680a4b4945609aaf97b">lsp_destroy</a> (struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a9a8a9a67475d18e9a6f9f73bb73ec8cc">lsp_db_destroy</a> (<a class="el" href="structdict__t.html">dict_t</a> *lspdb)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a0ae83d454874a8fd54be13230268bee3">lsp_remove_frags</a> (struct <a class="el" href="structlist.html">list</a> *frags, <a class="el" href="structdict__t.html">dict_t</a> *lspdb)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#ac9198965904e0c9a57ade0011b114d3f">lsp_search_and_destroy</a> (u_char *<a class="el" href="prefix_8h.html#a68c0ada54c6414ef00bca919465286ac">id</a>, <a class="el" href="structdict__t.html">dict_t</a> *lspdb)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a299d8a18662f432a07979c177e2723f0">lsp_compare</a> (char *areatag, struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp, u_int32_t <a class="el" href="isis__tlv_8h.html#a4deeb76ae77c7e5dca81a8c3a07e8c23">seq_num</a>, u_int16_t <a class="el" href="structchecksum.html">checksum</a>, u_int16_t <a class="el" href="isis__tlv_8h.html#a67f02ba3d294cb872271dc4d82ad7965">rem_lifetime</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a95c7b93c607b9aba6b6697b136d9ad98">lsp_inc_seqnum</a> (struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp, u_int32_t <a class="el" href="isis__tlv_8h.html#a4deeb76ae77c7e5dca81a8c3a07e8c23">seq_num</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a4a6da8fd883c32c4986e4d75e9a6f4e4">lsp_seqnum_update</a> (struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#ae815308b33a56b78b9a65809bc344ac4">isis_lsp_authinfo_check</a> (struct <a class="el" href="structstream.html">stream</a> *<a class="el" href="structstream.html">stream</a>, struct <a class="el" href="structisis__area.html">isis_area</a> *area, int pdulen, struct <a class="el" href="structisis__passwd.html">isis_passwd</a> *passwd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a917a11f390e10660faa69faa510da442">lsp_update_data</a> (struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp, struct <a class="el" href="structstream.html">stream</a> *<a class="el" href="structstream.html">stream</a>, struct <a class="el" href="structisis__area.html">isis_area</a> *area)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#ad5c26e2f2f08b4a76183ca91ff454ff9">lsp_update</a> (struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp, struct <a class="el" href="structisis__link__state__hdr.html">isis_link_state_hdr</a> *lsp_hdr, struct <a class="el" href="structstream.html">stream</a> *<a class="el" href="structstream.html">stream</a>, struct <a class="el" href="structisis__area.html">isis_area</a> *area, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#af11fc334a37a7a089a4c5e2d44496110">lsp_new_from_stream_ptr</a> (struct <a class="el" href="structstream.html">stream</a> *<a class="el" href="structstream.html">stream</a>, u_int16_t <a class="el" href="isis__pdu_8h.html#a7f1310e3d90f89e9c60c543ffe337b3b">pdu_len</a>, struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp0, struct <a class="el" href="structisis__area.html">isis_area</a> *area)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#af43ff22a21554145c239b6c37556ce1a">lsp_new</a> (u_char *<a class="el" href="isis__tlv_8h.html#a2991a019d1da82fb5406bff5ab46dcf6">lsp_id</a>, u_int16_t <a class="el" href="isis__tlv_8h.html#a67f02ba3d294cb872271dc4d82ad7965">rem_lifetime</a>, u_int32_t <a class="el" href="isis__tlv_8h.html#a4deeb76ae77c7e5dca81a8c3a07e8c23">seq_num</a>, u_int8_t <a class="el" href="isis__pdu_8h.html#a83e5f4c3dca022e24977611cd0a028b6">lsp_bits</a>, u_int16_t <a class="el" href="structchecksum.html">checksum</a>, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a09d8f3bcc073c87f01c32b2f0994fb04">lsp_insert</a> (struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp, <a class="el" href="structdict__t.html">dict_t</a> *lspdb)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a66fb0f7dfcff76c23f14eaaf816b11f9">lsp_build_list_nonzero_ht</a> (u_char *start_id, u_char *stop_id, struct <a class="el" href="structlist.html">list</a> *<a class="el" href="structlist.html">list</a>, <a class="el" href="structdict__t.html">dict_t</a> *lspdb)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#ac59fd5f8a4d5e146a7d36dd6525e43ae">lsp_build_list</a> (u_char *start_id, u_char *stop_id, struct <a class="el" href="structlist.html">list</a> *<a class="el" href="structlist.html">list</a>, <a class="el" href="structdict__t.html">dict_t</a> *lspdb)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#ac59c6231af3791411278d2b5f3be2188">lsp_build_list_ssn</a> (struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, struct <a class="el" href="structlist.html">list</a> *<a class="el" href="structlist.html">list</a>, <a class="el" href="structdict__t.html">dict_t</a> *lspdb)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a6ae8e0acaadc3ea2b9cf07af727cef18">lsp_set_time</a> (struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a5838ff5c762c49738cc88e9887fcb9fa">lspid_print</a> (u_char *<a class="el" href="isis__tlv_8h.html#a2991a019d1da82fb5406bff5ab46dcf6">lsp_id</a>, u_char *trg, char dynhost, char frag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a586294319acffcce0555e5e33377b7f6">lsp_bits2string</a> (u_char *<a class="el" href="isis__pdu_8h.html#a83e5f4c3dca022e24977611cd0a028b6">lsp_bits</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a613e1f38d40f5feb02c859dd8933b5c5">lsp_print</a> (<a class="el" href="structdnode__t.html">dnode_t</a> *node, struct <a class="el" href="structvty.html">vty</a> *<a class="el" href="structvty.html">vty</a>, char dynhost)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a2a648621d46f28687f81bf572bd3e711">lsp_print_detail</a> (<a class="el" href="structdnode__t.html">dnode_t</a> *node, struct <a class="el" href="structvty.html">vty</a> *<a class="el" href="structvty.html">vty</a>, char dynhost)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a9a7fe85e348f02c16f09905ca70c6187">lsp_print_all</a> (struct <a class="el" href="structvty.html">vty</a> *<a class="el" href="structvty.html">vty</a>, <a class="el" href="structdict__t.html">dict_t</a> *lspdb, char detail, char dynhost)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a87fb50a6271da943f8910022759b915e">lsp_tlv_fit</a> (struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp, struct <a class="el" href="structlist.html">list</a> **from, struct <a class="el" href="structlist.html">list</a> **to, int tlvsize, int frag_thold, int tlv_build_func(struct <a class="el" href="structlist.html">list</a> *, struct <a class="el" href="structstream.html">stream</a> *))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#aab829620b2263604cc5c0233d5a5b099">lsp_next_frag</a> (u_char frag_num, struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp0, struct <a class="el" href="structisis__area.html">isis_area</a> *area, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a8e44fcf09744fc11e91c6af9bcd17c7c">lsp_build_nonpseudo</a> (struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp, struct <a class="el" href="structisis__area.html">isis_area</a> *area)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#ae63b4445cafde6ccff7526b6d4570735">lsp_generate_non_pseudo</a> (struct <a class="el" href="structisis__area.html">isis_area</a> *area, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a9088e620d5a41dd5a661feb5de44dc64">lsp_l1_generate</a> (struct <a class="el" href="structisis__area.html">isis_area</a> *area)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a9bb0ebbebc92d3307a4018ca3d24f85e">lsp_l2_generate</a> (struct <a class="el" href="structisis__area.html">isis_area</a> *area)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#abfcf29f408abe6994df4484a432a7b03">lsp_non_pseudo_regenerate</a> (struct <a class="el" href="structisis__area.html">isis_area</a> *area, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#adc8acfaac35e9082714fb0f5cb47b606">lsp_refresh_l1</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a73cd3b4cb76bb36a65016f3315dde31e">lsp_refresh_l2</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a99833cb66948d6aa881bca74ab942cc5">lsp_l1_regenerate</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a4efb80c98e8582dc7609ffb9bdd6e597">lsp_l2_regenerate</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a31456cf3ff9953708c1d0328a99bfacc">lsp_regenerate_schedule</a> (struct <a class="el" href="structisis__area.html">isis_area</a> *area)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a24dc6ec3f264c96f18a95ea1d6e5f1d2">lsp_build_pseudo</a> (struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *lsp, struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a122acef1e7b0bdf1e7f683c670525723">lsp_pseudo_regenerate</a> (struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a9813405a112948deee3cb3c0b6b9e91b">lsp_l1_refresh_pseudo</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#ad3a3875129a37eb5a3df3eaf3fcd49a1">lsp_l1_pseudo_generate</a> (struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a4dcda3f6c233b53554094b98811b3394">lsp_l2_refresh_pseudo</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a934808749ecec8173e1ba46880c80bd6">lsp_l2_pseudo_generate</a> (struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a8987f46b1c21556ff1281a72cce6636a">lsp_tick</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a326bd66d63f17cf92421e5df0d29fe32">lsp_purge_dr</a> (u_char *<a class="el" href="prefix_8h.html#a68c0ada54c6414ef00bca919465286ac">id</a>, struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a3b934844c90f614a6f5f4a2734a23e77">lsp_purge_non_exist</a> (struct <a class="el" href="structisis__link__state__hdr.html">isis_link_state_hdr</a> *lsp_hdr, struct <a class="el" href="structisis__area.html">isis_area</a> *area)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structisis.html">isis</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#aa8cfdc8f7777fd242bd2c45f3a48b950">isis</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structthread__master.html">thread_master</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct in_addr&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#a5ff73fe88ce576fe7fc3877984367add">router_id_zebra</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__lsp_8c.html#ad3fb467068fe650f05f2e15b29a6cdf3">lsp_bits_string</a> [200]</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="acf35e8db3f0edc24594ad5db4e35f4e6"></a><!-- doxytag: member="isis_lsp.c::FRAG_NEEDED" ref="acf35e8db3f0edc24594ad5db4e35f4e6" args="(S, T, I)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FRAG_NEEDED</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">S, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="md5_8c.html#a7e83ec4daea14d9c3040af4e0ac30792">T</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">I&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(STREAM_SIZE(S)-STREAM_REMAIN(S)+(I) &gt; FRAG_THOLD(S,<a class="el" href="md5_8c.html#a7e83ec4daea14d9c3040af4e0ac30792">T</a>))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00920">920</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad16a88039454fce8d98bf77f09064204"></a><!-- doxytag: member="isis_lsp.c::FRAG_THOLD" ref="ad16a88039454fce8d98bf77f09064204" args="(S, T)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FRAG_THOLD</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">S, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="md5_8c.html#a7e83ec4daea14d9c3040af4e0ac30792">T</a>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;((STREAM_SIZE(S)*<a class="el" href="md5_8c.html#a7e83ec4daea14d9c3040af4e0ac30792">T</a>)/100)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00916">916</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a07b3bf435d48e2570bec69501de3148f"></a><!-- doxytag: member="isis_lsp.c::LSP_MEMORY_PREASSIGN" ref="a07b3bf435d48e2570bec69501de3148f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LSP_MEMORY_PREASSIGN</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00057">57</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ae815308b33a56b78b9a65809bc344ac4"></a><!-- doxytag: member="isis_lsp.c::isis_lsp_authinfo_check" ref="ae815308b33a56b78b9a65809bc344ac4" args="(struct stream *stream, struct isis_area *area, int pdulen, struct isis_passwd *passwd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int isis_lsp_authinfo_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structstream.html">stream</a> *&#160;</td>
          <td class="paramname"><em>stream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__area.html">isis_area</a> *&#160;</td>
          <td class="paramname"><em>area</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pdulen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__passwd.html">isis_passwd</a> *&#160;</td>
          <td class="paramname"><em>passwd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00344">344</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  uint32_t expected = 0, found;
  <span class="keyword">struct </span><a class="code" href="structtlvs.html">tlvs</a> <a class="code" href="structtlvs.html">tlvs</a>;
  <span class="keywordtype">int</span> retval = 0;

  expected |= <a class="code" href="isis__tlv_8h.html#a493ed26a4a2decc55275bd699df9a4a8">TLVFLAG_AUTH_INFO</a>;
  retval = <a class="code" href="isis__tlv_8c.html#aad6fa3b6cc5e93707f75d8247f8787c8">parse_tlvs</a> (area-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, stream-&gt;<a class="code" href="structstream.html#aa204feef08c4dcb72bf774680da7a864">data</a> +
               <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a> + <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>,
               pdulen - <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a>
               - <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>, &amp;expected, &amp;found, &amp;<a class="code" href="structtlvs.html">tlvs</a>);
  <span class="keywordflow">if</span> (retval || !(found &amp; <a class="code" href="isis__tlv_8h.html#a493ed26a4a2decc55275bd699df9a4a8">TLVFLAG_AUTH_INFO</a>))
    <span class="keywordflow">return</span> 1;           <span class="comment">/* Auth fail (parsing failed or no auth-tlv) */</span>

  <span class="keywordflow">return</span> <a class="code" href="isis__pdu_8c.html#aefd5a8caa169a427e30d599b51ab52e9">authentication_check</a> (passwd, &amp;<a class="code" href="structtlvs.html">tlvs</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a586294319acffcce0555e5e33377b7f6"></a><!-- doxytag: member="isis_lsp.c::lsp_bits2string" ref="a586294319acffcce0555e5e33377b7f6" args="(u_char *lsp_bits)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* lsp_bits2string </td>
          <td>(</td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>lsp_bits</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00673">673</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">char</span> *pos = <a class="code" href="isis__lsp_8c.html#ad3fb467068fe650f05f2e15b29a6cdf3">lsp_bits_string</a>;

  <span class="keywordflow">if</span> (!*<a class="code" href="isis__pdu_8h.html#a83e5f4c3dca022e24977611cd0a028b6">lsp_bits</a>)
    <span class="keywordflow">return</span> <span class="stringliteral">&quot; none&quot;</span>;

  <span class="comment">/* we only focus on the default metric */</span>
  pos += sprintf (pos, <span class="stringliteral">&quot;%d/&quot;</span>,
          <a class="code" href="isis__constants_8h.html#acb0c822a1f2ac5ae6f8f126b9ff40c1a">ISIS_MASK_LSP_ATT_DEFAULT_BIT</a> (*<a class="code" href="isis__pdu_8h.html#a83e5f4c3dca022e24977611cd0a028b6">lsp_bits</a>) ? 1 : 0);

  pos += sprintf (pos, <span class="stringliteral">&quot;%d/&quot;</span>,
          <a class="code" href="isis__constants_8h.html#add4793b649af03283f05960b902635e7">ISIS_MASK_LSP_PARTITION_BIT</a> (*<a class="code" href="isis__pdu_8h.html#a83e5f4c3dca022e24977611cd0a028b6">lsp_bits</a>) ? 1 : 0);

  pos += sprintf (pos, <span class="stringliteral">&quot;%d&quot;</span>, <a class="code" href="isis__constants_8h.html#a639588aea28dd1c81a81576d97df28cb">ISIS_MASK_LSP_OL_BIT</a> (*<a class="code" href="isis__pdu_8h.html#a83e5f4c3dca022e24977611cd0a028b6">lsp_bits</a>) ? 1 : 0);

  *(pos) = <span class="charliteral">&#39;\0&#39;</span>;

  <span class="keywordflow">return</span> <a class="code" href="isis__lsp_8c.html#ad3fb467068fe650f05f2e15b29a6cdf3">lsp_bits_string</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac59fd5f8a4d5e146a7d36dd6525e43ae"></a><!-- doxytag: member="isis_lsp.c::lsp_build_list" ref="ac59fd5f8a4d5e146a7d36dd6525e43ae" args="(u_char *start_id, u_char *stop_id, struct list *list, dict_t *lspdb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsp_build_list </td>
          <td>(</td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>start_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>stop_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist.html">list</a> *&#160;</td>
          <td class="paramname"><em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdict__t.html">dict_t</a> *&#160;</td>
          <td class="paramname"><em>lspdb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00568">568</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="structdnode__t.html">dnode_t</a> *first, *last, *curr;

  first = <a class="code" href="dict_8c.html#aaee9b7ed8b80f9f2dfab916a22c173ee">dict_lower_bound</a> (lspdb, start_id);
  <span class="keywordflow">if</span> (!first)
    <span class="keywordflow">return</span>;

  last = <a class="code" href="dict_8c.html#a6d6f2d4cc66e3859fe47d39b82cfd7ee">dict_upper_bound</a> (lspdb, stop_id);

  curr = first;

  <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (list, first-&gt;<a class="code" href="structdnode__t.html#afe56267c05f044b14097c38595f4a1a4">dict_data</a>);

  <span class="keywordflow">while</span> (curr)
    {
      curr = <a class="code" href="dict_8c.html#a1f32888c49577ec2b2dc9d16922bf487">dict_next</a> (lspdb, curr);
      <span class="keywordflow">if</span> (curr)
    <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (list, curr-&gt;<a class="code" href="structdnode__t.html#afe56267c05f044b14097c38595f4a1a4">dict_data</a>);
      <span class="keywordflow">if</span> (curr == last)
    <span class="keywordflow">break</span>;
    }

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a66fb0f7dfcff76c23f14eaaf816b11f9"></a><!-- doxytag: member="isis_lsp.c::lsp_build_list_nonzero_ht" ref="a66fb0f7dfcff76c23f14eaaf816b11f9" args="(u_char *start_id, u_char *stop_id, struct list *list, dict_t *lspdb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsp_build_list_nonzero_ht </td>
          <td>(</td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>start_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>stop_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist.html">list</a> *&#160;</td>
          <td class="paramname"><em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdict__t.html">dict_t</a> *&#160;</td>
          <td class="paramname"><em>lspdb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00535">535</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="structdnode__t.html">dnode_t</a> *first, *last, *curr;

  first = <a class="code" href="dict_8c.html#aaee9b7ed8b80f9f2dfab916a22c173ee">dict_lower_bound</a> (lspdb, start_id);
  <span class="keywordflow">if</span> (!first)
    <span class="keywordflow">return</span>;

  last = <a class="code" href="dict_8c.html#a6d6f2d4cc66e3859fe47d39b82cfd7ee">dict_upper_bound</a> (lspdb, stop_id);

  curr = first;

  <span class="keywordflow">if</span> (((<span class="keyword">struct</span> <a class="code" href="structisis__lsp.html">isis_lsp</a> *) (curr-&gt;<a class="code" href="structdnode__t.html#afe56267c05f044b14097c38595f4a1a4">dict_data</a>))-&gt;lsp_header-&gt;rem_lifetime)
    <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (list, first-&gt;<a class="code" href="structdnode__t.html#afe56267c05f044b14097c38595f4a1a4">dict_data</a>);

  <span class="keywordflow">while</span> (curr)
    {
      curr = <a class="code" href="dict_8c.html#a1f32888c49577ec2b2dc9d16922bf487">dict_next</a> (lspdb, curr);
      <span class="keywordflow">if</span> (curr &amp;&amp;
      ((<span class="keyword">struct</span> <a class="code" href="structisis__lsp.html">isis_lsp</a> *) (curr-&gt;<a class="code" href="structdnode__t.html#afe56267c05f044b14097c38595f4a1a4">dict_data</a>))-&gt;lsp_header-&gt;rem_lifetime)
    <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (list, curr-&gt;<a class="code" href="structdnode__t.html#afe56267c05f044b14097c38595f4a1a4">dict_data</a>);
      <span class="keywordflow">if</span> (curr == last)
    <span class="keywordflow">break</span>;
    }

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac59c6231af3791411278d2b5f3be2188"></a><!-- doxytag: member="isis_lsp.c::lsp_build_list_ssn" ref="ac59c6231af3791411278d2b5f3be2188" args="(struct isis_circuit *circuit, struct list *list, dict_t *lspdb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsp_build_list_ssn </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist.html">list</a> *&#160;</td>
          <td class="paramname"><em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdict__t.html">dict_t</a> *&#160;</td>
          <td class="paramname"><em>lspdb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00599">599</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="structdnode__t.html">dnode_t</a> *dnode, *next;
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;

  dnode = <a class="code" href="dict_8c.html#a2b439ffb63f9b3089d0306ec3b26672f">dict_first</a> (lspdb);
  <span class="keywordflow">while</span> (dnode != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      next = <a class="code" href="dict_8c.html#a1f32888c49577ec2b2dc9d16922bf487">dict_next</a> (lspdb, dnode);
      lsp = <a class="code" href="dict_8h.html#a17fccc85aae3874de7152f103d5945bc">dnode_get</a> (dnode);
      <span class="keywordflow">if</span> (<a class="code" href="isis__flags_8h.html#a7d42f17e426ff47043c37733fc3c672d">ISIS_CHECK_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a03d0dd350cd760986f4907c5df08363a">SSNflags</a>, circuit))
    <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (list, lsp);
      dnode = next;
    }

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8e44fcf09744fc11e91c6af9bcd17c7c"></a><!-- doxytag: member="isis_lsp.c::lsp_build_nonpseudo" ref="a8e44fcf09744fc11e91c6af9bcd17c7c" args="(struct isis_lsp *lsp, struct isis_area *area)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lsp_build_nonpseudo </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__area.html">isis_area</a> *&#160;</td>
          <td class="paramname"><em>area</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01008">1008</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structis__neigh.html">is_neigh</a> *<a class="code" href="structis__neigh.html">is_neigh</a>;
  <span class="keyword">struct </span><a class="code" href="structte__is__neigh.html">te_is_neigh</a> *<a class="code" href="structte__is__neigh.html">te_is_neigh</a>;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *ipnode;
  <span class="keywordtype">int</span> level = lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>;
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;
  <span class="keyword">struct </span><a class="code" href="structprefix__ipv4.html">prefix_ipv4</a> *ipv4;
  <span class="keyword">struct </span><a class="code" href="structipv4__reachability.html">ipv4_reachability</a> *ipreach;
  <span class="keyword">struct </span><a class="code" href="structte__ipv4__reachability.html">te_ipv4_reachability</a> *te_ipreach;
  <span class="keyword">struct </span><a class="code" href="structisis__adjacency.html">isis_adjacency</a> *nei;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keyword">struct </span>prefix_ipv6 *ipv6, *ip6prefix;
  <span class="keyword">struct </span>ipv6_reachability *ip6reach;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  <span class="keyword">struct </span><a class="code" href="structtlvs.html">tlvs</a> tlv_data;
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp0 = lsp;
  <span class="keyword">struct </span><a class="code" href="structisis__passwd.html">isis_passwd</a> *<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>;
  <span class="keyword">struct </span>in_addr *routerid;

  <span class="comment">/*</span>
<span class="comment">   * First add the tlvs related to area</span>
<span class="comment">   */</span>

  <span class="comment">/* Area addresses */</span>
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a11d8deaa75c26e958cff5f74fee3ef10">area_addrs</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a11d8deaa75c26e958cff5f74fee3ef10">area_addrs</a> = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
  <a class="code" href="linklist_8c.html#a16998dd330cc465279ed29cefc25e82f">list_add_list</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a11d8deaa75c26e958cff5f74fee3ef10">area_addrs</a>, area-&gt;<a class="code" href="structisis__area.html#aca1436df894da89fb83d7924ef248397">area_addrs</a>);
  <span class="comment">/* Protocols Supported */</span>
  <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#a0b7b9b7b8a3eb903a0deb5c20791d761">ip_circuits</a> &gt; 0
#ifdef HAVE_IPV6
      || area-&gt;ipv6_circuits &gt; 0
#endif <span class="comment">/* HAVE_IPV6 */</span>
    )
    {
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a> = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structnlpids.html">nlpids</a>));
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>-&gt;<a class="code" href="structnlpids.html#a73f0f5f1e7aa64694d5802b91af6533b">count</a> = 0;
      <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#a0b7b9b7b8a3eb903a0deb5c20791d761">ip_circuits</a> &gt; 0)
    {
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>-&gt;<a class="code" href="structnlpids.html#a73f0f5f1e7aa64694d5802b91af6533b">count</a>++;
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>-&gt;<a class="code" href="structnlpids.html#a6dbd263750da21187880986a50fd5857">nlpids</a>[0] = <a class="code" href="isis__constants_8h.html#a9c1ffc4a81108d901cd8914d20cd4caf">NLPID_IP</a>;
    }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>      <span class="keywordflow">if</span> (area-&gt;ipv6_circuits &gt; 0)
    {
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>-&gt;<a class="code" href="structnlpids.html#a73f0f5f1e7aa64694d5802b91af6533b">count</a>++;
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>-&gt;<a class="code" href="structnlpids.html#a6dbd263750da21187880986a50fd5857">nlpids</a>[lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>-&gt;<a class="code" href="structnlpids.html#a73f0f5f1e7aa64694d5802b91af6533b">count</a> - 1] =
        <a class="code" href="isis__constants_8h.html#af33b1ac580353b4a2ec3b766d5f90464">NLPID_IPV6</a>;
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
    }
  <span class="comment">/* Dynamic Hostname */</span>
  <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#a633f0592cc19c913d3d18368a8f45cb7">dynhostname</a>)
    {
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac2b8abaebfab8d2a55242d83a87a3e70">hostname</a> = <a class="code" href="memory_8h.html#a6491adf46c1d769b529a8f2f7d75f2fe">XMALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>,
                    <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structhostname.html">hostname</a>));

      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac2b8abaebfab8d2a55242d83a87a3e70">hostname</a>-&gt;<a class="code" href="structhostname.html#a0a14b55c4a1b6d672adfaa81b95936f3">name</a>, <a class="code" href="isis__misc_8c.html#a5fc76e0c3f105d5a4ff9a9396e0fdbd7">unix_hostname</a> (),
          strlen (<a class="code" href="isis__misc_8c.html#a5fc76e0c3f105d5a4ff9a9396e0fdbd7">unix_hostname</a> ()));
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac2b8abaebfab8d2a55242d83a87a3e70">hostname</a>-&gt;<a class="code" href="structhostname.html#af410706acabde261182a41b3579b04b6">namelen</a> = strlen (<a class="code" href="isis__misc_8c.html#a5fc76e0c3f105d5a4ff9a9396e0fdbd7">unix_hostname</a> ());
    }

  <span class="comment">/*</span>
<span class="comment">   * Building the zero lsp</span>
<span class="comment">   */</span>

  <span class="comment">/* Reset stream endp. Stream is always there and on every LSP refresh only</span>
<span class="comment">   * TLV part of it is overwritten. So we must seek past header we will not</span>
<span class="comment">   * touch. */</span>
  <a class="code" href="stream_8c.html#aee8fd31485ebc2f0a556a6a5d5c2d1e6">stream_reset</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);
  <a class="code" href="stream_8c.html#aa8fdf46961b0a0aa3d014bb602712076">stream_forward_endp</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>, <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a> + <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>);

  <span class="comment">/*</span>
<span class="comment">   * Add the authentication info if its present</span>
<span class="comment">   */</span>
  (level == 1) ? (passwd = &amp;area-&gt;<a class="code" href="structisis__area.html#afb66934e4bd3bda094550517a94de442">area_passwd</a>) :
    (passwd = &amp;area-&gt;<a class="code" href="structisis__area.html#a60cd44a3a31b36dc808ad3fd9efc97a0">domain_passwd</a>);
  <span class="keywordflow">if</span> (passwd-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>)
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>, passwd, sizeof (<span class="keyword">struct</span> <a class="code" href="structisis__passwd.html">isis_passwd</a>));
      <a class="code" href="isis__tlv_8c.html#a02f053566530986751054dcf500af3a9">tlv_add_authinfo</a> (passwd-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>, passwd-&gt;<a class="code" href="structisis__passwd.html#a3981443a6501783995b003ab8fd82f48">len</a>, passwd-&gt;<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);
    }
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>)
    <a class="code" href="isis__tlv_8c.html#ab4ebf52852b3eeb88bc641ce88d2657b">tlv_add_nlpid</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac2b8abaebfab8d2a55242d83a87a3e70">hostname</a>)
    <a class="code" href="isis__tlv_8c.html#a4761f56f8d442a565861edbef484422e">tlv_add_dynamic_hostname</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac2b8abaebfab8d2a55242d83a87a3e70">hostname</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a11d8deaa75c26e958cff5f74fee3ef10">area_addrs</a> &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a11d8deaa75c26e958cff5f74fee3ef10">area_addrs</a>) &gt; 0)
    <a class="code" href="isis__tlv_8c.html#abd5c4be878c3cab41e46d107480f433e">tlv_add_area_addrs</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a11d8deaa75c26e958cff5f74fee3ef10">area_addrs</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);

  <span class="comment">/* IPv4 address and TE router ID TLVs. In case of the first one we don&#39;t</span>
<span class="comment">   * follow &quot;C&quot; vendor, but &quot;J&quot; vendor behavior - one IPv4 address is put into</span>
<span class="comment">   * LSP and this address is same as router id. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__vty_8c.html#a5ff73fe88ce576fe7fc3877984367add">router_id_zebra</a>.s_addr != 0)
    {
      <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae9ef317829a76d7a79d2789786a2ac1f">ipv4_addrs</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae9ef317829a76d7a79d2789786a2ac1f">ipv4_addrs</a> = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae9ef317829a76d7a79d2789786a2ac1f">ipv4_addrs</a>-&gt;<a class="code" href="structlist.html#ac4fd9a331fe65f4c0891aa35bf84a6f5">del</a> = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
    }

      routerid = <a class="code" href="memory_8h.html#a6491adf46c1d769b529a8f2f7d75f2fe">XMALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> in_addr));
      routerid-&gt;s_addr = <a class="code" href="bgp__vty_8c.html#a5ff73fe88ce576fe7fc3877984367add">router_id_zebra</a>.s_addr;
      <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae9ef317829a76d7a79d2789786a2ac1f">ipv4_addrs</a>, routerid);
      <a class="code" href="isis__tlv_8c.html#adb351a1e5db6328c218f0a96389c06f4">tlv_add_in_addr</a> (routerid, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>, <a class="code" href="isis__tlv_8h.html#a2f6e5548aaebfb3733d79efa8afbb3ae">IPV4_ADDR</a>);

      <span class="comment">/* Exactly same data is put into TE router ID TLV, but only if new style</span>
<span class="comment">       * TLV&#39;s are in use. */</span>
      <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#af81e14ff1b34169c5e05c287d7ff5529">newmetric</a>)
    {
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a84e7120ac1718546fc9bb3f80470ca69">router_id</a> = <a class="code" href="memory_8h.html#a6491adf46c1d769b529a8f2f7d75f2fe">XMALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>,
                         <span class="keyword">sizeof</span> (<span class="keyword">struct</span> in_addr));
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a84e7120ac1718546fc9bb3f80470ca69">router_id</a>-&gt;<a class="code" href="structte__router__id.html#a859c4ce8787ff3914c4c7863ad187740">id</a>.s_addr = <a class="code" href="bgp__vty_8c.html#a5ff73fe88ce576fe7fc3877984367add">router_id_zebra</a>.s_addr;
      <a class="code" href="isis__tlv_8c.html#adb351a1e5db6328c218f0a96389c06f4">tlv_add_in_addr</a> (&amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a84e7120ac1718546fc9bb3f80470ca69">router_id</a>-&gt;<a class="code" href="structte__router__id.html#a859c4ce8787ff3914c4c7863ad187740">id</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>, <a class="code" href="isis__tlv_8h.html#af99fcaadfdb967a6de40bb5b3c0a315a">TE_ROUTER_ID</a>);
    }
    }

  memset (&amp;tlv_data, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structtlvs.html">tlvs</a>));

<span class="preprocessor">#ifdef TOPOLOGY_GENERATE</span>
<span class="preprocessor"></span>  <span class="comment">/* If topology exists (and we create topology for level 1 only), create</span>
<span class="comment">   * (hardcoded) link to topology. */</span>
  <span class="keywordflow">if</span> (area-&gt;topology &amp;&amp; level == 1)
    {
      <span class="keywordflow">if</span> (tlv_data.is_neighs == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      tlv_data.is_neighs = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
      tlv_data.is_neighs-&gt;del = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
    }
      is_neigh = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> is_neigh));

      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;is_neigh-&gt;<a class="code" href="structis__neigh.html#a133612c7ce92a57c785bbc2cbe1d0ec7">neigh_id</a>, area-&gt;topology_baseis, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
      is_neigh-&gt;<a class="code" href="structis__neigh.html#a133612c7ce92a57c785bbc2cbe1d0ec7">neigh_id</a>[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> - 1] = (1 &amp; 0xFF);
      is_neigh-&gt;<a class="code" href="structis__neigh.html#a133612c7ce92a57c785bbc2cbe1d0ec7">neigh_id</a>[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> - 2] = ((1 &gt;&gt; 8) &amp; 0xFF);
      is_neigh-&gt;<a class="code" href="structis__neigh.html#a89a2c799e58b8ab95549581a06f2a53a">metrics</a>.<a class="code" href="structmetric.html#ae927ddb546511096f632820b678d73bf">metric_default</a> = 0x01;
      is_neigh-&gt;<a class="code" href="structis__neigh.html#a89a2c799e58b8ab95549581a06f2a53a">metrics</a>.<a class="code" href="structmetric.html#aa373451a3966142956168440f174d1c5">metric_delay</a> = <a class="code" href="isis__constants_8h.html#a8e4a0ce9ffbaa12adf610ab7d67653c5">METRICS_UNSUPPORTED</a>;
      is_neigh-&gt;<a class="code" href="structis__neigh.html#a89a2c799e58b8ab95549581a06f2a53a">metrics</a>.<a class="code" href="structmetric.html#ad32785c7cdf67ab7a3f5c5da004a7e9c">metric_expense</a> = <a class="code" href="isis__constants_8h.html#a8e4a0ce9ffbaa12adf610ab7d67653c5">METRICS_UNSUPPORTED</a>;
      is_neigh-&gt;<a class="code" href="structis__neigh.html#a89a2c799e58b8ab95549581a06f2a53a">metrics</a>.<a class="code" href="structmetric.html#a315704ab59d2e6c334f2e2b6b4901e18">metric_error</a> = <a class="code" href="isis__constants_8h.html#a8e4a0ce9ffbaa12adf610ab7d67653c5">METRICS_UNSUPPORTED</a>;
      <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (tlv_data.is_neighs, is_neigh);
    }
<span class="preprocessor">#endif </span><span class="comment">/* TOPOLOGY_GENERATE */</span>

  <span class="comment">/*</span>
<span class="comment">   * Then build lists of tlvs related to circuits</span>
<span class="comment">   */</span>
  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (area-&gt;<a class="code" href="structisis__area.html#a1ef8753b22245b7d8fff0331deef3b21">circuit_list</a>, node, circuit))
    {
      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a7491f48eafb46ce87d7041bd7959633b">state</a> != <a class="code" href="isis__csm_8h.html#a65d367a002446ae64678b4586f5e2cc5">C_STATE_UP</a>)
    <span class="keywordflow">continue</span>;

      <span class="comment">/*</span>
<span class="comment">       * Add IPv4 internal reachability of this circuit</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a9dbb2266ee5b76604a27fd0855e910f5">ip_router</a> &amp;&amp; circuit-&gt;<a class="code" href="structisis__circuit.html#adcde796f44a1e725abe092f95a6cb075">ip_addrs</a> &amp;&amp;
      circuit-&gt;<a class="code" href="structisis__circuit.html#adcde796f44a1e725abe092f95a6cb075">ip_addrs</a>-&gt;<a class="code" href="structlist.html#ac9c4d4d7c65e726bd9ee0c8884b6349b">count</a> &gt; 0)
    {
      <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#ab59df347846030a9825a908f8fa1a4ae">oldmetric</a>)
        {
          <span class="keywordflow">if</span> (tlv_data.ipv4_int_reachs == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
        {
          tlv_data.ipv4_int_reachs = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
          tlv_data.ipv4_int_reachs-&gt;del = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
        }
          <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#adcde796f44a1e725abe092f95a6cb075">ip_addrs</a>, ipnode, ipv4))
        {
          ipreach =
            <a class="code" href="memory_8h.html#a6491adf46c1d769b529a8f2f7d75f2fe">XMALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structipv4__reachability.html">ipv4_reachability</a>));
          ipreach-&gt;<a class="code" href="structipv4__reachability.html#a9fb77b6ac90d3fc4f7bfbd7f4843543a">metrics</a> = circuit-&gt;<a class="code" href="structisis__circuit.html#a33545b43653e59a814cbd283c3f8c056">metrics</a>[level - 1];
          <a class="code" href="prefix_8c.html#ac618f277d6ed0ebc56781ec26e508157">masklen2ip</a> (ipv4-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a>, &amp;ipreach-&gt;<a class="code" href="structipv4__reachability.html#a229b4c7635d0a94d260c0929125399ee">mask</a>);
          ipreach-&gt;<a class="code" href="structipv4__reachability.html#a7ae516558fddb6aca89c864bd2d23d30">prefix</a>.s_addr = ((ipreach-&gt;<a class="code" href="structipv4__reachability.html#a229b4c7635d0a94d260c0929125399ee">mask</a>.s_addr) &amp;
                        (ipv4-&gt;prefix.s_addr));
          <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (tlv_data.ipv4_int_reachs, ipreach);
        }
          tlv_data.ipv4_int_reachs-&gt;del = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
        }
      <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#af81e14ff1b34169c5e05c287d7ff5529">newmetric</a>)
        {
          <span class="keywordflow">if</span> (tlv_data.te_ipv4_reachs == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
        {
          tlv_data.te_ipv4_reachs = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
          tlv_data.te_ipv4_reachs-&gt;del = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
        }
          <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#adcde796f44a1e725abe092f95a6cb075">ip_addrs</a>, ipnode, ipv4))
        {
          <span class="comment">/* FIXME All this assumes that we have no sub TLVs. */</span>
          te_ipreach = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>,
                    <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structte__ipv4__reachability.html">te_ipv4_reachability</a>) +
                    ((ipv4-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> + 7)/8) - 1);

          <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#ab59df347846030a9825a908f8fa1a4ae">oldmetric</a>)
            te_ipreach-&gt;<a class="code" href="structte__ipv4__reachability.html#a9704689f0bbfff1997a158427765060e">te_metric</a> = htonl (circuit-&gt;<a class="code" href="structisis__circuit.html#a33545b43653e59a814cbd283c3f8c056">metrics</a>[level - 1].<a class="code" href="structmetric.html#ae927ddb546511096f632820b678d73bf">metric_default</a>);
          <span class="keywordflow">else</span>
            te_ipreach-&gt;<a class="code" href="structte__ipv4__reachability.html#a9704689f0bbfff1997a158427765060e">te_metric</a> = htonl (circuit-&gt;<a class="code" href="structisis__circuit.html#abf3f18b710cf84b23e7005c08e6594b2">te_metric</a>[level - 1]);

          te_ipreach-&gt;<a class="code" href="structte__ipv4__reachability.html#ab886131ddaf522d8bc34610687a79309">control</a> = (ipv4-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> &amp; 0x3F);
          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;te_ipreach-&gt;<a class="code" href="structte__ipv4__reachability.html#ad50dc67e9a53223f8083d85cbb727bfa">prefix_start</a>, &amp;ipv4-&gt;prefix.s_addr,
              (ipv4-&gt;<a class="code" href="structprefix__ipv4.html#ab96da4bf1eb37195bd564bcf1126a16a">prefixlen</a> + 7)/8);
          <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (tlv_data.te_ipv4_reachs, te_ipreach);
        }
        }
    }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>      <span class="comment">/*</span>
<span class="comment">       * Add IPv6 reachability of this circuit</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (circuit-&gt;ipv6_router &amp;&amp; circuit-&gt;ipv6_non_link &amp;&amp;
      circuit-&gt;ipv6_non_link-&gt;count &gt; 0)
    {

      <span class="keywordflow">if</span> (tlv_data.ipv6_reachs == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
        {
          tlv_data.ipv6_reachs = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
          tlv_data.ipv6_reachs-&gt;del = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
        }
          <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (circuit-&gt;ipv6_non_link, ipnode, ipv6))
        {
          ip6reach =
        <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> ipv6_reachability));

          <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#ab59df347846030a9825a908f8fa1a4ae">oldmetric</a>)
        ip6reach-&gt;metric =
              htonl (circuit-&gt;<a class="code" href="structisis__circuit.html#a33545b43653e59a814cbd283c3f8c056">metrics</a>[level - 1].<a class="code" href="structmetric.html#ae927ddb546511096f632820b678d73bf">metric_default</a>);
          <span class="keywordflow">else</span>
          ip6reach-&gt;metric = htonl (circuit-&gt;<a class="code" href="structisis__circuit.html#abf3f18b710cf84b23e7005c08e6594b2">te_metric</a>[level - 1]);

          ip6reach-&gt;control_info = 0;
          ip6reach-&gt;prefix_len = ipv6-&gt;prefixlen;
          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;ip6prefix, &amp;ipv6, <span class="keyword">sizeof</span>(ip6prefix));
          apply_mask_ipv6 (ip6prefix);
          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (ip6reach-&gt;prefix, ip6prefix-&gt;prefix.s6_addr,
              sizeof (ip6reach-&gt;prefix));
          <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (tlv_data.ipv6_reachs, ip6reach);
        }
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

      <span class="keywordflow">switch</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a>)
    {
    <span class="keywordflow">case</span> <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>:
      <span class="keywordflow">if</span> (level &amp; circuit-&gt;<a class="code" href="structisis__circuit.html#ab222d6d0b054faa159d72bcb9768b3fb">circuit_is_type</a>)
        {
          <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#ab59df347846030a9825a908f8fa1a4ae">oldmetric</a>)
        {
          <span class="keywordflow">if</span> (tlv_data.is_neighs == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
            {
              tlv_data.is_neighs = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
              tlv_data.is_neighs-&gt;del = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
            }
          is_neigh = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> is_neigh));
          <span class="keywordflow">if</span> (level == 1)
            <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (is_neigh-&gt;<a class="code" href="structis__neigh.html#a133612c7ce92a57c785bbc2cbe1d0ec7">neigh_id</a>,
                circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a015b72bf5854d99b722f9f599b9eb158">l1_desig_is</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);
          <span class="keywordflow">else</span>
            <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (is_neigh-&gt;<a class="code" href="structis__neigh.html#a133612c7ce92a57c785bbc2cbe1d0ec7">neigh_id</a>,
                circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a2bde5462284eb2b294ed998fb5907de8">l2_desig_is</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);
          is_neigh-&gt;<a class="code" href="structis__neigh.html#a89a2c799e58b8ab95549581a06f2a53a">metrics</a> = circuit-&gt;<a class="code" href="structisis__circuit.html#a33545b43653e59a814cbd283c3f8c056">metrics</a>[level - 1];
          <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (tlv_data.is_neighs, is_neigh);
          tlv_data.is_neighs-&gt;del = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
        }
          <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#af81e14ff1b34169c5e05c287d7ff5529">newmetric</a>)
        {
          uint32_t <a class="code" href="structmetric.html">metric</a>;

          <span class="keywordflow">if</span> (tlv_data.te_is_neighs == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
            {
              tlv_data.te_is_neighs = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
              tlv_data.te_is_neighs-&gt;del = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
            }
          te_is_neigh = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>,
                     <span class="keyword">sizeof</span> (<span class="keyword">struct</span> te_is_neigh));
          <span class="keywordflow">if</span> (level == 1)
            <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (te_is_neigh-&gt;<a class="code" href="structte__is__neigh.html#aeac52df557a764c20753943d4f475203">neigh_id</a>,
                circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a015b72bf5854d99b722f9f599b9eb158">l1_desig_is</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);
          <span class="keywordflow">else</span>
            <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (te_is_neigh-&gt;<a class="code" href="structte__is__neigh.html#aeac52df557a764c20753943d4f475203">neigh_id</a>,
                circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a2bde5462284eb2b294ed998fb5907de8">l2_desig_is</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);
          <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#ab59df347846030a9825a908f8fa1a4ae">oldmetric</a>)
            metric =
              ((htonl(circuit-&gt;<a class="code" href="structisis__circuit.html#a33545b43653e59a814cbd283c3f8c056">metrics</a>[level - 1].<a class="code" href="structmetric.html#ae927ddb546511096f632820b678d73bf">metric_default</a>) &gt;&gt; 8)
                  &amp; 0xffffff);
          <span class="keywordflow">else</span>
            metric = ((htonl(*circuit-&gt;<a class="code" href="structisis__circuit.html#abf3f18b710cf84b23e7005c08e6594b2">te_metric</a>) &gt;&gt; 8) &amp; 0xffffff);

          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (te_is_neigh-&gt;<a class="code" href="structte__is__neigh.html#a7158aa6efe17579d240123affa0a543c">te_metric</a>, &amp;metric, 3);
          <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (tlv_data.te_is_neighs, te_is_neigh);
        }
        }
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__circuit_8h.html#aa2113a49e7c75a5d4997d59df0530726">CIRCUIT_T_P2P</a>:
      nei = circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a15852a59ea8be80680abac2070659440">p2p</a>.<a class="code" href="structisis__p2p__info.html#a17d32289e6648b9855b93482cd7c45a5">neighbor</a>;
      <span class="keywordflow">if</span> (nei &amp;&amp; (level &amp; nei-&gt;<a class="code" href="structisis__adjacency.html#a94749cb53088c1898166a701f2a3931f">circuit_t</a>))
        {
          <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#ab59df347846030a9825a908f8fa1a4ae">oldmetric</a>)
        {
          <span class="keywordflow">if</span> (tlv_data.is_neighs == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
            {
              tlv_data.is_neighs = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
              tlv_data.is_neighs-&gt;del = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
            }
          is_neigh = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> is_neigh));
          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (is_neigh-&gt;<a class="code" href="structis__neigh.html#a133612c7ce92a57c785bbc2cbe1d0ec7">neigh_id</a>, nei-&gt;<a class="code" href="structisis__adjacency.html#a7b23942ae5652d5cf59b263f131c2038">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
          is_neigh-&gt;<a class="code" href="structis__neigh.html#a89a2c799e58b8ab95549581a06f2a53a">metrics</a> = circuit-&gt;<a class="code" href="structisis__circuit.html#a33545b43653e59a814cbd283c3f8c056">metrics</a>[level - 1];
          <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (tlv_data.is_neighs, is_neigh);
        }
          <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#af81e14ff1b34169c5e05c287d7ff5529">newmetric</a>)
        {
          uint32_t metric;

          <span class="keywordflow">if</span> (tlv_data.te_is_neighs == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
            {
              tlv_data.te_is_neighs = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
              tlv_data.te_is_neighs-&gt;del = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
            }
          te_is_neigh = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>,
                     <span class="keyword">sizeof</span> (<span class="keyword">struct</span> te_is_neigh));
          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (te_is_neigh-&gt;<a class="code" href="structte__is__neigh.html#aeac52df557a764c20753943d4f475203">neigh_id</a>, nei-&gt;<a class="code" href="structisis__adjacency.html#a7b23942ae5652d5cf59b263f131c2038">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
          metric = ((htonl(*circuit-&gt;<a class="code" href="structisis__circuit.html#abf3f18b710cf84b23e7005c08e6594b2">te_metric</a>) &gt;&gt; 8) &amp; 0xffffff);
          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (te_is_neigh-&gt;<a class="code" href="structte__is__neigh.html#a7158aa6efe17579d240123affa0a543c">te_metric</a>, &amp;metric, 3);
          <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (tlv_data.te_is_neighs, te_is_neigh);
        }
        }
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__circuit_8h.html#ace4e6ef60402975cbbcd42d37f4e116f">CIRCUIT_T_STATIC_IN</a>:
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;lsp_area_create: unsupported circuit type&quot;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__circuit_8h.html#a58c459ed939ee8997c493d00aa241800">CIRCUIT_T_STATIC_OUT</a>:
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;lsp_area_create: unsupported circuit type&quot;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__circuit_8h.html#a26e88232ab88ae370f75feb62f92c2b0">CIRCUIT_T_DA</a>:
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;lsp_area_create: unsupported circuit type&quot;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;lsp_area_create: unknown circuit type&quot;</span>);
    }
    }

  <span class="keywordflow">while</span> (tlv_data.ipv4_int_reachs &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (tlv_data.ipv4_int_reachs))
    {
      <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a202838cf00b9aeb6f746c11c8a421642">ipv4_int_reachs</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a202838cf00b9aeb6f746c11c8a421642">ipv4_int_reachs</a> = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
      <a class="code" href="isis__lsp_8c.html#a87fb50a6271da943f8910022759b915e">lsp_tlv_fit</a> (lsp, &amp;tlv_data.ipv4_int_reachs,
           &amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a202838cf00b9aeb6f746c11c8a421642">ipv4_int_reachs</a>,
           <a class="code" href="isis__tlv_8h.html#a4f875375f022f9404581aa66fd4f6dcb">IPV4_REACH_LEN</a>, area-&gt;<a class="code" href="structisis__area.html#ae1bacf51d4843178d0a4219a49f93423">lsp_frag_threshold</a>,
           <a class="code" href="isis__tlv_8c.html#a0fec2a295690de62dd51295e8930e260">tlv_add_ipv4_reachs</a>);
      <span class="keywordflow">if</span> (tlv_data.ipv4_int_reachs &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (tlv_data.ipv4_int_reachs))
    lsp = <a class="code" href="isis__lsp_8c.html#aab829620b2263604cc5c0233d5a5b099">lsp_next_frag</a> (<a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>) + 1,
                 lsp0, area, level);
    }
  <span class="comment">/* FIXME: We pass maximum te_ipv4_reachability length to the lsp_tlv_fit()</span>
<span class="comment">   * for now. lsp_tlv_fit() needs to be fixed to deal with variable length</span>
<span class="comment">   * TLVs (sub TLVs!). */</span>
  <span class="keywordflow">while</span> (tlv_data.te_ipv4_reachs &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (tlv_data.te_ipv4_reachs))
    {
      <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac827f5db217d1de5cc2a58c9b5a9cf81">te_ipv4_reachs</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac827f5db217d1de5cc2a58c9b5a9cf81">te_ipv4_reachs</a> = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
      <a class="code" href="isis__lsp_8c.html#a87fb50a6271da943f8910022759b915e">lsp_tlv_fit</a> (lsp, &amp;tlv_data.te_ipv4_reachs,
           &amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac827f5db217d1de5cc2a58c9b5a9cf81">te_ipv4_reachs</a>,
           9, area-&gt;<a class="code" href="structisis__area.html#ae1bacf51d4843178d0a4219a49f93423">lsp_frag_threshold</a>, <a class="code" href="isis__tlv_8c.html#af61249352f501f09c0912f6849687406">tlv_add_te_ipv4_reachs</a>);
      <span class="keywordflow">if</span> (tlv_data.te_ipv4_reachs &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (tlv_data.te_ipv4_reachs))
    lsp = <a class="code" href="isis__lsp_8c.html#aab829620b2263604cc5c0233d5a5b099">lsp_next_frag</a> (<a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>) + 1,
                 lsp0, area, level);
    }

<span class="preprocessor">#ifdef  HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">while</span> (tlv_data.ipv6_reachs &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (tlv_data.ipv6_reachs))
    {
      <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.ipv6_reachs == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.ipv6_reachs = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
      <a class="code" href="isis__lsp_8c.html#a87fb50a6271da943f8910022759b915e">lsp_tlv_fit</a> (lsp, &amp;tlv_data.ipv6_reachs,
           &amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.ipv6_reachs,
           <a class="code" href="isis__tlv_8h.html#a27eee759b0b85d1f5e0c6e31361a7416">IPV6_REACH_LEN</a>, area-&gt;<a class="code" href="structisis__area.html#ae1bacf51d4843178d0a4219a49f93423">lsp_frag_threshold</a>,
           tlv_add_ipv6_reachs);
      <span class="keywordflow">if</span> (tlv_data.ipv6_reachs &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (tlv_data.ipv6_reachs))
    lsp = <a class="code" href="isis__lsp_8c.html#aab829620b2263604cc5c0233d5a5b099">lsp_next_frag</a> (<a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>) + 1,
                 lsp0, area, level);
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

  <span class="keywordflow">while</span> (tlv_data.is_neighs &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (tlv_data.is_neighs))
    {
      <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a> = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
      <a class="code" href="isis__lsp_8c.html#a87fb50a6271da943f8910022759b915e">lsp_tlv_fit</a> (lsp, &amp;tlv_data.is_neighs,
           &amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a>,
           <a class="code" href="isis__tlv_8h.html#ae1c932e01a4b166be4461bd19a4ca5c4">IS_NEIGHBOURS_LEN</a>, area-&gt;<a class="code" href="structisis__area.html#ae1bacf51d4843178d0a4219a49f93423">lsp_frag_threshold</a>,
           <a class="code" href="isis__tlv_8c.html#aff9156f858532767e00e9f80f79cbb52">tlv_add_is_neighs</a>);
      <span class="keywordflow">if</span> (tlv_data.is_neighs &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (tlv_data.is_neighs))
    lsp = <a class="code" href="isis__lsp_8c.html#aab829620b2263604cc5c0233d5a5b099">lsp_next_frag</a> (<a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>) + 1,
                 lsp0, area, level);
    }

  <span class="keywordflow">while</span> (tlv_data.te_is_neighs &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (tlv_data.te_is_neighs))
    {
      <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a> = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
      <a class="code" href="isis__lsp_8c.html#a87fb50a6271da943f8910022759b915e">lsp_tlv_fit</a> (lsp, &amp;tlv_data.te_is_neighs, &amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a>,
           <a class="code" href="isis__tlv_8h.html#ae1c932e01a4b166be4461bd19a4ca5c4">IS_NEIGHBOURS_LEN</a>, area-&gt;<a class="code" href="structisis__area.html#ae1bacf51d4843178d0a4219a49f93423">lsp_frag_threshold</a>,
           <a class="code" href="isis__tlv_8c.html#aeca253d796ceaff696f3c570bab0aec5">tlv_add_te_is_neighs</a>);
      <span class="keywordflow">if</span> (tlv_data.te_is_neighs &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (tlv_data.te_is_neighs))
    lsp = <a class="code" href="isis__lsp_8c.html#aab829620b2263604cc5c0233d5a5b099">lsp_next_frag</a> (<a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>) + 1,
                 lsp0, area, level);
    }

  <a class="code" href="isis__tlv_8c.html#a5f499235cf5a69697d280f5a1cd01612">free_tlvs</a> (&amp;tlv_data);
  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a24dc6ec3f264c96f18a95ea1d6e5f1d2"></a><!-- doxytag: member="isis_lsp.c::lsp_build_pseudo" ref="a24dc6ec3f264c96f18a95ea1d6e5f1d2" args="(struct isis_lsp *lsp, struct isis_circuit *circuit, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lsp_build_pseudo </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01685">1685</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__adjacency.html">isis_adjacency</a> *adj;
  <span class="keyword">struct </span><a class="code" href="structis__neigh.html">is_neigh</a> *<a class="code" href="structis__neigh.html">is_neigh</a>;
  <span class="keyword">struct </span><a class="code" href="structte__is__neigh.html">te_is_neigh</a> *<a class="code" href="structte__is__neigh.html">te_is_neigh</a>;
  <span class="keyword">struct </span><a class="code" href="structes__neigh.html">es_neigh</a> *<a class="code" href="structes__neigh.html">es_neigh</a>;
  <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *adj_list;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node;
  <span class="keyword">struct </span><a class="code" href="structisis__passwd.html">isis_passwd</a> *<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>;

  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a569e39bbf7fafd533eae2eeafa671b8c">circ_type</a> == <a class="code" href="isis__circuit_8h.html#a01a94c5f24c88efb64f791a749ae8f95">CIRCUIT_T_BROADCAST</a>);

  <span class="keywordflow">if</span> (!circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#adb24376d01beb41cab0ed0c49c3a214c">is_dr</a>[level - 1])
    <span class="keywordflow">return</span>;         <span class="comment">/* we are not DIS on this circuit */</span>

  lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> = level;
  <span class="keywordflow">if</span> (level == 1)
    lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a405c4b662dc97846dcca65f5c851f485">lsp_bits</a> |= <a class="code" href="isis__constants_8h.html#a4806dbcd4c094ef55cecd6aca29520d7">IS_LEVEL_1</a>;
  <span class="keywordflow">else</span>
    lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a405c4b662dc97846dcca65f5c851f485">lsp_bits</a> |= <a class="code" href="isis__constants_8h.html#a9daa7fbf09b604c718f3bbe189aedd1a">IS_LEVEL_2</a>;

  <span class="comment">/*</span>
<span class="comment">   * add self to IS neighbours </span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#ab59df347846030a9825a908f8fa1a4ae">oldmetric</a>)
    {
      <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a> = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a>-&gt;<a class="code" href="structlist.html#ac4fd9a331fe65f4c0891aa35bf84a6f5">del</a> = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
    }
      is_neigh = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> is_neigh));

      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;is_neigh-&gt;<a class="code" href="structis__neigh.html#a133612c7ce92a57c785bbc2cbe1d0ec7">neigh_id</a>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
      <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a>, is_neigh);
    }
  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#af81e14ff1b34169c5e05c287d7ff5529">newmetric</a>)
    {
      <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a> = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
      lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a>-&gt;<a class="code" href="structlist.html#ac4fd9a331fe65f4c0891aa35bf84a6f5">del</a> = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
    }
      te_is_neigh = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> te_is_neigh));

      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;te_is_neigh-&gt;<a class="code" href="structte__is__neigh.html#aeac52df557a764c20753943d4f475203">neigh_id</a>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
      <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a>, te_is_neigh);
    }

  adj_list = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
  <a class="code" href="isis__adjacency_8c.html#abcdb7608e2eb77b6e5f5bcc273c7c265">isis_adj_build_up_list</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ada9bf2584373a37aed06b2e4c9e796f9">adjdb</a>[level - 1], adj_list);

  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (adj_list, node, adj))
    {
      <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a94749cb53088c1898166a701f2a3931f">circuit_t</a> &amp; level)
    {
      <span class="keywordflow">if</span> ((level == 1 &amp;&amp; adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> == <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4daddebdf6ea1f78c8503dd520854310078">ISIS_SYSTYPE_L1_IS</a>) ||
          (level == 1 &amp;&amp; adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> == <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4da615d7aa9f3d08cd8360e1b04a0b8806b">ISIS_SYSTYPE_L2_IS</a> &amp;&amp;
          adj-&gt;<a class="code" href="structisis__adjacency.html#a3cb53910a1050483efa04d144bd57ffc">adj_usage</a> == <a class="code" href="isis__adjacency_8h.html#abbe0dae7a957cc6c9f9ae6a33739b434aae5d5e9d6b2655fbe76c0eaa011f9c58">ISIS_ADJ_LEVEL1AND2</a>) ||
          (level == 2 &amp;&amp; adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> == <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4da615d7aa9f3d08cd8360e1b04a0b8806b">ISIS_SYSTYPE_L2_IS</a>))
        {
          <span class="comment">/* an IS neighbour -&gt; add it */</span>
          <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#ab59df347846030a9825a908f8fa1a4ae">oldmetric</a>)
        {
          is_neigh = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> is_neigh));

          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;is_neigh-&gt;<a class="code" href="structis__neigh.html#a133612c7ce92a57c785bbc2cbe1d0ec7">neigh_id</a>, adj-&gt;<a class="code" href="structisis__adjacency.html#a7b23942ae5652d5cf59b263f131c2038">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
          <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a>, is_neigh);
        }
          <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#af81e14ff1b34169c5e05c287d7ff5529">newmetric</a>)
        {
          te_is_neigh = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>,
                     <span class="keyword">sizeof</span> (<span class="keyword">struct</span> te_is_neigh));
          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;te_is_neigh-&gt;<a class="code" href="structte__is__neigh.html#aeac52df557a764c20753943d4f475203">neigh_id</a>, adj-&gt;<a class="code" href="structisis__adjacency.html#a7b23942ae5652d5cf59b263f131c2038">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
          <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a>, te_is_neigh);
        }
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (level == 1 &amp;&amp; adj-&gt;<a class="code" href="structisis__adjacency.html#a187eb9cdad6881ecd2735b38a47e07e3">sys_type</a> == <a class="code" href="isis__adjacency_8h.html#ad310c3cfba255c6c6dda415939268b4da0b5dc35b6ff6333177392a069af08ce1">ISIS_SYSTYPE_ES</a>)
        {
          <span class="comment">/* an ES neigbour add it, if we are building level 1 LSP */</span>
          <span class="comment">/* FIXME: the tlv-format is hard to use here */</span>
          <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#acda3e4d69df4661e1d81a1df2d03a7dd">es_neighs</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
        {
          lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#acda3e4d69df4661e1d81a1df2d03a7dd">es_neighs</a> = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
          lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#acda3e4d69df4661e1d81a1df2d03a7dd">es_neighs</a>-&gt;<a class="code" href="structlist.html#ac4fd9a331fe65f4c0891aa35bf84a6f5">del</a> = <a class="code" href="isis__tlv_8c.html#accd0682e015f53c9040ca9a68fb1a963">free_tlv</a>;
        }
          es_neigh = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> es_neigh));
          
          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;es_neigh-&gt;<a class="code" href="structes__neigh.html#a0f09f7880bc288b9931a8c453cc8d8e3">first_es_neigh</a>, adj-&gt;<a class="code" href="structisis__adjacency.html#a7b23942ae5652d5cf59b263f131c2038">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
          <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#acda3e4d69df4661e1d81a1df2d03a7dd">es_neighs</a>, es_neigh);
        }
    }
    }

  <span class="comment">/* Reset endp of stream to overwrite only TLV part of it. */</span>
  <a class="code" href="stream_8c.html#aee8fd31485ebc2f0a556a6a5d5c2d1e6">stream_reset</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);
  <a class="code" href="stream_8c.html#aa8fdf46961b0a0aa3d014bb602712076">stream_forward_endp</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>, <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a> + <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>);

  <span class="comment">/*</span>
<span class="comment">   * Add the authentication info if it&#39;s present</span>
<span class="comment">   */</span>
  (level == 1) ? (passwd = &amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#afb66934e4bd3bda094550517a94de442">area_passwd</a>) :
    (passwd = &amp;circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a60cd44a3a31b36dc808ad3fd9efc97a0">domain_passwd</a>);
  <span class="keywordflow">if</span> (passwd-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>)
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>, passwd, sizeof (<span class="keyword">struct</span> <a class="code" href="structisis__passwd.html">isis_passwd</a>));
      <a class="code" href="isis__tlv_8c.html#a02f053566530986751054dcf500af3a9">tlv_add_authinfo</a> (passwd-&gt;<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>, passwd-&gt;<a class="code" href="structisis__passwd.html#a3981443a6501783995b003ab8fd82f48">len</a>, passwd-&gt;<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);
    }

  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a> &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a>) &gt; 0)
    <a class="code" href="isis__tlv_8c.html#aff9156f858532767e00e9f80f79cbb52">tlv_add_is_neighs</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);

  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a> &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a>) &gt; 0)
    <a class="code" href="isis__tlv_8c.html#aeca253d796ceaff696f3c570bab0aec5">tlv_add_te_is_neighs</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);

  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#acda3e4d69df4661e1d81a1df2d03a7dd">es_neighs</a> &amp;&amp; <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#acda3e4d69df4661e1d81a1df2d03a7dd">es_neighs</a>) &gt; 0)
    <a class="code" href="isis__tlv_8c.html#aff9156f858532767e00e9f80f79cbb52">tlv_add_is_neighs</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#acda3e4d69df4661e1d81a1df2d03a7dd">es_neighs</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);

  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a> = htons (<a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>));
  <a class="code" href="checksum_8c.html#a097fa5404eb654e8e112bb954bf4ef15">fletcher_checksum</a> (<a class="code" href="stream_8h.html#afde5f5db208a43da6faf7b830f26d7fc">STREAM_DATA</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>) + 12,
           ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a>) - 12, 12);

  <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (adj_list);

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa0d51cf5f190804be9b73b52db69ccd6"></a><!-- doxytag: member="isis_lsp.c::lsp_clear_data" ref="aa0d51cf5f190804be9b73b52db69ccd6" args="(struct isis_lsp *lsp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lsp_clear_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00107">107</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (!lsp)
    <span class="keywordflow">return</span>;

  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a92fb19d67740e3bfde012e19af97b7d3">own_lsp</a>)
    {
      <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>)
    <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>);
      <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac2b8abaebfab8d2a55242d83a87a3e70">hostname</a>)
    <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba03ac060807144cc28b2c4f4d100b2fb2">MTYPE_ISIS_TLV</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac2b8abaebfab8d2a55242d83a87a3e70">hostname</a>);
    }
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a>)
    <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a>);
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a>)
    <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a>);
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a11d8deaa75c26e958cff5f74fee3ef10">area_addrs</a>)
    <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a11d8deaa75c26e958cff5f74fee3ef10">area_addrs</a>);
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#acda3e4d69df4661e1d81a1df2d03a7dd">es_neighs</a>)
    <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#acda3e4d69df4661e1d81a1df2d03a7dd">es_neighs</a>);
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae9ef317829a76d7a79d2789786a2ac1f">ipv4_addrs</a>)
    <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae9ef317829a76d7a79d2789786a2ac1f">ipv4_addrs</a>);
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a202838cf00b9aeb6f746c11c8a421642">ipv4_int_reachs</a>)
    <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a202838cf00b9aeb6f746c11c8a421642">ipv4_int_reachs</a>);
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a24de94a53f11ec8f24e9f133ba2f63c3">ipv4_ext_reachs</a>)
    <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a24de94a53f11ec8f24e9f133ba2f63c3">ipv4_ext_reachs</a>);
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac827f5db217d1de5cc2a58c9b5a9cf81">te_ipv4_reachs</a>)
    <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac827f5db217d1de5cc2a58c9b5a9cf81">te_ipv4_reachs</a>);
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.ipv6_addrs)
    <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.ipv6_addrs);
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.ipv6_reachs)
    <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.ipv6_reachs);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

  memset (&amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>, 0, sizeof (<span class="keyword">struct</span> <a class="code" href="structtlvs.html">tlvs</a>));

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a299d8a18662f432a07979c177e2723f0"></a><!-- doxytag: member="isis_lsp.c::lsp_compare" ref="a299d8a18662f432a07979c177e2723f0" args="(char *areatag, struct isis_lsp *lsp, u_int32_t seq_num, u_int16_t checksum, u_int16_t rem_lifetime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsp_compare </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>areatag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int32_t&#160;</td>
          <td class="paramname"><em>seq_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int16_t&#160;</td>
          <td class="paramname"><em>checksum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int16_t&#160;</td>
          <td class="paramname"><em>rem_lifetime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00245">245</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">/* no point in double ntohl on seqnum */</span>
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a> == <a class="code" href="isis__pdu_8h.html#a4deeb76ae77c7e5dca81a8c3a07e8c23">seq_num</a> &amp;&amp;
      lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a> == <a class="code" href="structchecksum.html">checksum</a> &amp;&amp;
      <span class="comment">/*comparing with 0, no need to do ntohl */</span>
      ((lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a> == 0 &amp;&amp; <a class="code" href="isis__pdu_8h.html#a67f02ba3d294cb872271dc4d82ad7965">rem_lifetime</a> == 0) ||
       (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a> != 0 &amp;&amp; <a class="code" href="isis__pdu_8h.html#a67f02ba3d294cb872271dc4d82ad7965">rem_lifetime</a> != 0)))
    {
      <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#ab16b82eb25717295303c7099035d9dc9">DEBUG_SNP_PACKETS</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s): LSP %s seq 0x%08x, cksum 0x%04x,&quot;</span>
              <span class="stringliteral">&quot; lifetime %us&quot;</span>,
              areatag,
              <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
              ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>),
              ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>),
              ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>));
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s):         is equal to ours seq 0x%08x,&quot;</span>
              <span class="stringliteral">&quot; cksum 0x%04x, lifetime %us&quot;</span>,
              areatag,
              ntohl (<a class="code" href="isis__pdu_8h.html#a4deeb76ae77c7e5dca81a8c3a07e8c23">seq_num</a>), ntohs (<a class="code" href="structchecksum.html">checksum</a>), ntohs (<a class="code" href="isis__pdu_8h.html#a67f02ba3d294cb872271dc4d82ad7965">rem_lifetime</a>));
    }
      <span class="keywordflow">return</span> <a class="code" href="isis__lsp_8h.html#a99cb1e872b18fd541d954846ec30aa7f">LSP_EQUAL</a>;
    }

  <span class="keywordflow">if</span> (ntohl (<a class="code" href="isis__pdu_8h.html#a4deeb76ae77c7e5dca81a8c3a07e8c23">seq_num</a>) &gt;= ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#ab16b82eb25717295303c7099035d9dc9">DEBUG_SNP_PACKETS</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s): LSP %s seq 0x%08x, cksum 0x%04x,&quot;</span>
              <span class="stringliteral">&quot; lifetime %us&quot;</span>,
              areatag,
              <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
              ntohl (<a class="code" href="isis__pdu_8h.html#a4deeb76ae77c7e5dca81a8c3a07e8c23">seq_num</a>), ntohs (<a class="code" href="structchecksum.html">checksum</a>), ntohs (<a class="code" href="isis__pdu_8h.html#a67f02ba3d294cb872271dc4d82ad7965">rem_lifetime</a>));
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s):       is newer than ours seq 0x%08x, &quot;</span>
              <span class="stringliteral">&quot;cksum 0x%04x, lifetime %us&quot;</span>,
              areatag,
              ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>),
              ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>),
              ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>));
    }
      <span class="keywordflow">return</span> <a class="code" href="isis__lsp_8h.html#a2b334f17cd54fd535379deac75b7e8f0">LSP_NEWER</a>;
    }
  <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#ab16b82eb25717295303c7099035d9dc9">DEBUG_SNP_PACKETS</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a>
    (<span class="stringliteral">&quot;ISIS-Snp (%s): LSP %s seq 0x%08x, cksum 0x%04x, lifetime %us&quot;</span>,
     areatag, <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>), ntohl (<a class="code" href="isis__pdu_8h.html#a4deeb76ae77c7e5dca81a8c3a07e8c23">seq_num</a>),
     ntohs (<a class="code" href="structchecksum.html">checksum</a>), ntohs (<a class="code" href="isis__pdu_8h.html#a67f02ba3d294cb872271dc4d82ad7965">rem_lifetime</a>));
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Snp (%s):       is older than ours seq 0x%08x,&quot;</span>
          <span class="stringliteral">&quot; cksum 0x%04x, lifetime %us&quot;</span>, areatag,
          ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>),
          ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>),
          ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>));
    }

  <span class="keywordflow">return</span> <a class="code" href="isis__lsp_8h.html#a3902417a88de806e8b32c2a5930eb9bc">LSP_OLDER</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9a8a9a67475d18e9a6f9f73bb73ec8cc"></a><!-- doxytag: member="isis_lsp.c::lsp_db_destroy" ref="a9a8a9a67475d18e9a6f9f73bb73ec8cc" args="(dict_t *lspdb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsp_db_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdict__t.html">dict_t</a> *&#160;</td>
          <td class="paramname"><em>lspdb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00166">166</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="structdnode__t.html">dnode_t</a> *dnode, *next;
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;

  dnode = <a class="code" href="dict_8c.html#a2b439ffb63f9b3089d0306ec3b26672f">dict_first</a> (lspdb);
  <span class="keywordflow">while</span> (dnode)
    {
      next = <a class="code" href="dict_8c.html#a1f32888c49577ec2b2dc9d16922bf487">dict_next</a> (lspdb, dnode);
      lsp = <a class="code" href="dict_8h.html#a17fccc85aae3874de7152f103d5945bc">dnode_get</a> (dnode);
      <a class="code" href="isis__lsp_8c.html#a8910aea25a4f0680a4b4945609aaf97b">lsp_destroy</a> (lsp);
      <a class="code" href="dict_8c.html#ad820577e4fba81f761665f16356823ab">dict_delete_free</a> (lspdb, dnode);
      dnode = next;
    }

  <a class="code" href="dict_8c.html#ab1d4e786dee93b4dc601d2f339ff81fd">dict_free</a> (lspdb);

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af93f1d3b7e8764bd70960ee03596374b"></a><!-- doxytag: member="isis_lsp.c::lsp_db_init" ref="af93f1d3b7e8764bd70960ee03596374b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdict__t.html">dict_t</a>* lsp_db_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00073">73</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="structdict__t.html">dict_t</a> *dict;

  dict = <a class="code" href="dict_8c.html#a1a1783c8987d21d1d1078f80cb614679">dict_create</a> (<a class="code" href="dict_8h.html#a7cc0c7f4164b72cfc0c8e543d6fd3951">DICTCOUNT_T_MAX</a>, (<a class="code" href="dict_8h.html#a92a0ce54764499eee8e3584a7b8795d9">dict_comp_t</a>) <a class="code" href="isis__lsp_8c.html#a04ba9b8f0efece8345a3f6e90be19da1">lsp_id_cmp</a>);

  <span class="keywordflow">return</span> dict;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8910aea25a4f0680a4b4945609aaf97b"></a><!-- doxytag: member="isis_lsp.c::lsp_destroy" ref="a8910aea25a4f0680a4b4945609aaf97b" args="(struct isis_lsp *lsp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lsp_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00148">148</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (!lsp)
    <span class="keywordflow">return</span>;

  <a class="code" href="isis__lsp_8c.html#aa0d51cf5f190804be9b73b52db69ccd6">lsp_clear_data</a> (lsp);

  <span class="keywordflow">if</span> (<a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>) == 0 &amp;&amp; lsp-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#acca312187c5812b70485d18fdc60b986">frags</a>)
    {
      <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#acca312187c5812b70485d18fdc60b986">frags</a>);
    }

  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>)
    <a class="code" href="stream_8c.html#ac25ca0f9b32a76b4ea34ecb3c9d62481">stream_free</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);
  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167baa9874bec1ebdd728cf6272ccea1c930c">MTYPE_ISIS_LSP</a>, lsp);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae63b4445cafde6ccff7526b6d4570735"></a><!-- doxytag: member="isis_lsp.c::lsp_generate_non_pseudo" ref="ae63b4445cafde6ccff7526b6d4570735" args="(struct isis_area *area, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lsp_generate_non_pseudo </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__area.html">isis_area</a> *&#160;</td>
          <td class="paramname"><em>area</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01418">1418</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *oldlsp, *newlsp;
  u_int32_t <a class="code" href="isis__pdu_8h.html#a4deeb76ae77c7e5dca81a8c3a07e8c23">seq_num</a> = 0;
  u_char <a class="code" href="isis__misc_8c.html#ac0016d3200b8885e05d151ca16ef4315">lspid</a>[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2];

  memset (&amp;lspid, 0, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2);
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;lspid, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);

  <span class="comment">/* only builds the lsp if the area shares the level */</span>
  <span class="keywordflow">if</span> ((area-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a> &amp; <a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>) == <a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>)
    {
      oldlsp = <a class="code" href="isis__lsp_8c.html#a3859237ab43b147f4520d060439ca002">lsp_search</a> (lspid, area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1]);
      <span class="keywordflow">if</span> (oldlsp)
    {
      seq_num = ntohl (oldlsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>);
      <a class="code" href="isis__lsp_8c.html#ac9198965904e0c9a57ade0011b114d3f">lsp_search_and_destroy</a> (oldlsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>,
                  area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1]);
      <span class="comment">/* FIXME: we should actually initiate a purge */</span>
    }
      newlsp = <a class="code" href="isis__lsp_8c.html#af43ff22a21554145c239b6c37556ce1a">lsp_new</a> (lspid, area-&gt;<a class="code" href="structisis__area.html#af0e5e6cfa7b7536e0700dd3645025d9b">max_lsp_lifetime</a>[<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1], seq_num,
            area-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a>, 0, <a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>);
      newlsp-&gt;<a class="code" href="structisis__lsp.html#a92fb19d67740e3bfde012e19af97b7d3">own_lsp</a> = 1;

      <a class="code" href="isis__lsp_8c.html#a09d8f3bcc073c87f01c32b2f0994fb04">lsp_insert</a> (newlsp, area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1]);
      <span class="comment">/* build_lsp_data (newlsp, area); */</span>
      <a class="code" href="isis__lsp_8c.html#a8e44fcf09744fc11e91c6af9bcd17c7c">lsp_build_nonpseudo</a> (newlsp, area);
      <span class="comment">/* time to calculate our checksum */</span>
      <a class="code" href="isis__lsp_8c.html#a4a6da8fd883c32c4986e4d75e9a6f4e4">lsp_seqnum_update</a> (newlsp);
    }

  <span class="comment">/* DEBUG_ADJ_PACKETS */</span>
  <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#a4113d6aad857cfa148450dfc6ed85b5b">DEBUG_ADJ_PACKETS</a>)
    {
      <span class="comment">/* FIXME: is this place right? fix missing info */</span>
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Upd (%s): Building L%d LSP&quot;</span>, area-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, <a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>);
    }

  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a04ba9b8f0efece8345a3f6e90be19da1"></a><!-- doxytag: member="isis_lsp.c::lsp_id_cmp" ref="a04ba9b8f0efece8345a3f6e90be19da1" args="(u_char *id1, u_char *id2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsp_id_cmp </td>
          <td>(</td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>id1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>id2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00067">67</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> <a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (id1, id2, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a95c7b93c607b9aba6b6697b136d9ad98"></a><!-- doxytag: member="isis_lsp.c::lsp_inc_seqnum" ref="a95c7b93c607b9aba6b6697b136d9ad98" args="(struct isis_lsp *lsp, u_int32_t seq_num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsp_inc_seqnum </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int32_t&#160;</td>
          <td class="paramname"><em>seq_num</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00307">307</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  u_int32_t newseq;

  <span class="keywordflow">if</span> (<a class="code" href="isis__pdu_8h.html#a4deeb76ae77c7e5dca81a8c3a07e8c23">seq_num</a> == 0 || ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>) &gt; <a class="code" href="isis__pdu_8h.html#a4deeb76ae77c7e5dca81a8c3a07e8c23">seq_num</a>)
    newseq = ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>) + 1;
  <span class="keywordflow">else</span>
    newseq = <a class="code" href="isis__pdu_8h.html#a4deeb76ae77c7e5dca81a8c3a07e8c23">seq_num</a>++;

  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a> = htonl (newseq);
  <a class="code" href="checksum_8c.html#a097fa5404eb654e8e112bb954bf4ef15">fletcher_checksum</a> (<a class="code" href="stream_8h.html#afde5f5db208a43da6faf7b830f26d7fc">STREAM_DATA</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>) + 12,
           ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a>) - 12, 12);

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a09d8f3bcc073c87f01c32b2f0994fb04"></a><!-- doxytag: member="isis_lsp.c::lsp_insert" ref="a09d8f3bcc073c87f01c32b2f0994fb04" args="(struct isis_lsp *lsp, dict_t *lspdb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsp_insert </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdict__t.html">dict_t</a> *&#160;</td>
          <td class="paramname"><em>lspdb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00526">526</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="dict_8c.html#a914a77195b15984573e3dac49f38e5f2">dict_alloc_insert</a> (lspdb, lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>, lsp);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9088e620d5a41dd5a661feb5de44dc64"></a><!-- doxytag: member="isis_lsp.c::lsp_l1_generate" ref="a9088e620d5a41dd5a661feb5de44dc64" args="(struct isis_area *area)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsp_l1_generate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__area.html">isis_area</a> *&#160;</td>
          <td class="paramname"><em>area</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01463">1463</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, area-&gt;<a class="code" href="structisis__area.html#aa13bb9e9d007a177991fad0bbaf5b8c0">t_lsp_refresh</a>[0], <a class="code" href="isis__lsp_8c.html#adc8acfaac35e9082714fb0f5cb47b606">lsp_refresh_l1</a>, area,
           <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a>);

  <span class="keywordflow">return</span> <a class="code" href="isis__lsp_8c.html#ae63b4445cafde6ccff7526b6d4570735">lsp_generate_non_pseudo</a> (area, 1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad3a3875129a37eb5a3df3eaf3fcd49a1"></a><!-- doxytag: member="isis_lsp.c::lsp_l1_pseudo_generate" ref="ad3a3875129a37eb5a3df3eaf3fcd49a1" args="(struct isis_circuit *circuit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsp_l1_pseudo_generate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01883">1883</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;
  u_char <span class="keywordtype">id</span>[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2];
  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ref_time;

  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (<span class="keywordtype">id</span>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
  <a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (<span class="keywordtype">id</span>) = 0;
  <a class="code" href="isis__lsp_8h.html#a15ad7ce72dee875930a28bec035f7b71">LSP_PSEUDO_ID</a> (<span class="keywordtype">id</span>) = circuit-&gt;<a class="code" href="structisis__circuit.html#a10453f6bcc1e8f1cb466240a81836ba9">circuit_id</a>;

  <span class="comment">/*</span>
<span class="comment">   * If for some reason have a pseudo LSP in the db already -&gt; regenerate</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (<a class="code" href="isis__lsp_8c.html#a3859237ab43b147f4520d060439ca002">lsp_search</a> (<span class="keywordtype">id</span>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[0]))
    <span class="keywordflow">return</span> <a class="code" href="isis__lsp_8c.html#a122acef1e7b0bdf1e7f683c670525723">lsp_pseudo_regenerate</a> (circuit, 1);
  lsp = <a class="code" href="isis__lsp_8c.html#af43ff22a21554145c239b6c37556ce1a">lsp_new</a> (<span class="keywordtype">id</span>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#af0e5e6cfa7b7536e0700dd3645025d9b">max_lsp_lifetime</a>[0],
         1, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a>, 0, 1);

  <a class="code" href="isis__lsp_8c.html#a24dc6ec3f264c96f18a95ea1d6e5f1d2">lsp_build_pseudo</a> (lsp, circuit, 1);

  lsp-&gt;<a class="code" href="structisis__lsp.html#a92fb19d67740e3bfde012e19af97b7d3">own_lsp</a> = 1;
  <a class="code" href="isis__lsp_8c.html#a09d8f3bcc073c87f01c32b2f0994fb04">lsp_insert</a> (lsp, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[0]);
  <a class="code" href="isis__flags_8h.html#a57f45d9b4a8c70c53f796d96e5555fac">ISIS_FLAGS_SET_ALL</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>);

  ref_time = circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a060404363e73aea836fd9ac4738e129a">lsp_refresh</a>[0] &gt; <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a> ?
    <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a> : circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a060404363e73aea836fd9ac4738e129a">lsp_refresh</a>[0];

  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#afbf6ada19d1fda134ede0986124680ac">t_refresh_pseudo_lsp</a>[0],
           <a class="code" href="isis__lsp_8c.html#a9813405a112948deee3cb3c0b6b9e91b">lsp_l1_refresh_pseudo</a>, circuit,
           <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (ref_time, <a class="code" href="isis__constants_8h.html#adfaaf0b4e69adf9ae9c8dc47e3e00918">MAX_AGE_JITTER</a>));

  <span class="keywordflow">return</span> <a class="code" href="isis__lsp_8c.html#a31456cf3ff9953708c1d0328a99bfacc">lsp_regenerate_schedule</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9813405a112948deee3cb3c0b6b9e91b"></a><!-- doxytag: member="isis_lsp.c::lsp_l1_refresh_pseudo" ref="a9813405a112948deee3cb3c0b6b9e91b" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsp_l1_refresh_pseudo </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01857">1857</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;
  <span class="keywordtype">int</span> retval;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ref_time;

  circuit = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);

  <span class="keywordflow">if</span> (!circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#adb24376d01beb41cab0ed0c49c3a214c">is_dr</a>[0])
    <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;      <span class="comment">/* FIXME: purge and such */</span>

  circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#afbf6ada19d1fda134ede0986124680ac">t_refresh_pseudo_lsp</a>[0] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  retval = <a class="code" href="isis__lsp_8c.html#a122acef1e7b0bdf1e7f683c670525723">lsp_pseudo_regenerate</a> (circuit, 1);

  ref_time = circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a060404363e73aea836fd9ac4738e129a">lsp_refresh</a>[0] &gt; <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a> ?
    <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a> : circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a060404363e73aea836fd9ac4738e129a">lsp_refresh</a>[0];

  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#afbf6ada19d1fda134ede0986124680ac">t_refresh_pseudo_lsp</a>[0],
           <a class="code" href="isis__lsp_8c.html#a9813405a112948deee3cb3c0b6b9e91b">lsp_l1_refresh_pseudo</a>, circuit,
           <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (ref_time, <a class="code" href="isis__constants_8h.html#adfaaf0b4e69adf9ae9c8dc47e3e00918">MAX_AGE_JITTER</a>));

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a99833cb66948d6aa881bca74ab942cc5"></a><!-- doxytag: member="isis_lsp.c::lsp_l1_regenerate" ref="a99833cb66948d6aa881bca74ab942cc5" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lsp_l1_regenerate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01598">1598</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__area.html">isis_area</a> *<a class="code" href="ospf__vty_8c.html#a7030c85f46deeffac793079c664c14ce">area</a>;

  area = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  area-&gt;<a class="code" href="structisis__area.html#affd6c83dc67d351f652205c64b91da1a">lsp_regenerate_pending</a>[0] = 0;

  <span class="keywordflow">return</span> <a class="code" href="isis__lsp_8c.html#abfcf29f408abe6994df4484a432a7b03">lsp_non_pseudo_regenerate</a> (area, 1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9bb0ebbebc92d3307a4018ca3d24f85e"></a><!-- doxytag: member="isis_lsp.c::lsp_l2_generate" ref="a9bb0ebbebc92d3307a4018ca3d24f85e" args="(struct isis_area *area)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsp_l2_generate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__area.html">isis_area</a> *&#160;</td>
          <td class="paramname"><em>area</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01475">1475</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, area-&gt;<a class="code" href="structisis__area.html#aa13bb9e9d007a177991fad0bbaf5b8c0">t_lsp_refresh</a>[1], <a class="code" href="isis__lsp_8c.html#a73cd3b4cb76bb36a65016f3315dde31e">lsp_refresh_l2</a>, area,
           <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a>);

  <span class="keywordflow">return</span> <a class="code" href="isis__lsp_8c.html#ae63b4445cafde6ccff7526b6d4570735">lsp_generate_non_pseudo</a> (area, 2);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a934808749ecec8173e1ba46880c80bd6"></a><!-- doxytag: member="isis_lsp.c::lsp_l2_pseudo_generate" ref="a934808749ecec8173e1ba46880c80bd6" args="(struct isis_circuit *circuit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsp_l2_pseudo_generate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01943">1943</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;
  u_char <span class="keywordtype">id</span>[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2];
  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ref_time;

  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (<span class="keywordtype">id</span>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
  <a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (<span class="keywordtype">id</span>) = 0;
  <a class="code" href="isis__lsp_8h.html#a15ad7ce72dee875930a28bec035f7b71">LSP_PSEUDO_ID</a> (<span class="keywordtype">id</span>) = circuit-&gt;<a class="code" href="structisis__circuit.html#a10453f6bcc1e8f1cb466240a81836ba9">circuit_id</a>;

  <span class="keywordflow">if</span> (<a class="code" href="isis__lsp_8c.html#a3859237ab43b147f4520d060439ca002">lsp_search</a> (<span class="keywordtype">id</span>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[1]))
    <span class="keywordflow">return</span> <a class="code" href="isis__lsp_8c.html#a122acef1e7b0bdf1e7f683c670525723">lsp_pseudo_regenerate</a> (circuit, 2);

  lsp = <a class="code" href="isis__lsp_8c.html#af43ff22a21554145c239b6c37556ce1a">lsp_new</a> (<span class="keywordtype">id</span>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#af0e5e6cfa7b7536e0700dd3645025d9b">max_lsp_lifetime</a>[1],
         1, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a>, 0, 2);

  <a class="code" href="isis__lsp_8c.html#a24dc6ec3f264c96f18a95ea1d6e5f1d2">lsp_build_pseudo</a> (lsp, circuit, 2);

  ref_time = circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a060404363e73aea836fd9ac4738e129a">lsp_refresh</a>[1] &gt; <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a> ?
    <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a> : circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a060404363e73aea836fd9ac4738e129a">lsp_refresh</a>[1];


  lsp-&gt;<a class="code" href="structisis__lsp.html#a92fb19d67740e3bfde012e19af97b7d3">own_lsp</a> = 1;
  <a class="code" href="isis__lsp_8c.html#a09d8f3bcc073c87f01c32b2f0994fb04">lsp_insert</a> (lsp, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[1]);
  <a class="code" href="isis__flags_8h.html#a57f45d9b4a8c70c53f796d96e5555fac">ISIS_FLAGS_SET_ALL</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>);

  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#afbf6ada19d1fda134ede0986124680ac">t_refresh_pseudo_lsp</a>[1],
           <a class="code" href="isis__lsp_8c.html#a4dcda3f6c233b53554094b98811b3394">lsp_l2_refresh_pseudo</a>, circuit,
           <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (ref_time, <a class="code" href="isis__constants_8h.html#adfaaf0b4e69adf9ae9c8dc47e3e00918">MAX_AGE_JITTER</a>));

  <span class="keywordflow">return</span> <a class="code" href="isis__lsp_8c.html#a31456cf3ff9953708c1d0328a99bfacc">lsp_regenerate_schedule</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4dcda3f6c233b53554094b98811b3394"></a><!-- doxytag: member="isis_lsp.c::lsp_l2_refresh_pseudo" ref="a4dcda3f6c233b53554094b98811b3394" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsp_l2_refresh_pseudo </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01918">1918</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;
  <span class="keywordtype">int</span> retval;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ref_time;
  circuit = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);

  <span class="keywordflow">if</span> (!circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#adb24376d01beb41cab0ed0c49c3a214c">is_dr</a>[1])
    <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;      <span class="comment">/* FIXME: purge and such */</span>

  circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#afbf6ada19d1fda134ede0986124680ac">t_refresh_pseudo_lsp</a>[1] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  retval = <a class="code" href="isis__lsp_8c.html#a122acef1e7b0bdf1e7f683c670525723">lsp_pseudo_regenerate</a> (circuit, 2);

  ref_time = circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a060404363e73aea836fd9ac4738e129a">lsp_refresh</a>[1] &gt; <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a> ?
    <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a> : circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a060404363e73aea836fd9ac4738e129a">lsp_refresh</a>[1];

  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#afbf6ada19d1fda134ede0986124680ac">t_refresh_pseudo_lsp</a>[1],
           <a class="code" href="isis__lsp_8c.html#a4dcda3f6c233b53554094b98811b3394">lsp_l2_refresh_pseudo</a>, circuit,
           <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (ref_time, <a class="code" href="isis__constants_8h.html#adfaaf0b4e69adf9ae9c8dc47e3e00918">MAX_AGE_JITTER</a>));

  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4efb80c98e8582dc7609ffb9bdd6e597"></a><!-- doxytag: member="isis_lsp.c::lsp_l2_regenerate" ref="a4efb80c98e8582dc7609ffb9bdd6e597" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lsp_l2_regenerate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01609">1609</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__area.html">isis_area</a> *<a class="code" href="ospf__vty_8c.html#a7030c85f46deeffac793079c664c14ce">area</a>;

  area = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  area-&gt;<a class="code" href="structisis__area.html#affd6c83dc67d351f652205c64b91da1a">lsp_regenerate_pending</a>[1] = 0;

  <span class="keywordflow">return</span> <a class="code" href="isis__lsp_8c.html#abfcf29f408abe6994df4484a432a7b03">lsp_non_pseudo_regenerate</a> (area, 2);
}
</pre></div>
</div>
</div>
<a class="anchor" id="af43ff22a21554145c239b6c37556ce1a"></a><!-- doxytag: member="isis_lsp.c::lsp_new" ref="af43ff22a21554145c239b6c37556ce1a" args="(u_char *lsp_id, u_int16_t rem_lifetime, u_int32_t seq_num, u_int8_t lsp_bits, u_int16_t checksum, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structisis__lsp.html">isis_lsp</a>* lsp_new </td>
          <td>(</td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>lsp_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int16_t&#160;</td>
          <td class="paramname"><em>rem_lifetime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int32_t&#160;</td>
          <td class="paramname"><em>seq_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int8_t&#160;</td>
          <td class="paramname"><em>lsp_bits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int16_t&#160;</td>
          <td class="paramname"><em>checksum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00475">475</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;

  lsp = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167baa9874bec1ebdd728cf6272ccea1c930c">MTYPE_ISIS_LSP</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structisis__lsp.html">isis_lsp</a>));
  <span class="keywordflow">if</span> (!lsp)
    {
      <span class="comment">/* FIXME: set lspdbol bit */</span>
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;lsp_new(): out of memory&quot;</span>);
      <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }
<span class="preprocessor">#ifdef LSP_MEMORY_PREASSIGN</span>
<span class="preprocessor"></span>  lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a> = <a class="code" href="stream_8c.html#a7117cdad9fa5e5ae633e0cf08d047459">stream_new</a> (1514); <span class="comment">/*Should be minimal mtu? yup... */</span>
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>  <span class="comment">/* We need to do realloc on TLVs additions */</span>
  lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a> = <a class="code" href="regex_8c.html#ab7e36af3707843f77cc5b4e831c2fa6d">malloc</a> (<a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a> + <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>);
<span class="preprocessor">#endif </span><span class="comment">/* LSP_MEMORY_PREASSIGN */</span>
  <span class="keywordflow">if</span> (<a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (<a class="code" href="isis__pdu_8h.html#a2991a019d1da82fb5406bff5ab46dcf6">lsp_id</a>) == 0)
    lsp-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#acca312187c5812b70485d18fdc60b986">frags</a> = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
  lsp-&gt;<a class="code" href="structisis__lsp.html#a4495af44aa8d877f56b8e7ce00b47344">isis_header</a> = (<span class="keyword">struct </span><a class="code" href="structisis__fixed__hdr.html">isis_fixed_hdr</a> *) (<a class="code" href="stream_8h.html#afde5f5db208a43da6faf7b830f26d7fc">STREAM_DATA</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>));
  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a> = (<span class="keyword">struct </span><a class="code" href="structisis__link__state__hdr.html">isis_link_state_hdr</a> *)
    (<a class="code" href="stream_8h.html#afde5f5db208a43da6faf7b830f26d7fc">STREAM_DATA</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>) + <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a>);

  <span class="comment">/* at first we fill the FIXED HEADER */</span>
  (level == 1) ? <a class="code" href="isis__pdu_8c.html#a5bb1429f6b41964f060f6abbfb50b5bf">fill_fixed_hdr</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a4495af44aa8d877f56b8e7ce00b47344">isis_header</a>, <a class="code" href="isis__pdu_8h.html#a37bd70be235d213245350209287f9d69">L1_LINK_STATE</a>) :
    <a class="code" href="isis__pdu_8c.html#a5bb1429f6b41964f060f6abbfb50b5bf">fill_fixed_hdr</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a4495af44aa8d877f56b8e7ce00b47344">isis_header</a>, <a class="code" href="isis__pdu_8h.html#a0078daf40d7e45a7bdbd26a016dde2da">L2_LINK_STATE</a>);

  <span class="comment">/* now for the LSP HEADER */</span>
  <span class="comment">/* Minimal LSP PDU size */</span>
  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a> = htons (<a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a> + <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>);
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>, <a class="code" href="isis__pdu_8h.html#a2991a019d1da82fb5406bff5ab46dcf6">lsp_id</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2);
  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a> = <a class="code" href="isis__pdu_8h.html#ac478e851f3af12545631aadafc9932ed">checksum</a>; <span class="comment">/* Provided in network order */</span>
  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a> = htonl (<a class="code" href="isis__pdu_8h.html#a4deeb76ae77c7e5dca81a8c3a07e8c23">seq_num</a>);
  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a> = htons (<a class="code" href="isis__pdu_8h.html#a67f02ba3d294cb872271dc4d82ad7965">rem_lifetime</a>);
  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a405c4b662dc97846dcca65f5c851f485">lsp_bits</a> = <a class="code" href="isis__pdu_8h.html#a83e5f4c3dca022e24977611cd0a028b6">lsp_bits</a>;
  lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> = level;
  lsp-&gt;<a class="code" href="structisis__lsp.html#aa2d9dce6fceedcb6af88a73f2f5a0616">age_out</a> = <a class="code" href="isis__constants_8h.html#a34e4027fe6ad8e371e370258da82dd23">ZERO_AGE_LIFETIME</a>;

  <a class="code" href="stream_8c.html#aa8fdf46961b0a0aa3d014bb602712076">stream_forward_endp</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>, <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a> + <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>);

  <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#a133d8993848d3fa2c41270511f133eb7">DEBUG_EVENTS</a>)
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;New LSP with ID %s-%02x-%02x seqnum %08x&quot;</span>,
        <a class="code" href="isis__misc_8c.html#aabccf63144f92eecd0eb77f24ee98529">sysid_print</a> (<a class="code" href="isis__pdu_8h.html#a2991a019d1da82fb5406bff5ab46dcf6">lsp_id</a>), <a class="code" href="isis__lsp_8h.html#a15ad7ce72dee875930a28bec035f7b71">LSP_PSEUDO_ID</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
        <a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
        ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>));

  <span class="keywordflow">return</span> lsp;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af11fc334a37a7a089a4c5e2d44496110"></a><!-- doxytag: member="isis_lsp.c::lsp_new_from_stream_ptr" ref="af11fc334a37a7a089a4c5e2d44496110" args="(struct stream *stream, u_int16_t pdu_len, struct isis_lsp *lsp0, struct isis_area *area)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structisis__lsp.html">isis_lsp</a>* lsp_new_from_stream_ptr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structstream.html">stream</a> *&#160;</td>
          <td class="paramname"><em>stream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int16_t&#160;</td>
          <td class="paramname"><em>pdu_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__area.html">isis_area</a> *&#160;</td>
          <td class="paramname"><em>area</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00446">446</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;

  lsp = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167baa9874bec1ebdd728cf6272ccea1c930c">MTYPE_ISIS_LSP</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structisis__lsp.html">isis_lsp</a>));
  <a class="code" href="isis__lsp_8c.html#a917a11f390e10660faa69faa510da442">lsp_update_data</a> (lsp, stream, area);

  <span class="keywordflow">if</span> (lsp0 == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      <span class="comment">/*</span>
<span class="comment">       * zero lsp -&gt; create the list for fragments</span>
<span class="comment">       */</span>
      lsp-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#acca312187c5812b70485d18fdc60b986">frags</a> = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
    }
  <span class="keywordflow">else</span>
    {
      <span class="comment">/*</span>
<span class="comment">       * a fragment -&gt; set the backpointer and add this to zero lsps frag list</span>
<span class="comment">       */</span>
      lsp-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#a3113261380202a14a924c31ca87cdee1">zero_lsp</a> = lsp0;
      <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (lsp0-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#acca312187c5812b70485d18fdc60b986">frags</a>, lsp);
    }

  <span class="keywordflow">return</span> lsp;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aab829620b2263604cc5c0233d5a5b099"></a><!-- doxytag: member="isis_lsp.c::lsp_next_frag" ref="aab829620b2263604cc5c0233d5a5b099" args="(u_char frag_num, struct isis_lsp *lsp0, struct isis_area *area, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structisis__lsp.html">isis_lsp</a>* lsp_next_frag </td>
          <td>(</td>
          <td class="paramtype">u_char&#160;</td>
          <td class="paramname"><em>frag_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__area.html">isis_area</a> *&#160;</td>
          <td class="paramname"><em>area</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00958">958</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;
  u_char frag_id[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2];

  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (frag_id, lsp0-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);
  <a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (frag_id) = frag_num;
  lsp = <a class="code" href="isis__lsp_8c.html#a3859237ab43b147f4520d060439ca002">lsp_search</a> (frag_id, area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1]);
  <span class="keywordflow">if</span> (lsp)
    {
      <span class="comment">/*</span>
<span class="comment">       * Clear the TLVs, but inherit the authinfo</span>
<span class="comment">       */</span>
      <a class="code" href="isis__lsp_8c.html#aa0d51cf5f190804be9b73b52db69ccd6">lsp_clear_data</a> (lsp);
      <span class="keywordflow">if</span> (lsp0-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>.<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>)
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>, &amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>,
          sizeof (<span class="keyword">struct</span> <a class="code" href="structisis__passwd.html">isis_passwd</a>));
      <a class="code" href="isis__tlv_8c.html#a02f053566530986751054dcf500af3a9">tlv_add_authinfo</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>.<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>,
                lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>.<a class="code" href="structisis__passwd.html#a3981443a6501783995b003ab8fd82f48">len</a>,
                lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>.<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);
    }
      <span class="keywordflow">return</span> lsp;
    }
  lsp = <a class="code" href="isis__lsp_8c.html#af43ff22a21554145c239b6c37556ce1a">lsp_new</a> (frag_id, area-&gt;<a class="code" href="structisis__area.html#af0e5e6cfa7b7536e0700dd3645025d9b">max_lsp_lifetime</a>[<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1], 0, area-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a>,
         0, <a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>);
  lsp-&gt;<a class="code" href="structisis__lsp.html#a92fb19d67740e3bfde012e19af97b7d3">own_lsp</a> = 1;
  <a class="code" href="isis__lsp_8c.html#a09d8f3bcc073c87f01c32b2f0994fb04">lsp_insert</a> (lsp, area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1]);
  <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (lsp0-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#acca312187c5812b70485d18fdc60b986">frags</a>, lsp);
  lsp-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#a3113261380202a14a924c31ca87cdee1">zero_lsp</a> = lsp0;
  <span class="comment">/*</span>
<span class="comment">   * Copy the authinfo from zero LSP</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (lsp0-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>.<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>)
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>, &amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>,
          sizeof (<span class="keyword">struct</span> <a class="code" href="structisis__passwd.html">isis_passwd</a>));
      <a class="code" href="isis__tlv_8c.html#a02f053566530986751054dcf500af3a9">tlv_add_authinfo</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>.<a class="code" href="structisis__passwd.html#a874984e0745fbcb41df9f463d831be67">type</a>,
            lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>.<a class="code" href="structisis__passwd.html#a3981443a6501783995b003ab8fd82f48">len</a>,
            lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a53dc2cb65bc632c84b3d702ab1dc16ce">auth_info</a>.<a class="code" href="structisis__passwd.html#a4af92e1126df2d7d2abeef451c082567">passwd</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);
    }
  <span class="keywordflow">return</span> lsp;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abfcf29f408abe6994df4484a432a7b03"></a><!-- doxytag: member="isis_lsp.c::lsp_non_pseudo_regenerate" ref="abfcf29f408abe6994df4484a432a7b03" args="(struct isis_area *area, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lsp_non_pseudo_regenerate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__area.html">isis_area</a> *&#160;</td>
          <td class="paramname"><em>area</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01484">1484</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="structdict__t.html">dict_t</a> *lspdb = area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1];
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp, *frag;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node;
  u_char <a class="code" href="isis__misc_8c.html#ac0016d3200b8885e05d151ca16ef4315">lspid</a>[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2];

  memset (lspid, 0, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2);
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (lspid, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);

  lsp = <a class="code" href="isis__lsp_8c.html#a3859237ab43b147f4520d060439ca002">lsp_search</a> (lspid, lspdb);

  <span class="keywordflow">if</span> (!lsp)
    {
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a>
    (<span class="stringliteral">&quot;ISIS-Upd (%s): lsp_non_pseudo_regenerate(): no L%d LSP found!&quot;</span>,
     area-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, level);

      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;
    }

  <a class="code" href="isis__lsp_8c.html#aa0d51cf5f190804be9b73b52db69ccd6">lsp_clear_data</a> (lsp);
  <a class="code" href="isis__lsp_8c.html#a8e44fcf09744fc11e91c6af9bcd17c7c">lsp_build_nonpseudo</a> (lsp, area);
  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a> = htons (<a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a>
                     (area-&gt;<a class="code" href="structisis__area.html#af0e5e6cfa7b7536e0700dd3645025d9b">max_lsp_lifetime</a>[level - 1],
                      <a class="code" href="isis__constants_8h.html#adfaaf0b4e69adf9ae9c8dc47e3e00918">MAX_AGE_JITTER</a>));
  <a class="code" href="isis__lsp_8c.html#a4a6da8fd883c32c4986e4d75e9a6f4e4">lsp_seqnum_update</a> (lsp);

  <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#abd8d8358bf794de3d9fba9ef5de689b3">DEBUG_UPDATE_PACKETS</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Upd (%s): refreshing our L%d LSP %s, &quot;</span>
          <span class="stringliteral">&quot;seq 0x%08x, cksum 0x%04x lifetime %us&quot;</span>,
          area-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
          level,
          <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
          ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>),
          ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>),
          ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>));
    }

  lsp-&gt;<a class="code" href="structisis__lsp.html#aea2ad3865df52bc01bc01fae22bf83a0">last_generated</a> = time (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
  area-&gt;<a class="code" href="structisis__area.html#affd6c83dc67d351f652205c64b91da1a">lsp_regenerate_pending</a>[level - 1] = 0;
  <a class="code" href="isis__flags_8h.html#a57f45d9b4a8c70c53f796d96e5555fac">ISIS_FLAGS_SET_ALL</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>);
  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#acca312187c5812b70485d18fdc60b986">frags</a>, node, frag))
    {
      frag-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a> = htons (<a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a>
                          (area-&gt;
                           max_lsp_lifetime[level - 1],
                           <a class="code" href="isis__constants_8h.html#adfaaf0b4e69adf9ae9c8dc47e3e00918">MAX_AGE_JITTER</a>));
      <a class="code" href="isis__flags_8h.html#a57f45d9b4a8c70c53f796d96e5555fac">ISIS_FLAGS_SET_ALL</a> (frag-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>);
    }

  <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#a0b7b9b7b8a3eb903a0deb5c20791d761">ip_circuits</a>)
    <a class="code" href="isis__spf_8c.html#a07d72d64d2b651d969695c1f26031678">isis_spf_schedule</a> (area, level);
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (area-&gt;ipv6_circuits)
    isis_spf_schedule6 (area, level);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a613e1f38d40f5feb02c859dd8933b5c5"></a><!-- doxytag: member="isis_lsp.c::lsp_print" ref="a613e1f38d40f5feb02c859dd8933b5c5" args="(dnode_t *node, struct vty *vty, char dynhost)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lsp_print </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdnode__t.html">dnode_t</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structvty.html">vty</a> *&#160;</td>
          <td class="paramname"><em>vty</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>dynhost</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00696">696</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp = <a class="code" href="dict_8h.html#a17fccc85aae3874de7152f103d5945bc">dnode_get</a> (node);
  u_char LSPid[255];

  <a class="code" href="isis__lsp_8c.html#a5838ff5c762c49738cc88e9887fcb9fa">lspid_print</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>, LSPid, dynhost, 1);
  <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%-21s%c   &quot;</span>, LSPid, lsp-&gt;<a class="code" href="structisis__lsp.html#a92fb19d67740e3bfde012e19af97b7d3">own_lsp</a> ? <span class="charliteral">&#39;*&#39;</span> : <span class="charliteral">&#39; &#39;</span>);
  <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;0x%08x   &quot;</span>, ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>));
  <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;0x%04x      &quot;</span>, ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#afb16ee6cc606527cc2705773cc2b79c4">checksum</a>));

  <span class="keywordflow">if</span> (ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>) == 0)
    <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot; (%2u)&quot;</span>, lsp-&gt;<a class="code" href="structisis__lsp.html#aa2d9dce6fceedcb6af88a73f2f5a0616">age_out</a>);
  <span class="keywordflow">else</span>
    <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%5u&quot;</span>, ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>));

  <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;         %s%s&quot;</span>,
       <a class="code" href="isis__lsp_8c.html#a586294319acffcce0555e5e33377b7f6">lsp_bits2string</a> (&amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a405c4b662dc97846dcca65f5c851f485">lsp_bits</a>), <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9a7fe85e348f02c16f09905ca70c6187"></a><!-- doxytag: member="isis_lsp.c::lsp_print_all" ref="a9a7fe85e348f02c16f09905ca70c6187" args="(struct vty *vty, dict_t *lspdb, char detail, char dynhost)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsp_print_all </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvty.html">vty</a> *&#160;</td>
          <td class="paramname"><em>vty</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdict__t.html">dict_t</a> *&#160;</td>
          <td class="paramname"><em>lspdb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>detail</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>dynhost</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00880">880</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{

  <a class="code" href="structdnode__t.html">dnode_t</a> *node = <a class="code" href="dict_8c.html#a2b439ffb63f9b3089d0306ec3b26672f">dict_first</a> (lspdb), *next;
  <span class="keywordtype">int</span> lsp_count = 0;

  <span class="comment">/* print the title, for both modes */</span>
  <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;LSP ID                   LSP Seq Num  LSP Checksum &quot;</span>
       <span class="stringliteral">&quot;LSP Holdtime ATT/P/OL%s&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);

  <span class="keywordflow">if</span> (detail == <a class="code" href="isis__misc_8h.html#aaf105ae5beaca1dee30ae54530691fcea9b67ed2ae41434b0cc2a75d7be8b9576">ISIS_UI_LEVEL_BRIEF</a>)
    {
      <span class="keywordflow">while</span> (node != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      <span class="comment">/* I think it is unnecessary, so I comment it out */</span>
      <span class="comment">/* dict_contains (lspdb, node); */</span>
      next = <a class="code" href="dict_8c.html#a1f32888c49577ec2b2dc9d16922bf487">dict_next</a> (lspdb, node);
      <a class="code" href="isis__lsp_8c.html#a613e1f38d40f5feb02c859dd8933b5c5">lsp_print</a> (node, vty, dynhost);
      node = next;
      lsp_count++;
    }
    }
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (detail == <a class="code" href="isis__misc_8h.html#aaf105ae5beaca1dee30ae54530691fcea92418876d4e4e759a009d13598364ae4">ISIS_UI_LEVEL_DETAIL</a>)
    {
      <span class="keywordflow">while</span> (node != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      next = <a class="code" href="dict_8c.html#a1f32888c49577ec2b2dc9d16922bf487">dict_next</a> (lspdb, node);
      <a class="code" href="isis__lsp_8c.html#a2a648621d46f28687f81bf572bd3e711">lsp_print_detail</a> (node, vty, dynhost);
      node = next;
      lsp_count++;
    }
    }

  <span class="keywordflow">return</span> lsp_count;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2a648621d46f28687f81bf572bd3e711"></a><!-- doxytag: member="isis_lsp.c::lsp_print_detail" ref="a2a648621d46f28687f81bf572bd3e711" args="(dnode_t *node, struct vty *vty, char dynhost)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lsp_print_detail </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdnode__t.html">dnode_t</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structvty.html">vty</a> *&#160;</td>
          <td class="paramname"><em>vty</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>dynhost</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00716">716</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp = <a class="code" href="dict_8h.html#a17fccc85aae3874de7152f103d5945bc">dnode_get</a> (node);
  <span class="keyword">struct </span><a class="code" href="structarea__addr.html">area_addr</a> *<a class="code" href="structarea__addr.html#ac84395fbe3f40a45edf1d7ab43a701da">area_addr</a>;
  <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *lnode;
  <span class="keyword">struct </span><a class="code" href="structis__neigh.html">is_neigh</a> *<a class="code" href="structis__neigh.html">is_neigh</a>;
  <span class="keyword">struct </span><a class="code" href="structte__is__neigh.html">te_is_neigh</a> *<a class="code" href="structte__is__neigh.html">te_is_neigh</a>;
  <span class="keyword">struct </span><a class="code" href="structipv4__reachability.html">ipv4_reachability</a> *ipv4_reach;
  <span class="keyword">struct </span>in_addr *ipv4_addr;
  <span class="keyword">struct </span><a class="code" href="structte__ipv4__reachability.html">te_ipv4_reachability</a> *te_ipv4_reach;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keyword">struct </span>ipv6_reachability *ipv6_reach;
  <span class="keyword">struct </span>in6_addr in6;
  u_char buff[BUFSIZ];
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>  u_char LSPid[255];
  u_char <a class="code" href="structhostname.html">hostname</a>[255];
  u_char ipv4_reach_prefix[20];
  u_char ipv4_reach_mask[20];
  u_char ipv4_address[20];

  <a class="code" href="isis__lsp_8c.html#a5838ff5c762c49738cc88e9887fcb9fa">lspid_print</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>, LSPid, dynhost, 1);
  <a class="code" href="isis__lsp_8c.html#a613e1f38d40f5feb02c859dd8933b5c5">lsp_print</a> (node, vty, dynhost);

  <span class="comment">/* for all area address */</span>
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a11d8deaa75c26e958cff5f74fee3ef10">area_addrs</a>)
    <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a11d8deaa75c26e958cff5f74fee3ef10">area_addrs</a>, lnode, area_addr))
      {
    <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  Area Address: %s%s&quot;</span>,
         <a class="code" href="isis__misc_8c.html#a5032aed64ad562c17d81f07afad28209">isonet_print</a> (area_addr-&gt;<a class="code" href="structarea__addr.html#ac84395fbe3f40a45edf1d7ab43a701da">area_addr</a>, area_addr-&gt;<a class="code" href="structarea__addr.html#ae735a6ff10c8e48ebe4e98a06e194a82">addr_len</a>),
         <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      }
  
  <span class="comment">/* for the nlpid tlv */</span>
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>)
    {
      <span class="keywordflow">for</span> (i = 0; i &lt; lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>-&gt;<a class="code" href="structnlpids.html#a73f0f5f1e7aa64694d5802b91af6533b">count</a>; i++)
    {
      <span class="keywordflow">switch</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>-&gt;<a class="code" href="structnlpids.html#a6dbd263750da21187880986a50fd5857">nlpids</a>[i])
        {
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#a9c1ffc4a81108d901cd8914d20cd4caf">NLPID_IP</a>:
        <span class="keywordflow">case</span> <a class="code" href="isis__constants_8h.html#af33b1ac580353b4a2ec3b766d5f90464">NLPID_IPV6</a>:
          <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  NLPID:        0x%X%s&quot;</span>,
               lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a1e64fb03a35dacd896393c5a3fc06db1">nlpids</a>-&gt;<a class="code" href="structnlpids.html#a6dbd263750da21187880986a50fd5857">nlpids</a>[i], <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
          <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
          <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  NLPID:        %s%s&quot;</span>, <span class="stringliteral">&quot;unknown&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
          <span class="keywordflow">break</span>;
        }
    }
    }

  <span class="comment">/* for the hostname tlv */</span>
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac2b8abaebfab8d2a55242d83a87a3e70">hostname</a>)
    {
      memset (hostname, 0, <span class="keyword">sizeof</span> (hostname));
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (hostname, lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac2b8abaebfab8d2a55242d83a87a3e70">hostname</a>-&gt;<a class="code" href="structhostname.html#a0a14b55c4a1b6d672adfaa81b95936f3">name</a>,
          lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac2b8abaebfab8d2a55242d83a87a3e70">hostname</a>-&gt;<a class="code" href="structhostname.html#af410706acabde261182a41b3579b04b6">namelen</a>);
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  Hostname: %s%s&quot;</span>, hostname, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
    }

  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae9ef317829a76d7a79d2789786a2ac1f">ipv4_addrs</a>)
    <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae9ef317829a76d7a79d2789786a2ac1f">ipv4_addrs</a>, lnode, ipv4_addr))
      {
    <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (ipv4_address, inet_ntoa (*ipv4_addr), <span class="keyword">sizeof</span> (ipv4_address));
    <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  IP:        %s%s&quot;</span>, ipv4_address, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      }

  <span class="comment">/* TE router id */</span>
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a84e7120ac1718546fc9bb3f80470ca69">router_id</a>)
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (ipv4_address, inet_ntoa (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a84e7120ac1718546fc9bb3f80470ca69">router_id</a>-&gt;<a class="code" href="structte__router__id.html#a859c4ce8787ff3914c4c7863ad187740">id</a>),
          sizeof (ipv4_address));
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  Router ID: %s%s&quot;</span>, ipv4_address, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
    }

  <span class="comment">/* for the IS neighbor tlv */</span>
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a>)
    <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a571d587f344a492326654832d513f63a">is_neighs</a>, lnode, is_neigh))
      {
    <a class="code" href="isis__lsp_8c.html#a5838ff5c762c49738cc88e9887fcb9fa">lspid_print</a> (is_neigh-&gt;<a class="code" href="structis__neigh.html#a133612c7ce92a57c785bbc2cbe1d0ec7">neigh_id</a>, LSPid, dynhost, 0);
    <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  Metric: %-10d IS %s%s&quot;</span>,
         is_neigh-&gt;<a class="code" href="structis__neigh.html#a89a2c799e58b8ab95549581a06f2a53a">metrics</a>.<a class="code" href="structmetric.html#ae927ddb546511096f632820b678d73bf">metric_default</a>, LSPid, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      }
  
  <span class="comment">/* for the internal reachable tlv */</span>
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a202838cf00b9aeb6f746c11c8a421642">ipv4_int_reachs</a>)
    <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a202838cf00b9aeb6f746c11c8a421642">ipv4_int_reachs</a>, lnode,
                   ipv4_reach))
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (ipv4_reach_prefix, inet_ntoa (ipv4_reach-&gt;<a class="code" href="structipv4__reachability.html#a7ae516558fddb6aca89c864bd2d23d30">prefix</a>),
          sizeof (ipv4_reach_prefix));
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (ipv4_reach_mask, inet_ntoa (ipv4_reach-&gt;<a class="code" href="structipv4__reachability.html#a229b4c7635d0a94d260c0929125399ee">mask</a>),
          sizeof (ipv4_reach_mask));
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  Metric: %-10d IP-Internal %s %s%s&quot;</span>,
           ipv4_reach-&gt;<a class="code" href="structipv4__reachability.html#a9fb77b6ac90d3fc4f7bfbd7f4843543a">metrics</a>.<a class="code" href="structmetric.html#ae927ddb546511096f632820b678d73bf">metric_default</a>, ipv4_reach_prefix,
           ipv4_reach_mask, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
    }

  <span class="comment">/* for the external reachable tlv */</span>
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a24de94a53f11ec8f24e9f133ba2f63c3">ipv4_ext_reachs</a>)
    <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#a24de94a53f11ec8f24e9f133ba2f63c3">ipv4_ext_reachs</a>, lnode, 
                   ipv4_reach))
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (ipv4_reach_prefix, inet_ntoa (ipv4_reach-&gt;<a class="code" href="structipv4__reachability.html#a7ae516558fddb6aca89c864bd2d23d30">prefix</a>),
          sizeof (ipv4_reach_prefix));
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (ipv4_reach_mask, inet_ntoa (ipv4_reach-&gt;<a class="code" href="structipv4__reachability.html#a229b4c7635d0a94d260c0929125399ee">mask</a>),
          sizeof (ipv4_reach_mask));
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  Metric: %-10d IP-External %s %s%s&quot;</span>,
           ipv4_reach-&gt;<a class="code" href="structipv4__reachability.html#a9fb77b6ac90d3fc4f7bfbd7f4843543a">metrics</a>.<a class="code" href="structmetric.html#ae927ddb546511096f632820b678d73bf">metric_default</a>, ipv4_reach_prefix,
           ipv4_reach_mask, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
    }
  
  <span class="comment">/* IPv6 tlv */</span>
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.ipv6_reachs)
    <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.ipv6_reachs, lnode, ipv6_reach))
    {
      memset (&amp;in6, 0, <span class="keyword">sizeof</span> (in6));
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (in6.s6_addr, ipv6_reach-&gt;prefix,
          <a class="code" href="bgpd_8h.html#a472145011d944606a257487e80cc3ace">PSIZE</a> (ipv6_reach-&gt;prefix_len));
      <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, &amp;in6, (<span class="keywordtype">char</span> *)buff, BUFSIZ);
      <span class="keywordflow">if</span> ((ipv6_reach-&gt;control_info &amp;&amp;
       <a class="code" href="isis__tlv_8h.html#a8cdce234e266e12e1ee3f3f232a4d6c1">CTRL_INFO_DISTRIBUTION</a>) == <a class="code" href="isis__tlv_8h.html#a6efedb856f37106e728f0b09cefe9f0c">DISTRIBUTION_INTERNAL</a>)
    <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  Metric: %-10d IPv6-Internal %s/%d%s&quot;</span>,
         ntohl (ipv6_reach-&gt;metric),
         buff, ipv6_reach-&gt;prefix_len, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      <span class="keywordflow">else</span>
    <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  Metric: %-10d IPv6-External %s/%d%s&quot;</span>,
         ntohl (ipv6_reach-&gt;metric),
         buff, ipv6_reach-&gt;prefix_len, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="comment">/* TE IS neighbor tlv */</span>
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a>)
    <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ae29c0c82bc5fb058e1d72eb55d1c76ac">te_is_neighs</a>, lnode, te_is_neigh))
    {
      uint32_t <a class="code" href="structmetric.html">metric</a>;
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;metric, te_is_neigh-&gt;<a class="code" href="structte__is__neigh.html#a7158aa6efe17579d240123affa0a543c">te_metric</a>, 3);
      <a class="code" href="isis__lsp_8c.html#a5838ff5c762c49738cc88e9887fcb9fa">lspid_print</a> (te_is_neigh-&gt;<a class="code" href="structte__is__neigh.html#aeac52df557a764c20753943d4f475203">neigh_id</a>, LSPid, dynhost, 0);
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  Metric: %-10d IS-Extended %s%s&quot;</span>,
           ntohl (metric &lt;&lt; 8), LSPid, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
    }

  <span class="comment">/* TE IPv4 tlv */</span>
  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac827f5db217d1de5cc2a58c9b5a9cf81">te_ipv4_reachs</a>)
    <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac827f5db217d1de5cc2a58c9b5a9cf81">te_ipv4_reachs</a>, lnode,
                   te_ipv4_reach))
    {
      <span class="comment">/* FIXME: There should be better way to output this stuff. */</span>
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;  Metric: %-10d IP-Extended %s/%d%s&quot;</span>,
           ntohl (te_ipv4_reach-&gt;<a class="code" href="structte__ipv4__reachability.html#a9704689f0bbfff1997a158427765060e">te_metric</a>),
           inet_ntoa (<a class="code" href="isis__misc_8c.html#af795aa21c24ab7f8e6e942be669bfc34">newprefix2inaddr</a> (&amp;te_ipv4_reach-&gt;<a class="code" href="structte__ipv4__reachability.html#ad50dc67e9a53223f8083d85cbb727bfa">prefix_start</a>,
                        te_ipv4_reach-&gt;<a class="code" href="structte__ipv4__reachability.html#ab886131ddaf522d8bc34610687a79309">control</a>)),
           te_ipv4_reach-&gt;<a class="code" href="structte__ipv4__reachability.html#ab886131ddaf522d8bc34610687a79309">control</a> &amp; 0x3F, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
    }

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a122acef1e7b0bdf1e7f683c670525723"></a><!-- doxytag: member="isis_lsp.c::lsp_pseudo_regenerate" ref="a122acef1e7b0bdf1e7f683c670525723" args="(struct isis_circuit *circuit, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lsp_pseudo_regenerate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01815">1815</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="structdict__t.html">dict_t</a> *lspdb = circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1];
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;
  u_char <a class="code" href="isis__pdu_8h.html#a2991a019d1da82fb5406bff5ab46dcf6">lsp_id</a>[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2];

  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (lsp_id, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
  <a class="code" href="isis__lsp_8h.html#a15ad7ce72dee875930a28bec035f7b71">LSP_PSEUDO_ID</a> (lsp_id) = circuit-&gt;<a class="code" href="structisis__circuit.html#a10453f6bcc1e8f1cb466240a81836ba9">circuit_id</a>;
  <a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (lsp_id) = 0;

  lsp = <a class="code" href="isis__lsp_8c.html#a3859237ab43b147f4520d060439ca002">lsp_search</a> (lsp_id, lspdb);

  <span class="keywordflow">if</span> (!lsp)
    {
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;lsp_pseudo_regenerate(): no l%d LSP %s found!&quot;</span>, <a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>,
        <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (lsp_id));
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#ac694b0bd16857a3d50deea71f78e8b7f">ISIS_ERROR</a>;
    }
  <a class="code" href="isis__lsp_8c.html#aa0d51cf5f190804be9b73b52db69ccd6">lsp_clear_data</a> (lsp);

  <a class="code" href="isis__lsp_8c.html#a24dc6ec3f264c96f18a95ea1d6e5f1d2">lsp_build_pseudo</a> (lsp, circuit, <a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>);

  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a> =
    htons (<a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#af0e5e6cfa7b7536e0700dd3645025d9b">max_lsp_lifetime</a>[<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1],
            <a class="code" href="isis__constants_8h.html#adfaaf0b4e69adf9ae9c8dc47e3e00918">MAX_AGE_JITTER</a>));

  <a class="code" href="isis__lsp_8c.html#a95c7b93c607b9aba6b6697b136d9ad98">lsp_inc_seqnum</a> (lsp, 0);

  <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#abd8d8358bf794de3d9fba9ef5de689b3">DEBUG_UPDATE_PACKETS</a>)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Upd (%s): refreshing pseudo LSP L%d %s&quot;</span>,
          circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, <a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>,
          <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>));
    }

  lsp-&gt;<a class="code" href="structisis__lsp.html#aea2ad3865df52bc01bc01fae22bf83a0">last_generated</a> = time (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
  <a class="code" href="isis__flags_8h.html#a57f45d9b4a8c70c53f796d96e5555fac">ISIS_FLAGS_SET_ALL</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>);

  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a326bd66d63f17cf92421e5df0d29fe32"></a><!-- doxytag: member="isis_lsp.c::lsp_purge_dr" ref="a326bd66d63f17cf92421e5df0d29fe32" args="(u_char *id, struct isis_circuit *circuit, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsp_purge_dr </td>
          <td>(</td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l02062">2062</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;

  lsp = <a class="code" href="isis__lsp_8c.html#a3859237ab43b147f4520d060439ca002">lsp_search</a> (<span class="keywordtype">id</span>, circuit-&gt;<a class="code" href="structisis__circuit.html#a4284617c89806a77b3c2314e15ac508b">area</a>-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1]);

  <span class="keywordflow">if</span> (lsp &amp;&amp; lsp-&gt;<a class="code" href="structisis__lsp.html#aab633c4836fd6efe80eed373b169fb73">purged</a> == 0)
    {
      lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a> = htons (0);
      lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a> =
    htons (<a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a> + <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>);
      lsp-&gt;<a class="code" href="structisis__lsp.html#aab633c4836fd6efe80eed373b169fb73">purged</a> = 0;
      <a class="code" href="checksum_8c.html#a097fa5404eb654e8e112bb954bf4ef15">fletcher_checksum</a> (<a class="code" href="stream_8h.html#afde5f5db208a43da6faf7b830f26d7fc">STREAM_DATA</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>) + 12,
               ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a>) - 12, 12);
      <a class="code" href="isis__flags_8h.html#a57f45d9b4a8c70c53f796d96e5555fac">ISIS_FLAGS_SET_ALL</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>);
    }

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3b934844c90f614a6f5f4a2734a23e77"></a><!-- doxytag: member="isis_lsp.c::lsp_purge_non_exist" ref="a3b934844c90f614a6f5f4a2734a23e77" args="(struct isis_link_state_hdr *lsp_hdr, struct isis_area *area)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsp_purge_non_exist </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__link__state__hdr.html">isis_link_state_hdr</a> *&#160;</td>
          <td class="paramname"><em>lsp_hdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__area.html">isis_area</a> *&#160;</td>
          <td class="paramname"><em>area</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l02087">2087</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;

  <span class="comment">/*</span>
<span class="comment">   * We need to create the LSP to be purged </span>
<span class="comment">   */</span>
  <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;LSP PURGE NON EXIST&quot;</span>);
  lsp = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167baa9874bec1ebdd728cf6272ccea1c930c">MTYPE_ISIS_LSP</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structisis__lsp.html">isis_lsp</a>));
  <span class="comment">/*FIXME: BUG BUG BUG! the lsp doesn&#39;t exist here! */</span>
  <span class="comment">/*did smt here, maybe good probably not */</span>
  lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> = ((lsp_hdr-&gt;<a class="code" href="structisis__link__state__hdr.html#a405c4b662dc97846dcca65f5c851f485">lsp_bits</a> &amp; <a class="code" href="isis__constants_8h.html#a9f40952694b8ae76b12e90808bd81229">LSPBIT_IST</a>) == <a class="code" href="isis__constants_8h.html#a4806dbcd4c094ef55cecd6aca29520d7">IS_LEVEL_1</a>) ? 1 : 2;
  lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a> = <a class="code" href="stream_8c.html#a7117cdad9fa5e5ae633e0cf08d047459">stream_new</a> (<a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a> + <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>);
  lsp-&gt;<a class="code" href="structisis__lsp.html#a4495af44aa8d877f56b8e7ce00b47344">isis_header</a> = (<span class="keyword">struct </span><a class="code" href="structisis__fixed__hdr.html">isis_fixed_hdr</a> *) <a class="code" href="stream_8h.html#afde5f5db208a43da6faf7b830f26d7fc">STREAM_DATA</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);
  <a class="code" href="isis__pdu_8c.html#a5bb1429f6b41964f060f6abbfb50b5bf">fill_fixed_hdr</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a4495af44aa8d877f56b8e7ce00b47344">isis_header</a>, (lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> == 1) ? <a class="code" href="isis__pdu_8h.html#a37bd70be235d213245350209287f9d69">L1_LINK_STATE</a>
          : <a class="code" href="isis__pdu_8h.html#a0078daf40d7e45a7bdbd26a016dde2da">L2_LINK_STATE</a>);
  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a> = (<span class="keyword">struct </span><a class="code" href="structisis__link__state__hdr.html">isis_link_state_hdr</a> *) (<a class="code" href="stream_8h.html#afde5f5db208a43da6faf7b830f26d7fc">STREAM_DATA</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>) +
                            <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a>);
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>, lsp_hdr, <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>);

  <span class="comment">/*</span>
<span class="comment">   * Retain only LSP header</span>
<span class="comment">   */</span>
  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a> = htons (<a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a> + <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>);
  <span class="comment">/*</span>
<span class="comment">   * Set the remaining lifetime to 0</span>
<span class="comment">   */</span>
  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a> = 0;
  <span class="comment">/*</span>
<span class="comment">   * Put the lsp into LSPdb</span>
<span class="comment">   */</span>
  <a class="code" href="isis__lsp_8c.html#a09d8f3bcc073c87f01c32b2f0994fb04">lsp_insert</a> (lsp, area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a> - 1]);

  <span class="comment">/*</span>
<span class="comment">   * Send in to whole area</span>
<span class="comment">   */</span>
  <a class="code" href="isis__flags_8h.html#a57f45d9b4a8c70c53f796d96e5555fac">ISIS_FLAGS_SET_ALL</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>);

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="adc8acfaac35e9082714fb0f5cb47b606"></a><!-- doxytag: member="isis_lsp.c::lsp_refresh_l1" ref="adc8acfaac35e9082714fb0f5cb47b606" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsp_refresh_l1 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01550">1550</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__area.html">isis_area</a> *<a class="code" href="ospf__vty_8c.html#a7030c85f46deeffac793079c664c14ce">area</a>;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ref_time;

  area = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (area);

  area-&gt;<a class="code" href="structisis__area.html#aa13bb9e9d007a177991fad0bbaf5b8c0">t_lsp_refresh</a>[0] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a> &amp; <a class="code" href="isis__constants_8h.html#a4806dbcd4c094ef55cecd6aca29520d7">IS_LEVEL_1</a>)
    <a class="code" href="isis__lsp_8c.html#abfcf29f408abe6994df4484a432a7b03">lsp_non_pseudo_regenerate</a> (area, 1);

  ref_time = area-&gt;<a class="code" href="structisis__area.html#a060404363e73aea836fd9ac4738e129a">lsp_refresh</a>[0] &gt; <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a> ?
    <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a> : area-&gt;<a class="code" href="structisis__area.html#a060404363e73aea836fd9ac4738e129a">lsp_refresh</a>[0];

  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, area-&gt;<a class="code" href="structisis__area.html#aa13bb9e9d007a177991fad0bbaf5b8c0">t_lsp_refresh</a>[0], <a class="code" href="isis__lsp_8c.html#adc8acfaac35e9082714fb0f5cb47b606">lsp_refresh_l1</a>, area,
           <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (ref_time, <a class="code" href="isis__constants_8h.html#adfaaf0b4e69adf9ae9c8dc47e3e00918">MAX_AGE_JITTER</a>));

  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a73cd3b4cb76bb36a65016f3315dde31e"></a><!-- doxytag: member="isis_lsp.c::lsp_refresh_l2" ref="a73cd3b4cb76bb36a65016f3315dde31e" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsp_refresh_l2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01572">1572</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__area.html">isis_area</a> *<a class="code" href="ospf__vty_8c.html#a7030c85f46deeffac793079c664c14ce">area</a>;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ref_time;

  area = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (area);

  area-&gt;<a class="code" href="structisis__area.html#aa13bb9e9d007a177991fad0bbaf5b8c0">t_lsp_refresh</a>[1] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a> &amp; <a class="code" href="isis__constants_8h.html#a9daa7fbf09b604c718f3bbe189aedd1a">IS_LEVEL_2</a>)
    <a class="code" href="isis__lsp_8c.html#abfcf29f408abe6994df4484a432a7b03">lsp_non_pseudo_regenerate</a> (area, 2);

  ref_time = area-&gt;<a class="code" href="structisis__area.html#a060404363e73aea836fd9ac4738e129a">lsp_refresh</a>[1] &gt; <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a> ?
    <a class="code" href="isis__constants_8h.html#a6cda16880a90f2af40b3de9934773733">MAX_LSP_GEN_INTERVAL</a> : area-&gt;<a class="code" href="structisis__area.html#a060404363e73aea836fd9ac4738e129a">lsp_refresh</a>[1];

  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, area-&gt;<a class="code" href="structisis__area.html#aa13bb9e9d007a177991fad0bbaf5b8c0">t_lsp_refresh</a>[1], <a class="code" href="isis__lsp_8c.html#a73cd3b4cb76bb36a65016f3315dde31e">lsp_refresh_l2</a>, area,
           <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (ref_time, <a class="code" href="isis__constants_8h.html#adfaaf0b4e69adf9ae9c8dc47e3e00918">MAX_AGE_JITTER</a>));

  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a31456cf3ff9953708c1d0328a99bfacc"></a><!-- doxytag: member="isis_lsp.c::lsp_regenerate_schedule" ref="a31456cf3ff9953708c1d0328a99bfacc" args="(struct isis_area *area)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsp_regenerate_schedule </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__area.html">isis_area</a> *&#160;</td>
          <td class="paramname"><em>area</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01620">1620</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;
  u_char <span class="keywordtype">id</span>[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2];
  time_t now, diff;
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (<span class="keywordtype">id</span>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
  <a class="code" href="isis__lsp_8h.html#a15ad7ce72dee875930a28bec035f7b71">LSP_PSEUDO_ID</a> (<span class="keywordtype">id</span>) = <a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (<span class="keywordtype">id</span>) = 0;
  now = time (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
  <span class="comment">/*</span>
<span class="comment">   * First level 1</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a> &amp; <a class="code" href="isis__constants_8h.html#a4806dbcd4c094ef55cecd6aca29520d7">IS_LEVEL_1</a>)
    {
      lsp = <a class="code" href="isis__lsp_8c.html#a3859237ab43b147f4520d060439ca002">lsp_search</a> (<span class="keywordtype">id</span>, area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[0]);
      <span class="keywordflow">if</span> (!lsp || area-&gt;<a class="code" href="structisis__area.html#affd6c83dc67d351f652205c64b91da1a">lsp_regenerate_pending</a>[0])
    <span class="keywordflow">goto</span> L2;
      <span class="comment">/*</span>
<span class="comment">       * Throttle avoidance</span>
<span class="comment">       */</span>
      diff = now - lsp-&gt;<a class="code" href="structisis__lsp.html#aea2ad3865df52bc01bc01fae22bf83a0">last_generated</a>;
      <span class="keywordflow">if</span> (diff &lt; <a class="code" href="isis__constants_8h.html#a0e57941273060782de67219f33f895c1">MIN_LSP_GEN_INTERVAL</a>)
    {
      area-&gt;<a class="code" href="structisis__area.html#affd6c83dc67d351f652205c64b91da1a">lsp_regenerate_pending</a>[0] = 1;
      <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="isis__lsp_8c.html#a99833cb66948d6aa881bca74ab942cc5">lsp_l1_regenerate</a>, area,
                <a class="code" href="isis__constants_8h.html#a0e57941273060782de67219f33f895c1">MIN_LSP_GEN_INTERVAL</a> - diff);
      <span class="keywordflow">goto</span> L2;
    }
      <span class="keywordflow">else</span>
    <a class="code" href="isis__lsp_8c.html#abfcf29f408abe6994df4484a432a7b03">lsp_non_pseudo_regenerate</a> (area, 1);
    }
  <span class="comment">/*</span>
<span class="comment">   * then 2</span>
<span class="comment">   */</span>
L2:
  <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#a81021eb6fb20d16db0d13c335baecdae">is_type</a> &amp; <a class="code" href="isis__constants_8h.html#a9daa7fbf09b604c718f3bbe189aedd1a">IS_LEVEL_2</a>)
    {
      lsp = <a class="code" href="isis__lsp_8c.html#a3859237ab43b147f4520d060439ca002">lsp_search</a> (<span class="keywordtype">id</span>, area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[1]);
      <span class="keywordflow">if</span> (!lsp || area-&gt;<a class="code" href="structisis__area.html#affd6c83dc67d351f652205c64b91da1a">lsp_regenerate_pending</a>[1])
    <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
      <span class="comment">/*</span>
<span class="comment">       * Throttle avoidance</span>
<span class="comment">       */</span>
      diff = now - lsp-&gt;<a class="code" href="structisis__lsp.html#aea2ad3865df52bc01bc01fae22bf83a0">last_generated</a>;
      <span class="keywordflow">if</span> (diff &lt; <a class="code" href="isis__constants_8h.html#a0e57941273060782de67219f33f895c1">MIN_LSP_GEN_INTERVAL</a>)
    {
      area-&gt;<a class="code" href="structisis__area.html#affd6c83dc67d351f652205c64b91da1a">lsp_regenerate_pending</a>[1] = 1;
      <a class="code" href="thread_8h.html#aca77b3bbd166d3573de5ecd9756a590c">thread_add_timer</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="isis__lsp_8c.html#a4efb80c98e8582dc7609ffb9bdd6e597">lsp_l2_regenerate</a>, area,
                <a class="code" href="isis__constants_8h.html#a0e57941273060782de67219f33f895c1">MIN_LSP_GEN_INTERVAL</a> - diff);
      <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
    }
      <span class="keywordflow">else</span>
    <a class="code" href="isis__lsp_8c.html#abfcf29f408abe6994df4484a432a7b03">lsp_non_pseudo_regenerate</a> (area, 2);
    }

  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0ae83d454874a8fd54be13230268bee3"></a><!-- doxytag: member="isis_lsp.c::lsp_remove_frags" ref="a0ae83d454874a8fd54be13230268bee3" args="(struct list *frags, dict_t *lspdb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lsp_remove_frags </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlist.html">list</a> *&#160;</td>
          <td class="paramname"><em>frags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdict__t.html">dict_t</a> *&#160;</td>
          <td class="paramname"><em>lspdb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00190">190</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="structdnode__t.html">dnode_t</a> *dnode;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *lnode, *lnnode;
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;

  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (frags, lnode, lnnode, lsp))
    {
      dnode = <a class="code" href="dict_8c.html#a9b4c0968674a4ff436bb8180aa56e522">dict_lookup</a> (lspdb, lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>);
      <a class="code" href="isis__lsp_8c.html#a8910aea25a4f0680a4b4945609aaf97b">lsp_destroy</a> (lsp);
      <a class="code" href="dict_8c.html#ae494e63c2ce90dee35c2abdd940ec8cf">dnode_destroy</a> (<a class="code" href="dict_8c.html#ad51f28cd1829e1fd66caf58f553d794e">dict_delete</a> (lspdb, dnode));
    }

  <a class="code" href="linklist_8c.html#acd6daa4be8ab3f175376e63c9d9c9500">list_delete_all_node</a> (frags);

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3859237ab43b147f4520d060439ca002"></a><!-- doxytag: member="isis_lsp.c::lsp_search" ref="a3859237ab43b147f4520d060439ca002" args="(u_char *id, dict_t *lspdb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structisis__lsp.html">isis_lsp</a>* lsp_search </td>
          <td>(</td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdict__t.html">dict_t</a> *&#160;</td>
          <td class="paramname"><em>lspdb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00083">83</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="structdnode__t.html">dnode_t</a> *node;

<span class="preprocessor">#ifdef EXTREME_DEBUG</span>
<span class="preprocessor"></span>  <a class="code" href="structdnode__t.html">dnode_t</a> *dn;

  <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;searching db&quot;</span>);
  <span class="keywordflow">for</span> (dn = <a class="code" href="dict_8c.html#a2b439ffb63f9b3089d0306ec3b26672f">dict_first</a> (lspdb); dn; dn = <a class="code" href="dict_8c.html#a1f32888c49577ec2b2dc9d16922bf487">dict_next</a> (lspdb, dn))
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s\t%pX&quot;</span>, <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> ((<span class="keywordtype">char</span> *) <a class="code" href="dict_8h.html#a6f2633dde474b0288d6a737651f69a51">dnode_getkey</a> (dn)),
          <a class="code" href="dict_8h.html#a17fccc85aae3874de7152f103d5945bc">dnode_get</a> (dn));
    }
<span class="preprocessor">#endif </span><span class="comment">/* EXTREME DEBUG */</span>

  node = <a class="code" href="dict_8c.html#a9b4c0968674a4ff436bb8180aa56e522">dict_lookup</a> (lspdb, <span class="keywordtype">id</span>);

  <span class="keywordflow">if</span> (node)
    <span class="keywordflow">return</span> (<span class="keyword">struct</span> <a class="code" href="structisis__lsp.html">isis_lsp</a> *) <a class="code" href="dict_8h.html#a17fccc85aae3874de7152f103d5945bc">dnode_get</a> (node);

  <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac9198965904e0c9a57ade0011b114d3f"></a><!-- doxytag: member="isis_lsp.c::lsp_search_and_destroy" ref="ac9198965904e0c9a57ade0011b114d3f" args="(u_char *id, dict_t *lspdb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsp_search_and_destroy </td>
          <td>(</td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdict__t.html">dict_t</a> *&#160;</td>
          <td class="paramname"><em>lspdb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00209">209</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="structdnode__t.html">dnode_t</a> *node;
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;

  node = <a class="code" href="dict_8c.html#a9b4c0968674a4ff436bb8180aa56e522">dict_lookup</a> (lspdb, <span class="keywordtype">id</span>);
  <span class="keywordflow">if</span> (node)
    {
      node = <a class="code" href="dict_8c.html#ad51f28cd1829e1fd66caf58f553d794e">dict_delete</a> (lspdb, node);
      lsp = <a class="code" href="dict_8h.html#a17fccc85aae3874de7152f103d5945bc">dnode_get</a> (node);
      <span class="comment">/*</span>
<span class="comment">       * If this is a zero lsp, remove all the frags now </span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (<a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>) == 0)
    {
      <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#acca312187c5812b70485d18fdc60b986">frags</a>)
        <a class="code" href="isis__lsp_8c.html#a0ae83d454874a8fd54be13230268bee3">lsp_remove_frags</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#acca312187c5812b70485d18fdc60b986">frags</a>, lspdb);
    }
      <span class="keywordflow">else</span>
    {
      <span class="comment">/* </span>
<span class="comment">       * else just remove this frag, from the zero lsps&#39; frag list</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#a3113261380202a14a924c31ca87cdee1">zero_lsp</a> &amp;&amp; lsp-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#a3113261380202a14a924c31ca87cdee1">zero_lsp</a>-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#acca312187c5812b70485d18fdc60b986">frags</a>)
        <a class="code" href="linklist_8c.html#a8cbdaa18db1ceacaadbc457a0c634e02">listnode_delete</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#a3113261380202a14a924c31ca87cdee1">zero_lsp</a>-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#acca312187c5812b70485d18fdc60b986">frags</a>, lsp);
    }
      <a class="code" href="isis__lsp_8c.html#a8910aea25a4f0680a4b4945609aaf97b">lsp_destroy</a> (lsp);
      <a class="code" href="dict_8c.html#ae494e63c2ce90dee35c2abdd940ec8cf">dnode_destroy</a> (node);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4a6da8fd883c32c4986e4d75e9a6f4e4"></a><!-- doxytag: member="isis_lsp.c::lsp_seqnum_update" ref="a4a6da8fd883c32c4986e4d75e9a6f4e4" args="(struct isis_lsp *lsp0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lsp_seqnum_update </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp0</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00327">327</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node;

  <a class="code" href="isis__lsp_8c.html#a95c7b93c607b9aba6b6697b136d9ad98">lsp_inc_seqnum</a> (lsp0, 0);

  <span class="keywordflow">if</span> (!lsp0-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#acca312187c5812b70485d18fdc60b986">frags</a>)
    <span class="keywordflow">return</span>;

  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (lsp0-&gt;<a class="code" href="structisis__lsp.html#aaee1ddd81507d4a129711c6385e32c3e">lspu</a>.<a class="code" href="structisis__lsp.html#acca312187c5812b70485d18fdc60b986">frags</a>, node, lsp))
    <a class="code" href="isis__lsp_8c.html#a95c7b93c607b9aba6b6697b136d9ad98">lsp_inc_seqnum</a> (lsp, 0);

  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6ae8e0acaadc3ea2b9cf07af727cef18"></a><!-- doxytag: member="isis_lsp.c::lsp_set_time" ref="a6ae8e0acaadc3ea2b9cf07af727cef18" args="(struct isis_lsp *lsp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lsp_set_time </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00619">619</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (lsp);

  <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a> == 0)
    {
      <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#aa2d9dce6fceedcb6af88a73f2f5a0616">age_out</a> != 0)
    lsp-&gt;<a class="code" href="structisis__lsp.html#aa2d9dce6fceedcb6af88a73f2f5a0616">age_out</a>--;
      <span class="keywordflow">return</span>;
    }

  <span class="comment">/* If we are turning 0 */</span>
  <span class="comment">/* ISO 10589 - 7.3.16.4 first paragraph */</span>

  <span class="keywordflow">if</span> (ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>) == 1)
    {
      <span class="comment">/* 7.3.16.4 a) set SRM flags on all */</span>
      <a class="code" href="isis__flags_8h.html#a57f45d9b4a8c70c53f796d96e5555fac">ISIS_FLAGS_SET_ALL</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>);
      <span class="comment">/* 7.3.16.4 b) retain only the header FIXME  */</span>
      <span class="comment">/* 7.3.16.4 c) record the time to purge FIXME (other way to do it) */</span>
    }

  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a> =
    htons (ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a21ef956c03ac1cb9f67cbef6faa12052">rem_lifetime</a>) - 1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8987f46b1c21556ff1281a72cce6636a"></a><!-- doxytag: member="isis_lsp.c::lsp_tick" ref="a8987f46b1c21556ff1281a72cce6636a" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsp_tick </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l01982">1982</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__area.html">isis_area</a> *<a class="code" href="ospf__vty_8c.html#a7030c85f46deeffac793079c664c14ce">area</a>;
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;
  <span class="keyword">struct </span><a class="code" href="structisis__lsp.html">isis_lsp</a> *lsp;
  <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *lsp_list;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *lspnode, *cnode;
  <a class="code" href="structdnode__t.html">dnode_t</a> *dnode, *dnode_next;
  <span class="keywordtype">int</span> level;

  lsp_list = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();

  area = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (area);
  area-&gt;<a class="code" href="structisis__area.html#a48fdf6a46c715d962319677fc3a5b183">t_tick</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, area-&gt;<a class="code" href="structisis__area.html#a48fdf6a46c715d962319677fc3a5b183">t_tick</a>, <a class="code" href="isis__lsp_8c.html#a8987f46b1c21556ff1281a72cce6636a">lsp_tick</a>, area, 1);

  <span class="comment">/*</span>
<span class="comment">   * Build a list of LSPs with (any) SRMflag set</span>
<span class="comment">   * and removed the ones that have aged out</span>
<span class="comment">   */</span>
  <span class="keywordflow">for</span> (level = 0; level &lt; <a class="code" href="isis__constants_8h.html#a75b03ae2a0d626c94fe847f7d790f4af">ISIS_LEVELS</a>; level++)
    {
      <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level] &amp;&amp; <a class="code" href="dict_8h.html#a392c768130a1c7ed5a6c2f299cd0d2e8">dict_count</a> (area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level]) &gt; 0)
    {
      dnode = <a class="code" href="dict_8c.html#a2b439ffb63f9b3089d0306ec3b26672f">dict_first</a> (area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level]);
      <span class="keywordflow">while</span> (dnode != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
        {
          dnode_next = <a class="code" href="dict_8c.html#a1f32888c49577ec2b2dc9d16922bf487">dict_next</a> (area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level], dnode);
          lsp = <a class="code" href="dict_8h.html#a17fccc85aae3874de7152f103d5945bc">dnode_get</a> (dnode);
          <a class="code" href="isis__lsp_8c.html#a6ae8e0acaadc3ea2b9cf07af727cef18">lsp_set_time</a> (lsp);
          <span class="keywordflow">if</span> (lsp-&gt;<a class="code" href="structisis__lsp.html#aa2d9dce6fceedcb6af88a73f2f5a0616">age_out</a> == 0)
        {

          <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;ISIS-Upd (%s): L%u LSP %s seq 0x%08x aged out&quot;</span>,
                  area-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>,
                  lsp-&gt;<a class="code" href="structisis__lsp.html#ab719e4479e4fc861c4cfa7a3c9d403c6">level</a>,
                  <a class="code" href="isis__misc_8c.html#a3a0e7f92008e3167e2c09b8761d06766">rawlspid_print</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>),
                  ntohl (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a10657aa355e049b928c9b1cea37bd9d9">seq_num</a>));
<span class="preprocessor">#ifdef TOPOLOGY_GENERATE</span>
<span class="preprocessor"></span>          <span class="keywordflow">if</span> (lsp-&gt;from_topology)
            <a class="code" href="thread_8h.html#ae1dfd3f5f643212148d60a41d9f2192a">THREAD_TIMER_OFF</a> (lsp-&gt;t_lsp_top_ref);
<span class="preprocessor">#endif </span><span class="comment">/* TOPOLOGY_GENERATE */</span>
          <a class="code" href="isis__lsp_8c.html#a8910aea25a4f0680a4b4945609aaf97b">lsp_destroy</a> (lsp);
          <a class="code" href="dict_8c.html#ad51f28cd1829e1fd66caf58f553d794e">dict_delete</a> (area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level], dnode);
        }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="isis__flags_8c.html#aa104abd02ef1ceeb11c8cea01a058796">flags_any_set</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>))
        <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (lsp_list, lsp);
          dnode = dnode_next;
        }

      <span class="comment">/*</span>
<span class="comment">       * Send LSPs on circuits indicated by the SRMflags</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (<a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (lsp_list) &gt; 0)
        {
              <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (area-&gt;<a class="code" href="structisis__area.html#a1ef8753b22245b7d8fff0331deef3b21">circuit_list</a>, cnode, circuit))
        {
                  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (lsp_list, lspnode, lsp))
            {
              <span class="keywordflow">if</span> (<a class="code" href="isis__flags_8h.html#a7d42f17e426ff47043c37733fc3c672d">ISIS_CHECK_FLAG</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a96d155dbf3bbd20256cf7a68c8d9fd20">SRMflags</a>, circuit))
            {
              <span class="comment">/* FIXME: if same or elder lsp is already in lsp</span>
<span class="comment">               * queue */</span>
              <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a3540c30e2a6967daf9f9e1b76b00e2be">lsp_queue</a>, lsp);
              <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="isis__pdu_8c.html#a23b42a7925a367125e6e0fa3db33f597">send_lsp</a>, circuit, 0);
            }
            }
        }
        }
      <a class="code" href="linklist_8c.html#acd6daa4be8ab3f175376e63c9d9c9500">list_delete_all_node</a> (lsp_list);
    }
    }

  <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (lsp_list);

  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a87fb50a6271da943f8910022759b915e"></a><!-- doxytag: member="isis_lsp.c::lsp_tlv_fit" ref="a87fb50a6271da943f8910022759b915e" args="(struct isis_lsp *lsp, struct list **from, struct list **to, int tlvsize, int frag_thold, int tlv_build_func(struct list *, struct stream *))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lsp_tlv_fit </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist.html">list</a> **&#160;</td>
          <td class="paramname"><em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist.html">list</a> **&#160;</td>
          <td class="paramname"><em>to</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tlvsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>frag_thold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &#160;</td>
          <td class="paramname"><em>tlv_build_func</em>struct list *, struct stream *&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00926">926</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a66e3fedede6aa372e5196e55e5e8d5c1">count</a>, <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;

  <span class="comment">/* can we fit all ? */</span>
  <span class="keywordflow">if</span> (!<a class="code" href="isis__lsp_8c.html#acf35e8db3f0edc24594ad5db4e35f4e6">FRAG_NEEDED</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>, frag_thold, <a class="code" href="linklist_8h.html#a0429e6385b31a314cc64432a906201e5">listcount</a> (*from) * tlvsize + 2))
    {
      tlv_build_func (*from, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);
      *to = *from;
      *from = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="isis__lsp_8c.html#acf35e8db3f0edc24594ad5db4e35f4e6">FRAG_NEEDED</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>, frag_thold, tlvsize + 2))
    {
      <span class="comment">/* fit all we can */</span>
      count = <a class="code" href="isis__lsp_8c.html#ad16a88039454fce8d98bf77f09064204">FRAG_THOLD</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>, frag_thold) - 2 -
    (<a class="code" href="stream_8h.html#a6e3b6e25ed5cfa2faea8485414a0c1a4">STREAM_SIZE</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>) - <a class="code" href="stream_8h.html#a4705f0b1797c4f896404ec1549c91017">STREAM_REMAIN</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>));
      <span class="keywordflow">if</span> (count)
    count = count / tlvsize;
      <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="spgrid_8c.html#a66e3fedede6aa372e5196e55e5e8d5c1">count</a>; i++)
    {
      <a class="code" href="linklist_8c.html#adb2a0478aba995441aaf691d1f6fe5db">listnode_add</a> (*to, <a class="code" href="linklist_8h.html#a574f1b7acbcea848771bd5ddc61e430a">listgetdata</a> (<a class="code" href="linklist_8h.html#a3d4492ca03b023aeecd4d6b0cdaa16fb">listhead</a> (*from)));
      <a class="code" href="linklist_8c.html#a8cbdaa18db1ceacaadbc457a0c634e02">listnode_delete</a> (*from, <a class="code" href="linklist_8h.html#a574f1b7acbcea848771bd5ddc61e430a">listgetdata</a> (<a class="code" href="linklist_8h.html#a3d4492ca03b023aeecd4d6b0cdaa16fb">listhead</a> (*from)));
    }
      tlv_build_func (*to, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);
    }
  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a> = htons (<a class="code" href="stream_8c.html#ac1d2c72755840ea194301a5447ff721a">stream_get_endp</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>));
  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad5c26e2f2f08b4a76183ca91ff454ff9"></a><!-- doxytag: member="isis_lsp.c::lsp_update" ref="ad5c26e2f2f08b4a76183ca91ff454ff9" args="(struct isis_lsp *lsp, struct isis_link_state_hdr *lsp_hdr, struct stream *stream, struct isis_area *area, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsp_update </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__link__state__hdr.html">isis_link_state_hdr</a> *&#160;</td>
          <td class="paramname"><em>lsp_hdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structstream.html">stream</a> *&#160;</td>
          <td class="paramname"><em>stream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__area.html">isis_area</a> *&#160;</td>
          <td class="paramname"><em>area</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00420">420</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="structdnode__t.html">dnode_t</a> *dnode = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="comment">/* Remove old LSP from LSP database. */</span>
  dnode = <a class="code" href="dict_8c.html#a9b4c0968674a4ff436bb8180aa56e522">dict_lookup</a> (area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1], lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>);
  <span class="keywordflow">if</span> (dnode)
    <a class="code" href="dict_8c.html#ae494e63c2ce90dee35c2abdd940ec8cf">dnode_destroy</a> (<a class="code" href="dict_8c.html#ad51f28cd1829e1fd66caf58f553d794e">dict_delete</a> (area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1], dnode));

  <span class="comment">/* free the old lsp data */</span>
  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba9a2400fa8e781effd85b44c7c6455855">MTYPE_STREAM_DATA</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>);
  <a class="code" href="isis__lsp_8c.html#aa0d51cf5f190804be9b73b52db69ccd6">lsp_clear_data</a> (lsp);

  <span class="comment">/* rebuild the lsp data */</span>
  <a class="code" href="isis__lsp_8c.html#a917a11f390e10660faa69faa510da442">lsp_update_data</a> (lsp, stream, area);

  <span class="comment">/* set the new values for lsp header */</span>
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>, lsp_hdr, <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>);

  <span class="keywordflow">if</span> (dnode)
    <a class="code" href="isis__lsp_8c.html#a09d8f3bcc073c87f01c32b2f0994fb04">lsp_insert</a> (lsp, area-&gt;<a class="code" href="structisis__area.html#a2e85d570b957a6f8fc47dc4db6fa8f4e">lspdb</a>[level - 1]);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a917a11f390e10660faa69faa510da442"></a><!-- doxytag: member="isis_lsp.c::lsp_update_data" ref="a917a11f390e10660faa69faa510da442" args="(struct isis_lsp *lsp, struct stream *stream, struct isis_area *area)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lsp_update_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__lsp.html">isis_lsp</a> *&#160;</td>
          <td class="paramname"><em>lsp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structstream.html">stream</a> *&#160;</td>
          <td class="paramname"><em>stream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structisis__area.html">isis_area</a> *&#160;</td>
          <td class="paramname"><em>area</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00363">363</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  uint32_t expected = 0, found;
  <span class="keywordtype">int</span> retval;

  <span class="comment">/* copying only the relevant part of our stream */</span>
  lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a> = <a class="code" href="stream_8c.html#ad4c81d1449a5c97aa37c0acb4a5c7815">stream_dup</a> (stream);
  
  <span class="comment">/* setting pointers to the correct place */</span>
  lsp-&gt;<a class="code" href="structisis__lsp.html#a4495af44aa8d877f56b8e7ce00b47344">isis_header</a> = (<span class="keyword">struct </span><a class="code" href="structisis__fixed__hdr.html">isis_fixed_hdr</a> *) (<a class="code" href="stream_8h.html#afde5f5db208a43da6faf7b830f26d7fc">STREAM_DATA</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>));
  lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a> = (<span class="keyword">struct </span><a class="code" href="structisis__link__state__hdr.html">isis_link_state_hdr</a> *) (<a class="code" href="stream_8h.html#afde5f5db208a43da6faf7b830f26d7fc">STREAM_DATA</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>) +
                            <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a>);
  lsp-&gt;<a class="code" href="structisis__lsp.html#aa2d9dce6fceedcb6af88a73f2f5a0616">age_out</a> = <a class="code" href="isis__constants_8h.html#a34e4027fe6ad8e371e370258da82dd23">ZERO_AGE_LIFETIME</a>;
  lsp-&gt;<a class="code" href="structisis__lsp.html#a3170f0dc8ff17017cb0210bd4fc8bd4b">installed</a> = time (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
  <span class="comment">/*</span>
<span class="comment">   * Get LSP data i.e. TLVs</span>
<span class="comment">   */</span>
  expected |= <a class="code" href="isis__tlv_8h.html#a493ed26a4a2decc55275bd699df9a4a8">TLVFLAG_AUTH_INFO</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#ae2a91163530ea4d9bfb3b00394a48316">TLVFLAG_AREA_ADDRS</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#abc2d792062e147ac65de4e8af0ea9f5a">TLVFLAG_IS_NEIGHS</a>;
  <span class="keywordflow">if</span> ((lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a405c4b662dc97846dcca65f5c851f485">lsp_bits</a> &amp; 3) == 3) <span class="comment">/* a level 2 LSP */</span>
    expected |= <a class="code" href="isis__tlv_8h.html#a26d1512ae89c63450b63a01288d455ac">TLVFLAG_PARTITION_DESIG_LEVEL2_IS</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#ac9149da10b98f4211a51249c752b5fee">TLVFLAG_NLPID</a>;
  <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#a633f0592cc19c913d3d18368a8f45cb7">dynhostname</a>)
    expected |= <a class="code" href="isis__tlv_8h.html#af89b5f221b1f5b197ab98b27e5c17aac">TLVFLAG_DYN_HOSTNAME</a>;
  <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#af81e14ff1b34169c5e05c287d7ff5529">newmetric</a>)
    {
      expected |= <a class="code" href="isis__tlv_8h.html#a422846a476846aafef471dd5b7e6220a">TLVFLAG_TE_IS_NEIGHS</a>;
      expected |= <a class="code" href="isis__tlv_8h.html#ade240c15d53a2f0d6836c8bb2320c897">TLVFLAG_TE_IPV4_REACHABILITY</a>;
      expected |= <a class="code" href="isis__tlv_8h.html#a451c9fd30d9a55842ce82211382eefc3">TLVFLAG_TE_ROUTER_ID</a>;
    }
  expected |= <a class="code" href="isis__tlv_8h.html#ac1d5ea73aa3cc33a2c7e4190df6fab00">TLVFLAG_IPV4_ADDR</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#a6983234a86fe907722e0ba97fe5f84d6">TLVFLAG_IPV4_INT_REACHABILITY</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#ac1563adffe169c3354eb377e8962092e">TLVFLAG_IPV4_EXT_REACHABILITY</a>;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  expected |= <a class="code" href="isis__tlv_8h.html#af63af1cfdbe427be867d8191c1ea5b5f">TLVFLAG_IPV6_ADDR</a>;
  expected |= <a class="code" href="isis__tlv_8h.html#a5b97a8d9bd142af3e49f1bdc02cfc3e3">TLVFLAG_IPV6_REACHABILITY</a>;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

  retval = <a class="code" href="isis__tlv_8c.html#aad6fa3b6cc5e93707f75d8247f8787c8">parse_tlvs</a> (area-&gt;<a class="code" href="structisis__area.html#aef5ef529e28214a477a6a7c2fe03c350">area_tag</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a944fd7d5abffb3968b729b4fc1a9e631">pdu</a>-&gt;<a class="code" href="structstream.html#aa204feef08c4dcb72bf774680da7a864">data</a> +
               <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a> + <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>,
               ntohs (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6f17d9f3a17625db25044ff0ff3da330">pdu_len</a>) - <a class="code" href="isis__pdu_8h.html#a61f100919f790014bded41907b477263">ISIS_FIXED_HDR_LEN</a>
               - <a class="code" href="isis__pdu_8h.html#ac44728d163f3b54838fd7e03acf7c3f7">ISIS_LSP_HDR_LEN</a>, &amp;expected, &amp;found, &amp;lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>);

  <span class="keywordflow">if</span> (found &amp; <a class="code" href="isis__tlv_8h.html#af89b5f221b1f5b197ab98b27e5c17aac">TLVFLAG_DYN_HOSTNAME</a>)
    {
      <span class="keywordflow">if</span> (area-&gt;<a class="code" href="structisis__area.html#a633f0592cc19c913d3d18368a8f45cb7">dynhostname</a>)
    <a class="code" href="isis__dynhn_8c.html#ac659e83c583ea0c43ed5ac33dd8708b4">isis_dynhn_insert</a> (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a6e6f2ce4d1b33c3280827272009a5af2">lsp_id</a>, lsp-&gt;<a class="code" href="structisis__lsp.html#a06afb4b2fda4fb75a8f4c6b536f9c42d">tlv_data</a>.<a class="code" href="structtlvs.html#ac2b8abaebfab8d2a55242d83a87a3e70">hostname</a>,
               (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a405c4b662dc97846dcca65f5c851f485">lsp_bits</a> &amp; <a class="code" href="isis__constants_8h.html#a9f40952694b8ae76b12e90808bd81229">LSPBIT_IST</a>) ==
               <a class="code" href="isis__constants_8h.html#a9906fe43cc332e34827b3c233d509da6">IS_LEVEL_1_AND_2</a> ? <a class="code" href="isis__constants_8h.html#a9daa7fbf09b604c718f3bbe189aedd1a">IS_LEVEL_2</a> :
               (lsp-&gt;<a class="code" href="structisis__lsp.html#a3e4328d15b43f9023fee75d60f08aca0">lsp_header</a>-&gt;<a class="code" href="structisis__link__state__hdr.html#a405c4b662dc97846dcca65f5c851f485">lsp_bits</a> &amp; <a class="code" href="isis__constants_8h.html#a9f40952694b8ae76b12e90808bd81229">LSPBIT_IST</a>));
    }

}
</pre></div>
</div>
</div>
<a class="anchor" id="a5838ff5c762c49738cc88e9887fcb9fa"></a><!-- doxytag: member="isis_lsp.c::lspid_print" ref="a5838ff5c762c49738cc88e9887fcb9fa" args="(u_char *lsp_id, u_char *trg, char dynhost, char frag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lspid_print </td>
          <td>(</td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>lsp_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>trg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>dynhost</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>frag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00646">646</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__dynhn.html">isis_dynhn</a> *dyn = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  u_char <span class="keywordtype">id</span>[<a class="code" href="isis__constants_8h.html#a68fe11cf734084dc335297de2f207eb1">SYSID_STRLEN</a>];

  <span class="keywordflow">if</span> (dynhost)
    dyn = <a class="code" href="isis__dynhn_8c.html#af341024c92c783b9493cc98f7f04ec28">dynhn_find_by_id</a> (<a class="code" href="isis__pdu_8h.html#a2991a019d1da82fb5406bff5ab46dcf6">lsp_id</a>);
  <span class="keywordflow">else</span>
    dyn = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (dyn)
    sprintf ((<span class="keywordtype">char</span> *)<span class="keywordtype">id</span>, <span class="stringliteral">&quot;%.14s&quot;</span>, dyn-&gt;<a class="code" href="structisis__dynhn.html#a96fbe0fb7c4de340a9ed9f191859ac34">name</a>.<a class="code" href="structhostname.html#a0a14b55c4a1b6d672adfaa81b95936f3">name</a>);
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__pdu_8h.html#a2991a019d1da82fb5406bff5ab46dcf6">lsp_id</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>) &amp; dynhost)
    sprintf ((<span class="keywordtype">char</span> *)<span class="keywordtype">id</span>, <span class="stringliteral">&quot;%.14s&quot;</span>, <a class="code" href="isis__misc_8c.html#a5fc76e0c3f105d5a4ff9a9396e0fdbd7">unix_hostname</a> ());
  <span class="keywordflow">else</span>
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (<span class="keywordtype">id</span>, <a class="code" href="isis__misc_8c.html#aabccf63144f92eecd0eb77f24ee98529">sysid_print</a> (<a class="code" href="isis__pdu_8h.html#a2991a019d1da82fb5406bff5ab46dcf6">lsp_id</a>), 15);
    }
  <span class="keywordflow">if</span> (frag)
    sprintf ((<span class="keywordtype">char</span> *)trg, <span class="stringliteral">&quot;%s.%02x-%02x&quot;</span>, <span class="keywordtype">id</span>, <a class="code" href="isis__lsp_8h.html#a15ad7ce72dee875930a28bec035f7b71">LSP_PSEUDO_ID</a> (<a class="code" href="isis__pdu_8h.html#a2991a019d1da82fb5406bff5ab46dcf6">lsp_id</a>),
         <a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (<a class="code" href="isis__pdu_8h.html#a2991a019d1da82fb5406bff5ab46dcf6">lsp_id</a>));
  <span class="keywordflow">else</span>
    sprintf ((<span class="keywordtype">char</span> *)trg, <span class="stringliteral">&quot;%s.%02x&quot;</span>, <span class="keywordtype">id</span>, <a class="code" href="isis__lsp_8h.html#a15ad7ce72dee875930a28bec035f7b71">LSP_PSEUDO_ID</a> (<a class="code" href="isis__pdu_8h.html#a2991a019d1da82fb5406bff5ab46dcf6">lsp_id</a>));
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="aa8cfdc8f7777fd242bd2c45f3a48b950"></a><!-- doxytag: member="isis_lsp.c::isis" ref="aa8cfdc8f7777fd242bd2c45f3a48b950" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structisis.html">isis</a>* <a class="el" href="structisis.html">isis</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isisd_8c_source.html#l00061">61</a> of file <a class="el" href="isisd_8c_source.html">isisd.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad3fb467068fe650f05f2e15b29a6cdf3"></a><!-- doxytag: member="isis_lsp.c::lsp_bits_string" ref="ad3fb467068fe650f05f2e15b29a6cdf3" args="[200]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="isis__lsp_8c.html#ad3fb467068fe650f05f2e15b29a6cdf3">lsp_bits_string</a>[200]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__lsp_8c_source.html#l00064">64</a> of file <a class="el" href="isis__lsp_8c_source.html">isis_lsp.c</a>.</p>

</div>
</div>
<a class="anchor" id="af7f9077bc08df049beb65a1c09cde5fa"></a><!-- doxytag: member="isis_lsp.c::master" ref="af7f9077bc08df049beb65a1c09cde5fa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structthread__master.html">thread_master</a>* <a class="el" href="test__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__main_8c_source.html#l00105">105</a> of file <a class="el" href="bgp__main_8c_source.html">bgp_main.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5ff73fe88ce576fe7fc3877984367add"></a><!-- doxytag: member="isis_lsp.c::router_id_zebra" ref="a5ff73fe88ce576fe7fc3877984367add" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct in_addr <a class="el" href="ospfd_8c.html#a5ff73fe88ce576fe7fc3877984367add">router_id_zebra</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__zebra_8c_source.html#l00043">43</a> of file <a class="el" href="bgp__zebra_8c_source.html">bgp_zebra.c</a>.</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="isis__lsp_8c.html">isis_lsp.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:20 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
