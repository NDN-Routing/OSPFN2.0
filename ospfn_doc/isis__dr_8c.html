<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: isisd/isis_dr.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('isis__dr_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">isisd/isis_dr.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="zebra_8h_source.html">zebra.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="hash_8h_source.html">hash.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="thread_8h_source.html">thread.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linklist_8h_source.html">linklist.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vty_8h_source.html">vty.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stream_8h_source.html">stream.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="if_8h_source.html">if.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="dict_8h_source.html">isisd/dict.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__constants_8h_source.html">isisd/isis_constants.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__common_8h_source.html">isisd/isis_common.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__misc_8h_source.html">isisd/isis_misc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__flags_8h_source.html">isisd/isis_flags.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__circuit_8h_source.html">isisd/isis_circuit.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isisd_8h_source.html">isisd/isisd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__adjacency_8h_source.html">isisd/isis_adjacency.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__pdu_8h_source.html">isisd/isis_pdu.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__tlv_8h_source.html">isisd/isis_tlv.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__lsp_8h_source.html">isisd/isis_lsp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__dr_8h_source.html">isisd/isis_dr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="isis__events_8h_source.html">isisd/isis_events.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for isis_dr.c:</div>
<div class="dyncontent">
<div class="center"><img src="isis__dr_8c__incl.png" border="0" usemap="#isisd_2isis__dr_8c" alt=""/></div>
<map name="isisd_2isis__dr_8c" id="isisd_2isis__dr_8c">
<area shape="rect" id="node3" href="zebra_8h.html" title="zebra.h" alt="" coords="1345,80,1412,107"/><area shape="rect" id="node61" href="log_8h.html" title="log.h" alt="" coords="2798,155,2849,181"/><area shape="rect" id="node64" href="hash_8h.html" title="hash.h" alt="" coords="2735,80,2796,107"/><area shape="rect" id="node66" href="thread_8h.html" title="thread.h" alt="" coords="2875,155,2947,181"/><area shape="rect" id="node68" href="linklist_8h.html" title="linklist.h" alt="" coords="3026,155,3096,181"/><area shape="rect" id="node70" href="vty_8h.html" title="vty.h" alt="" coords="2821,80,2872,107"/><area shape="rect" id="node74" href="stream_8h.html" title="stream.h" alt="" coords="2999,80,3073,107"/><area shape="rect" id="node76" href="if_8h.html" title="if.h" alt="" coords="3097,80,3137,107"/><area shape="rect" id="node79" href="dict_8h.html" title="isisd/dict.h" alt="" coords="3162,80,3248,107"/><area shape="rect" id="node81" href="isis__constants_8h.html" title="isisd/isis_constants.h" alt="" coords="3273,80,3423,107"/><area shape="rect" id="node83" href="isis__common_8h.html" title="isisd/isis_common.h" alt="" coords="3447,80,3589,107"/><area shape="rect" id="node85" href="isis__misc_8h.html" title="isisd/isis_misc.h" alt="" coords="3614,80,3732,107"/><area shape="rect" id="node87" href="isis__flags_8h.html" title="isisd/isis_flags.h" alt="" coords="3757,80,3877,107"/><area shape="rect" id="node89" href="isis__circuit_8h.html" title="isisd/isis_circuit.h" alt="" coords="3902,80,4028,107"/><area shape="rect" id="node91" href="isisd_8h.html" title="isisd/isisd.h" alt="" coords="4053,80,4144,107"/><area shape="rect" id="node93" href="isis__adjacency_8h.html" title="isisd/isis_adjacency.h" alt="" coords="4169,80,4321,107"/><area shape="rect" id="node95" href="isis__pdu_8h.html" title="isisd/isis_pdu.h" alt="" coords="4347,80,4461,107"/><area shape="rect" id="node97" href="isis__tlv_8h.html" title="isisd/isis_tlv.h" alt="" coords="4485,80,4592,107"/><area shape="rect" id="node99" href="isis__lsp_8h.html" title="isisd/isis_lsp.h" alt="" coords="4616,80,4725,107"/><area shape="rect" id="node101" href="isis__dr_8h.html" title="isisd/isis_dr.h" alt="" coords="4750,80,4852,107"/><area shape="rect" id="node103" href="isis__events_8h.html" title="isisd/isis_events.h" alt="" coords="4877,80,5011,107"/><area shape="rect" id="node57" href="zassert_8h.html" title="zassert.h" alt="" coords="2623,155,2700,181"/><area shape="rect" id="node59" href="str_8h.html" title="str.h" alt="" coords="2725,155,2773,181"/></map>
</div>
</div>
<p><a href="isis__dr_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__dr_8c.html#a51910550260e5b283dae222e0594a388">isis_disflag2string</a> (int disflag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__dr_8c.html#ae35c5d9be60cd5f01bcbe0bb6e79654e">isis_run_dr_l1</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__dr_8c.html#a858591bc68bc249bd3a775e8f9ca2694">isis_run_dr_l2</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__dr_8c.html#a7f4a979b0121c913a0b9e638222ab040">isis_check_dr_change</a> (struct <a class="el" href="structisis__adjacency.html">isis_adjacency</a> *adj, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__dr_8c.html#a35798a245595794b3cb07a6561e0499a">isis_dr_elect</a> (struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__dr_8c.html#a470e60e885b30a288523b1a44e45ac86">isis_dr_resign</a> (struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, int level)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__dr_8c.html#a5ddd23590e4a94dc6af7efb3da821d9e">isis_dr_commence</a> (struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *circuit, int level)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structisis.html">isis</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__dr_8c.html#aa8cfdc8f7777fd242bd2c45f3a48b950">isis</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structthread__master.html">thread_master</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="isis__dr_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a7f4a979b0121c913a0b9e638222ab040"></a><!-- doxytag: member="isis_dr.c::isis_check_dr_change" ref="a7f4a979b0121c913a0b9e638222ab040" args="(struct isis_adjacency *adj, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int isis_check_dr_change </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__adjacency.html">isis_adjacency</a> *&#160;</td>
          <td class="paramname"><em>adj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__dr_8c_source.html#l00107">107</a> of file <a class="el" href="isis__dr_8c_source.html">isis_dr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> <a class="code" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a>;

  <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a76bf3ed808e66f1047d7a2a698683db2">dis_record</a>[level - 1].<a class="code" href="structisis__dis__record.html#ae53530d9ceb39ce5604d82c3b5f0da1b">dis</a> !=
      adj-&gt;<a class="code" href="structisis__adjacency.html#a76bf3ed808e66f1047d7a2a698683db2">dis_record</a>[(1 * <a class="code" href="isis__constants_8h.html#a75b03ae2a0d626c94fe847f7d790f4af">ISIS_LEVELS</a>) + level - 1].<a class="code" href="structisis__dis__record.html#ae53530d9ceb39ce5604d82c3b5f0da1b">dis</a>)
    <span class="comment">/* was there a DIS state transition ? */</span>
    {
      adj-&gt;<a class="code" href="structisis__adjacency.html#ac4f9613019f220d78cafe905dfed9174">dischanges</a>[level - 1]++;
      <span class="comment">/* ok rotate the history list through */</span>
      <span class="keywordflow">for</span> (i = <a class="code" href="isis__adjacency_8h.html#abdf07e3225e7dc499ba5a20c42a77eba">DIS_RECORDS</a> - 1; i &gt; 0; i--)
    {
      adj-&gt;<a class="code" href="structisis__adjacency.html#a76bf3ed808e66f1047d7a2a698683db2">dis_record</a>[(i * <a class="code" href="isis__constants_8h.html#a75b03ae2a0d626c94fe847f7d790f4af">ISIS_LEVELS</a>) + level - 1].dis =
        adj-&gt;<a class="code" href="structisis__adjacency.html#a76bf3ed808e66f1047d7a2a698683db2">dis_record</a>[((i - 1) * <a class="code" href="isis__constants_8h.html#a75b03ae2a0d626c94fe847f7d790f4af">ISIS_LEVELS</a>) + level - 1].dis;
      adj-&gt;<a class="code" href="structisis__adjacency.html#a76bf3ed808e66f1047d7a2a698683db2">dis_record</a>[(i * <a class="code" href="isis__constants_8h.html#a75b03ae2a0d626c94fe847f7d790f4af">ISIS_LEVELS</a>) + level - 1].last_dis_change =
        adj-&gt;<a class="code" href="structisis__adjacency.html#a76bf3ed808e66f1047d7a2a698683db2">dis_record</a>[((i - 1) * <a class="code" href="isis__constants_8h.html#a75b03ae2a0d626c94fe847f7d790f4af">ISIS_LEVELS</a>) + level -
                1].last_dis_change;
    }
    }
  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a51910550260e5b283dae222e0594a388"></a><!-- doxytag: member="isis_dr.c::isis_disflag2string" ref="a51910550260e5b283dae222e0594a388" args="(int disflag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* isis_disflag2string </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>disflag</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__dr_8c_source.html#l00054">54</a> of file <a class="el" href="isis__dr_8c_source.html">isis_dr.c</a>.</p>
<div class="fragment"><pre class="fragment">{

  <span class="keywordflow">switch</span> (disflag)
    {
    <span class="keywordflow">case</span> <a class="code" href="isis__dr_8h.html#a411da867a1e3279a6ff0d1624b9ab05fa8f3807ff92528663fb9ef47af6e514d9">ISIS_IS_NOT_DIS</a>:
      <span class="keywordflow">return</span> <span class="stringliteral">&quot;is not DIS&quot;</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__dr_8h.html#a411da867a1e3279a6ff0d1624b9ab05fa971f7814bbbbb88e9186770d1ef77ae2">ISIS_IS_DIS</a>:
      <span class="keywordflow">return</span> <span class="stringliteral">&quot;is DIS&quot;</span>;
    <span class="keywordflow">case</span> <a class="code" href="isis__dr_8h.html#a411da867a1e3279a6ff0d1624b9ab05fa0e983b773f32d44bf78d9e82d7422430">ISIS_WAS_DIS</a>:
      <span class="keywordflow">return</span> <span class="stringliteral">&quot;was DIS&quot;</span>;
    <span class="keywordflow">default</span>:
      <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown DIS state&quot;</span>;
    }
  <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;          <span class="comment">/* not reached */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5ddd23590e4a94dc6af7efb3da821d9e"></a><!-- doxytag: member="isis_dr.c::isis_dr_commence" ref="a5ddd23590e4a94dc6af7efb3da821d9e" args="(struct isis_circuit *circuit, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int isis_dr_commence </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__dr_8c_source.html#l00306">306</a> of file <a class="el" href="isis__dr_8c_source.html">isis_dr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  u_char old_dr[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2];

  <span class="keywordflow">if</span> (<a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a6e64127e274c1aa6a52cb0f4b541dfaa">debugs</a> &amp; <a class="code" href="isisd_8h.html#a133d8993848d3fa2c41270511f133eb7">DEBUG_EVENTS</a>)
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;isis_dr_commence l%d&quot;</span>, level);

  <span class="comment">/* Lets keep a pause in DR election */</span>
  circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0766cf32585b89b427a69cd8ad1c22fb">run_dr_elect</a>[level - 1] = 0;
  <span class="keywordflow">if</span> (level == 1)
    <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0eff61cf3ddb83196c960a96ce7f8242">t_run_dr</a>[0], <a class="code" href="isis__dr_8c.html#ae35c5d9be60cd5f01bcbe0bb6e79654e">isis_run_dr_l1</a>,
             circuit, 2 * circuit-&gt;<a class="code" href="structisis__circuit.html#a7edd39f2abe11ecbbd758dc1a0d3f8c0">hello_interval</a>[0]);
  <span class="keywordflow">else</span>
    <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0eff61cf3ddb83196c960a96ce7f8242">t_run_dr</a>[1], <a class="code" href="isis__dr_8c.html#a858591bc68bc249bd3a775e8f9ca2694">isis_run_dr_l2</a>,
             circuit, 2 * circuit-&gt;<a class="code" href="structisis__circuit.html#a7edd39f2abe11ecbbd758dc1a0d3f8c0">hello_interval</a>[1]);
  circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#adb24376d01beb41cab0ed0c49c3a214c">is_dr</a>[level - 1] = 1;

  <span class="keywordflow">if</span> (level == 1)
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (old_dr, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a015b72bf5854d99b722f9f599b9eb158">l1_desig_is</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);
      <a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (old_dr) = 0;
      <span class="keywordflow">if</span> (<a class="code" href="isis__lsp_8h.html#a15ad7ce72dee875930a28bec035f7b71">LSP_PSEUDO_ID</a> (old_dr))
    {
      <span class="comment">/* there was a dr elected, purge its LSPs from the db */</span>
      <a class="code" href="isis__lsp_8c.html#a326bd66d63f17cf92421e5df0d29fe32">lsp_purge_dr</a> (old_dr, circuit, level);
    }
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a015b72bf5854d99b722f9f599b9eb158">l1_desig_is</a>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
      *(circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a015b72bf5854d99b722f9f599b9eb158">l1_desig_is</a> + <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>) = circuit-&gt;<a class="code" href="structisis__circuit.html#a10453f6bcc1e8f1cb466240a81836ba9">circuit_id</a>;

      <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a10453f6bcc1e8f1cb466240a81836ba9">circuit_id</a>); <span class="comment">/* must be non-zero */</span>
      <span class="comment">/*    if (circuit-&gt;t_send_l1_psnp)</span>
<span class="comment">         thread_cancel (circuit-&gt;t_send_l1_psnp); */</span>
      <a class="code" href="isis__lsp_8c.html#ad3a3875129a37eb5a3df3eaf3fcd49a1">lsp_l1_pseudo_generate</a> (circuit);

      <a class="code" href="thread_8h.html#ae1dfd3f5f643212148d60a41d9f2192a">THREAD_TIMER_OFF</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0eff61cf3ddb83196c960a96ce7f8242">t_run_dr</a>[0]);
      <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0eff61cf3ddb83196c960a96ce7f8242">t_run_dr</a>[0], <a class="code" href="isis__dr_8c.html#ae35c5d9be60cd5f01bcbe0bb6e79654e">isis_run_dr_l1</a>,
               circuit, 2 * circuit-&gt;<a class="code" href="structisis__circuit.html#a7edd39f2abe11ecbbd758dc1a0d3f8c0">hello_interval</a>[0]);

      <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#afb1b17f21dd3115002016a0b3d9116cb">t_send_csnp</a>[0], <a class="code" href="isis__pdu_8c.html#ab5830fef07f627c56ba857e36b108bac">send_l1_csnp</a>, circuit,
               <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a1b3a587132c475f3b90b5f8b03ec182d">csnp_interval</a>[level - 1],
                    <a class="code" href="isis__constants_8h.html#a5bd43220bafd834e4710deaea471541b">CSNP_JITTER</a>));

    }
  <span class="keywordflow">else</span>
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (old_dr, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a2bde5462284eb2b294ed998fb5907de8">l2_desig_is</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);
      <a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (old_dr) = 0;
      <span class="keywordflow">if</span> (<a class="code" href="isis__lsp_8h.html#a15ad7ce72dee875930a28bec035f7b71">LSP_PSEUDO_ID</a> (old_dr))
    {
      <span class="comment">/* there was a dr elected, purge its LSPs from the db */</span>
      <a class="code" href="isis__lsp_8c.html#a326bd66d63f17cf92421e5df0d29fe32">lsp_purge_dr</a> (old_dr, circuit, level);
    }
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a2bde5462284eb2b294ed998fb5907de8">l2_desig_is</a>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
      *(circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a2bde5462284eb2b294ed998fb5907de8">l2_desig_is</a> + <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>) = circuit-&gt;<a class="code" href="structisis__circuit.html#a10453f6bcc1e8f1cb466240a81836ba9">circuit_id</a>;

      <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a10453f6bcc1e8f1cb466240a81836ba9">circuit_id</a>); <span class="comment">/* must be non-zero */</span>
      <span class="comment">/*    if (circuit-&gt;t_send_l1_psnp)</span>
<span class="comment">         thread_cancel (circuit-&gt;t_send_l1_psnp); */</span>
      <a class="code" href="isis__lsp_8c.html#a934808749ecec8173e1ba46880c80bd6">lsp_l2_pseudo_generate</a> (circuit);

      <a class="code" href="thread_8h.html#ae1dfd3f5f643212148d60a41d9f2192a">THREAD_TIMER_OFF</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0eff61cf3ddb83196c960a96ce7f8242">t_run_dr</a>[1]);
      <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0eff61cf3ddb83196c960a96ce7f8242">t_run_dr</a>[1], <a class="code" href="isis__dr_8c.html#a858591bc68bc249bd3a775e8f9ca2694">isis_run_dr_l2</a>,
               circuit, 2 * circuit-&gt;<a class="code" href="structisis__circuit.html#a7edd39f2abe11ecbbd758dc1a0d3f8c0">hello_interval</a>[1]);

      <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#afb1b17f21dd3115002016a0b3d9116cb">t_send_csnp</a>[1], <a class="code" href="isis__pdu_8c.html#a2a1bbd2f0b090ddcd6d6e87a7c352ca3">send_l2_csnp</a>, circuit,
               <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a1b3a587132c475f3b90b5f8b03ec182d">csnp_interval</a>[level - 1],
                    <a class="code" href="isis__constants_8h.html#a5bd43220bafd834e4710deaea471541b">CSNP_JITTER</a>));
    }

  <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="isis__events_8c.html#aa449cea2358b48018e359f93e4909864">isis_event_dis_status_change</a>, circuit, 0);

  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a35798a245595794b3cb07a6561e0499a"></a><!-- doxytag: member="isis_dr.c::isis_dr_elect" ref="a35798a245595794b3cb07a6561e0499a" args="(struct isis_circuit *circuit, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int isis_dr_elect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__dr_8c_source.html#l00130">130</a> of file <a class="el" href="isis__dr_8c_source.html">isis_dr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *adjdb;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node;
  <span class="keyword">struct </span><a class="code" href="structisis__adjacency.html">isis_adjacency</a> *adj, *adj_dr = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *<a class="code" href="structlist.html">list</a> = <a class="code" href="linklist_8c.html#af156f4ae343ef4a625f75b6c38845aef">list_new</a> ();
  u_char own_prio;
  <span class="keywordtype">int</span> biggest_prio = -1;
  <span class="keywordtype">int</span> cmp_res, retval = <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;

  own_prio = circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a9087f16298d7bbf26ac8b480c932ab8d">priority</a>[level - 1];
  adjdb = circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ada9bf2584373a37aed06b2e4c9e796f9">adjdb</a>[level - 1];

  <span class="keywordflow">if</span> (!adjdb)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;isis_dr_elect() adjdb == NULL&quot;</span>);
      retval = <a class="code" href="isis__constants_8h.html#a58479855936d63f1609867e2732ccb09">ISIS_WARNING</a>;
      <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (list);
      <span class="keywordflow">goto</span> out;
    }
  <a class="code" href="isis__adjacency_8c.html#abcdb7608e2eb77b6e5f5bcc273c7c265">isis_adj_build_up_list</a> (adjdb, list);

  <span class="comment">/*</span>
<span class="comment">   * Loop the adjacencies and find the one with the biggest priority</span>
<span class="comment">   */</span>
  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (list, node, adj))
    {
      <span class="comment">/* clear flag for show output */</span>
      adj-&gt;<a class="code" href="structisis__adjacency.html#a76bf3ed808e66f1047d7a2a698683db2">dis_record</a>[level - 1].<a class="code" href="structisis__dis__record.html#ae53530d9ceb39ce5604d82c3b5f0da1b">dis</a> = <a class="code" href="isis__dr_8h.html#a411da867a1e3279a6ff0d1624b9ab05fa8f3807ff92528663fb9ef47af6e514d9">ISIS_IS_NOT_DIS</a>;
      adj-&gt;<a class="code" href="structisis__adjacency.html#a76bf3ed808e66f1047d7a2a698683db2">dis_record</a>[level - 1].<a class="code" href="structisis__dis__record.html#aff64ee2b1428106bb95c07e3387dd5f4">last_dis_change</a> = time (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);

      <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a4eca92e54cf0d683720479515d044d1c">prio</a>[level - 1] &gt; biggest_prio)
    {
      biggest_prio = adj-&gt;<a class="code" href="structisis__adjacency.html#a4eca92e54cf0d683720479515d044d1c">prio</a>[level - 1];
      adj_dr = adj;
    }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (adj-&gt;<a class="code" href="structisis__adjacency.html#a4eca92e54cf0d683720479515d044d1c">prio</a>[level - 1] == biggest_prio)
    {
      <span class="comment">/*</span>
<span class="comment">       * Comparison of MACs breaks a tie</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (adj_dr)
        {
          cmp_res = <a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (adj_dr-&gt;<a class="code" href="structisis__adjacency.html#afe4ac3bbff30ac7c5a0da09b05bf9ac0">snpa</a>, adj-&gt;<a class="code" href="structisis__adjacency.html#afe4ac3bbff30ac7c5a0da09b05bf9ac0">snpa</a>, <a class="code" href="isis__constants_8h.html#a9822d89774e0d6ddaa06503950130423">ETH_ALEN</a>);
          <span class="keywordflow">if</span> (cmp_res &lt; 0)
        {
          adj_dr = adj;
        }
          <span class="keywordflow">if</span> (cmp_res == 0)
        <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a>
          (<span class="stringliteral">&quot;isis_dr_elect(): multiple adjacencies with same SNPA&quot;</span>);
        }
      <span class="keywordflow">else</span>
        {
          adj_dr = adj;
        }
    }
    }

  <span class="keywordflow">if</span> (!adj_dr)
    {
      <span class="comment">/*</span>
<span class="comment">       * Could not find the DR - means we are alone and thus the DR</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (!circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#adb24376d01beb41cab0ed0c49c3a214c">is_dr</a>[level - 1])
    {
      <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (list);
      list = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
      <span class="keywordflow">return</span> <a class="code" href="isis__dr_8c.html#a5ddd23590e4a94dc6af7efb3da821d9e">isis_dr_commence</a> (circuit, level);
    }
      <span class="keywordflow">goto</span> out;
    }

  <span class="comment">/*</span>
<span class="comment">   * Now we have the DR adjacency, compare it to self</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (adj_dr-&gt;<a class="code" href="structisis__adjacency.html#a4eca92e54cf0d683720479515d044d1c">prio</a>[level - 1] &lt; own_prio
      || (adj_dr-&gt;<a class="code" href="structisis__adjacency.html#a4eca92e54cf0d683720479515d044d1c">prio</a>[level - 1] == own_prio
      &amp;&amp; <a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (adj_dr-&gt;<a class="code" href="structisis__adjacency.html#afe4ac3bbff30ac7c5a0da09b05bf9ac0">snpa</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#ac7adabf9b24b03c93e73bb9b03c2192b">snpa</a>, <a class="code" href="isis__constants_8h.html#a9822d89774e0d6ddaa06503950130423">ETH_ALEN</a>) &lt; 0))
    {
      <span class="keywordflow">if</span> (!circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#adb24376d01beb41cab0ed0c49c3a214c">is_dr</a>[level - 1])
    {
      <span class="comment">/*</span>
<span class="comment">       * We are the DR</span>
<span class="comment">       */</span>

      <span class="comment">/* rotate the history log */</span>
      <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (list, node, adj))
            <a class="code" href="isis__dr_8c.html#a7f4a979b0121c913a0b9e638222ab040">isis_check_dr_change</a> (adj, level);

      <span class="comment">/* commence */</span>
      <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (list);
      <span class="keywordflow">return</span> <a class="code" href="isis__dr_8c.html#a5ddd23590e4a94dc6af7efb3da821d9e">isis_dr_commence</a> (circuit, level);
    }
    }
  <span class="keywordflow">else</span>
    {

      <span class="comment">/* ok we have found the DIS - lets mark the adjacency */</span>
      <span class="comment">/* set flag for show output */</span>
      adj_dr-&gt;<a class="code" href="structisis__adjacency.html#a76bf3ed808e66f1047d7a2a698683db2">dis_record</a>[level - 1].<a class="code" href="structisis__dis__record.html#ae53530d9ceb39ce5604d82c3b5f0da1b">dis</a> = <a class="code" href="isis__dr_8h.html#a411da867a1e3279a6ff0d1624b9ab05fa971f7814bbbbb88e9186770d1ef77ae2">ISIS_IS_DIS</a>;
      adj_dr-&gt;<a class="code" href="structisis__adjacency.html#a76bf3ed808e66f1047d7a2a698683db2">dis_record</a>[level - 1].<a class="code" href="structisis__dis__record.html#aff64ee2b1428106bb95c07e3387dd5f4">last_dis_change</a> = time (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);

      <span class="comment">/* now loop through a second time to check if there has been a DIS change</span>
<span class="comment">       * if yes rotate the history log</span>
<span class="comment">       */</span>

      <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a80a3f4035be83abbb709d17412993226">ALL_LIST_ELEMENTS_RO</a> (list, node, adj))
        <a class="code" href="isis__dr_8c.html#a7f4a979b0121c913a0b9e638222ab040">isis_check_dr_change</a> (adj, level);

      <span class="comment">/*</span>
<span class="comment">       * We are not DR - if we were -&gt; resign</span>
<span class="comment">       */</span>

      <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#adb24376d01beb41cab0ed0c49c3a214c">is_dr</a>[level - 1])
    {
      <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (list);
      <span class="keywordflow">return</span> <a class="code" href="isis__dr_8c.html#a470e60e885b30a288523b1a44e45ac86">isis_dr_resign</a> (circuit, level);
    }
    }
out:
  <span class="keywordflow">if</span> (list)
    <a class="code" href="linklist_8c.html#ab5fdf1a904264be077ce19a432b1b119">list_delete</a> (list);
  <span class="keywordflow">return</span> retval;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a470e60e885b30a288523b1a44e45ac86"></a><!-- doxytag: member="isis_dr.c::isis_dr_resign" ref="a470e60e885b30a288523b1a44e45ac86" args="(struct isis_circuit *circuit, int level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int isis_dr_resign </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structisis__circuit.html">isis_circuit</a> *&#160;</td>
          <td class="paramname"><em>circuit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__dr_8c_source.html#l00257">257</a> of file <a class="el" href="isis__dr_8c_source.html">isis_dr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  u_char <span class="keywordtype">id</span>[<a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 2];

  <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;isis_dr_resign l%d&quot;</span>, level);

  circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#adb24376d01beb41cab0ed0c49c3a214c">is_dr</a>[level - 1] = 0;
  circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0766cf32585b89b427a69cd8ad1c22fb">run_dr_elect</a>[level - 1] = 0;
  <a class="code" href="thread_8h.html#ae1dfd3f5f643212148d60a41d9f2192a">THREAD_TIMER_OFF</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0eff61cf3ddb83196c960a96ce7f8242">t_run_dr</a>[level - 1]);
  <a class="code" href="thread_8h.html#ae1dfd3f5f643212148d60a41d9f2192a">THREAD_TIMER_OFF</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#afbf6ada19d1fda134ede0986124680ac">t_refresh_pseudo_lsp</a>[level - 1]);

  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (<span class="keywordtype">id</span>, <a class="code" href="structisis.html">isis</a>-&gt;<a class="code" href="structisis.html#a769d4d051a0f424e8c0568b4eeef748e">sysid</a>, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a>);
  <a class="code" href="isis__lsp_8h.html#a15ad7ce72dee875930a28bec035f7b71">LSP_PSEUDO_ID</a> (<span class="keywordtype">id</span>) = circuit-&gt;<a class="code" href="structisis__circuit.html#a10453f6bcc1e8f1cb466240a81836ba9">circuit_id</a>;
  <a class="code" href="isis__lsp_8h.html#a3d17e3f51a6b45aa8a777ec4b9ec3100">LSP_FRAGMENT</a> (<span class="keywordtype">id</span>) = 0;
  <a class="code" href="isis__lsp_8c.html#a326bd66d63f17cf92421e5df0d29fe32">lsp_purge_dr</a> (<span class="keywordtype">id</span>, circuit, level);

  <span class="keywordflow">if</span> (level == 1)
    {
      memset (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a015b72bf5854d99b722f9f599b9eb158">l1_desig_is</a>, 0, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);

      <a class="code" href="thread_8h.html#ae1dfd3f5f643212148d60a41d9f2192a">THREAD_TIMER_OFF</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#afb1b17f21dd3115002016a0b3d9116cb">t_send_csnp</a>[0]);

      <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0eff61cf3ddb83196c960a96ce7f8242">t_run_dr</a>[0], <a class="code" href="isis__dr_8c.html#ae35c5d9be60cd5f01bcbe0bb6e79654e">isis_run_dr_l1</a>,
               circuit, 2 * circuit-&gt;<a class="code" href="structisis__circuit.html#a7edd39f2abe11ecbbd758dc1a0d3f8c0">hello_interval</a>[0]);

      <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a3ad206840c48b3ff93d5160f5a402e2e">t_send_psnp</a>[0], <a class="code" href="isis__pdu_8c.html#a001cd2fbdf45b46870187e20b3cc7efc">send_l1_psnp</a>, circuit,
               <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#ab73d895f1c1588eb68e5b467f7f1b479">psnp_interval</a>[level - 1],
                    <a class="code" href="isis__constants_8h.html#a8ebe0205326ccb2592f752237c21729b">PSNP_JITTER</a>));
    }
  <span class="keywordflow">else</span>
    {
      memset (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a2bde5462284eb2b294ed998fb5907de8">l2_desig_is</a>, 0, <a class="code" href="isis__constants_8h.html#aeda8abfdcc24dfb0ab327ea79ce453fc">ISIS_SYS_ID_LEN</a> + 1);

      <a class="code" href="thread_8h.html#ae1dfd3f5f643212148d60a41d9f2192a">THREAD_TIMER_OFF</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#afb1b17f21dd3115002016a0b3d9116cb">t_send_csnp</a>[1]);

      <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0eff61cf3ddb83196c960a96ce7f8242">t_run_dr</a>[1], <a class="code" href="isis__dr_8c.html#a858591bc68bc249bd3a775e8f9ca2694">isis_run_dr_l2</a>,
               circuit, 2 * circuit-&gt;<a class="code" href="structisis__circuit.html#a7edd39f2abe11ecbbd758dc1a0d3f8c0">hello_interval</a>[1]);

      <a class="code" href="thread_8h.html#a898ebeae19eb435889cbf53ea8b5120e">THREAD_TIMER_ON</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, circuit-&gt;<a class="code" href="structisis__circuit.html#a3ad206840c48b3ff93d5160f5a402e2e">t_send_psnp</a>[1], <a class="code" href="isis__pdu_8c.html#ada5c84113d20d6c83fce25bfea104e93">send_l2_psnp</a>, circuit,
               <a class="code" href="isis__misc_8c.html#a177a75676b1916fefb4eb7275911fb6e">isis_jitter</a> (circuit-&gt;<a class="code" href="structisis__circuit.html#ab73d895f1c1588eb68e5b467f7f1b479">psnp_interval</a>[level - 1],
                    <a class="code" href="isis__constants_8h.html#a8ebe0205326ccb2592f752237c21729b">PSNP_JITTER</a>));
    }

  <a class="code" href="thread_8h.html#a1067157ad59ad46f29bf87158dffc3de">thread_add_event</a> (<a class="code" href="bgp__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a>, <a class="code" href="isis__events_8c.html#aa449cea2358b48018e359f93e4909864">isis_event_dis_status_change</a>, circuit, 0);

  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae35c5d9be60cd5f01bcbe0bb6e79654e"></a><!-- doxytag: member="isis_dr.c::isis_run_dr_l1" ref="ae35c5d9be60cd5f01bcbe0bb6e79654e" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int isis_run_dr_l1 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__dr_8c_source.html#l00072">72</a> of file <a class="el" href="isis__dr_8c_source.html">isis_dr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;

  circuit = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit);

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0766cf32585b89b427a69cd8ad1c22fb">run_dr_elect</a>[0])
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;isis_run_dr(): run_dr_elect already set for l1&quot;</span>);

  circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0eff61cf3ddb83196c960a96ce7f8242">t_run_dr</a>[0] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0766cf32585b89b427a69cd8ad1c22fb">run_dr_elect</a>[0] = 1;

  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a858591bc68bc249bd3a775e8f9ca2694"></a><!-- doxytag: member="isis_dr.c::isis_run_dr_l2" ref="a858591bc68bc249bd3a775e8f9ca2694" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int isis_run_dr_l2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isis__dr_8c_source.html#l00089">89</a> of file <a class="el" href="isis__dr_8c_source.html">isis_dr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structisis__circuit.html">isis_circuit</a> *circuit;

  circuit = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (circuit);

  <span class="keywordflow">if</span> (circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0766cf32585b89b427a69cd8ad1c22fb">run_dr_elect</a>[1])
    <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;isis_run_dr(): run_dr_elect already set for l2&quot;</span>);


  circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0eff61cf3ddb83196c960a96ce7f8242">t_run_dr</a>[1] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  circuit-&gt;<a class="code" href="structisis__circuit.html#a054734bc8d5a177c375cd28ab313dfc4">u</a>.<a class="code" href="structisis__circuit.html#a921ef29acc454e98615e0269f3bc926e">bc</a>.<a class="code" href="structisis__bcast__info.html#a0766cf32585b89b427a69cd8ad1c22fb">run_dr_elect</a>[1] = 1;

  <span class="keywordflow">return</span> <a class="code" href="isis__constants_8h.html#aeece0df48a5b652b227aeaeab5eef2f7">ISIS_OK</a>;
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="aa8cfdc8f7777fd242bd2c45f3a48b950"></a><!-- doxytag: member="isis_dr.c::isis" ref="aa8cfdc8f7777fd242bd2c45f3a48b950" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structisis.html">isis</a>* <a class="el" href="structisis.html">isis</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="isisd_8c_source.html#l00061">61</a> of file <a class="el" href="isisd_8c_source.html">isisd.c</a>.</p>

</div>
</div>
<a class="anchor" id="af7f9077bc08df049beb65a1c09cde5fa"></a><!-- doxytag: member="isis_dr.c::master" ref="af7f9077bc08df049beb65a1c09cde5fa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structthread__master.html">thread_master</a>* <a class="el" href="test__main_8c.html#af7f9077bc08df049beb65a1c09cde5fa">master</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__main_8c_source.html#l00105">105</a> of file <a class="el" href="bgp__main_8c_source.html">bgp_main.c</a>.</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="isis__dr_8c.html">isis_dr.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:20 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
