<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: lib/sockunion.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('sockunion_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">lib/sockunion.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="zebra_8h_source.html">zebra.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="prefix_8h_source.html">prefix.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vty_8h_source.html">vty.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sockunion_8h_source.html">sockunion.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="memory_8h_source.html">memory.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="str_8h_source.html">str.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for sockunion.c:</div>
<div class="dyncontent">
<div class="center"><img src="sockunion_8c__incl.png" border="0" usemap="#lib_2sockunion_8c" alt=""/></div>
<map name="lib_2sockunion_8c" id="lib_2sockunion_8c">
<area shape="rect" id="node3" href="zebra_8h.html" title="zebra.h" alt="" coords="1345,80,1412,107"/><area shape="rect" id="node59" href="str_8h.html" title="str.h" alt="" coords="2725,155,2773,181"/><area shape="rect" id="node61" href="prefix_8h.html" title="prefix.h" alt="" coords="2794,80,2861,107"/><area shape="rect" id="node63" href="sockunion_8h.html" title="sockunion.h" alt="" coords="2799,155,2892,181"/><area shape="rect" id="node65" href="vty_8h.html" title="vty.h" alt="" coords="2938,80,2989,107"/><area shape="rect" id="node69" href="log_8h.html" title="log.h" alt="" coords="3013,155,3064,181"/><area shape="rect" id="node73" href="memory_8h.html" title="memory.h" alt="" coords="3096,80,3179,107"/><area shape="rect" id="node57" href="zassert_8h.html" title="zassert.h" alt="" coords="2623,155,2700,181"/><area shape="rect" id="node67" href="thread_8h.html" title="thread.h" alt="" coords="2916,155,2988,181"/><area shape="rect" id="node75" href="memtypes_8h.html" title="lib/memtypes.h" alt="" coords="3089,155,3204,181"/></map>
</div>
</div>
<p><a href="sockunion_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a4203367afaacee3fa5cc1626b2ef63c0">inet_aton</a> (const char *cp, struct in_addr *inaddr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#ac13c2042641ea5031bc7e244e8061b84">inet_pton</a> (int family, const char *strptr, void *addrptr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (int family, const void *addrptr, char *strptr, size_t len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#ab068bf6434ba4369835fe41ab4848f66">inet_sutop</a> (union <a class="el" href="unionsockunion.html">sockunion</a> *su, char *<a class="el" href="ripng__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#aaa4fbd35d2f9346b70e0d6c9e66cae79">str2sockunion</a> (const char *<a class="el" href="ripng__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, union <a class="el" href="unionsockunion.html">sockunion</a> *su)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a93759e01ddbd86605e1716a5c5b27a9e">sockunion2str</a> (union <a class="el" href="unionsockunion.html">sockunion</a> *su, char *buf, size_t len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a3dffcd96d7fff7136a7a35d44727ca0d">sockunion_str2su</a> (const char *<a class="el" href="ripng__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a81204a150d1d4f669bb69fdb0915a727">sockunion_su2str</a> (union <a class="el" href="unionsockunion.html">sockunion</a> *su)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a0ff4c72dee88c4c28b9705fe5fd64e73">sockunion_normalise_mapped</a> (union <a class="el" href="unionsockunion.html">sockunion</a> *su)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a75e4776386c27ca33e5c5d86eafd4b99">sockunion_socket</a> (union <a class="el" href="unionsockunion.html">sockunion</a> *su)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a71ffb8b7424679127f0ab7d3ad8c9fd4">sockunion_accept</a> (int sock, union <a class="el" href="unionsockunion.html">sockunion</a> *su)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a3015c52e7879749b10e5ab42778f61fd">sockunion_sizeof</a> (union <a class="el" href="unionsockunion.html">sockunion</a> *su)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a47180330e14c36dad089da56df04bde9">sockunion_log</a> (union <a class="el" href="unionsockunion.html">sockunion</a> *su)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="sockunion_8h.html#ab1d3499888de36b96c23f98e283c1b6e">connect_result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a31e80aeef8aa1c434ff7fe4ae8188450">sockunion_connect</a> (int fd, union <a class="el" href="unionsockunion.html">sockunion</a> *peersu, unsigned short port, unsigned int ifindex)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#aa87de7fb2e611ab14eabc9ee0242f53d">sockunion_stream_socket</a> (union <a class="el" href="unionsockunion.html">sockunion</a> *su)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a12e8d416910e79b142ec1d4fee573073">sockunion_bind</a> (int sock, union <a class="el" href="unionsockunion.html">sockunion</a> *su, unsigned short port, union <a class="el" href="unionsockunion.html">sockunion</a> *su_addr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#aa177c0a1e91bd7ac7af8d703768a56bc">sockopt_reuseaddr</a> (int sock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a1910bb0d088e8c63fcf2d1441a0ad4e4">sockopt_reuseport</a> (int sock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#abaf662d1724513469c375f264ccb4668">sockopt_ttl</a> (int family, int sock, int ttl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#afbcb327baabeb77f356791b1551e51b8">sockunion_same</a> (union <a class="el" href="unionsockunion.html">sockunion</a> *su1, union <a class="el" href="unionsockunion.html">sockunion</a> *su2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a983f6545771518eb72da0089c1ffb798">sockunion_getsockname</a> (int fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a9e1235f351839c7c8b5075c335db605c">sockunion_getpeername</a> (int fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a43c4623c2553d09a59385aabe971d75d">__attribute__</a> ((unused))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#ac407b73abeade79f1a85355fde19b294">sockunion_cmp</a> (union <a class="el" href="unionsockunion.html">sockunion</a> *su1, union <a class="el" href="unionsockunion.html">sockunion</a> *su2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#add853166b1783f23865653395b60df12">sockunion_dup</a> (union <a class="el" href="unionsockunion.html">sockunion</a> *su)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sockunion_8c.html#a4c9c2ea65e1c9058a61db60a5ae8dbaf">sockunion_free</a> (union <a class="el" href="unionsockunion.html">sockunion</a> *su)</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a43c4623c2553d09a59385aabe971d75d"></a><!-- doxytag: member="sockunion.c::__attribute__" ref="a43c4623c2553d09a59385aabe971d75d" args="((unused))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __attribute__ </td>
          <td>(</td>
          <td class="paramtype">(unused)&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00650">650</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (su == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    <span class="keywordflow">return</span>;

  <span class="keywordflow">switch</span> (su-&gt;sa.sa_family) 
    {
    <span class="keywordflow">case</span> AF_INET:
      printf (<span class="stringliteral">&quot;%s\n&quot;</span>, inet_ntoa (su-&gt;sin.sin_addr));
      <span class="keywordflow">break</span>;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>    <span class="keywordflow">case</span> AF_INET6:
      {
    <span class="keywordtype">char</span> buf [<a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>];

    printf (<span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, &amp;(su-&gt;sin6.sin6_addr),
                 buf, sizeof (buf)));
      }
      <span class="keywordflow">break</span>;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

<span class="preprocessor">#ifdef AF_LINK</span>
<span class="preprocessor"></span>    <span class="keywordflow">case</span> AF_LINK:
      {
    <span class="keyword">struct </span>sockaddr_dl *sdl;

    sdl = (<span class="keyword">struct </span>sockaddr_dl *)&amp;(su-&gt;sa);
    printf (<span class="stringliteral">&quot;link#%d\n&quot;</span>, sdl-&gt;sdl_index);
      }
      <span class="keywordflow">break</span>;
<span class="preprocessor">#endif </span><span class="comment">/* AF_LINK */</span>
    <span class="keywordflow">default</span>:
      printf (<span class="stringliteral">&quot;af_unknown %d\n&quot;</span>, su-&gt;sa.sa_family);
      <span class="keywordflow">break</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4203367afaacee3fa5cc1626b2ef63c0"></a><!-- doxytag: member="sockunion.c::inet_aton" ref="a4203367afaacee3fa5cc1626b2ef63c0" args="(const char *cp, struct in_addr *inaddr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int inet_aton </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr *&#160;</td>
          <td class="paramname"><em>inaddr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00033">33</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> dots = 0;
  <span class="keyword">register</span> u_long addr = 0;
  <span class="keyword">register</span> u_long <a class="code" href="prefix_8h.html#a43e03366be2dd9176e91229d76541ce9">val</a> = 0, base = 10;

  <span class="keywordflow">do</span>
    {
      <span class="keyword">register</span> <span class="keywordtype">char</span> c = *cp;

      <span class="keywordflow">switch</span> (c)
    {
    <span class="keywordflow">case</span> <span class="charliteral">&#39;0&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;1&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;2&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;3&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;4&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;5&#39;</span>:
    <span class="keywordflow">case</span> <span class="charliteral">&#39;6&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;7&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;8&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;9&#39;</span>:
      val = (val * base) + (c - <span class="charliteral">&#39;0&#39;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <span class="charliteral">&#39;.&#39;</span>:
      <span class="keywordflow">if</span> (++dots &gt; 3)
        <span class="keywordflow">return</span> 0;
    <span class="keywordflow">case</span> <span class="charliteral">&#39;\0&#39;</span>:
      <span class="keywordflow">if</span> (val &gt; 255)
        <span class="keywordflow">return</span> 0;
      addr = addr &lt;&lt; 8 | <a class="code" href="prefix_8h.html#a43e03366be2dd9176e91229d76541ce9">val</a>;
      val = 0;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
      <span class="keywordflow">return</span> 0;
    }
    } <span class="keywordflow">while</span> (*cp++) ;

  <span class="keywordflow">if</span> (dots &lt; 3)
    addr &lt;&lt;= 8 * (3 - dots);
  <span class="keywordflow">if</span> (inaddr)
    inaddr-&gt;s_addr = htonl (addr);
  <span class="keywordflow">return</span> 1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5bfb767e8fa3f9ff5d2a1e19d71791f4"></a><!-- doxytag: member="sockunion.c::inet_ntop" ref="a5bfb767e8fa3f9ff5d2a1e19d71791f4" args="(int family, const void *addrptr, char *strptr, size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* inet_ntop </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>addrptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>strptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00094">94</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) addrptr;

  <span class="keywordflow">if</span> (family == AF_INET) 
    {
      <span class="keywordtype">char</span> temp[<a class="code" href="prefix_8h.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a>];

      <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a>(temp, <span class="keyword">sizeof</span>(temp), <span class="stringliteral">&quot;%d.%d.%d.%d&quot;</span>, p[0], p[1], p[2], p[3]);

      <span class="keywordflow">if</span> (strlen(temp) &gt;= len) 
    {
      errno = ENOSPC;
      <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }
      strcpy(strptr, temp);
      <span class="keywordflow">return</span> strptr;
    }

  errno = EAFNOSUPPORT;
  <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac13c2042641ea5031bc7e244e8061b84"></a><!-- doxytag: member="sockunion.c::inet_pton" ref="ac13c2042641ea5031bc7e244e8061b84" args="(int family, const char *strptr, void *addrptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int inet_pton </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>strptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addrptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00074">74</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (family == AF_INET)
    {
      <span class="keyword">struct </span>in_addr in_val;

      <span class="keywordflow">if</span> (<a class="code" href="sockunion_8c.html#a4203367afaacee3fa5cc1626b2ef63c0">inet_aton</a> (strptr, &amp;in_val))
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (addrptr, &amp;in_val, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> in_addr));
      <span class="keywordflow">return</span> 1;
    }
      <span class="keywordflow">return</span> 0;
    }
  errno = EAFNOSUPPORT;
  <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab068bf6434ba4369835fe41ab4848f66"></a><!-- doxytag: member="sockunion.c::inet_sutop" ref="ab068bf6434ba4369835fe41ab4848f66" args="(union sockunion *su, char *str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* inet_sutop </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>str</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00119">119</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">switch</span> (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family)
    {
    <span class="keywordflow">case</span> AF_INET:
      <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr, <a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, <a class="code" href="prefix_8h.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a>);
      <span class="keywordflow">break</span>;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>    <span class="keywordflow">case</span> AF_INET6:
      <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, &amp;su-&gt;sin6.sin6_addr, <a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, <a class="code" href="prefix_8h.html#af776b22a727aae7c9f4d869d50df47e8">INET6_ADDRSTRLEN</a>);
      <span class="keywordflow">break</span>;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
    }
  <span class="keywordflow">return</span> <a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa177c0a1e91bd7ac7af8d703768a56bc"></a><!-- doxytag: member="sockunion.c::sockopt_reuseaddr" ref="aa177c0a1e91bd7ac7af8d703768a56bc" args="(int sock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sockopt_reuseaddr </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sock</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00456">456</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <span class="keywordtype">int</span> on = 1;

  ret = setsockopt (sock, SOL_SOCKET, SO_REUSEADDR, 
            (<span class="keywordtype">void</span> *) &amp;on, <span class="keyword">sizeof</span> (on));
  <span class="keywordflow">if</span> (ret &lt; 0)
    {
      <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_WARNING, <span class="stringliteral">&quot;can&#39;t set sockopt SO_REUSEADDR to socket %d&quot;</span>, sock);
      <span class="keywordflow">return</span> -1;
    }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1910bb0d088e8c63fcf2d1441a0ad4e4"></a><!-- doxytag: member="sockunion.c::sockopt_reuseport" ref="a1910bb0d088e8c63fcf2d1441a0ad4e4" args="(int sock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sockopt_reuseport </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sock</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00489">489</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abaf662d1724513469c375f264ccb4668"></a><!-- doxytag: member="sockunion.c::sockopt_ttl" ref="abaf662d1724513469c375f264ccb4668" args="(int family, int sock, int ttl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sockopt_ttl </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ttl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00496">496</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;

<span class="preprocessor">#ifdef IP_TTL</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (family == AF_INET)
    {
      ret = setsockopt (sock, IPPROTO_IP, IP_TTL, 
            (<span class="keywordtype">void</span> *) &amp;ttl, <span class="keyword">sizeof</span> (<span class="keywordtype">int</span>));
      <span class="keywordflow">if</span> (ret &lt; 0)
    {
      <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_WARNING, <span class="stringliteral">&quot;can&#39;t set sockopt IP_TTL %d to socket %d&quot;</span>, ttl, sock);
      <span class="keywordflow">return</span> -1;
    }
      <span class="keywordflow">return</span> 0;
    }
<span class="preprocessor">#endif </span><span class="comment">/* IP_TTL */</span>
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (family == AF_INET6)
    {
      ret = setsockopt (sock, IPPROTO_IPV6, IPV6_UNICAST_HOPS, 
            (<span class="keywordtype">void</span> *) &amp;ttl, <span class="keyword">sizeof</span> (<span class="keywordtype">int</span>));
      <span class="keywordflow">if</span> (ret &lt; 0)
    {
      <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_WARNING, <span class="stringliteral">&quot;can&#39;t set sockopt IPV6_UNICAST_HOPS %d to socket %d&quot;</span>,
            ttl, sock);
      <span class="keywordflow">return</span> -1;
    }
      <span class="keywordflow">return</span> 0;
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a93759e01ddbd86605e1716a5c5b27a9e"></a><!-- doxytag: member="sockunion.c::sockunion2str" ref="a93759e01ddbd86605e1716a5c5b27a9e" args="(union sockunion *su, char *buf, size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* sockunion2str </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00166">166</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span>  (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family == AF_INET)
    <span class="keywordflow">return</span> <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr, buf, len);
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family == AF_INET6)
    <span class="keywordflow">return</span> <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, &amp;su-&gt;sin6.sin6_addr, buf, len);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a71ffb8b7424679127f0ab7d3ad8c9fd4"></a><!-- doxytag: member="sockunion.c::sockunion_accept" ref="a71ffb8b7424679127f0ab7d3ad8c9fd4" args="(int sock, union sockunion *su)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sockunion_accept </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00266">266</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="zebra_8h.html#a6b82106923cc13b3a9734520ecc29514">socklen_t</a> len;
  <span class="keywordtype">int</span> client_sock;

  len = <span class="keyword">sizeof</span> (<span class="keyword">union </span><a class="code" href="unionsockunion.html">sockunion</a>);
  client_sock = accept (sock, (<span class="keyword">struct</span> sockaddr *) su, &amp;len);
  
  <a class="code" href="sockunion_8c.html#a0ff4c72dee88c4c28b9705fe5fd64e73">sockunion_normalise_mapped</a> (su);
  <span class="keywordflow">return</span> client_sock;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a12e8d416910e79b142ec1d4fee573073"></a><!-- doxytag: member="sockunion.c::sockunion_bind" ref="a12e8d416910e79b142ec1d4fee573073" args="(int sock, union sockunion *su, unsigned short port, union sockunion *su_addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sockunion_bind </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su_addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00412">412</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> size = 0;
  <span class="keywordtype">int</span> ret;

  <span class="keywordflow">if</span> (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family == AF_INET)
    {
      size = <span class="keyword">sizeof</span> (<span class="keyword">struct </span>sockaddr_in);
      su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_port = htons (port);
<span class="preprocessor">#ifdef HAVE_STRUCT_SOCKADDR_IN_SIN_LEN</span>
<span class="preprocessor"></span>      su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_len = size;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_STRUCT_SOCKADDR_IN_SIN_LEN */</span>
      <span class="keywordflow">if</span> (su_addr == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr.s_addr = htonl (INADDR_ANY);
    }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family == AF_INET6)
    {
      size = <span class="keyword">sizeof</span> (<span class="keyword">struct </span>sockaddr_in6);
      su-&gt;sin6.sin6_port = htons (port);
<span class="preprocessor">#ifdef SIN6_LEN</span>
<span class="preprocessor"></span>      su-&gt;sin6.sin6_len = size;
<span class="preprocessor">#endif </span><span class="comment">/* SIN6_LEN */</span>
      <span class="keywordflow">if</span> (su_addr == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
<span class="preprocessor">#if defined(LINUX_IPV6) || defined(NRL)</span>
<span class="preprocessor"></span>      memset (&amp;su-&gt;sin6.sin6_addr, 0, sizeof (<span class="keyword">struct</span> in6_addr));
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>      su-&gt;sin6.sin6_addr = in6addr_any;
<span class="preprocessor">#endif </span><span class="comment">/* LINUX_IPV6 */</span>
    }
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  

  ret = bind (sock, (<span class="keyword">struct</span> sockaddr *)su, size);
  <span class="keywordflow">if</span> (ret &lt; 0)
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_WARNING, <span class="stringliteral">&quot;can&#39;t bind socket : %s&quot;</span>, <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno));

  <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac407b73abeade79f1a85355fde19b294"></a><!-- doxytag: member="sockunion.c::sockunion_cmp" ref="ac407b73abeade79f1a85355fde19b294" args="(union sockunion *su1, union sockunion *su2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sockunion_cmp </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00710">710</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (su1-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family &gt; su2-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family)
    <span class="keywordflow">return</span> 1;
  <span class="keywordflow">if</span> (su1-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family &lt; su2-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family)
    <span class="keywordflow">return</span> -1;

  <span class="keywordflow">if</span> (su1-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family == AF_INET)
    {
      <span class="keywordflow">if</span> (ntohl (su1-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr.s_addr) == ntohl (su2-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr.s_addr))
    <span class="keywordflow">return</span> 0;
      <span class="keywordflow">if</span> (ntohl (su1-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr.s_addr) &gt; ntohl (su2-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr.s_addr))
    <span class="keywordflow">return</span> 1;
      <span class="keywordflow">else</span>
    <span class="keywordflow">return</span> -1;
    }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (su1-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family == AF_INET6)
    <span class="keywordflow">return</span> in6addr_cmp (&amp;su1-&gt;sin6.sin6_addr, &amp;su2-&gt;sin6.sin6_addr);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a31e80aeef8aa1c434ff7fe4ae8188450"></a><!-- doxytag: member="sockunion.c::sockunion_connect" ref="a31e80aeef8aa1c434ff7fe4ae8188450" args="(int fd, union sockunion *peersu, unsigned short port, unsigned int ifindex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="sockunion_8h.html#ab1d3499888de36b96c23f98e283c1b6e">connect_result</a> sockunion_connect </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>peersu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>ifindex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00328">328</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <span class="keywordtype">int</span> <a class="code" href="prefix_8h.html#a43e03366be2dd9176e91229d76541ce9">val</a>;
  <span class="keyword">union </span><a class="code" href="unionsockunion.html">sockunion</a> su;

  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;su, peersu, <span class="keyword">sizeof</span> (<span class="keyword">union</span> <a class="code" href="unionsockunion.html">sockunion</a>));

  <span class="keywordflow">switch</span> (su.sa.sa_family)
    {
    <span class="keywordflow">case</span> AF_INET:
      su.sin.sin_port = port;
      <span class="keywordflow">break</span>;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>    <span class="keywordflow">case</span> AF_INET6:
      su.sin6.sin6_port  = port;
<span class="preprocessor">#ifdef KAME</span>
<span class="preprocessor"></span>      <span class="keywordflow">if</span> (IN6_IS_ADDR_LINKLOCAL(&amp;su.sin6.sin6_addr) &amp;&amp; ifindex)
    {
<span class="preprocessor">#ifdef HAVE_STRUCT_SOCKADDR_IN6_SIN6_SCOPE_ID</span>
<span class="preprocessor"></span>      <span class="comment">/* su.sin6.sin6_scope_id = ifindex; */</span>
<span class="preprocessor">#ifdef MUSICA</span>
<span class="preprocessor"></span>      su.sin6.sin6_scope_id = ifindex; 
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* HAVE_STRUCT_SOCKADDR_IN6_SIN6_SCOPE_ID */</span>
<span class="preprocessor">#ifndef MUSICA</span>
<span class="preprocessor"></span>      <a class="code" href="sockunion_8h.html#ac5e492dc1d10f95eb64eaac05ec9bab0">SET_IN6_LINKLOCAL_IFINDEX</a> (su.sin6.sin6_addr, ifindex);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    }
<span class="preprocessor">#endif </span><span class="comment">/* KAME */</span>
      <span class="keywordflow">break</span>;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
    }      

  <span class="comment">/* Make socket non-block. */</span>
  val = fcntl (fd, F_GETFL, 0);
  fcntl (fd, F_SETFL, val|O_NONBLOCK);

  <span class="comment">/* Call connect function. */</span>
  ret = connect (fd, (<span class="keyword">struct</span> sockaddr *) &amp;su, <a class="code" href="sockunion_8c.html#a3015c52e7879749b10e5ab42778f61fd">sockunion_sizeof</a> (&amp;su));

  <span class="comment">/* Immediate success */</span>
  <span class="keywordflow">if</span> (ret == 0)
    {
      fcntl (fd, F_SETFL, val);
      <span class="keywordflow">return</span> <a class="code" href="sockunion_8h.html#ab1d3499888de36b96c23f98e283c1b6ea851cdcb3c5b666dc182f4b6136a6fe7d">connect_success</a>;
    }

  <span class="comment">/* If connect is in progress then return 1 else it&#39;s real error. */</span>
  <span class="keywordflow">if</span> (ret &lt; 0)
    {
      <span class="keywordflow">if</span> (errno != EINPROGRESS)
    {
      <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a> (<span class="stringliteral">&quot;can&#39;t connect to %s fd %d : %s&quot;</span>,
             <a class="code" href="sockunion_8c.html#a47180330e14c36dad089da56df04bde9">sockunion_log</a> (&amp;su), fd, <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno));
      <span class="keywordflow">return</span> <a class="code" href="sockunion_8h.html#ab1d3499888de36b96c23f98e283c1b6ea047b71b6325b28f03d8ac558983d7e88">connect_error</a>;
    }
    }

  fcntl (fd, F_SETFL, val);

  <span class="keywordflow">return</span> <a class="code" href="sockunion_8h.html#ab1d3499888de36b96c23f98e283c1b6eaefd11a166b80dff3244284fa5ece9d28">connect_in_progress</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="add853166b1783f23865653395b60df12"></a><!-- doxytag: member="sockunion.c::sockunion_dup" ref="add853166b1783f23865653395b60df12" args="(union sockunion *su)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">union <a class="el" href="unionsockunion.html">sockunion</a>* sockunion_dup </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em></td><td>)</td>
          <td><code> [write]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00735">735</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">union </span><a class="code" href="unionsockunion.html">sockunion</a> *dup = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba8f1a56e7700f20a190aaf7fc965e2386">MTYPE_SOCKUNION</a>, <span class="keyword">sizeof</span> (<span class="keyword">union</span> <a class="code" href="unionsockunion.html">sockunion</a>));
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (dup, su, <span class="keyword">sizeof</span> (<span class="keyword">union</span> <a class="code" href="unionsockunion.html">sockunion</a>));
  <span class="keywordflow">return</span> dup;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4c9c2ea65e1c9058a61db60a5ae8dbaf"></a><!-- doxytag: member="sockunion.c::sockunion_free" ref="a4c9c2ea65e1c9058a61db60a5ae8dbaf" args="(union sockunion *su)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sockunion_free </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00743">743</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba8f1a56e7700f20a190aaf7fc965e2386">MTYPE_SOCKUNION</a>, su);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9e1235f351839c7c8b5075c335db605c"></a><!-- doxytag: member="sockunion.c::sockunion_getpeername" ref="a9e1235f351839c7c8b5075c335db605c" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">union <a class="el" href="unionsockunion.html">sockunion</a>* sockunion_getpeername </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td><code> [write]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00606">606</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <a class="code" href="zebra_8h.html#a6b82106923cc13b3a9734520ecc29514">socklen_t</a> len;
  <span class="keyword">union</span>
  {
    <span class="keyword">struct </span>sockaddr sa;
    <span class="keyword">struct </span>sockaddr_in sin;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>    <span class="keyword">struct </span>sockaddr_in6 sin6;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
    <span class="keywordtype">char</span> tmp_buffer[128];
  } <a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;
  <span class="keyword">union </span><a class="code" href="unionsockunion.html">sockunion</a> *su;

  memset (&amp;<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, 0, <span class="keyword">sizeof</span> <a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
  len = <span class="keyword">sizeof</span> <a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;
  ret = getpeername (fd, (<span class="keyword">struct</span> sockaddr *)&amp;<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, &amp;len);
  <span class="keywordflow">if</span> (ret &lt; 0)
    {
      <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_WARNING, <span class="stringliteral">&quot;Can&#39;t get remote address and port: %s&quot;</span>,
        <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno));
      <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }

  <span class="keywordflow">if</span> (<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>.sa.sa_family == AF_INET)
    {
      su = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba8f1a56e7700f20a190aaf7fc965e2386">MTYPE_SOCKUNION</a>, <span class="keyword">sizeof</span> (<span class="keyword">union</span> <a class="code" href="unionsockunion.html">sockunion</a>));
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (su, &amp;<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> sockaddr_in));
      <span class="keywordflow">return</span> su;
    }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>.sa.sa_family == AF_INET6)
    {
      su = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba8f1a56e7700f20a190aaf7fc965e2386">MTYPE_SOCKUNION</a>, <span class="keyword">sizeof</span> (<span class="keyword">union</span> <a class="code" href="unionsockunion.html">sockunion</a>));
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (su, &amp;<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> sockaddr_in6));
      <a class="code" href="sockunion_8c.html#a0ff4c72dee88c4c28b9705fe5fd64e73">sockunion_normalise_mapped</a> (su);
      <span class="keywordflow">return</span> su;
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a983f6545771518eb72da0089c1ffb798"></a><!-- doxytag: member="sockunion.c::sockunion_getsockname" ref="a983f6545771518eb72da0089c1ffb798" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">union <a class="el" href="unionsockunion.html">sockunion</a>* sockunion_getsockname </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td><code> [write]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00560">560</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <a class="code" href="zebra_8h.html#a6b82106923cc13b3a9734520ecc29514">socklen_t</a> len;
  <span class="keyword">union</span>
  {
    <span class="keyword">struct </span>sockaddr sa;
    <span class="keyword">struct </span>sockaddr_in sin;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>    <span class="keyword">struct </span>sockaddr_in6 sin6;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
    <span class="keywordtype">char</span> tmp_buffer[128];
  } <a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;
  <span class="keyword">union </span><a class="code" href="unionsockunion.html">sockunion</a> *su;

  memset (&amp;<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, 0, <span class="keyword">sizeof</span> <a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
  len = <span class="keyword">sizeof</span> <a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;

  ret = getsockname (fd, (<span class="keyword">struct</span> sockaddr *)&amp;<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, &amp;len);
  <span class="keywordflow">if</span> (ret &lt; 0)
    {
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;Can&#39;t get local address and port by getsockname: %s&quot;</span>,
         <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno));
      <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }

  <span class="keywordflow">if</span> (<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>.sa.sa_family == AF_INET)
    {
      su = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba8f1a56e7700f20a190aaf7fc965e2386">MTYPE_SOCKUNION</a>, <span class="keyword">sizeof</span> (<span class="keyword">union</span> <a class="code" href="unionsockunion.html">sockunion</a>));
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (su, &amp;<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> sockaddr_in));
      <span class="keywordflow">return</span> su;
    }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>.sa.sa_family == AF_INET6)
    {
      su = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba8f1a56e7700f20a190aaf7fc965e2386">MTYPE_SOCKUNION</a>, <span class="keyword">sizeof</span> (<span class="keyword">union</span> <a class="code" href="unionsockunion.html">sockunion</a>));
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (su, &amp;<a class="code" href="memory_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> sockaddr_in6));
      <a class="code" href="sockunion_8c.html#a0ff4c72dee88c4c28b9705fe5fd64e73">sockunion_normalise_mapped</a> (su);
      <span class="keywordflow">return</span> su;
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a47180330e14c36dad089da56df04bde9"></a><!-- doxytag: member="sockunion.c::sockunion_log" ref="a47180330e14c36dad089da56df04bde9" args="(union sockunion *su)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* sockunion_log </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00301">301</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">static</span> <span class="keywordtype">char</span> buf[<a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>];

  <span class="keywordflow">switch</span> (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family) 
    {
    <span class="keywordflow">case</span> AF_INET:
      <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>, <span class="stringliteral">&quot;%s&quot;</span>, inet_ntoa (su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr));
      <span class="keywordflow">break</span>;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>    <span class="keywordflow">case</span> AF_INET6:
      <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>, <span class="stringliteral">&quot;%s&quot;</span>,
        <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, &amp;(su-&gt;sin6.sin6_addr), buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>));
      <span class="keywordflow">break</span>;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
    <span class="keywordflow">default</span>:
      <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>, <span class="stringliteral">&quot;af_unknown %d &quot;</span>, su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family);
      <span class="keywordflow">break</span>;
    }
  <span class="keywordflow">return</span> (<a class="code" href="memory_8h.html#aa7c561b5824edc16351f22b8df155c0e">XSTRDUP</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba563963518edb70d4cd7492b06f48106e">MTYPE_TMP</a>, buf));
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0ff4c72dee88c4c28b9705fe5fd64e73"></a><!-- doxytag: member="sockunion.c::sockunion_normalise_mapped" ref="a0ff4c72dee88c4c28b9705fe5fd64e73" args="(union sockunion *su)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void sockunion_normalise_mapped </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00231">231</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span>sockaddr_in sin;
  
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family == AF_INET6 
      &amp;&amp; IN6_IS_ADDR_V4MAPPED (&amp;su-&gt;sin6.sin6_addr))
    {
      memset (&amp;sin, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> sockaddr_in));
      sin.sin_family = AF_INET;
      sin.sin_port = su-&gt;sin6.sin6_port;
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;sin.sin_addr, ((<span class="keywordtype">char</span> *)&amp;su-&gt;sin6.sin6_addr) + 12, 4);
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (su, &amp;sin, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> sockaddr_in));
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="afbcb327baabeb77f356791b1551e51b8"></a><!-- doxytag: member="sockunion.c::sockunion_same" ref="afbcb327baabeb77f356791b1551e51b8" args="(union sockunion *su1, union sockunion *su2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sockunion_same </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00532">532</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret = 0;

  <span class="keywordflow">if</span> (su1-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family != su2-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family)
    <span class="keywordflow">return</span> 0;

  <span class="keywordflow">switch</span> (su1-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family)
    {
    <span class="keywordflow">case</span> AF_INET:
      ret = <a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (&amp;su1-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr, &amp;su2-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr,
            sizeof (<span class="keyword">struct</span> in_addr));
      <span class="keywordflow">break</span>;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>    <span class="keywordflow">case</span> AF_INET6:
      ret = <a class="code" href="regex_8c.html#a98d0dff0c7366f08562d8e8583df9bb9">memcmp</a> (&amp;su1-&gt;sin6.sin6_addr, &amp;su2-&gt;sin6.sin6_addr,
            sizeof (<span class="keyword">struct</span> in6_addr));
      <span class="keywordflow">break</span>;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
    }
  <span class="keywordflow">if</span> (ret == 0)
    <span class="keywordflow">return</span> 1;
  <span class="keywordflow">else</span>
    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3015c52e7879749b10e5ab42778f61fd"></a><!-- doxytag: member="sockunion.c::sockunion_sizeof" ref="a3015c52e7879749b10e5ab42778f61fd" args="(union sockunion *su)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int sockunion_sizeof </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00280">280</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;

  ret = 0;
  <span class="keywordflow">switch</span> (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family)
    {
    <span class="keywordflow">case</span> AF_INET:
      ret = <span class="keyword">sizeof</span> (<span class="keyword">struct </span>sockaddr_in);
      <span class="keywordflow">break</span>;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>    <span class="keywordflow">case</span> AF_INET6:
      ret = <span class="keyword">sizeof</span> (<span class="keyword">struct </span>sockaddr_in6);
      <span class="keywordflow">break</span>;
<span class="preprocessor">#endif </span><span class="comment">/* AF_INET6 */</span>
    }
  <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a75e4776386c27ca33e5c5d86eafd4b99"></a><!-- doxytag: member="sockunion.c::sockunion_socket" ref="a75e4776386c27ca33e5c5d86eafd4b99" args="(union sockunion *su)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sockunion_socket </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00250">250</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> sock;

  sock = socket (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family, SOCK_STREAM, 0);
  <span class="keywordflow">if</span> (sock &lt; 0)
    {
      <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_WARNING, <span class="stringliteral">&quot;Can&#39;t make socket : %s&quot;</span>, <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno));
      <span class="keywordflow">return</span> -1;
    }

  <span class="keywordflow">return</span> sock;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3dffcd96d7fff7136a7a35d44727ca0d"></a><!-- doxytag: member="sockunion.c::sockunion_str2su" ref="a3dffcd96d7fff7136a7a35d44727ca0d" args="(const char *str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">union <a class="el" href="unionsockunion.html">sockunion</a>* sockunion_str2su </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>str</em></td><td>)</td>
          <td><code> [write]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00178">178</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <span class="keyword">union </span><a class="code" href="unionsockunion.html">sockunion</a> *su;

  su = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba8f1a56e7700f20a190aaf7fc965e2386">MTYPE_SOCKUNION</a>, <span class="keyword">sizeof</span> (<span class="keyword">union</span> <a class="code" href="unionsockunion.html">sockunion</a>));

  ret = <a class="code" href="sockunion_8c.html#ac13c2042641ea5031bc7e244e8061b84">inet_pton</a> (AF_INET, <a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, &amp;su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr);
  <span class="keywordflow">if</span> (ret &gt; 0)          <span class="comment">/* Valid IPv4 address format. */</span>
    {
      su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_family = AF_INET;
<span class="preprocessor">#ifdef HAVE_STRUCT_SOCKADDR_IN_SIN_LEN</span>
<span class="preprocessor"></span>      su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_len = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>sockaddr_in);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_STRUCT_SOCKADDR_IN_SIN_LEN */</span>
      <span class="keywordflow">return</span> su;
    }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  ret = <a class="code" href="sockunion_8c.html#ac13c2042641ea5031bc7e244e8061b84">inet_pton</a> (AF_INET6, <a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, &amp;su-&gt;sin6.sin6_addr);
  <span class="keywordflow">if</span> (ret &gt; 0)          <span class="comment">/* Valid IPv6 address format. */</span>
    {
      su-&gt;sin6.sin6_family = AF_INET6;
<span class="preprocessor">#ifdef SIN6_LEN</span>
<span class="preprocessor"></span>      su-&gt;sin6.sin6_len = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>sockaddr_in6);
<span class="preprocessor">#endif </span><span class="comment">/* SIN6_LEN */</span>
      <span class="keywordflow">return</span> su;
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba8f1a56e7700f20a190aaf7fc965e2386">MTYPE_SOCKUNION</a>, su);
  <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa87de7fb2e611ab14eabc9ee0242f53d"></a><!-- doxytag: member="sockunion.c::sockunion_stream_socket" ref="aa87de7fb2e611ab14eabc9ee0242f53d" args="(union sockunion *su)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sockunion_stream_socket </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00395">395</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> sock;

  <span class="keywordflow">if</span> (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family == 0)
    su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family = <a class="code" href="sockunion_8h.html#a38959c7052325dcfdae19df19cd215f6">AF_INET_UNION</a>;

  sock = socket (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family, SOCK_STREAM, 0);

  <span class="keywordflow">if</span> (sock &lt; 0)
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_WARNING, <span class="stringliteral">&quot;can&#39;t make socket sockunion_stream_socket&quot;</span>);

  <span class="keywordflow">return</span> sock;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a81204a150d1d4f669bb69fdb0915a727"></a><!-- doxytag: member="sockunion.c::sockunion_su2str" ref="a81204a150d1d4f669bb69fdb0915a727" args="(union sockunion *su)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* sockunion_su2str </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00211">211</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">char</span> <a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>[<a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>];

  <span class="keywordflow">switch</span> (su-&gt;<a class="code" href="unionsockunion.html#a696d7d44e90274cc3bb86231cd51cfd4">sa</a>.sa_family)
    {
    <span class="keywordflow">case</span> AF_INET:
      <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr, str, sizeof (str));
      <span class="keywordflow">break</span>;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>    <span class="keywordflow">case</span> AF_INET6:
      <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, &amp;su-&gt;sin6.sin6_addr, str, sizeof (str));
      <span class="keywordflow">break</span>;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
    }
  <span class="keywordflow">return</span> <a class="code" href="memory_8h.html#aa7c561b5824edc16351f22b8df155c0e">XSTRDUP</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba563963518edb70d4cd7492b06f48106e">MTYPE_TMP</a>, str);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aaa4fbd35d2f9346b70e0d6c9e66cae79"></a><!-- doxytag: member="sockunion.c::str2sockunion" ref="aaa4fbd35d2f9346b70e0d6c9e66cae79" args="(const char *str, union sockunion *su)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int str2sockunion </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>su</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sockunion_8c_source.html#l00136">136</a> of file <a class="el" href="sockunion_8c_source.html">sockunion.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;

  memset (su, 0, <span class="keyword">sizeof</span> (<span class="keyword">union</span> <a class="code" href="unionsockunion.html">sockunion</a>));

  ret = <a class="code" href="sockunion_8c.html#ac13c2042641ea5031bc7e244e8061b84">inet_pton</a> (AF_INET, <a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, &amp;su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr);
  <span class="keywordflow">if</span> (ret &gt; 0)          <span class="comment">/* Valid IPv4 address format. */</span>
    {
      su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_family = AF_INET;
<span class="preprocessor">#ifdef HAVE_STRUCT_SOCKADDR_IN_SIN_LEN</span>
<span class="preprocessor"></span>      su-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_len = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>sockaddr_in);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_STRUCT_SOCKADDR_IN_SIN_LEN */</span>
      <span class="keywordflow">return</span> 0;
    }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  ret = <a class="code" href="sockunion_8c.html#ac13c2042641ea5031bc7e244e8061b84">inet_pton</a> (AF_INET6, <a class="code" href="rip__zebra_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, &amp;su-&gt;sin6.sin6_addr);
  <span class="keywordflow">if</span> (ret &gt; 0)          <span class="comment">/* Valid IPv6 address format. */</span>
    {
      su-&gt;sin6.sin6_family = AF_INET6;
<span class="preprocessor">#ifdef SIN6_LEN</span>
<span class="preprocessor"></span>      su-&gt;sin6.sin6_len = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>sockaddr_in6);
<span class="preprocessor">#endif </span><span class="comment">/* SIN6_LEN */</span>
      <span class="keywordflow">return</span> 0;
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="sockunion_8c.html">sockunion.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:24 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
