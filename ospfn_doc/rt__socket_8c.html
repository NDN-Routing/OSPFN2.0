<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: zebra/rt_socket.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('rt__socket_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">zebra/rt_socket.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="zebra_8h_source.html">zebra.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="if_8h_source.html">if.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="prefix_8h_source.html">prefix.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sockunion_8h_source.html">sockunion.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="str_8h_source.html">str.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="privs_8h_source.html">privs.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="debug_8h_source.html">zebra/debug.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rib_8h_source.html">zebra/rib.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rt_8h_source.html">zebra/rt.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="kernel__socket_8h_source.html">zebra/kernel_socket.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for rt_socket.c:</div>
<div class="dyncontent">
<div class="center"><img src="rt__socket_8c__incl.png" border="0" usemap="#zebra_2rt__socket_8c" alt=""/></div>
<map name="zebra_2rt__socket_8c" id="zebra_2rt__socket_8c">
<area shape="rect" id="node3" href="zebra_8h.html" title="zebra.h" alt="" coords="1351,80,1417,107"/><area shape="rect" id="node59" href="str_8h.html" title="str.h" alt="" coords="2773,155,2821,181"/><area shape="rect" id="node61" href="if_8h.html" title="if.h" alt="" coords="3057,155,3097,181"/><area shape="rect" id="node65" href="prefix_8h.html" title="prefix.h" alt="" coords="2919,229,2987,256"/><area shape="rect" id="node67" href="sockunion_8h.html" title="sockunion.h" alt="" coords="3004,304,3097,331"/><area shape="rect" id="node70" href="log_8h.html" title="log.h" alt="" coords="2701,80,2752,107"/><area shape="rect" id="node74" href="privs_8h.html" title="privs.h" alt="" coords="3173,80,3235,107"/><area shape="rect" id="node76" href="debug_8h.html" title="zebra/debug.h" alt="" coords="3259,80,3367,107"/><area shape="rect" id="node78" href="rib_8h.html" title="zebra/rib.h" alt="" coords="2898,155,2981,181"/><area shape="rect" id="node81" href="rt_8h.html" title="zebra/rt.h" alt="" coords="2967,80,3045,107"/><area shape="rect" id="node86" href="kernel__socket_8h.html" title="zebra/kernel_socket.h" alt="" coords="3391,80,3544,107"/><area shape="rect" id="node57" href="zassert_8h.html" title="zassert.h" alt="" coords="2389,155,2467,181"/><area shape="rect" id="node63" href="linklist_8h.html" title="linklist.h" alt="" coords="3026,229,3096,256"/></map>
</div>
</div>
<p><a href="rt__socket_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rt__socket_8c.html#ae83413a0f6a15fa53dcf5befcebe9c2c">rtm_write</a> (int <a class="el" href="structmessage.html">message</a>, union <a class="el" href="unionsockunion.html">sockunion</a> *dest, union <a class="el" href="unionsockunion.html">sockunion</a> *mask, union <a class="el" href="unionsockunion.html">sockunion</a> *gate, unsigned int index, int zebra_flags, int <a class="el" href="structmetric.html">metric</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rt__socket_8c.html#aaebd826fb4f08138eb80484dd21e3dcb">sin_masklen</a> (struct in_addr mask)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rt__socket_8c.html#ade6348a78bc2fed945fdb1e8703e82b7">kernel_rtm_ipv4</a> (int cmd, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structrib.html">rib</a> *<a class="el" href="structrib.html">rib</a>, int family)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rt__socket_8c.html#afea56d96d08fd5aab1d8e506cd4b25c0">kernel_add_ipv4</a> (struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structrib.html">rib</a> *<a class="el" href="structrib.html">rib</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rt__socket_8c.html#af2913f44f44cac8461b82b362ebbe986">kernel_delete_ipv4</a> (struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structrib.html">rib</a> *<a class="el" href="structrib.html">rib</a>)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structzebra__privs__t.html">zebra_privs_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rt__socket_8c.html#a10659da9c59441877a609c3cd916f3cf">zserv_privs</a></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="afea56d96d08fd5aab1d8e506cd4b25c0"></a><!-- doxytag: member="rt_socket.c::kernel_add_ipv4" ref="afea56d96d08fd5aab1d8e506cd4b25c0" args="(struct prefix *p, struct rib *rib)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kernel_add_ipv4 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structrib.html">rib</a> *&#160;</td>
          <td class="paramname"><em>rib</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rt__socket_8c_source.html#l00232">232</a> of file <a class="el" href="rt__socket_8c_source.html">rt_socket.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> route;

  <span class="keywordflow">if</span> (<a class="code" href="if__ioctl__solaris_8c.html#a10659da9c59441877a609c3cd916f3cf">zserv_privs</a>.<a class="code" href="structzebra__privs__t.html#a0c59dbc0ec6187b60a824ec421cc34c1">change</a>(<a class="code" href="privs_8h.html#aae029fe88e2d02bee4d46a2f458bd3e5a5395269196ee9bd07257f8b2b35c25fa">ZPRIVS_RAISE</a>))
    <a class="code" href="structzlog.html">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_ERR, <span class="stringliteral">&quot;Can&#39;t raise privileges&quot;</span>);
  route = <a class="code" href="rt__socket_8c.html#ade6348a78bc2fed945fdb1e8703e82b7">kernel_rtm_ipv4</a> (RTM_ADD, p, rib, AF_INET);
  <span class="keywordflow">if</span> (<a class="code" href="if__ioctl__solaris_8c.html#a10659da9c59441877a609c3cd916f3cf">zserv_privs</a>.<a class="code" href="structzebra__privs__t.html#a0c59dbc0ec6187b60a824ec421cc34c1">change</a>(<a class="code" href="privs_8h.html#aae029fe88e2d02bee4d46a2f458bd3e5a7da2c6956cf712f8adc04ff2b0f072c5">ZPRIVS_LOWER</a>))
    <a class="code" href="structzlog.html">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_ERR, <span class="stringliteral">&quot;Can&#39;t lower privileges&quot;</span>);

  <span class="keywordflow">return</span> route;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af2913f44f44cac8461b82b362ebbe986"></a><!-- doxytag: member="rt_socket.c::kernel_delete_ipv4" ref="af2913f44f44cac8461b82b362ebbe986" args="(struct prefix *p, struct rib *rib)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kernel_delete_ipv4 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structrib.html">rib</a> *&#160;</td>
          <td class="paramname"><em>rib</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rt__socket_8c_source.html#l00246">246</a> of file <a class="el" href="rt__socket_8c_source.html">rt_socket.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> route;

  <span class="keywordflow">if</span> (<a class="code" href="if__ioctl__solaris_8c.html#a10659da9c59441877a609c3cd916f3cf">zserv_privs</a>.<a class="code" href="structzebra__privs__t.html#a0c59dbc0ec6187b60a824ec421cc34c1">change</a>(<a class="code" href="privs_8h.html#aae029fe88e2d02bee4d46a2f458bd3e5a5395269196ee9bd07257f8b2b35c25fa">ZPRIVS_RAISE</a>))
    <a class="code" href="structzlog.html">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_ERR, <span class="stringliteral">&quot;Can&#39;t raise privileges&quot;</span>);
  route = <a class="code" href="rt__socket_8c.html#ade6348a78bc2fed945fdb1e8703e82b7">kernel_rtm_ipv4</a> (RTM_DELETE, p, rib, AF_INET);
  <span class="keywordflow">if</span> (<a class="code" href="if__ioctl__solaris_8c.html#a10659da9c59441877a609c3cd916f3cf">zserv_privs</a>.<a class="code" href="structzebra__privs__t.html#a0c59dbc0ec6187b60a824ec421cc34c1">change</a>(<a class="code" href="privs_8h.html#aae029fe88e2d02bee4d46a2f458bd3e5a7da2c6956cf712f8adc04ff2b0f072c5">ZPRIVS_LOWER</a>))
    <a class="code" href="structzlog.html">zlog</a> (<a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, LOG_ERR, <span class="stringliteral">&quot;Can&#39;t lower privileges&quot;</span>);

  <span class="keywordflow">return</span> route;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ade6348a78bc2fed945fdb1e8703e82b7"></a><!-- doxytag: member="rt_socket.c::kernel_rtm_ipv4" ref="ade6348a78bc2fed945fdb1e8703e82b7" args="(int cmd, struct prefix *p, struct rib *rib, int family)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int kernel_rtm_ipv4 </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structrib.html">rib</a> *&#160;</td>
          <td class="paramname"><em>rib</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rt__socket_8c_source.html#l00069">69</a> of file <a class="el" href="rt__socket_8c_source.html">rt_socket.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span>sockaddr_in *mask = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keyword">struct </span>sockaddr_in sin_dest, sin_mask, sin_gate;
  <span class="keyword">struct </span><a class="code" href="structnexthop.html">nexthop</a> *<a class="code" href="structnexthop.html">nexthop</a>;
  <span class="keywordtype">int</span> nexthop_num = 0;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structnexthop.html#a4bc2f1e33f239d2d817c205460a24daa">ifindex</a> = 0;
  <span class="keywordtype">int</span> <a class="code" href="structnexthop.html#af19e05e5dd51b578246ff51322b6b6dd">gate</a> = 0;
  <span class="keywordtype">int</span> error;
  <span class="keywordtype">char</span> prefix_buf[<a class="code" href="prefix_8h.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a>];

  <span class="keywordflow">if</span> (<a class="code" href="debug_8h.html#a5a02ca7cbeffc38327da8ae638a81c31">IS_ZEBRA_DEBUG_RIB</a>)
    <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, prefix_buf, <a class="code" href="prefix_8h.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a>);
  memset (&amp;sin_dest, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> sockaddr_in));
  sin_dest.sin_family = AF_INET;
<span class="preprocessor">#ifdef HAVE_STRUCT_SOCKADDR_IN_SIN_LEN</span>
<span class="preprocessor"></span>  sin_dest.sin_len = <span class="keyword">sizeof</span> (<span class="keyword">struct </span>sockaddr_in);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_STRUCT_SOCKADDR_IN_SIN_LEN */</span>
  sin_dest.sin_addr = p-&gt;u.<a class="code" href="structprefix.html#ab37b8922554b41b7dc2417d8f37e7829">prefix4</a>;

  memset (&amp;sin_mask, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> sockaddr_in));

  memset (&amp;sin_gate, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> sockaddr_in));
  sin_gate.sin_family = AF_INET;
<span class="preprocessor">#ifdef HAVE_STRUCT_SOCKADDR_IN_SIN_LEN</span>
<span class="preprocessor"></span>  sin_gate.sin_len = <span class="keyword">sizeof</span> (<span class="keyword">struct </span>sockaddr_in);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_STRUCT_SOCKADDR_IN_SIN_LEN */</span>

  <span class="comment">/* Make gateway. */</span>
  <span class="keywordflow">for</span> (nexthop = rib-&gt;<a class="code" href="structrib.html#a333c2eb7d1db1667de78cd2593aec089">nexthop</a>; nexthop; nexthop = nexthop-&gt;<a class="code" href="structnexthop.html#a9c830710811182925d5222fee616bd83">next</a>)
    {
      gate = 0;
      <span class="keywordtype">char</span> gate_buf[<a class="code" href="prefix_8h.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a>] = <span class="stringliteral">&quot;NULL&quot;</span>;

      <span class="comment">/*</span>
<span class="comment">       * XXX We need to refrain from kernel operations in some cases,</span>
<span class="comment">       * but this if statement seems overly cautious - what about</span>
<span class="comment">       * other than ADD and DELETE?</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> ((cmd == RTM_ADD
       &amp;&amp; <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (nexthop-&gt;<a class="code" href="structnexthop.html#a9fe6fe2ff3e0fc1ddfabe888ee9d00ad">flags</a>, <a class="code" href="rib_8h.html#a4c37713e2a4a901b74d72b0eaebc4881">NEXTHOP_FLAG_ACTIVE</a>))
      || (cmd == RTM_DELETE
          &amp;&amp; <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (nexthop-&gt;<a class="code" href="structnexthop.html#a9fe6fe2ff3e0fc1ddfabe888ee9d00ad">flags</a>, <a class="code" href="rib_8h.html#a7df095eb80d2cbf19093cbe09fcfcf77">NEXTHOP_FLAG_FIB</a>)
          ))
    {
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (nexthop-&gt;<a class="code" href="structnexthop.html#a9fe6fe2ff3e0fc1ddfabe888ee9d00ad">flags</a>, <a class="code" href="rib_8h.html#a585dd0f97f24bb17e3994a720a5c7037">NEXTHOP_FLAG_RECURSIVE</a>))
        {
          <span class="keywordflow">if</span> (nexthop-&gt;<a class="code" href="structnexthop.html#a50eb39bc450246638a981d46d3c4a579">rtype</a> == <a class="code" href="rib_8h.html#a0db77aa28c8e805e8621931fd0385158a9909d19d3bd1cf79727d0c809424d1e0">NEXTHOP_TYPE_IPV4</a> ||
          nexthop-&gt;<a class="code" href="structnexthop.html#a50eb39bc450246638a981d46d3c4a579">rtype</a> == <a class="code" href="rib_8h.html#a0db77aa28c8e805e8621931fd0385158a3147798b072558593867a8772925d9ba">NEXTHOP_TYPE_IPV4_IFINDEX</a>)
        {
          sin_gate.sin_addr = nexthop-&gt;<a class="code" href="structnexthop.html#aa401c5819c47323f95f25287ab4b8f4b">rgate</a>.<a class="code" href="uniong__addr.html#a3120e936e9b15510a8775865868a61d3">ipv4</a>;
          gate = 1;
        }
          <span class="keywordflow">if</span> (nexthop-&gt;<a class="code" href="structnexthop.html#a50eb39bc450246638a981d46d3c4a579">rtype</a> == <a class="code" href="rib_8h.html#a0db77aa28c8e805e8621931fd0385158a6e00834b26663ce5eb68fb6f7068b5c9">NEXTHOP_TYPE_IFINDEX</a>
          || nexthop-&gt;<a class="code" href="structnexthop.html#a50eb39bc450246638a981d46d3c4a579">rtype</a> == <a class="code" href="rib_8h.html#a0db77aa28c8e805e8621931fd0385158aa12d01eb5d47a34e54792bb02c81dbcb">NEXTHOP_TYPE_IFNAME</a>
          || nexthop-&gt;<a class="code" href="structnexthop.html#a50eb39bc450246638a981d46d3c4a579">rtype</a> == <a class="code" href="rib_8h.html#a0db77aa28c8e805e8621931fd0385158a3147798b072558593867a8772925d9ba">NEXTHOP_TYPE_IPV4_IFINDEX</a>)
        ifindex = nexthop-&gt;<a class="code" href="structnexthop.html#ab5eb4b0612493a281e860228317ece0f">rifindex</a>;
        }
      <span class="keywordflow">else</span>
        {
          <span class="keywordflow">if</span> (nexthop-&gt;<a class="code" href="structnexthop.html#a2945ec57f56526f142592f4f578b4522">type</a> == <a class="code" href="rib_8h.html#a0db77aa28c8e805e8621931fd0385158a9909d19d3bd1cf79727d0c809424d1e0">NEXTHOP_TYPE_IPV4</a> ||
          nexthop-&gt;<a class="code" href="structnexthop.html#a2945ec57f56526f142592f4f578b4522">type</a> == <a class="code" href="rib_8h.html#a0db77aa28c8e805e8621931fd0385158a3147798b072558593867a8772925d9ba">NEXTHOP_TYPE_IPV4_IFINDEX</a>)
        {
          sin_gate.sin_addr = nexthop-&gt;<a class="code" href="structnexthop.html#af19e05e5dd51b578246ff51322b6b6dd">gate</a>.<a class="code" href="uniong__addr.html#a3120e936e9b15510a8775865868a61d3">ipv4</a>;
          gate = 1;
        }
          <span class="keywordflow">if</span> (nexthop-&gt;<a class="code" href="structnexthop.html#a2945ec57f56526f142592f4f578b4522">type</a> == <a class="code" href="rib_8h.html#a0db77aa28c8e805e8621931fd0385158a6e00834b26663ce5eb68fb6f7068b5c9">NEXTHOP_TYPE_IFINDEX</a>
          || nexthop-&gt;<a class="code" href="structnexthop.html#a2945ec57f56526f142592f4f578b4522">type</a> == <a class="code" href="rib_8h.html#a0db77aa28c8e805e8621931fd0385158aa12d01eb5d47a34e54792bb02c81dbcb">NEXTHOP_TYPE_IFNAME</a>
          || nexthop-&gt;<a class="code" href="structnexthop.html#a2945ec57f56526f142592f4f578b4522">type</a> == <a class="code" href="rib_8h.html#a0db77aa28c8e805e8621931fd0385158a3147798b072558593867a8772925d9ba">NEXTHOP_TYPE_IPV4_IFINDEX</a>)
        ifindex = nexthop-&gt;<a class="code" href="structnexthop.html#a4bc2f1e33f239d2d817c205460a24daa">ifindex</a>;
          <span class="keywordflow">if</span> (nexthop-&gt;<a class="code" href="structnexthop.html#a2945ec57f56526f142592f4f578b4522">type</a> == <a class="code" href="rib_8h.html#a0db77aa28c8e805e8621931fd0385158a51979bee7d8d924ca294821391134aea">NEXTHOP_TYPE_BLACKHOLE</a>)
        {
          <span class="keyword">struct </span>in_addr loopback;
          loopback.s_addr = htonl (<a class="code" href="zebra_8h.html#ae1ac25d7797666cff6d01d6c795c2378">INADDR_LOOPBACK</a>);
          sin_gate.sin_addr = loopback;
          gate = 1;
        }
        }

      <span class="keywordflow">if</span> (gate &amp;&amp; p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> == 32)
        mask = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
      <span class="keywordflow">else</span>
        {
          <a class="code" href="prefix_8c.html#ac618f277d6ed0ebc56781ec26e508157">masklen2ip</a> (p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>, &amp;sin_mask.sin_addr);
          sin_mask.sin_family = AF_INET;
<span class="preprocessor">#ifdef HAVE_STRUCT_SOCKADDR_IN_SIN_LEN</span>
<span class="preprocessor"></span>          sin_mask.sin_len = <a class="code" href="rt__socket_8c.html#aaebd826fb4f08138eb80484dd21e3dcb">sin_masklen</a> (sin_mask.sin_addr);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_STRUCT_SOCKADDR_IN_SIN_LEN */</span>
          mask = &amp;sin_mask;
        }

      error = <a class="code" href="kernel__socket_8c.html#ae83413a0f6a15fa53dcf5befcebe9c2c">rtm_write</a> (cmd,
                 (<span class="keyword">union</span> <a class="code" href="unionsockunion.html">sockunion</a> *)&amp;sin_dest, 
                 (<span class="keyword">union</span> <a class="code" href="unionsockunion.html">sockunion</a> *)mask, 
                 gate ? (<span class="keyword">union</span> <a class="code" href="unionsockunion.html">sockunion</a> *)&amp;sin_gate : <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
                 ifindex,
                 rib-&gt;<a class="code" href="structrib.html#a2d6fadf111112f45163239c602f83034">flags</a>,
                 rib-&gt;<a class="code" href="structrib.html#a76469a0c207c22af7e4e2b298cbb84cf">metric</a>);

           <span class="keywordflow">if</span> (<a class="code" href="debug_8h.html#a5a02ca7cbeffc38327da8ae638a81c31">IS_ZEBRA_DEBUG_RIB</a>)
           {
             <span class="keywordflow">if</span> (!gate)
             {
               <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s: %s/%d: attention! gate not found for rib %p&quot;</span>,
                 __func__, prefix_buf, p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>, rib);
               <a class="code" href="rib_8h.html#a4bc4f0dec614afac167a2be0cc3c24e1">rib_dump</a> (__func__, (<span class="keyword">struct</span> <a class="code" href="structprefix__ipv4.html">prefix_ipv4</a> *)p, rib);
             }
             <span class="keywordflow">else</span>
               <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;sin_gate.sin_addr, gate_buf, <a class="code" href="prefix_8h.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a>);
           }
 
           <span class="keywordflow">switch</span> (error)
           {
             <span class="comment">/* We only flag nexthops as being in FIB if rtm_write() did its work. */</span>
             <span class="keywordflow">case</span> <a class="code" href="zebra_8h.html#a3dd4dbac0d42b8c4b7cc0e2947fb78cf">ZEBRA_ERR_NOERROR</a>:
               nexthop_num++;
               <span class="keywordflow">if</span> (<a class="code" href="debug_8h.html#a5a02ca7cbeffc38327da8ae638a81c31">IS_ZEBRA_DEBUG_RIB</a>)
                 <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s: %s/%d: successfully did NH %s&quot;</span>,
                   __func__, prefix_buf, p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>, gate_buf);
               <span class="keywordflow">if</span> (cmd == RTM_ADD)
                 <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (nexthop-&gt;<a class="code" href="structnexthop.html#a9fe6fe2ff3e0fc1ddfabe888ee9d00ad">flags</a>, <a class="code" href="rib_8h.html#a7df095eb80d2cbf19093cbe09fcfcf77">NEXTHOP_FLAG_FIB</a>);
               <span class="keywordflow">break</span>;
 
             <span class="comment">/* The only valid case for this error is kernel&#39;s failure to install</span>
<span class="comment">              * a multipath route, which is common for FreeBSD. This should be</span>
<span class="comment">              * ignored silently, but logged as an error otherwise.</span>
<span class="comment">              */</span>
             <span class="keywordflow">case</span> <a class="code" href="zebra_8h.html#a0a0de38e97fdf5982db3089fbd2f5390">ZEBRA_ERR_RTEXIST</a>:
               <span class="keywordflow">if</span> (cmd != RTM_ADD)
                 <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;%s: rtm_write() returned %d for command %d&quot;</span>,
                   __func__, error, cmd);
               <span class="keywordflow">continue</span>;
               <span class="keywordflow">break</span>;
 
             <span class="comment">/* Given that our NEXTHOP_FLAG_FIB matches real kernel FIB, it isn&#39;t</span>
<span class="comment">              * normal to get any other messages in ANY case.</span>
<span class="comment">              */</span>
             <span class="keywordflow">case</span> <a class="code" href="zebra_8h.html#a58dc80805c425ed7b6b46364b2d84fac">ZEBRA_ERR_RTNOEXIST</a>:
             <span class="keywordflow">case</span> <a class="code" href="zebra_8h.html#abc4674f17b06a1504d045b9024d786eb">ZEBRA_ERR_RTUNREACH</a>:
             <span class="keywordflow">default</span>:
               <span class="comment">/* This point is reachable regardless of debugging mode. */</span>
               <span class="keywordflow">if</span> (!<a class="code" href="debug_8h.html#a5a02ca7cbeffc38327da8ae638a81c31">IS_ZEBRA_DEBUG_RIB</a>)
                 <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, prefix_buf, <a class="code" href="prefix_8h.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a>);
               <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;%s: %s/%d: rtm_write() unexpectedly returned %d for command %s&quot;</span>,
                 __func__, prefix_buf, p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>, error, <a class="code" href="log_8c.html#a167ff2c0459de0db557c14c2171c9c76">lookup</a> (<a class="code" href="kernel__socket_8c.html#abde8587e366f57128877856ecca368e1">rtm_type_str</a>, cmd));
               <span class="keywordflow">break</span>;
           }
         } <span class="comment">/* if (cmd and flags make sense) */</span>
       <span class="keywordflow">else</span>
         <span class="keywordflow">if</span> (<a class="code" href="debug_8h.html#a5a02ca7cbeffc38327da8ae638a81c31">IS_ZEBRA_DEBUG_RIB</a>)
           <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s: odd command %s for flags %d&quot;</span>,
             __func__, <a class="code" href="log_8c.html#a167ff2c0459de0db557c14c2171c9c76">lookup</a> (<a class="code" href="kernel__socket_8c.html#abde8587e366f57128877856ecca368e1">rtm_type_str</a>, cmd), nexthop-&gt;<a class="code" href="structnexthop.html#a9fe6fe2ff3e0fc1ddfabe888ee9d00ad">flags</a>);
     } <span class="comment">/* for (nexthop = ... */</span>
 
   <span class="comment">/* If there was no useful nexthop, then complain. */</span>
   <span class="keywordflow">if</span> (nexthop_num == 0 &amp;&amp; <a class="code" href="debug_8h.html#a33a806e67d434f56a9660b78ef2fd198">IS_ZEBRA_DEBUG_KERNEL</a>)
     <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s: No useful nexthops were found in RIB entry %p&quot;</span>, __func__, rib);

  <span class="keywordflow">return</span> 0; <span class="comment">/*XXX*/</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae83413a0f6a15fa53dcf5befcebe9c2c"></a><!-- doxytag: member="rt_socket.c::rtm_write" ref="ae83413a0f6a15fa53dcf5befcebe9c2c" args="(int message, union sockunion *dest, union sockunion *mask, union sockunion *gate, unsigned int index, int zebra_flags, int metric)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rtm_write </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionsockunion.html">sockunion</a> *&#160;</td>
          <td class="paramname"><em>gate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>zebra_flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>metric</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="kernel__socket_8c_source.html#l00958">958</a> of file <a class="el" href="kernel__socket_8c_source.html">kernel_socket.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  caddr_t pnt;
  <span class="keyword">struct </span><a class="code" href="structinterface.html">interface</a> *ifp;

  <span class="comment">/* Sequencial number of routing message. */</span>
  <span class="keyword">static</span> <span class="keywordtype">int</span> msg_seq = 0;

  <span class="comment">/* Struct of rt_msghdr and buffer for storing socket&#39;s data. */</span>
  <span class="keyword">struct </span>
  {
    <span class="keyword">struct </span>rt_msghdr rtm;
    <span class="keywordtype">char</span> buf[512];
  } <a class="code" href="structmsg.html">msg</a>;
  
  <span class="keywordflow">if</span> (<a class="code" href="kernel__socket_8c.html#a6af200af34539ad29493115c6bf892a5">routing_sock</a> &lt; 0)
    <span class="keywordflow">return</span> <a class="code" href="zebra_8h.html#a687118019065da5a34e06d98d56eb714">ZEBRA_ERR_EPERM</a>;

  <span class="comment">/* Clear and set rt_msghdr values */</span>
  memset (&amp;<a class="code" href="structmsg.html">msg</a>, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> rt_msghdr));
  <a class="code" href="structmsg.html">msg</a>.rtm.rtm_version = RTM_VERSION;
  <a class="code" href="structmsg.html">msg</a>.rtm.rtm_type = <a class="code" href="structmessage.html">message</a>;
  <a class="code" href="structmsg.html">msg</a>.rtm.rtm_seq = msg_seq++;
  <a class="code" href="structmsg.html">msg</a>.rtm.rtm_addrs = RTA_DST;
  <a class="code" href="structmsg.html">msg</a>.rtm.rtm_addrs |= RTA_GATEWAY;
  <a class="code" href="structmsg.html">msg</a>.rtm.rtm_flags = RTF_UP;
  <a class="code" href="structmsg.html">msg</a>.rtm.rtm_index = index;

  <span class="keywordflow">if</span> (<a class="code" href="structmetric.html">metric</a> != 0)
    {
      <a class="code" href="structmsg.html">msg</a>.rtm.rtm_rmx.rmx_hopcount = <a class="code" href="structmetric.html">metric</a>;
      <a class="code" href="structmsg.html">msg</a>.rtm.rtm_inits |= RTV_HOPCOUNT;
    }

  ifp = <a class="code" href="if_8c.html#a424dd1e971aee548383cca2b770e2859">if_lookup_by_index</a> (index);

  <span class="keywordflow">if</span> (gate &amp;&amp; <a class="code" href="structmessage.html">message</a> == RTM_ADD)
    <a class="code" href="structmsg.html">msg</a>.rtm.rtm_flags |= RTF_GATEWAY;

  <span class="comment">/* When RTF_CLONING is unavailable on BSD, should we set some</span>
<span class="comment">   * other flag instead?</span>
<span class="comment">   */</span>
<span class="preprocessor">#ifdef RTF_CLONING</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (! gate &amp;&amp; <a class="code" href="structmessage.html">message</a> == RTM_ADD &amp;&amp; ifp &amp;&amp;
      (ifp-&gt;<a class="code" href="structinterface.html#a09ed96b900f31d769a76a32b67217c8f">flags</a> &amp; IFF_POINTOPOINT) == 0)
    <a class="code" href="structmsg.html">msg</a>.rtm.rtm_flags |= RTF_CLONING;
<span class="preprocessor">#endif </span><span class="comment">/* RTF_CLONING */</span>

  <span class="comment">/* If no protocol specific gateway is specified, use link</span>
<span class="comment">     address for gateway. */</span>
  <span class="keywordflow">if</span> (! gate)
    {
      <span class="keywordflow">if</span> (!ifp)
        {
          <span class="keywordtype">char</span> dest_buf[<a class="code" href="prefix_8h.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a>] = <span class="stringliteral">&quot;NULL&quot;</span>, mask_buf[<a class="code" href="prefix_8h.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a>] = <span class="stringliteral">&quot;255.255.255.255&quot;</span>;
          <span class="keywordflow">if</span> (dest)
            <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;dest-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr, dest_buf, <a class="code" href="prefix_8h.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a>);
          <span class="keywordflow">if</span> (mask)
            <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET, &amp;mask-&gt;<a class="code" href="unionsockunion.html#a50fab1a37b798a49a085f78351680ab7">sin</a>.sin_addr, mask_buf, <a class="code" href="prefix_8h.html#a93b37007689284fd9c4bde1a8f4b9199">INET_ADDRSTRLEN</a>);
          <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;%s: %s/%s: gate == NULL and no gateway found for ifindex %d&quot;</span>,
            __func__, dest_buf, mask_buf, index);
          <span class="keywordflow">return</span> -1;
        }
      gate = (<span class="keyword">union </span><a class="code" href="unionsockunion.html">sockunion</a> *) &amp; ifp-&gt;sdl;
    }

  <span class="keywordflow">if</span> (mask)
    <a class="code" href="structmsg.html">msg</a>.rtm.rtm_addrs |= RTA_NETMASK;
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="structmessage.html">message</a> == RTM_ADD) 
    <a class="code" href="structmsg.html">msg</a>.rtm.rtm_flags |= RTF_HOST;

  <span class="comment">/* Tagging route with flags */</span>
  <a class="code" href="structmsg.html">msg</a>.rtm.rtm_flags |= (RTF_PROTO1);

  <span class="comment">/* Additional flags. */</span>
  <span class="keywordflow">if</span> (zebra_flags &amp; <a class="code" href="zebra_8h.html#ab3b7a4bd090244ae1b882b9003810713">ZEBRA_FLAG_BLACKHOLE</a>)
    <a class="code" href="structmsg.html">msg</a>.rtm.rtm_flags |= RTF_BLACKHOLE;
  <span class="keywordflow">if</span> (zebra_flags &amp; <a class="code" href="zebra_8h.html#ade86fda8e343fab895b8996b27358ca0">ZEBRA_FLAG_REJECT</a>)
    <a class="code" href="structmsg.html">msg</a>.rtm.rtm_flags |= RTF_REJECT;


<span class="preprocessor">#ifdef HAVE_STRUCT_SOCKADDR_IN_SIN_LEN</span>
<span class="preprocessor"></span><span class="preprocessor">#define SOCKADDRSET(X,R) \</span>
<span class="preprocessor">  if (msg.rtm.rtm_addrs &amp; (R)) \</span>
<span class="preprocessor">    { \</span>
<span class="preprocessor">      int len = ROUNDUP ((X)-&gt;sa.sa_len); \</span>
<span class="preprocessor">      memcpy (pnt, (caddr_t)(X), len); \</span>
<span class="preprocessor">      pnt += len; \</span>
<span class="preprocessor">    }</span>
<span class="preprocessor"></span><span class="preprocessor">#else </span>
<span class="preprocessor"></span><span class="preprocessor">#define SOCKADDRSET(X,R) \</span>
<span class="preprocessor">  if (msg.rtm.rtm_addrs &amp; (R)) \</span>
<span class="preprocessor">    { \</span>
<span class="preprocessor">      int len = SAROUNDUP (X); \</span>
<span class="preprocessor">      memcpy (pnt, (caddr_t)(X), len); \</span>
<span class="preprocessor">      pnt += len; \</span>
<span class="preprocessor">    }</span>
<span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* HAVE_STRUCT_SOCKADDR_IN_SIN_LEN */</span>

  pnt = (caddr_t) <a class="code" href="structmsg.html">msg</a>.buf;

  <span class="comment">/* Write each socket data into rtm message buffer */</span>
  <a class="code" href="kernel__socket_8c.html#a8c3fbeae695134b671223ceca5e9a767">SOCKADDRSET</a> (dest, RTA_DST);
  <a class="code" href="kernel__socket_8c.html#a8c3fbeae695134b671223ceca5e9a767">SOCKADDRSET</a> (gate, RTA_GATEWAY);
  <a class="code" href="kernel__socket_8c.html#a8c3fbeae695134b671223ceca5e9a767">SOCKADDRSET</a> (mask, RTA_NETMASK);

  <a class="code" href="structmsg.html">msg</a>.rtm.rtm_msglen = pnt - (caddr_t) &amp;<a class="code" href="structmsg.html">msg</a>;

  ret = write (<a class="code" href="kernel__socket_8c.html#a6af200af34539ad29493115c6bf892a5">routing_sock</a>, &amp;<a class="code" href="structmsg.html">msg</a>, <a class="code" href="structmsg.html">msg</a>.rtm.rtm_msglen);

  <span class="keywordflow">if</span> (ret != <a class="code" href="structmsg.html">msg</a>.rtm.rtm_msglen) 
    {
      <span class="keywordflow">if</span> (errno == EEXIST) 
    <span class="keywordflow">return</span> <a class="code" href="zebra_8h.html#a0a0de38e97fdf5982db3089fbd2f5390">ZEBRA_ERR_RTEXIST</a>;
      <span class="keywordflow">if</span> (errno == ENETUNREACH)
    <span class="keywordflow">return</span> <a class="code" href="zebra_8h.html#abc4674f17b06a1504d045b9024d786eb">ZEBRA_ERR_RTUNREACH</a>;
      <span class="keywordflow">if</span> (errno == ESRCH)
    <span class="keywordflow">return</span> <a class="code" href="zebra_8h.html#a58dc80805c425ed7b6b46364b2d84fac">ZEBRA_ERR_RTNOEXIST</a>;
      
      <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;%s: write : %s (%d)&quot;</span>, __func__, <a class="code" href="log_8c.html#a5292a9aa20fcddbb3998241685e18279">safe_strerror</a> (errno), errno);
      <span class="keywordflow">return</span> <a class="code" href="zebra_8h.html#af87ff252b3e60981091069ea93c51479">ZEBRA_ERR_KERNEL</a>;
    }
  <span class="keywordflow">return</span> <a class="code" href="zebra_8h.html#a3dd4dbac0d42b8c4b7cc0e2947fb78cf">ZEBRA_ERR_NOERROR</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aaebd826fb4f08138eb80484dd21e3dcb"></a><!-- doxytag: member="rt_socket.c::sin_masklen" ref="aaebd826fb4f08138eb80484dd21e3dcb" args="(struct in_addr mask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int sin_masklen </td>
          <td>(</td>
          <td class="paramtype">struct in_addr&#160;</td>
          <td class="paramname"><em>mask</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rt__socket_8c_source.html#l00047">47</a> of file <a class="el" href="rt__socket_8c_source.html">rt_socket.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">char</span> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, *lim;
  <span class="keywordtype">int</span> len;
  <span class="keyword">struct </span>sockaddr_in sin;

  <span class="keywordflow">if</span> (mask.s_addr == 0) 
    <span class="keywordflow">return</span> <span class="keyword">sizeof</span> (long);

  sin.sin_addr = mask;
  len = <span class="keyword">sizeof</span> (<span class="keyword">struct </span>sockaddr_in);

  lim = (<span class="keywordtype">char</span> *) &amp;sin.sin_addr;
  p = lim + sizeof (sin.sin_addr);

  <span class="keywordflow">while</span> (*--p == 0 &amp;&amp; p &gt;= lim) 
    len--;
  <span class="keywordflow">return</span> len;
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a10659da9c59441877a609c3cd916f3cf"></a><!-- doxytag: member="rt_socket.c::zserv_privs" ref="a10659da9c59441877a609c3cd916f3cf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structzebra__privs__t.html">zebra_privs_t</a> <a class="el" href="zserv_8c.html#a10659da9c59441877a609c3cd916f3cf">zserv_privs</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="zebra_2main_8c_source.html#l00096">96</a> of file <a class="el" href="zebra_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="rt__socket_8c.html">rt_socket.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:38 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
