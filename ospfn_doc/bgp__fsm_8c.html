<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: bgpd/bgp_fsm.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('bgp__fsm_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">bgpd/bgp_fsm.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="zebra_8h_source.html">zebra.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="linklist_8h_source.html">linklist.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="prefix_8h_source.html">prefix.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vty_8h_source.html">vty.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sockunion_8h_source.html">sockunion.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="thread_8h_source.html">thread.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stream_8h_source.html">stream.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="memory_8h_source.html">memory.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="plist_8h_source.html">plist.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgpd_8h_source.html">bgpd/bgpd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__attr_8h_source.html">bgpd/bgp_attr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__debug_8h_source.html">bgpd/bgp_debug.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__fsm_8h_source.html">bgpd/bgp_fsm.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__packet_8h_source.html">bgpd/bgp_packet.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__network_8h_source.html">bgpd/bgp_network.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__route_8h_source.html">bgpd/bgp_route.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__dump_8h_source.html">bgpd/bgp_dump.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__open_8h_source.html">bgpd/bgp_open.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for bgp_fsm.c:</div>
<div class="dyncontent">
<div class="center"><img src="bgp__fsm_8c__incl.png" border="0" usemap="#bgpd_2bgp__fsm_8c" alt=""/></div>
<map name="bgpd_2bgp__fsm_8c" id="bgpd_2bgp__fsm_8c">
<area shape="rect" id="node3" href="zebra_8h.html" title="zebra.h" alt="" coords="1345,80,1412,107"/><area shape="rect" id="node61" href="linklist_8h.html" title="linklist.h" alt="" coords="2949,80,3019,107"/><area shape="rect" id="node63" href="prefix_8h.html" title="prefix.h" alt="" coords="3122,155,3189,181"/><area shape="rect" id="node65" href="sockunion_8h.html" title="sockunion.h" alt="" coords="3109,229,3203,256"/><area shape="rect" id="node67" href="vty_8h.html" title="vty.h" alt="" coords="2821,80,2872,107"/><area shape="rect" id="node69" href="thread_8h.html" title="thread.h" alt="" coords="2875,155,2947,181"/><area shape="rect" id="node71" href="log_8h.html" title="log.h" alt="" coords="2798,155,2849,181"/><area shape="rect" id="node77" href="stream_8h.html" title="stream.h" alt="" coords="3145,80,3220,107"/><area shape="rect" id="node80" href="memory_8h.html" title="memory.h" alt="" coords="3369,80,3452,107"/><area shape="rect" id="node84" href="plist_8h.html" title="plist.h" alt="" coords="3476,80,3535,107"/><area shape="rect" id="node86" href="bgpd_8h.html" title="bgpd/bgpd.h" alt="" coords="3245,80,3344,107"/><area shape="rect" id="node89" href="bgp__attr_8h.html" title="bgpd/bgp_attr.h" alt="" coords="3565,155,3685,181"/><area shape="rect" id="node91" href="bgp__debug_8h.html" title="bgpd/bgp_debug.h" alt="" coords="3609,80,3748,107"/><area shape="rect" id="node94" href="bgp__fsm_8h.html" title="bgpd/bgp_fsm.h" alt="" coords="3773,80,3893,107"/><area shape="rect" id="node96" href="bgp__packet_8h.html" title="bgpd/bgp_packet.h" alt="" coords="3918,80,4057,107"/><area shape="rect" id="node98" href="bgp__network_8h.html" title="bgpd/bgp_network.h" alt="" coords="4082,80,4229,107"/><area shape="rect" id="node100" href="bgp__route_8h.html" title="bgpd/bgp_route.h" alt="" coords="4255,80,4385,107"/><area shape="rect" id="node104" href="bgp__dump_8h.html" title="bgpd/bgp_dump.h" alt="" coords="4409,80,4543,107"/><area shape="rect" id="node106" href="bgp__open_8h.html" title="bgpd/bgp_open.h" alt="" coords="4567,80,4697,107"/><area shape="rect" id="node57" href="zassert_8h.html" title="zassert.h" alt="" coords="2623,155,2700,181"/><area shape="rect" id="node59" href="str_8h.html" title="str.h" alt="" coords="2725,155,2773,181"/><area shape="rect" id="node82" href="memtypes_8h.html" title="lib/memtypes.h" alt="" coords="3353,155,3468,181"/><area shape="rect" id="node102" href="bgp__table_8h.html" title="bgp_table.h" alt="" coords="4273,155,4367,181"/></map>
</div>
</div>
<p><a href="bgp__fsm_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#ad9ce88248446ff0372b352a095212a03">BGP_PEER_START_SUPPRESSED</a>(P)</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a0ca676929248063979d5b120114cbccd">bgp_event</a> (struct <a class="el" href="structthread.html">thread</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a6376ed698f2472152192884e4834f45e">bgp_start_timer</a> (struct <a class="el" href="structthread.html">thread</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a00534644637211950775a0c09c30b184">bgp_connect_timer</a> (struct <a class="el" href="structthread.html">thread</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a6a478dce126762a49478f511d22e3744">bgp_holdtime_timer</a> (struct <a class="el" href="structthread.html">thread</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#ab1b3731e45da5d4889eb7a8eefe6f647">bgp_keepalive_timer</a> (struct <a class="el" href="structthread.html">thread</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#aa37215b69bb5e93cc41137bd278a9c9b">bgp_start</a> (struct <a class="el" href="structpeer.html">peer</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#afbc7bca040c07e81b9431b7b171b2d89">bgp_start_jitter</a> (int time)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a0dae67b35f2ffb6d6e7f9b1a6684e0aa">bgp_timer_set</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a66dc307fde4b0ec3bff966374f22181c">bgp_routeadv_timer</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a9e33b04e19f066ddd88661d79b117a1c">bgp_graceful_restart_timer_expire</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#abdf2a409fcad0cf22682f61f74d4f937">bgp_graceful_stale_timer_expire</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#ae5bbbc9f4290574b72885050744741fd">bgp_fsm_change_status</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, int status)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a1529ace83c11c70e885748a7d5cef369">bgp_clearing_completed</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a70832c80e2f7e40a453d23689818d84a">bgp_stop</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a4de2dbc91c9ad88b682235e96971d05b">bgp_stop_with_error</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a52ed36fb0e6488b293fea56eec30c725">bgp_connect_success</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a9cbac9dc4aff902b0bbe76ac2236f1ec">bgp_connect_fail</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a276e1b5f94212b4438ec33a431a2fbce">bgp_reconnect</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a1c8b28ef45c18a5b325ae627b5838da5">bgp_fsm_open</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a2197d009501485aba614c926082d35d3">bgp_fsm_keepalive_expire</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#af6db30df036113a576bb80478f2ee625">bgp_fsm_holdtime_expire</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#ab723d29ef85668237eaf5a71ca16a709">bgp_establish</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a1890ee2987827600e9e11c7ace44c029">bgp_fsm_keepalive</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#acb64630e4113d7112ff13ed0f2ce2c96">bgp_fsm_update</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#ad355fa89ae4a521cc69c3cf30dfbb2b2">bgp_ignore</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a20174a312cef5d9aa6905c8bf6037020">peer_down_str</a> []</td></tr>
<tr><td class="memItemLeft" >struct {</td></tr>
<tr><td class="memItemLeft" >&#160;&#160;&#160;int(*&#160;&#160;&#160;<a class="el" href="bgp__fsm_8c.html#aad6d5d0fbfe60193366eaab88413f7af">func</a> )(struct <a class="el" href="structpeer.html">peer</a> *)</td></tr>
<tr><td class="memItemLeft" >&#160;&#160;&#160;int&#160;&#160;&#160;<a class="el" href="bgp__fsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a></td></tr>
<tr><td class="memItemLeft" valign="top">}&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a> [BGP_STATUS_MAX-1][BGP_EVENTS_MAX-1]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__fsm_8c.html#a4a8b0fec5e2e678cd1c5824ab4662ce6">bgp_event_str</a> []</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ad9ce88248446ff0372b352a095212a03"></a><!-- doxytag: member="bgp_fsm.c::BGP_PEER_START_SUPPRESSED" ref="ad9ce88248446ff0372b352a095212a03" args="(P)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BGP_PEER_START_SUPPRESSED</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">P</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">(<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> ((P)-&gt;<a class="code" href="structflags.html">flags</a>, <a class="code" href="bgpd_8h.html#abeded936fd302062253377062392247d">PEER_FLAG_SHUTDOWN</a>) \
   || <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> ((P)-&gt;sflags, <a class="code" href="bgpd_8h.html#a6df26783180e94b98072394c3c19e11b">PEER_STATUS_PREFIX_OVERFLOW</a>))
</pre></div>
<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00072">72</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a1529ace83c11c70e885748a7d5cef369"></a><!-- doxytag: member="bgp_fsm.c::bgp_clearing_completed" ref="a1529ace83c11c70e885748a7d5cef369" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_clearing_completed </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00424">424</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> rc = <a class="code" href="bgp__fsm_8c.html#a70832c80e2f7e40a453d23689818d84a">bgp_stop</a>(peer);
  <a class="code" href="bgp__fsm_8h.html#af4f1a52b106aa7dbf3494d0debf644d3">BGP_EVENT_FLUSH</a> (peer);

  <span class="keywordflow">return</span> rc;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9cbac9dc4aff902b0bbe76ac2236f1ec"></a><!-- doxytag: member="bgp_fsm.c::bgp_connect_fail" ref="a9cbac9dc4aff902b0bbe76ac2236f1ec" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_connect_fail </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00630">630</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="bgp__fsm_8c.html#a70832c80e2f7e40a453d23689818d84a">bgp_stop</a> (peer);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a52ed36fb0e6488b293fea56eec30c725"></a><!-- doxytag: member="bgp_fsm.c::bgp_connect_success" ref="a52ed36fb0e6488b293fea56eec30c725" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_connect_success </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00598">598</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">char</span> buf1[BUFSIZ];

  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a593c49b1167d88eb2d2900db47eb5d9d">fd</a> &lt; 0)
    {
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;bgp_connect_success peer&#39;s fd is negative value %d&quot;</span>,
        peer-&gt;<a class="code" href="structpeer.html#a593c49b1167d88eb2d2900db47eb5d9d">fd</a>);
      <span class="keywordflow">return</span> -1;
    }
  <a class="code" href="bgp__fsm_8h.html#a62b5746c9e6a92bffde54f2dc61557d7">BGP_READ_ON</a> (peer-&gt;<a class="code" href="structpeer.html#a51f641e77c077e7e3355a65bd3e51dac">t_read</a>, <a class="code" href="bgp__packet_8c.html#a3a37390260357b584d8fd7b3591b2058">bgp_read</a>, peer-&gt;<a class="code" href="structpeer.html#a593c49b1167d88eb2d2900db47eb5d9d">fd</a>);

  <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#a4b52af7b570cb9bf7c57f3bd5ea71b73">PEER_STATUS_ACCEPT_PEER</a>))
    <a class="code" href="bgp__network_8c.html#a2079c55451759a453b0f416a16d75f86">bgp_getsockname</a> (peer);

  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (normal, NORMAL))
    {
      <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#a4b52af7b570cb9bf7c57f3bd5ea71b73">PEER_STATUS_ACCEPT_PEER</a>))
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s open active, local address %s&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
            <a class="code" href="sockunion_8c.html#a93759e01ddbd86605e1716a5c5b27a9e">sockunion2str</a> (peer-&gt;<a class="code" href="structpeer.html#a063537a13602c890880e9c4f1d6fccd3">su_local</a>, buf1, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>));
      <span class="keywordflow">else</span>
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s passive open&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
    }

  <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#a4b52af7b570cb9bf7c57f3bd5ea71b73">PEER_STATUS_ACCEPT_PEER</a>))
    <a class="code" href="bgp__packet_8c.html#ae1767b91e9e958ab92372f1e2af46c2b">bgp_open_send</a> (peer);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a00534644637211950775a0c09c30b184"></a><!-- doxytag: member="bgp_fsm.c::bgp_connect_timer" ref="a00534644637211950775a0c09c30b184" args="(struct thread *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_connect_timer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00238">238</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *<a class="code" href="structpeer.html">peer</a>;

  peer = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  peer-&gt;<a class="code" href="structpeer.html#a7badb9ad50dae6376ecaa005318676e4">t_connect</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (fsm, <a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a>))
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG, <span class="stringliteral">&quot;%s [FSM] Timer (connect timer expire)&quot;</span>,
      peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);

  <a class="code" href="thread_8h.html#a88d7c483cad15baac709fac747480a11">THREAD_VAL</a> (thread) = <a class="code" href="bgpd_8h.html#a41c00db2b65f3526cc1c370f42b95e45">ConnectRetry_timer_expired</a>;
  <a class="code" href="bgp__fsm_8c.html#a0ca676929248063979d5b120114cbccd">bgp_event</a> (thread); <span class="comment">/* bgp_event unlocks peer */</span>

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab723d29ef85668237eaf5a71ca16a709"></a><!-- doxytag: member="bgp_fsm.c::bgp_establish" ref="ab723d29ef85668237eaf5a71ca16a709" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_establish </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00771">771</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__notify.html">bgp_notify</a> *notify;
  <a class="code" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi;
  <a class="code" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi;
  <span class="keywordtype">int</span> nsf_af_count = 0;

  <span class="comment">/* Reset capability open status flag. */</span>
  <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#a9a660ebeb4fec952cc45f6945a6f1722">PEER_STATUS_CAPABILITY_OPEN</a>))
    <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#a9a660ebeb4fec952cc45f6945a6f1722">PEER_STATUS_CAPABILITY_OPEN</a>);

  <span class="comment">/* Clear last notification data. */</span>
  notify = &amp;peer-&gt;<a class="code" href="structpeer.html#af794a3e8a439d6e3a44ccf9723049a23">notify</a>;
  <span class="keywordflow">if</span> (notify-&gt;<a class="code" href="structbgp__notify.html#aae5f1fab36e60b67e64aeea7146d2364">data</a>)
    <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba563963518edb70d4cd7492b06f48106e">MTYPE_TMP</a>, notify-&gt;<a class="code" href="structbgp__notify.html#aae5f1fab36e60b67e64aeea7146d2364">data</a>);
  memset (notify, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structbgp__notify.html">bgp_notify</a>));

  <span class="comment">/* Clear start timer value to default. */</span>
  peer-&gt;<a class="code" href="structpeer.html#a82d93e09c2e715abdb362fa6b5059908">v_start</a> = <a class="code" href="bgpd_8h.html#a0631163bad4d36c78fad00669e254985">BGP_INIT_START_TIMER</a>;

  <span class="comment">/* Increment established count. */</span>
  peer-&gt;<a class="code" href="structpeer.html#a7e83fe65d0739a31eb5025f2aa0a6d51">established</a>++;
  <a class="code" href="bgp__fsm_8c.html#ae5bbbc9f4290574b72885050744741fd">bgp_fsm_change_status</a> (peer, <a class="code" href="bgpd_8h.html#aa87809ec7dea97b0e970e98ae6c181ea">Established</a>);

  <span class="comment">/* bgp log-neighbor-changes of neighbor Up */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#a0b3388d8ac73af2d4f4f22e46746da1e">bgp_flag_check</a> (peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>, <a class="code" href="bgpd_8h.html#a4871d191e1b11258fc7d58365a8de88b">BGP_FLAG_LOG_NEIGHBOR_CHANGES</a>))
    <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a> (<span class="stringliteral">&quot;%%ADJCHANGE: neighbor %s Up&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);

  <span class="comment">/* graceful restart */</span>
  <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#aa97d7e86e0f1905a85364af66368896f">PEER_STATUS_NSF_WAIT</a>);
  <span class="keywordflow">for</span> (afi = <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> ; afi &lt; <a class="code" href="zebra_8h.html#abf129a17e985713a26a6181a198d5f1a">AFI_MAX</a> ; afi++)
    <span class="keywordflow">for</span> (safi = <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a> ; safi &lt; <a class="code" href="zebra_8h.html#acd7929dcab1201ad7ca0de9cb5b8a06c">SAFI_UNICAST_MULTICAST</a> ; safi++)
      {
    <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a08da0f40c72c2016e659539e6af6dc2d">afc_nego</a>[afi][safi]
        &amp;&amp; <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a64eadd546a8c50dfe6a6dcb635c3822d">cap</a>, <a class="code" href="bgpd_8h.html#a0676dbf05f735073d261e5a01b1c7dcb">PEER_CAP_RESTART_ADV</a>)
        &amp;&amp; <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#ae585bd174f4b8a4346359d7240eb886b">PEER_CAP_RESTART_AF_RCV</a>))
      {
        <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a36e9e912b00326f95bd69cb6afc11efd">nsf</a>[afi][safi]
        &amp;&amp; ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#ab616defb577ded71e32c1b6b6627d66b">PEER_CAP_RESTART_AF_PRESERVE_RCV</a>))
          <a class="code" href="bgp__route_8c.html#aa1dd948948425c7e30941a8816af5bb1">bgp_clear_stale_route</a> (peer, afi, safi);

        peer-&gt;<a class="code" href="structpeer.html#a36e9e912b00326f95bd69cb6afc11efd">nsf</a>[afi][safi] = 1;
        nsf_af_count++;
      }
    <span class="keywordflow">else</span>
      {
        <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a36e9e912b00326f95bd69cb6afc11efd">nsf</a>[afi][safi])
          <a class="code" href="bgp__route_8c.html#aa1dd948948425c7e30941a8816af5bb1">bgp_clear_stale_route</a> (peer, afi, safi);
        peer-&gt;<a class="code" href="structpeer.html#a36e9e912b00326f95bd69cb6afc11efd">nsf</a>[afi][safi] = 0;
      }
      }

  <span class="keywordflow">if</span> (nsf_af_count)
    <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#a4ff62dffb922440e74de66efee6f8f42">PEER_STATUS_NSF_MODE</a>);
  <span class="keywordflow">else</span>
    {
      <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#a4ff62dffb922440e74de66efee6f8f42">PEER_STATUS_NSF_MODE</a>);
      <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ada375f793bffb7304b39c227704ba406">t_gr_stale</a>)
    {
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ada375f793bffb7304b39c227704ba406">t_gr_stale</a>);
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (events, EVENTS))
        <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s graceful restart stalepath timer stopped&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
    }
    }

  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a4fdfea0c52fcb6c48138fc9c817d7b41">t_gr_restart</a>)
    {
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a4fdfea0c52fcb6c48138fc9c817d7b41">t_gr_restart</a>);
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (events, EVENTS))
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s graceful restart timer stopped&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
    }

<span class="preprocessor">#ifdef HAVE_SNMP</span>
<span class="preprocessor"></span>  <a class="code" href="bgp__snmp_8h.html#aa020a6fafed939a240aa15f7e36ec578">bgpTrapEstablished</a> (peer);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_SNMP */</span>

  <span class="comment">/* Reset uptime, send keepalive, send current table. */</span>
  peer-&gt;<a class="code" href="structpeer.html#a008ca2beea8dd058639039cf2b468844">uptime</a> = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();

  <span class="comment">/* Send route-refresh when ORF is enabled */</span>
  <span class="keywordflow">for</span> (afi = <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> ; afi &lt; <a class="code" href="zebra_8h.html#abf129a17e985713a26a6181a198d5f1a">AFI_MAX</a> ; afi++)
    <span class="keywordflow">for</span> (safi = <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a> ; safi &lt; <a class="code" href="zebra_8h.html#a82fe6f63e822f7bf9e4567873d809ed8">SAFI_MAX</a> ; safi++)
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#ae99d45fd54765fe6d108e85214135de1">PEER_CAP_ORF_PREFIX_SM_ADV</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#ae3b16174b0caeeb5d046eb673138187d">PEER_CAP_ORF_PREFIX_RM_RCV</a>))
        <a class="code" href="bgp__packet_8c.html#af79d4c999f0c6321ab65049fb47dc78d">bgp_route_refresh_send</a> (peer, afi, safi, <a class="code" href="bgp__open_8h.html#adc5dbdce1a3677ba56d250c98f0d56ff">ORF_TYPE_PREFIX</a>,
                    <a class="code" href="bgp__packet_8h.html#aea8b89e482c433839e04fcb2c59f022c">REFRESH_IMMEDIATE</a>, 0);
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#ab3ce0a5a8efd2d2b846abdad6ec4a9d6">PEER_CAP_ORF_PREFIX_RM_OLD_RCV</a>))
        <a class="code" href="bgp__packet_8c.html#af79d4c999f0c6321ab65049fb47dc78d">bgp_route_refresh_send</a> (peer, afi, safi, <a class="code" href="bgp__open_8h.html#a08c45b6907c24b44c5db40587b4abb15">ORF_TYPE_PREFIX_OLD</a>,
                    <a class="code" href="bgp__packet_8h.html#aea8b89e482c433839e04fcb2c59f022c">REFRESH_IMMEDIATE</a>, 0);
    }

  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a4683327b18d77b5888cc293b180f01ff">v_keepalive</a>)
    <a class="code" href="bgp__packet_8c.html#a8b6e388946a87579949ef337af70d3b2">bgp_keepalive_send</a> (peer);

  <span class="comment">/* First update is deferred until ORF or ROUTE-REFRESH is received */</span>
  <span class="keywordflow">for</span> (afi = <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> ; afi &lt; <a class="code" href="zebra_8h.html#abf129a17e985713a26a6181a198d5f1a">AFI_MAX</a> ; afi++)
    <span class="keywordflow">for</span> (safi = <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a> ; safi &lt; <a class="code" href="zebra_8h.html#a82fe6f63e822f7bf9e4567873d809ed8">SAFI_MAX</a> ; safi++)
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#aa073ee4ea1d90b2d2971682f4a373776">PEER_CAP_ORF_PREFIX_RM_ADV</a>))
    <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#a4883c0951321050f52731ef009c2dd17">PEER_CAP_ORF_PREFIX_SM_RCV</a>)
        || <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#ae0da0dd013880e12f7d1160d002735a6">PEER_CAP_ORF_PREFIX_SM_OLD_RCV</a>))
      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi], <a class="code" href="bgpd_8h.html#af38b3d01fa7faa6698e76d7932ff717f">PEER_STATUS_ORF_WAIT_REFRESH</a>);

  <a class="code" href="bgp__route_8c.html#a2339aa5e61e6711862d4f6e0eab3ce56">bgp_announce_route_all</a> (peer);

  <a class="code" href="bgp__fsm_8h.html#aaf9fcd8314ca70eef21f5689423d7152">BGP_TIMER_ON</a> (peer-&gt;<a class="code" href="structpeer.html#a81042b1115a4cc6ced7d496a1aaaacac">t_routeadv</a>, <a class="code" href="bgp__fsm_8c.html#a66dc307fde4b0ec3bff966374f22181c">bgp_routeadv_timer</a>, 1);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0ca676929248063979d5b120114cbccd"></a><!-- doxytag: member="bgp_fsm.c::bgp_event" ref="a0ca676929248063979d5b120114cbccd" args="(struct thread *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_event </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l01076">1076</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret = 0;
  <span class="keywordtype">int</span> <a class="code" href="vty_8c.html#a3b65133bb9997cd1ccf311af0927fc9e">event</a>;
  <span class="keywordtype">int</span> next;
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *<a class="code" href="structpeer.html">peer</a>;

  peer = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  <span class="keyword">event</span> = <a class="code" href="thread_8h.html#a88d7c483cad15baac709fac747480a11">THREAD_VAL</a> (thread);

  <span class="comment">/* Logging this event. */</span>
  next = <a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a> [peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a> -1][<span class="keyword">event</span> - 1].next_state;

  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (fsm, <a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a>) &amp;&amp; peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a> != next)
    <a class="code" href="log_8h.html#a901efa2487b25c3a74846a52de919565">plog_debug</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, <span class="stringliteral">&quot;%s [FSM] %s (%s-&gt;%s)&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, 
           <a class="code" href="bgp__fsm_8c.html#a4a8b0fec5e2e678cd1c5824ab4662ce6">bgp_event_str</a>[event],
           <a class="code" href="log_8h.html#a3a4b1cad85aa6752f39580944e24a868">LOOKUP</a> (<a class="code" href="bgp__debug_8c.html#adfa19d3216f6254be62df3c23e338ad9">bgp_status_msg</a>, peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a>),
           <a class="code" href="log_8h.html#a3a4b1cad85aa6752f39580944e24a868">LOOKUP</a> (<a class="code" href="bgp__debug_8c.html#adfa19d3216f6254be62df3c23e338ad9">bgp_status_msg</a>, next));

  <span class="comment">/* Call function. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a> [peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a> -1][event - 1].func)
    ret = (*(<a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a> [peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a> - 1][<span class="keyword">event</span> - 1].func))(peer);

  <span class="comment">/* When function do not want proceed next job return -1. */</span>
  <span class="keywordflow">if</span> (ret &gt;= 0)
    {
      <span class="comment">/* If status is changed. */</span>
      <span class="keywordflow">if</span> (next != peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a>)
        <a class="code" href="bgp__fsm_8c.html#ae5bbbc9f4290574b72885050744741fd">bgp_fsm_change_status</a> (peer, next);
      
      <span class="comment">/* Make sure timer is set. */</span>
      <a class="code" href="bgp__fsm_8c.html#a0dae67b35f2ffb6d6e7f9b1a6684e0aa">bgp_timer_set</a> (peer);
    }
  
  <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae5bbbc9f4290574b72885050744741fd"></a><!-- doxytag: member="bgp_fsm.c::bgp_fsm_change_status" ref="ae5bbbc9f4290574b72885050744741fd" args="(struct peer *peer, int status)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_fsm_change_status </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>status</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00401">401</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="bgp__dump_8c.html#a583bbdd359820c2e8ecd9c64c39e3998">bgp_dump_state</a> (peer, peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a>, <a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a>);

  <span class="comment">/* Transition into Clearing or Deleted must /always/ clear all routes.. </span>
<span class="comment">   * (and must do so before actually changing into Deleted..</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a> &gt;= <a class="code" href="bgpd_8h.html#ac1826d1d659fefa5f3c15db9e57f7eb7">Clearing</a>)
    <a class="code" href="bgp__route_8c.html#ac73f860ac71768cc3169bf96512d1b1c">bgp_clear_route_all</a> (peer);
  
  <span class="comment">/* Preserve old status and change into new status. */</span>
  peer-&gt;<a class="code" href="structpeer.html#a6f5e76deea384483efc1f5bb27e51fbf">ostatus</a> = peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a>;
  peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a> = <a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a>;
  
  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (normal, NORMAL))
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s went from %s to %s&quot;</span>,
        peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
        <a class="code" href="log_8h.html#a3a4b1cad85aa6752f39580944e24a868">LOOKUP</a> (<a class="code" href="bgp__debug_8c.html#adfa19d3216f6254be62df3c23e338ad9">bgp_status_msg</a>, peer-&gt;<a class="code" href="structpeer.html#a6f5e76deea384483efc1f5bb27e51fbf">ostatus</a>),
        <a class="code" href="log_8h.html#a3a4b1cad85aa6752f39580944e24a868">LOOKUP</a> (<a class="code" href="bgp__debug_8c.html#adfa19d3216f6254be62df3c23e338ad9">bgp_status_msg</a>, peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a>));
}
</pre></div>
</div>
</div>
<a class="anchor" id="af6db30df036113a576bb80478f2ee625"></a><!-- doxytag: member="bgp_fsm.c::bgp_fsm_holdtime_expire" ref="af6db30df036113a576bb80478f2ee625" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_fsm_holdtime_expire </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00746">746</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (fsm, <a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a>))
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG, <span class="stringliteral">&quot;%s [FSM] Hold timer expire&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);

  <span class="comment">/* Send notify to remote peer. */</span>
  <a class="code" href="bgp__packet_8c.html#ac17989ee6afabce09c9d326fbbf6607b">bgp_notify_send</a> (peer, <a class="code" href="bgpd_8h.html#a195f8a19dfb2df7c88fdefd97db486cc">BGP_NOTIFY_HOLD_ERR</a>, 0);

  <span class="comment">/* Sweep if it is temporary peer. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#a4b52af7b570cb9bf7c57f3bd5ea71b73">PEER_STATUS_ACCEPT_PEER</a>))
    {
      <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a> (<span class="stringliteral">&quot;%s [Event] Accepting BGP peer is deleted&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
      <a class="code" href="bgpd_8c.html#a3cf7aaaf69048554d000a576ecb0cc9c">peer_delete</a> (peer);
      <span class="keywordflow">return</span> -1;
    }

  <span class="comment">/* bgp_stop needs to be invoked while in Established state */</span>
  <a class="code" href="bgp__fsm_8c.html#a70832c80e2f7e40a453d23689818d84a">bgp_stop</a>(peer);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1890ee2987827600e9e11c7ace44c029"></a><!-- doxytag: member="bgp_fsm.c::bgp_fsm_keepalive" ref="a1890ee2987827600e9e11c7ace44c029" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_fsm_keepalive </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00883">883</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">/* peer count update */</span>
  peer-&gt;<a class="code" href="structpeer.html#ad0f0ede8dbcf74fef9fd50a9086cb136">keepalive_in</a>++;

  <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2197d009501485aba614c926082d35d3"></a><!-- doxytag: member="bgp_fsm.c::bgp_fsm_keepalive_expire" ref="a2197d009501485aba614c926082d35d3" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_fsm_keepalive_expire </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00737">737</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="bgp__packet_8c.html#a8b6e388946a87579949ef337af70d3b2">bgp_keepalive_send</a> (peer);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1c8b28ef45c18a5b325ae627b5838da5"></a><!-- doxytag: member="bgp_fsm.c::bgp_fsm_open" ref="a1c8b28ef45c18a5b325ae627b5838da5" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_fsm_open </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00724">724</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">/* Send keepalive and make keepalive timer */</span>
  <a class="code" href="bgp__packet_8c.html#a8b6e388946a87579949ef337af70d3b2">bgp_keepalive_send</a> (peer);

  <span class="comment">/* Reset holdtimer value. */</span>
  <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acb64630e4113d7112ff13ed0f2ce2c96"></a><!-- doxytag: member="bgp_fsm.c::bgp_fsm_update" ref="acb64630e4113d7112ff13ed0f2ce2c96" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_fsm_update </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00894">894</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9e33b04e19f066ddd88661d79b117a1c"></a><!-- doxytag: member="bgp_fsm.c::bgp_graceful_restart_timer_expire" ref="a9e33b04e19f066ddd88661d79b117a1c" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_graceful_restart_timer_expire </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00347">347</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *<a class="code" href="structpeer.html">peer</a>;
  <a class="code" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi;
  <a class="code" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi;

  peer = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  peer-&gt;<a class="code" href="structpeer.html#a4fdfea0c52fcb6c48138fc9c817d7b41">t_gr_restart</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="comment">/* NSF delete stale route */</span>
  <span class="keywordflow">for</span> (afi = <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> ; afi &lt; <a class="code" href="zebra_8h.html#abf129a17e985713a26a6181a198d5f1a">AFI_MAX</a> ; afi++)
    <span class="keywordflow">for</span> (safi = <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a> ; safi &lt; <a class="code" href="zebra_8h.html#acd7929dcab1201ad7ca0de9cb5b8a06c">SAFI_UNICAST_MULTICAST</a> ; safi++)
      <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a36e9e912b00326f95bd69cb6afc11efd">nsf</a>[afi][safi])
    <a class="code" href="bgp__route_8c.html#aa1dd948948425c7e30941a8816af5bb1">bgp_clear_stale_route</a> (peer, afi, safi);

  <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#aa97d7e86e0f1905a85364af66368896f">PEER_STATUS_NSF_WAIT</a>);
  <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ada375f793bffb7304b39c227704ba406">t_gr_stale</a>);

  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (events, EVENTS))
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s graceful restart timer expired&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s graceful restart stalepath timer stopped&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
    }

  <a class="code" href="bgp__fsm_8c.html#a0dae67b35f2ffb6d6e7f9b1a6684e0aa">bgp_timer_set</a> (peer);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abdf2a409fcad0cf22682f61f74d4f937"></a><!-- doxytag: member="bgp_fsm.c::bgp_graceful_stale_timer_expire" ref="abdf2a409fcad0cf22682f61f74d4f937" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_graceful_stale_timer_expire </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00377">377</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *<a class="code" href="structpeer.html">peer</a>;
  <a class="code" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi;
  <a class="code" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi;

  peer = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  peer-&gt;<a class="code" href="structpeer.html#ada375f793bffb7304b39c227704ba406">t_gr_stale</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (events, EVENTS))
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s graceful restart stalepath timer expired&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);

  <span class="comment">/* NSF delete stale route */</span>
  <span class="keywordflow">for</span> (afi = <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> ; afi &lt; <a class="code" href="zebra_8h.html#abf129a17e985713a26a6181a198d5f1a">AFI_MAX</a> ; afi++)
    <span class="keywordflow">for</span> (safi = <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a> ; safi &lt; <a class="code" href="zebra_8h.html#acd7929dcab1201ad7ca0de9cb5b8a06c">SAFI_UNICAST_MULTICAST</a> ; safi++)
      <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a36e9e912b00326f95bd69cb6afc11efd">nsf</a>[afi][safi])
    <a class="code" href="bgp__route_8c.html#aa1dd948948425c7e30941a8816af5bb1">bgp_clear_stale_route</a> (peer, afi, safi);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6a478dce126762a49478f511d22e3744"></a><!-- doxytag: member="bgp_fsm.c::bgp_holdtime_timer" ref="a6a478dce126762a49478f511d22e3744" args="(struct thread *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_holdtime_timer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00257">257</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *<a class="code" href="structpeer.html">peer</a>;

  peer = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (fsm, <a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a>))
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
      <span class="stringliteral">&quot;%s [FSM] Timer (holdtime timer expire)&quot;</span>,
      peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);

  <a class="code" href="thread_8h.html#a88d7c483cad15baac709fac747480a11">THREAD_VAL</a> (thread) = <a class="code" href="bgpd_8h.html#aa22516de11da3d7cf571415023bece30">Hold_Timer_expired</a>;
  <a class="code" href="bgp__fsm_8c.html#a0ca676929248063979d5b120114cbccd">bgp_event</a> (thread); <span class="comment">/* bgp_event unlocks peer */</span>

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad355fa89ae4a521cc69c3cf30dfbb2b2"></a><!-- doxytag: member="bgp_fsm.c::bgp_ignore" ref="ad355fa89ae4a521cc69c3cf30dfbb2b2" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_ignore </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00902">902</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (fsm, <a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a>))
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG, <span class="stringliteral">&quot;%s [FSM] bgp_ignore called&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab1b3731e45da5d4889eb7a8eefe6f647"></a><!-- doxytag: member="bgp_fsm.c::bgp_keepalive_timer" ref="ab1b3731e45da5d4889eb7a8eefe6f647" args="(struct thread *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_keepalive_timer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00277">277</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *<a class="code" href="structpeer.html">peer</a>;

  peer = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  peer-&gt;<a class="code" href="structpeer.html#a4f8889925480578b771c9574e88add27">t_keepalive</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (fsm, <a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a>))
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
      <span class="stringliteral">&quot;%s [FSM] Timer (keepalive timer expire)&quot;</span>,
      peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);

  <a class="code" href="thread_8h.html#a88d7c483cad15baac709fac747480a11">THREAD_VAL</a> (thread) = <a class="code" href="bgpd_8h.html#add4910f1885dd2631dd7c556c24a9b9e">KeepAlive_timer_expired</a>;
  <a class="code" href="bgp__fsm_8c.html#a0ca676929248063979d5b120114cbccd">bgp_event</a> (thread); <span class="comment">/* bgp_event unlocks peer */</span>

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a276e1b5f94212b4438ec33a431a2fbce"></a><!-- doxytag: member="bgp_fsm.c::bgp_reconnect" ref="a276e1b5f94212b4438ec33a431a2fbce" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_reconnect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00716">716</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="bgp__fsm_8c.html#a70832c80e2f7e40a453d23689818d84a">bgp_stop</a> (peer);
  <a class="code" href="bgp__fsm_8c.html#aa37215b69bb5e93cc41137bd278a9c9b">bgp_start</a> (peer);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a66dc307fde4b0ec3bff966374f22181c"></a><!-- doxytag: member="bgp_fsm.c::bgp_routeadv_timer" ref="a66dc307fde4b0ec3bff966374f22181c" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_routeadv_timer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00296">296</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *<a class="code" href="structpeer.html">peer</a>;

  peer = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  peer-&gt;<a class="code" href="structpeer.html#a81042b1115a4cc6ced7d496a1aaaacac">t_routeadv</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (fsm, <a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a>))
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
      <span class="stringliteral">&quot;%s [FSM] Timer (routeadv timer expire)&quot;</span>,
      peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);

  peer-&gt;<a class="code" href="structpeer.html#ac634a8cdc8e00d064d9d9fcdd324a950">synctime</a> = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();

  <a class="code" href="bgp__fsm_8h.html#a441b8dfef999d79ac1c3e3b9573fe516">BGP_WRITE_ON</a> (peer-&gt;<a class="code" href="structpeer.html#af1b52e357fd1c6aa0bc8360cf57485e4">t_write</a>, <a class="code" href="bgp__packet_8c.html#ad43cdddbeb3aa17bb2aa199409455c1c">bgp_write</a>, peer-&gt;<a class="code" href="structpeer.html#a593c49b1167d88eb2d2900db47eb5d9d">fd</a>);

  <a class="code" href="bgp__fsm_8h.html#aaf9fcd8314ca70eef21f5689423d7152">BGP_TIMER_ON</a> (peer-&gt;<a class="code" href="structpeer.html#a81042b1115a4cc6ced7d496a1aaaacac">t_routeadv</a>, <a class="code" href="bgp__fsm_8c.html#a66dc307fde4b0ec3bff966374f22181c">bgp_routeadv_timer</a>,
        peer-&gt;<a class="code" href="structpeer.html#a458c8875d94b9a7f90a7c4a827c8e4fb">v_routeadv</a>);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa37215b69bb5e93cc41137bd278a9c9b"></a><!-- doxytag: member="bgp_fsm.c::bgp_start" ref="aa37215b69bb5e93cc41137bd278a9c9b" args="(struct peer *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00639">639</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> <a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a>;

  <span class="keywordflow">if</span> (<a class="code" href="bgp__fsm_8c.html#ad9ce88248446ff0372b352a095212a03">BGP_PEER_START_SUPPRESSED</a> (peer))
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (fsm, <a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a>))
        <a class="code" href="log_8h.html#a4dac9f1d742f56610c76fb86e160a28f">plog_err</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, <span class="stringliteral">&quot;%s [FSM] Trying to start suppressed peer&quot;</span>
                  <span class="stringliteral">&quot; - this is never supposed to happen!&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
      <span class="keywordflow">return</span> -1;
    }

  <span class="comment">/* Scrub some information that might be left over from a previous,</span>
<span class="comment">   * session</span>
<span class="comment">   */</span>
  <span class="comment">/* Connection information. */</span>
  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a063537a13602c890880e9c4f1d6fccd3">su_local</a>)
    {
      <a class="code" href="sockunion_8c.html#a4c9c2ea65e1c9058a61db60a5ae8dbaf">sockunion_free</a> (peer-&gt;<a class="code" href="structpeer.html#a063537a13602c890880e9c4f1d6fccd3">su_local</a>);
      peer-&gt;<a class="code" href="structpeer.html#a063537a13602c890880e9c4f1d6fccd3">su_local</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }

  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a9ab7f1f3e48a3027c0f8a92fa6e2de28">su_remote</a>)
    {
      <a class="code" href="sockunion_8c.html#a4c9c2ea65e1c9058a61db60a5ae8dbaf">sockunion_free</a> (peer-&gt;<a class="code" href="structpeer.html#a9ab7f1f3e48a3027c0f8a92fa6e2de28">su_remote</a>);
      peer-&gt;<a class="code" href="structpeer.html#a9ab7f1f3e48a3027c0f8a92fa6e2de28">su_remote</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }

  <span class="comment">/* Clear remote router-id. */</span>
  peer-&gt;<a class="code" href="structpeer.html#ae620d85ff35b31ba9eb6073b81731b5b">remote_id</a>.s_addr = 0;

  <span class="comment">/* Clear peer capability flag. */</span>
  peer-&gt;<a class="code" href="structpeer.html#a64eadd546a8c50dfe6a6dcb635c3822d">cap</a> = 0;
    
  <span class="comment">/* If the peer is passive mode, force to move to Active mode. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a3f18e3da00909bb1ce53919fd7129b54">flags</a>, <a class="code" href="bgpd_8h.html#ac43c8c6cc3aa168070d51ef4e899c6fb">PEER_FLAG_PASSIVE</a>))
    {
      <a class="code" href="bgp__fsm_8h.html#a20f7fd10817508149783bf6729dd6727">BGP_EVENT_ADD</a> (peer, <a class="code" href="bgpd_8h.html#a3e6d939d6f371d5d5d6c61299c40a870">TCP_connection_open_failed</a>);
      <span class="keywordflow">return</span> 0;
    }

  status = <a class="code" href="bgp__network_8c.html#a57ed797451133183762525b1ed2da82b">bgp_connect</a> (peer);

  <span class="keywordflow">switch</span> (status)
    {
    <span class="keywordflow">case</span> <a class="code" href="sockunion_8h.html#ab1d3499888de36b96c23f98e283c1b6ea047b71b6325b28f03d8ac558983d7e88">connect_error</a>:
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (fsm, <a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a>))
    <a class="code" href="log_8h.html#a901efa2487b25c3a74846a52de919565">plog_debug</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, <span class="stringliteral">&quot;%s [FSM] Connect error&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
      <a class="code" href="bgp__fsm_8h.html#a20f7fd10817508149783bf6729dd6727">BGP_EVENT_ADD</a> (peer, <a class="code" href="bgpd_8h.html#a3e6d939d6f371d5d5d6c61299c40a870">TCP_connection_open_failed</a>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="sockunion_8h.html#ab1d3499888de36b96c23f98e283c1b6ea851cdcb3c5b666dc182f4b6136a6fe7d">connect_success</a>:
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (fsm, <a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a>))
    <a class="code" href="log_8h.html#a901efa2487b25c3a74846a52de919565">plog_debug</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, <span class="stringliteral">&quot;%s [FSM] Connect immediately success&quot;</span>,
           peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
      <a class="code" href="bgp__fsm_8h.html#a20f7fd10817508149783bf6729dd6727">BGP_EVENT_ADD</a> (peer, <a class="code" href="bgpd_8h.html#a752a14bd3217eb3b705dd20e50824eef">TCP_connection_open</a>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="sockunion_8h.html#ab1d3499888de36b96c23f98e283c1b6eaefd11a166b80dff3244284fa5ece9d28">connect_in_progress</a>:
      <span class="comment">/* To check nonblocking connect, we wait until socket is</span>
<span class="comment">         readable or writable. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (fsm, <a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a>))
    <a class="code" href="log_8h.html#a901efa2487b25c3a74846a52de919565">plog_debug</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, <span class="stringliteral">&quot;%s [FSM] Non blocking connect waiting result&quot;</span>,
           peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
      <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a593c49b1167d88eb2d2900db47eb5d9d">fd</a> &lt; 0)
    {
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;bgp_start peer&#39;s fd is negative value %d&quot;</span>,
            peer-&gt;<a class="code" href="structpeer.html#a593c49b1167d88eb2d2900db47eb5d9d">fd</a>);
      <span class="keywordflow">return</span> -1;
    }
      <a class="code" href="bgp__fsm_8h.html#a62b5746c9e6a92bffde54f2dc61557d7">BGP_READ_ON</a> (peer-&gt;<a class="code" href="structpeer.html#a51f641e77c077e7e3355a65bd3e51dac">t_read</a>, <a class="code" href="bgp__packet_8c.html#a3a37390260357b584d8fd7b3591b2058">bgp_read</a>, peer-&gt;<a class="code" href="structpeer.html#a593c49b1167d88eb2d2900db47eb5d9d">fd</a>);
      <a class="code" href="bgp__fsm_8h.html#a441b8dfef999d79ac1c3e3b9573fe516">BGP_WRITE_ON</a> (peer-&gt;<a class="code" href="structpeer.html#af1b52e357fd1c6aa0bc8360cf57485e4">t_write</a>, <a class="code" href="bgp__packet_8c.html#ad43cdddbeb3aa17bb2aa199409455c1c">bgp_write</a>, peer-&gt;<a class="code" href="structpeer.html#a593c49b1167d88eb2d2900db47eb5d9d">fd</a>);
      <span class="keywordflow">break</span>;
    }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afbc7bca040c07e81b9431b7b171b2d89"></a><!-- doxytag: member="bgp_fsm.c::bgp_start_jitter" ref="afbc7bca040c07e81b9431b7b171b2d89" args="(int time)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_start_jitter </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>time</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00066">66</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> ((rand () % (time + 1)) - (time / 2));
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6376ed698f2472152192884e4834f45e"></a><!-- doxytag: member="bgp_fsm.c::bgp_start_timer" ref="a6376ed698f2472152192884e4834f45e" args="(struct thread *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_start_timer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00219">219</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *<a class="code" href="structpeer.html">peer</a>;

  peer = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  peer-&gt;<a class="code" href="structpeer.html#ad7cf15fc612938449a9ac8d7ed111a91">t_start</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (fsm, <a class="code" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a>))
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
      <span class="stringliteral">&quot;%s [FSM] Timer (start timer expire).&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);

  <a class="code" href="thread_8h.html#a88d7c483cad15baac709fac747480a11">THREAD_VAL</a> (thread) = <a class="code" href="bgpd_8h.html#ab2d603cda7f63a92bb3792da2512259e">BGP_Start</a>;
  <a class="code" href="bgp__fsm_8c.html#a0ca676929248063979d5b120114cbccd">bgp_event</a> (thread);  <span class="comment">/* bgp_event unlocks peer */</span>

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a70832c80e2f7e40a453d23689818d84a"></a><!-- doxytag: member="bgp_fsm.c::bgp_stop" ref="a70832c80e2f7e40a453d23689818d84a" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_stop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00435">435</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi;
  <a class="code" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi;
  <span class="keywordtype">char</span> orf_name[BUFSIZ];

  <span class="comment">/* Can&#39;t do this in Clearing; events are used for state transitions */</span>
  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a> != <a class="code" href="bgpd_8h.html#ac1826d1d659fefa5f3c15db9e57f7eb7">Clearing</a>)
    {
      <span class="comment">/* Delete all existing events of the peer */</span>
      <a class="code" href="bgp__fsm_8h.html#af4f1a52b106aa7dbf3494d0debf644d3">BGP_EVENT_FLUSH</a> (peer);
    }

  <span class="comment">/* Increment Dropped count. */</span>
  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a> == <a class="code" href="bgpd_8h.html#aa87809ec7dea97b0e970e98ae6c181ea">Established</a>)
    {
      peer-&gt;<a class="code" href="structpeer.html#adb1885b5103791a47fbb5922536c22c9">dropped</a>++;

      <span class="comment">/* bgp log-neighbor-changes of neighbor Down */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#a0b3388d8ac73af2d4f4f22e46746da1e">bgp_flag_check</a> (peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>, <a class="code" href="bgpd_8h.html#a4871d191e1b11258fc7d58365a8de88b">BGP_FLAG_LOG_NEIGHBOR_CHANGES</a>))
    <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a> (<span class="stringliteral">&quot;%%ADJCHANGE: neighbor %s Down %s&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
                   <a class="code" href="bgp__fsm_8c.html#a20174a312cef5d9aa6905c8bf6037020">peer_down_str</a> [(<span class="keywordtype">int</span>) peer-&gt;<a class="code" href="structpeer.html#a25ebf375ff5c70069097a7420a8061f9">last_reset</a>]);

      <span class="comment">/* graceful restart */</span>
      <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ada375f793bffb7304b39c227704ba406">t_gr_stale</a>)
    {
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ada375f793bffb7304b39c227704ba406">t_gr_stale</a>);
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (events, EVENTS))
        <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s graceful restart stalepath timer stopped&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
    }
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#aa97d7e86e0f1905a85364af66368896f">PEER_STATUS_NSF_WAIT</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (events, EVENTS))
        {
          <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s graceful restart timer started for %d sec&quot;</span>,
              peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, peer-&gt;<a class="code" href="structpeer.html#a52c79d6e660a26c070155a215188c9fb">v_gr_restart</a>);
          <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s graceful restart stalepath timer started for %d sec&quot;</span>,
              peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#af3fceb1479812aeba233601365bf9fbd">stalepath_time</a>);
        }
      <a class="code" href="bgp__fsm_8h.html#aaf9fcd8314ca70eef21f5689423d7152">BGP_TIMER_ON</a> (peer-&gt;<a class="code" href="structpeer.html#a4fdfea0c52fcb6c48138fc9c817d7b41">t_gr_restart</a>, <a class="code" href="bgp__fsm_8c.html#a9e33b04e19f066ddd88661d79b117a1c">bgp_graceful_restart_timer_expire</a>,
            peer-&gt;<a class="code" href="structpeer.html#a52c79d6e660a26c070155a215188c9fb">v_gr_restart</a>);
      <a class="code" href="bgp__fsm_8h.html#aaf9fcd8314ca70eef21f5689423d7152">BGP_TIMER_ON</a> (peer-&gt;<a class="code" href="structpeer.html#ada375f793bffb7304b39c227704ba406">t_gr_stale</a>, <a class="code" href="bgp__fsm_8c.html#abdf2a409fcad0cf22682f61f74d4f937">bgp_graceful_stale_timer_expire</a>,
            peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#af3fceb1479812aeba233601365bf9fbd">stalepath_time</a>);
    }
      <span class="keywordflow">else</span>
    {
      <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#a4ff62dffb922440e74de66efee6f8f42">PEER_STATUS_NSF_MODE</a>);

      <span class="keywordflow">for</span> (afi = <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> ; afi &lt; <a class="code" href="zebra_8h.html#abf129a17e985713a26a6181a198d5f1a">AFI_MAX</a> ; afi++)
        <span class="keywordflow">for</span> (safi = <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a> ; safi &lt; <a class="code" href="zebra_8h.html#acd7929dcab1201ad7ca0de9cb5b8a06c">SAFI_UNICAST_MULTICAST</a> ; safi++)
          peer-&gt;<a class="code" href="structpeer.html#a36e9e912b00326f95bd69cb6afc11efd">nsf</a>[afi][safi] = 0;
    }

      <span class="comment">/* set last reset time */</span>
      peer-&gt;<a class="code" href="structpeer.html#a6b54a3917c026e52541f861b1a7b9cf8">resettime</a> = peer-&gt;<a class="code" href="structpeer.html#a008ca2beea8dd058639039cf2b468844">uptime</a> = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();

<span class="preprocessor">#ifdef HAVE_SNMP</span>
<span class="preprocessor"></span>      <a class="code" href="bgp__snmp_8h.html#ad57de0ca6043122ebee75e6a97d18733">bgpTrapBackwardTransition</a> (peer);
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_SNMP */</span>

      <span class="comment">/* Reset peer synctime */</span>
      peer-&gt;<a class="code" href="structpeer.html#ac634a8cdc8e00d064d9d9fcdd324a950">synctime</a> = 0;
    }

  <span class="comment">/* Stop read and write threads when exists. */</span>
  <a class="code" href="bgp__fsm_8h.html#abda2b4012d32bfc561f7c97e37263bbe">BGP_READ_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a51f641e77c077e7e3355a65bd3e51dac">t_read</a>);
  <a class="code" href="bgp__fsm_8h.html#a49884b788209354868be2e7e580584ce">BGP_WRITE_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#af1b52e357fd1c6aa0bc8360cf57485e4">t_write</a>);

  <span class="comment">/* Stop all timers. */</span>
  <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ad7cf15fc612938449a9ac8d7ed111a91">t_start</a>);
  <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a7badb9ad50dae6376ecaa005318676e4">t_connect</a>);
  <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>);
  <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a4f8889925480578b771c9574e88add27">t_keepalive</a>);
  <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ae6ca6f06c2ebc2537ff2f10da05263d3">t_asorig</a>);
  <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a81042b1115a4cc6ced7d496a1aaaacac">t_routeadv</a>);

  <span class="comment">/* Stream reset. */</span>
  peer-&gt;<a class="code" href="structpeer.html#a21bd941bc82fe85b016335eaf9ff8140">packet_size</a> = 0;

  <span class="comment">/* Clear input and output buffer.  */</span>
  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ad56414663c798719e3a10e6c62a37003">ibuf</a>)
    <a class="code" href="stream_8c.html#aee8fd31485ebc2f0a556a6a5d5c2d1e6">stream_reset</a> (peer-&gt;<a class="code" href="structpeer.html#ad56414663c798719e3a10e6c62a37003">ibuf</a>);
  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a5306384581e22c8d1678087a6ef8e3e4">work</a>)
    <a class="code" href="stream_8c.html#aee8fd31485ebc2f0a556a6a5d5c2d1e6">stream_reset</a> (peer-&gt;<a class="code" href="structpeer.html#a5306384581e22c8d1678087a6ef8e3e4">work</a>);
  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a04997e74f9bfe73fb049633fa25cbbb7">obuf</a>)
    <a class="code" href="stream_8c.html#a9e1a6e68edeeb87d009b54c7c2b22365">stream_fifo_clean</a> (peer-&gt;<a class="code" href="structpeer.html#a04997e74f9bfe73fb049633fa25cbbb7">obuf</a>);

  <span class="comment">/* Close of file descriptor. */</span>
  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a593c49b1167d88eb2d2900db47eb5d9d">fd</a> &gt;= 0)
    {
      close (peer-&gt;<a class="code" href="structpeer.html#a593c49b1167d88eb2d2900db47eb5d9d">fd</a>);
      peer-&gt;<a class="code" href="structpeer.html#a593c49b1167d88eb2d2900db47eb5d9d">fd</a> = -1;
    }

  <span class="keywordflow">for</span> (afi = <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> ; afi &lt; <a class="code" href="zebra_8h.html#abf129a17e985713a26a6181a198d5f1a">AFI_MAX</a> ; afi++)
    <span class="keywordflow">for</span> (safi = <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a> ; safi &lt; <a class="code" href="zebra_8h.html#a82fe6f63e822f7bf9e4567873d809ed8">SAFI_MAX</a> ; safi++)
      {
        <span class="comment">/* Reset all negotiated variables */</span>
        peer-&gt;<a class="code" href="structpeer.html#a08da0f40c72c2016e659539e6af6dc2d">afc_nego</a>[afi][safi] = 0;
        peer-&gt;<a class="code" href="structpeer.html#a62f0e72c2cc7eaa59235980f81d3bfa6">afc_adv</a>[afi][safi] = 0;
        peer-&gt;<a class="code" href="structpeer.html#a69bf8dd8a30764344085b68b398dd619">afc_recv</a>[afi][safi] = 0;

    <span class="comment">/* peer address family capability flags*/</span>
    peer-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi] = 0;

    <span class="comment">/* peer address family status flags*/</span>
    peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi] = 0;

    <span class="comment">/* Received ORF prefix-filter */</span>
    peer-&gt;<a class="code" href="structpeer.html#a2473c352a18c1a1169cd01754dbfc993">orf_plist</a>[afi][safi] = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

        <span class="comment">/* ORF received prefix-filter pnt */</span>
        sprintf (orf_name, <span class="stringliteral">&quot;%s.%d.%d&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, afi, safi);
        <a class="code" href="plist_8c.html#ab45c235a305a061e5ac9fceecfc90a55">prefix_bgp_orf_remove_all</a> (orf_name);
      }

  <span class="comment">/* Reset keepalive and holdtime */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#add88f88547df15dd579f2001840a5ffe">config</a>, <a class="code" href="bgpd_8h.html#a0a38ee681fef67382b59bcacf7e71acc">PEER_CONFIG_TIMER</a>))
    {
      peer-&gt;<a class="code" href="structpeer.html#a4683327b18d77b5888cc293b180f01ff">v_keepalive</a> = peer-&gt;<a class="code" href="structpeer.html#a26d22938043d49420b6c9753c7c1eb2b">keepalive</a>;
      peer-&gt;<a class="code" href="structpeer.html#ade54caf4be91128837361d44f0239fa0">v_holdtime</a> = peer-&gt;<a class="code" href="structpeer.html#a94b9ef3bd3f901c67be200f2b394c206">holdtime</a>;
    }
  <span class="keywordflow">else</span>
    {
      peer-&gt;<a class="code" href="structpeer.html#a4683327b18d77b5888cc293b180f01ff">v_keepalive</a> = peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a2cb2d8c22ae72be52eae0b4f2e193fcb">default_keepalive</a>;
      peer-&gt;<a class="code" href="structpeer.html#ade54caf4be91128837361d44f0239fa0">v_holdtime</a> = peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a019cdc9f6a2587ee4d4a271e5add5db4">default_holdtime</a>;
    }

  peer-&gt;<a class="code" href="structpeer.html#a417a77217f3ecfb948016245a4eaf650">update_time</a> = 0;

  <span class="comment">/* Until we are sure that there is no problem about prefix count</span>
<span class="comment">     this should be commented out.*/</span>
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>  <span class="comment">/* Reset prefix count */</span>
  peer-&gt;<a class="code" href="structpeer.html#ad330ebcaa29077b76720f2d62f36dc24">pcount</a>[<a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>][<a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>] = 0;
  peer-&gt;<a class="code" href="structpeer.html#ad330ebcaa29077b76720f2d62f36dc24">pcount</a>[<a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>][<a class="code" href="zebra_8h.html#aea5323bab4aaf8f8737af8a8ea19c661">SAFI_MULTICAST</a>] = 0;
  peer-&gt;<a class="code" href="structpeer.html#ad330ebcaa29077b76720f2d62f36dc24">pcount</a>[<a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>][<a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>] = 0;
  peer-&gt;<a class="code" href="structpeer.html#ad330ebcaa29077b76720f2d62f36dc24">pcount</a>[<a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a>][<a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>] = 0;
  peer-&gt;<a class="code" href="structpeer.html#ad330ebcaa29077b76720f2d62f36dc24">pcount</a>[<a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a>][<a class="code" href="zebra_8h.html#aea5323bab4aaf8f8737af8a8ea19c661">SAFI_MULTICAST</a>] = 0;
<span class="preprocessor">#endif </span><span class="comment">/* 0 */</span>

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4de2dbc91c9ad88b682235e96971d05b"></a><!-- doxytag: member="bgp_fsm.c::bgp_stop_with_error" ref="a4de2dbc91c9ad88b682235e96971d05b" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_stop_with_error </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00581">581</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">/* Double start timer. */</span>
  peer-&gt;<a class="code" href="structpeer.html#a82d93e09c2e715abdb362fa6b5059908">v_start</a> *= 2;

  <span class="comment">/* Overflow check. */</span>
  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a82d93e09c2e715abdb362fa6b5059908">v_start</a> &gt;= (60 * 2))
    peer-&gt;<a class="code" href="structpeer.html#a82d93e09c2e715abdb362fa6b5059908">v_start</a> = (60 * 2);

  <a class="code" href="bgp__fsm_8c.html#a70832c80e2f7e40a453d23689818d84a">bgp_stop</a> (peer);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0dae67b35f2ffb6d6e7f9b1a6684e0aa"></a><!-- doxytag: member="bgp_fsm.c::bgp_timer_set" ref="a0dae67b35f2ffb6d6e7f9b1a6684e0aa" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_timer_set </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00080">80</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> jitter = 0;

  <span class="keywordflow">switch</span> (peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a>)
    {
    <span class="keywordflow">case</span> <a class="code" href="bgpd_8h.html#aa87491374c5f1e04e123e51e1dfd043f">Idle</a>:
      <span class="comment">/* First entry point of peer&#39;s finite state machine.  In Idle</span>
<span class="comment">     status start timer is on unless peer is shutdown or peer is</span>
<span class="comment">     inactive.  All other timer must be turned off */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgp__fsm_8c.html#ad9ce88248446ff0372b352a095212a03">BGP_PEER_START_SUPPRESSED</a> (peer) || ! <a class="code" href="bgpd_8c.html#ae512a15120d606173592586a761742aa">peer_active</a> (peer))
    {
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ad7cf15fc612938449a9ac8d7ed111a91">t_start</a>);
    }
      <span class="keywordflow">else</span>
    {
      jitter = <a class="code" href="bgp__fsm_8c.html#afbc7bca040c07e81b9431b7b171b2d89">bgp_start_jitter</a> (peer-&gt;<a class="code" href="structpeer.html#a82d93e09c2e715abdb362fa6b5059908">v_start</a>);
      <a class="code" href="bgp__fsm_8h.html#aaf9fcd8314ca70eef21f5689423d7152">BGP_TIMER_ON</a> (peer-&gt;<a class="code" href="structpeer.html#ad7cf15fc612938449a9ac8d7ed111a91">t_start</a>, <a class="code" href="bgp__fsm_8c.html#a6376ed698f2472152192884e4834f45e">bgp_start_timer</a>,
            peer-&gt;<a class="code" href="structpeer.html#a82d93e09c2e715abdb362fa6b5059908">v_start</a> + jitter);
    }
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a7badb9ad50dae6376ecaa005318676e4">t_connect</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a4f8889925480578b771c9574e88add27">t_keepalive</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ae6ca6f06c2ebc2537ff2f10da05263d3">t_asorig</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a81042b1115a4cc6ced7d496a1aaaacac">t_routeadv</a>);
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="bgpd_8h.html#a58672521fe155cead3bd1f0653be62ee">Connect</a>:
      <span class="comment">/* After start timer is expired, the peer moves to Connnect</span>
<span class="comment">         status.  Make sure start timer is off and connect timer is</span>
<span class="comment">         on. */</span>
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ad7cf15fc612938449a9ac8d7ed111a91">t_start</a>);
      <a class="code" href="bgp__fsm_8h.html#aaf9fcd8314ca70eef21f5689423d7152">BGP_TIMER_ON</a> (peer-&gt;<a class="code" href="structpeer.html#a7badb9ad50dae6376ecaa005318676e4">t_connect</a>, <a class="code" href="bgp__fsm_8c.html#a00534644637211950775a0c09c30b184">bgp_connect_timer</a>, peer-&gt;<a class="code" href="structpeer.html#a54ca5fae2bc177a95b9277dc6f2eac6e">v_connect</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a4f8889925480578b771c9574e88add27">t_keepalive</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ae6ca6f06c2ebc2537ff2f10da05263d3">t_asorig</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a81042b1115a4cc6ced7d496a1aaaacac">t_routeadv</a>);
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="bgpd_8h.html#a3e4aba4f7d3a690fdce5d1fe31156421">Active</a>:
      <span class="comment">/* Active is waiting connection from remote peer.  And if</span>
<span class="comment">         connect timer is expired, change status to Connect. */</span>
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ad7cf15fc612938449a9ac8d7ed111a91">t_start</a>);
      <span class="comment">/* If peer is passive mode, do not set connect timer. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a3f18e3da00909bb1ce53919fd7129b54">flags</a>, <a class="code" href="bgpd_8h.html#ac43c8c6cc3aa168070d51ef4e899c6fb">PEER_FLAG_PASSIVE</a>)
      || <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#aa97d7e86e0f1905a85364af66368896f">PEER_STATUS_NSF_WAIT</a>))
    {
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a7badb9ad50dae6376ecaa005318676e4">t_connect</a>);
    }
      <span class="keywordflow">else</span>
    {
      <a class="code" href="bgp__fsm_8h.html#aaf9fcd8314ca70eef21f5689423d7152">BGP_TIMER_ON</a> (peer-&gt;<a class="code" href="structpeer.html#a7badb9ad50dae6376ecaa005318676e4">t_connect</a>, <a class="code" href="bgp__fsm_8c.html#a00534644637211950775a0c09c30b184">bgp_connect_timer</a>, peer-&gt;<a class="code" href="structpeer.html#a54ca5fae2bc177a95b9277dc6f2eac6e">v_connect</a>);
    }
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a4f8889925480578b771c9574e88add27">t_keepalive</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ae6ca6f06c2ebc2537ff2f10da05263d3">t_asorig</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a81042b1115a4cc6ced7d496a1aaaacac">t_routeadv</a>);
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="bgpd_8h.html#a1873a46d77babce8de80c71ce1624718">OpenSent</a>:
      <span class="comment">/* OpenSent status. */</span>
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ad7cf15fc612938449a9ac8d7ed111a91">t_start</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a7badb9ad50dae6376ecaa005318676e4">t_connect</a>);
      <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ade54caf4be91128837361d44f0239fa0">v_holdtime</a> != 0)
    {
      <a class="code" href="bgp__fsm_8h.html#aaf9fcd8314ca70eef21f5689423d7152">BGP_TIMER_ON</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>, <a class="code" href="bgp__fsm_8c.html#a6a478dce126762a49478f511d22e3744">bgp_holdtime_timer</a>, 
            peer-&gt;<a class="code" href="structpeer.html#ade54caf4be91128837361d44f0239fa0">v_holdtime</a>);
    }
      <span class="keywordflow">else</span>
    {
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>);
    }
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a4f8889925480578b771c9574e88add27">t_keepalive</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ae6ca6f06c2ebc2537ff2f10da05263d3">t_asorig</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a81042b1115a4cc6ced7d496a1aaaacac">t_routeadv</a>);
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="bgpd_8h.html#a0bf5b4ab03c60ff4c23c94a1d683b0b9">OpenConfirm</a>:
      <span class="comment">/* OpenConfirm status. */</span>
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ad7cf15fc612938449a9ac8d7ed111a91">t_start</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a7badb9ad50dae6376ecaa005318676e4">t_connect</a>);

      <span class="comment">/* If the negotiated Hold Time value is zero, then the Hold Time</span>
<span class="comment">         timer and KeepAlive timers are not started. */</span>
      <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ade54caf4be91128837361d44f0239fa0">v_holdtime</a> == 0)
    {
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a4f8889925480578b771c9574e88add27">t_keepalive</a>);
    }
      <span class="keywordflow">else</span>
    {
      <a class="code" href="bgp__fsm_8h.html#aaf9fcd8314ca70eef21f5689423d7152">BGP_TIMER_ON</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>, <a class="code" href="bgp__fsm_8c.html#a6a478dce126762a49478f511d22e3744">bgp_holdtime_timer</a>,
            peer-&gt;<a class="code" href="structpeer.html#ade54caf4be91128837361d44f0239fa0">v_holdtime</a>);
      <a class="code" href="bgp__fsm_8h.html#aaf9fcd8314ca70eef21f5689423d7152">BGP_TIMER_ON</a> (peer-&gt;<a class="code" href="structpeer.html#a4f8889925480578b771c9574e88add27">t_keepalive</a>, <a class="code" href="bgp__fsm_8c.html#ab1b3731e45da5d4889eb7a8eefe6f647">bgp_keepalive_timer</a>, 
            peer-&gt;<a class="code" href="structpeer.html#a4683327b18d77b5888cc293b180f01ff">v_keepalive</a>);
    }
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ae6ca6f06c2ebc2537ff2f10da05263d3">t_asorig</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a81042b1115a4cc6ced7d496a1aaaacac">t_routeadv</a>);
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="bgpd_8h.html#aa87809ec7dea97b0e970e98ae6c181ea">Established</a>:
      <span class="comment">/* In Established status start and connect timer is turned</span>
<span class="comment">         off. */</span>
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ad7cf15fc612938449a9ac8d7ed111a91">t_start</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a7badb9ad50dae6376ecaa005318676e4">t_connect</a>);

      <span class="comment">/* Same as OpenConfirm, if holdtime is zero then both holdtime</span>
<span class="comment">         and keepalive must be turned off. */</span>
      <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ade54caf4be91128837361d44f0239fa0">v_holdtime</a> == 0)
    {
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a4f8889925480578b771c9574e88add27">t_keepalive</a>);
    }
      <span class="keywordflow">else</span>
    {
      <a class="code" href="bgp__fsm_8h.html#aaf9fcd8314ca70eef21f5689423d7152">BGP_TIMER_ON</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>, <a class="code" href="bgp__fsm_8c.html#a6a478dce126762a49478f511d22e3744">bgp_holdtime_timer</a>,
            peer-&gt;<a class="code" href="structpeer.html#ade54caf4be91128837361d44f0239fa0">v_holdtime</a>);
      <a class="code" href="bgp__fsm_8h.html#aaf9fcd8314ca70eef21f5689423d7152">BGP_TIMER_ON</a> (peer-&gt;<a class="code" href="structpeer.html#a4f8889925480578b771c9574e88add27">t_keepalive</a>, <a class="code" href="bgp__fsm_8c.html#ab1b3731e45da5d4889eb7a8eefe6f647">bgp_keepalive_timer</a>,
            peer-&gt;<a class="code" href="structpeer.html#a4683327b18d77b5888cc293b180f01ff">v_keepalive</a>);
    }
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ae6ca6f06c2ebc2537ff2f10da05263d3">t_asorig</a>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="bgpd_8h.html#a25915a470516b826a1f075280e8a3941">Deleted</a>:
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a4fdfea0c52fcb6c48138fc9c817d7b41">t_gr_restart</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ada375f793bffb7304b39c227704ba406">t_gr_stale</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ae4340980236449843f55d04b3ad4bf7e">t_pmax_restart</a>);
    <span class="keywordflow">case</span> <a class="code" href="bgpd_8h.html#ac1826d1d659fefa5f3c15db9e57f7eb7">Clearing</a>:
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ad7cf15fc612938449a9ac8d7ed111a91">t_start</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a7badb9ad50dae6376ecaa005318676e4">t_connect</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a84256b6da29b58448f37ed9fd3247bb6">t_holdtime</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a4f8889925480578b771c9574e88add27">t_keepalive</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#ae6ca6f06c2ebc2537ff2f10da05263d3">t_asorig</a>);
      <a class="code" href="bgp__fsm_8h.html#adc51abba0e065120000e106a628242fe">BGP_TIMER_OFF</a> (peer-&gt;<a class="code" href="structpeer.html#a81042b1115a4cc6ced7d496a1aaaacac">t_routeadv</a>);
    }
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a4a8b0fec5e2e678cd1c5824ab4662ce6"></a><!-- doxytag: member="bgp_fsm.c::bgp_event_str" ref="a4a8b0fec5e2e678cd1c5824ab4662ce6" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="bgp__fsm_8c.html#a4a8b0fec5e2e678cd1c5824ab4662ce6">bgp_event_str</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment">
{
  <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
  <span class="stringliteral">&quot;BGP_Start&quot;</span>,
  <span class="stringliteral">&quot;BGP_Stop&quot;</span>,
  <span class="stringliteral">&quot;TCP_connection_open&quot;</span>,
  <span class="stringliteral">&quot;TCP_connection_closed&quot;</span>,
  <span class="stringliteral">&quot;TCP_connection_open_failed&quot;</span>,
  <span class="stringliteral">&quot;TCP_fatal_error&quot;</span>,
  <span class="stringliteral">&quot;ConnectRetry_timer_expired&quot;</span>,
  <span class="stringliteral">&quot;Hold_Timer_expired&quot;</span>,
  <span class="stringliteral">&quot;KeepAlive_timer_expired&quot;</span>,
  <span class="stringliteral">&quot;Receive_OPEN_message&quot;</span>,
  <span class="stringliteral">&quot;Receive_KEEPALIVE_message&quot;</span>,
  <span class="stringliteral">&quot;Receive_UPDATE_message&quot;</span>,
  <span class="stringliteral">&quot;Receive_NOTIFICATION_message&quot;</span>,
  <span class="stringliteral">&quot;Clearing_Completed&quot;</span>,
}
</pre></div>
<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l01055">1055</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa80c210a6930b131524d9462e32ccad4"></a><!-- doxytag: member="bgp_fsm.c::FSM" ref="aa80c210a6930b131524d9462e32ccad4" args="[BGP_STATUS_MAX&#45;1][BGP_EVENTS_MAX&#45;1]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct { ... }   <a class="el" href="bgp__fsm_8c.html#aa80c210a6930b131524d9462e32ccad4">FSM</a>[BGP_STATUS_MAX - 1][BGP_EVENTS_MAX - 1]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aad6d5d0fbfe60193366eaab88413f7af"></a><!-- doxytag: member="bgp_fsm.c::func" ref="aad6d5d0fbfe60193366eaab88413f7af" args=")(struct peer *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="ospf__nsm_8c.html#a03307f8a561731a5c5657834da57ab11">func</a>)(struct <a class="el" href="structpeer.html">peer</a> *)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00911">911</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac0c302bc97f010b7f5965faa07b00354"></a><!-- doxytag: member="bgp_fsm.c::next_state" ref="ac0c302bc97f010b7f5965faa07b00354" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ospf__nsm_8c.html#ac0c302bc97f010b7f5965faa07b00354">next_state</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00912">912</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>

</div>
</div>
<a class="anchor" id="a20174a312cef5d9aa6905c8bf6037020"></a><!-- doxytag: member="bgp_fsm.c::peer_down_str" ref="a20174a312cef5d9aa6905c8bf6037020" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="bgp__fsm_8h.html#a20174a312cef5d9aa6905c8bf6037020">peer_down_str</a>[]</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment">
{
  <span class="stringliteral">&quot;&quot;</span>,
  <span class="stringliteral">&quot;Router ID changed&quot;</span>,
  <span class="stringliteral">&quot;Remote AS changed&quot;</span>,
  <span class="stringliteral">&quot;Local AS change&quot;</span>,
  <span class="stringliteral">&quot;Cluster ID changed&quot;</span>,
  <span class="stringliteral">&quot;Confederation identifier changed&quot;</span>,
  <span class="stringliteral">&quot;Confederation peer changed&quot;</span>,
  <span class="stringliteral">&quot;RR client config change&quot;</span>,
  <span class="stringliteral">&quot;RS client config change&quot;</span>,
  <span class="stringliteral">&quot;Update source change&quot;</span>,
  <span class="stringliteral">&quot;Address family activated&quot;</span>,
  <span class="stringliteral">&quot;Admin. shutdown&quot;</span>,
  <span class="stringliteral">&quot;User reset&quot;</span>,
  <span class="stringliteral">&quot;BGP Notification received&quot;</span>,
  <span class="stringliteral">&quot;BGP Notification send&quot;</span>,
  <span class="stringliteral">&quot;Peer closed the session&quot;</span>,
  <span class="stringliteral">&quot;Neighbor deleted&quot;</span>,
  <span class="stringliteral">&quot;Peer-group add member&quot;</span>,
  <span class="stringliteral">&quot;Peer-group delete member&quot;</span>,
  <span class="stringliteral">&quot;Capability changed&quot;</span>,
  <span class="stringliteral">&quot;Passive config change&quot;</span>,
  <span class="stringliteral">&quot;Multihop config change&quot;</span>,
  <span class="stringliteral">&quot;NSF peer closed the session&quot;</span>
}
</pre></div>
<p>Definition at line <a class="el" href="bgp__fsm_8c_source.html#l00319">319</a> of file <a class="el" href="bgp__fsm_8c_source.html">bgp_fsm.c</a>.</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="bgp__fsm_8c.html">bgp_fsm.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:11 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
