<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OSPFN: bgpd/bgp_route.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OSPFN
   &#160;<span id="projectnumber">1.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('bgp__route_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">bgpd/bgp_route.c File Reference</div>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="zebra_8h_source.html">zebra.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="prefix_8h_source.html">prefix.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linklist_8h_source.html">linklist.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="memory_8h_source.html">memory.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="command_8h_source.html">command.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stream_8h_source.html">stream.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="filter_8h_source.html">filter.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="str_8h_source.html">str.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="routemap_8h_source.html">routemap.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="buffer_8h_source.html">buffer.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sockunion_8h_source.html">sockunion.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="plist_8h_source.html">plist.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="thread_8h_source.html">thread.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="workqueue_8h_source.html">workqueue.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgpd_8h_source.html">bgpd/bgpd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__table_8h_source.html">bgpd/bgp_table.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__route_8h_source.html">bgpd/bgp_route.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__attr_8h_source.html">bgpd/bgp_attr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__debug_8h_source.html">bgpd/bgp_debug.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__aspath_8h_source.html">bgpd/bgp_aspath.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__regex_8h_source.html">bgpd/bgp_regex.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__community_8h_source.html">bgpd/bgp_community.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__ecommunity_8h_source.html">bgpd/bgp_ecommunity.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__clist_8h_source.html">bgpd/bgp_clist.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__packet_8h_source.html">bgpd/bgp_packet.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__filter_8h_source.html">bgpd/bgp_filter.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__fsm_8h_source.html">bgpd/bgp_fsm.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__mplsvpn_8h_source.html">bgpd/bgp_mplsvpn.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__nexthop_8h_source.html">bgpd/bgp_nexthop.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__damp_8h_source.html">bgpd/bgp_damp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__advertise_8h_source.html">bgpd/bgp_advertise.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__zebra_8h_source.html">bgpd/bgp_zebra.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bgp__vty_8h_source.html">bgpd/bgp_vty.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for bgp_route.c:</div>
<div class="dyncontent">
<div class="center"><img src="bgp__route_8c__incl.png" border="0" usemap="#bgpd_2bgp__route_8c" alt=""/></div>
<map name="bgpd_2bgp__route_8c" id="bgpd_2bgp__route_8c">
<area shape="rect" id="node3" href="zebra_8h.html" title="zebra.h" alt="" coords="1296,155,1363,181"/><area shape="rect" id="node35" href="str_8h.html" title="str.h" alt="" coords="593,229,641,256"/><area shape="rect" id="node37" href="prefix_8h.html" title="prefix.h" alt="" coords="5,155,72,181"/><area shape="rect" id="node39" href="sockunion_8h.html" title="sockunion.h" alt="" coords="100,229,193,256"/><area shape="rect" id="node41" href="linklist_8h.html" title="linklist.h" alt="" coords="273,80,343,107"/><area shape="rect" id="node43" href="memory_8h.html" title="memory.h" alt="" coords="368,80,451,107"/><area shape="rect" id="node45" href="command_8h.html" title="command.h" alt="" coords="475,80,567,107"/><area shape="rect" id="node47" href="stream_8h.html" title="stream.h" alt="" coords="72,80,147,107"/><area shape="rect" id="node50" href="filter_8h.html" title="filter.h" alt="" coords="643,80,703,107"/><area shape="rect" id="node53" href="log_8h.html" title="log.h" alt="" coords="727,80,779,107"/><area shape="rect" id="node55" href="routemap_8h.html" title="routemap.h" alt="" coords="804,80,895,107"/><area shape="rect" id="node57" href="buffer_8h.html" title="buffer.h" alt="" coords="919,80,987,107"/><area shape="rect" id="node60" href="plist_8h.html" title="plist.h" alt="" coords="1012,80,1071,107"/><area shape="rect" id="node62" href="thread_8h.html" title="thread.h" alt="" coords="1095,80,1167,107"/><area shape="rect" id="node64" href="workqueue_8h.html" title="workqueue.h" alt="" coords="1191,80,1291,107"/><area shape="rect" id="node66" href="bgpd_8h.html" title="bgpd/bgpd.h" alt="" coords="97,155,196,181"/><area shape="rect" id="node69" href="bgp__table_8h.html" title="bgpd/bgp_table.h" alt="" coords="1503,155,1633,181"/><area shape="rect" id="node71" href="bgp__route_8h.html" title="bgpd/bgp_route.h" alt="" coords="1577,80,1708,107"/><area shape="rect" id="node74" href="bgp__attr_8h.html" title="bgpd/bgp_attr.h" alt="" coords="1821,155,1941,181"/><area shape="rect" id="node76" href="bgp__debug_8h.html" title="bgpd/bgp_debug.h" alt="" coords="1948,80,2087,107"/><area shape="rect" id="node79" href="bgp__aspath_8h.html" title="bgpd/bgp_aspath.h" alt="" coords="1783,80,1923,107"/><area shape="rect" id="node81" href="bgp__regex_8h.html" title="bgpd/bgp_regex.h" alt="" coords="1367,80,1501,107"/><area shape="rect" id="node84" href="bgp__community_8h.html" title="bgpd/bgp_community.h" alt="" coords="2111,80,2276,107"/><area shape="rect" id="node86" href="bgp__ecommunity_8h.html" title="bgpd/bgp_ecommunity.h" alt="" coords="2300,80,2473,107"/><area shape="rect" id="node88" href="bgp__clist_8h.html" title="bgpd/bgp_clist.h" alt="" coords="2498,80,2621,107"/><area shape="rect" id="node90" href="bgp__packet_8h.html" title="bgpd/bgp_packet.h" alt="" coords="2646,80,2785,107"/><area shape="rect" id="node92" href="bgp__filter_8h.html" title="bgpd/bgp_filter.h" alt="" coords="2810,80,2936,107"/><area shape="rect" id="node94" href="bgp__fsm_8h.html" title="bgpd/bgp_fsm.h" alt="" coords="2961,80,3081,107"/><area shape="rect" id="node96" href="bgp__mplsvpn_8h.html" title="bgpd/bgp_mplsvpn.h" alt="" coords="3106,80,3256,107"/><area shape="rect" id="node98" href="bgp__nexthop_8h.html" title="bgpd/bgp_nexthop.h" alt="" coords="3281,80,3431,107"/><area shape="rect" id="node100" href="bgp__damp_8h.html" title="bgpd/bgp_damp.h" alt="" coords="3456,80,3589,107"/><area shape="rect" id="node102" href="bgp__advertise_8h.html" title="bgpd/bgp_advertise.h" alt="" coords="3614,80,3769,107"/><area shape="rect" id="node104" href="bgp__zebra_8h.html" title="bgpd/bgp_zebra.h" alt="" coords="3794,80,3925,107"/><area shape="rect" id="node106" href="bgp__vty_8h.html" title="bgpd/bgp_vty.h" alt="" coords="3950,80,4068,107"/></map>
</div>
</div>
<p><a href="bgp__route_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structbgp__info__pair.html">bgp_info_pair</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structbgp__process__queue.html">bgp_process_queue</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structbgp__clear__node__queue.html">bgp_clear_node_queue</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#aad2e59c9369c87c82dfa5675d8d07bd7">FILTER_EXIST_WARN</a>(F, f, <a class="el" href="structfilter.html">filter</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#aad2e59c9369c87c82dfa5675d8d07bd7">FILTER_EXIST_WARN</a>(F, f, <a class="el" href="structfilter.html">filter</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#aa53a481b7842ad25b6c64997e04c4947">AGGREGATE_SUMMARY_ONLY</a>&#160;&#160;&#160;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a97d0aea8ac707ec410205604fd7f0631">AGGREGATE_AS_SET</a>&#160;&#160;&#160;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a5ae0e8bfb34727bb6d8d4317d583a96f">BGP_SHOW_SCODE_HEADER</a>&#160;&#160;&#160;&quot;Status codes: <a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a> suppressed, d damped, h history, * valid, &gt; best, <a class="el" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a> - internal,%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>              r RIB-failure, S Stale, R Removed%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a0dc6afd7013bcca2fae668668d132543">BGP_SHOW_OCODE_HEADER</a>&#160;&#160;&#160;&quot;Origin codes: <a class="el" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a> - IGP, e - EGP, ? - incomplete%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ab69314c97358f73260b12b79ba973762">BGP_SHOW_HEADER</a>&#160;&#160;&#160;&quot;   Network          Next Hop            Metric LocPrf Weight Path%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ad9d53449602e99ce02adfff813b3fcb6">BGP_SHOW_DAMP_HEADER</a>&#160;&#160;&#160;&quot;   Network          From             Reuse    Path%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a7e4bf40d9513827c713148862647e373">BGP_SHOW_FLAP_HEADER</a>&#160;&#160;&#160;&quot;   Network          From            Flaps Duration Reuse    Path%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>&quot;</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a28376b150f4dc5678918739889f323e6">bgp_afi_node_get</a> (struct <a class="el" href="structbgp__table.html">bgp_table</a> *table, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *prd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structbgp__info__extra.html">bgp_info_extra</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a87ee6a929c17bd9186e7125d5670a309">bgp_info_extra_new</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a757f441d0a803a7bbc6bc79dfa3200bd">bgp_info_extra_free</a> (struct <a class="el" href="structbgp__info__extra.html">bgp_info_extra</a> **extra)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structbgp__info__extra.html">bgp_info_extra</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a3afeebe128032bb8a486915820234af9">bgp_info_extra_get</a> (struct <a class="el" href="structbgp__info.html">bgp_info</a> *ri)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ac58054377984aaf2a3436dfe2ca91e53">bgp_info_new</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a5f6151beff24268f62320f62df673be2">bgp_info_free</a> (struct <a class="el" href="structbgp__info.html">bgp_info</a> *binfo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a58d087602593301ee3256a1ffd1321b8">bgp_info_lock</a> (struct <a class="el" href="structbgp__info.html">bgp_info</a> *binfo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a3616cc85cfe85d5f7911aa6f10f03eea">bgp_info_unlock</a> (struct <a class="el" href="structbgp__info.html">bgp_info</a> *binfo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ac7472ce06f993cd544f794c7b0381954">bgp_info_add</a> (struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, struct <a class="el" href="structbgp__info.html">bgp_info</a> *ri)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a4475c3919634039951683b34a18b1dee">bgp_info_reap</a> (struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, struct <a class="el" href="structbgp__info.html">bgp_info</a> *ri)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#abfe260239e1b72a286e9c45a5aa1afbd">bgp_info_delete</a> (struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, struct <a class="el" href="structbgp__info.html">bgp_info</a> *ri)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ae6999426a3503ae94836d8e1c040e38c">bgp_info_restore</a> (struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, struct <a class="el" href="structbgp__info.html">bgp_info</a> *ri)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#af45d15e7f24645ea70bf8f3c8250921d">bgp_pcount_adjust</a> (struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, struct <a class="el" href="structbgp__info.html">bgp_info</a> *ri)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, struct <a class="el" href="structbgp__info.html">bgp_info</a> *ri, u_int32_t flag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, struct <a class="el" href="structbgp__info.html">bgp_info</a> *ri, u_int32_t flag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static u_int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a58dff46a744315de3961a85990be81c9">bgp_med_value</a> (struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>, struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#adb9d04630ab93d7aee4950ee2a1b0ead">bgp_info_cmp</a> (struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, struct <a class="el" href="structbgp__info.html">bgp_info</a> *new, struct <a class="el" href="structbgp__info.html">bgp_info</a> *exist)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="filter_8h.html#ab3b7281956317556f846daaebf75de72">filter_type</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a779dd558c9e37130d6ac9029b74cdf12">bgp_input_filter</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="filter_8h.html#ab3b7281956317556f846daaebf75de72">filter_type</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a964b57dc2ca2170b988ca239878a9118">bgp_output_filter</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a52f73611e235740976722005ed9da75b">bgp_community_filter</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a7e09865b6ccdcb2325e714cffa6ed5f2">bgp_cluster_filter</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a2f762007f1c8ecfd0a06a8430d1e0523">bgp_input_modifier</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ad1c9f872f6253932e08bbc9d071f39c3">bgp_export_modifier</a> (struct <a class="el" href="structpeer.html">peer</a> *rsclient, struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a0b543935bc92b0cd8fa61813637f0179">bgp_import_modifier</a> (struct <a class="el" href="structpeer.html">peer</a> *rsclient, struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a7a3b743168235f6f62a99f82c20fcdf1">bgp_announce_check</a> (struct <a class="el" href="structbgp__info.html">bgp_info</a> *ri, struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a35b4c8839d28c1fadc0173bfe0898234">bgp_announce_check_rsclient</a> (struct <a class="el" href="structbgp__info.html">bgp_info</a> *ri, struct <a class="el" href="structpeer.html">peer</a> *rsclient, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#aefec15f33656cb69b4b71702afdca06a">bgp_best_selection</a> (struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, struct <a class="el" href="structbgp__info__pair.html">bgp_info_pair</a> *result)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a68f69dcd72afe7aeb53608418fc55385">bgp_process_announce_selected</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structbgp__info.html">bgp_info</a> *selected, struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="workqueue_8h.html#a0e78d42489413cdb20b75485932a3885">wq_item_status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a1b806ca9b67898e23d008da9bb105064">bgp_process_rsclient</a> (struct <a class="el" href="structwork__queue.html">work_queue</a> *wq, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="workqueue_8h.html#a0e78d42489413cdb20b75485932a3885">wq_item_status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a6cc2493931ee28e8ec979bf8f4bf4953">bgp_process_main</a> (struct <a class="el" href="structwork__queue.html">work_queue</a> *wq, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#af596ac3e45fe6f173643ea336dd454d4">bgp_processq_del</a> (struct <a class="el" href="structwork__queue.html">work_queue</a> *wq, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a6b080892b6ca3f0108ab232772574a3f">bgp_process_queue_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#aa5fa9e55ce4581d5456d115a3f0a38a6">bgp_maximum_prefix_restart_timer</a> (struct <a class="el" href="structthread.html">thread</a> *<a class="el" href="structthread.html">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ace201bd3f5b8b07afc5143b88a179c55">bgp_maximum_prefix_overflow</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, int always)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#af17eefd0fc4a1bd8d98f657810e26741">bgp_rib_remove</a> (struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, struct <a class="el" href="structbgp__info.html">bgp_info</a> *ri, struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a97b525c43ec4d1f2a86b597317b78051">bgp_rib_withdraw</a> (struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, struct <a class="el" href="structbgp__info.html">bgp_info</a> *ri, struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a35a6938b2231aa460e1ce4a1d767b89f">bgp_update_rsclient</a> (struct <a class="el" href="structpeer.html">peer</a> *rsclient, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>, struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, int <a class="el" href="ripng__zebra_8c.html#ac765329451135abec74c45e1897abf26">type</a>, int sub_type, struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *prd, u_char *tag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a6f60f6d4e63b4cb347a05b4b07fb36c9">bgp_withdraw_rsclient</a> (struct <a class="el" href="structpeer.html">peer</a> *rsclient, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, int <a class="el" href="ripng__zebra_8c.html#ac765329451135abec74c45e1897abf26">type</a>, int sub_type, struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *prd, u_char *tag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a2a2424f26bef521959d23ff57611f86a">bgp_update_main</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, int <a class="el" href="ripng__zebra_8c.html#ac765329451135abec74c45e1897abf26">type</a>, int sub_type, struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *prd, u_char *tag, int soft_reconfig)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#adead0e338559e1bf15f14c261fbe975d">bgp_update</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, int <a class="el" href="ripng__zebra_8c.html#ac765329451135abec74c45e1897abf26">type</a>, int sub_type, struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *prd, u_char *tag, int soft_reconfig)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a1e246b33bc776aab326a127170921d6d">bgp_withdraw</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, int <a class="el" href="ripng__zebra_8c.html#ac765329451135abec74c45e1897abf26">type</a>, int sub_type, struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *prd, u_char *tag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a655014556fe828ec1f15a0189cc8869b">bgp_default_originate</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, int withdraw)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#aed62e72345c65c8374702d58b4d8a5fa">bgp_announce_table</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, struct <a class="el" href="structbgp__table.html">bgp_table</a> *table, int rsclient)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a034115d44bc2a9935df0a481d462aaf7">bgp_announce_route</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a2339aa5e61e6711862d4f6e0eab3ce56">bgp_announce_route_all</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a9a99b91321b9ba23f772dbc64c285e70">bgp_soft_reconfig_table_rsclient</a> (struct <a class="el" href="structpeer.html">peer</a> *rsclient, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, struct <a class="el" href="structbgp__table.html">bgp_table</a> *table)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a5c1eb3bbdaa82d1e5b7b3307de25b12d">bgp_soft_reconfig_rsclient</a> (struct <a class="el" href="structpeer.html">peer</a> *rsclient, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a361e68a96de5fa35c4d78b6a4c6dc984">bgp_soft_reconfig_table</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, struct <a class="el" href="structbgp__table.html">bgp_table</a> *table)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a74f36e1ccbb82b25e96dbdda5ba35f66">bgp_soft_reconfig_in</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="workqueue_8h.html#a0e78d42489413cdb20b75485932a3885">wq_item_status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a71b5f58e93daf052072424f96f865cf0">bgp_clear_route_node</a> (struct <a class="el" href="structwork__queue.html">work_queue</a> *wq, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a2907d3d7870eaf13efa465e491e5d42e">bgp_clear_node_queue_del</a> (struct <a class="el" href="structwork__queue.html">work_queue</a> *wq, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ac0796b20b150f25a0bb4f1427ac71c86">bgp_clear_node_complete</a> (struct <a class="el" href="structwork__queue.html">work_queue</a> *wq)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a59f1fa7a624fe068801d9dc834b7272f">bgp_clear_node_queue_init</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ad3a33b21d2801a0df0a610da8d41783f">bgp_clear_route_table</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, struct <a class="el" href="structbgp__table.html">bgp_table</a> *table, struct <a class="el" href="structpeer.html">peer</a> *rsclient, enum <a class="el" href="bgp__route_8h.html#a6a68ec86881e2e24c1dfdd8a47267e81">bgp_clear_route_type</a> purpose)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a6b07bcee214a0802a945370276bb213e">bgp_clear_route</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi, enum <a class="el" href="bgp__route_8h.html#a6a68ec86881e2e24c1dfdd8a47267e81">bgp_clear_route_type</a> purpose)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ac73f860ac71768cc3169bf96512d1b1c">bgp_clear_route_all</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a4abd5523ec63ec028d8ca35259161533">bgp_clear_adj_in</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#aa1dd948948425c7e30941a8816af5bb1">bgp_clear_stale_route</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#adf17dd6a8dfaa2ab4f271b491de030d0">bgp_cleanup_routes</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a716aead52529e1e5b1f5606155e859a5">bgp_reset</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a1d7233eea42c8d4eeb9470fe30e42fed">bgp_nlri_parse</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, struct <a class="el" href="structattr.html">attr</a> *<a class="el" href="structattr.html">attr</a>, struct <a class="el" href="structbgp__nlri.html">bgp_nlri</a> *packet)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ae571d879d9e98f7737dc129b7b90b413">bgp_nlri_sanity_check</a> (struct <a class="el" href="structpeer.html">peer</a> *<a class="el" href="structpeer.html">peer</a>, int afi, u_char *pnt, <a class="el" href="bgpd_8h.html#ae2ac1a1db99d420f5a214c418552fd1e">bgp_size_t</a> <a class="el" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structbgp__static.html">bgp_static</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a3ba6f7387a668fed8fced2ea48559855">bgp_static_new</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ab9ed95d988c9782fbfda8fe175344bda">bgp_static_free</a> (struct <a class="el" href="structbgp__static.html">bgp_static</a> *<a class="el" href="structbgp__static.html">bgp_static</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#aa0a729167c9cf61c833c3c12a7c35e9a">bgp_static_withdraw_rsclient</a> (struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, struct <a class="el" href="structpeer.html">peer</a> *rsclient, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#adde0f36163e0fb2c47de7cf95f8bbe56">bgp_static_update_rsclient</a> (struct <a class="el" href="structpeer.html">peer</a> *rsclient, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structbgp__static.html">bgp_static</a> *<a class="el" href="structbgp__static.html">bgp_static</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#adf87800006cc4fc05a3eb602e9870697">bgp_static_update_main</a> (struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structbgp__static.html">bgp_static</a> *<a class="el" href="structbgp__static.html">bgp_static</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#abbcc2b564375f6ab82f7622042f4c69f">bgp_static_update</a> (struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, struct <a class="el" href="structbgp__static.html">bgp_static</a> *<a class="el" href="structbgp__static.html">bgp_static</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a993bebd87ca0ad9166c4e65c697c9f79">bgp_static_update_vpnv4</a> (struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, u_int16_t afi, u_char safi, struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *prd, u_char *tag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a14bde9043b6db15a3327081054b54dbe">bgp_static_withdraw</a> (struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a2fdb62c8a10046002627ce0298e0d404">bgp_check_local_routes_rsclient</a> (struct <a class="el" href="structpeer.html">peer</a> *rsclient, <a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi, <a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a949bc552da03f5b91ab061802527294b">bgp_static_withdraw_vpnv4</a> (struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, struct <a class="el" href="structprefix.html">prefix</a> *<a class="el" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, u_int16_t afi, u_char safi, struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *prd, u_char *tag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a45bb68a5cf818ba7d1921baf0e62ccf2">bgp_pathlimit_update_parents</a> (struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, struct <a class="el" href="structbgp__node.html">bgp_node</a> *rn, int ttl_edge)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ad82b3e0221971ab424dc936b7fcbea1a">bgp_static_set</a> (struct <a class="el" href="structvty.html">vty</a> *<a class="el" href="structvty.html">vty</a>, struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, const char *ip_str, u_int16_t afi, u_char safi, const char *<a class="el" href="structrmap.html">rmap</a>, int backdoor, u_char ttl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a5d4486300e5e46449dbbea9ae3f1af77">bgp_static_unset</a> (struct <a class="el" href="structvty.html">vty</a> *<a class="el" href="structvty.html">vty</a>, struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>, const char *ip_str, u_int16_t afi, u_char safi)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a4902f0940ffe01568daa3d9df842c874">bgp_static_delete</a> (struct <a class="el" href="structbgp.html">bgp</a> *<a class="el" href="structbgp.html">bgp</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a477ac70385162d533769b46a560133f6">bgp_static_set_vpnv4</a> (struct <a class="el" href="structvty.html">vty</a> *<a class="el" href="structvty.html">vty</a>, const char *ip_str, const char *rd_str, const char *tag_str)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ab02340eb78bf5d97ddafce4f0fc948fa">bgp_static_unset_vpnv4</a> (struct <a class="el" href="structvty.html">vty</a> *<a class="el" href="structvty.html">vty</a>, const char *ip_str, const char *rd_str, const char *tag_str)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a7ce345bb3824b60bf647d936d874322c">DEFUN</a> (bgp_network, bgp_network_cmd,&quot;network A.B.C.D/M&quot;,&quot;Specify a <a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a> to announce via BGP\<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>&quot;&quot;IP <a class="el" href="structprefix.html">prefix</a> &lt;<a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a>&gt;/&lt;<a class="el" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a>&gt;, e.g., 35.0.0.0/8\<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ae361cfa3fc605563c3161753278c18e3">ALIAS</a> (bgp_network, bgp_network_ttl_cmd,&quot;network A.B.C.D/M pathlimit &lt;0-255&gt;&quot;,&quot;Specify a <a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a> to announce via BGP\<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>&quot;&quot;IP <a class="el" href="structprefix.html">prefix</a> &lt;<a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a>&gt;/&lt;<a class="el" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a>&gt;, e.g., 35.0.0.0/8\<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>&quot;&quot;AS-Path hopcount limit attribute\<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>&quot;&quot;AS-Pathlimit TTL, <a class="el" href="spgrid_8c.html#a89e1c555af4b92f6ee8d6f112f47ed12">in</a> number of AS-Path hops\<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>&quot;) DEFUN(bgp_network_route_map</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ab1c6c37df170ace398e3657b5df5ba6f">bgp_origin_str</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a7123f83b15faa017071a458140399e7c">bgp_origin_long_str</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#ad5aca6be105a2339aa723cfae3c1822c">bgp_network_route_map_cmd</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a> A B C D M route map&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a1b8d8f33ec8896a62ab53afa7351c08b">WORD</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a> A B C D M route map <br class="typebreak"/>
Specify a <a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a> to announce <br class="typebreak"/>
via BGP <a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a> IP <a class="el" href="structprefix.html">prefix</a>&lt; <a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a> &gt;<br class="typebreak"/>
&lt; <a class="el" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a> &gt; e&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bgp__route_8c.html#a7ffdcd98fe58cb9d89e7f6aa804288e1">g</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a97d0aea8ac707ec410205604fd7f0631"></a><!-- doxytag: member="bgp_route.c::AGGREGATE_AS_SET" ref="a97d0aea8ac707ec410205604fd7f0631" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AGGREGATE_AS_SET&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aa53a481b7842ad25b6c64997e04c4947"></a><!-- doxytag: member="bgp_route.c::AGGREGATE_SUMMARY_ONLY" ref="aa53a481b7842ad25b6c64997e04c4947" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AGGREGATE_SUMMARY_ONLY&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ad9d53449602e99ce02adfff813b3fcb6"></a><!-- doxytag: member="bgp_route.c::BGP_SHOW_DAMP_HEADER" ref="ad9d53449602e99ce02adfff813b3fcb6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BGP_SHOW_DAMP_HEADER&#160;&#160;&#160;&quot;   Network          From             Reuse    Path%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a7e4bf40d9513827c713148862647e373"></a><!-- doxytag: member="bgp_route.c::BGP_SHOW_FLAP_HEADER" ref="a7e4bf40d9513827c713148862647e373" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BGP_SHOW_FLAP_HEADER&#160;&#160;&#160;&quot;   Network          From            Flaps Duration Reuse    Path%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ab69314c97358f73260b12b79ba973762"></a><!-- doxytag: member="bgp_route.c::BGP_SHOW_HEADER" ref="ab69314c97358f73260b12b79ba973762" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BGP_SHOW_HEADER&#160;&#160;&#160;&quot;   Network          Next Hop            Metric LocPrf Weight Path%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a0dc6afd7013bcca2fae668668d132543"></a><!-- doxytag: member="bgp_route.c::BGP_SHOW_OCODE_HEADER" ref="a0dc6afd7013bcca2fae668668d132543" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BGP_SHOW_OCODE_HEADER&#160;&#160;&#160;&quot;Origin codes: <a class="el" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a> - IGP, e - EGP, ? - incomplete%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5ae0e8bfb34727bb6d8d4317d583a96f"></a><!-- doxytag: member="bgp_route.c::BGP_SHOW_SCODE_HEADER" ref="a5ae0e8bfb34727bb6d8d4317d583a96f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BGP_SHOW_SCODE_HEADER&#160;&#160;&#160;&quot;Status codes: <a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a> suppressed, d damped, h history, * valid, &gt; best, <a class="el" href="spgrid_8c.html#a139066bd9e344a8daae82c5ca919fffe">i</a> - internal,%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>              r RIB-failure, S Stale, R Removed%<a class="el" href="spgrid_8c.html#a5d97d3b42a0d6c9ec9a3e56f2616a6a5">s</a>&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aad2e59c9369c87c82dfa5675d8d07bd7"></a><!-- doxytag: member="bgp_route.c::FILTER_EXIST_WARN" ref="aad2e59c9369c87c82dfa5675d8d07bd7" args="(F, f, filter)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FILTER_EXIST_WARN</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">F, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">f, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="structfilter.html">filter</a>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN) \
      &amp;&amp; !(<a class="code" href="md5_8c.html#ad6d7c306af62dbc87d1fcde6cb1bfb0e">F</a> ## _IN (<a class="code" href="structfilter.html">filter</a>))) \
    plog_warn (<a class="code" href="structpeer.html">peer</a>-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, <span class="stringliteral">&quot;%s: Could not find configured input %s-list %s!&quot;</span>, \
               <a class="code" href="structpeer.html">peer</a>-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, #f, <a class="code" href="md5_8c.html#ad6d7c306af62dbc87d1fcde6cb1bfb0e">F</a> ## _IN_NAME(<a class="code" href="structfilter.html">filter</a>));
</pre></div>
</div>
</div>
<a class="anchor" id="aad2e59c9369c87c82dfa5675d8d07bd7"></a><!-- doxytag: member="bgp_route.c::FILTER_EXIST_WARN" ref="aad2e59c9369c87c82dfa5675d8d07bd7" args="(F, f, filter)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FILTER_EXIST_WARN</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">F, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">f, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="structfilter.html">filter</a>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_OUT) \
      &amp;&amp; !(<a class="code" href="md5_8c.html#ad6d7c306af62dbc87d1fcde6cb1bfb0e">F</a> ## _OUT (<a class="code" href="structfilter.html">filter</a>))) \
    plog_warn (<a class="code" href="structpeer.html">peer</a>-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, <span class="stringliteral">&quot;%s: Could not find configured output %s-list %s!&quot;</span>, \
               <a class="code" href="structpeer.html">peer</a>-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, #f, <a class="code" href="md5_8c.html#ad6d7c306af62dbc87d1fcde6cb1bfb0e">F</a> ## _OUT_NAME(<a class="code" href="structfilter.html">filter</a>));
</pre></div>
</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ae361cfa3fc605563c3161753278c18e3"></a><!-- doxytag: member="bgp_route.c::ALIAS" ref="ae361cfa3fc605563c3161753278c18e3" args="(bgp_network, bgp_network_ttl_cmd,&quot;network A.B.C.D/M pathlimit &lt;0&#45;255&gt;&quot;,&quot;Specify a network to announce via BGP\n&quot;&quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;&quot;AS&#45;Path hopcount limit attribute\n&quot;&quot;AS&#45;Pathlimit TTL, in number of AS&#45;Path hops\n&quot;) DEFUN(bgp_network_route_map" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ALIAS </td>
          <td>(</td>
          <td class="paramtype">bgp_network&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_network_ttl_cmd&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;network A.B.C.D/M pathlimit &lt;0-255&gt;&quot;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Specify a <a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a> to announce via BGP\<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>&quot;&quot;IP <a class="el" href="structprefix.html">prefix</a> &lt;<a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a>&gt;/&lt;<a class="el" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a>&gt;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">e.&#160;</td>
          <td class="paramname"><em>g.</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">35.0.0.0/8\<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>&quot; &quot;AS-Path hopcount limit attribute\<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>&quot; &quot;AS-Pathlimit&#160;</td>
          <td class="paramname"><em>TTL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="spgrid_8c.html#a89e1c555af4b92f6ee8d6f112f47ed12">in</a> number of AS-Path hops\<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>&quot;&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a28376b150f4dc5678918739889f323e6"></a><!-- doxytag: member="bgp_route.c::bgp_afi_node_get" ref="a28376b150f4dc5678918739889f323e6" args="(struct bgp_table *table, afi_t afi, safi_t safi, struct prefix *p, struct prefix_rd *prd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structbgp__node.html">bgp_node</a>* bgp_afi_node_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__table.html">bgp_table</a> *&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *&#160;</td>
          <td class="paramname"><em>prd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00063">63</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *<a class="code" href="structbgp__node.html#ae70689440c2ce67c611d4e645967b000">prn</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (table);
  <span class="keywordflow">if</span> (!table)
    <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  
  <span class="keywordflow">if</span> (safi == <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
    {
      prn = <a class="code" href="bgp__table_8c.html#a81c9e9d48e2d66148c713e82968df389">bgp_node_get</a> (table, (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *) prd);

      <span class="keywordflow">if</span> (prn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    prn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> = <a class="code" href="bgp__table_8c.html#afbe454c63fbb296e768cb66efa0962da">bgp_table_init</a> (afi, safi);
      <span class="keywordflow">else</span>
    <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (prn);
      table = prn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>;
    }

  rn = <a class="code" href="bgp__table_8c.html#a81c9e9d48e2d66148c713e82968df389">bgp_node_get</a> (table, p);

  <span class="keywordflow">if</span> (safi == <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
    rn-&gt;<a class="code" href="structbgp__node.html#ae70689440c2ce67c611d4e645967b000">prn</a> = <a class="code" href="structbgp__node.html#ae70689440c2ce67c611d4e645967b000">prn</a>;

  <span class="keywordflow">return</span> rn;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7a3b743168235f6f62a99f82c20fcdf1"></a><!-- doxytag: member="bgp_route.c::bgp_announce_check" ref="a7a3b743168235f6f62a99f82c20fcdf1" args="(struct bgp_info *ri, struct peer *peer, struct prefix *p, struct attr *attr, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_announce_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00757">757</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <span class="keywordtype">char</span> buf[<a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>];
  <span class="keyword">struct </span><a class="code" href="structbgp__filter.html">bgp_filter</a> *<a class="code" href="structfilter.html">filter</a>;
  <span class="keyword">struct </span>peer *from;
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
  <span class="keywordtype">int</span> transparent;
  <span class="keywordtype">int</span> reflect;

  from = ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>;
  filter = &amp;peer-&gt;<a class="code" href="structpeer.html#a8ae54829ca91f5860216eb326f264727">filter</a>[afi][safi];
  bgp = peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>;
  
  <span class="keywordflow">if</span> (DISABLE_BGP_ANNOUNCE)
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* Do not send announces to RS-clients from the &#39;normal&#39; bgp_table. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#abf59e9a9022e80ecdc266d86f35b378e">PEER_FLAG_RSERVER_CLIENT</a>))
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* Do not send back route to sender. */</span>
  <span class="keywordflow">if</span> (from == peer)
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* If peer&#39;s id and route&#39;s nexthop are same. draft-ietf-idr-bgp4-23 5.1.3 */</span>
  <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET
      &amp;&amp; <a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a>(&amp;peer-&gt;<a class="code" href="structpeer.html#ae620d85ff35b31ba9eb6073b81731b5b">remote_id</a>, &amp;ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>))
    <span class="keywordflow">return</span> 0;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6
     &amp;&amp; <a class="code" href="prefix_8h.html#a5f1eaa85b153050a498dacc958ab8283">IPV6_ADDR_SAME</a>(&amp;peer-&gt;<a class="code" href="structpeer.html#ae620d85ff35b31ba9eb6073b81731b5b">remote_id</a>, &amp;ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>))
    <span class="keywordflow">return</span> 0;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="comment">/* Aggregate-address suppress check. */</span>
  <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a> &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#a2ce49edfd26233ffebc24dc616d04835">suppress</a>)
    <span class="keywordflow">if</span> (! <a class="code" href="bgp__route_8h.html#a5d8b5b2174fe271354ba0def2c0a749e">UNSUPPRESS_MAP_NAME</a> (filter))
      <span class="keywordflow">return</span> 0;

  <span class="comment">/* Default route check.  */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a7ce39647237ee1e1b720e6d0d4056efe">PEER_STATUS_DEFAULT_ORIGINATE</a>))
    {
      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET &amp;&amp; p-&gt;u.<a class="code" href="structprefix.html#ab37b8922554b41b7dc2417d8f37e7829">prefix4</a>.s_addr == INADDR_ANY)
    <span class="keywordflow">return</span> 0;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6 &amp;&amp; p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> == 0)
    <span class="keywordflow">return</span> 0;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
    }

  <span class="comment">/* Transparency check. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#abf59e9a9022e80ecdc266d86f35b378e">PEER_FLAG_RSERVER_CLIENT</a>)
      &amp;&amp; <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (from-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#abf59e9a9022e80ecdc266d86f35b378e">PEER_FLAG_RSERVER_CLIENT</a>))
    transparent = 1;
  <span class="keywordflow">else</span>
    transparent = 0;

  <span class="comment">/* If community is not disabled check the no-export and local. */</span>
  <span class="keywordflow">if</span> (! transparent &amp;&amp; <a class="code" href="bgp__route_8c.html#a52f73611e235740976722005ed9da75b">bgp_community_filter</a> (peer, ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>)) 
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* If the attribute has originator-id and it is same as remote</span>
<span class="comment">     peer&#39;s id. */</span>
  <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp; <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#a4c57fcfdf8e83e8d6dce5369a9697244">BGP_ATTR_ORIGINATOR_ID</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a> (&amp;peer-&gt;<a class="code" href="structpeer.html#ae620d85ff35b31ba9eb6073b81731b5b">remote_id</a>, &amp;ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#a2a675121474a39bf5d9f95393b00e156">originator_id</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (filter, FILTER))  
        <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
          <span class="stringliteral">&quot;%s [Update:SEND] %s/%d originator-id is same as remote router-id&quot;</span>,
          peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
          <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a>(p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
          p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>);
      <span class="keywordflow">return</span> 0;
    }
    }
 
  <span class="comment">/* ORF prefix-list filter check */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#aa073ee4ea1d90b2d2971682f4a373776">PEER_CAP_ORF_PREFIX_RM_ADV</a>)
      &amp;&amp; (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#a4883c0951321050f52731ef009c2dd17">PEER_CAP_ORF_PREFIX_SM_RCV</a>)
      || <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#ae0da0dd013880e12f7d1160d002735a6">PEER_CAP_ORF_PREFIX_SM_OLD_RCV</a>)))
    <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a2473c352a18c1a1169cd01754dbfc993">orf_plist</a>[afi][safi])
      {
    <span class="keywordflow">if</span> (<a class="code" href="plist_8c.html#a6fd9bac08d2cb3d2e315d88af146a7f0">prefix_list_apply</a> (peer-&gt;<a class="code" href="structpeer.html#a2473c352a18c1a1169cd01754dbfc993">orf_plist</a>[afi][safi], p) == <a class="code" href="plist_8h.html#a3bda5ec3d1202bc8eb472b4d97633cf9a697cf8d0db0ead308a6ef01301f9543c">PREFIX_DENY</a>)
          <span class="keywordflow">return</span> 0;
      }

  <span class="comment">/* Output filter check. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8c.html#a964b57dc2ca2170b988ca239878a9118">bgp_output_filter</a> (peer, p, ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>, afi, safi) == <a class="code" href="filter_8h.html#ab3b7281956317556f846daaebf75de72a898abadf6cc2f9d27780782f09d3a3e3">FILTER_DENY</a>)
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (filter, FILTER))
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
          <span class="stringliteral">&quot;%s [Update:SEND] %s/%d is filtered&quot;</span>,
          peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
          <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a>(p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
          p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>);
      <span class="keywordflow">return</span> 0;
    }

<span class="preprocessor">#ifdef BGP_SEND_ASPATH_CHECK</span>
<span class="preprocessor"></span>  <span class="comment">/* AS path loop check. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__aspath_8c.html#a09c83e4313915a5191a19439186f2280">aspath_loop_check</a> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>, peer-&gt;<a class="code" href="structpeer.html#aa35fab1a77bb496d8377a62cad372314">as</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (filter, FILTER))  
        <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG, 
          <span class="stringliteral">&quot;%s [Update:SEND] suppress announcement to peer AS %u is AS path.&quot;</span>,
          peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, peer-&gt;<a class="code" href="structpeer.html#aa35fab1a77bb496d8377a62cad372314">as</a>);
      <span class="keywordflow">return</span> 0;
    }
<span class="preprocessor">#endif </span><span class="comment">/* BGP_SEND_ASPATH_CHECK */</span>

  <span class="comment">/* If we&#39;re a CONFED we need to loop check the CONFED ID too */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(bgp-&gt;<a class="code" href="structbgp.html#a3444d46283ecd1ecc8710fd44c331151">config</a>, <a class="code" href="bgpd_8h.html#a4170cb60239697ba9e788ac74e756ae3">BGP_CONFIG_CONFEDERATION</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__aspath_8c.html#a09c83e4313915a5191a19439186f2280">aspath_loop_check</a>(ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>, bgp-&gt;<a class="code" href="structbgp.html#a57a1abec0cfd4f42ccdd002df8afb740">confed_id</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (filter, FILTER))  
        <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG, 
          <span class="stringliteral">&quot;%s [Update:SEND] suppress announcement to peer AS %u is AS path.&quot;</span>,
          peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
          bgp-&gt;<a class="code" href="structbgp.html#a57a1abec0cfd4f42ccdd002df8afb740">confed_id</a>);
      <span class="keywordflow">return</span> 0;
    }      
    }

  <span class="comment">/* Route-Reflect check. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (from) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a9e245a415718944a081734a08a8d7e92">BGP_PEER_IBGP</a> &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a9e245a415718944a081734a08a8d7e92">BGP_PEER_IBGP</a>)
    reflect = 1;
  <span class="keywordflow">else</span>
    reflect = 0;

  <span class="comment">/* IBGP reflection check. */</span>
  <span class="keywordflow">if</span> (reflect)
    {
      <span class="comment">/* A route from a Client peer. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (from-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#adcd3e1187c28159f105bebf2396f68eb">PEER_FLAG_REFLECTOR_CLIENT</a>))
    {
      <span class="comment">/* Reflect to all the Non-Client peers and also to the</span>
<span class="comment">             Client peers other than the originator.  Originator check</span>
<span class="comment">             is already done.  So there is noting to do. */</span>
      <span class="comment">/* no bgp client-to-client reflection check. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#a0b3388d8ac73af2d4f4f22e46746da1e">bgp_flag_check</a> (bgp, <a class="code" href="bgpd_8h.html#ac0d32e044da2ef04e2cb924c60c9186c">BGP_FLAG_NO_CLIENT_TO_CLIENT</a>))
        <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#adcd3e1187c28159f105bebf2396f68eb">PEER_FLAG_REFLECTOR_CLIENT</a>))
          <span class="keywordflow">return</span> 0;
    }
      <span class="keywordflow">else</span>
    {
      <span class="comment">/* A route from a Non-client peer. Reflect to all other</span>
<span class="comment">         clients. */</span>
      <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#adcd3e1187c28159f105bebf2396f68eb">PEER_FLAG_REFLECTOR_CLIENT</a>))
        <span class="keywordflow">return</span> 0;
    }
    }
  
  <span class="comment">/* AS-Pathlimit check */</span>
  <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a0f7b3d80060491aa2bc639577e660089">ttl</a> &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a>)
    <span class="comment">/* Our ASN has not yet been pre-pended, that&#39;s done in packet_attribute</span>
<span class="comment">     * on output. Hence the test here is for &gt;=.</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> (<a class="code" href="bgp__aspath_8c.html#ae0142a952a7219bbe0244f266ab0f0f5">aspath_count_hops</a> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>) &gt;= ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a0f7b3d80060491aa2bc639577e660089">ttl</a>)
      {
        <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (filter, FILTER))
          <a class="code" href="log_8h.html#a383184727341e7ad985deb9e4f2156c7">zlog_info</a> (<span class="stringliteral">&quot;%s [Update:SEND] suppressed, AS-Pathlimit TTL %u exceeded&quot;</span>,
                     peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a0f7b3d80060491aa2bc639577e660089">ttl</a>);
        <span class="keywordflow">return</span> 0;
      }
  
  <span class="comment">/* For modify attribute, copy it to temporary structure. */</span>
  <a class="code" href="bgp__attr_8c.html#a39f33acb3fdd3ade629a9b7d66e74ea9">bgp_attr_dup</a> (attr, ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>);
  
  <span class="comment">/* If local-preference is not set. */</span>
  <span class="keywordflow">if</span> ((<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a9e245a415718944a081734a08a8d7e92">BGP_PEER_IBGP</a> 
       || <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a647ad85450d688c959849bc89cd9ccb8">BGP_PEER_CONFED</a>) 
      &amp;&amp; (! (attr-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp; <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#afb9037d30bc0d4b42c7960ffefcbd299">BGP_ATTR_LOCAL_PREF</a>))))
    {
      attr-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> |= <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#afb9037d30bc0d4b42c7960ffefcbd299">BGP_ATTR_LOCAL_PREF</a>);
      attr-&gt;<a class="code" href="structattr.html#aa7caa960ced4e67e8aec2b0ab3d9b0b0">local_pref</a> = bgp-&gt;<a class="code" href="structbgp.html#a401cfb8180562498c071d48e0fe58c97">default_local_pref</a>;
    }

  <span class="comment">/* Remove MED if its an EBGP peer - will get overwritten by route-maps */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a> 
      &amp;&amp; attr-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp; <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#a2f0c3d68f255eba5612c46147522334e">BGP_ATTR_MULTI_EXIT_DISC</a>))
    {
      <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> != bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a> &amp;&amp; ! transparent
      &amp;&amp; ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a35bb3a5e8c5ab0d68bbd67dad90ea7c2">PEER_FLAG_MED_UNCHANGED</a>))
    attr-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp;= ~(<a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#a2f0c3d68f255eba5612c46147522334e">BGP_ATTR_MULTI_EXIT_DISC</a>));
    }

  <span class="comment">/* next-hop-set */</span>
  <span class="keywordflow">if</span> (transparent || reflect
      || (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a6ee21078b7619d2d06901bf22519dea6">PEER_FLAG_NEXTHOP_UNCHANGED</a>)
      &amp;&amp; ((p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET &amp;&amp; attr-&gt;<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>.s_addr)
#ifdef HAVE_IPV6
          || (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6 &amp;&amp; 
                  ! IN6_IS_ADDR_UNSPECIFIED(&amp;attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;mp_nexthop_global))
#endif <span class="comment">/* HAVE_IPV6 */</span>
          )))
    {
      <span class="comment">/* NEXT-HOP Unchanged. */</span>
    }
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a81ac724618a5428b3af519e296c0263e">PEER_FLAG_NEXTHOP_SELF</a>)
       || (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET &amp;&amp; attr-&gt;<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>.s_addr == 0)
#ifdef HAVE_IPV6
       || (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6 &amp;&amp; 
               IN6_IS_ADDR_UNSPECIFIED(&amp;attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;mp_nexthop_global))
#endif <span class="comment">/* HAVE_IPV6 */</span>
       || (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a>
           &amp;&amp; <a class="code" href="bgp__nexthop_8c.html#a40288c74e1b34a270e8b017b5ee1cc02">bgp_multiaccess_check_v4</a> (attr-&gt;<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>) == 0))
    {
      <span class="comment">/* Set IPv4 nexthop. */</span>
      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET)
    {
      <span class="keywordflow">if</span> (safi == <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
        <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#ad484cadabc20c8009a458845216623f8">mp_nexthop_global_in</a>, &amp;peer-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.<a class="code" href="structbgp__nexthop.html#a8fed6fdf9282fb5e87f3f52b94313646">v4</a>,
                <a class="code" href="prefix_8h.html#a013983d7a5267a63023c50ab32a85c24">IPV4_MAX_BYTELEN</a>);
      <span class="keywordflow">else</span>
        <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;attr-&gt;<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>, &amp;peer-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.<a class="code" href="structbgp__nexthop.html#a8fed6fdf9282fb5e87f3f52b94313646">v4</a>, <a class="code" href="prefix_8h.html#a013983d7a5267a63023c50ab32a85c24">IPV4_MAX_BYTELEN</a>);
    }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>      <span class="comment">/* Set IPv6 nexthop. */</span>
      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6)
    {
      <span class="comment">/* IPv6 global nexthop must be included. */</span>
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;mp_nexthop_global, &amp;peer-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.v6_global, 
          <a class="code" href="prefix_8h.html#ac2642af4f4d7a4209ad6261e72c658f9">IPV6_MAX_BYTELEN</a>);
      attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a> = 16;
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
    }

<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6)
    {
      <span class="comment">/* Left nexthop_local unchanged if so configured. */</span> 
      <span class="keywordflow">if</span> ( <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], 
           <a class="code" href="bgpd_8h.html#abba8d6c84283161714fa65e519a3e3ac">PEER_FLAG_NEXTHOP_LOCAL_UNCHANGED</a>) )
        {
          <span class="keywordflow">if</span> ( IN6_IS_ADDR_LINKLOCAL (&amp;attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;mp_nexthop_local) )
            attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a>=32;
          <span class="keywordflow">else</span>
            attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a>=16;
        }

      <span class="comment">/* Default nexthop_local treatment for non-RS-Clients */</span>
      <span class="keywordflow">else</span> 
        {
      <span class="comment">/* Link-local address should not be transit to different peer. */</span>
      attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a> = 16;

      <span class="comment">/* Set link-local address for shared network peer. */</span>
      <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ab2847caa2148b30de1db8f52b8c7dad9">shared_network</a> 
      &amp;&amp; ! IN6_IS_ADDR_UNSPECIFIED (&amp;peer-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.v6_local))
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;mp_nexthop_local, &amp;peer-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.v6_local, 
          <a class="code" href="prefix_8h.html#ac2642af4f4d7a4209ad6261e72c658f9">IPV6_MAX_BYTELEN</a>);
      attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a> = 32;
    }

      <span class="comment">/* If bgpd act as BGP-4+ route-reflector, do not send link-local</span>
<span class="comment">     address.*/</span>
      <span class="keywordflow">if</span> (reflect)
    attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a> = 16;

      <span class="comment">/* If BGP-4+ link-local nexthop is not link-local nexthop. */</span>
      <span class="keywordflow">if</span> (! IN6_IS_ADDR_LINKLOCAL (&amp;peer-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.v6_local))
    attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a> = 16;
    }

    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

  <span class="comment">/* AS-Pathlimit: Check ASN for private/confed */</span>
  <span class="keywordflow">if</span> (attr-&gt;<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a0f7b3d80060491aa2bc639577e660089">ttl</a>)
    {
      <span class="comment">/* locally originated update */</span>
      <span class="keywordflow">if</span> (!attr-&gt;<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a8a6b5eec215a881c600ce5556b6a91db">as</a>)
        attr-&gt;<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a8a6b5eec215a881c600ce5556b6a91db">as</a> = peer-&gt;<a class="code" href="structpeer.html#a4d33d4449107287106341b423f5a7498">local_as</a>;
      
      <span class="comment">/* if the AS_PATHLIMIT attribute is attached to a prefix by a</span>
<span class="comment">         member of a confederation, then when the prefix is advertised outside</span>
<span class="comment">         of the confederation boundary, then the AS number of the</span>
<span class="comment">         confederation member inside of the AS_PATHLIMIT attribute should be</span>
<span class="comment">         replaced by the confederation&#39;s AS number. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (from) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a647ad85450d688c959849bc89cd9ccb8">BGP_PEER_CONFED</a> 
          &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) != <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a647ad85450d688c959849bc89cd9ccb8">BGP_PEER_CONFED</a>)
        attr-&gt;<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a8a6b5eec215a881c600ce5556b6a91db">as</a> = peer-&gt;<a class="code" href="structpeer.html#a4d33d4449107287106341b423f5a7498">local_as</a>;

      <span class="comment">/* Private ASN should be updated whenever announcement leaves</span>
<span class="comment">       * private space. This is deliberately done after simple confed</span>
<span class="comment">       * based update..</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (attr-&gt;<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a8a6b5eec215a881c600ce5556b6a91db">as</a> &gt;= <a class="code" href="bgp__aspath_8h.html#ac7d780d83cdd277414ca9ba2785ff152">BGP_PRIVATE_AS_MIN</a>
          &amp;&amp; attr-&gt;<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a8a6b5eec215a881c600ce5556b6a91db">as</a> &lt;= <a class="code" href="bgp__aspath_8h.html#a5eab303011de75bf71ee2d346bed9927">BGP_PRIVATE_AS_MAX</a>)
        {
          <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a4d33d4449107287106341b423f5a7498">local_as</a> &lt; <a class="code" href="bgp__aspath_8h.html#ac7d780d83cdd277414ca9ba2785ff152">BGP_PRIVATE_AS_MIN</a> 
              || peer-&gt;<a class="code" href="structpeer.html#a4d33d4449107287106341b423f5a7498">local_as</a> &gt; <a class="code" href="bgp__aspath_8h.html#a5eab303011de75bf71ee2d346bed9927">BGP_PRIVATE_AS_MAX</a>)
            attr-&gt;<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a8a6b5eec215a881c600ce5556b6a91db">as</a> = peer-&gt;<a class="code" href="structpeer.html#a4d33d4449107287106341b423f5a7498">local_as</a>;
          <span class="comment">/* Ours is private, try using theirs.. */</span>
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#aa35fab1a77bb496d8377a62cad372314">as</a> &lt; <a class="code" href="bgp__aspath_8h.html#ac7d780d83cdd277414ca9ba2785ff152">BGP_PRIVATE_AS_MIN</a>
                   || peer-&gt;<a class="code" href="structpeer.html#a4d33d4449107287106341b423f5a7498">local_as</a> &gt; <a class="code" href="bgp__aspath_8h.html#a5eab303011de75bf71ee2d346bed9927">BGP_PRIVATE_AS_MAX</a>)
            attr-&gt;<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a8a6b5eec215a881c600ce5556b6a91db">as</a> = peer-&gt;<a class="code" href="structpeer.html#aa35fab1a77bb496d8377a62cad372314">as</a>;
        }
    }
  
  <span class="comment">/* If this is EBGP peer and remove-private-AS is set.  */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a>
      &amp;&amp; <a class="code" href="bgpd_8c.html#ae5d6ff43d5cd2e0033f2e72e68017b56">peer_af_flag_check</a> (peer, afi, safi, <a class="code" href="bgpd_8h.html#abfb7cc1972f3f0fb238d216edc9cd7cc">PEER_FLAG_REMOVE_PRIVATE_AS</a>)
      &amp;&amp; <a class="code" href="bgp__aspath_8c.html#a808020dd81343ccfb8f4cf5f50f5f11c">aspath_private_as_check</a> (attr-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>))
    attr-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a> = <a class="code" href="bgp__aspath_8c.html#aa737121f7df6f3e64869fc9a6c330b2f">aspath_empty_get</a> ();

  <span class="comment">/* Route map &amp; unsuppress-map apply. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8h.html#a74b8c19a64169d6d012582c4350ee71b">ROUTE_MAP_OUT_NAME</a> (filter)
      || (ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a> &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#a2ce49edfd26233ffebc24dc616d04835">suppress</a>) )
    {
      <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> info;
      <span class="keyword">struct </span>attr dummy_attr = { 0 };
      
      info.peer = peer;
      info.attr = attr;

      <span class="comment">/* The route reflector is not allowed to modify the attributes</span>
<span class="comment">     of the reflected IBGP routes. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (from) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a9e245a415718944a081734a08a8d7e92">BGP_PEER_IBGP</a> 
      &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a9e245a415718944a081734a08a8d7e92">BGP_PEER_IBGP</a>)
    {
      <a class="code" href="bgp__attr_8c.html#a39f33acb3fdd3ade629a9b7d66e74ea9">bgp_attr_dup</a> (&amp;dummy_attr, attr);
      info.attr = &amp;dummy_attr;
    }

      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a>, <a class="code" href="bgpd_8h.html#a8936848c8f5360ec5b4544e3cd86cda1">PEER_RMAP_TYPE_OUT</a>); 

      <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a> &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#a2ce49edfd26233ffebc24dc616d04835">suppress</a>)
    ret = <a class="code" href="routemap_8c.html#a3372553a024332702cfd603e1f4c08d6">route_map_apply</a> (<a class="code" href="bgp__route_8h.html#a346dd5110ed3bda9be8ffd4a42e5f52b">UNSUPPRESS_MAP</a> (filter), p, <a class="code" href="routemap_8h.html#ae21439463f873ce0ce1556c9d6fa7370adcb3bc0f6448923a387dfe3658ca7bda">RMAP_BGP</a>, &amp;info);
      <span class="keywordflow">else</span>
    ret = <a class="code" href="routemap_8c.html#a3372553a024332702cfd603e1f4c08d6">route_map_apply</a> (<a class="code" href="bgp__route_8h.html#a723d63ede8a87e162c1bf2097b2466b6">ROUTE_MAP_OUT</a> (filter), p, <a class="code" href="routemap_8h.html#ae21439463f873ce0ce1556c9d6fa7370adcb3bc0f6448923a387dfe3658ca7bda">RMAP_BGP</a>, &amp;info);

      peer-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a> = 0;
      
      <span class="keywordflow">if</span> (dummy_attr.<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>)
        <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;dummy_attr);
      
      <span class="keywordflow">if</span> (ret == <a class="code" href="routemap_8h.html#afd7345bfd662f1e7c77f0be351cd1516aa0f40f0a91e43bfe7131839fe179ac64">RMAP_DENYMATCH</a>)
    {
      <a class="code" href="bgp__attr_8c.html#a3ea9ed94bcd0236f8f83310615e7c022">bgp_attr_flush</a> (attr);
      <span class="keywordflow">return</span> 0;
    }
    }
  <span class="keywordflow">return</span> 1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a35b4c8839d28c1fadc0173bfe0898234"></a><!-- doxytag: member="bgp_route.c::bgp_announce_check_rsclient" ref="a35b4c8839d28c1fadc0173bfe0898234" args="(struct bgp_info *ri, struct peer *rsclient, struct prefix *p, struct attr *attr, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_announce_check_rsclient </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>rsclient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01110">1110</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <span class="keywordtype">char</span> buf[<a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>];
  <span class="keyword">struct </span><a class="code" href="structbgp__filter.html">bgp_filter</a> *<a class="code" href="structfilter.html">filter</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> info;
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *from;
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;

  from = ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>;
  filter = &amp;rsclient-&gt;<a class="code" href="structpeer.html#a8ae54829ca91f5860216eb326f264727">filter</a>[afi][safi];
  bgp = rsclient-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>;

  <span class="keywordflow">if</span> (DISABLE_BGP_ANNOUNCE)
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* Do not send back route to sender. */</span>
  <span class="keywordflow">if</span> (from == rsclient)
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* Aggregate-address suppress check. */</span>
  <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a> &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#a2ce49edfd26233ffebc24dc616d04835">suppress</a>)
    <span class="keywordflow">if</span> (! <a class="code" href="bgp__route_8h.html#a5d8b5b2174fe271354ba0def2c0a749e">UNSUPPRESS_MAP_NAME</a> (filter))
      <span class="keywordflow">return</span> 0;

  <span class="comment">/* Default route check.  */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (rsclient-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi],
          <a class="code" href="bgpd_8h.html#a7ce39647237ee1e1b720e6d0d4056efe">PEER_STATUS_DEFAULT_ORIGINATE</a>))
    {
      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET &amp;&amp; p-&gt;u.<a class="code" href="structprefix.html#ab37b8922554b41b7dc2417d8f37e7829">prefix4</a>.s_addr == INADDR_ANY)
        <span class="keywordflow">return</span> 0;
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6 &amp;&amp; p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a> == 0)
        <span class="keywordflow">return</span> 0;
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
    }

  <span class="comment">/* If the attribute has originator-id and it is same as remote</span>
<span class="comment">     peer&#39;s id. */</span>
  <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp; <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#a4c57fcfdf8e83e8d6dce5369a9697244">BGP_ATTR_ORIGINATOR_ID</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a> (&amp;rsclient-&gt;<a class="code" href="structpeer.html#ae620d85ff35b31ba9eb6073b81731b5b">remote_id</a>, 
                          &amp;ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#a2a675121474a39bf5d9f95393b00e156">originator_id</a>))
        {
         <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (filter, FILTER))
           <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (rsclient-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
                 <span class="stringliteral">&quot;%s [Update:SEND] %s/%d originator-id is same as remote router-id&quot;</span>,
                 rsclient-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
                 <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a>(p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
                 p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>);
         <span class="keywordflow">return</span> 0;
       }
    }

  <span class="comment">/* ORF prefix-list filter check */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (rsclient-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#aa073ee4ea1d90b2d2971682f4a373776">PEER_CAP_ORF_PREFIX_RM_ADV</a>)
      &amp;&amp; (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (rsclient-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#a4883c0951321050f52731ef009c2dd17">PEER_CAP_ORF_PREFIX_SM_RCV</a>)
         || <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (rsclient-&gt;<a class="code" href="structpeer.html#aa025a735cf6b2d8b85ff9fc974031b8d">af_cap</a>[afi][safi], <a class="code" href="bgpd_8h.html#ae0da0dd013880e12f7d1160d002735a6">PEER_CAP_ORF_PREFIX_SM_OLD_RCV</a>)))
    <span class="keywordflow">if</span> (rsclient-&gt;<a class="code" href="structpeer.html#a2473c352a18c1a1169cd01754dbfc993">orf_plist</a>[afi][safi])
      {
       <span class="keywordflow">if</span> (<a class="code" href="plist_8c.html#a6fd9bac08d2cb3d2e315d88af146a7f0">prefix_list_apply</a> (rsclient-&gt;<a class="code" href="structpeer.html#a2473c352a18c1a1169cd01754dbfc993">orf_plist</a>[afi][safi], p) == <a class="code" href="plist_8h.html#a3bda5ec3d1202bc8eb472b4d97633cf9a697cf8d0db0ead308a6ef01301f9543c">PREFIX_DENY</a>)
          <span class="keywordflow">return</span> 0;
      }

  <span class="comment">/* Output filter check. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8c.html#a964b57dc2ca2170b988ca239878a9118">bgp_output_filter</a> (rsclient, p, ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>, afi, safi) == <a class="code" href="filter_8h.html#ab3b7281956317556f846daaebf75de72a898abadf6cc2f9d27780782f09d3a3e3">FILTER_DENY</a>)
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (filter, FILTER))
       <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (rsclient-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
             <span class="stringliteral">&quot;%s [Update:SEND] %s/%d is filtered&quot;</span>,
             rsclient-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
             <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a>(p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
             p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>);
      <span class="keywordflow">return</span> 0;
    }

<span class="preprocessor">#ifdef BGP_SEND_ASPATH_CHECK</span>
<span class="preprocessor"></span>  <span class="comment">/* AS path loop check. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__aspath_8c.html#a09c83e4313915a5191a19439186f2280">aspath_loop_check</a> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>, rsclient-&gt;<a class="code" href="structpeer.html#aa35fab1a77bb496d8377a62cad372314">as</a>))
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (filter, FILTER))
        <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (rsclient-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
             <span class="stringliteral">&quot;%s [Update:SEND] suppress announcement to peer AS %u is AS path.&quot;</span>,
             rsclient-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, rsclient-&gt;<a class="code" href="structpeer.html#aa35fab1a77bb496d8377a62cad372314">as</a>);
      <span class="keywordflow">return</span> 0;
    }
<span class="preprocessor">#endif </span><span class="comment">/* BGP_SEND_ASPATH_CHECK */</span>

  <span class="comment">/* For modify attribute, copy it to temporary structure. */</span>
  <a class="code" href="bgp__attr_8c.html#a39f33acb3fdd3ade629a9b7d66e74ea9">bgp_attr_dup</a> (attr, ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>);

  <span class="comment">/* next-hop-set */</span>
  <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET &amp;&amp; attr-&gt;<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>.s_addr == 0)
#ifdef HAVE_IPV6
          || (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6 &amp;&amp;
              IN6_IS_ADDR_UNSPECIFIED(&amp;attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;mp_nexthop_global))
#endif <span class="comment">/* HAVE_IPV6 */</span>
     )
  {
    <span class="comment">/* Set IPv4 nexthop. */</span>
    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET)
      {
        <span class="keywordflow">if</span> (safi == <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#ad484cadabc20c8009a458845216623f8">mp_nexthop_global_in</a>, &amp;rsclient-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.<a class="code" href="structbgp__nexthop.html#a8fed6fdf9282fb5e87f3f52b94313646">v4</a>,
                  <a class="code" href="prefix_8h.html#a013983d7a5267a63023c50ab32a85c24">IPV4_MAX_BYTELEN</a>);
        <span class="keywordflow">else</span>
          <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;attr-&gt;<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>, &amp;rsclient-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.<a class="code" href="structbgp__nexthop.html#a8fed6fdf9282fb5e87f3f52b94313646">v4</a>, <a class="code" href="prefix_8h.html#a013983d7a5267a63023c50ab32a85c24">IPV4_MAX_BYTELEN</a>);
      }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>    <span class="comment">/* Set IPv6 nexthop. */</span>
    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6)
      {
        <span class="comment">/* IPv6 global nexthop must be included. */</span>
        <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;mp_nexthop_global, &amp;rsclient-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.v6_global,
                <a class="code" href="prefix_8h.html#ac2642af4f4d7a4209ad6261e72c658f9">IPV6_MAX_BYTELEN</a>);
        attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a> = 16;
      }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>
  }

<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a> == AF_INET6)
    {
      <span class="keyword">struct </span><a class="code" href="structattr__extra.html">attr_extra</a> *attre = attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>;
      
      <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>);
      
      <span class="comment">/* Left nexthop_local unchanged if so configured. */</span>
      <span class="keywordflow">if</span> ( <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (rsclient-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], 
           <a class="code" href="bgpd_8h.html#abba8d6c84283161714fa65e519a3e3ac">PEER_FLAG_NEXTHOP_LOCAL_UNCHANGED</a>) )
        {
          <span class="keywordflow">if</span> ( IN6_IS_ADDR_LINKLOCAL (&amp;attre-&gt;mp_nexthop_local) )
            attre-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a>=32;
          <span class="keywordflow">else</span>
            attre-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a>=16;
        }
        
      <span class="comment">/* Default nexthop_local treatment for RS-Clients */</span>
      <span class="keywordflow">else</span> 
        { 
          <span class="comment">/* Announcer and RS-Client are both in the same network */</span>      
          <span class="keywordflow">if</span> (rsclient-&gt;<a class="code" href="structpeer.html#ab2847caa2148b30de1db8f52b8c7dad9">shared_network</a> &amp;&amp; from-&gt;<a class="code" href="structpeer.html#ab2847caa2148b30de1db8f52b8c7dad9">shared_network</a> &amp;&amp;
              (rsclient-&gt;<a class="code" href="structpeer.html#a959523b5b0a6ed9a0b87825e42545ec0">ifindex</a> == from-&gt;<a class="code" href="structpeer.html#a959523b5b0a6ed9a0b87825e42545ec0">ifindex</a>))
            {
              <span class="keywordflow">if</span> ( IN6_IS_ADDR_LINKLOCAL (&amp;attre-&gt;mp_nexthop_local) )
                attre-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a>=32;
              <span class="keywordflow">else</span>
                attre-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a>=16;
            }

          <span class="comment">/* Set link-local address for shared network peer. */</span>
          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rsclient-&gt;<a class="code" href="structpeer.html#ab2847caa2148b30de1db8f52b8c7dad9">shared_network</a>
              &amp;&amp; IN6_IS_ADDR_LINKLOCAL (&amp;rsclient-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.v6_local))
            {
              <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;attre-&gt;mp_nexthop_local, &amp;rsclient-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.v6_local,
                      <a class="code" href="prefix_8h.html#ac2642af4f4d7a4209ad6261e72c658f9">IPV6_MAX_BYTELEN</a>);
              attre-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a> = 32;
            }

          <span class="keywordflow">else</span>
            attre-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a> = 16;
        }

    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>


  <span class="comment">/* If this is EBGP peer and remove-private-AS is set.  */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (rsclient) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a>
      &amp;&amp; <a class="code" href="bgpd_8c.html#ae5d6ff43d5cd2e0033f2e72e68017b56">peer_af_flag_check</a> (rsclient, afi, safi, <a class="code" href="bgpd_8h.html#abfb7cc1972f3f0fb238d216edc9cd7cc">PEER_FLAG_REMOVE_PRIVATE_AS</a>)
      &amp;&amp; <a class="code" href="bgp__aspath_8c.html#a808020dd81343ccfb8f4cf5f50f5f11c">aspath_private_as_check</a> (attr-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>))
    attr-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a> = <a class="code" href="bgp__aspath_8c.html#aa737121f7df6f3e64869fc9a6c330b2f">aspath_empty_get</a> ();

  <span class="comment">/* Route map &amp; unsuppress-map apply. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8h.html#a74b8c19a64169d6d012582c4350ee71b">ROUTE_MAP_OUT_NAME</a> (filter) || (ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a> &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#a2ce49edfd26233ffebc24dc616d04835">suppress</a>) )
    {
      info.peer = rsclient;
      info.attr = attr;

      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (rsclient-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a>, <a class="code" href="bgpd_8h.html#a8936848c8f5360ec5b4544e3cd86cda1">PEER_RMAP_TYPE_OUT</a>);

      <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a> &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#a2ce49edfd26233ffebc24dc616d04835">suppress</a>)
        ret = <a class="code" href="routemap_8c.html#a3372553a024332702cfd603e1f4c08d6">route_map_apply</a> (<a class="code" href="bgp__route_8h.html#a346dd5110ed3bda9be8ffd4a42e5f52b">UNSUPPRESS_MAP</a> (filter), p, <a class="code" href="routemap_8h.html#ae21439463f873ce0ce1556c9d6fa7370adcb3bc0f6448923a387dfe3658ca7bda">RMAP_BGP</a>, &amp;info);
      <span class="keywordflow">else</span>
        ret = <a class="code" href="routemap_8c.html#a3372553a024332702cfd603e1f4c08d6">route_map_apply</a> (<a class="code" href="bgp__route_8h.html#a723d63ede8a87e162c1bf2097b2466b6">ROUTE_MAP_OUT</a> (filter), p, <a class="code" href="routemap_8h.html#ae21439463f873ce0ce1556c9d6fa7370adcb3bc0f6448923a387dfe3658ca7bda">RMAP_BGP</a>, &amp;info);

      rsclient-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a> = 0;

      <span class="keywordflow">if</span> (ret == <a class="code" href="routemap_8h.html#afd7345bfd662f1e7c77f0be351cd1516aa0f40f0a91e43bfe7131839fe179ac64">RMAP_DENYMATCH</a>)
       {
         <a class="code" href="bgp__attr_8c.html#a3ea9ed94bcd0236f8f83310615e7c022">bgp_attr_flush</a> (attr);
         <span class="keywordflow">return</span> 0;
       }
    }

  <span class="keywordflow">return</span> 1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a034115d44bc2a9935df0a481d462aaf7"></a><!-- doxytag: member="bgp_route.c::bgp_announce_route" ref="a034115d44bc2a9935df0a481d462aaf7" args="(struct peer *peer, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_announce_route </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02551">2551</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__table.html">bgp_table</a> *table;

  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a> != <a class="code" href="bgpd_8h.html#aa87809ec7dea97b0e970e98ae6c181ea">Established</a>)
    <span class="keywordflow">return</span>;

  <span class="keywordflow">if</span> (! peer-&gt;<a class="code" href="structpeer.html#a08da0f40c72c2016e659539e6af6dc2d">afc_nego</a>[<a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>][<a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>])
    <span class="keywordflow">return</span>;

  <span class="comment">/* First update is deferred until ORF or ROUTE-REFRESH is received */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[<a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>][safi], <a class="code" href="bgpd_8h.html#af38b3d01fa7faa6698e76d7932ff717f">PEER_STATUS_ORF_WAIT_REFRESH</a>))
    <span class="keywordflow">return</span>;

  <span class="keywordflow">if</span> (safi != <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
    <a class="code" href="bgp__route_8c.html#aed62e72345c65c8374702d58b4d8a5fa">bgp_announce_table</a> (peer, <a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>, safi, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);
  <span class="keywordflow">else</span>
    <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[<a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>][safi]); rn;
     rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a>(rn))
      <span class="keywordflow">if</span> ((table = (rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>)) != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
       <a class="code" href="bgp__route_8c.html#aed62e72345c65c8374702d58b4d8a5fa">bgp_announce_table</a> (peer, <a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>, safi, table, 0);

  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[<a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>][safi], <a class="code" href="bgpd_8h.html#abf59e9a9022e80ecdc266d86f35b378e">PEER_FLAG_RSERVER_CLIENT</a>))
    <a class="code" href="bgp__route_8c.html#aed62e72345c65c8374702d58b4d8a5fa">bgp_announce_table</a> (peer, <a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>, safi, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2339aa5e61e6711862d4f6e0eab3ce56"></a><!-- doxytag: member="bgp_route.c::bgp_announce_route_all" ref="a2339aa5e61e6711862d4f6e0eab3ce56" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_announce_route_all </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02579">2579</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> <a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>;
  <a class="code" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> <a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>;
  
  <span class="keywordflow">for</span> (afi = <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>; afi &lt; <a class="code" href="zebra_8h.html#abf129a17e985713a26a6181a198d5f1a">AFI_MAX</a>; afi++)
    <span class="keywordflow">for</span> (safi = <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>; safi &lt; <a class="code" href="zebra_8h.html#a82fe6f63e822f7bf9e4567873d809ed8">SAFI_MAX</a>; safi++)
      <a class="code" href="bgp__route_8c.html#a034115d44bc2a9935df0a481d462aaf7">bgp_announce_route</a> (peer, afi, safi);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aed62e72345c65c8374702d58b4d8a5fa"></a><!-- doxytag: member="bgp_route.c::bgp_announce_table" ref="aed62e72345c65c8374702d58b4d8a5fa" args="(struct peer *peer, afi_t afi, safi_t safi, struct bgp_table *table, int rsclient)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_announce_table </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__table.html">bgp_table</a> *&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rsclient</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02521">2521</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;
  <span class="keyword">struct </span><a class="code" href="structattr.html">attr</a> <a class="code" href="structattr.html">attr</a> = { 0 };
  
  <span class="keywordflow">if</span> (! table)
    table = (rsclient) ? peer-&gt;<a class="code" href="structpeer.html#a7e8ca2a0bcdc168c59140e710a1f2060">rib</a>[afi][safi] : peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[afi][safi];

  if (safi != <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>
      &amp;&amp; <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a4cca3b44134d7e6dcc82ef798bfc0f78">PEER_FLAG_DEFAULT_ORIGINATE</a>))
    <a class="code" href="bgp__route_8c.html#a655014556fe828ec1f15a0189cc8869b">bgp_default_originate</a> (peer, afi, safi, 0);

  <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (table); rn; rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a>(rn))
    <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a43b3eb776824e6b86970e3886120913e">BGP_INFO_SELECTED</a>) &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> != peer)
    {
         <span class="keywordflow">if</span> ( (rsclient) ?
              (<a class="code" href="bgp__route_8c.html#a35b4c8839d28c1fadc0173bfe0898234">bgp_announce_check_rsclient</a> (ri, peer, &amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>, &amp;attr, afi, safi))
              : (<a class="code" href="bgp__route_8c.html#a7a3b743168235f6f62a99f82c20fcdf1">bgp_announce_check</a> (ri, peer, &amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>, &amp;attr, afi, safi)))
        <a class="code" href="bgp__advertise_8c.html#a3a40b0a670f7854055d71517f5ede018">bgp_adj_out_set</a> (rn, peer, &amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>, &amp;attr, afi, safi, ri);
      <span class="keywordflow">else</span>
        <a class="code" href="bgp__advertise_8c.html#adbc62e0dd99f941abbaf231f77930094">bgp_adj_out_unset</a> (rn, peer, &amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>, afi, safi);
          
          <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;attr);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aefec15f33656cb69b4b71702afdca06a"></a><!-- doxytag: member="bgp_route.c::bgp_best_selection" ref="aefec15f33656cb69b4b71702afdca06a" args="(struct bgp *bgp, struct bgp_node *rn, struct bgp_info_pair *result)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_best_selection </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info__pair.html">bgp_info_pair</a> *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01316">1316</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *new_select;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *old_select;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri1;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri2;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *nextri = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  
  <span class="comment">/* bgp deterministic-med */</span>
  new_select = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#a0b3388d8ac73af2d4f4f22e46746da1e">bgp_flag_check</a> (bgp, <a class="code" href="bgpd_8h.html#a872ba22b64e9118e8cda60c6d3c6d5c9">BGP_FLAG_DETERMINISTIC_MED</a>))
    <span class="keywordflow">for</span> (ri1 = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri1; ri1 = ri1-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
      {
    <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri1-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a1f4be6cad311d6e4638b723b4420f4e9">BGP_INFO_DMED_CHECK</a>))
      <span class="keywordflow">continue</span>;
    <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8h.html#a51bf9498518258866f4ba6b2b19b587a">BGP_INFO_HOLDDOWN</a> (ri1))
      <span class="keywordflow">continue</span>;

    new_select = ri1;
    <span class="keywordflow">if</span> (ri1-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
      <span class="keywordflow">for</span> (ri2 = ri1-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>; ri2; ri2 = ri2-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
        {
          <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri2-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a1f4be6cad311d6e4638b723b4420f4e9">BGP_INFO_DMED_CHECK</a>))
        <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8h.html#a51bf9498518258866f4ba6b2b19b587a">BGP_INFO_HOLDDOWN</a> (ri2))
        <span class="keywordflow">continue</span>;

          <span class="keywordflow">if</span> (<a class="code" href="bgp__aspath_8c.html#a5f979a1ff3bc3908684e4592e5c383eb">aspath_cmp_left</a> (ri1-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>, ri2-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>)
          || <a class="code" href="bgp__aspath_8c.html#ace7eb37e6ea088fb0ea82c9ae4c58375">aspath_cmp_left_confed</a> (ri1-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>,
                         ri2-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>))
        {
          <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8c.html#adb9d04630ab93d7aee4950ee2a1b0ead">bgp_info_cmp</a> (bgp, ri2, new_select))
            {
              <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, new_select, <a class="code" href="bgp__route_8h.html#a9486d9e223de55b24716f63d58a615d1">BGP_INFO_DMED_SELECTED</a>);
              new_select = ri2;
            }

          <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, ri2, <a class="code" href="bgp__route_8h.html#a1f4be6cad311d6e4638b723b4420f4e9">BGP_INFO_DMED_CHECK</a>);
        }
        }
    <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, new_select, <a class="code" href="bgp__route_8h.html#a1f4be6cad311d6e4638b723b4420f4e9">BGP_INFO_DMED_CHECK</a>);
    <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, new_select, <a class="code" href="bgp__route_8h.html#a9486d9e223de55b24716f63d58a615d1">BGP_INFO_DMED_SELECTED</a>);
      }

  <span class="comment">/* Check old selected route and new selected route. */</span>
  old_select = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  new_select = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; (ri != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (nextri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>, 1); ri = nextri)
    {
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a43b3eb776824e6b86970e3886120913e">BGP_INFO_SELECTED</a>))
    old_select = ri;

      <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8h.html#a51bf9498518258866f4ba6b2b19b587a">BGP_INFO_HOLDDOWN</a> (ri))
        {
          <span class="comment">/* reap REMOVED routes, if needs be </span>
<span class="comment">           * selected route must stay for a while longer though</span>
<span class="comment">           */</span>
          <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a0ff836da32782fe548f3fe570e5107e7">BGP_INFO_REMOVED</a>)
              &amp;&amp; (ri != old_select))
              <a class="code" href="bgp__route_8c.html#a4475c3919634039951683b34a18b1dee">bgp_info_reap</a> (rn, ri);
          
          <span class="keywordflow">continue</span>;
        }

      <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#a0b3388d8ac73af2d4f4f22e46746da1e">bgp_flag_check</a> (bgp, <a class="code" href="bgpd_8h.html#a872ba22b64e9118e8cda60c6d3c6d5c9">BGP_FLAG_DETERMINISTIC_MED</a>)
          &amp;&amp; (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a9486d9e223de55b24716f63d58a615d1">BGP_INFO_DMED_SELECTED</a>)))
    {
      <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#a1f4be6cad311d6e4638b723b4420f4e9">BGP_INFO_DMED_CHECK</a>);
      <span class="keywordflow">continue</span>;
        }
      <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#a1f4be6cad311d6e4638b723b4420f4e9">BGP_INFO_DMED_CHECK</a>);
      <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#a9486d9e223de55b24716f63d58a615d1">BGP_INFO_DMED_SELECTED</a>);

      <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8c.html#adb9d04630ab93d7aee4950ee2a1b0ead">bgp_info_cmp</a> (bgp, ri, new_select))
    new_select = ri;
    }
    
    result-&gt;<a class="code" href="structbgp__info__pair.html#a11d43d9b5328d09118af1d1199fab482">old</a> = old_select;
    result-&gt;<a class="code" href="structbgp__info__pair.html#a0b78cac0a00d5e0dd592dde718bdcd01">new</a> = new_select;

    <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2fdb62c8a10046002627ce0298e0d404"></a><!-- doxytag: member="bgp_route.c::bgp_check_local_routes_rsclient" ref="a2fdb62c8a10046002627ce0298e0d404" args="(struct peer *rsclient, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_check_local_routes_rsclient </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>rsclient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03582">3582</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__static.html">bgp_static</a> *<a class="code" href="structbgp__static.html">bgp_static</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;

  bgp = rsclient-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>;

  <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (bgp-&gt;<a class="code" href="structbgp.html#af06132502d1bbb4584e996e978254e34">route</a>[afi][safi]); rn; rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rn))
    <span class="keywordflow">if</span> ((bgp_static = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>) != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
      {
        p = &amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>;

        <a class="code" href="bgp__route_8c.html#adde0f36163e0fb2c47de7cf95f8bbe56">bgp_static_update_rsclient</a> (rsclient, p, bgp_static,
                afi, safi);
      }
}
</pre></div>
</div>
</div>
<a class="anchor" id="adf17dd6a8dfaa2ab4f271b491de030d0"></a><!-- doxytag: member="bgp_route.c::bgp_cleanup_routes" ref="adf17dd6a8dfaa2ab4f271b491de030d0" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_cleanup_routes </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02969">2969</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__table.html">bgp_table</a> *table;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;

  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (<a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#a781eb39eeb74ba12d8cb78f887d4d755">bgp</a>, node, nnode, bgp))
    {
      table = bgp-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[<a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>][<a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>];

      <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (table); rn; rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rn))
    <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a43b3eb776824e6b86970e3886120913e">BGP_INFO_SELECTED</a>)
          &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a7d70d35aa6ab6fa769c8e7d662288a35">type</a> == <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a> 
          &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a4734a795191347f5279e59e64c75b7a3">BGP_ROUTE_NORMAL</a>)
        <a class="code" href="bgp__zebra_8c.html#a067b7ce285841e44d9fa9d827bb83740">bgp_zebra_withdraw</a> (&amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>, ri);

      table = bgp-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[<a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a>][<a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>];

      <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (table); rn; rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rn))
    <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a43b3eb776824e6b86970e3886120913e">BGP_INFO_SELECTED</a>)
          &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a7d70d35aa6ab6fa769c8e7d662288a35">type</a> == <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a> 
          &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a4734a795191347f5279e59e64c75b7a3">BGP_ROUTE_NORMAL</a>)
        <a class="code" href="bgp__zebra_8c.html#a067b7ce285841e44d9fa9d827bb83740">bgp_zebra_withdraw</a> (&amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>, ri);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4abd5523ec63ec028d8ca35259161533"></a><!-- doxytag: member="bgp_route.c::bgp_clear_adj_in" ref="a4abd5523ec63ec028d8ca35259161533" args="(struct peer *peer, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_clear_adj_in </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02928">2928</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__table.html">bgp_table</a> *table;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__adj__in.html">bgp_adj_in</a> *ain;

  table = peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[afi][safi];

  <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (table); rn; rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rn))
    <span class="keywordflow">for</span> (ain = rn-&gt;<a class="code" href="structbgp__node.html#a47213f2ff58ef9de9f5daf62b8f918be">adj_in</a>; ain ; ain = ain-&gt;<a class="code" href="structbgp__adj__in.html#aaa2dc023411504da13bde05352687565">next</a>)
      <span class="keywordflow">if</span> (ain-&gt;<a class="code" href="structbgp__adj__in.html#ab6bb20edc80c75c836662a675102301d">peer</a> == peer)
    {
          <a class="code" href="bgp__advertise_8c.html#a10c89147ee0e113b39318daa8cb5dc66">bgp_adj_in_remove</a> (rn, ain);
          <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
          <span class="keywordflow">break</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac0796b20b150f25a0bb4f1427ac71c86"></a><!-- doxytag: member="bgp_route.c::bgp_clear_node_complete" ref="ac0796b20b150f25a0bb4f1427ac71c86" args="(struct work_queue *wq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_clear_node_complete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structwork__queue.html">work_queue</a> *&#160;</td>
          <td class="paramname"><em>wq</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02718">2718</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *<a class="code" href="structpeer.html">peer</a> = wq-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#a2093df069000fed2a0c44bba8bcb7d68">data</a>;
  
  <span class="comment">/* Tickle FSM to start moving again */</span>
  <a class="code" href="bgp__fsm_8h.html#a20f7fd10817508149783bf6729dd6727">BGP_EVENT_ADD</a> (peer, <a class="code" href="bgpd_8h.html#a2306a95378b3d52b3758e3a58fb2155b">Clearing_Completed</a>);

  <a class="code" href="bgpd_8c.html#a7c9a78413925372479b9c538daac6d1d">peer_unlock</a> (peer); <span class="comment">/* bgp_clear_route */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2907d3d7870eaf13efa465e491e5d42e"></a><!-- doxytag: member="bgp_route.c::bgp_clear_node_queue_del" ref="a2907d3d7870eaf13efa465e491e5d42e" args="(struct work_queue *wq, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_clear_node_queue_del </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structwork__queue.html">work_queue</a> *&#160;</td>
          <td class="paramname"><em>wq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02706">2706</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__clear__node__queue.html">bgp_clear_node_queue</a> *cnq = <a class="code" href="dict_8c.html#a43a278d13284fb3412e9eee1db1d967e">data</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn = cnq-&gt;<a class="code" href="structbgp__clear__node__queue.html#a12f80a474cbd6bccad2a53411b8b2b58">rn</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__table.html">bgp_table</a> *table = rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>;
  
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn); 
  <a class="code" href="bgp__table_8c.html#af94a76428bf2695ec0ed1f87b3a4143a">bgp_table_unlock</a> (table);
  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba28eaf22226d7f0b2009a7f95872a041a">MTYPE_BGP_CLEAR_NODE_QUEUE</a>, cnq);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a59f1fa7a624fe068801d9dc834b7272f"></a><!-- doxytag: member="bgp_route.c::bgp_clear_node_queue_init" ref="a59f1fa7a624fe068801d9dc834b7272f" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_clear_node_queue_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02729">2729</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">char</span> wname[<span class="keyword">sizeof</span>(<span class="stringliteral">&quot;clear xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx&quot;</span>)];
  
  <a class="code" href="str_8c.html#ad76145a6edfc98981ded8815a760e0cd">snprintf</a> (wname, <span class="keyword">sizeof</span>(wname), <span class="stringliteral">&quot;clear %s&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
<span class="preprocessor">#undef CLEAR_QUEUE_NAME_LEN</span>
<span class="preprocessor"></span>
  <span class="keywordflow">if</span> ( (peer-&gt;<a class="code" href="structpeer.html#a194efb8be481f6589ff18fbbc509edbd">clear_node_queue</a> = <a class="code" href="workqueue_8c.html#a8b50511bbc60426f371822c0c7aee5cc">work_queue_new</a> (<a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ab61d7cb301c6e2ab39c31553e677e300">master</a>, wname)) == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    {
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;%s: Failed to allocate work queue&quot;</span>, __func__);
      <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a> (1);
    }
  peer-&gt;<a class="code" href="structpeer.html#a194efb8be481f6589ff18fbbc509edbd">clear_node_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#a6f998e18d62286e5b77844faf7c3ded2">hold</a> = 10;
  peer-&gt;<a class="code" href="structpeer.html#a194efb8be481f6589ff18fbbc509edbd">clear_node_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#aabcb370748f886f6a167ea3b13a6d372">workfunc</a> = &amp;<a class="code" href="bgp__route_8c.html#a71b5f58e93daf052072424f96f865cf0">bgp_clear_route_node</a>;
  peer-&gt;<a class="code" href="structpeer.html#a194efb8be481f6589ff18fbbc509edbd">clear_node_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#ae2fdda0df1d6e600e2b4e7849740e9d2">del_item_data</a> = &amp;<a class="code" href="bgp__route_8c.html#a2907d3d7870eaf13efa465e491e5d42e">bgp_clear_node_queue_del</a>;
  peer-&gt;<a class="code" href="structpeer.html#a194efb8be481f6589ff18fbbc509edbd">clear_node_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#a8f91d98335cfc0e547c01194575a9558">completion_func</a> = &amp;<a class="code" href="bgp__route_8c.html#ac0796b20b150f25a0bb4f1427ac71c86">bgp_clear_node_complete</a>;
  peer-&gt;<a class="code" href="structpeer.html#a194efb8be481f6589ff18fbbc509edbd">clear_node_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#a74334af11b2e664ed8cd47fa13a76881">max_retries</a> = 0;
  
  <span class="comment">/* we only &#39;lock&#39; this peer reference when the queue is actually active */</span>
  peer-&gt;<a class="code" href="structpeer.html#a194efb8be481f6589ff18fbbc509edbd">clear_node_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#a2093df069000fed2a0c44bba8bcb7d68">data</a> = peer;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6b07bcee214a0802a945370276bb213e"></a><!-- doxytag: member="bgp_route.c::bgp_clear_route" ref="a6b07bcee214a0802a945370276bb213e" args="(struct peer *peer, afi_t afi, safi_t safi, enum bgp_clear_route_type purpose)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_clear_route </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="bgp__route_8h.html#a6a68ec86881e2e24c1dfdd8a47267e81">bgp_clear_route_type</a>&#160;</td>
          <td class="paramname"><em>purpose</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02841">2841</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__table.html">bgp_table</a> *table;
  <span class="keyword">struct </span>peer *rsclient;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;

  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a194efb8be481f6589ff18fbbc509edbd">clear_node_queue</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    <a class="code" href="bgp__route_8c.html#a59f1fa7a624fe068801d9dc834b7272f">bgp_clear_node_queue_init</a> (peer);
  
  <span class="comment">/* bgp_fsm.c keeps sessions in state Clearing, not transitioning to</span>
<span class="comment">   * Idle until it receives a Clearing_Completed event. This protects</span>
<span class="comment">   * against peers which flap faster than we can we clear, which could</span>
<span class="comment">   * lead to:</span>
<span class="comment">   *</span>
<span class="comment">   * a) race with routes from the new session being installed before</span>
<span class="comment">   *    clear_route_node visits the node (to delete the route of that</span>
<span class="comment">   *    peer)</span>
<span class="comment">   * b) resource exhaustion, clear_route_node likely leads to an entry</span>
<span class="comment">   *    on the process_main queue. Fast-flapping could cause that queue</span>
<span class="comment">   *    to grow and grow.</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (!peer-&gt;<a class="code" href="structpeer.html#a194efb8be481f6589ff18fbbc509edbd">clear_node_queue</a>-&gt;<a class="code" href="structwork__queue.html#aa7a1097e517f22c4a289a8db9e91005d">thread</a>)
    <a class="code" href="bgpd_8c.html#a05008955933f8ba5f831e03862ca5b94">peer_lock</a> (peer); <span class="comment">/* bgp_clear_node_complete */</span>

  <span class="keywordflow">switch</span> (purpose)
    {
    <span class="keywordflow">case</span> <a class="code" href="bgp__route_8h.html#a6a68ec86881e2e24c1dfdd8a47267e81a362c076b1b729ff5b2c64125e029bb83">BGP_CLEAR_ROUTE_NORMAL</a>:
      <span class="keywordflow">if</span> (safi != <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
        <a class="code" href="bgp__route_8c.html#ad3a33b21d2801a0df0a610da8d41783f">bgp_clear_route_table</a> (peer, afi, safi, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, purpose);
      <span class="keywordflow">else</span>
        <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[afi][safi]); rn;
             rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rn))
          <span class="keywordflow">if</span> ((table = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>) != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
            <a class="code" href="bgp__route_8c.html#ad3a33b21d2801a0df0a610da8d41783f">bgp_clear_route_table</a> (peer, afi, safi, table, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, purpose);

      <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a4ccd4dea11eddfa74dc5518fdb448b67">rsclient</a>, node, nnode, rsclient))
        <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(rsclient-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi],
                       <a class="code" href="bgpd_8h.html#abf59e9a9022e80ecdc266d86f35b378e">PEER_FLAG_RSERVER_CLIENT</a>))
          <a class="code" href="bgp__route_8c.html#ad3a33b21d2801a0df0a610da8d41783f">bgp_clear_route_table</a> (peer, afi, safi, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, rsclient, purpose);
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="bgp__route_8h.html#a6a68ec86881e2e24c1dfdd8a47267e81a8c1adeda524233bcf00f4616680e0643">BGP_CLEAR_ROUTE_MY_RSCLIENT</a>:
      <a class="code" href="bgp__route_8c.html#ad3a33b21d2801a0df0a610da8d41783f">bgp_clear_route_table</a> (peer, afi, safi, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, peer, purpose);
      <span class="keywordflow">break</span>;

    <span class="keywordflow">default</span>:
      <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (0);
      <span class="keywordflow">break</span>;
    }
  
  <span class="comment">/* If no routes were cleared, nothing was added to workqueue, the</span>
<span class="comment">   * completion function won&#39;t be run by workqueue code - call it here. </span>
<span class="comment">   * XXX: Actually, this assumption doesn&#39;t hold, see</span>
<span class="comment">   * bgp_clear_route_table(), we queue all non-empty nodes.</span>
<span class="comment">   *</span>
<span class="comment">   * Additionally, there is a presumption in FSM that clearing is only</span>
<span class="comment">   * really needed if peer state is Established - peers in</span>
<span class="comment">   * pre-Established states shouldn&#39;t have any route-update state</span>
<span class="comment">   * associated with them (in or out).</span>
<span class="comment">   *</span>
<span class="comment">   * We still can get here in pre-Established though, through</span>
<span class="comment">   * peer_delete -&gt; bgp_fsm_change_status, so this is a useful sanity</span>
<span class="comment">   * check to ensure the assumption above holds.</span>
<span class="comment">   *</span>
<span class="comment">   * At some future point, this check could be move to the top of the</span>
<span class="comment">   * function, and do a quick early-return when state is</span>
<span class="comment">   * pre-Established, avoiding above list and table scans. Once we&#39;re</span>
<span class="comment">   * sure it is safe..</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (!peer-&gt;<a class="code" href="structpeer.html#a194efb8be481f6589ff18fbbc509edbd">clear_node_queue</a>-&gt;<a class="code" href="structwork__queue.html#aa7a1097e517f22c4a289a8db9e91005d">thread</a>)
    <a class="code" href="bgp__route_8c.html#ac0796b20b150f25a0bb4f1427ac71c86">bgp_clear_node_complete</a> (peer-&gt;<a class="code" href="structpeer.html#a194efb8be481f6589ff18fbbc509edbd">clear_node_queue</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac73f860ac71768cc3169bf96512d1b1c"></a><!-- doxytag: member="bgp_route.c::bgp_clear_route_all" ref="ac73f860ac71768cc3169bf96512d1b1c" args="(struct peer *peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_clear_route_all </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02917">2917</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi;
  <a class="code" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi;

  <span class="keywordflow">for</span> (afi = <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>; afi &lt; <a class="code" href="zebra_8h.html#abf129a17e985713a26a6181a198d5f1a">AFI_MAX</a>; afi++)
    <span class="keywordflow">for</span> (safi = <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>; safi &lt; <a class="code" href="zebra_8h.html#a82fe6f63e822f7bf9e4567873d809ed8">SAFI_MAX</a>; safi++)
      <a class="code" href="bgp__route_8c.html#a6b07bcee214a0802a945370276bb213e">bgp_clear_route</a> (peer, afi, safi, <a class="code" href="bgp__route_8h.html#a6a68ec86881e2e24c1dfdd8a47267e81a362c076b1b729ff5b2c64125e029bb83">BGP_CLEAR_ROUTE_NORMAL</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a71b5f58e93daf052072424f96f865cf0"></a><!-- doxytag: member="bgp_route.c::bgp_clear_route_node" ref="a71b5f58e93daf052072424f96f865cf0" args="(struct work_queue *wq, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="workqueue_8h.html#a0e78d42489413cdb20b75485932a3885">wq_item_status</a> bgp_clear_route_node </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structwork__queue.html">work_queue</a> *&#160;</td>
          <td class="paramname"><em>wq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02678">2678</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__clear__node__queue.html">bgp_clear_node_queue</a> *cnq = <a class="code" href="dict_8c.html#a43a278d13284fb3412e9eee1db1d967e">data</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn = cnq-&gt;<a class="code" href="structbgp__clear__node__queue.html#a12f80a474cbd6bccad2a53411b8b2b58">rn</a>;
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *<a class="code" href="structpeer.html">peer</a> = wq-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#a2093df069000fed2a0c44bba8bcb7d68">data</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;
  <a class="code" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi = rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>;
  <a class="code" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi = rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>;
  
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (rn &amp;&amp; peer);
  
  <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
    <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> == peer || cnq-&gt;<a class="code" href="structbgp__clear__node__queue.html#ac173c5e7a4485ec62d670edea755f19c">purpose</a> == <a class="code" href="bgp__route_8h.html#a6a68ec86881e2e24c1dfdd8a47267e81a8c1adeda524233bcf00f4616680e0643">BGP_CLEAR_ROUTE_MY_RSCLIENT</a>)
      {
        <span class="comment">/* graceful restart STALE flag set. */</span>
        <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#aa97d7e86e0f1905a85364af66368896f">PEER_STATUS_NSF_WAIT</a>)
            &amp;&amp; peer-&gt;<a class="code" href="structpeer.html#a36e9e912b00326f95bd69cb6afc11efd">nsf</a>[afi][safi]
            &amp;&amp; ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a455eac0750f63b056c8c5aff39222927">BGP_INFO_STALE</a>)
            &amp;&amp; ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#aee2c962749a7df25a38ccd80559e50d5">BGP_INFO_UNUSEABLE</a>))
          <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#a455eac0750f63b056c8c5aff39222927">BGP_INFO_STALE</a>);
        <span class="keywordflow">else</span>
          <a class="code" href="bgp__route_8c.html#af17eefd0fc4a1bd8d98f657810e26741">bgp_rib_remove</a> (rn, ri, peer, afi, safi);
        <span class="keywordflow">break</span>;
      }
  <span class="keywordflow">return</span> <a class="code" href="workqueue_8h.html#a0e78d42489413cdb20b75485932a3885ac62ec0649e33ec9d6e0836fab0dec7fc">WQ_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad3a33b21d2801a0df0a610da8d41783f"></a><!-- doxytag: member="bgp_route.c::bgp_clear_route_table" ref="ad3a33b21d2801a0df0a610da8d41783f" args="(struct peer *peer, afi_t afi, safi_t safi, struct bgp_table *table, struct peer *rsclient, enum bgp_clear_route_type purpose)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_clear_route_table </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__table.html">bgp_table</a> *&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>rsclient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="bgp__route_8h.html#a6a68ec86881e2e24c1dfdd8a47267e81">bgp_clear_route_type</a>&#160;</td>
          <td class="paramname"><em>purpose</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02752">2752</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  
  
  <span class="keywordflow">if</span> (! table)
    table = (rsclient) ? rsclient-&gt;<a class="code" href="structpeer.html#a7e8ca2a0bcdc168c59140e710a1f2060">rib</a>[afi][safi] : peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[afi][safi];
  
  <span class="comment">/* If still no table =&gt; afi/safi isn&#39;t configured at all or smth. */</span>
  if (! table)
    <span class="keywordflow">return</span>;
  
  <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (table); rn; rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rn))
    {
      <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;
      <span class="keyword">struct </span><a class="code" href="structbgp__adj__in.html">bgp_adj_in</a> *ain;
      <span class="keyword">struct </span><a class="code" href="structbgp__adj__out.html">bgp_adj_out</a> *aout;
      
      <span class="keywordflow">if</span> (rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
        <span class="keywordflow">continue</span>;

      <span class="comment">/* XXX:TODO: This is suboptimal, every non-empty route_node is</span>
<span class="comment">       * queued for every clearing peer, regardless of whether it is</span>
<span class="comment">       * relevant to the peer at hand.</span>
<span class="comment">       *</span>
<span class="comment">       * Overview: There are 3 different indices which need to be</span>
<span class="comment">       * scrubbed, potentially, when a peer is removed:</span>
<span class="comment">       *</span>
<span class="comment">       * 1 peer&#39;s routes visible via the RIB (ie accepted routes)</span>
<span class="comment">       * 2 peer&#39;s routes visible by the (optional) peer&#39;s adj-in index</span>
<span class="comment">       * 3 other routes visible by the peer&#39;s adj-out index</span>
<span class="comment">       *</span>
<span class="comment">       * 3 there is no hurry in scrubbing, once the struct peer is</span>
<span class="comment">       * removed from bgp-&gt;peer, we could just GC such deleted peer&#39;s</span>
<span class="comment">       * adj-outs at our leisure.</span>
<span class="comment">       *</span>
<span class="comment">       * 1 and 2 must be &#39;scrubbed&#39; in some way, at least made</span>
<span class="comment">       * invisible via RIB index before peer session is allowed to be</span>
<span class="comment">       * brought back up. So one needs to know when such a &#39;search&#39; is</span>
<span class="comment">       * complete.</span>
<span class="comment">       *</span>
<span class="comment">       * Ideally:</span>
<span class="comment">       *</span>
<span class="comment">       * - there&#39;d be a single global queue or a single RIB walker</span>
<span class="comment">       * - rather than tracking which route_nodes still need to be</span>
<span class="comment">       *   examined on a peer basis, we&#39;d track which peers still</span>
<span class="comment">       *   aren&#39;t cleared</span>
<span class="comment">       *</span>
<span class="comment">       * Given that our per-peer prefix-counts now should be reliable,</span>
<span class="comment">       * this may actually be achievable. It doesn&#39;t seem to be a huge</span>
<span class="comment">       * problem at this time,</span>
<span class="comment">       */</span>
      <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
        <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> == peer || purpose == <a class="code" href="bgp__route_8h.html#a6a68ec86881e2e24c1dfdd8a47267e81a8c1adeda524233bcf00f4616680e0643">BGP_CLEAR_ROUTE_MY_RSCLIENT</a>)
          {
            <span class="keyword">struct </span><a class="code" href="structbgp__clear__node__queue.html">bgp_clear_node_queue</a> *cnq;

            <span class="comment">/* both unlocked in bgp_clear_node_queue_del */</span>
            <a class="code" href="bgp__table_8c.html#a31e5a9590da2ec7f671d9014a714a885">bgp_table_lock</a> (rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>);
            <a class="code" href="bgp__table_8c.html#a8c629ca0214d269ce20f39268b9196d7">bgp_lock_node</a> (rn);
            cnq = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba28eaf22226d7f0b2009a7f95872a041a">MTYPE_BGP_CLEAR_NODE_QUEUE</a>,
                           <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structbgp__clear__node__queue.html">bgp_clear_node_queue</a>));
            cnq-&gt;<a class="code" href="structbgp__clear__node__queue.html#a12f80a474cbd6bccad2a53411b8b2b58">rn</a> = <a class="code" href="structbgp__clear__node__queue.html#a12f80a474cbd6bccad2a53411b8b2b58">rn</a>;
            cnq-&gt;<a class="code" href="structbgp__clear__node__queue.html#ac173c5e7a4485ec62d670edea755f19c">purpose</a> = <a class="code" href="structbgp__clear__node__queue.html#ac173c5e7a4485ec62d670edea755f19c">purpose</a>;
            <a class="code" href="workqueue_8c.html#a193fb769a4d04f3c160c623fd07dfb21">work_queue_add</a> (peer-&gt;<a class="code" href="structpeer.html#a194efb8be481f6589ff18fbbc509edbd">clear_node_queue</a>, cnq);
            <span class="keywordflow">break</span>;
          }

      <span class="keywordflow">for</span> (ain = rn-&gt;<a class="code" href="structbgp__node.html#a47213f2ff58ef9de9f5daf62b8f918be">adj_in</a>; ain; ain = ain-&gt;<a class="code" href="structbgp__adj__in.html#aaa2dc023411504da13bde05352687565">next</a>)
        <span class="keywordflow">if</span> (ain-&gt;<a class="code" href="structbgp__adj__in.html#ab6bb20edc80c75c836662a675102301d">peer</a> == peer || <a class="code" href="structbgp__clear__node__queue.html#ac173c5e7a4485ec62d670edea755f19c">purpose</a> == <a class="code" href="bgp__route_8h.html#a6a68ec86881e2e24c1dfdd8a47267e81a8c1adeda524233bcf00f4616680e0643">BGP_CLEAR_ROUTE_MY_RSCLIENT</a>)
          {
            <a class="code" href="bgp__advertise_8c.html#a10c89147ee0e113b39318daa8cb5dc66">bgp_adj_in_remove</a> (rn, ain);
            <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
            <span class="keywordflow">break</span>;
          }
      <span class="keywordflow">for</span> (aout = rn-&gt;<a class="code" href="structbgp__node.html#a9bf05aaab10e96a03e4110e68fb658b3">adj_out</a>; aout; aout = aout-&gt;<a class="code" href="structbgp__adj__out.html#ac948c3694180238ffaa4fdba9576b84b">next</a>)
        <span class="keywordflow">if</span> (aout-&gt;<a class="code" href="structbgp__adj__out.html#ae1c9f9080494135b21825472a087d5b2">peer</a> == peer || <a class="code" href="structbgp__clear__node__queue.html#ac173c5e7a4485ec62d670edea755f19c">purpose</a> == <a class="code" href="bgp__route_8h.html#a6a68ec86881e2e24c1dfdd8a47267e81a8c1adeda524233bcf00f4616680e0643">BGP_CLEAR_ROUTE_MY_RSCLIENT</a>)
          {
            <a class="code" href="bgp__advertise_8c.html#a4f008d09b6f5c7288dc27f5a5fbf376f">bgp_adj_out_remove</a> (rn, aout, peer, afi, safi);
            <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
            <span class="keywordflow">break</span>;
          }
    }
  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa1dd948948425c7e30941a8816af5bb1"></a><!-- doxytag: member="bgp_route.c::bgp_clear_stale_route" ref="aa1dd948948425c7e30941a8816af5bb1" args="(struct peer *peer, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_clear_stale_route </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02947">2947</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;
  <span class="keyword">struct </span><a class="code" href="structbgp__table.html">bgp_table</a> *table;

  table = peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[<a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>][<a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>];

  <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (table); rn; rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rn))
    {
      <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
    <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> == peer)
      {
        <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a455eac0750f63b056c8c5aff39222927">BGP_INFO_STALE</a>))
          <a class="code" href="bgp__route_8c.html#af17eefd0fc4a1bd8d98f657810e26741">bgp_rib_remove</a> (rn, ri, peer, <a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>, <a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>);
        <span class="keywordflow">break</span>;
      }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7e09865b6ccdcb2325e714cffa6ed5f2"></a><!-- doxytag: member="bgp_route.c::bgp_cluster_filter" ref="a7e09865b6ccdcb2325e714cffa6ed5f2" args="(struct peer *peer, struct attr *attr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_cluster_filter </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00629">629</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span>in_addr cluster_id;

  <span class="keywordflow">if</span> (attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a> &amp;&amp; attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#af291cf1efc95b5ed084669b9049db919">cluster</a>)
    {
      <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a3444d46283ecd1ecc8710fd44c331151">config</a> &amp; <a class="code" href="bgpd_8h.html#ab993fdc22aec211767601ff9cea0f534">BGP_CONFIG_CLUSTER_ID</a>)
    cluster_id = peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#aea853ee0e367191324fdf8278904b02d">cluster_id</a>;
      <span class="keywordflow">else</span>
    cluster_id = peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#ac85364afca7a6afc7c184148355318a7">router_id</a>;
      
      <span class="keywordflow">if</span> (<a class="code" href="bgp__attr_8c.html#af224634d5d6d41781af26d88d9f3c85b">cluster_loop_check</a> (attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#af291cf1efc95b5ed084669b9049db919">cluster</a>, cluster_id))
    <span class="keywordflow">return</span> 1;
    }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a52f73611e235740976722005ed9da75b"></a><!-- doxytag: member="bgp_route.c::bgp_community_filter" ref="a52f73611e235740976722005ed9da75b" args="(struct peer *peer, struct attr *attr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_community_filter </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00605">605</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (attr-&gt;<a class="code" href="structattr.html#ac892e1f95a0c26d39a47eb12d021072b">community</a>)
    {
      <span class="comment">/* NO_ADVERTISE check. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgp__community_8c.html#a0191e40f098590ab68b99a24c2a2e931">community_include</a> (attr-&gt;<a class="code" href="structattr.html#ac892e1f95a0c26d39a47eb12d021072b">community</a>, <a class="code" href="bgp__community_8h.html#ad48733d7ee618f0eb7371ca7300af9fc">COMMUNITY_NO_ADVERTISE</a>))
    <span class="keywordflow">return</span> 1;

      <span class="comment">/* NO_EXPORT check. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a> &amp;&amp;
      <a class="code" href="bgp__community_8c.html#a0191e40f098590ab68b99a24c2a2e931">community_include</a> (attr-&gt;<a class="code" href="structattr.html#ac892e1f95a0c26d39a47eb12d021072b">community</a>, <a class="code" href="bgp__community_8h.html#a219dabc199faf8a9c3d75d8cccd2aa04">COMMUNITY_NO_EXPORT</a>))
    <span class="keywordflow">return</span> 1;

      <span class="comment">/* NO_EXPORT_SUBCONFED check. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a> 
      || <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a647ad85450d688c959849bc89cd9ccb8">BGP_PEER_CONFED</a>)
    <span class="keywordflow">if</span> (<a class="code" href="bgp__community_8c.html#a0191e40f098590ab68b99a24c2a2e931">community_include</a> (attr-&gt;<a class="code" href="structattr.html#ac892e1f95a0c26d39a47eb12d021072b">community</a>, <a class="code" href="bgp__community_8h.html#a689f5d1583f5815924638159de3d3832">COMMUNITY_NO_EXPORT_SUBCONFED</a>))
      <span class="keywordflow">return</span> 1;
    }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a655014556fe828ec1f15a0189cc8869b"></a><!-- doxytag: member="bgp_route.c::bgp_default_originate" ref="a655014556fe828ec1f15a0189cc8869b" args="(struct peer *peer, afi_t afi, safi_t safi, int withdraw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_default_originate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>withdraw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02434">2434</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
  <span class="keyword">struct </span><a class="code" href="structattr.html">attr</a> <a class="code" href="structattr.html">attr</a> = { 0 };
  <span class="keyword">struct </span><a class="code" href="structaspath.html">aspath</a> *<a class="code" href="structaspath.html">aspath</a> = { 0 };
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> binfo;
  <span class="keyword">struct </span>peer *from;
  <span class="keywordtype">int</span> ret = <a class="code" href="routemap_8h.html#afd7345bfd662f1e7c77f0be351cd1516aa0f40f0a91e43bfe7131839fe179ac64">RMAP_DENYMATCH</a>;
  
  <span class="keywordflow">if</span> (!(afi == <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> || afi == <a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a>))
    <span class="keywordflow">return</span>;
  
  bgp = peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>;
  from = bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>;
  
  <a class="code" href="bgp__attr_8c.html#afe11e9b57f736617eca855aceae26f28">bgp_attr_default_set</a> (&amp;attr, <a class="code" href="bgpd_8h.html#a23e729207777c4691b94d476003c6ac9">BGP_ORIGIN_IGP</a>);
  aspath = attr.<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>;
  attr.<a class="code" href="structattr.html#aa7caa960ced4e67e8aec2b0ab3d9b0b0">local_pref</a> = bgp-&gt;<a class="code" href="structbgp.html#a401cfb8180562498c071d48e0fe58c97">default_local_pref</a>;
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;attr.<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>, &amp;peer-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.<a class="code" href="structbgp__nexthop.html#a8fed6fdf9282fb5e87f3f52b94313646">v4</a>, <a class="code" href="prefix_8h.html#a013983d7a5267a63023c50ab32a85c24">IPV4_MAX_BYTELEN</a>);

  <span class="keywordflow">if</span> (afi == <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>)
    <a class="code" href="prefix_8c.html#a35f57d44562d00baaf5d227d03214786">str2prefix</a> (<span class="stringliteral">&quot;0.0.0.0/0&quot;</span>, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (afi == <a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a>)
    {
      <span class="keyword">struct </span><a class="code" href="structattr__extra.html">attr_extra</a> *ae;
      attr.<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
      
      ae = <a class="code" href="bgp__attr_8c.html#a31ef3828cd7a1375f7b7dfe02aab705f">bgp_attr_extra_get</a> (&amp;attr);
      attr.<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a> = ae;
      
      <a class="code" href="prefix_8c.html#a35f57d44562d00baaf5d227d03214786">str2prefix</a> (<span class="stringliteral">&quot;::/0&quot;</span>, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);

      <span class="comment">/* IPv6 global nexthop must be included. */</span>
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;ae-&gt;mp_nexthop_global, &amp;peer-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.v6_global, 
          <a class="code" href="prefix_8h.html#ac2642af4f4d7a4209ad6261e72c658f9">IPV6_MAX_BYTELEN</a>);
          ae-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a> = 16;
 
      <span class="comment">/* If the peer is on shared nextwork and we have link-local</span>
<span class="comment">     nexthop set it. */</span>
      <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ab2847caa2148b30de1db8f52b8c7dad9">shared_network</a> 
      &amp;&amp; !IN6_IS_ADDR_UNSPECIFIED (&amp;peer-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.v6_local))
    {
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;ae-&gt;mp_nexthop_local, &amp;peer-&gt;<a class="code" href="structpeer.html#acf0de33545a449bafcefaefd963f1995">nexthop</a>.v6_local, 
          <a class="code" href="prefix_8h.html#ac2642af4f4d7a4209ad6261e72c658f9">IPV6_MAX_BYTELEN</a>);
      ae-&gt;<a class="code" href="structattr__extra.html#aa9572231b6d45822cd1af557583cdba5">mp_nexthop_len</a> = 32;
    }
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#adaa47d231b6aae95157727ddbb836886">default_rmap</a>[afi][safi].<a class="code" href="structpeer.html#a72e35e12b6a073cd627df5e012038c16">name</a>)
    {
      binfo.peer = bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>;
      binfo.attr = &amp;attr;

      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a>, <a class="code" href="bgpd_8h.html#aa2464065e408b72a051e299c8b11e1f9">PEER_RMAP_TYPE_DEFAULT</a>);

      ret = <a class="code" href="routemap_8c.html#a3372553a024332702cfd603e1f4c08d6">route_map_apply</a> (peer-&gt;<a class="code" href="structpeer.html#adaa47d231b6aae95157727ddbb836886">default_rmap</a>[afi][safi].<a class="code" href="structpeer.html#a4e3fea3d9cdc1addc3615f1906220a54">map</a>, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>,
                 <a class="code" href="routemap_8h.html#ae21439463f873ce0ce1556c9d6fa7370adcb3bc0f6448923a387dfe3658ca7bda">RMAP_BGP</a>, &amp;binfo);

      bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a> = 0;

      <span class="keywordflow">if</span> (ret == <a class="code" href="routemap_8h.html#afd7345bfd662f1e7c77f0be351cd1516aa0f40f0a91e43bfe7131839fe179ac64">RMAP_DENYMATCH</a>)
    {
      <a class="code" href="bgp__attr_8c.html#a3ea9ed94bcd0236f8f83310615e7c022">bgp_attr_flush</a> (&amp;attr);
      withdraw = 1;
    }
    }

  <span class="keywordflow">if</span> (withdraw)
    {
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a7ce39647237ee1e1b720e6d0d4056efe">PEER_STATUS_DEFAULT_ORIGINATE</a>))
    <a class="code" href="bgp__packet_8c.html#aa71da9143ef196d665fd6cb773885f61">bgp_default_withdraw_send</a> (peer, afi, safi);
      <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a7ce39647237ee1e1b720e6d0d4056efe">PEER_STATUS_DEFAULT_ORIGINATE</a>);
    }
  <span class="keywordflow">else</span>
    {
      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a7ce39647237ee1e1b720e6d0d4056efe">PEER_STATUS_DEFAULT_ORIGINATE</a>);
      <a class="code" href="bgp__packet_8c.html#abe0b30eef3af58da0c5ae5e870e91851">bgp_default_update_send</a> (peer, &amp;attr, afi, safi, from);
    }
  
  <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;attr);
  <a class="code" href="bgp__aspath_8c.html#a414aa289179196886d9f059bdd41e81c">aspath_unintern</a> (aspath);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad1c9f872f6253932e08bbc9d071f39c3"></a><!-- doxytag: member="bgp_route.c::bgp_export_modifier" ref="ad1c9f872f6253932e08bbc9d071f39c3" args="(struct peer *rsclient, struct peer *peer, struct prefix *p, struct attr *attr, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_export_modifier </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>rsclient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00685">685</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__filter.html">bgp_filter</a> *<a class="code" href="structfilter.html">filter</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> info;
  <a class="code" href="routemap_8h.html#afd7345bfd662f1e7c77f0be351cd1516">route_map_result_t</a> ret;

  filter = &amp;peer-&gt;<a class="code" href="structpeer.html#a8ae54829ca91f5860216eb326f264727">filter</a>[afi][safi];

  <span class="comment">/* Route map apply. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8h.html#a9a3b5d5b467eb3306b8399063dbaca05">ROUTE_MAP_EXPORT_NAME</a> (filter))
    {
      <span class="comment">/* Duplicate current value to new strucutre for modification. */</span>
      info.peer = rsclient;
      info.attr = <a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>;

      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (rsclient-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a>, <a class="code" href="bgpd_8h.html#a5d239df7c366c66f144cac26eea3c7f9">PEER_RMAP_TYPE_EXPORT</a>);

      <span class="comment">/* Apply BGP route map to the attribute. */</span>
      ret = <a class="code" href="routemap_8c.html#a3372553a024332702cfd603e1f4c08d6">route_map_apply</a> (<a class="code" href="bgp__route_8h.html#aee3fa611a841ec8c25ef28971e2c1791">ROUTE_MAP_EXPORT</a> (filter), p, <a class="code" href="routemap_8h.html#ae21439463f873ce0ce1556c9d6fa7370adcb3bc0f6448923a387dfe3658ca7bda">RMAP_BGP</a>, &amp;info);

      rsclient-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a> = 0;

      <span class="keywordflow">if</span> (ret == <a class="code" href="routemap_8h.html#afd7345bfd662f1e7c77f0be351cd1516aa0f40f0a91e43bfe7131839fe179ac64">RMAP_DENYMATCH</a>)
        {
          <span class="comment">/* Free newly generated AS path and community by route-map. */</span>
          <a class="code" href="bgp__attr_8c.html#a3ea9ed94bcd0236f8f83310615e7c022">bgp_attr_flush</a> (attr);
          <span class="keywordflow">return</span> <a class="code" href="routemap_8h.html#a57b0063c49d180ad8b9d19ae35d7e644ad79be2f4afd690ef956924415e6724bf">RMAP_DENY</a>;
        }
    }
  <span class="keywordflow">return</span> <a class="code" href="routemap_8h.html#a57b0063c49d180ad8b9d19ae35d7e644aa7d1859ac879fafcd59953ee1e27b134">RMAP_PERMIT</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0b543935bc92b0cd8fa61813637f0179"></a><!-- doxytag: member="bgp_route.c::bgp_import_modifier" ref="a0b543935bc92b0cd8fa61813637f0179" args="(struct peer *rsclient, struct peer *peer, struct prefix *p, struct attr *attr, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_import_modifier </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>rsclient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00719">719</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__filter.html">bgp_filter</a> *<a class="code" href="structfilter.html">filter</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> info;
  <a class="code" href="routemap_8h.html#afd7345bfd662f1e7c77f0be351cd1516">route_map_result_t</a> ret;

  filter = &amp;rsclient-&gt;<a class="code" href="structpeer.html#a8ae54829ca91f5860216eb326f264727">filter</a>[afi][safi];

  <span class="comment">/* Apply default weight value. */</span>
  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a5ea7f188c91db8c725332db353677b02">weight</a>)
    (<a class="code" href="bgp__attr_8c.html#a31ef3828cd7a1375f7b7dfe02aab705f">bgp_attr_extra_get</a> (attr))-&gt;weight = peer-&gt;<a class="code" href="structpeer.html#a5ea7f188c91db8c725332db353677b02">weight</a>;

  <span class="comment">/* Route map apply. */</span>
  if (<a class="code" href="bgp__route_8h.html#ab0211ed3cdec21a8ad4ea8b9329cbfdc">ROUTE_MAP_IMPORT_NAME</a> (filter))
    {
      <span class="comment">/* Duplicate current value to new strucutre for modification. */</span>
      info.peer = <a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>;
      info.attr = <a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>;

      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a>, <a class="code" href="bgpd_8h.html#a02dc8b409a25e5e440fd4f9b580fcdf7">PEER_RMAP_TYPE_IMPORT</a>);

      <span class="comment">/* Apply BGP route map to the attribute. */</span>
      ret = <a class="code" href="routemap_8c.html#a3372553a024332702cfd603e1f4c08d6">route_map_apply</a> (<a class="code" href="bgp__route_8h.html#aaf7edc00b003acb19b6b2f48c6be6c02">ROUTE_MAP_IMPORT</a> (filter), p, <a class="code" href="routemap_8h.html#ae21439463f873ce0ce1556c9d6fa7370adcb3bc0f6448923a387dfe3658ca7bda">RMAP_BGP</a>, &amp;info);

      peer-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a> = 0;

      <span class="keywordflow">if</span> (ret == <a class="code" href="routemap_8h.html#afd7345bfd662f1e7c77f0be351cd1516aa0f40f0a91e43bfe7131839fe179ac64">RMAP_DENYMATCH</a>)
        {
          <span class="comment">/* Free newly generated AS path and community by route-map. */</span>
          <a class="code" href="bgp__attr_8c.html#a3ea9ed94bcd0236f8f83310615e7c022">bgp_attr_flush</a> (attr);
          <span class="keywordflow">return</span> <a class="code" href="routemap_8h.html#a57b0063c49d180ad8b9d19ae35d7e644ad79be2f4afd690ef956924415e6724bf">RMAP_DENY</a>;
        }
    }
  <span class="keywordflow">return</span> <a class="code" href="routemap_8h.html#a57b0063c49d180ad8b9d19ae35d7e644aa7d1859ac879fafcd59953ee1e27b134">RMAP_PERMIT</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac7472ce06f993cd544f794c7b0381954"></a><!-- doxytag: member="bgp_route.c::bgp_info_add" ref="ac7472ce06f993cd544f794c7b0381954" args="(struct bgp_node *rn, struct bgp_info *ri)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_info_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>ri</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00184">184</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *top;

  top = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>;
  
  ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a> = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>;
  ri-&gt;<a class="code" href="structbgp__info.html#aa0fdbfcd4a2876a68a4476136b01fe3b">prev</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <span class="keywordflow">if</span> (top)
    top-&gt;<a class="code" href="structbgp__info.html#aa0fdbfcd4a2876a68a4476136b01fe3b">prev</a> = ri;
  rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> = ri;
  
  <a class="code" href="bgp__route_8c.html#a58d087602593301ee3256a1ffd1321b8">bgp_info_lock</a> (ri);
  <a class="code" href="bgp__table_8c.html#a8c629ca0214d269ce20f39268b9196d7">bgp_lock_node</a> (rn);
  <a class="code" href="bgpd_8c.html#a05008955933f8ba5f831e03862ca5b94">peer_lock</a> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>); <span class="comment">/* bgp_info peer reference */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="adb9d04630ab93d7aee4950ee2a1b0ead"></a><!-- doxytag: member="bgp_route.c::bgp_info_cmp" ref="adb9d04630ab93d7aee4950ee2a1b0ead" args="(struct bgp *bgp, struct bgp_info *new, struct bgp_info *exist)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_info_cmp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>new</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>exist</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00319">319</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  u_int32_t new_pref;
  u_int32_t exist_pref;
  u_int32_t new_med;
  u_int32_t exist_med;
  u_int32_t new_weight = 0;
  u_int32_t exist_weight = 0;
  <span class="keyword">struct </span>in_addr new_id;
  <span class="keyword">struct </span>in_addr exist_id;
  <span class="keywordtype">int</span> new_cluster;
  <span class="keywordtype">int</span> exist_cluster;
  <span class="keywordtype">int</span> internal_as_route = 0;
  <span class="keywordtype">int</span> confed_as_route = 0;
  <span class="keywordtype">int</span> ret;

  <span class="comment">/* 0. Null check. */</span>
  <span class="keywordflow">if</span> (<span class="keyword">new</span> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    <span class="keywordflow">return</span> 0;
  <span class="keywordflow">if</span> (exist == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    <span class="keywordflow">return</span> 1;

  <span class="comment">/* 1. Weight check. */</span>
  <span class="keywordflow">if</span> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>)
    new_weight = <span class="keyword">new</span>-&gt;attr-&gt;extra-&gt;weight;
  <span class="keywordflow">if</span> (exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>)
    exist_weight = exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#a83e07fadc622d7c68bf1aff668371f18">weight</a>;
  <span class="keywordflow">if</span> (new_weight &gt; exist_weight)
    <span class="keywordflow">return</span> 1;
  <span class="keywordflow">if</span> (new_weight &lt; exist_weight)
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* 2. Local preference check. */</span>
  <span class="keywordflow">if</span> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp; <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#afb9037d30bc0d4b42c7960ffefcbd299">BGP_ATTR_LOCAL_PREF</a>))
    new_pref = <span class="keyword">new</span>-&gt;attr-&gt;local_pref;
  <span class="keywordflow">else</span>
    new_pref = bgp-&gt;<a class="code" href="structbgp.html#a401cfb8180562498c071d48e0fe58c97">default_local_pref</a>;

  <span class="keywordflow">if</span> (exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp; <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#afb9037d30bc0d4b42c7960ffefcbd299">BGP_ATTR_LOCAL_PREF</a>))
    exist_pref = exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#aa7caa960ced4e67e8aec2b0ab3d9b0b0">local_pref</a>;
  <span class="keywordflow">else</span>
    exist_pref = bgp-&gt;<a class="code" href="structbgp.html#a401cfb8180562498c071d48e0fe58c97">default_local_pref</a>;
    
  <span class="keywordflow">if</span> (new_pref &gt; exist_pref)
    <span class="keywordflow">return</span> 1;
  <span class="keywordflow">if</span> (new_pref &lt; exist_pref)
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* 3. Local route check. */</span>
  <span class="keywordflow">if</span> (new-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a3c52611f8ef467c61080e1444b91d73d">BGP_ROUTE_STATIC</a>)
    <span class="keywordflow">return</span> 1;
  <span class="keywordflow">if</span> (exist-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a3c52611f8ef467c61080e1444b91d73d">BGP_ROUTE_STATIC</a>)
    <span class="keywordflow">return</span> 0;

  <span class="keywordflow">if</span> (new-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a0e973ed2530863b634c03e48637ce7b0">BGP_ROUTE_REDISTRIBUTE</a>)
    <span class="keywordflow">return</span> 1;
  <span class="keywordflow">if</span> (exist-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a0e973ed2530863b634c03e48637ce7b0">BGP_ROUTE_REDISTRIBUTE</a>)
    <span class="keywordflow">return</span> 0;

  <span class="keywordflow">if</span> (new-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a643a61537d50b199b001824d82b2e66d">BGP_ROUTE_AGGREGATE</a>)
    <span class="keywordflow">return</span> 1;
  <span class="keywordflow">if</span> (exist-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a643a61537d50b199b001824d82b2e66d">BGP_ROUTE_AGGREGATE</a>)
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* 4. AS path length check. */</span>
  <span class="keywordflow">if</span> (! <a class="code" href="bgpd_8c.html#a0b3388d8ac73af2d4f4f22e46746da1e">bgp_flag_check</a> (bgp, <a class="code" href="bgpd_8h.html#a1c9218156b20a2a0641bdd096fed76c0">BGP_FLAG_ASPATH_IGNORE</a>))
    {
      <span class="keywordtype">int</span> exist_hops = <a class="code" href="bgp__aspath_8c.html#ae0142a952a7219bbe0244f266ab0f0f5">aspath_count_hops</a> (exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
      <span class="keywordtype">int</span> exist_confeds = <a class="code" href="bgp__aspath_8c.html#a8638c553cd3d2c87161aa489ea0a45d7">aspath_count_confeds</a> (exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
      
      <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#a0b3388d8ac73af2d4f4f22e46746da1e">bgp_flag_check</a> (bgp, <a class="code" href="bgpd_8h.html#a2daf5bdb7e1c87887b425c4f138d49f6">BGP_FLAG_ASPATH_CONFED</a>))
    {
      <span class="keywordtype">int</span> aspath_hops;
      
      aspath_hops = <a class="code" href="bgp__aspath_8c.html#ae0142a952a7219bbe0244f266ab0f0f5">aspath_count_hops</a> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
          aspath_hops += <a class="code" href="bgp__aspath_8c.html#a8638c553cd3d2c87161aa489ea0a45d7">aspath_count_confeds</a> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
          
      <span class="keywordflow">if</span> ( aspath_hops &lt; (exist_hops + exist_confeds))
        <span class="keywordflow">return</span> 1;
      <span class="keywordflow">if</span> ( aspath_hops &gt; (exist_hops + exist_confeds))
        <span class="keywordflow">return</span> 0;
    }
      <span class="keywordflow">else</span>
    {
      <span class="keywordtype">int</span> newhops = <a class="code" href="bgp__aspath_8c.html#ae0142a952a7219bbe0244f266ab0f0f5">aspath_count_hops</a> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
      
      <span class="keywordflow">if</span> (newhops &lt; exist_hops)
        <span class="keywordflow">return</span> 1;
          <span class="keywordflow">if</span> (newhops &gt; exist_hops)
        <span class="keywordflow">return</span> 0;
    }
    }

  <span class="comment">/* 5. Origin check. */</span>
  <span class="keywordflow">if</span> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a17e152c15e3bd7a54475086d762e76ec">origin</a> &lt; exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a17e152c15e3bd7a54475086d762e76ec">origin</a>)
    <span class="keywordflow">return</span> 1;
  <span class="keywordflow">if</span> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a17e152c15e3bd7a54475086d762e76ec">origin</a> &gt; exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a17e152c15e3bd7a54475086d762e76ec">origin</a>)
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* 6. MED check. */</span>
  internal_as_route = (<a class="code" href="bgp__aspath_8c.html#ae0142a952a7219bbe0244f266ab0f0f5">aspath_count_hops</a> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>) == 0
              &amp;&amp; <a class="code" href="bgp__aspath_8c.html#ae0142a952a7219bbe0244f266ab0f0f5">aspath_count_hops</a> (exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>) == 0);
  confed_as_route = (<a class="code" href="bgp__aspath_8c.html#a8638c553cd3d2c87161aa489ea0a45d7">aspath_count_confeds</a> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>) &gt; 0
            &amp;&amp; <a class="code" href="bgp__aspath_8c.html#a8638c553cd3d2c87161aa489ea0a45d7">aspath_count_confeds</a> (exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>) &gt; 0
            &amp;&amp; <a class="code" href="bgp__aspath_8c.html#ae0142a952a7219bbe0244f266ab0f0f5">aspath_count_hops</a> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>) == 0
            &amp;&amp; <a class="code" href="bgp__aspath_8c.html#ae0142a952a7219bbe0244f266ab0f0f5">aspath_count_hops</a> (exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>) == 0);
  
  <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#a0b3388d8ac73af2d4f4f22e46746da1e">bgp_flag_check</a> (bgp, <a class="code" href="bgpd_8h.html#a89cb4c8d9453fb88c6360ea5f8dd7075">BGP_FLAG_ALWAYS_COMPARE_MED</a>)
      || (<a class="code" href="bgpd_8c.html#a0b3388d8ac73af2d4f4f22e46746da1e">bgp_flag_check</a> (bgp, <a class="code" href="bgpd_8h.html#abdc54bbffd7bff820138d5e671e70efa">BGP_FLAG_MED_CONFED</a>)
     &amp;&amp; confed_as_route)
      || <a class="code" href="bgp__aspath_8c.html#a5f979a1ff3bc3908684e4592e5c383eb">aspath_cmp_left</a> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>, exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>)
      || <a class="code" href="bgp__aspath_8c.html#ace7eb37e6ea088fb0ea82c9ae4c58375">aspath_cmp_left_confed</a> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>, exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>)
      || internal_as_route)
    {
      new_med = <a class="code" href="bgp__route_8c.html#a58dff46a744315de3961a85990be81c9">bgp_med_value</a> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>, bgp);
      exist_med = <a class="code" href="bgp__route_8c.html#a58dff46a744315de3961a85990be81c9">bgp_med_value</a> (exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>, bgp);

      <span class="keywordflow">if</span> (new_med &lt; exist_med)
    <span class="keywordflow">return</span> 1;
      <span class="keywordflow">if</span> (new_med &gt; exist_med)
    <span class="keywordflow">return</span> 0;
    }

  <span class="comment">/* 7. Peer type check. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (new-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a> 
      &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (exist-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a9e245a415718944a081734a08a8d7e92">BGP_PEER_IBGP</a>)
    <span class="keywordflow">return</span> 1;
  <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (new-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a> 
      &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (exist-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a647ad85450d688c959849bc89cd9ccb8">BGP_PEER_CONFED</a>)
    <span class="keywordflow">return</span> 1;
  <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (new-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a9e245a415718944a081734a08a8d7e92">BGP_PEER_IBGP</a> 
      &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (exist-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a>)
    <span class="keywordflow">return</span> 0;
  <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (new-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a647ad85450d688c959849bc89cd9ccb8">BGP_PEER_CONFED</a> 
      &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (exist-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a>)
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* 8. IGP metric check. */</span>
  <span class="keywordflow">if</span> (new-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a> || exist-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>)
    {
      uint32_t newm = (<span class="keyword">new</span>-&gt;extra ? <span class="keyword">new</span>-&gt;extra-&gt;igpmetric : 0);
      uint32_t existm = (exist-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a> ? exist-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>-&gt;<a class="code" href="structbgp__info__extra.html#abe62396922b009507e82c29048bfb9a5">igpmetric</a> : 0);
      
      <span class="keywordflow">if</span> (newm &lt; existm)
        <span class="keywordflow">return</span> 1;
      <span class="keywordflow">if</span> (newm &gt; existm)
        <span class="keywordflow">return</span> 0;
    }

  <span class="comment">/* 9. Maximum path check. */</span>

  <span class="comment">/* 10. If both paths are external, prefer the path that was received</span>
<span class="comment">     first (the oldest one).  This step minimizes route-flap, since a</span>
<span class="comment">     newer path won&#39;t displace an older one, even if it was the</span>
<span class="comment">     preferred route based on the additional decision criteria below.  */</span>
  <span class="keywordflow">if</span> (! <a class="code" href="bgpd_8c.html#a0b3388d8ac73af2d4f4f22e46746da1e">bgp_flag_check</a> (bgp, <a class="code" href="bgpd_8h.html#ab508173624f08e35b426cb4f97af55f7">BGP_FLAG_COMPARE_ROUTER_ID</a>)
      &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (new-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a>
      &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (exist-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a>)
    {
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (new-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a43b3eb776824e6b86970e3886120913e">BGP_INFO_SELECTED</a>))
    <span class="keywordflow">return</span> 1;
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (exist-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a43b3eb776824e6b86970e3886120913e">BGP_INFO_SELECTED</a>))
    <span class="keywordflow">return</span> 0;
    }

  <span class="comment">/* 11. Rourter-ID comparision. */</span>
  <span class="keywordflow">if</span> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp; <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a>(<a class="code" href="bgpd_8h.html#a4c57fcfdf8e83e8d6dce5369a9697244">BGP_ATTR_ORIGINATOR_ID</a>))
    new_id.s_addr = new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#a2a675121474a39bf5d9f95393b00e156">originator_id</a>.s_addr;
  <span class="keywordflow">else</span>
    new_id.s_addr = new-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#ae620d85ff35b31ba9eb6073b81731b5b">remote_id</a>.s_addr;
  if (exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp; <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a>(<a class="code" href="bgpd_8h.html#a4c57fcfdf8e83e8d6dce5369a9697244">BGP_ATTR_ORIGINATOR_ID</a>))
    exist_id.s_addr = exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#a2a675121474a39bf5d9f95393b00e156">originator_id</a>.s_addr;
  <span class="keywordflow">else</span>
    exist_id.s_addr = exist-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#ae620d85ff35b31ba9eb6073b81731b5b">remote_id</a>.s_addr;

  if (ntohl (new_id.s_addr) &lt; ntohl (exist_id.s_addr))
    <span class="keywordflow">return</span> 1;
  <span class="keywordflow">if</span> (ntohl (new_id.s_addr) &gt; ntohl (exist_id.s_addr))
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* 12. Cluster length comparision. */</span>
  <span class="keywordflow">if</span> (new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp; <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a>(<a class="code" href="bgpd_8h.html#a5dfaaa2abcc46f34a50dd1f192b1e28c">BGP_ATTR_CLUSTER_LIST</a>))
    new_cluster = new-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#af291cf1efc95b5ed084669b9049db919">cluster</a>-&gt;<a class="code" href="structcluster__list.html#af8a1b7c942261289059011265e51db9e">length</a>;
  <span class="keywordflow">else</span>
    new_cluster = 0;
  if (exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp; <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a>(<a class="code" href="bgpd_8h.html#a5dfaaa2abcc46f34a50dd1f192b1e28c">BGP_ATTR_CLUSTER_LIST</a>))
    exist_cluster = exist-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#af291cf1efc95b5ed084669b9049db919">cluster</a>-&gt;<a class="code" href="structcluster__list.html#af8a1b7c942261289059011265e51db9e">length</a>;
  <span class="keywordflow">else</span>
    exist_cluster = 0;

  if (new_cluster &lt; exist_cluster)
    <span class="keywordflow">return</span> 1;
  <span class="keywordflow">if</span> (new_cluster &gt; exist_cluster)
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* 13. Neighbor address comparision. */</span>
  ret = <a class="code" href="sockunion_8c.html#ac407b73abeade79f1a85355fde19b294">sockunion_cmp</a> (new-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#a9ab7f1f3e48a3027c0f8a92fa6e2de28">su_remote</a>, exist-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#a9ab7f1f3e48a3027c0f8a92fa6e2de28">su_remote</a>);

  <span class="keywordflow">if</span> (ret == 1)
    <span class="keywordflow">return</span> 0;
  <span class="keywordflow">if</span> (ret == -1)
    <span class="keywordflow">return</span> 1;

  <span class="keywordflow">return</span> 1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abfe260239e1b72a286e9c45a5aa1afbd"></a><!-- doxytag: member="bgp_route.c::bgp_info_delete" ref="abfe260239e1b72a286e9c45a5aa1afbd" args="(struct bgp_node *rn, struct bgp_info *ri)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_info_delete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>ri</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00218">218</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#a0ff836da32782fe548f3fe570e5107e7">BGP_INFO_REMOVED</a>);
  <span class="comment">/* set of previous already took care of pcount */</span>
  <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a757f441d0a803a7bbc6bc79dfa3200bd"></a><!-- doxytag: member="bgp_route.c::bgp_info_extra_free" ref="a757f441d0a803a7bbc6bc79dfa3200bd" args="(struct bgp_info_extra **extra)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_info_extra_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__info__extra.html">bgp_info_extra</a> **&#160;</td>
          <td class="paramname"><em>extra</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00102">102</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (extra &amp;&amp; *extra)
    {
      <span class="keywordflow">if</span> ((*extra)-&gt;damp_info)
        <a class="code" href="bgp__damp_8c.html#a0c4f46bfbd9a397b8ba5d830d48cc5ca">bgp_damp_info_free</a> ((*extra)-&gt;damp_info, 0);
      
      (*extra)-&gt;damp_info = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
      
      <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167bab9cfb57c75ebf2bfda3cc221c16e10eb">MTYPE_BGP_ROUTE_EXTRA</a>, *extra);
      
      *extra = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3afeebe128032bb8a486915820234af9"></a><!-- doxytag: member="bgp_route.c::bgp_info_extra_get" ref="a3afeebe128032bb8a486915820234af9" args="(struct bgp_info *ri)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structbgp__info__extra.html">bgp_info_extra</a>* bgp_info_extra_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>ri</em></td><td>)</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00121">121</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (!ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>)
    ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a> = <a class="code" href="bgp__route_8c.html#a87ee6a929c17bd9186e7125d5670a309">bgp_info_extra_new</a>();
  <span class="keywordflow">return</span> ri-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a87ee6a929c17bd9186e7125d5670a309"></a><!-- doxytag: member="bgp_route.c::bgp_info_extra_new" ref="a87ee6a929c17bd9186e7125d5670a309" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structbgp__info__extra.html">bgp_info_extra</a>* bgp_info_extra_new </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00094">94</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__info__extra.html">bgp_info_extra</a> *<span class="keyword">new</span>;
  <span class="keyword">new</span> = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167bab9cfb57c75ebf2bfda3cc221c16e10eb">MTYPE_BGP_ROUTE_EXTRA</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structbgp__info__extra.html">bgp_info_extra</a>));
  <span class="keywordflow">return</span> <span class="keyword">new</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5f6151beff24268f62320f62df673be2"></a><!-- doxytag: member="bgp_route.c::bgp_info_free" ref="a5f6151beff24268f62320f62df673be2" args="(struct bgp_info *binfo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_info_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>binfo</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00137">137</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (binfo-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>)
    <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (binfo-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>);
  
  <a class="code" href="bgp__route_8c.html#a757f441d0a803a7bbc6bc79dfa3200bd">bgp_info_extra_free</a> (&amp;binfo-&gt;<a class="code" href="structbgp__info.html#ae6a0a53b7a3f457c0f479f635c20ec76">extra</a>);

  <a class="code" href="bgpd_8c.html#a7c9a78413925372479b9c538daac6d1d">peer_unlock</a> (binfo-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>); <span class="comment">/* bgp_info peer reference */</span>

  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba98916f4c0d0008ff888391232d47d31a">MTYPE_BGP_ROUTE</a>, binfo);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a58d087602593301ee3256a1ffd1321b8"></a><!-- doxytag: member="bgp_route.c::bgp_info_lock" ref="a58d087602593301ee3256a1ffd1321b8" args="(struct bgp_info *binfo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structbgp__info.html">bgp_info</a>* bgp_info_lock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>binfo</em></td><td>)</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00150">150</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  binfo-&gt;<a class="code" href="structbgp__info.html#a0bd502e73cab1b70ed893edffd9977cc">lock</a>++;
  <span class="keywordflow">return</span> binfo;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac58054377984aaf2a3436dfe2ca91e53"></a><!-- doxytag: member="bgp_route.c::bgp_info_new" ref="ac58054377984aaf2a3436dfe2ca91e53" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structbgp__info.html">bgp_info</a>* bgp_info_new </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00130">130</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba98916f4c0d0008ff888391232d47d31a">MTYPE_BGP_ROUTE</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structbgp__info.html">bgp_info</a>));
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4475c3919634039951683b34a18b1dee"></a><!-- doxytag: member="bgp_route.c::bgp_info_reap" ref="a4475c3919634039951683b34a18b1dee" args="(struct bgp_node *rn, struct bgp_info *ri)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_info_reap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>ri</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00204">204</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
    ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>-&gt;<a class="code" href="structbgp__info.html#aa0fdbfcd4a2876a68a4476136b01fe3b">prev</a> = ri-&gt;<a class="code" href="structbgp__info.html#aa0fdbfcd4a2876a68a4476136b01fe3b">prev</a>;
  <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#aa0fdbfcd4a2876a68a4476136b01fe3b">prev</a>)
    ri-&gt;<a class="code" href="structbgp__info.html#aa0fdbfcd4a2876a68a4476136b01fe3b">prev</a>-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a> = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>;
  <span class="keywordflow">else</span>
    rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>;
  
  <a class="code" href="bgp__route_8c.html#a3616cc85cfe85d5f7911aa6f10f03eea">bgp_info_unlock</a> (ri);
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae6999426a3503ae94836d8e1c040e38c"></a><!-- doxytag: member="bgp_route.c::bgp_info_restore" ref="ae6999426a3503ae94836d8e1c040e38c" args="(struct bgp_node *rn, struct bgp_info *ri)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_info_restore </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>ri</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00229">229</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#a0ff836da32782fe548f3fe570e5107e7">BGP_INFO_REMOVED</a>);
  <span class="comment">/* unset of previous already took care of pcount */</span>
  <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a44f265aae5a483d9cef00d766759584a"></a><!-- doxytag: member="bgp_route.c::bgp_info_set_flag" ref="a44f265aae5a483d9cef00d766759584a" args="(struct bgp_node *rn, struct bgp_info *ri, u_int32_t flag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_info_set_flag </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int32_t&#160;</td>
          <td class="paramname"><em>flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00278">278</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, flag);
  
  <span class="comment">/* early bath if we know it&#39;s not a flag that changes useability state */</span>
  <span class="keywordflow">if</span> (!<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (flag, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>|<a class="code" href="bgp__route_8h.html#aee2c962749a7df25a38ccd80559e50d5">BGP_INFO_UNUSEABLE</a>))
    <span class="keywordflow">return</span>;
  
  <a class="code" href="bgp__route_8c.html#af45d15e7f24645ea70bf8f3c8250921d">bgp_pcount_adjust</a> (rn, ri);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3616cc85cfe85d5f7911aa6f10f03eea"></a><!-- doxytag: member="bgp_route.c::bgp_info_unlock" ref="a3616cc85cfe85d5f7911aa6f10f03eea" args="(struct bgp_info *binfo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structbgp__info.html">bgp_info</a>* bgp_info_unlock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>binfo</em></td><td>)</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00157">157</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (binfo &amp;&amp; binfo-&gt;<a class="code" href="structbgp__info.html#a0bd502e73cab1b70ed893edffd9977cc">lock</a> &gt; 0);
  binfo-&gt;<a class="code" href="structbgp__info.html#a0bd502e73cab1b70ed893edffd9977cc">lock</a>--;
  
  <span class="keywordflow">if</span> (binfo-&gt;<a class="code" href="structbgp__info.html#a0bd502e73cab1b70ed893edffd9977cc">lock</a> == 0)
    {
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s: unlocked and freeing&quot;</span>, __func__);
      <a class="code" href="log_8c.html#a007e475475f7a96147bbb4315b58bb2e">zlog_backtrace</a> (LOG_DEBUG);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      <a class="code" href="bgp__route_8c.html#a5f6151beff24268f62320f62df673be2">bgp_info_free</a> (binfo);
      <span class="keywordflow">return</span> <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
    }

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (binfo-&gt;<a class="code" href="structbgp__info.html#a0bd502e73cab1b70ed893edffd9977cc">lock</a> == 1)
    {
      <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s: unlocked to 1&quot;</span>, __func__);
      <a class="code" href="log_8c.html#a007e475475f7a96147bbb4315b58bb2e">zlog_backtrace</a> (LOG_DEBUG);
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>  
  <span class="keywordflow">return</span> binfo;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a818f5df3bcb251b38f290b27a95baca3"></a><!-- doxytag: member="bgp_route.c::bgp_info_unset_flag" ref="a818f5df3bcb251b38f290b27a95baca3" args="(struct bgp_node *rn, struct bgp_info *ri, u_int32_t flag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_info_unset_flag </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int32_t&#160;</td>
          <td class="paramname"><em>flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00290">290</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, flag);
  
  <span class="comment">/* early bath if we know it&#39;s not a flag that changes useability state */</span>
  <span class="keywordflow">if</span> (!<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (flag, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>|<a class="code" href="bgp__route_8h.html#aee2c962749a7df25a38ccd80559e50d5">BGP_INFO_UNUSEABLE</a>))
    <span class="keywordflow">return</span>;
  
  <a class="code" href="bgp__route_8c.html#af45d15e7f24645ea70bf8f3c8250921d">bgp_pcount_adjust</a> (rn, ri);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a779dd558c9e37130d6ac9029b74cdf12"></a><!-- doxytag: member="bgp_route.c::bgp_input_filter" ref="a779dd558c9e37130d6ac9029b74cdf12" args="(struct peer *peer, struct prefix *p, struct attr *attr, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="filter_8h.html#ab3b7281956317556f846daaebf75de72">filter_type</a> bgp_input_filter </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00526">526</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__filter.html">bgp_filter</a> *<a class="code" href="structfilter.html">filter</a>;

  filter = &amp;peer-&gt;<a class="code" href="structpeer.html#a8ae54829ca91f5860216eb326f264727">filter</a>[afi][safi];

<span class="preprocessor">#define FILTER_EXIST_WARN(F,f,filter) \</span>
<span class="preprocessor">  if (BGP_DEBUG (update, UPDATE_IN) \</span>
<span class="preprocessor">      &amp;&amp; !(F ## _IN (filter))) \</span>
<span class="preprocessor">    plog_warn (peer-&gt;log, &quot;%s: Could not find configured input %s-list %s!&quot;, \</span>
<span class="preprocessor">               peer-&gt;host, #f, F ## _IN_NAME(filter));</span>
<span class="preprocessor"></span>  
  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8h.html#adde5be7d0e3ee93b4cbcdc35c20dcf14">DISTRIBUTE_IN_NAME</a> (filter)) {
    <a class="code" href="bgp__route_8c.html#aad2e59c9369c87c82dfa5675d8d07bd7">FILTER_EXIST_WARN</a>(DISTRIBUTE, <a class="code" href="structdistribute.html">distribute</a>, filter);
      
    <span class="keywordflow">if</span> (<a class="code" href="filter_8c.html#a5565f487c65e2bf0308c7fd529f121a0">access_list_apply</a> (<a class="code" href="distribute_8h.html#a1c0e792c3a3f7fbb843cd4f1a3771b47a68442e4b689f5012c35729e2bc04525a">DISTRIBUTE_IN</a> (filter), p) == <a class="code" href="filter_8h.html#ab3b7281956317556f846daaebf75de72a898abadf6cc2f9d27780782f09d3a3e3">FILTER_DENY</a>)
      <span class="keywordflow">return</span> <a class="code" href="filter_8h.html#ab3b7281956317556f846daaebf75de72a898abadf6cc2f9d27780782f09d3a3e3">FILTER_DENY</a>;
  }

  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8h.html#a633cce0e1ccfb302dd012ef0286ec75a">PREFIX_LIST_IN_NAME</a> (filter)) {
    <a class="code" href="bgp__route_8c.html#aad2e59c9369c87c82dfa5675d8d07bd7">FILTER_EXIST_WARN</a>(PREFIX_LIST, <a class="code" href="structprefix.html">prefix</a>, filter);
    
    <span class="keywordflow">if</span> (<a class="code" href="plist_8c.html#a6fd9bac08d2cb3d2e315d88af146a7f0">prefix_list_apply</a> (<a class="code" href="bgp__route_8h.html#ad143503066e23e446015fc61ba2e72ed">PREFIX_LIST_IN</a> (filter), p) == <a class="code" href="plist_8h.html#a3bda5ec3d1202bc8eb472b4d97633cf9a697cf8d0db0ead308a6ef01301f9543c">PREFIX_DENY</a>)
      <span class="keywordflow">return</span> <a class="code" href="filter_8h.html#ab3b7281956317556f846daaebf75de72a898abadf6cc2f9d27780782f09d3a3e3">FILTER_DENY</a>;
  }
  
  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8h.html#a51c6471831f36ab7819abac5582a83d2">FILTER_LIST_IN_NAME</a> (filter)) {
    <a class="code" href="bgp__route_8c.html#aad2e59c9369c87c82dfa5675d8d07bd7">FILTER_EXIST_WARN</a>(FILTER_LIST, as, filter);
    
    <span class="keywordflow">if</span> (<a class="code" href="bgp__filter_8c.html#a3c54cce31fdf945adf395324469658c5">as_list_apply</a> (<a class="code" href="bgp__route_8h.html#ae97bb21aa1bfa3da36fe31980b840098">FILTER_LIST_IN</a> (filter), attr-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>)== <a class="code" href="bgp__filter_8h.html#a2e45819ce90a8f1b29bad627c87bef8ba5d37f9a4db61d8f7ef503e8582aba781">AS_FILTER_DENY</a>)
      <span class="keywordflow">return</span> <a class="code" href="filter_8h.html#ab3b7281956317556f846daaebf75de72a898abadf6cc2f9d27780782f09d3a3e3">FILTER_DENY</a>;
  }
  
  <span class="keywordflow">return</span> <a class="code" href="filter_8h.html#ab3b7281956317556f846daaebf75de72a68ef3d4c373520eb5b085236bf4eeef8">FILTER_PERMIT</a>;
<span class="preprocessor">#undef FILTER_EXIST_WARN</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="a2f762007f1c8ecfd0a06a8430d1e0523"></a><!-- doxytag: member="bgp_route.c::bgp_input_modifier" ref="a2f762007f1c8ecfd0a06a8430d1e0523" args="(struct peer *peer, struct prefix *p, struct attr *attr, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_input_modifier </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00647">647</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__filter.html">bgp_filter</a> *<a class="code" href="structfilter.html">filter</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> info;
  <a class="code" href="routemap_8h.html#afd7345bfd662f1e7c77f0be351cd1516">route_map_result_t</a> ret;

  filter = &amp;peer-&gt;<a class="code" href="structpeer.html#a8ae54829ca91f5860216eb326f264727">filter</a>[afi][safi];

  <span class="comment">/* Apply default weight value. */</span>
  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a5ea7f188c91db8c725332db353677b02">weight</a>)
    (<a class="code" href="bgp__attr_8c.html#a31ef3828cd7a1375f7b7dfe02aab705f">bgp_attr_extra_get</a> (attr))-&gt;weight = peer-&gt;<a class="code" href="structpeer.html#a5ea7f188c91db8c725332db353677b02">weight</a>;

  <span class="comment">/* Route map apply. */</span>
  if (<a class="code" href="bgp__route_8h.html#a7ce451237d01fbec8276be12dd5355dc">ROUTE_MAP_IN_NAME</a> (filter))
    {
      <span class="comment">/* Duplicate current value to new strucutre for modification. */</span>
      info.peer = <a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>;
      info.attr = <a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>;

      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a>, <a class="code" href="bgpd_8h.html#ac0c69451f1b38928f7e90bbf7ea7f2df">PEER_RMAP_TYPE_IN</a>); 

      <span class="comment">/* Apply BGP route map to the attribute. */</span>
      ret = <a class="code" href="routemap_8c.html#a3372553a024332702cfd603e1f4c08d6">route_map_apply</a> (<a class="code" href="bgp__route_8h.html#ac48b58884ad8f80b21a9e116ce3097f8">ROUTE_MAP_IN</a> (filter), p, <a class="code" href="routemap_8h.html#ae21439463f873ce0ce1556c9d6fa7370adcb3bc0f6448923a387dfe3658ca7bda">RMAP_BGP</a>, &amp;info);

      peer-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a> = 0;

      <span class="keywordflow">if</span> (ret == <a class="code" href="routemap_8h.html#afd7345bfd662f1e7c77f0be351cd1516aa0f40f0a91e43bfe7131839fe179ac64">RMAP_DENYMATCH</a>)
    {
      <span class="comment">/* Free newly generated AS path and community by route-map. */</span>
      <a class="code" href="bgp__attr_8c.html#a3ea9ed94bcd0236f8f83310615e7c022">bgp_attr_flush</a> (attr);
      <span class="keywordflow">return</span> <a class="code" href="routemap_8h.html#a57b0063c49d180ad8b9d19ae35d7e644ad79be2f4afd690ef956924415e6724bf">RMAP_DENY</a>;
    }
    }
  <span class="keywordflow">return</span> <a class="code" href="routemap_8h.html#a57b0063c49d180ad8b9d19ae35d7e644aa7d1859ac879fafcd59953ee1e27b134">RMAP_PERMIT</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ace201bd3f5b8b07afc5143b88a179c55"></a><!-- doxytag: member="bgp_route.c::bgp_maximum_prefix_overflow" ref="ace201bd3f5b8b07afc5143b88a179c55" args="(struct peer *peer, afi_t afi, safi_t safi, int always)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_maximum_prefix_overflow </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>always</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01684">1684</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (!<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a710895028dd35954651499aabaaadd8f">PEER_FLAG_MAX_PREFIX</a>))
    <span class="keywordflow">return</span> 0;

  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ad330ebcaa29077b76720f2d62f36dc24">pcount</a>[afi][safi] &gt; peer-&gt;<a class="code" href="structpeer.html#ac8db3cf3b014af5c13a5fdd81aa308dc">pmax</a>[afi][safi])
    {
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a9ffcb5ccd61d7cdd5809ff789a5f3ee6">PEER_STATUS_PREFIX_LIMIT</a>)
         &amp;&amp; ! always)
       <span class="keywordflow">return</span> 0;

      <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_INFO,
        <span class="stringliteral">&quot;%%MAXPFXEXCEED: No. of %s prefix received from %s %ld exceed, &quot;</span>
        <span class="stringliteral">&quot;limit %ld&quot;</span>, <a class="code" href="bgp__vty_8c.html#a12e00d9262b9e4efc00b5f1216541967">afi_safi_print</a> (afi, safi), peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
        peer-&gt;<a class="code" href="structpeer.html#ad330ebcaa29077b76720f2d62f36dc24">pcount</a>[afi][safi], peer-&gt;<a class="code" href="structpeer.html#ac8db3cf3b014af5c13a5fdd81aa308dc">pmax</a>[afi][safi]);
      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a9ffcb5ccd61d7cdd5809ff789a5f3ee6">PEER_STATUS_PREFIX_LIMIT</a>);

      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#accd30eb7914fa9da016163a7679278e2">PEER_FLAG_MAX_PREFIX_WARNING</a>))
       <span class="keywordflow">return</span> 0;

      {
       u_int8_t ndata[7];

       <span class="keywordflow">if</span> (safi == <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
         safi = <a class="code" href="bgpd_8h.html#a597e9437c3d1c7d5551d8232a70e89ae">BGP_SAFI_VPNV4</a>;
         
       ndata[0] = (afi &gt;&gt;  8);
       ndata[1] = afi;
       ndata[2] = safi;
       ndata[3] = (peer-&gt;<a class="code" href="structpeer.html#ac8db3cf3b014af5c13a5fdd81aa308dc">pmax</a>[afi][safi] &gt;&gt; 24);
       ndata[4] = (peer-&gt;<a class="code" href="structpeer.html#ac8db3cf3b014af5c13a5fdd81aa308dc">pmax</a>[afi][safi] &gt;&gt; 16);
       ndata[5] = (peer-&gt;<a class="code" href="structpeer.html#ac8db3cf3b014af5c13a5fdd81aa308dc">pmax</a>[afi][safi] &gt;&gt; 8);
       ndata[6] = (peer-&gt;<a class="code" href="structpeer.html#ac8db3cf3b014af5c13a5fdd81aa308dc">pmax</a>[afi][safi]);

       <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#a6df26783180e94b98072394c3c19e11b">PEER_STATUS_PREFIX_OVERFLOW</a>);
       <a class="code" href="bgp__packet_8c.html#a451c099a790874d1bca55ccb2c4a4057">bgp_notify_send_with_data</a> (peer, <a class="code" href="bgpd_8h.html#a3c020cba1f9b12568599a3eb7c979b09">BGP_NOTIFY_CEASE</a>,
                                  <a class="code" href="bgpd_8h.html#abcf95c6082bef31695fe404a22ff070c">BGP_NOTIFY_CEASE_MAX_PREFIX</a>, ndata, 7);
      }

      <span class="comment">/* restart timer start */</span>
      <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#a96573836a6d4f851ce15a2f8608e7298">pmax_restart</a>[afi][safi])
    {
      peer-&gt;<a class="code" href="structpeer.html#a5fd66e2c0a312e45d6eb755d4025ffd2">v_pmax_restart</a> = peer-&gt;<a class="code" href="structpeer.html#a96573836a6d4f851ce15a2f8608e7298">pmax_restart</a>[afi][safi] * 60;

      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (events, EVENTS))
        <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s Maximum-prefix restart timer started for %d secs&quot;</span>,
            peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, peer-&gt;<a class="code" href="structpeer.html#a5fd66e2c0a312e45d6eb755d4025ffd2">v_pmax_restart</a>);

      <a class="code" href="bgp__fsm_8h.html#aaf9fcd8314ca70eef21f5689423d7152">BGP_TIMER_ON</a> (peer-&gt;<a class="code" href="structpeer.html#ae4340980236449843f55d04b3ad4bf7e">t_pmax_restart</a>, <a class="code" href="bgp__route_8c.html#aa5fa9e55ce4581d5456d115a3f0a38a6">bgp_maximum_prefix_restart_timer</a>,
            peer-&gt;<a class="code" href="structpeer.html#a5fd66e2c0a312e45d6eb755d4025ffd2">v_pmax_restart</a>);
    }

      <span class="keywordflow">return</span> 1;
    }
  <span class="keywordflow">else</span>
    <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a9ffcb5ccd61d7cdd5809ff789a5f3ee6">PEER_STATUS_PREFIX_LIMIT</a>);

  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ad330ebcaa29077b76720f2d62f36dc24">pcount</a>[afi][safi] &gt; (peer-&gt;<a class="code" href="structpeer.html#ac8db3cf3b014af5c13a5fdd81aa308dc">pmax</a>[afi][safi] * peer-&gt;<a class="code" href="structpeer.html#a197807bc5b1ad8f1ab100bca6e8d5227">pmax_threshold</a>[afi][safi] / 100))
    {
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a8ad5053ef329eaa221d650cdda116b61">PEER_STATUS_PREFIX_THRESHOLD</a>)
         &amp;&amp; ! always)
       <span class="keywordflow">return</span> 0;

      <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_INFO,
        <span class="stringliteral">&quot;%%MAXPFX: No. of %s prefix received from %s reaches %ld, max %ld&quot;</span>,
        <a class="code" href="bgp__vty_8c.html#a12e00d9262b9e4efc00b5f1216541967">afi_safi_print</a> (afi, safi), peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, peer-&gt;<a class="code" href="structpeer.html#ad330ebcaa29077b76720f2d62f36dc24">pcount</a>[afi][safi],
        peer-&gt;<a class="code" href="structpeer.html#ac8db3cf3b014af5c13a5fdd81aa308dc">pmax</a>[afi][safi]);
      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a8ad5053ef329eaa221d650cdda116b61">PEER_STATUS_PREFIX_THRESHOLD</a>);
    }
  <span class="keywordflow">else</span>
    <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a8ad5053ef329eaa221d650cdda116b61">PEER_STATUS_PREFIX_THRESHOLD</a>);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa5fa9e55ce4581d5456d115a3f0a38a6"></a><!-- doxytag: member="bgp_route.c::bgp_maximum_prefix_restart_timer" ref="aa5fa9e55ce4581d5456d115a3f0a38a6" args="(struct thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_maximum_prefix_restart_timer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthread.html">thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01667">1667</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *<a class="code" href="structpeer.html">peer</a>;

  peer = <a class="code" href="thread_8h.html#a78f2ae47a7a334f7f74bfed7fda48e5a">THREAD_ARG</a> (thread);
  peer-&gt;<a class="code" href="structpeer.html#ae4340980236449843f55d04b3ad4bf7e">t_pmax_restart</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;

  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (events, EVENTS))
    <a class="code" href="log_8h.html#af1f70c8ab8e089840180553abf361296">zlog_debug</a> (<span class="stringliteral">&quot;%s Maximum-prefix restart timer expired, restore peering&quot;</span>,
        peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);

  <a class="code" href="bgpd_8c.html#aeaa590e7313d03ba1c7418ca2016bf90">peer_clear</a> (peer);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a58dff46a744315de3961a85990be81c9"></a><!-- doxytag: member="bgp_route.c::bgp_med_value" ref="a58dff46a744315de3961a85990be81c9" args="(struct attr *attr, struct bgp *bgp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static u_int32_t bgp_med_value </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00304">304</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (attr-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp; <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#a2f0c3d68f255eba5612c46147522334e">BGP_ATTR_MULTI_EXIT_DISC</a>))
    <span class="keywordflow">return</span> attr-&gt;<a class="code" href="structattr.html#a2dc4bc77a20816cd457a2040b05e316f">med</a>;
  <span class="keywordflow">else</span>
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#a0b3388d8ac73af2d4f4f22e46746da1e">bgp_flag_check</a> (bgp, <a class="code" href="bgpd_8h.html#af7ddec77890c22a31bb91af392832b15">BGP_FLAG_MED_MISSING_AS_WORST</a>))
    <span class="keywordflow">return</span> <a class="code" href="bgp__attr_8h.html#afd4e8f98deac933c51048df75bf14c22">BGP_MED_MAX</a>;
      <span class="keywordflow">else</span>
    <span class="keywordflow">return</span> 0;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1d7233eea42c8d4eeb9470fe30e42fed"></a><!-- doxytag: member="bgp_route.c::bgp_nlri_parse" ref="a1d7233eea42c8d4eeb9470fe30e42fed" args="(struct peer *peer, struct attr *attr, struct bgp_nlri *packet)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_nlri_parse </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__nlri.html">bgp_nlri</a> *&#160;</td>
          <td class="paramname"><em>packet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03011">3011</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  u_char *pnt;
  u_char *lim;
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
  <span class="keywordtype">int</span> psize;
  <span class="keywordtype">int</span> ret;

  <span class="comment">/* Check peer status. */</span>
  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a> != <a class="code" href="bgpd_8h.html#aa87809ec7dea97b0e970e98ae6c181ea">Established</a>)
    <span class="keywordflow">return</span> 0;
  
  pnt = packet-&gt;<a class="code" href="structbgp__nlri.html#ac43e135107260206f2a30593371aece1">nlri</a>;
  lim = pnt + packet-&gt;<a class="code" href="structbgp__nlri.html#a662dc7e55e55b2e5be5ebd9ff15099d1">length</a>;

  <span class="keywordflow">for</span> (; pnt &lt; lim; pnt += psize)
    {
      <span class="comment">/* Clear prefix structure. */</span>
      memset (&amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a>));

      <span class="comment">/* Fetch prefix length. */</span>
      <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.prefixlen = *pnt++;
      <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.family = <a class="code" href="prefix_8c.html#a6d5ede437568763fc6ef7d9cc772b501">afi2family</a> (packet-&gt;<a class="code" href="structbgp__nlri.html#aedf0c19c8fb1ee0a65829add11add119">afi</a>);
      
      <span class="comment">/* Already checked in nlri_sanity_check().  We do double check</span>
<span class="comment">         here. */</span>
      <span class="keywordflow">if</span> ((packet-&gt;<a class="code" href="structbgp__nlri.html#aedf0c19c8fb1ee0a65829add11add119">afi</a> == <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> &amp;&amp; <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.prefixlen &gt; 32)
      || (packet-&gt;<a class="code" href="structbgp__nlri.html#aedf0c19c8fb1ee0a65829add11add119">afi</a> == <a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a> &amp;&amp; <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.prefixlen &gt; 128))
    <span class="keywordflow">return</span> -1;

      <span class="comment">/* Packet size overflow check. */</span>
      psize = <a class="code" href="bgpd_8h.html#a472145011d944606a257487e80cc3ace">PSIZE</a> (<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.prefixlen);

      <span class="comment">/* When packet overflow occur return immediately. */</span>
      <span class="keywordflow">if</span> (pnt + psize &gt; lim)
    <span class="keywordflow">return</span> -1;

      <span class="comment">/* Fetch prefix from NLRI packet. */</span>
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (&amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.u.prefix, pnt, psize);

      <span class="comment">/* Check address. */</span>
      <span class="keywordflow">if</span> (packet-&gt;<a class="code" href="structbgp__nlri.html#aedf0c19c8fb1ee0a65829add11add119">afi</a> == <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> &amp;&amp; packet-&gt;<a class="code" href="structbgp__nlri.html#ae560c9d1471ea79e34fb7e4233afb64a">safi</a> == <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>)
    {
      <span class="keywordflow">if</span> (IN_CLASSD (ntohl (<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.u.prefix4.s_addr)))
        {
         <span class="comment">/* </span>
<span class="comment">          * From draft-ietf-idr-bgp4-22, Section 6.3: </span>
<span class="comment">          * If a BGP router receives an UPDATE message with a</span>
<span class="comment">          * semantically incorrect NLRI field, in which a prefix is</span>
<span class="comment">          * semantically incorrect (eg. an unexpected multicast IP</span>
<span class="comment">          * address), it should ignore the prefix.</span>
<span class="comment">          */</span>
          <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_ERR, 
            <span class="stringliteral">&quot;IPv4 unicast NLRI is multicast address %s&quot;</span>,
            inet_ntoa (<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.u.prefix4));

          <span class="keywordflow">return</span> -1;
        }
    }

<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>      <span class="comment">/* Check address. */</span>
      <span class="keywordflow">if</span> (packet-&gt;<a class="code" href="structbgp__nlri.html#aedf0c19c8fb1ee0a65829add11add119">afi</a> == <a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a> &amp;&amp; packet-&gt;<a class="code" href="structbgp__nlri.html#ae560c9d1471ea79e34fb7e4233afb64a">safi</a> == <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>)
    {
      <span class="keywordflow">if</span> (IN6_IS_ADDR_LINKLOCAL (&amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.u.prefix6))
        {
          <span class="keywordtype">char</span> buf[BUFSIZ];

          <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_WARNING, 
            <span class="stringliteral">&quot;IPv6 link-local NLRI received %s ignore this NLRI&quot;</span>,
            <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (AF_INET6, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.u.prefix6, buf, BUFSIZ));

          <span class="keywordflow">continue</span>;
        }
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

      <span class="comment">/* Normal process. */</span>
      <span class="keywordflow">if</span> (attr)
    ret = <a class="code" href="bgp__route_8c.html#adead0e338559e1bf15f14c261fbe975d">bgp_update</a> (peer, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, attr, packet-&gt;<a class="code" href="structbgp__nlri.html#aedf0c19c8fb1ee0a65829add11add119">afi</a>, packet-&gt;<a class="code" href="structbgp__nlri.html#ae560c9d1471ea79e34fb7e4233afb64a">safi</a>, 
              <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a>, <a class="code" href="bgp__route_8h.html#a4734a795191347f5279e59e64c75b7a3">BGP_ROUTE_NORMAL</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);
      <span class="keywordflow">else</span>
    ret = <a class="code" href="bgp__route_8c.html#a1e246b33bc776aab326a127170921d6d">bgp_withdraw</a> (peer, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, attr, packet-&gt;<a class="code" href="structbgp__nlri.html#aedf0c19c8fb1ee0a65829add11add119">afi</a>, packet-&gt;<a class="code" href="structbgp__nlri.html#ae560c9d1471ea79e34fb7e4233afb64a">safi</a>, 
                <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a>, <a class="code" href="bgp__route_8h.html#a4734a795191347f5279e59e64c75b7a3">BGP_ROUTE_NORMAL</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);

      <span class="comment">/* Address family configuration mismatch or maximum-prefix count</span>
<span class="comment">         overflow. */</span>
      <span class="keywordflow">if</span> (ret &lt; 0)
    <span class="keywordflow">return</span> -1;
    }

  <span class="comment">/* Packet length consistency check. */</span>
  <span class="keywordflow">if</span> (pnt != lim)
    <span class="keywordflow">return</span> -1;

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae571d879d9e98f7737dc129b7b90b413"></a><!-- doxytag: member="bgp_route.c::bgp_nlri_sanity_check" ref="ae571d879d9e98f7737dc129b7b90b413" args="(struct peer *peer, int afi, u_char *pnt, bgp_size_t length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_nlri_sanity_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>pnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="bgpd_8h.html#ae2ac1a1db99d420f5a214c418552fd1e">bgp_size_t</a>&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03111">3111</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  u_char *end;
  u_char <a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>;
  <span class="keywordtype">int</span> psize;

  end = pnt + <a class="code" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a>;

  <span class="comment">/* RFC1771 6.3 The NLRI field in the UPDATE message is checked for</span>
<span class="comment">     syntactic validity.  If the field is syntactically incorrect,</span>
<span class="comment">     then the Error Subcode is set to Invalid Network Field. */</span>

  <span class="keywordflow">while</span> (pnt &lt; end)
    {
      prefixlen = *pnt++;
      
      <span class="comment">/* Prefix length check. */</span>
      <span class="keywordflow">if</span> ((afi == <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> &amp;&amp; prefixlen &gt; 32)
      || (afi == <a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a> &amp;&amp; prefixlen &gt; 128))
    {
      <a class="code" href="log_8h.html#a4dac9f1d742f56610c76fb86e160a28f">plog_err</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, 
            <span class="stringliteral">&quot;%s [Error] Update packet error (wrong prefix length %d)&quot;</span>,
            peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, prefixlen);
      <a class="code" href="bgp__packet_8c.html#ac17989ee6afabce09c9d326fbbf6607b">bgp_notify_send</a> (peer, <a class="code" href="bgpd_8h.html#aa66406351b4bf5ff750eda7a70dfdfcb">BGP_NOTIFY_UPDATE_ERR</a>, 
               <a class="code" href="bgpd_8h.html#a80701bbe52975406ae4c176b89a9c5c3">BGP_NOTIFY_UPDATE_INVAL_NETWORK</a>);
      <span class="keywordflow">return</span> -1;
    }

      <span class="comment">/* Packet size overflow check. */</span>
      psize = <a class="code" href="bgpd_8h.html#a472145011d944606a257487e80cc3ace">PSIZE</a> (prefixlen);

      <span class="keywordflow">if</span> (pnt + psize &gt; end)
    {
      <a class="code" href="log_8h.html#a4dac9f1d742f56610c76fb86e160a28f">plog_err</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, 
            <span class="stringliteral">&quot;%s [Error] Update packet error&quot;</span>
            <span class="stringliteral">&quot; (prefix data overflow prefix size is %d)&quot;</span>,
            peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, psize);
      <a class="code" href="bgp__packet_8c.html#ac17989ee6afabce09c9d326fbbf6607b">bgp_notify_send</a> (peer, <a class="code" href="bgpd_8h.html#aa66406351b4bf5ff750eda7a70dfdfcb">BGP_NOTIFY_UPDATE_ERR</a>, 
               <a class="code" href="bgpd_8h.html#a80701bbe52975406ae4c176b89a9c5c3">BGP_NOTIFY_UPDATE_INVAL_NETWORK</a>);
      <span class="keywordflow">return</span> -1;
    }

      pnt += psize;
    }

  <span class="comment">/* Packet length consistency check. */</span>
  <span class="keywordflow">if</span> (pnt != end)
    {
      <a class="code" href="log_8h.html#a4dac9f1d742f56610c76fb86e160a28f">plog_err</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>,
        <span class="stringliteral">&quot;%s [Error] Update packet error&quot;</span>
        <span class="stringliteral">&quot; (prefix length mismatch with total length)&quot;</span>,
        peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
      <a class="code" href="bgp__packet_8c.html#ac17989ee6afabce09c9d326fbbf6607b">bgp_notify_send</a> (peer, <a class="code" href="bgpd_8h.html#aa66406351b4bf5ff750eda7a70dfdfcb">BGP_NOTIFY_UPDATE_ERR</a>, 
               <a class="code" href="bgpd_8h.html#a80701bbe52975406ae4c176b89a9c5c3">BGP_NOTIFY_UPDATE_INVAL_NETWORK</a>);
      <span class="keywordflow">return</span> -1;
    }
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a964b57dc2ca2170b988ca239878a9118"></a><!-- doxytag: member="bgp_route.c::bgp_output_filter" ref="a964b57dc2ca2170b988ca239878a9118" args="(struct peer *peer, struct prefix *p, struct attr *attr, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="filter_8h.html#ab3b7281956317556f846daaebf75de72">filter_type</a> bgp_output_filter </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00565">565</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__filter.html">bgp_filter</a> *<a class="code" href="structfilter.html">filter</a>;

  filter = &amp;peer-&gt;<a class="code" href="structpeer.html#a8ae54829ca91f5860216eb326f264727">filter</a>[afi][safi];

<span class="preprocessor">#define FILTER_EXIST_WARN(F,f,filter) \</span>
<span class="preprocessor">  if (BGP_DEBUG (update, UPDATE_OUT) \</span>
<span class="preprocessor">      &amp;&amp; !(F ## _OUT (filter))) \</span>
<span class="preprocessor">    plog_warn (peer-&gt;log, &quot;%s: Could not find configured output %s-list %s!&quot;, \</span>
<span class="preprocessor">               peer-&gt;host, #f, F ## _OUT_NAME(filter));</span>
<span class="preprocessor"></span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8h.html#aa6a662c312c62895639e9bdb1acb86c4">DISTRIBUTE_OUT_NAME</a> (filter)) {
    <a class="code" href="bgp__route_8c.html#aad2e59c9369c87c82dfa5675d8d07bd7">FILTER_EXIST_WARN</a>(DISTRIBUTE, <a class="code" href="structdistribute.html">distribute</a>, filter);
    
    <span class="keywordflow">if</span> (<a class="code" href="filter_8c.html#a5565f487c65e2bf0308c7fd529f121a0">access_list_apply</a> (<a class="code" href="distribute_8h.html#a1c0e792c3a3f7fbb843cd4f1a3771b47aa34d81eff0dbfb4b601611cb69ffd894">DISTRIBUTE_OUT</a> (filter), p) == <a class="code" href="filter_8h.html#ab3b7281956317556f846daaebf75de72a898abadf6cc2f9d27780782f09d3a3e3">FILTER_DENY</a>)
      <span class="keywordflow">return</span> <a class="code" href="filter_8h.html#ab3b7281956317556f846daaebf75de72a898abadf6cc2f9d27780782f09d3a3e3">FILTER_DENY</a>;
  }

  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8h.html#a0b2a78984ce18b840dba34e64295c2cf">PREFIX_LIST_OUT_NAME</a> (filter)) {
    <a class="code" href="bgp__route_8c.html#aad2e59c9369c87c82dfa5675d8d07bd7">FILTER_EXIST_WARN</a>(PREFIX_LIST, <a class="code" href="structprefix.html">prefix</a>, filter);
    
    <span class="keywordflow">if</span> (<a class="code" href="plist_8c.html#a6fd9bac08d2cb3d2e315d88af146a7f0">prefix_list_apply</a> (<a class="code" href="bgp__route_8h.html#ab694ea0ccae4db3b7e858c2517e41480">PREFIX_LIST_OUT</a> (filter), p) == <a class="code" href="plist_8h.html#a3bda5ec3d1202bc8eb472b4d97633cf9a697cf8d0db0ead308a6ef01301f9543c">PREFIX_DENY</a>)
      <span class="keywordflow">return</span> <a class="code" href="filter_8h.html#ab3b7281956317556f846daaebf75de72a898abadf6cc2f9d27780782f09d3a3e3">FILTER_DENY</a>;
  }

  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8h.html#a806f03b22742b30b320bcb6bfdbbbb80">FILTER_LIST_OUT_NAME</a> (filter)) {
    <a class="code" href="bgp__route_8c.html#aad2e59c9369c87c82dfa5675d8d07bd7">FILTER_EXIST_WARN</a>(FILTER_LIST, as, filter);
    
    <span class="keywordflow">if</span> (<a class="code" href="bgp__filter_8c.html#a3c54cce31fdf945adf395324469658c5">as_list_apply</a> (<a class="code" href="bgp__route_8h.html#aa5c389065b014b5737f4a216a708b361">FILTER_LIST_OUT</a> (filter), attr-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>) == <a class="code" href="bgp__filter_8h.html#a2e45819ce90a8f1b29bad627c87bef8ba5d37f9a4db61d8f7ef503e8582aba781">AS_FILTER_DENY</a>)
      <span class="keywordflow">return</span> <a class="code" href="filter_8h.html#ab3b7281956317556f846daaebf75de72a898abadf6cc2f9d27780782f09d3a3e3">FILTER_DENY</a>;
  }

  <span class="keywordflow">return</span> <a class="code" href="filter_8h.html#ab3b7281956317556f846daaebf75de72a68ef3d4c373520eb5b085236bf4eeef8">FILTER_PERMIT</a>;
<span class="preprocessor">#undef FILTER_EXIST_WARN</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="a45bb68a5cf818ba7d1921baf0e62ccf2"></a><!-- doxytag: member="bgp_route.c::bgp_pathlimit_update_parents" ref="a45bb68a5cf818ba7d1921baf0e62ccf2" args="(struct bgp *bgp, struct bgp_node *rn, int ttl_edge)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_pathlimit_update_parents </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ttl_edge</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03630">3630</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *<a class="code" href="dict_8c.html#a9d4418feaea5490d8afb9c25c34fba4d">parent</a> = rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__static.html">bgp_static</a> *sp;
  
  <span class="comment">/* Existing static changed TTL, search parents and adjust their atomic */</span>
  <span class="keywordflow">while</span> ((parent = parent-&gt;<a class="code" href="structbgp__node.html#aeb3ba76fb854c9f44319abd9babf6ccf">parent</a>))
    <span class="keywordflow">if</span> ((sp = parent-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>))
      {
        <span class="keywordtype">int</span> sp_level = (sp-&gt;<a class="code" href="structbgp__static.html#ab4d379ac74eae4070e11b425e938a0e8">atomic</a> ? 1 : 0);
        ttl_edge ? sp-&gt;<a class="code" href="structbgp__static.html#ab4d379ac74eae4070e11b425e938a0e8">atomic</a>++ : sp-&gt;<a class="code" href="structbgp__static.html#ab4d379ac74eae4070e11b425e938a0e8">atomic</a>--;
        
        <span class="comment">/* did we change state of parent whether atomic is set or not? */</span>
        <span class="keywordflow">if</span> (sp_level != (sp-&gt;<a class="code" href="structbgp__static.html#ab4d379ac74eae4070e11b425e938a0e8">atomic</a> ? 1 : 0))
          {
            <a class="code" href="bgp__route_8c.html#abbcc2b564375f6ab82f7622042f4c69f">bgp_static_update</a> (bgp, &amp;parent-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>, sp,
                               rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>, rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>);
          }
      }
}
</pre></div>
</div>
</div>
<a class="anchor" id="af45d15e7f24645ea70bf8f3c8250921d"></a><!-- doxytag: member="bgp_route.c::bgp_pcount_adjust" ref="af45d15e7f24645ea70bf8f3c8250921d" args="(struct bgp_node *rn, struct bgp_info *ri)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_pcount_adjust </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>ri</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l00238">238</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (rn &amp;&amp; rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>);
  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (ri &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>);

  <span class="comment">/* Ignore &#39;pcount&#39; for RS-client tables */</span>
  <span class="keywordflow">if</span> (rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a5099bb3c9ff5831a90846db78724e652">type</a> != <a class="code" href="bgp__table_8h.html#a90f263bf84e91fb0b40f10d94c2baafbaefb8ffd61daca8861e9af4bb3c274b3e">BGP_TABLE_MAIN</a>
      || ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> == ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>)
    <span class="keywordflow">return</span>;
    
  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8h.html#a51bf9498518258866f4ba6b2b19b587a">BGP_INFO_HOLDDOWN</a> (ri)
      &amp;&amp; <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#aff6e02f7d4d370e90e7eba7323b7f335">BGP_INFO_COUNTED</a>))
    {
          
      <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#aff6e02f7d4d370e90e7eba7323b7f335">BGP_INFO_COUNTED</a>);
      
      <span class="comment">/* slight hack, but more robust against errors. */</span>
      <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#ad330ebcaa29077b76720f2d62f36dc24">pcount</a>[rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>][rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>])
        ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#ad330ebcaa29077b76720f2d62f36dc24">pcount</a>[rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>][rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>]--;
      <span class="keywordflow">else</span>
        {
          <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;%s: Asked to decrement 0 prefix count for peer %s&quot;</span>,
                     __func__, ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
          <a class="code" href="log_8c.html#a007e475475f7a96147bbb4315b58bb2e">zlog_backtrace</a> (LOG_WARNING);
          <a class="code" href="log_8h.html#a4a2ed409bf1559d9ea3c664f70420df7">zlog_warn</a> (<span class="stringliteral">&quot;%s: Please report to Quagga bugzilla&quot;</span>, __func__);
        }      
    }
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="bgp__route_8h.html#a51bf9498518258866f4ba6b2b19b587a">BGP_INFO_HOLDDOWN</a> (ri) 
           &amp;&amp; !<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#aff6e02f7d4d370e90e7eba7323b7f335">BGP_INFO_COUNTED</a>))
    {
      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#aff6e02f7d4d370e90e7eba7323b7f335">BGP_INFO_COUNTED</a>);
      ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>-&gt;<a class="code" href="structpeer.html#ad330ebcaa29077b76720f2d62f36dc24">pcount</a>[rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>][rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>]++;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3c1be470ddb0d83d2cda73f8e4fa1f88"></a><!-- doxytag: member="bgp_route.c::bgp_process" ref="a3c1be470ddb0d83d2cda73f8e4fa1f88" args="(struct bgp *bgp, struct bgp_node *rn, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_process </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01628">1628</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__process__queue.html">bgp_process_queue</a> *pqnode;
  
  <span class="comment">/* already scheduled for processing? */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (rn-&gt;<a class="code" href="structbgp__node.html#a1369def83e1b7e96e76aa05f1c1bb5c8">flags</a>, <a class="code" href="bgp__table_8h.html#a89387d13426993997af6b2cc02600f12">BGP_NODE_PROCESS_SCHEDULED</a>))
    <span class="keywordflow">return</span>;
  
  <span class="keywordflow">if</span> ( (<a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ae83b822ff500e553698ebb24c6940b5b">process_main_queue</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
       (<a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#a312c8497537347c02ac02b28efc0764b">process_rsclient_queue</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) )
    <a class="code" href="bgp__route_8c.html#a6b080892b6ca3f0108ab232772574a3f">bgp_process_queue_init</a> ();
  
  pqnode = <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba4db5edc8be06ce399a3625397401960f">MTYPE_BGP_PROCESS_QUEUE</a>, 
                    <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structbgp__process__queue.html">bgp_process_queue</a>));
  <span class="keywordflow">if</span> (!pqnode)
    <span class="keywordflow">return</span>;

  <span class="comment">/* all unlocked in bgp_processq_del */</span>
  <a class="code" href="bgp__table_8c.html#a31e5a9590da2ec7f671d9014a714a885">bgp_table_lock</a> (rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>);
  pqnode-&gt;<a class="code" href="structbgp__process__queue.html#abf324bfeb9698771f6582fd36f20b916">rn</a> = <a class="code" href="bgp__table_8c.html#a8c629ca0214d269ce20f39268b9196d7">bgp_lock_node</a> (rn);
  pqnode-&gt;<a class="code" href="structbgp__process__queue.html#a9afd710e5c43ffcfebd9e448ede1ac3f">bgp</a> = <a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
  <a class="code" href="bgpd_8c.html#a94fe8d4b7a275b31df04f8a46ab1ac37">bgp_lock</a> (bgp);
  pqnode-&gt;<a class="code" href="structbgp__process__queue.html#aab23ff9ce503d676a383be8d9b456430">afi</a> = <a class="code" href="structbgp__process__queue.html#aab23ff9ce503d676a383be8d9b456430">afi</a>;
  pqnode-&gt;<a class="code" href="structbgp__process__queue.html#aaf6f5846c4654daf55532d4cdc63ccd8">safi</a> = <a class="code" href="structbgp__process__queue.html#aaf6f5846c4654daf55532d4cdc63ccd8">safi</a>;
  
  <span class="keywordflow">switch</span> (rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a5099bb3c9ff5831a90846db78724e652">type</a>)
    {
      <span class="keywordflow">case</span> <a class="code" href="bgp__table_8h.html#a90f263bf84e91fb0b40f10d94c2baafbaefb8ffd61daca8861e9af4bb3c274b3e">BGP_TABLE_MAIN</a>:
        <a class="code" href="workqueue_8c.html#a193fb769a4d04f3c160c623fd07dfb21">work_queue_add</a> (<a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ae83b822ff500e553698ebb24c6940b5b">process_main_queue</a>, pqnode);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <a class="code" href="bgp__table_8h.html#a90f263bf84e91fb0b40f10d94c2baafba5af83960b1c7e199dbe0cc6392a5e2b0">BGP_TABLE_RSCLIENT</a>:
        <a class="code" href="workqueue_8c.html#a193fb769a4d04f3c160c623fd07dfb21">work_queue_add</a> (<a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#a312c8497537347c02ac02b28efc0764b">process_rsclient_queue</a>, pqnode);
        <span class="keywordflow">break</span>;
    }
  
  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a68f69dcd72afe7aeb53608418fc55385"></a><!-- doxytag: member="bgp_route.c::bgp_process_announce_selected" ref="a68f69dcd72afe7aeb53608418fc55385" args="(struct peer *peer, struct bgp_info *selected, struct bgp_node *rn, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_process_announce_selected </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>selected</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01401">1401</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
  <span class="keyword">struct </span><a class="code" href="structattr.html">attr</a> <a class="code" href="structattr.html">attr</a> = { 0 };

  p = &amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>;

  <span class="comment">/* Announce route to Established peer. */</span>
  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a> != <a class="code" href="bgpd_8h.html#aa87809ec7dea97b0e970e98ae6c181ea">Established</a>)
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* Address family configuration check. */</span>
  <span class="keywordflow">if</span> (! peer-&gt;<a class="code" href="structpeer.html#a08da0f40c72c2016e659539e6af6dc2d">afc_nego</a>[afi][safi])
    <span class="keywordflow">return</span> 0;

  <span class="comment">/* First update is deferred until ORF or ROUTE-REFRESH is received */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ab49d7e30a6869bf9f0753afe25b17c6a">af_sflags</a>[afi][safi],
      <a class="code" href="bgpd_8h.html#af38b3d01fa7faa6698e76d7932ff717f">PEER_STATUS_ORF_WAIT_REFRESH</a>))
    <span class="keywordflow">return</span> 0;

  <span class="keywordflow">switch</span> (rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a5099bb3c9ff5831a90846db78724e652">type</a>)
    {
      <span class="keywordflow">case</span> <a class="code" href="bgp__table_8h.html#a90f263bf84e91fb0b40f10d94c2baafbaefb8ffd61daca8861e9af4bb3c274b3e">BGP_TABLE_MAIN</a>:
      <span class="comment">/* Announcement to peer-&gt;conf.  If the route is filtered,</span>
<span class="comment">         withdraw it. */</span>
        <span class="keywordflow">if</span> (selected &amp;&amp; <a class="code" href="bgp__route_8c.html#a7a3b743168235f6f62a99f82c20fcdf1">bgp_announce_check</a> (selected, peer, p, &amp;attr, afi, safi))
          <a class="code" href="bgp__advertise_8c.html#a3a40b0a670f7854055d71517f5ede018">bgp_adj_out_set</a> (rn, peer, p, &amp;attr, afi, safi, selected);
        <span class="keywordflow">else</span>
          <a class="code" href="bgp__advertise_8c.html#adbc62e0dd99f941abbaf231f77930094">bgp_adj_out_unset</a> (rn, peer, p, afi, safi);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <a class="code" href="bgp__table_8h.html#a90f263bf84e91fb0b40f10d94c2baafba5af83960b1c7e199dbe0cc6392a5e2b0">BGP_TABLE_RSCLIENT</a>:
        <span class="comment">/* Announcement to peer-&gt;conf.  If the route is filtered, </span>
<span class="comment">           withdraw it. */</span>
        <span class="keywordflow">if</span> (selected &amp;&amp; 
            <a class="code" href="bgp__route_8c.html#a35b4c8839d28c1fadc0173bfe0898234">bgp_announce_check_rsclient</a> (selected, peer, p, &amp;attr, afi, safi))
          <a class="code" href="bgp__advertise_8c.html#a3a40b0a670f7854055d71517f5ede018">bgp_adj_out_set</a> (rn, peer, p, &amp;attr, afi, safi, selected);
        <span class="keywordflow">else</span>
      <a class="code" href="bgp__advertise_8c.html#adbc62e0dd99f941abbaf231f77930094">bgp_adj_out_unset</a> (rn, peer, p, afi, safi);
        <span class="keywordflow">break</span>;
    }
  
  <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;attr);
  
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6cc2493931ee28e8ec979bf8f4bf4953"></a><!-- doxytag: member="bgp_route.c::bgp_process_main" ref="a6cc2493931ee28e8ec979bf8f4bf4953" args="(struct work_queue *wq, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="workqueue_8h.html#a0e78d42489413cdb20b75485932a3885">wq_item_status</a> bgp_process_main </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structwork__queue.html">work_queue</a> *&#160;</td>
          <td class="paramname"><em>wq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01517">1517</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__process__queue.html">bgp_process_queue</a> *pq = <a class="code" href="dict_8c.html#a43a278d13284fb3412e9eee1db1d967e">data</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="structbgp.html">bgp</a> = pq-&gt;<a class="code" href="structbgp__process__queue.html#a9afd710e5c43ffcfebd9e448ede1ac3f">bgp</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn = pq-&gt;<a class="code" href="structbgp__process__queue.html#abf324bfeb9698771f6582fd36f20b916">rn</a>;
  <a class="code" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi = pq-&gt;<a class="code" href="structbgp__process__queue.html#aab23ff9ce503d676a383be8d9b456430">afi</a>;
  <a class="code" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi = pq-&gt;<a class="code" href="structbgp__process__queue.html#aaf6f5846c4654daf55532d4cdc63ccd8">safi</a>;
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> *<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a> = &amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *new_select;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *old_select;
  <span class="keyword">struct </span><a class="code" href="structbgp__info__pair.html">bgp_info_pair</a> old_and_new;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *<a class="code" href="structpeer.html">peer</a>;
  
  <span class="comment">/* Best path selection. */</span>
  <a class="code" href="bgp__route_8c.html#aefec15f33656cb69b4b71702afdca06a">bgp_best_selection</a> (bgp, rn, &amp;old_and_new);
  old_select = old_and_new.old;
  new_select = old_and_new.new;

  <span class="comment">/* Nothing to do. */</span>
  <span class="keywordflow">if</span> (old_select &amp;&amp; old_select == new_select)
    {
      <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (old_select-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#abf27b05ce5e7ef154318fb01c218d611">BGP_INFO_ATTR_CHANGED</a>))
        {
          <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (old_select-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a364ac84609844c369deadc56ea2ab24f">BGP_INFO_IGP_CHANGED</a>))
            <a class="code" href="bgp__zebra_8c.html#a7ea53f9049b2f5a323e2991962142d63">bgp_zebra_announce</a> (p, old_select, bgp);
          
          <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (rn-&gt;<a class="code" href="structbgp__node.html#a1369def83e1b7e96e76aa05f1c1bb5c8">flags</a>, <a class="code" href="bgp__table_8h.html#a89387d13426993997af6b2cc02600f12">BGP_NODE_PROCESS_SCHEDULED</a>);
          <span class="keywordflow">return</span> <a class="code" href="workqueue_8h.html#a0e78d42489413cdb20b75485932a3885ac62ec0649e33ec9d6e0836fab0dec7fc">WQ_SUCCESS</a>;
        }
    }

  <span class="keywordflow">if</span> (old_select)
    <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, old_select, <a class="code" href="bgp__route_8h.html#a43b3eb776824e6b86970e3886120913e">BGP_INFO_SELECTED</a>);
  <span class="keywordflow">if</span> (new_select)
    {
      <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, new_select, <a class="code" href="bgp__route_8h.html#a43b3eb776824e6b86970e3886120913e">BGP_INFO_SELECTED</a>);
      <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, new_select, <a class="code" href="bgp__route_8h.html#abf27b05ce5e7ef154318fb01c218d611">BGP_INFO_ATTR_CHANGED</a>);
    }


  <span class="comment">/* Check each BGP peer. */</span>
  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (bgp-&gt;<a class="code" href="structbgp.html#a99704607de62cd6d36eb8674f921ba8a">peer</a>, node, nnode, peer))
    {
      <a class="code" href="bgp__route_8c.html#a68f69dcd72afe7aeb53608418fc55385">bgp_process_announce_selected</a> (peer, new_select, rn, afi, safi);
    }

  <span class="comment">/* FIB update. */</span>
  <span class="keywordflow">if</span> (safi == <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a> &amp;&amp; ! bgp-&gt;<a class="code" href="structbgp.html#ac321205b3775d3cf7c70affd935c3a72">name</a> &amp;&amp;
      ! <a class="code" href="bgpd_8c.html#a5d65834a27b3de6bc2af63094ebf76f1">bgp_option_check</a> (<a class="code" href="bgpd_8h.html#afc24478ef33bb7a27704472d7fd043c4">BGP_OPT_NO_FIB</a>))
    {
      <span class="keywordflow">if</span> (new_select 
      &amp;&amp; new_select-&gt;<a class="code" href="structbgp__info.html#a7d70d35aa6ab6fa769c8e7d662288a35">type</a> == <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a> 
      &amp;&amp; new_select-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a4734a795191347f5279e59e64c75b7a3">BGP_ROUTE_NORMAL</a>)
    <a class="code" href="bgp__zebra_8c.html#a7ea53f9049b2f5a323e2991962142d63">bgp_zebra_announce</a> (p, new_select, bgp);
      <span class="keywordflow">else</span>
    {
      <span class="comment">/* Withdraw the route from the kernel. */</span>
      <span class="keywordflow">if</span> (old_select 
          &amp;&amp; old_select-&gt;<a class="code" href="structbgp__info.html#a7d70d35aa6ab6fa769c8e7d662288a35">type</a> == <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a>
          &amp;&amp; old_select-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a4734a795191347f5279e59e64c75b7a3">BGP_ROUTE_NORMAL</a>)
        <a class="code" href="bgp__zebra_8c.html#a067b7ce285841e44d9fa9d827bb83740">bgp_zebra_withdraw</a> (p, old_select);
    }
    }
    
  <span class="comment">/* Reap old select bgp_info, it it has been removed */</span>
  <span class="keywordflow">if</span> (old_select &amp;&amp; <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (old_select-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a0ff836da32782fe548f3fe570e5107e7">BGP_INFO_REMOVED</a>))
    <a class="code" href="bgp__route_8c.html#a4475c3919634039951683b34a18b1dee">bgp_info_reap</a> (rn, old_select);
  
  <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (rn-&gt;<a class="code" href="structbgp__node.html#a1369def83e1b7e96e76aa05f1c1bb5c8">flags</a>, <a class="code" href="bgp__table_8h.html#a89387d13426993997af6b2cc02600f12">BGP_NODE_PROCESS_SCHEDULED</a>);
  <span class="keywordflow">return</span> <a class="code" href="workqueue_8h.html#a0e78d42489413cdb20b75485932a3885ac62ec0649e33ec9d6e0836fab0dec7fc">WQ_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6b080892b6ca3f0108ab232772574a3f"></a><!-- doxytag: member="bgp_route.c::bgp_process_queue_init" ref="a6b080892b6ca3f0108ab232772574a3f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_process_queue_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01603">1603</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ae83b822ff500e553698ebb24c6940b5b">process_main_queue</a>
    = <a class="code" href="workqueue_8c.html#a8b50511bbc60426f371822c0c7aee5cc">work_queue_new</a> (<a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ab61d7cb301c6e2ab39c31553e677e300">master</a>, <span class="stringliteral">&quot;process_main_queue&quot;</span>);
  <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#a312c8497537347c02ac02b28efc0764b">process_rsclient_queue</a>
    = <a class="code" href="workqueue_8c.html#a8b50511bbc60426f371822c0c7aee5cc">work_queue_new</a> (<a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ab61d7cb301c6e2ab39c31553e677e300">master</a>, <span class="stringliteral">&quot;process_rsclient_queue&quot;</span>);
  
  <span class="keywordflow">if</span> ( !(<a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ae83b822ff500e553698ebb24c6940b5b">process_main_queue</a> &amp;&amp; <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#a312c8497537347c02ac02b28efc0764b">process_rsclient_queue</a>) )
    {
      <a class="code" href="log_8h.html#aaf50b52a949696adb9e77153b08545ad">zlog_err</a> (<span class="stringliteral">&quot;%s: Failed to allocate work queue&quot;</span>, __func__);
      <a class="code" href="vtysh_8c.html#afa5f6ba5518772e1487b961507e2a570">exit</a> (1);
    }
  
  <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ae83b822ff500e553698ebb24c6940b5b">process_main_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#aabcb370748f886f6a167ea3b13a6d372">workfunc</a> = &amp;<a class="code" href="bgp__route_8c.html#a6cc2493931ee28e8ec979bf8f4bf4953">bgp_process_main</a>;
  <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#a312c8497537347c02ac02b28efc0764b">process_rsclient_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#aabcb370748f886f6a167ea3b13a6d372">workfunc</a> = &amp;<a class="code" href="bgp__route_8c.html#a1b806ca9b67898e23d008da9bb105064">bgp_process_rsclient</a>;
  <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ae83b822ff500e553698ebb24c6940b5b">process_main_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#ae2fdda0df1d6e600e2b4e7849740e9d2">del_item_data</a> = &amp;<a class="code" href="bgp__route_8c.html#af596ac3e45fe6f173643ea336dd454d4">bgp_processq_del</a>;
  <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#a312c8497537347c02ac02b28efc0764b">process_rsclient_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#ae2fdda0df1d6e600e2b4e7849740e9d2">del_item_data</a>
    =  <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ae83b822ff500e553698ebb24c6940b5b">process_main_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#ae2fdda0df1d6e600e2b4e7849740e9d2">del_item_data</a>;
  <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ae83b822ff500e553698ebb24c6940b5b">process_main_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#a74334af11b2e664ed8cd47fa13a76881">max_retries</a>
    = <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ae83b822ff500e553698ebb24c6940b5b">process_main_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#a74334af11b2e664ed8cd47fa13a76881">max_retries</a> = 0;
  <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#a312c8497537347c02ac02b28efc0764b">process_rsclient_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#a6f998e18d62286e5b77844faf7c3ded2">hold</a>
    = <a class="code" href="bgpd_8c.html#adeab9451f33cb80e3dad19688138d378">bm</a>-&gt;<a class="code" href="structbgp__master.html#ae83b822ff500e553698ebb24c6940b5b">process_main_queue</a>-&gt;<a class="code" href="structwork__queue.html#ae9c11795e9b293839422dd2c6ebfa493">spec</a>.<a class="code" href="structwork__queue.html#a6f998e18d62286e5b77844faf7c3ded2">hold</a> = 50;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1b806ca9b67898e23d008da9bb105064"></a><!-- doxytag: member="bgp_route.c::bgp_process_rsclient" ref="a1b806ca9b67898e23d008da9bb105064" args="(struct work_queue *wq, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="workqueue_8h.html#a0e78d42489413cdb20b75485932a3885">wq_item_status</a> bgp_process_rsclient </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structwork__queue.html">work_queue</a> *&#160;</td>
          <td class="paramname"><em>wq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01457">1457</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__process__queue.html">bgp_process_queue</a> *pq = <a class="code" href="dict_8c.html#a43a278d13284fb3412e9eee1db1d967e">data</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="structbgp.html">bgp</a> = pq-&gt;<a class="code" href="structbgp__process__queue.html#a9afd710e5c43ffcfebd9e448ede1ac3f">bgp</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn = pq-&gt;<a class="code" href="structbgp__process__queue.html#abf324bfeb9698771f6582fd36f20b916">rn</a>;
  <a class="code" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi = pq-&gt;<a class="code" href="structbgp__process__queue.html#aab23ff9ce503d676a383be8d9b456430">afi</a>;
  <a class="code" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi = pq-&gt;<a class="code" href="structbgp__process__queue.html#aaf6f5846c4654daf55532d4cdc63ccd8">safi</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *new_select;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *old_select;
  <span class="keyword">struct </span><a class="code" href="structbgp__info__pair.html">bgp_info_pair</a> old_and_new;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *rsclient = rn-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>-&gt;<a class="code" href="structbgp__table.html#a0ac92882970caab0af8599bceba8f1af">owner</a>;
  
  <span class="comment">/* Best path selection. */</span>
  <a class="code" href="bgp__route_8c.html#aefec15f33656cb69b4b71702afdca06a">bgp_best_selection</a> (bgp, rn, &amp;old_and_new);
  new_select = old_and_new.new;
  old_select = old_and_new.old;

  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (rsclient-&gt;<a class="code" href="structpeer.html#a8dd1d16a0890967ee343e1bc70292e4f">sflags</a>, <a class="code" href="bgpd_8h.html#af3313c9e7a5b086f04fac1d8b4832b32">PEER_STATUS_GROUP</a>))
    {
      <span class="keywordflow">if</span> (rsclient-&gt;<a class="code" href="structpeer.html#ad0971faeae0a4cd91222b60a7629a686">group</a>)
        <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (rsclient-&gt;<a class="code" href="structpeer.html#ad0971faeae0a4cd91222b60a7629a686">group</a>-&gt;<a class="code" href="structpeer__group.html#a82be4a6eec4816e8e6290fab0bc91b4d">peer</a>, node, nnode, rsclient))
          {
            <span class="comment">/* Nothing to do. */</span>
            <span class="keywordflow">if</span> (old_select &amp;&amp; old_select == new_select)
              <span class="keywordflow">if</span> (!<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (old_select-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#abf27b05ce5e7ef154318fb01c218d611">BGP_INFO_ATTR_CHANGED</a>))
                <span class="keywordflow">continue</span>;

            <span class="keywordflow">if</span> (old_select)
              <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, old_select, <a class="code" href="bgp__route_8h.html#a43b3eb776824e6b86970e3886120913e">BGP_INFO_SELECTED</a>);
            <span class="keywordflow">if</span> (new_select)
              {
                <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, new_select, <a class="code" href="bgp__route_8h.html#a43b3eb776824e6b86970e3886120913e">BGP_INFO_SELECTED</a>);
                <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, new_select, <a class="code" href="bgp__route_8h.html#abf27b05ce5e7ef154318fb01c218d611">BGP_INFO_ATTR_CHANGED</a>);
              }

            <a class="code" href="bgp__route_8c.html#a68f69dcd72afe7aeb53608418fc55385">bgp_process_announce_selected</a> (rsclient, new_select, rn,
                                           afi, safi);
          }
    }
  <span class="keywordflow">else</span>
    {
      <span class="keywordflow">if</span> (old_select)
    <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, old_select, <a class="code" href="bgp__route_8h.html#a43b3eb776824e6b86970e3886120913e">BGP_INFO_SELECTED</a>);
      <span class="keywordflow">if</span> (new_select)
    {
      <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, new_select, <a class="code" href="bgp__route_8h.html#a43b3eb776824e6b86970e3886120913e">BGP_INFO_SELECTED</a>);
      <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, new_select, <a class="code" href="bgp__route_8h.html#abf27b05ce5e7ef154318fb01c218d611">BGP_INFO_ATTR_CHANGED</a>);
    }
      <a class="code" href="bgp__route_8c.html#a68f69dcd72afe7aeb53608418fc55385">bgp_process_announce_selected</a> (rsclient, new_select, rn, afi, safi);
    }

  <span class="keywordflow">if</span> (old_select &amp;&amp; <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (old_select-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a0ff836da32782fe548f3fe570e5107e7">BGP_INFO_REMOVED</a>))
    <a class="code" href="bgp__route_8c.html#a4475c3919634039951683b34a18b1dee">bgp_info_reap</a> (rn, old_select);
  
  <a class="code" href="zebra_8h.html#ab1ec1b6701a70280e13876cf1f6ae51d">UNSET_FLAG</a> (rn-&gt;<a class="code" href="structbgp__node.html#a1369def83e1b7e96e76aa05f1c1bb5c8">flags</a>, <a class="code" href="bgp__table_8h.html#a89387d13426993997af6b2cc02600f12">BGP_NODE_PROCESS_SCHEDULED</a>);
  <span class="keywordflow">return</span> <a class="code" href="workqueue_8h.html#a0e78d42489413cdb20b75485932a3885ac62ec0649e33ec9d6e0836fab0dec7fc">WQ_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af596ac3e45fe6f173643ea336dd454d4"></a><!-- doxytag: member="bgp_route.c::bgp_processq_del" ref="af596ac3e45fe6f173643ea336dd454d4" args="(struct work_queue *wq, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_processq_del </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structwork__queue.html">work_queue</a> *&#160;</td>
          <td class="paramname"><em>wq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01591">1591</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__process__queue.html">bgp_process_queue</a> *pq = <a class="code" href="dict_8c.html#a43a278d13284fb3412e9eee1db1d967e">data</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__table.html">bgp_table</a> *table = pq-&gt;<a class="code" href="structbgp__process__queue.html#abf324bfeb9698771f6582fd36f20b916">rn</a>-&gt;<a class="code" href="structbgp__node.html#a8853446ab7008523bce2eba58b26ad12">table</a>;
  
  <a class="code" href="bgpd_8c.html#a3752e9686437ac06be7b19ec985f1596">bgp_unlock</a> (pq-&gt;<a class="code" href="structbgp__process__queue.html#a9afd710e5c43ffcfebd9e448ede1ac3f">bgp</a>);
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (pq-&gt;<a class="code" href="structbgp__process__queue.html#abf324bfeb9698771f6582fd36f20b916">rn</a>);
  <a class="code" href="bgp__table_8c.html#af94a76428bf2695ec0ed1f87b3a4143a">bgp_table_unlock</a> (table);
  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167ba4db5edc8be06ce399a3625397401960f">MTYPE_BGP_PROCESS_QUEUE</a>, pq);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a716aead52529e1e5b1f5606155e859a5"></a><!-- doxytag: member="bgp_route.c::bgp_reset" ref="a716aead52529e1e5b1f5606155e859a5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_reset </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03000">3000</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="vty_8c.html#a637ad9b0152e5e5559bc0c05db07318e">vty_reset</a> ();
  <a class="code" href="bgp__zebra_8c.html#a2a493e9acff62550bc916134935af412">bgp_zclient_reset</a> ();
  <a class="code" href="filter_8c.html#a6d46b3b0526d8e0e8dbed60d7f6a695d">access_list_reset</a> ();
  <a class="code" href="plist_8c.html#a6d3ae1194d033d0d7cf9c3b54a7542ac">prefix_list_reset</a> ();
}
</pre></div>
</div>
</div>
<a class="anchor" id="af17eefd0fc4a1bd8d98f657810e26741"></a><!-- doxytag: member="bgp_route.c::bgp_rib_remove" ref="af17eefd0fc4a1bd8d98f657810e26741" args="(struct bgp_node *rn, struct bgp_info *ri, struct peer *peer, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_rib_remove </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01763">1763</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="bgp__route_8h.html#a91162dd024d89c577f51b3615b75496f">bgp_aggregate_decrement</a> (peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>, &amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>, ri, <a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>, <a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>);
  
  <span class="keywordflow">if</span> (!<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a57adf9fc517cc65fb9f4bcbf8ff796f2">BGP_INFO_HISTORY</a>))
    <a class="code" href="bgp__route_8c.html#abfe260239e1b72a286e9c45a5aa1afbd">bgp_info_delete</a> (rn, ri); <span class="comment">/* keep historical info */</span>
    
  <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>, rn, <a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>, <a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a97b525c43ec4d1f2a86b597317b78051"></a><!-- doxytag: member="bgp_route.c::bgp_rib_withdraw" ref="a97b525c43ec4d1f2a86b597317b78051" args="(struct bgp_node *rn, struct bgp_info *ri, struct peer *peer, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_rib_withdraw </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__node.html">bgp_node</a> *&#160;</td>
          <td class="paramname"><em>rn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__info.html">bgp_info</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01775">1775</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> status = <a class="code" href="bgp__damp_8h.html#a37278c4b7ba961f33645a14067033faa">BGP_DAMP_NONE</a>;

  <span class="comment">/* apply dampening, if result is suppressed, we&#39;ll be retaining </span>
<span class="comment">   * the bgp_info in the RIB for historical reference.</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a30da262ef5f391dae5c93ed04cf243c4">af_flags</a>[<a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>][<a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>], <a class="code" href="bgpd_8h.html#a1f74f91741ac0799c3348ce5f9e82992">BGP_CONFIG_DAMPENING</a>)
      &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a>)
    <span class="keywordflow">if</span> ( (status = <a class="code" href="bgp__damp_8c.html#a6495e2d88335e918ccca6f80fa52cee9">bgp_damp_withdraw</a> (ri, rn, <a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>, safi, 0)) 
         == <a class="code" href="bgp__damp_8h.html#a0f58b7873622a8c3d2e28d38e30719e4">BGP_DAMP_SUPPRESSED</a>)
      {
        <a class="code" href="bgp__route_8h.html#a91162dd024d89c577f51b3615b75496f">bgp_aggregate_decrement</a> (peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>, &amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>, ri, <a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>, safi);
        <span class="keywordflow">return</span>;
      }
    
  <a class="code" href="bgp__route_8c.html#af17eefd0fc4a1bd8d98f657810e26741">bgp_rib_remove</a> (rn, ri, peer, <a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>, safi);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a74f36e1ccbb82b25e96dbdda5ba35f66"></a><!-- doxytag: member="bgp_route.c::bgp_soft_reconfig_in" ref="a74f36e1ccbb82b25e96dbdda5ba35f66" args="(struct peer *peer, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_soft_reconfig_in </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02653">2653</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__table.html">bgp_table</a> *table;

  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ae39d16f69d65fec0f4f1908b4a33e6c6">status</a> != <a class="code" href="bgpd_8h.html#aa87809ec7dea97b0e970e98ae6c181ea">Established</a>)
    <span class="keywordflow">return</span>;

  <span class="keywordflow">if</span> (<a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a> != <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
    <a class="code" href="bgp__route_8c.html#a361e68a96de5fa35c4d78b6a4c6dc984">bgp_soft_reconfig_table</a> (peer, <a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>, <a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
  <span class="keywordflow">else</span>
    <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[<a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>][<a class="code" href="structbgp__table.html#a1c64abd56c9540ab9e4a144068ed1caa">safi</a>]); rn;
     rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rn))
      <span class="keywordflow">if</span> ((table = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>) != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    <a class="code" href="bgp__route_8c.html#a361e68a96de5fa35c4d78b6a4c6dc984">bgp_soft_reconfig_table</a> (peer, <a class="code" href="structbgp__table.html#a65e5c5b62b7afc22106369584ecefd5d">afi</a>, safi, table);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5c1eb3bbdaa82d1e5b7b3307de25b12d"></a><!-- doxytag: member="bgp_route.c::bgp_soft_reconfig_rsclient" ref="a5c1eb3bbdaa82d1e5b7b3307de25b12d" args="(struct peer *rsclient, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_soft_reconfig_rsclient </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>rsclient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02608">2608</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__table.html">bgp_table</a> *table;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  
  <span class="keywordflow">if</span> (safi != <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
    <a class="code" href="bgp__route_8c.html#a9a99b91321b9ba23f772dbc64c285e70">bgp_soft_reconfig_table_rsclient</a> (rsclient, afi, safi, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);

  <span class="keywordflow">else</span>
    <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (rsclient-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[afi][safi]); rn;
            rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rn))
      <span class="keywordflow">if</span> ((table = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>) != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
        <a class="code" href="bgp__route_8c.html#a9a99b91321b9ba23f772dbc64c285e70">bgp_soft_reconfig_table_rsclient</a> (rsclient, afi, safi, table);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a361e68a96de5fa35c4d78b6a4c6dc984"></a><!-- doxytag: member="bgp_route.c::bgp_soft_reconfig_table" ref="a361e68a96de5fa35c4d78b6a4c6dc984" args="(struct peer *peer, afi_t afi, safi_t safi, struct bgp_table *table)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_soft_reconfig_table </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__table.html">bgp_table</a> *&#160;</td>
          <td class="paramname"><em>table</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02624">2624</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__adj__in.html">bgp_adj_in</a> *ain;

  <span class="keywordflow">if</span> (! table)
    table = peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[afi][safi];

  <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (table); rn; rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rn))
    <span class="keywordflow">for</span> (ain = rn-&gt;<a class="code" href="structbgp__node.html#a47213f2ff58ef9de9f5daf62b8f918be">adj_in</a>; ain; ain = ain-&gt;<a class="code" href="structbgp__adj__in.html#aaa2dc023411504da13bde05352687565">next</a>)
      {
    <span class="keywordflow">if</span> (ain-&gt;<a class="code" href="structbgp__adj__in.html#ab6bb20edc80c75c836662a675102301d">peer</a> == peer)
      {
        ret = <a class="code" href="bgp__route_8c.html#adead0e338559e1bf15f14c261fbe975d">bgp_update</a> (peer, &amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>, ain-&gt;<a class="code" href="structbgp__adj__in.html#af4ba3d9b17562310690d0ef0cd1e6ff8">attr</a>, afi, safi,
                  <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a>, <a class="code" href="bgp__route_8h.html#a4734a795191347f5279e59e64c75b7a3">BGP_ROUTE_NORMAL</a>,
                  <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 1);
        <span class="keywordflow">if</span> (ret &lt; 0)
          {
        <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
        <span class="keywordflow">return</span>;
          }
        <span class="keywordflow">continue</span>;
      }
      }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9a99b91321b9ba23f772dbc64c285e70"></a><!-- doxytag: member="bgp_route.c::bgp_soft_reconfig_table_rsclient" ref="a9a99b91321b9ba23f772dbc64c285e70" args="(struct peer *rsclient, afi_t afi, safi_t safi, struct bgp_table *table)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_soft_reconfig_table_rsclient </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>rsclient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__table.html">bgp_table</a> *&#160;</td>
          <td class="paramname"><em>table</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02590">2590</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__adj__in.html">bgp_adj_in</a> *ain;

  <span class="keywordflow">if</span> (! table)
    table = rsclient-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[afi][safi];

  <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (table); rn; rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rn))
    <span class="keywordflow">for</span> (ain = rn-&gt;<a class="code" href="structbgp__node.html#a47213f2ff58ef9de9f5daf62b8f918be">adj_in</a>; ain; ain = ain-&gt;<a class="code" href="structbgp__adj__in.html#aaa2dc023411504da13bde05352687565">next</a>)
      {
        <a class="code" href="bgp__route_8c.html#a35a6938b2231aa460e1ce4a1d767b89f">bgp_update_rsclient</a> (rsclient, afi, safi, ain-&gt;<a class="code" href="structbgp__adj__in.html#af4ba3d9b17562310690d0ef0cd1e6ff8">attr</a>, ain-&gt;<a class="code" href="structbgp__adj__in.html#ab6bb20edc80c75c836662a675102301d">peer</a>,
                &amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>, <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a>, <a class="code" href="bgp__route_8h.html#a4734a795191347f5279e59e64c75b7a3">BGP_ROUTE_NORMAL</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
      }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4902f0940ffe01568daa3d9df842c874"></a><!-- doxytag: member="bgp_route.c::bgp_static_delete" ref="a4902f0940ffe01568daa3d9df842c874" args="(struct bgp *bgp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_static_delete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03855">3855</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <a class="code" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a> afi;
  <a class="code" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a> safi;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rm;
  <span class="keyword">struct </span><a class="code" href="structbgp__table.html">bgp_table</a> *table;
  <span class="keyword">struct </span><a class="code" href="structbgp__static.html">bgp_static</a> *<a class="code" href="structbgp__static.html">bgp_static</a>;

  <span class="keywordflow">for</span> (afi = <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>; afi &lt; <a class="code" href="zebra_8h.html#abf129a17e985713a26a6181a198d5f1a">AFI_MAX</a>; afi++)
    <span class="keywordflow">for</span> (safi = <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>; safi &lt; <a class="code" href="zebra_8h.html#a82fe6f63e822f7bf9e4567873d809ed8">SAFI_MAX</a>; safi++)
      <span class="keywordflow">for</span> (rn = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (bgp-&gt;<a class="code" href="structbgp.html#af06132502d1bbb4584e996e978254e34">route</a>[afi][safi]); rn; rn = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rn))
    <span class="keywordflow">if</span> (rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> != <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
      {      
        <span class="keywordflow">if</span> (safi == <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
          {
        table = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>;

        <span class="keywordflow">for</span> (rm = <a class="code" href="bgp__table_8c.html#af8ce42494729d03a8c7ca41ded487bb2">bgp_table_top</a> (table); rm; rm = <a class="code" href="bgp__table_8c.html#abdeced48b9b4aad614c88dc63ea0a4cf">bgp_route_next</a> (rm))
          {
            bgp_static = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>;
            <a class="code" href="bgp__route_8c.html#a949bc552da03f5b91ab061802527294b">bgp_static_withdraw_vpnv4</a> (bgp, &amp;rm-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>,
                           <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>, <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>,
                           (<span class="keyword">struct</span> <a class="code" href="structprefix__rd.html">prefix_rd</a> *)&amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>,
                           bgp_static-&gt;<a class="code" href="structbgp__static.html#ac8be92b08f87ccf5e9817c12542dcfe4">tag</a>);
            <a class="code" href="bgp__route_8c.html#ab9ed95d988c9782fbfda8fe175344bda">bgp_static_free</a> (bgp_static);
            rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
            <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
          }
          }
        <span class="keywordflow">else</span>
          {
        bgp_static = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>;
        <a class="code" href="bgp__route_8c.html#a14bde9043b6db15a3327081054b54dbe">bgp_static_withdraw</a> (bgp, &amp;rn-&gt;<a class="code" href="structbgp__node.html#a61c7e08de23a3c64f8dd738448567cde">p</a>, afi, safi);
        <a class="code" href="bgp__route_8c.html#ab9ed95d988c9782fbfda8fe175344bda">bgp_static_free</a> (bgp_static);
        rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
        <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
          }
      }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab9ed95d988c9782fbfda8fe175344bda"></a><!-- doxytag: member="bgp_route.c::bgp_static_free" ref="ab9ed95d988c9782fbfda8fe175344bda" args="(struct bgp_static *bgp_static)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_static_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp__static.html">bgp_static</a> *&#160;</td>
          <td class="paramname"><em>bgp_static</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03178">3178</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span> (bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#ad76c828cf9c061f483a3ed7220649b51">name</a>)
    free (bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#ad76c828cf9c061f483a3ed7220649b51">name</a>);
  <a class="code" href="memory_8h.html#a29f1ce2c850a3163cd6b1b0bd460705d">XFREE</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167bae2e0b35f72a03fff0f1512953c333950">MTYPE_BGP_STATIC</a>, bgp_static);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3ba6f7387a668fed8fced2ea48559855"></a><!-- doxytag: member="bgp_route.c::bgp_static_new" ref="a3ba6f7387a668fed8fced2ea48559855" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structbgp__static.html">bgp_static</a>* bgp_static_new </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03172">3172</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">return</span> <a class="code" href="memory_8h.html#a7826e4ed1d152cad0666dcf43f11f663">XCALLOC</a> (<a class="code" href="memtypes_8h.html#a7ff5f2dff38e7639981794c43dc9167bae2e0b35f72a03fff0f1512953c333950">MTYPE_BGP_STATIC</a>, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structbgp__static.html">bgp_static</a>));
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad82b3e0221971ab424dc936b7fcbea1a"></a><!-- doxytag: member="bgp_route.c::bgp_static_set" ref="ad82b3e0221971ab424dc936b7fcbea1a" args="(struct vty *vty, struct bgp *bgp, const char *ip_str, u_int16_t afi, u_char safi, const char *rmap, int backdoor, u_char ttl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_static_set </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvty.html">vty</a> *&#160;</td>
          <td class="paramname"><em>vty</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>ip_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int16_t&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>rmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>backdoor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char&#160;</td>
          <td class="paramname"><em>ttl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03655">3655</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__static.html">bgp_static</a> *<a class="code" href="structbgp__static.html">bgp_static</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  u_char need_update = 0;
  u_char ttl_change = 0;
  u_char ttl_edge = (ttl ? 1 : 0);
  u_char <span class="keyword">new</span> = 0;

  <span class="comment">/* Convert IP prefix string to struct prefix. */</span>
  ret = <a class="code" href="prefix_8c.html#a35f57d44562d00baaf5d227d03214786">str2prefix</a> (ip_str, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);
  <span class="keywordflow">if</span> (! ret)
    {
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%% Malformed prefix%s&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      <span class="keywordflow">return</span> <a class="code" href="command_8h.html#a92dc6dc30d8ef3651eb9d47a6083b025">CMD_WARNING</a>;
    }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (afi == <a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a> &amp;&amp; IN6_IS_ADDR_LINKLOCAL (&amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.u.prefix6))
    {
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%% Malformed prefix (link-local address)%s&quot;</span>,
           <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      <span class="keywordflow">return</span> <a class="code" href="command_8h.html#a92dc6dc30d8ef3651eb9d47a6083b025">CMD_WARNING</a>;
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

  <a class="code" href="prefix_8c.html#a99265c5e11b1867552cf784a4cac8252">apply_mask</a> (&amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);

  <span class="comment">/* Set BGP static route configuration. */</span>
  rn = <a class="code" href="bgp__table_8c.html#a81c9e9d48e2d66148c713e82968df389">bgp_node_get</a> (bgp-&gt;<a class="code" href="structbgp.html#af06132502d1bbb4584e996e978254e34">route</a>[afi][safi], &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);

  <span class="keywordflow">if</span> (rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>)
    {
      <span class="comment">/* Configuration change. */</span>
      bgp_static = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>;

      <span class="comment">/* Check previous routes are installed into BGP.  */</span>
      <span class="keywordflow">if</span> (bgp_static-&gt;<a class="code" href="structbgp__static.html#a8f8a0cfbc3624f0232c41f95a178c80c">valid</a>)
        {
          <span class="keywordflow">if</span> (bgp_static-&gt;<a class="code" href="structbgp__static.html#a53fefa678c3bddce6ce9b49876423ace">backdoor</a> != backdoor
              || bgp_static-&gt;<a class="code" href="structbgp__static.html#aaad8a5db923a971cbbd054f20ccaac1c">ttl</a> != ttl)
            need_update = 1;
        }
      
      <span class="comment">/* need to catch TTL set/unset transitions for handling of</span>
<span class="comment">       * ATOMIC_AGGREGATE </span>
<span class="comment">       */</span> 
      <span class="keywordflow">if</span> ((bgp_static-&gt;<a class="code" href="structbgp__static.html#aaad8a5db923a971cbbd054f20ccaac1c">ttl</a> ? 1 : 0) != ttl_edge)
        ttl_change = 1;
          
      bgp_static-&gt;<a class="code" href="structbgp__static.html#a53fefa678c3bddce6ce9b49876423ace">backdoor</a> = backdoor;
      bgp_static-&gt;<a class="code" href="structbgp__static.html#aaad8a5db923a971cbbd054f20ccaac1c">ttl</a> = ttl;
      
      <span class="keywordflow">if</span> (<a class="code" href="structrmap.html">rmap</a>)
    {
      <span class="keywordflow">if</span> (bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#ad76c828cf9c061f483a3ed7220649b51">name</a>)
        free (bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#ad76c828cf9c061f483a3ed7220649b51">name</a>);
      bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#ad76c828cf9c061f483a3ed7220649b51">name</a> = strdup (<a class="code" href="structrmap.html">rmap</a>);
      bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#a66a99ae86e2b6f3496a481b7bfd300e9">map</a> = <a class="code" href="routemap_8c.html#a52006340e589dda4244d35cafc9f6f10">route_map_lookup_by_name</a> (<a class="code" href="structrmap.html">rmap</a>);
    }
      <span class="keywordflow">else</span>
    {
      <span class="keywordflow">if</span> (bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#ad76c828cf9c061f483a3ed7220649b51">name</a>)
        free (bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#ad76c828cf9c061f483a3ed7220649b51">name</a>);
      bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#ad76c828cf9c061f483a3ed7220649b51">name</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
      bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#a66a99ae86e2b6f3496a481b7bfd300e9">map</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
      bgp_static-&gt;<a class="code" href="structbgp__static.html#a8f8a0cfbc3624f0232c41f95a178c80c">valid</a> = 0;
    }
      <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
    }
  <span class="keywordflow">else</span>
    {
      <span class="comment">/* New configuration. */</span>
      bgp_static = <a class="code" href="bgp__route_8c.html#a3ba6f7387a668fed8fced2ea48559855">bgp_static_new</a> ();
      bgp_static-&gt;<a class="code" href="structbgp__static.html#a53fefa678c3bddce6ce9b49876423ace">backdoor</a> = backdoor;
      bgp_static-&gt;<a class="code" href="structbgp__static.html#a8f8a0cfbc3624f0232c41f95a178c80c">valid</a> = 0;
      bgp_static-&gt;<a class="code" href="structbgp__static.html#ab33ff97c3d3849126cf93af1ad2da41f">igpmetric</a> = 0;
      bgp_static-&gt;<a class="code" href="structbgp__static.html#aa8f62625fb60ace77000a35d31b0e97b">igpnexthop</a>.s_addr = 0;
      bgp_static-&gt;<a class="code" href="structbgp__static.html#aaad8a5db923a971cbbd054f20ccaac1c">ttl</a> = ttl;
      ttl_change = ttl_edge;
      <span class="keyword">new</span> = 1;
      
      <span class="keywordflow">if</span> (<a class="code" href="structrmap.html">rmap</a>)
    {
      <span class="keywordflow">if</span> (bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#ad76c828cf9c061f483a3ed7220649b51">name</a>)
        free (bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#ad76c828cf9c061f483a3ed7220649b51">name</a>);
      bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#ad76c828cf9c061f483a3ed7220649b51">name</a> = strdup (<a class="code" href="structrmap.html">rmap</a>);
      bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#a66a99ae86e2b6f3496a481b7bfd300e9">map</a> = <a class="code" href="routemap_8c.html#a52006340e589dda4244d35cafc9f6f10">route_map_lookup_by_name</a> (<a class="code" href="structrmap.html">rmap</a>);
    }
      rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> = bgp_static;
    }

  <span class="comment">/* &quot;.. sites that choose to advertise the</span>
<span class="comment">   *  AS_PATHLIMIT path attribute SHOULD advertise the ATOMIC_AGGREGATE on</span>
<span class="comment">   *  all less specific covering prefixes as well as the more specific</span>
<span class="comment">   *  prefixes.&quot;</span>
<span class="comment">   *</span>
<span class="comment">   * So:</span>
<span class="comment">   * Prefix that has just had pathlimit set/unset:</span>
<span class="comment">   * - Must bump ATOMIC refcount on all parents.</span>
<span class="comment">   *</span>
<span class="comment">   * To catch less specific prefixes:</span>
<span class="comment">   * - Must search children for ones with TTL, bump atomic refcount</span>
<span class="comment">   *   (we dont care if we&#39;re deleting a less specific prefix..)</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (ttl_change)
    {
      <span class="comment">/* Existing static changed TTL, search parents and adjust their atomic */</span>
      <a class="code" href="bgp__route_8c.html#a45bb68a5cf818ba7d1921baf0e62ccf2">bgp_pathlimit_update_parents</a> (bgp, rn, ttl_edge);
    }
  
  <span class="keywordflow">if</span> (<span class="keyword">new</span>)
    {
      <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *child;
      <span class="keyword">struct </span>bgp_static *sc;
      
      <span class="comment">/* New static, search children and bump this statics atomic.. */</span>
      child = <a class="code" href="bgp__table_8c.html#a8c629ca0214d269ce20f39268b9196d7">bgp_lock_node</a> (rn); <span class="comment">/* route_next_until unlocks it.. */</span>
      <span class="keywordflow">while</span> ((child = <a class="code" href="bgp__table_8c.html#a689ab08e34c8d837709b2033563dcba9">bgp_route_next_until</a> (child, rn)))
        {
          <span class="keywordflow">if</span> ((sc = child-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>) &amp;&amp; sc-&gt;<a class="code" href="structbgp__static.html#aaad8a5db923a971cbbd054f20ccaac1c">ttl</a>)
            bgp_static-&gt;<a class="code" href="structbgp__static.html#ab4d379ac74eae4070e11b425e938a0e8">atomic</a>++;
        }
    }
  
  <span class="comment">/* If BGP scan is not enabled, we should install this route here.  */</span>
  <span class="keywordflow">if</span> (! <a class="code" href="bgpd_8c.html#a0b3388d8ac73af2d4f4f22e46746da1e">bgp_flag_check</a> (bgp, <a class="code" href="bgpd_8h.html#a6bc6dc724e29fd024f008b87f02e4b54">BGP_FLAG_IMPORT_CHECK</a>))
    {
      bgp_static-&gt;<a class="code" href="structbgp__static.html#a8f8a0cfbc3624f0232c41f95a178c80c">valid</a> = 1;

      <span class="keywordflow">if</span> (need_update)
    <a class="code" href="bgp__route_8c.html#a14bde9043b6db15a3327081054b54dbe">bgp_static_withdraw</a> (bgp, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, afi, safi);

      <span class="keywordflow">if</span> (! bgp_static-&gt;<a class="code" href="structbgp__static.html#a53fefa678c3bddce6ce9b49876423ace">backdoor</a>)
    <a class="code" href="bgp__route_8c.html#abbcc2b564375f6ab82f7622042f4c69f">bgp_static_update</a> (bgp, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, bgp_static, afi, safi);
    }

  <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a477ac70385162d533769b46a560133f6"></a><!-- doxytag: member="bgp_route.c::bgp_static_set_vpnv4" ref="a477ac70385162d533769b46a560133f6" args="(struct vty *vty, const char *ip_str, const char *rd_str, const char *tag_str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_static_set_vpnv4 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvty.html">vty</a> *&#160;</td>
          <td class="paramname"><em>vty</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>ip_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>rd_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>tag_str</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03897">3897</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
  <span class="keyword">struct </span><a class="code" href="structprefix__rd.html">prefix_rd</a> prd;
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *<a class="code" href="structbgp__node.html#ae70689440c2ce67c611d4e645967b000">prn</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__table.html">bgp_table</a> *table;
  <span class="keyword">struct </span><a class="code" href="structbgp__static.html">bgp_static</a> *<a class="code" href="structbgp__static.html">bgp_static</a>;
  u_char <a class="code" href="structbgp__static.html#ac8be92b08f87ccf5e9817c12542dcfe4">tag</a>[3];

  bgp = vty-&gt;<a class="code" href="structvty.html#a9179508dca757a3b7c345c86769b5b9a">index</a>;

  ret = <a class="code" href="prefix_8c.html#a35f57d44562d00baaf5d227d03214786">str2prefix</a> (ip_str, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);
  <span class="keywordflow">if</span> (! ret)
    {
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%% Malformed prefix%s&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      <span class="keywordflow">return</span> <a class="code" href="command_8h.html#a92dc6dc30d8ef3651eb9d47a6083b025">CMD_WARNING</a>;
    }
  <a class="code" href="prefix_8c.html#a99265c5e11b1867552cf784a4cac8252">apply_mask</a> (&amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);

  ret = <a class="code" href="bgp__mplsvpn_8c.html#a296cfbde78d5b77bb55f852b2e1cabdd">str2prefix_rd</a> (rd_str, &amp;prd);
  <span class="keywordflow">if</span> (! ret)
    {
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%% Malformed rd%s&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      <span class="keywordflow">return</span> <a class="code" href="command_8h.html#a92dc6dc30d8ef3651eb9d47a6083b025">CMD_WARNING</a>;
    }

  ret = <a class="code" href="bgp__mplsvpn_8c.html#a351be45ea03f40abf1b4247e2a71a8f4">str2tag</a> (tag_str, tag);
  <span class="keywordflow">if</span> (! ret)
    {
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%% Malformed tag%s&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      <span class="keywordflow">return</span> <a class="code" href="command_8h.html#a92dc6dc30d8ef3651eb9d47a6083b025">CMD_WARNING</a>;
    }

  prn = <a class="code" href="bgp__table_8c.html#a81c9e9d48e2d66148c713e82968df389">bgp_node_get</a> (bgp-&gt;<a class="code" href="structbgp.html#af06132502d1bbb4584e996e978254e34">route</a>[<a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>][<a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>],
            (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *)&amp;prd);
  <span class="keywordflow">if</span> (prn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    prn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> = <a class="code" href="bgp__table_8c.html#afbe454c63fbb296e768cb66efa0962da">bgp_table_init</a> (<a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>, <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>);
  <span class="keywordflow">else</span>
    <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (prn);
  table = prn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>;

  rn = <a class="code" href="bgp__table_8c.html#a81c9e9d48e2d66148c713e82968df389">bgp_node_get</a> (table, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);

  <span class="keywordflow">if</span> (rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>)
    {
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%% Same network configuration exists%s&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
    }
  <span class="keywordflow">else</span>
    {
      <span class="comment">/* New configuration. */</span>
      bgp_static = <a class="code" href="bgp__route_8c.html#a3ba6f7387a668fed8fced2ea48559855">bgp_static_new</a> ();
      bgp_static-&gt;<a class="code" href="structbgp__static.html#a8f8a0cfbc3624f0232c41f95a178c80c">valid</a> = 1;
      <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (bgp_static-&gt;<a class="code" href="structbgp__static.html#ac8be92b08f87ccf5e9817c12542dcfe4">tag</a>, tag, 3);
      rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> = bgp_static;

      <a class="code" href="bgp__route_8c.html#a993bebd87ca0ad9166c4e65c697c9f79">bgp_static_update_vpnv4</a> (bgp, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>, <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>, &amp;prd, tag);
    }

  <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5d4486300e5e46449dbbea9ae3f1af77"></a><!-- doxytag: member="bgp_route.c::bgp_static_unset" ref="a5d4486300e5e46449dbbea9ae3f1af77" args="(struct vty *vty, struct bgp *bgp, const char *ip_str, u_int16_t afi, u_char safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_static_unset </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvty.html">vty</a> *&#160;</td>
          <td class="paramname"><em>vty</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>ip_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int16_t&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03800">3800</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__static.html">bgp_static</a> *<a class="code" href="structbgp__static.html">bgp_static</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;

  <span class="comment">/* Convert IP prefix string to struct prefix. */</span>
  ret = <a class="code" href="prefix_8c.html#a35f57d44562d00baaf5d227d03214786">str2prefix</a> (ip_str, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);
  <span class="keywordflow">if</span> (! ret)
    {
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%% Malformed prefix%s&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      <span class="keywordflow">return</span> <a class="code" href="command_8h.html#a92dc6dc30d8ef3651eb9d47a6083b025">CMD_WARNING</a>;
    }
<span class="preprocessor">#ifdef HAVE_IPV6</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span> (afi == <a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a> &amp;&amp; IN6_IS_ADDR_LINKLOCAL (&amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>.u.prefix6))
    {
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%% Malformed prefix (link-local address)%s&quot;</span>,
           <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      <span class="keywordflow">return</span> <a class="code" href="command_8h.html#a92dc6dc30d8ef3651eb9d47a6083b025">CMD_WARNING</a>;
    }
<span class="preprocessor">#endif </span><span class="comment">/* HAVE_IPV6 */</span>

  <a class="code" href="prefix_8c.html#a99265c5e11b1867552cf784a4cac8252">apply_mask</a> (&amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);

  rn = <a class="code" href="bgp__table_8c.html#aa67a654ce220da27fb3f02757fcb0bdc">bgp_node_lookup</a> (bgp-&gt;<a class="code" href="structbgp.html#af06132502d1bbb4584e996e978254e34">route</a>[afi][safi], &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);
  <span class="keywordflow">if</span> (! rn)
    {
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%% Can&#39;t find specified static route configuration.%s&quot;</span>,
           <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      <span class="keywordflow">return</span> <a class="code" href="command_8h.html#a92dc6dc30d8ef3651eb9d47a6083b025">CMD_WARNING</a>;
    }

  bgp_static = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>;
  
  <span class="comment">/* decrement atomic in parents, see bgp_static_set */</span>
  <a class="code" href="bgp__route_8c.html#a45bb68a5cf818ba7d1921baf0e62ccf2">bgp_pathlimit_update_parents</a> (bgp, rn, 0);
  
  <span class="comment">/* Update BGP RIB. */</span>
  <span class="keywordflow">if</span> (! bgp_static-&gt;<a class="code" href="structbgp__static.html#a53fefa678c3bddce6ce9b49876423ace">backdoor</a>)
    <a class="code" href="bgp__route_8c.html#a14bde9043b6db15a3327081054b54dbe">bgp_static_withdraw</a> (bgp, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, afi, safi);

  <span class="comment">/* Clear configuration. */</span>
  <a class="code" href="bgp__route_8c.html#ab9ed95d988c9782fbfda8fe175344bda">bgp_static_free</a> (bgp_static);
  rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);

  <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab02340eb78bf5d97ddafce4f0fc948fa"></a><!-- doxytag: member="bgp_route.c::bgp_static_unset_vpnv4" ref="ab02340eb78bf5d97ddafce4f0fc948fa" args="(struct vty *vty, const char *ip_str, const char *rd_str, const char *tag_str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_static_unset_vpnv4 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvty.html">vty</a> *&#160;</td>
          <td class="paramname"><em>vty</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>ip_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>rd_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>tag_str</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03965">3965</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
  <span class="keyword">struct </span><a class="code" href="structprefix.html">prefix</a> <a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>;
  <span class="keyword">struct </span><a class="code" href="structprefix__rd.html">prefix_rd</a> prd;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *<a class="code" href="structbgp__node.html#ae70689440c2ce67c611d4e645967b000">prn</a>;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__table.html">bgp_table</a> *table;
  <span class="keyword">struct </span><a class="code" href="structbgp__static.html">bgp_static</a> *<a class="code" href="structbgp__static.html">bgp_static</a>;
  u_char <a class="code" href="structbgp__static.html#ac8be92b08f87ccf5e9817c12542dcfe4">tag</a>[3];

  bgp = vty-&gt;<a class="code" href="structvty.html#a9179508dca757a3b7c345c86769b5b9a">index</a>;

  <span class="comment">/* Convert IP prefix string to struct prefix. */</span>
  ret = <a class="code" href="prefix_8c.html#a35f57d44562d00baaf5d227d03214786">str2prefix</a> (ip_str, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);
  <span class="keywordflow">if</span> (! ret)
    {
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%% Malformed prefix%s&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      <span class="keywordflow">return</span> <a class="code" href="command_8h.html#a92dc6dc30d8ef3651eb9d47a6083b025">CMD_WARNING</a>;
    }
  <a class="code" href="prefix_8c.html#a99265c5e11b1867552cf784a4cac8252">apply_mask</a> (&amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);

  ret = <a class="code" href="bgp__mplsvpn_8c.html#a296cfbde78d5b77bb55f852b2e1cabdd">str2prefix_rd</a> (rd_str, &amp;prd);
  <span class="keywordflow">if</span> (! ret)
    {
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%% Malformed rd%s&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      <span class="keywordflow">return</span> <a class="code" href="command_8h.html#a92dc6dc30d8ef3651eb9d47a6083b025">CMD_WARNING</a>;
    }

  ret = <a class="code" href="bgp__mplsvpn_8c.html#a351be45ea03f40abf1b4247e2a71a8f4">str2tag</a> (tag_str, tag);
  <span class="keywordflow">if</span> (! ret)
    {
      <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%% Malformed tag%s&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);
      <span class="keywordflow">return</span> <a class="code" href="command_8h.html#a92dc6dc30d8ef3651eb9d47a6083b025">CMD_WARNING</a>;
    }

  prn = <a class="code" href="bgp__table_8c.html#a81c9e9d48e2d66148c713e82968df389">bgp_node_get</a> (bgp-&gt;<a class="code" href="structbgp.html#af06132502d1bbb4584e996e978254e34">route</a>[<a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>][<a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>],
            (<span class="keyword">struct</span> <a class="code" href="structprefix.html">prefix</a> *)&amp;prd);
  <span class="keywordflow">if</span> (prn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> == <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
    prn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> = <a class="code" href="bgp__table_8c.html#afbe454c63fbb296e768cb66efa0962da">bgp_table_init</a> (<a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>, <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>);
  <span class="keywordflow">else</span>
    <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (prn);
  table = prn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>;

  rn = <a class="code" href="bgp__table_8c.html#aa67a654ce220da27fb3f02757fcb0bdc">bgp_node_lookup</a> (table, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>);

  <span class="keywordflow">if</span> (rn)
    {
      <a class="code" href="bgp__route_8c.html#a949bc552da03f5b91ab061802527294b">bgp_static_withdraw_vpnv4</a> (bgp, &amp;<a class="code" href="spgrid_8c.html#a931bc2aa940ac2a4d1601cf842336926">p</a>, <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>, <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>, &amp;prd, tag);

      bgp_static = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>;
      <a class="code" href="bgp__route_8c.html#ab9ed95d988c9782fbfda8fe175344bda">bgp_static_free</a> (bgp_static);
      rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a> = <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
      <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
      <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
    }
  <span class="keywordflow">else</span>
    <a class="code" href="vty_8c.html#a3725db0ec6ad3ffdd31f68abc807ee34">vty_out</a> (vty, <span class="stringliteral">&quot;%% Can&#39;t find the route%s&quot;</span>, <a class="code" href="vty_8h.html#a3be8ca867e2953936a95c68dc64824b6">VTY_NEWLINE</a>);

  <span class="keywordflow">return</span> <a class="code" href="command_8h.html#aa2008c1bc36d9ef42571a6ec52516d02">CMD_SUCCESS</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abbcc2b564375f6ab82f7622042f4c69f"></a><!-- doxytag: member="bgp_route.c::bgp_static_update" ref="abbcc2b564375f6ab82f7622042f4c69f" args="(struct bgp *bgp, struct prefix *p, struct bgp_static *bgp_static, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_static_update </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__static.html">bgp_static</a> *&#160;</td>
          <td class="paramname"><em>bgp_static</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03505">3505</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structpeer.html">peer</a> *rsclient;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;

  <a class="code" href="bgp__route_8c.html#adf87800006cc4fc05a3eb602e9870697">bgp_static_update_main</a> (bgp, p, bgp_static, afi, safi);

  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (bgp-&gt;<a class="code" href="structbgp.html#a4ccd4dea11eddfa74dc5518fdb448b67">rsclient</a>, node, nnode, rsclient))
    {
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (rsclient-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#abf59e9a9022e80ecdc266d86f35b378e">PEER_FLAG_RSERVER_CLIENT</a>))
        <a class="code" href="bgp__route_8c.html#adde0f36163e0fb2c47de7cf95f8bbe56">bgp_static_update_rsclient</a> (rsclient, p, bgp_static, afi, safi);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="adf87800006cc4fc05a3eb602e9870697"></a><!-- doxytag: member="bgp_route.c::bgp_static_update_main" ref="adf87800006cc4fc05a3eb602e9870697" args="(struct bgp *bgp, struct prefix *p, struct bgp_static *bgp_static, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_static_update_main </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__static.html">bgp_static</a> *&#160;</td>
          <td class="paramname"><em>bgp_static</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03375">3375</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *<span class="keyword">new</span>;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> info;
  <span class="keyword">struct </span><a class="code" href="structattr.html">attr</a> <a class="code" href="structattr.html">attr</a> = { 0 };
  <span class="keyword">struct </span>attr *attr_new;
  <span class="keywordtype">int</span> ret;

  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (bgp_static);
  <span class="keywordflow">if</span> (!bgp_static)
    <span class="keywordflow">return</span>;

  rn = <a class="code" href="bgp__route_8c.html#a28376b150f4dc5678918739889f323e6">bgp_afi_node_get</a> (bgp-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[afi][safi], afi, safi, p, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);

  <a class="code" href="bgp__attr_8c.html#afe11e9b57f736617eca855aceae26f28">bgp_attr_default_set</a> (&amp;attr, <a class="code" href="bgpd_8h.html#a23e729207777c4691b94d476003c6ac9">BGP_ORIGIN_IGP</a>);
  
  attr.<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a> = bgp_static-&gt;<a class="code" href="structbgp__static.html#aa8f62625fb60ace77000a35d31b0e97b">igpnexthop</a>;
  attr.<a class="code" href="structattr.html#a2dc4bc77a20816cd457a2040b05e316f">med</a> = bgp_static-&gt;<a class="code" href="structbgp__static.html#ab33ff97c3d3849126cf93af1ad2da41f">igpmetric</a>;
  attr.<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> |= <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#a2f0c3d68f255eba5612c46147522334e">BGP_ATTR_MULTI_EXIT_DISC</a>);

  <span class="keywordflow">if</span> (bgp_static-&gt;<a class="code" href="structbgp__static.html#aaad8a5db923a971cbbd054f20ccaac1c">ttl</a>)
    {
      attr.<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> |= <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#a50c0b7675e41454193cd4e22cb448a99">BGP_ATTR_AS_PATHLIMIT</a>);
      attr.<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> |= <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#ac9dd85ed3793e51210453da60a8734b9">BGP_ATTR_ATOMIC_AGGREGATE</a>);
      attr.<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a8a6b5eec215a881c600ce5556b6a91db">as</a> = 0;
      attr.<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a0f7b3d80060491aa2bc639577e660089">ttl</a> = bgp_static-&gt;<a class="code" href="structbgp__static.html#aaad8a5db923a971cbbd054f20ccaac1c">ttl</a>;
    }

  <span class="keywordflow">if</span> (bgp_static-&gt;<a class="code" href="structbgp__static.html#ab4d379ac74eae4070e11b425e938a0e8">atomic</a>)
    attr.<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> |= <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#ac9dd85ed3793e51210453da60a8734b9">BGP_ATTR_ATOMIC_AGGREGATE</a>);

  <span class="comment">/* Apply route-map. */</span>
  <span class="keywordflow">if</span> (bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#ad76c828cf9c061f483a3ed7220649b51">name</a>)
    {
      <span class="keyword">struct </span>attr attr_tmp = attr;
      info.peer = bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>;
      info.attr = &amp;attr_tmp;

      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a>, <a class="code" href="bgpd_8h.html#a28df478bfbd24d69abf01dcee51aaa48">PEER_RMAP_TYPE_NETWORK</a>);

      ret = <a class="code" href="routemap_8c.html#a3372553a024332702cfd603e1f4c08d6">route_map_apply</a> (bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#a66a99ae86e2b6f3496a481b7bfd300e9">map</a>, p, <a class="code" href="routemap_8h.html#ae21439463f873ce0ce1556c9d6fa7370adcb3bc0f6448923a387dfe3658ca7bda">RMAP_BGP</a>, &amp;info);

      bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a> = 0;

      <span class="keywordflow">if</span> (ret == <a class="code" href="routemap_8h.html#afd7345bfd662f1e7c77f0be351cd1516aa0f40f0a91e43bfe7131839fe179ac64">RMAP_DENYMATCH</a>)
    {    
      <span class="comment">/* Free uninterned attribute. */</span>
      <a class="code" href="bgp__attr_8c.html#a3ea9ed94bcd0236f8f83310615e7c022">bgp_attr_flush</a> (&amp;attr_tmp);

      <span class="comment">/* Unintern original. */</span>
      <a class="code" href="bgp__aspath_8c.html#a414aa289179196886d9f059bdd41e81c">aspath_unintern</a> (attr.<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
      <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;attr);
      <a class="code" href="bgp__route_8c.html#a14bde9043b6db15a3327081054b54dbe">bgp_static_withdraw</a> (bgp, p, afi, safi);
      <span class="keywordflow">return</span>;
    }
      attr_new = <a class="code" href="bgp__attr_8c.html#a791a2194bc7791b769c6ce55ac37b387">bgp_attr_intern</a> (&amp;attr_tmp);
    }
  <span class="keywordflow">else</span>
    attr_new = <a class="code" href="bgp__attr_8c.html#a791a2194bc7791b769c6ce55ac37b387">bgp_attr_intern</a> (&amp;attr);

  <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
    <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> == bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a> &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a7d70d35aa6ab6fa769c8e7d662288a35">type</a> == <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a>
    &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a3c52611f8ef467c61080e1444b91d73d">BGP_ROUTE_STATIC</a>)
      <span class="keywordflow">break</span>;

  <span class="keywordflow">if</span> (ri)
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__attr_8c.html#a95c1ea9ce12032797eb35c31ad20180d">attrhash_cmp</a> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>, attr_new) &amp;&amp;
      !<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a0ff836da32782fe548f3fe570e5107e7">BGP_INFO_REMOVED</a>))
    {
      <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
      <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (attr_new);
      <a class="code" href="bgp__aspath_8c.html#a414aa289179196886d9f059bdd41e81c">aspath_unintern</a> (attr.<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
      <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;attr);
      <span class="keywordflow">return</span>;
    }
      <span class="keywordflow">else</span>
    {
      <span class="comment">/* The attribute is changed. */</span>
      <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#abf27b05ce5e7ef154318fb01c218d611">BGP_INFO_ATTR_CHANGED</a>);

      <span class="comment">/* Rewrite BGP route information. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a0ff836da32782fe548f3fe570e5107e7">BGP_INFO_REMOVED</a>))
        <a class="code" href="bgp__route_8c.html#ae6999426a3503ae94836d8e1c040e38c">bgp_info_restore</a>(rn, ri);
      <span class="keywordflow">else</span>
        <a class="code" href="bgp__route_8h.html#a91162dd024d89c577f51b3615b75496f">bgp_aggregate_decrement</a> (bgp, p, ri, afi, safi);
      <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>);
      ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a> = attr_new;
      ri-&gt;<a class="code" href="structbgp__info.html#adb8b5aba2ea49640e700fa870b7f5426">uptime</a> = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();

      <span class="comment">/* Process change. */</span>
      <a class="code" href="bgp__route_8h.html#ac218a5ef2e04869ebdac5ea9bfbf19e2">bgp_aggregate_increment</a> (bgp, p, ri, afi, safi);
      <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);
      <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
      <a class="code" href="bgp__aspath_8c.html#a414aa289179196886d9f059bdd41e81c">aspath_unintern</a> (attr.<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
      <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;attr);
      <span class="keywordflow">return</span>;
    }
    }

  <span class="comment">/* Make new BGP info. */</span>
  <span class="keyword">new</span> = <a class="code" href="bgp__route_8c.html#ac58054377984aaf2a3436dfe2ca91e53">bgp_info_new</a> ();
  <span class="keyword">new</span>-&gt;type = <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a>;
  <span class="keyword">new</span>-&gt;sub_type = <a class="code" href="bgp__route_8h.html#a3c52611f8ef467c61080e1444b91d73d">BGP_ROUTE_STATIC</a>;
  <span class="keyword">new</span>-&gt;peer = bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>;
  <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (new-&gt;flags, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>);
  <span class="keyword">new</span>-&gt;attr = attr_new;
  <span class="keyword">new</span>-&gt;uptime = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();

  <span class="comment">/* Aggregate address increment. */</span>
  <a class="code" href="bgp__route_8h.html#ac218a5ef2e04869ebdac5ea9bfbf19e2">bgp_aggregate_increment</a> (bgp, p, <span class="keyword">new</span>, afi, safi);
  
  <span class="comment">/* Register new BGP information. */</span>
  <a class="code" href="bgp__route_8c.html#ac7472ce06f993cd544f794c7b0381954">bgp_info_add</a> (rn, <span class="keyword">new</span>);
  
  <span class="comment">/* route_node_get lock */</span>
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
  
  <span class="comment">/* Process change. */</span>
  <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);

  <span class="comment">/* Unintern original. */</span>
  <a class="code" href="bgp__aspath_8c.html#a414aa289179196886d9f059bdd41e81c">aspath_unintern</a> (attr.<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
  <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;attr);
}
</pre></div>
</div>
</div>
<a class="anchor" id="adde0f36163e0fb2c47de7cf95f8bbe56"></a><!-- doxytag: member="bgp_route.c::bgp_static_update_rsclient" ref="adde0f36163e0fb2c47de7cf95f8bbe56" args="(struct peer *rsclient, struct prefix *p, struct bgp_static *bgp_static, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_static_update_rsclient </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>rsclient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbgp__static.html">bgp_static</a> *&#160;</td>
          <td class="paramname"><em>bgp_static</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03213">3213</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *<span class="keyword">new</span>;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> info;
  <span class="keyword">struct </span><a class="code" href="structattr.html">attr</a> *attr_new;
  <span class="keyword">struct </span><a class="code" href="structattr.html">attr</a> <a class="code" href="structattr.html">attr</a> = {0 };
  <span class="keyword">struct </span>attr new_attr = { .<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a> = 0 };
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
  <span class="keywordtype">int</span> ret;
  <span class="keywordtype">char</span> buf[<a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>];

  bgp = rsclient-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>;

  <a class="code" href="regex_8c.html#ad6d5aaa966ca7424f7cb9bd01f2c838b">assert</a> (bgp_static);
  <span class="keywordflow">if</span> (!bgp_static)
    <span class="keywordflow">return</span>;

  rn = <a class="code" href="bgp__route_8c.html#a28376b150f4dc5678918739889f323e6">bgp_afi_node_get</a> (rsclient-&gt;<a class="code" href="structpeer.html#a7e8ca2a0bcdc168c59140e710a1f2060">rib</a>[afi][safi], afi, safi, p, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);

  <a class="code" href="bgp__attr_8c.html#afe11e9b57f736617eca855aceae26f28">bgp_attr_default_set</a> (&amp;attr, <a class="code" href="bgpd_8h.html#a23e729207777c4691b94d476003c6ac9">BGP_ORIGIN_IGP</a>);

  attr.<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a> = bgp_static-&gt;<a class="code" href="structbgp__static.html#aa8f62625fb60ace77000a35d31b0e97b">igpnexthop</a>;
  attr.<a class="code" href="structattr.html#a2dc4bc77a20816cd457a2040b05e316f">med</a> = bgp_static-&gt;<a class="code" href="structbgp__static.html#ab33ff97c3d3849126cf93af1ad2da41f">igpmetric</a>;
  attr.<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> |= <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#a2f0c3d68f255eba5612c46147522334e">BGP_ATTR_MULTI_EXIT_DISC</a>);
  
  <span class="keywordflow">if</span> (bgp_static-&gt;<a class="code" href="structbgp__static.html#aaad8a5db923a971cbbd054f20ccaac1c">ttl</a>)
    {
      attr.<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> |= <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#a50c0b7675e41454193cd4e22cb448a99">BGP_ATTR_AS_PATHLIMIT</a>);
      attr.<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> |= <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#ac9dd85ed3793e51210453da60a8734b9">BGP_ATTR_ATOMIC_AGGREGATE</a>);
      attr.<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a8a6b5eec215a881c600ce5556b6a91db">as</a> = 0;
      attr.<a class="code" href="structattr.html#a3f18193ca657879db94778fdcbe1762a">pathlimit</a>.<a class="code" href="structattr.html#a0f7b3d80060491aa2bc639577e660089">ttl</a> = bgp_static-&gt;<a class="code" href="structbgp__static.html#aaad8a5db923a971cbbd054f20ccaac1c">ttl</a>;
    }
  
  <span class="keywordflow">if</span> (bgp_static-&gt;<a class="code" href="structbgp__static.html#ab4d379ac74eae4070e11b425e938a0e8">atomic</a>)
    attr.<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> |= <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#ac9dd85ed3793e51210453da60a8734b9">BGP_ATTR_ATOMIC_AGGREGATE</a>);
  
  <span class="comment">/* Apply network route-map for export to this rsclient. */</span>
  <span class="keywordflow">if</span> (bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#ad76c828cf9c061f483a3ed7220649b51">name</a>)
    {
      <span class="keyword">struct </span>attr attr_tmp = attr;
      info.peer = rsclient;
      info.attr = &amp;attr_tmp;
      
      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (rsclient-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a>, <a class="code" href="bgpd_8h.html#a5d239df7c366c66f144cac26eea3c7f9">PEER_RMAP_TYPE_EXPORT</a>);
      <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (rsclient-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a>, <a class="code" href="bgpd_8h.html#a28df478bfbd24d69abf01dcee51aaa48">PEER_RMAP_TYPE_NETWORK</a>);

      ret = <a class="code" href="routemap_8c.html#a3372553a024332702cfd603e1f4c08d6">route_map_apply</a> (bgp_static-&gt;<a class="code" href="structbgp__static.html#acd6110748ccb4b1b26d292f02ede2a16">rmap</a>.<a class="code" href="structbgp__static.html#a66a99ae86e2b6f3496a481b7bfd300e9">map</a>, p, <a class="code" href="routemap_8h.html#ae21439463f873ce0ce1556c9d6fa7370adcb3bc0f6448923a387dfe3658ca7bda">RMAP_BGP</a>, &amp;info);

      rsclient-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a> = 0;

      <span class="keywordflow">if</span> (ret == <a class="code" href="routemap_8h.html#afd7345bfd662f1e7c77f0be351cd1516aa0f40f0a91e43bfe7131839fe179ac64">RMAP_DENYMATCH</a>)
        {
          <span class="comment">/* Free uninterned attribute. */</span>
          <a class="code" href="bgp__attr_8c.html#a3ea9ed94bcd0236f8f83310615e7c022">bgp_attr_flush</a> (&amp;attr_tmp);

          <span class="comment">/* Unintern original. */</span>
          <a class="code" href="bgp__aspath_8c.html#a414aa289179196886d9f059bdd41e81c">aspath_unintern</a> (attr.<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
          <a class="code" href="bgp__route_8c.html#aa0a729167c9cf61c833c3c12a7c35e9a">bgp_static_withdraw_rsclient</a> (bgp, rsclient, p, afi, safi);
          <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;attr);
          
          <span class="keywordflow">return</span>;
        }
      attr_new = <a class="code" href="bgp__attr_8c.html#a791a2194bc7791b769c6ce55ac37b387">bgp_attr_intern</a> (&amp;attr_tmp);
    }
  <span class="keywordflow">else</span>
    attr_new = <a class="code" href="bgp__attr_8c.html#a791a2194bc7791b769c6ce55ac37b387">bgp_attr_intern</a> (&amp;attr);
  
  new_attr = *attr_new;
  
  <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a>, <a class="code" href="bgpd_8h.html#a28df478bfbd24d69abf01dcee51aaa48">PEER_RMAP_TYPE_NETWORK</a>);

  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8c.html#a0b543935bc92b0cd8fa61813637f0179">bgp_import_modifier</a> (rsclient, bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>, p, &amp;new_attr, afi, safi) 
        == <a class="code" href="routemap_8h.html#a57b0063c49d180ad8b9d19ae35d7e644ad79be2f4afd690ef956924415e6724bf">RMAP_DENY</a>)
    {
      <span class="comment">/* This BGP update is filtered.  Log the reason then update BGP entry.  */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))
              <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (rsclient-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
              <span class="stringliteral">&quot;Static UPDATE about %s/%d -- DENIED for RS-client %s due to: import-policy&quot;</span>,
              <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
              p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>, rsclient-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);

      bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a> = 0;

      <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (attr_new);
      <a class="code" href="bgp__aspath_8c.html#a414aa289179196886d9f059bdd41e81c">aspath_unintern</a> (attr.<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
      <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;attr);

      <a class="code" href="bgp__route_8c.html#aa0a729167c9cf61c833c3c12a7c35e9a">bgp_static_withdraw_rsclient</a> (bgp, rsclient, p, afi, safi);
      
      <span class="keywordflow">return</span>;
    }

  bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>-&gt;<a class="code" href="structpeer.html#afad0d7ca0b1d0d8bdea5bb8eaba1ef65">rmap_type</a> = 0;

  <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (attr_new);
  attr_new = <a class="code" href="bgp__attr_8c.html#a791a2194bc7791b769c6ce55ac37b387">bgp_attr_intern</a> (&amp;new_attr);

  <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
    <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> == bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a> &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a7d70d35aa6ab6fa769c8e7d662288a35">type</a> == <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a>
            &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a3c52611f8ef467c61080e1444b91d73d">BGP_ROUTE_STATIC</a>)
      <span class="keywordflow">break</span>;

  <span class="keywordflow">if</span> (ri)
       {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__attr_8c.html#a95c1ea9ce12032797eb35c31ad20180d">attrhash_cmp</a> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>, attr_new) &amp;&amp;
      !<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a0ff836da32782fe548f3fe570e5107e7">BGP_INFO_REMOVED</a>))
        {
          <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
          <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (attr_new);
          <a class="code" href="bgp__aspath_8c.html#a414aa289179196886d9f059bdd41e81c">aspath_unintern</a> (attr.<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
          <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;attr);
          <span class="keywordflow">return</span>;
       }
      <span class="keywordflow">else</span>
        {
          <span class="comment">/* The attribute is changed. */</span>
          <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#abf27b05ce5e7ef154318fb01c218d611">BGP_INFO_ATTR_CHANGED</a>);

          <span class="comment">/* Rewrite BGP route information. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a0ff836da32782fe548f3fe570e5107e7">BGP_INFO_REMOVED</a>))
        <a class="code" href="bgp__route_8c.html#ae6999426a3503ae94836d8e1c040e38c">bgp_info_restore</a>(rn, ri);
          <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>);
          ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a> = attr_new;
          ri-&gt;<a class="code" href="structbgp__info.html#adb8b5aba2ea49640e700fa870b7f5426">uptime</a> = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();

          <span class="comment">/* Process change. */</span>
          <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);
          <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
          <a class="code" href="bgp__aspath_8c.html#a414aa289179196886d9f059bdd41e81c">aspath_unintern</a> (attr.<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
          <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;attr);
          <span class="keywordflow">return</span>;
        }
    }
  
  <span class="comment">/* Make new BGP info. */</span>
  <span class="keyword">new</span> = <a class="code" href="bgp__route_8c.html#ac58054377984aaf2a3436dfe2ca91e53">bgp_info_new</a> ();
  <span class="keyword">new</span>-&gt;type = <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a>;
  <span class="keyword">new</span>-&gt;sub_type = <a class="code" href="bgp__route_8h.html#a3c52611f8ef467c61080e1444b91d73d">BGP_ROUTE_STATIC</a>;
  <span class="keyword">new</span>-&gt;peer = bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>;
  <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (new-&gt;flags, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>);
  <span class="keyword">new</span>-&gt;attr = attr_new;
  <span class="keyword">new</span>-&gt;uptime = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();

  <span class="comment">/* Register new BGP information. */</span>
  <a class="code" href="bgp__route_8c.html#ac7472ce06f993cd544f794c7b0381954">bgp_info_add</a> (rn, <span class="keyword">new</span>);
  
  <span class="comment">/* route_node_get lock */</span>
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
  
  <span class="comment">/* Process change. */</span>
  <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);

  <span class="comment">/* Unintern original. */</span>
  <a class="code" href="bgp__aspath_8c.html#a414aa289179196886d9f059bdd41e81c">aspath_unintern</a> (attr.<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>);
  <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;attr);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a993bebd87ca0ad9166c4e65c697c9f79"></a><!-- doxytag: member="bgp_route.c::bgp_static_update_vpnv4" ref="a993bebd87ca0ad9166c4e65c697c9f79" args="(struct bgp *bgp, struct prefix *p, u_int16_t afi, u_char safi, struct prefix_rd *prd, u_char *tag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_static_update_vpnv4 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int16_t&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *&#160;</td>
          <td class="paramname"><em>prd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>tag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03521">3521</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *<span class="keyword">new</span>;
  
  rn = <a class="code" href="bgp__route_8c.html#a28376b150f4dc5678918739889f323e6">bgp_afi_node_get</a> (bgp-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[afi][safi], afi, safi, p, prd);

  <span class="comment">/* Make new BGP info. */</span>
  <span class="keyword">new</span> = <a class="code" href="bgp__route_8c.html#ac58054377984aaf2a3436dfe2ca91e53">bgp_info_new</a> ();
  <span class="keyword">new</span>-&gt;type = <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a>;
  <span class="keyword">new</span>-&gt;sub_type = <a class="code" href="bgp__route_8h.html#a3c52611f8ef467c61080e1444b91d73d">BGP_ROUTE_STATIC</a>;
  <span class="keyword">new</span>-&gt;peer = bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>;
  <span class="keyword">new</span>-&gt;attr = <a class="code" href="bgp__attr_8c.html#a975568591569d47a1a18abf72484138a">bgp_attr_default_intern</a> (<a class="code" href="bgpd_8h.html#a23e729207777c4691b94d476003c6ac9">BGP_ORIGIN_IGP</a>);
  <a class="code" href="zebra_8h.html#a7c593725d5bbf27a37a922ae84b02333">SET_FLAG</a> (new-&gt;flags, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>);
  <span class="keyword">new</span>-&gt;uptime = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();
  <span class="keyword">new</span>-&gt;extra = <a class="code" href="bgp__route_8c.html#a87ee6a929c17bd9186e7125d5670a309">bgp_info_extra_new</a>();
  <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> (new-&gt;extra-&gt;tag, tag, 3);

  <span class="comment">/* Aggregate address increment. */</span>
  <a class="code" href="bgp__route_8h.html#ac218a5ef2e04869ebdac5ea9bfbf19e2">bgp_aggregate_increment</a> (bgp, p, <span class="keyword">new</span>, afi, safi);
  
  <span class="comment">/* Register new BGP information. */</span>
  <a class="code" href="bgp__route_8c.html#ac7472ce06f993cd544f794c7b0381954">bgp_info_add</a> (rn, <span class="keyword">new</span>);

  <span class="comment">/* route_node_get lock */</span>
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
  
  <span class="comment">/* Process change. */</span>
  <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a14bde9043b6db15a3327081054b54dbe"></a><!-- doxytag: member="bgp_route.c::bgp_static_withdraw" ref="a14bde9043b6db15a3327081054b54dbe" args="(struct bgp *bgp, struct prefix *p, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bgp_static_withdraw </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03554">3554</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;

  rn = <a class="code" href="bgp__route_8c.html#a28376b150f4dc5678918739889f323e6">bgp_afi_node_get</a> (bgp-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[afi][safi], afi, safi, p, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);

  <span class="comment">/* Check selected route and self inserted route. */</span>
  <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
    <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> == bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a> 
    &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a7d70d35aa6ab6fa769c8e7d662288a35">type</a> == <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a>
    &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a3c52611f8ef467c61080e1444b91d73d">BGP_ROUTE_STATIC</a>)
      <span class="keywordflow">break</span>;

  <span class="comment">/* Withdraw static BGP route from routing table. */</span>
  <span class="keywordflow">if</span> (ri)
    {
      <a class="code" href="bgp__route_8h.html#a91162dd024d89c577f51b3615b75496f">bgp_aggregate_decrement</a> (bgp, p, ri, afi, safi);
      <a class="code" href="bgp__route_8c.html#abfe260239e1b72a286e9c45a5aa1afbd">bgp_info_delete</a> (rn, ri);
      <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);
    }

  <span class="comment">/* Unlock bgp_node_lookup. */</span>
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa0a729167c9cf61c833c3c12a7c35e9a"></a><!-- doxytag: member="bgp_route.c::bgp_static_withdraw_rsclient" ref="aa0a729167c9cf61c833c3c12a7c35e9a" args="(struct bgp *bgp, struct peer *rsclient, struct prefix *p, afi_t afi, safi_t safi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_static_withdraw_rsclient </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>rsclient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03186">3186</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;

  rn = <a class="code" href="bgp__route_8c.html#a28376b150f4dc5678918739889f323e6">bgp_afi_node_get</a> (rsclient-&gt;<a class="code" href="structpeer.html#a7e8ca2a0bcdc168c59140e710a1f2060">rib</a>[afi][safi], afi, safi, p, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);

  <span class="comment">/* Check selected route and self inserted route. */</span>
  <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
    <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> == bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>
       &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a7d70d35aa6ab6fa769c8e7d662288a35">type</a> == <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a>
       &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a3c52611f8ef467c61080e1444b91d73d">BGP_ROUTE_STATIC</a>)
      <span class="keywordflow">break</span>;

  <span class="comment">/* Withdraw static BGP route from routing table. */</span>
  <span class="keywordflow">if</span> (ri)
    {
      <a class="code" href="bgp__route_8c.html#abfe260239e1b72a286e9c45a5aa1afbd">bgp_info_delete</a> (rn, ri);
      <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);
    }

  <span class="comment">/* Unlock bgp_node_lookup. */</span>
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a949bc552da03f5b91ab061802527294b"></a><!-- doxytag: member="bgp_route.c::bgp_static_withdraw_vpnv4" ref="a949bc552da03f5b91ab061802527294b" args="(struct bgp *bgp, struct prefix *p, u_int16_t afi, u_char safi, struct prefix_rd *prd, u_char *tag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_static_withdraw_vpnv4 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbgp.html">bgp</a> *&#160;</td>
          <td class="paramname"><em>bgp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int16_t&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *&#160;</td>
          <td class="paramname"><em>prd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>tag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l03602">3602</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;

  rn = <a class="code" href="bgp__route_8c.html#a28376b150f4dc5678918739889f323e6">bgp_afi_node_get</a> (bgp-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[afi][safi], afi, safi, p, prd);

  <span class="comment">/* Check selected route and self inserted route. */</span>
  <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
    <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> == bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a> 
    &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a7d70d35aa6ab6fa769c8e7d662288a35">type</a> == <a class="code" href="zebra_8h.html#a1991829492a88a5df46712d8782240a0">ZEBRA_ROUTE_BGP</a>
    &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="bgp__route_8h.html#a3c52611f8ef467c61080e1444b91d73d">BGP_ROUTE_STATIC</a>)
      <span class="keywordflow">break</span>;

  <span class="comment">/* Withdraw static BGP route from routing table. */</span>
  <span class="keywordflow">if</span> (ri)
    {
      <a class="code" href="bgp__route_8h.html#a91162dd024d89c577f51b3615b75496f">bgp_aggregate_decrement</a> (bgp, p, ri, afi, safi);
      <a class="code" href="bgp__route_8c.html#abfe260239e1b72a286e9c45a5aa1afbd">bgp_info_delete</a> (rn, ri);
      <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);
    }

  <span class="comment">/* Unlock bgp_node_lookup. */</span>
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
}
</pre></div>
</div>
</div>
<a class="anchor" id="adead0e338559e1bf15f14c261fbe975d"></a><!-- doxytag: member="bgp_route.c::bgp_update" ref="adead0e338559e1bf15f14c261fbe975d" args="(struct peer *peer, struct prefix *p, struct attr *attr, afi_t afi, safi_t safi, int type, int sub_type, struct prefix_rd *prd, u_char *tag, int soft_reconfig)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_update </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sub_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *&#160;</td>
          <td class="paramname"><em>prd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>tag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>soft_reconfig</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02351">2351</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span>peer *rsclient;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
  <span class="keywordtype">int</span> ret;

  ret = <a class="code" href="bgp__route_8c.html#a2a2424f26bef521959d23ff57611f86a">bgp_update_main</a> (peer, p, attr, afi, safi, <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a>, sub_type, prd, tag,
          soft_reconfig);

  bgp = peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>;

  <span class="comment">/* Process the update for each RS-client. */</span>
  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (bgp-&gt;<a class="code" href="structbgp.html#a4ccd4dea11eddfa74dc5518fdb448b67">rsclient</a>, node, nnode, rsclient))
    {
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (rsclient-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#abf59e9a9022e80ecdc266d86f35b378e">PEER_FLAG_RSERVER_CLIENT</a>))
        <a class="code" href="bgp__route_8c.html#a35a6938b2231aa460e1ce4a1d767b89f">bgp_update_rsclient</a> (rsclient, afi, safi, attr, peer, p, <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a>,
                sub_type, prd, tag);
    }

  <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2a2424f26bef521959d23ff57611f86a"></a><!-- doxytag: member="bgp_route.c::bgp_update_main" ref="a2a2424f26bef521959d23ff57611f86a" args="(struct peer *peer, struct prefix *p, struct attr *attr, afi_t afi, safi_t safi, int type, int sub_type, struct prefix_rd *prd, u_char *tag, int soft_reconfig)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bgp_update_main </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sub_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *&#160;</td>
          <td class="paramname"><em>prd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>tag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>soft_reconfig</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02024">2024</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ret;
  <span class="keywordtype">int</span> aspath_loop_count = 0;
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
  <span class="keyword">struct </span>attr new_attr = { 0 };
  <span class="keyword">struct </span>attr *attr_new;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *<span class="keyword">new</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> *reason;
  <span class="keywordtype">char</span> buf[<a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>];

  bgp = peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>;
  rn = <a class="code" href="bgp__route_8c.html#a28376b150f4dc5678918739889f323e6">bgp_afi_node_get</a> (bgp-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[afi][safi], afi, safi, p, prd);
  
  <span class="comment">/* When peer&#39;s soft reconfiguration enabled.  Record input packet in</span>
<span class="comment">     Adj-RIBs-In.  */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#aeb7f2d381386a92f2fb115c6e0b81dba">PEER_FLAG_SOFT_RECONFIG</a>)
      &amp;&amp; peer != bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a> &amp;&amp; ! soft_reconfig)
    <a class="code" href="bgp__advertise_8c.html#a77bcda74262e0f3ac53d98898bc76a55">bgp_adj_in_set</a> (rn, peer, attr);

  <span class="comment">/* Check previously received route. */</span>
  <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
    <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> == peer &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a7d70d35aa6ab6fa769c8e7d662288a35">type</a> == <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a> &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a>)
      <span class="keywordflow">break</span>;

  <span class="comment">/* AS path local-as loop check. */</span>
  <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structpeer.html#ae70f6bd98dc2d9ddc6ad6343804789b6">change_local_as</a>)
    {
      <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a3f18e3da00909bb1ce53919fd7129b54">flags</a>, <a class="code" href="bgpd_8h.html#aa3c7030de392ba4a8c79018101651a7f">PEER_FLAG_LOCAL_AS_NO_PREPEND</a>))
    aspath_loop_count = 1;

      <span class="keywordflow">if</span> (<a class="code" href="bgp__aspath_8c.html#a09c83e4313915a5191a19439186f2280">aspath_loop_check</a> (attr-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>, peer-&gt;<a class="code" href="structpeer.html#ae70f6bd98dc2d9ddc6ad6343804789b6">change_local_as</a>) &gt; aspath_loop_count) 
    {
      reason = <span class="stringliteral">&quot;as-path contains our own AS;&quot;</span>;
      <span class="keywordflow">goto</span> filtered;
    }
    }

  <span class="comment">/* AS path loop check. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__aspath_8c.html#a09c83e4313915a5191a19439186f2280">aspath_loop_check</a> (attr-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>, bgp-&gt;<a class="code" href="structbgp.html#a47faf46bdc2227fb56df263f60c099fb">as</a>) &gt; peer-&gt;<a class="code" href="structpeer.html#aa2a22da1a1352988f1d988e314631740">allowas_in</a>[afi][safi]
      || (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(bgp-&gt;<a class="code" href="structbgp.html#a3444d46283ecd1ecc8710fd44c331151">config</a>, <a class="code" href="bgpd_8h.html#a4170cb60239697ba9e788ac74e756ae3">BGP_CONFIG_CONFEDERATION</a>)
      &amp;&amp; <a class="code" href="bgp__aspath_8c.html#a09c83e4313915a5191a19439186f2280">aspath_loop_check</a>(attr-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>, bgp-&gt;<a class="code" href="structbgp.html#a57a1abec0cfd4f42ccdd002df8afb740">confed_id</a>)
      &gt; peer-&gt;<a class="code" href="structpeer.html#aa2a22da1a1352988f1d988e314631740">allowas_in</a>[afi][safi]))
    {
      reason = <span class="stringliteral">&quot;as-path contains our own AS;&quot;</span>;
      <span class="keywordflow">goto</span> filtered;
    }

  <span class="comment">/* Route reflector originator ID check.  */</span>
  <span class="keywordflow">if</span> (attr-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp; <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#a4c57fcfdf8e83e8d6dce5369a9697244">BGP_ATTR_ORIGINATOR_ID</a>)
      &amp;&amp; <a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a> (&amp;bgp-&gt;<a class="code" href="structbgp.html#ac85364afca7a6afc7c184148355318a7">router_id</a>, &amp;attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#a2a675121474a39bf5d9f95393b00e156">originator_id</a>))
    {
      reason = <span class="stringliteral">&quot;originator is us;&quot;</span>;
      <span class="keywordflow">goto</span> filtered;
    }

  <span class="comment">/* Route reflector cluster ID check.  */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8c.html#a7e09865b6ccdcb2325e714cffa6ed5f2">bgp_cluster_filter</a> (peer, attr))
    {
      reason = <span class="stringliteral">&quot;reflected from the same cluster;&quot;</span>;
      <span class="keywordflow">goto</span>  filtered;
    }

  <span class="comment">/* Apply incoming filter.  */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8c.html#a779dd558c9e37130d6ac9029b74cdf12">bgp_input_filter</a> (peer, p, attr, afi, safi) == <a class="code" href="filter_8h.html#ab3b7281956317556f846daaebf75de72a898abadf6cc2f9d27780782f09d3a3e3">FILTER_DENY</a>)
    {
      reason = <span class="stringliteral">&quot;filter;&quot;</span>;
      <span class="keywordflow">goto</span> filtered;
    }

  <span class="comment">/* Apply incoming route-map. */</span>
  <a class="code" href="bgp__attr_8c.html#a39f33acb3fdd3ade629a9b7d66e74ea9">bgp_attr_dup</a> (&amp;new_attr, attr);

  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8c.html#a2f762007f1c8ecfd0a06a8430d1e0523">bgp_input_modifier</a> (peer, p, &amp;new_attr, afi, safi) == <a class="code" href="routemap_8h.html#a57b0063c49d180ad8b9d19ae35d7e644ad79be2f4afd690ef956924415e6724bf">RMAP_DENY</a>)
    {
      reason = <span class="stringliteral">&quot;route-map;&quot;</span>;
      <span class="keywordflow">goto</span> filtered;
    }

  <span class="comment">/* IPv4 unicast next hop check.  */</span>
  <span class="keywordflow">if</span> (afi == <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> &amp;&amp; safi == <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>)
    {
      <span class="comment">/* If the peer is EBGP and nexthop is not on connected route,</span>
<span class="comment">     discard it.  */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a> &amp;&amp; peer-&gt;<a class="code" href="structpeer.html#adb765fb0aec575c436ba1e465e9eb4bd">ttl</a> == 1
      &amp;&amp; ! <a class="code" href="bgp__nexthop_8c.html#a30cf2195d772dfb889c717a86cd19629">bgp_nexthop_check_ebgp</a> (afi, &amp;new_attr)
      &amp;&amp; ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a3f18e3da00909bb1ce53919fd7129b54">flags</a>, <a class="code" href="bgpd_8h.html#a22a47f83fdcd884acb2b84e04c085797">PEER_FLAG_DISABLE_CONNECTED_CHECK</a>))
    {
      reason = <span class="stringliteral">&quot;non-connected next-hop;&quot;</span>;
      <span class="keywordflow">goto</span> filtered;
    }

      <span class="comment">/* Next hop must not be 0.0.0.0 nor Class E address.  Next hop</span>
<span class="comment">     must not be my own address.  */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgp__nexthop_8c.html#af096de71945dda80bbb7dbb1df574c90">bgp_nexthop_self</a> (afi, &amp;new_attr)
      || new_attr.<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>.s_addr == 0
      || ntohl (new_attr.<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>.s_addr) &gt;= 0xe0000000)
    {
      reason = <span class="stringliteral">&quot;martian next-hop;&quot;</span>;
      <span class="keywordflow">goto</span> filtered;
    }
    }

  attr_new = <a class="code" href="bgp__attr_8c.html#a791a2194bc7791b769c6ce55ac37b387">bgp_attr_intern</a> (&amp;new_attr);

  <span class="comment">/* If the update is implicit withdraw. */</span>
  <span class="keywordflow">if</span> (ri)
    {
      ri-&gt;<a class="code" href="structbgp__info.html#adb8b5aba2ea49640e700fa870b7f5426">uptime</a> = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();

      <span class="comment">/* Same attribute comes in. */</span>
      <span class="keywordflow">if</span> (!<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a0ff836da32782fe548f3fe570e5107e7">BGP_INFO_REMOVED</a>) 
          &amp;&amp; <a class="code" href="bgp__attr_8c.html#a95c1ea9ce12032797eb35c31ad20180d">attrhash_cmp</a> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>, attr_new))
    {
      <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#abf27b05ce5e7ef154318fb01c218d611">BGP_INFO_ATTR_CHANGED</a>);

      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (bgp-&gt;<a class="code" href="structbgp.html#a30da262ef5f391dae5c93ed04cf243c4">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a1f74f91741ac0799c3348ce5f9e82992">BGP_CONFIG_DAMPENING</a>)
          &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a>
          &amp;&amp; <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a57adf9fc517cc65fb9f4bcbf8ff796f2">BGP_INFO_HISTORY</a>))
        {
          <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))  
          <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG, <span class="stringliteral">&quot;%s rcvd %s/%d&quot;</span>,
          peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
          <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a>(p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
          p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>);

          <span class="keywordflow">if</span> (<a class="code" href="bgp__damp_8c.html#ab12b23e18629cfff0fcc114ca69829d5">bgp_damp_update</a> (ri, rn, afi, safi) != <a class="code" href="bgp__damp_8h.html#a0f58b7873622a8c3d2e28d38e30719e4">BGP_DAMP_SUPPRESSED</a>)
            {
                  <a class="code" href="bgp__route_8h.html#ac218a5ef2e04869ebdac5ea9bfbf19e2">bgp_aggregate_increment</a> (bgp, p, ri, afi, safi);
                  <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);
                }
        }
          <span class="keywordflow">else</span> <span class="comment">/* Duplicate - odd */</span>
        {
          <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))  
        <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
        <span class="stringliteral">&quot;%s rcvd %s/%d...duplicate ignored&quot;</span>,
        peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
        <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a>(p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
        p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>);

          <span class="comment">/* graceful restart STALE flag unset. */</span>
          <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a455eac0750f63b056c8c5aff39222927">BGP_INFO_STALE</a>))
        {
          <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#a455eac0750f63b056c8c5aff39222927">BGP_INFO_STALE</a>);
          <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);
        }
        }

      <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
      <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (attr_new);
      <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;new_attr);
      
      <span class="keywordflow">return</span> 0;
    }

      <span class="comment">/* Withdraw/Announce before we fully processed the withdraw */</span>
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a0ff836da32782fe548f3fe570e5107e7">BGP_INFO_REMOVED</a>))
        {
          <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))
            <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG, <span class="stringliteral">&quot;%s rcvd %s/%d, flapped quicker than processing&quot;</span>,
            peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
            <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a>(p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
            p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>);
          <a class="code" href="bgp__route_8c.html#ae6999426a3503ae94836d8e1c040e38c">bgp_info_restore</a> (rn, ri);
        }

      <span class="comment">/* Received Logging. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))  
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG, <span class="stringliteral">&quot;%s rcvd %s/%d&quot;</span>,
          peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
          <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a>(p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
          p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>);

      <span class="comment">/* graceful restart STALE flag unset. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a455eac0750f63b056c8c5aff39222927">BGP_INFO_STALE</a>))
    <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#a455eac0750f63b056c8c5aff39222927">BGP_INFO_STALE</a>);

      <span class="comment">/* The attribute is changed. */</span>
      <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#abf27b05ce5e7ef154318fb01c218d611">BGP_INFO_ATTR_CHANGED</a>);
      
      <span class="comment">/* implicit withdraw, decrement aggregate and pcount here.</span>
<span class="comment">       * only if update is accepted, they&#39;ll increment below.</span>
<span class="comment">       */</span>
      <a class="code" href="bgp__route_8h.html#a91162dd024d89c577f51b3615b75496f">bgp_aggregate_decrement</a> (bgp, p, ri, afi, safi);
      
      <span class="comment">/* Update bgp route dampening information.  */</span>
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (bgp-&gt;<a class="code" href="structbgp.html#a30da262ef5f391dae5c93ed04cf243c4">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a1f74f91741ac0799c3348ce5f9e82992">BGP_CONFIG_DAMPENING</a>)
      &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a>)
    {
      <span class="comment">/* This is implicit withdraw so we should update dampening</span>
<span class="comment">         information.  */</span>
      <span class="keywordflow">if</span> (! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a57adf9fc517cc65fb9f4bcbf8ff796f2">BGP_INFO_HISTORY</a>))
        <a class="code" href="bgp__damp_8c.html#a6495e2d88335e918ccca6f80fa52cee9">bgp_damp_withdraw</a> (ri, rn, afi, safi, 1);  
    }
    
      <span class="comment">/* Update to new attribute.  */</span>
      <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>);
      ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a> = attr_new;

      <span class="comment">/* Update MPLS tag.  */</span>
      <span class="keywordflow">if</span> (safi == <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
        <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> ((<a class="code" href="bgp__route_8c.html#a3afeebe128032bb8a486915820234af9">bgp_info_extra_get</a> (ri))-&gt;tag, tag, 3);

      <span class="comment">/* Update bgp route dampening information.  */</span>
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (bgp-&gt;<a class="code" href="structbgp.html#a30da262ef5f391dae5c93ed04cf243c4">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#a1f74f91741ac0799c3348ce5f9e82992">BGP_CONFIG_DAMPENING</a>)
      &amp;&amp; <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a>)
    {
      <span class="comment">/* Now we do normal update dampening.  */</span>
      ret = <a class="code" href="bgp__damp_8c.html#ab12b23e18629cfff0fcc114ca69829d5">bgp_damp_update</a> (ri, rn, afi, safi);
      <span class="keywordflow">if</span> (ret == <a class="code" href="bgp__damp_8h.html#a0f58b7873622a8c3d2e28d38e30719e4">BGP_DAMP_SUPPRESSED</a>)
        {
          <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
          <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;new_attr);
          <span class="keywordflow">return</span> 0;
        }
    }

      <span class="comment">/* Nexthop reachability check. */</span>
      <span class="keywordflow">if</span> ((afi == <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> || afi == <a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a>)
      &amp;&amp; safi == <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a> 
      &amp;&amp; (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a9e245a415718944a081734a08a8d7e92">BGP_PEER_IBGP</a>
              || <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a647ad85450d688c959849bc89cd9ccb8">BGP_PEER_CONFED</a>
          || (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a> &amp;&amp; peer-&gt;<a class="code" href="structpeer.html#adb765fb0aec575c436ba1e465e9eb4bd">ttl</a> != 1)
          || <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a3f18e3da00909bb1ce53919fd7129b54">flags</a>, <a class="code" href="bgpd_8h.html#a22a47f83fdcd884acb2b84e04c085797">PEER_FLAG_DISABLE_CONNECTED_CHECK</a>)))
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__nexthop_8c.html#add9ef5c38fe9bb5e1a0fd5d2975a1d36">bgp_nexthop_lookup</a> (afi, peer, ri, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
        <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>);
      <span class="keywordflow">else</span>
        <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>);
    }
      <span class="keywordflow">else</span>
        <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>);

      <span class="comment">/* Process change. */</span>
      <a class="code" href="bgp__route_8h.html#ac218a5ef2e04869ebdac5ea9bfbf19e2">bgp_aggregate_increment</a> (bgp, p, ri, afi, safi);

      <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);
      <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
      <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;new_attr);
      
      <span class="keywordflow">return</span> 0;
    }

  <span class="comment">/* Received Logging. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))  
    {
      <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG, <span class="stringliteral">&quot;%s rcvd %s/%d&quot;</span>,
        peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
        <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a>(p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
        p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>);
    }

  <span class="comment">/* Make new BGP info. */</span>
  <span class="keyword">new</span> = <a class="code" href="bgp__route_8c.html#ac58054377984aaf2a3436dfe2ca91e53">bgp_info_new</a> ();
  <span class="keyword">new</span>-&gt;type = <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a>;
  <span class="keyword">new</span>-&gt;sub_type = <a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a>;
  <span class="keyword">new</span>-&gt;peer = <a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>;
  <span class="keyword">new</span>-&gt;attr = attr_new;
  <span class="keyword">new</span>-&gt;uptime = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();

  <span class="comment">/* Update MPLS tag. */</span>
  <span class="keywordflow">if</span> (safi == <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
    <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> ((<a class="code" href="bgp__route_8c.html#a3afeebe128032bb8a486915820234af9">bgp_info_extra_get</a> (<span class="keyword">new</span>))-&gt;tag, tag, 3);

  <span class="comment">/* Nexthop reachability check. */</span>
  <span class="keywordflow">if</span> ((afi == <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> || afi == <a class="code" href="zebra_8h.html#ad10f30457e426e1d269466d3b6603c3c">AFI_IP6</a>)
      &amp;&amp; safi == <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>
      &amp;&amp; (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a9e245a415718944a081734a08a8d7e92">BGP_PEER_IBGP</a>
          || <a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635a647ad85450d688c959849bc89cd9ccb8">BGP_PEER_CONFED</a>
      || (<a class="code" href="bgpd_8c.html#af16a840274ca5f244f25c1ce3aa70aa2">peer_sort</a> (peer) == <a class="code" href="bgpd_8h.html#a726ca809ffd3d67ab4b8476646f26635ad00e75d3926c01967f5debfa4f9c4654">BGP_PEER_EBGP</a> &amp;&amp; peer-&gt;<a class="code" href="structpeer.html#adb765fb0aec575c436ba1e465e9eb4bd">ttl</a> != 1)
      || <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#a3f18e3da00909bb1ce53919fd7129b54">flags</a>, <a class="code" href="bgpd_8h.html#a22a47f83fdcd884acb2b84e04c085797">PEER_FLAG_DISABLE_CONNECTED_CHECK</a>)))
    {
      <span class="keywordflow">if</span> (<a class="code" href="bgp__nexthop_8c.html#add9ef5c38fe9bb5e1a0fd5d2975a1d36">bgp_nexthop_lookup</a> (afi, peer, <span class="keyword">new</span>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
    <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, <span class="keyword">new</span>, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>);
      <span class="keywordflow">else</span>
        <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, <span class="keyword">new</span>, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>);
    }
  <span class="keywordflow">else</span>
    <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, <span class="keyword">new</span>, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>);

  <span class="comment">/* Increment prefix */</span>
  <a class="code" href="bgp__route_8h.html#ac218a5ef2e04869ebdac5ea9bfbf19e2">bgp_aggregate_increment</a> (bgp, p, <span class="keyword">new</span>, afi, safi);
  
  <span class="comment">/* Register new BGP information. */</span>
  <a class="code" href="bgp__route_8c.html#ac7472ce06f993cd544f794c7b0381954">bgp_info_add</a> (rn, <span class="keyword">new</span>);
  
  <span class="comment">/* route_node_get lock */</span>
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
  
  <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;new_attr);
  
  <span class="comment">/* If maximum prefix count is configured and current prefix</span>
<span class="comment">     count exeed it. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8c.html#ace201bd3f5b8b07afc5143b88a179c55">bgp_maximum_prefix_overflow</a> (peer, afi, safi, 0))
    <span class="keywordflow">return</span> -1;

  <span class="comment">/* Process change. */</span>
  <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);

  <span class="keywordflow">return</span> 0;

  <span class="comment">/* This BGP update is filtered.  Log the reason then update BGP</span>
<span class="comment">     entry.  */</span>
 filtered:
  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
      <span class="stringliteral">&quot;%s rcvd UPDATE about %s/%d -- DENIED due to: %s&quot;</span>,
      peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
      <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
      p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>, reason);

  <span class="keywordflow">if</span> (ri)
    <a class="code" href="bgp__route_8c.html#af17eefd0fc4a1bd8d98f657810e26741">bgp_rib_remove</a> (rn, ri, peer, afi, safi);

  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
  
  <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;new_attr);
  
  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a35a6938b2231aa460e1ce4a1d767b89f"></a><!-- doxytag: member="bgp_route.c::bgp_update_rsclient" ref="a35a6938b2231aa460e1ce4a1d767b89f" args="(struct peer *rsclient, afi_t afi, safi_t safi, struct attr *attr, struct peer *peer, struct prefix *p, int type, int sub_type, struct prefix_rd *prd, u_char *tag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_update_rsclient </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>rsclient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sub_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *&#160;</td>
          <td class="paramname"><em>prd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>tag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01796">1796</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
  <span class="keyword">struct </span>attr new_attr = { 0 };
  <span class="keyword">struct </span>attr *attr_new;
  <span class="keyword">struct </span>attr *attr_new2;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *<span class="keyword">new</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> *reason;
  <span class="keywordtype">char</span> buf[<a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>];

  <span class="comment">/* Do not insert announces from a rsclient into its own &#39;bgp_table&#39;. */</span>
  <span class="keywordflow">if</span> (peer == rsclient)
    <span class="keywordflow">return</span>;

  bgp = peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>;
  rn = <a class="code" href="bgp__route_8c.html#a28376b150f4dc5678918739889f323e6">bgp_afi_node_get</a> (rsclient-&gt;<a class="code" href="structpeer.html#a7e8ca2a0bcdc168c59140e710a1f2060">rib</a>[afi][safi], afi, safi, p, prd);

  <span class="comment">/* Check previously received route. */</span>
  <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
    <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> == peer &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a7d70d35aa6ab6fa769c8e7d662288a35">type</a> == <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a> &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a>)
      <span class="keywordflow">break</span>;

  <span class="comment">/* AS path loop check. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__aspath_8c.html#a09c83e4313915a5191a19439186f2280">aspath_loop_check</a> (attr-&gt;<a class="code" href="structattr.html#a89311608450bb3b97bccc835e9b004f0">aspath</a>, rsclient-&gt;<a class="code" href="structpeer.html#aa35fab1a77bb496d8377a62cad372314">as</a>) &gt; peer-&gt;<a class="code" href="structpeer.html#aa2a22da1a1352988f1d988e314631740">allowas_in</a>[afi][safi])
    {
      reason = <span class="stringliteral">&quot;as-path contains our own AS;&quot;</span>;
      <span class="keywordflow">goto</span> filtered;
    }

  <span class="comment">/* Route reflector originator ID check.  */</span>
  <span class="keywordflow">if</span> (attr-&gt;<a class="code" href="structattr.html#aebb9bdb23b6f00d44b865ce30fac0713">flag</a> &amp; <a class="code" href="bgp__attr_8h.html#a708b3fe5f6403a639f57da84ea7b638a">ATTR_FLAG_BIT</a> (<a class="code" href="bgpd_8h.html#a4c57fcfdf8e83e8d6dce5369a9697244">BGP_ATTR_ORIGINATOR_ID</a>)
      &amp;&amp; <a class="code" href="prefix_8h.html#a52a7c965d0b22ca60fe38fa6c404dbcc">IPV4_ADDR_SAME</a> (&amp;rsclient-&gt;<a class="code" href="structpeer.html#ae620d85ff35b31ba9eb6073b81731b5b">remote_id</a>, &amp;attr-&gt;<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>-&gt;<a class="code" href="structattr__extra.html#a2a675121474a39bf5d9f95393b00e156">originator_id</a>))
    {
      reason = <span class="stringliteral">&quot;originator is us;&quot;</span>;
      <span class="keywordflow">goto</span> filtered;
    }
  
  <a class="code" href="bgp__attr_8c.html#a39f33acb3fdd3ade629a9b7d66e74ea9">bgp_attr_dup</a> (&amp;new_attr, attr);

  <span class="comment">/* Apply export policy. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#abf59e9a9022e80ecdc266d86f35b378e">PEER_FLAG_RSERVER_CLIENT</a>) &amp;&amp;
        <a class="code" href="bgp__route_8c.html#ad1c9f872f6253932e08bbc9d071f39c3">bgp_export_modifier</a> (rsclient, peer, p, &amp;new_attr, afi, safi) == <a class="code" href="routemap_8h.html#a57b0063c49d180ad8b9d19ae35d7e644ad79be2f4afd690ef956924415e6724bf">RMAP_DENY</a>)
    {
      reason = <span class="stringliteral">&quot;export-policy;&quot;</span>;
      <span class="keywordflow">goto</span> filtered;
    }

  attr_new2 = <a class="code" href="bgp__attr_8c.html#a791a2194bc7791b769c6ce55ac37b387">bgp_attr_intern</a> (&amp;new_attr);
  
  <span class="comment">/* Apply import policy. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__route_8c.html#a0b543935bc92b0cd8fa61813637f0179">bgp_import_modifier</a> (rsclient, peer, p, &amp;new_attr, afi, safi) == <a class="code" href="routemap_8h.html#a57b0063c49d180ad8b9d19ae35d7e644ad79be2f4afd690ef956924415e6724bf">RMAP_DENY</a>)
    {
      <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (attr_new2);

      reason = <span class="stringliteral">&quot;import-policy;&quot;</span>;
      <span class="keywordflow">goto</span> filtered;
    }

  attr_new = <a class="code" href="bgp__attr_8c.html#a791a2194bc7791b769c6ce55ac37b387">bgp_attr_intern</a> (&amp;new_attr);
  <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (attr_new2);

  <span class="comment">/* IPv4 unicast next hop check.  */</span>
  <span class="keywordflow">if</span> (afi == <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a> &amp;&amp; safi == <a class="code" href="zebra_8h.html#afb8a63d76f4951ff8d73c32256b4a497">SAFI_UNICAST</a>)
    {
     <span class="comment">/* Next hop must not be 0.0.0.0 nor Class E address. */</span>
      <span class="keywordflow">if</span> (new_attr.<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>.s_addr == 0
         || ntohl (new_attr.<a class="code" href="structattr.html#ab23f9ed5b7c55ea658ab6dc729bc9e63">nexthop</a>.s_addr) &gt;= 0xe0000000)
       {
         <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (attr_new);

         reason = <span class="stringliteral">&quot;martian next-hop;&quot;</span>;
         <span class="keywordflow">goto</span> filtered;
       }
    }
  
  <span class="comment">/* new_attr isn&#39;t passed to any functions after here */</span>
  <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;new_attr);
  
  <span class="comment">/* If the update is implicit withdraw. */</span>
  <span class="keywordflow">if</span> (ri)
    {
      ri-&gt;<a class="code" href="structbgp__info.html#adb8b5aba2ea49640e700fa870b7f5426">uptime</a> = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();

      <span class="comment">/* Same attribute comes in. */</span>
      <span class="keywordflow">if</span> (!<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a0ff836da32782fe548f3fe570e5107e7">BGP_INFO_REMOVED</a>)
          &amp;&amp; <a class="code" href="bgp__attr_8c.html#a95c1ea9ce12032797eb35c31ad20180d">attrhash_cmp</a> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>, attr_new))
        {

          <a class="code" href="bgp__route_8c.html#a818f5df3bcb251b38f290b27a95baca3">bgp_info_unset_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#abf27b05ce5e7ef154318fb01c218d611">BGP_INFO_ATTR_CHANGED</a>);

          <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))
            <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
                    <span class="stringliteral">&quot;%s rcvd %s/%d for RS-client %s...duplicate ignored&quot;</span>,
                    peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
                    <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a>(p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
                    p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>, rsclient-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);

          <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
          <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (attr_new);

          <span class="keywordflow">return</span>;
        }

      <span class="comment">/* Withdraw/Announce before we fully processed the withdraw */</span>
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a>(ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a0ff836da32782fe548f3fe570e5107e7">BGP_INFO_REMOVED</a>))
        <a class="code" href="bgp__route_8c.html#ae6999426a3503ae94836d8e1c040e38c">bgp_info_restore</a> (rn, ri);
      
      <span class="comment">/* Received Logging. */</span>
      <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))
        <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG, <span class="stringliteral">&quot;%s rcvd %s/%d for RS-client %s&quot;</span>,
                peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
                <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a>(p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
                p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>, rsclient-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);

      <span class="comment">/* The attribute is changed. */</span>
      <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#abf27b05ce5e7ef154318fb01c218d611">BGP_INFO_ATTR_CHANGED</a>);

      <span class="comment">/* Update to new attribute.  */</span>
      <a class="code" href="bgp__attr_8c.html#a6b097d8a087a66ad0f7497cb355ef864">bgp_attr_unintern</a> (ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a>);
      ri-&gt;<a class="code" href="structbgp__info.html#ac08a1276a0597228115a0f26aa9fe27a">attr</a> = attr_new;

      <span class="comment">/* Update MPLS tag.  */</span>
      <span class="keywordflow">if</span> (safi == <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
        <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> ((<a class="code" href="bgp__route_8c.html#a3afeebe128032bb8a486915820234af9">bgp_info_extra_get</a> (ri))-&gt;tag, tag, 3);

      <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, ri, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>);

      <span class="comment">/* Process change. */</span>
      <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);
      <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);

      <span class="keywordflow">return</span>;
    }

  <span class="comment">/* Received Logging. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))
    {
      <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG, <span class="stringliteral">&quot;%s rcvd %s/%d for RS-client %s&quot;</span>,
              peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
              <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a>(p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
              p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>, rsclient-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>);
    }

  <span class="comment">/* Make new BGP info. */</span>
  <span class="keyword">new</span> = <a class="code" href="bgp__route_8c.html#ac58054377984aaf2a3436dfe2ca91e53">bgp_info_new</a> ();
  <span class="keyword">new</span>-&gt;type = <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a>;
  <span class="keyword">new</span>-&gt;sub_type = <a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a>;
  <span class="keyword">new</span>-&gt;peer = <a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a>;
  <span class="keyword">new</span>-&gt;attr = attr_new;
  <span class="keyword">new</span>-&gt;uptime = <a class="code" href="bgpd_8c.html#a57400e51b671bd48e19b86df877be1e9">bgp_clock</a> ();

  <span class="comment">/* Update MPLS tag. */</span>
  <span class="keywordflow">if</span> (safi == <a class="code" href="zebra_8h.html#aea6a248ae05b01f7ff8faf6d8c8c6c10">SAFI_MPLS_VPN</a>)
    <a class="code" href="regex_8c.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a> ((<a class="code" href="bgp__route_8c.html#a3afeebe128032bb8a486915820234af9">bgp_info_extra_get</a> (<span class="keyword">new</span>))-&gt;tag, tag, 3);

  <a class="code" href="bgp__route_8c.html#a44f265aae5a483d9cef00d766759584a">bgp_info_set_flag</a> (rn, <span class="keyword">new</span>, <a class="code" href="bgp__route_8h.html#aa7f689448430856658d348cc8d84f27d">BGP_INFO_VALID</a>);

  <span class="comment">/* Register new BGP information. */</span>
  <a class="code" href="bgp__route_8c.html#ac7472ce06f993cd544f794c7b0381954">bgp_info_add</a> (rn, <span class="keyword">new</span>);
  
  <span class="comment">/* route_node_get lock */</span>
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
  
  <span class="comment">/* Process change. */</span>
  <a class="code" href="bgp__route_8c.html#a3c1be470ddb0d83d2cda73f8e4fa1f88">bgp_process</a> (bgp, rn, afi, safi);
  
  <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;new_attr);
  
  <span class="keywordflow">return</span>;

 filtered: 

  <span class="comment">/* This BGP update is filtered.  Log the reason then update BGP entry.  */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))
        <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
        <span class="stringliteral">&quot;%s rcvd UPDATE about %s/%d -- DENIED for RS-client %s due to: %s&quot;</span>,
        peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
        <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
        p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>, rsclient-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>, reason);

  <span class="keywordflow">if</span> (ri)
    <a class="code" href="bgp__route_8c.html#af17eefd0fc4a1bd8d98f657810e26741">bgp_rib_remove</a> (rn, ri, peer, afi, safi);

  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
  
  <span class="keywordflow">if</span> (new_attr.<a class="code" href="structattr.html#a948ca8050af06bf4fda46519eb8ec179">extra</a>)
    <a class="code" href="bgp__attr_8c.html#ad1dd9bb1bf877185bbf32226438a03b0">bgp_attr_extra_free</a> (&amp;new_attr);
  
  <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1e246b33bc776aab326a127170921d6d"></a><!-- doxytag: member="bgp_route.c::bgp_withdraw" ref="a1e246b33bc776aab326a127170921d6d" args="(struct peer *peer, struct prefix *p, struct attr *attr, afi_t afi, safi_t safi, int type, int sub_type, struct prefix_rd *prd, u_char *tag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bgp_withdraw </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structattr.html">attr</a> *&#160;</td>
          <td class="paramname"><em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sub_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *&#160;</td>
          <td class="paramname"><em>prd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>tag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l02377">2377</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp.html">bgp</a> *<a class="code" href="bgp__capability__test_8c.html#a528a1146825f30f8df2ae2e9d61dd7be">bgp</a>;
  <span class="keywordtype">char</span> buf[<a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>];
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;
  <span class="keyword">struct </span>peer *rsclient;
  <span class="keyword">struct </span><a class="code" href="structlistnode.html">listnode</a> *node, *nnode;

  bgp = peer-&gt;<a class="code" href="structpeer.html#aaff7e2f66146a076913d2fe3217edf2c">bgp</a>;

  <span class="comment">/* Process the withdraw for each RS-client. */</span>
  <span class="keywordflow">for</span> (<a class="code" href="linklist_8h.html#a71512a873b8f0e2b4c84d3c949a9bbaf">ALL_LIST_ELEMENTS</a> (bgp-&gt;<a class="code" href="structbgp.html#a4ccd4dea11eddfa74dc5518fdb448b67">rsclient</a>, node, nnode, rsclient))
    {
      <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (rsclient-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#abf59e9a9022e80ecdc266d86f35b378e">PEER_FLAG_RSERVER_CLIENT</a>))
        <a class="code" href="bgp__route_8c.html#a6f60f6d4e63b4cb347a05b4b07fb36c9">bgp_withdraw_rsclient</a> (rsclient, afi, safi, peer, p, <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a>, sub_type, prd, tag);
    }

  <span class="comment">/* Logging. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))  
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG, <span class="stringliteral">&quot;%s rcvd UPDATE about %s/%d -- withdrawn&quot;</span>,
      peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
      <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a>(p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
      p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>);

  <span class="comment">/* Lookup node. */</span>
  rn = <a class="code" href="bgp__route_8c.html#a28376b150f4dc5678918739889f323e6">bgp_afi_node_get</a> (bgp-&gt;<a class="code" href="structbgp.html#a165710ce04dcbf78397c514707c15f3b">rib</a>[afi][safi], afi, safi, p, prd);

  <span class="comment">/* If peer is soft reconfiguration enabled.  Record input packet for</span>
<span class="comment">     further calculation. */</span>
  <span class="keywordflow">if</span> (<a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (peer-&gt;<a class="code" href="structpeer.html#ad491ddb5e6d94d1db07405243d445c54">af_flags</a>[afi][safi], <a class="code" href="bgpd_8h.html#aeb7f2d381386a92f2fb115c6e0b81dba">PEER_FLAG_SOFT_RECONFIG</a>)
      &amp;&amp; peer != bgp-&gt;<a class="code" href="structbgp.html#ad576e7fa007ce5b32e2d6768813841f2">peer_self</a>)
    <a class="code" href="bgp__advertise_8c.html#a88b27370d0e6416445dc1f131053d9f1">bgp_adj_in_unset</a> (rn, peer);

  <span class="comment">/* Lookup withdrawn route. */</span>
  <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
    <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> == peer &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a7d70d35aa6ab6fa769c8e7d662288a35">type</a> == <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a> &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == sub_type)
      <span class="keywordflow">break</span>;

  <span class="comment">/* Withdraw specified route from routing table. */</span>
  <span class="keywordflow">if</span> (ri &amp;&amp; ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a57adf9fc517cc65fb9f4bcbf8ff796f2">BGP_INFO_HISTORY</a>))
    <a class="code" href="bgp__route_8c.html#a97b525c43ec4d1f2a86b597317b78051">bgp_rib_withdraw</a> (rn, ri, peer, afi, safi);
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG, 
      <span class="stringliteral">&quot;%s Can&#39;t find the route %s/%d&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
      <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
      p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>);

  <span class="comment">/* Unlock bgp_node_get() lock. */</span>
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);

  <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6f60f6d4e63b4cb347a05b4b07fb36c9"></a><!-- doxytag: member="bgp_route.c::bgp_withdraw_rsclient" ref="a6f60f6d4e63b4cb347a05b4b07fb36c9" args="(struct peer *rsclient, afi_t afi, safi_t safi, struct peer *peer, struct prefix *p, int type, int sub_type, struct prefix_rd *prd, u_char *tag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bgp_withdraw_rsclient </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>rsclient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a0a34f9bd6bbc49876614d274005c6ff1">afi_t</a>&#160;</td>
          <td class="paramname"><em>afi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zebra_8h.html#a195af4129e055b63a1b67529674bb998">safi_t</a>&#160;</td>
          <td class="paramname"><em>safi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpeer.html">peer</a> *&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix.html">prefix</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sub_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structprefix__rd.html">prefix_rd</a> *&#160;</td>
          <td class="paramname"><em>prd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_char *&#160;</td>
          <td class="paramname"><em>tag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l01992">1992</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">struct </span><a class="code" href="structbgp__node.html">bgp_node</a> *rn;
  <span class="keyword">struct </span><a class="code" href="structbgp__info.html">bgp_info</a> *ri;
  <span class="keywordtype">char</span> buf[<a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>];

  <span class="keywordflow">if</span> (rsclient == peer)
    <span class="keywordflow">return</span>;

  rn = <a class="code" href="bgp__route_8c.html#a28376b150f4dc5678918739889f323e6">bgp_afi_node_get</a> (rsclient-&gt;<a class="code" href="structpeer.html#a7e8ca2a0bcdc168c59140e710a1f2060">rib</a>[afi][safi], afi, safi, p, prd);

  <span class="comment">/* Lookup withdrawn route. */</span>
  <span class="keywordflow">for</span> (ri = rn-&gt;<a class="code" href="structbgp__node.html#aa7efb6473eab6666b1aba83e4da90429">info</a>; ri; ri = ri-&gt;<a class="code" href="structbgp__info.html#a7a49886b20a2c95c08baa23149501a2a">next</a>)
    <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structbgp__info.html#a367917f671400c20f33e512fa2c435dc">peer</a> == peer &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a7d70d35aa6ab6fa769c8e7d662288a35">type</a> == <a class="code" href="bgp__open_8h.html#abbb4c0b967acba158c34c110d81b3ab4">type</a> &amp;&amp; ri-&gt;<a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a> == <a class="code" href="structbgp__info.html#a1126336f7eec606018fa96967a4e5bfb">sub_type</a>)
      <span class="keywordflow">break</span>;

  <span class="comment">/* Withdraw specified route from routing table. */</span>
  <span class="keywordflow">if</span> (ri &amp;&amp; ! <a class="code" href="zebra_8h.html#a9310812ac92febfb7d1eb10127aea1a8">CHECK_FLAG</a> (ri-&gt;<a class="code" href="structbgp__info.html#a7ae2579adaf8f2fae14dc9d5fc23e976">flags</a>, <a class="code" href="bgp__route_8h.html#a57adf9fc517cc65fb9f4bcbf8ff796f2">BGP_INFO_HISTORY</a>))
    <a class="code" href="bgp__route_8c.html#a97b525c43ec4d1f2a86b597317b78051">bgp_rib_withdraw</a> (rn, ri, peer, afi, safi);
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="bgp__debug_8h.html#a3652951eb4451c498ae4be9890d4b7a4">BGP_DEBUG</a> (update, UPDATE_IN))
    <a class="code" href="log_8c.html#a34f80af784b8ec394e7a7154a7ec7364">zlog</a> (peer-&gt;<a class="code" href="structpeer.html#a8042cd53718885196f47ee66b471ec3d">log</a>, LOG_DEBUG,
          <span class="stringliteral">&quot;%s Can&#39;t find the route %s/%d&quot;</span>, peer-&gt;<a class="code" href="structpeer.html#ac3e4ca25642ebcc52b2d4b2143fa74fa">host</a>,
          <a class="code" href="sockunion_8c.html#a5bfb767e8fa3f9ff5d2a1e19d71791f4">inet_ntop</a> (p-&gt;<a class="code" href="structprefix.html#a3848d44348192dc4de7ac89e317399bd">family</a>, &amp;p-&gt;u.<a class="code" href="structprefix.html#af508982a05429729278c96708bd9e337">prefix</a>, buf, <a class="code" href="sockunion_8h.html#acdf2761ecf6723841896a77e9059e810">SU_ADDRSTRLEN</a>),
          p-&gt;<a class="code" href="structprefix.html#aae8dafba4797d25cf1d141780d87ff02">prefixlen</a>);

  <span class="comment">/* Unlock bgp_node_get() lock. */</span>
  <a class="code" href="bgp__table_8c.html#a5f6b53d4f2cd155109c2eec1fcf80687">bgp_unlock_node</a> (rn);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7ce345bb3824b60bf647d936d874322c"></a><!-- doxytag: member="bgp_route.c::DEFUN" ref="a7ce345bb3824b60bf647d936d874322c" args="(bgp_network, bgp_network_cmd,&quot;network A.B.C.D/M&quot;,&quot;Specify a network to announce via BGP\n&quot;&quot;IP prefix &lt;network&gt;/&lt;length&gt;, e.g., 35.0.0.0/8\n&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DEFUN </td>
          <td>(</td>
          <td class="paramtype">bgp_network&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bgp_network_cmd&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;network A.B.C.D/M&quot;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Specify a <a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a> to announce via BGP\<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>&quot;&quot;IP <a class="el" href="structprefix.html">prefix</a> &lt;<a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a>&gt;/&lt;<a class="el" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a>&gt;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">e.&#160;</td>
          <td class="paramname"><em>g.</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">35.0.0.0/8\<a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a>&quot;&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l04029">4029</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>
<div class="fragment"><pre class="fragment">{
  u_char ttl = 0;
  
  <span class="keywordflow">if</span> (argc == 2)
    <a class="code" href="vty_8h.html#afa25f32d4ba1649dd82cdd80434ac6ac">VTY_GET_INTEGER_RANGE</a> (<span class="stringliteral">&quot;Pathlimit TTL&quot;</span>, ttl, argv[1], 1, 255);
  
  <span class="keywordflow">return</span> <a class="code" href="bgp__route_8c.html#ad82b3e0221971ab424dc936b7fcbea1a">bgp_static_set</a> (<a class="code" href="structvty.html">vty</a>, <a class="code" href="structvty.html">vty</a>-&gt;<a class="code" href="structvty.html#a9179508dca757a3b7c345c86769b5b9a">index</a>, argv[0],
             <a class="code" href="zebra_8h.html#a192fcc8cbfb7b9d03c6562c48941a4bd">AFI_IP</a>, <a class="code" href="bgp__route_8h.html#ad5e89c162061cc75087adcc4527438b1">bgp_node_safi</a> (<a class="code" href="structvty.html">vty</a>), <a class="code" href="getopt1_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, ttl);
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ad5aca6be105a2339aa723cfae3c1822c"></a><!-- doxytag: member="bgp_route.c::bgp_network_route_map_cmd" ref="ad5aca6be105a2339aa723cfae3c1822c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="bgp__route_8c.html#ad5aca6be105a2339aa723cfae3c1822c">bgp_network_route_map_cmd</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l04053">4053</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7123f83b15faa017071a458140399e7c"></a><!-- doxytag: member="bgp_route.c::bgp_origin_long_str" ref="a7123f83b15faa017071a458140399e7c" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="bgp__route_8c.html#a7123f83b15faa017071a458140399e7c">bgp_origin_long_str</a>[]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__debug_8c_source.html#l00157">157</a> of file <a class="el" href="bgp__debug_8c_source.html">bgp_debug.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab1c6c37df170ace398e3657b5df5ba6f"></a><!-- doxytag: member="bgp_route.c::bgp_origin_str" ref="ab1c6c37df170ace398e3657b5df5ba6f" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="bgp__route_8c.html#ab1c6c37df170ace398e3657b5df5ba6f">bgp_origin_str</a>[]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__debug_8c_source.html#l00156">156</a> of file <a class="el" href="bgp__debug_8c_source.html">bgp_debug.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7ffdcd98fe58cb9d89e7f6aa804288e1"></a><!-- doxytag: member="bgp_route.c::g" ref="a7ffdcd98fe58cb9d89e7f6aa804288e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a> A B C D M route map Specify a <a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a> to announce via BGP <a class="el" href="spgrid_8c.html#abe63e991a7bf5d666068b15c9064428d">n</a> IP <a class="el" href="structprefix.html">prefix</a>&lt;<a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a>&gt;&lt;<a class="el" href="isis__pdu_8h.html#a64ed70bbcb4536e2af22a1aaf5209d18">length</a>&gt; e <a class="el" href="bgp__route_8c.html#a7ffdcd98fe58cb9d89e7f6aa804288e1">g</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l04053">4053</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1b8d8f33ec8896a62ab53afa7351c08b"></a><!-- doxytag: member="bgp_route.c::WORD" ref="a1b8d8f33ec8896a62ab53afa7351c08b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="command_8c.html#acec200f241e2d8f6b38bc83616c4c468">network</a> A B C D M route map <a class="el" href="bgp__route_8c.html#a1b8d8f33ec8896a62ab53afa7351c08b">WORD</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bgp__route_8c_source.html#l04053">4053</a> of file <a class="el" href="bgp__route_8c_source.html">bgp_route.c</a>.</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="bgp__route_8c.html">bgp_route.c</a>      </li>

    <li class="footer">Generated on Tue Apr 24 2012 10:41:13 for OSPFN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
